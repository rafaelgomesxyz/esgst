class ButtonSet {
    constructor(color1, color2, icon1, icon2, title1, title2, callback1, callback2) {
        this.busy = false;
        this.dependencies = [];
        const classes = {
            green: `form__submit-button`,
            grey: `form__saving-button`,
            red: `sidebar__error`,
            yellow: `sidebar__entry-delete`
        };
        this.set = document.createElement(`div`);
        this.set.className = `esgst-button-set`;
        this.set.innerHTML = `
            <div class="${classes[color1]} btn_action ${color1}">
                <i class="fa ${icon1}"></i>
                <span>${title1}</span>
            </div>
            <div class="${classes[color2]} btn_action ${color2} is-disabled is_disabled esgst-hidden">
                <i class="fa ${icon2}"></i>
                <span>${title2}</span>
            </div>
        `;
        this.button1 = this.set.firstElementChild;
        this.button2 = this.set.lastElementChild;
        this.callback1 = callback1;
        this.callback2 = callback2;
        this.button1.addEventListener(`click`, () => this.toggle(this.callback1));
        if (this.callback2) {
            this.button2.classList.remove(`is-disabled`, `is_disabled`);
            this.button2.addEventListener(`click`, () => this.toggle(this.callback2));
        }
    }
    toggle(callback) {
        this.dependencies.forEach(dependency => dependency.classList.toggle(`esgst-hidden`));
        this.busy = !this.busy;
        this.button1.classList.toggle(`esgst-hidden`);
        this.button2.classList.toggle(`esgst-hidden`);
        if (callback) {
            callback(this.toggle.bind(this));
        }
    }
    trigger() {
        this.toggle(this.callback1);
    }
}

class Checkbox {
    constructor (context, defaultValue, threeState) {
        this.value = defaultValue;
        this.isThreeState = threeState;
        this.checkbox = insertHtml(context, `afterBegin`, `
            <span class="esgst-checkbox">
                <input class="esgst-hidden" type="checkbox">
                <i class="fa fa-circle-o"></i>
                <i class="fa fa-circle"></i>
                <i class="fa fa-check-circle"></i>
            </span>
        `);
        this.input = this.checkbox.firstElementChild;
        this.disabled = this.input.nextElementSibling;
        this.none = this.disabled.nextElementSibling;
        this.enabled = this.none.nextElementSibling;
        if (this.isThreeState) {
            if (this.value === `disabled`) {
                this.none.classList.add(`esgst-hidden`);
                this.enabled.classList.add(`esgst-hidden`);
            } else if (this.value === `none`) {
                this.disabled.classList.add(`esgst-hidden`);
                this.enabled.classList.add(`esgst-hidden`);
            } else {
                this.disabled.classList.add(`esgst-hidden`);
                this.none.classList.add(`esgst-hidden`);
            }
            this.checkbox.addEventListener(`click`, () => this.change());
        } else {
            this.input.checked = this.value;
            if (this.value) {
                this.disabled.classList.add(`esgst-hidden`);
                this.none.classList.add(`esgst-hidden`);
            } else {
                this.none.classList.add(`esgst-hidden`);
                this.disabled.classList.add(`esgst-hidden`);
            }
            this.checkbox.addEventListener(`click`, () => this.change(true));
            this.checkbox.addEventListener(`mouseenter`, () => this.showNone());
            this.checkbox.addEventListener(`mouseleave`, () => this.hideNone());
            this.change();
        }
    }
    change(toggle, value, callback) {
        if (this.isThreeState) {
            if ((this.value === `disabled` && !value) || (value === `none`)) {
                this.enabled.classList.add(`esgst-hidden`);
                this.disabled.classList.add(`esgst-hidden`);
                this.none.classList.remove(`esgst-hidden`);
                this.value = `none`;
            } else if ((this.value === `none` && !value) || (value === `enabled`)) {
                this.none.classList.add(`esgst-hidden`);
                this.disabled.classList.add(`esgst-hidden`);
                this.enabled.classList.remove(`esgst-hidden`);
                this.value = `enabled`;
            } else if (!value || value === `disabled`) {
                this.enabled.classList.add(`esgst-hidden`);
                this.none.classList.add(`esgst-hidden`);
                this.disabled.classList.remove(`esgst-hidden`);
                this.value = `disabled`;
            }
        } else {
            if (toggle) {
                this.value = this.input.checked = !this.input.checked;
            }
            if (this.value) {
                this.disabled.classList.add(`esgst-hidden`);
                this.none.classList.add(`esgst-hidden`);
                this.enabled.classList.remove(`esgst-hidden`);
                if (this.onEnabled) {
                    this.onEnabled();
                }
            } else {
                this.enabled.classList.add(`esgst-hidden`);
                this.none.classList.add(`esgst-hidden`);
                this.disabled.classList.remove(`esgst-hidden`);
                if (this.onDisabled) {
                    this.onDisabled();
                }
            }
        }
    }
    showNone() {
        if (!this.value) {
            this.disabled.classList.add(`esgst-hidden`);
            this.none.classList.remove(`esgst-hidden`);
        }
    }
    hideNone() {
        if (!this.value) {
            this.disabled.classList.remove(`esgst-hidden`);
            this.none.classList.add(`esgst-hidden`);
        }
    }
    check(callback) {
        this.value = this.input.checked = true;
        this.change(false, null, callback);
    }
    uncheck(callback) {
        this.value = this.input.checked = false;
        this.change(false, null, callback);
    }
    toggle(callback) {
        this.change(true, null, callback);
    }
}

class Popout {
    constructor(className = ``, context = null, hoverSpeed = 1000, onClick = false, popout = null, onOpen = null) {
        this.onOpen = onOpen;
        this.context = context;
        this.popout = popout || insertHtml(document.body, `beforeEnd`, `<div class="${className}"></div>`);
        this.popout.classList.add(`esgst-popout`, `esgst-hidden`);
        this.popup = this.popout.closest(`.esgst-popup`);
        this.hoverSpeed = hoverSpeed;
        if (!onClick) {
            if (this.context) {
                let timeout = null;
                this.context.addEventListener(`mouseenter`, () => {
                    timeout = setTimeout(() => {
                        this.open();
                    }, this.hoverSpeed);
                });
                this.context.addEventListener(`mouseleave`, event => {
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout = null;
                    }
                    if (!this.popout.contains(event.relatedTarget)) {
                        this.close();
                    }
                });
            }
            let timeout = null;
            this.popout.addEventListener(`mouseenter`, () => {
                if (timeout) {
                    clearTimeout(timeout);
                    timeout = null;
                }
            });
            this.popout.addEventListener(`mouseleave`, event => {
                timeout = setTimeout(() => {
                    if (!this.context.contains(event.relatedTarget)) {
                        this.close();
                    }
                }, this.hoverSpeed);
            });
        } else {
            if (this.context) {
                this.context.addEventListener(`click`, () => {
                    if (this.isOpen) {
                        this.close();
                    } else {
                        this.open();
                    }
                });
            }
            document.addEventListener(`click`, event => {
                if (this.context && !this.context.contains(event.target) && !this.popout.contains(event.target)) {
                    this.close();
                }
            });
        }
        this.isOpen = false;
    }
    open(context = null, isFixed = false) {
        this.context = context || this.context;
        this.isFixed = isFixed;
        this.popout.classList.remove(`esgst-hidden`);
        this.popout.style.zIndex = 10000 + document.querySelectorAll(`.esgst-popup:not(.esgst-hidden), .esgst-popout:not(.esgst-hidden)`).length;
        if (this.isFixed) {
            this.popout.classList.add(`esgst-fixed`);
        }
        this.reposition();
        this.isOpen = true;
        if (this.onOpen) {
            this.onOpen(this.popout);
        }
    }
    close() {
        this.popout.classList.add(`esgst-hidden`);
        this.isOpen = false;
    }
    reposition(context = null) {
        this.popout.style.left = `0`;
        this.popout.style.top = `0`;
        this.context = context || this.context;
        const contextRect = this.context.getBoundingClientRect();
        const contextLeft = contextRect.left;
        const contextTop = contextRect.top;
        const popoutHeight = this.popout.offsetHeight;
        const popoutWidth = this.popout.offsetWidth;
        const popupRect = this.popup && this.popup.getBoundingClientRect();
        if (contextLeft + popoutWidth > document.documentElement.clientWidth) {
            this.popout.style.left = `${(contextLeft - popoutWidth + contextRect.width) - (this.popup ? popupRect.left : 0)}px`;
        } else {
            this.popout.style.left = `${contextLeft - (this.popup ? popupRect.left : 0)}px`;
        }
        if (contextTop + popoutHeight > document.documentElement.clientHeight) {
            this.popout.style.top = `${(contextTop - popoutHeight + (this.isFixed || this.popup ? 0 : scrollY)) - (this.popup ? popupRect.top : 0)}px`;
        } else {
            this.popout.style.top = `${(contextTop + contextRect.height + (this.isFixed || this.popup ? 0 : scrollY)) - (this.popup ? popupRect.top : 0)}px`;
        }
    }
}

class Popup {
    constructor(icon, title, temp, settings, popup = null) {
        this.isCreated = popup ? false : true;
        this.temp = temp;
        this.popup = popup || insertHtml(document.body, `beforeEnd`, `
            <div class="esgst-hidden esgst-popup">
                <div class="popup_summary">
                    <div class="${icon ? `` : `esgst-hidden `}popup_icon">
                        <i class="popup__icon fa ${icon} esgst-popup-icon"></i>
                    </div>
                    <div class="${title ? `` : `esgst-hidden `}popup__heading popup_heading">
                        <div class="popup_heading_h2 esgst-popup-title">${title}</div>
                    </div>
                </div>
                <div class="popup_description esgst-popup-description">
                    <div class="esgst-popup-scrollable"></div>
                </div>
                <div class="popup__actions popup_actions">
                    <span class="esgst-hidden">Settings</span>
                    <span class="esgst-popup-close">Close</span>
                </div>
            </div>
        `);
        if (this.isCreated) {
            this.description = this.popup.firstElementChild.nextElementSibling;
            this.scrollable = this.description.firstElementChild;
            this.actions = this.description.nextElementSibling;
            if (!settings) {
                settings = this.actions.firstElementChild;
                settings.classList.remove(`esgst-hidden`);
                settings.addEventListener(`click`, () => {
                    if (esgst.openSettingsInTab) {
                        open(`/esgst/settings`);
                    } else {
                        loadSMMenu();
                    }
                });
            }
            this.description.nextElementSibling.lastElementChild.addEventListener(`click`, () => this.close());
            this.popup.addEventListener(`click`, () => this.reposition());
        } else {
            const closeButton = this.popup.getElementsByClassName(`b-close`)[0];
            if (closeButton) {
                closeButton.addEventListener(`click`, () => this.close());
            }
        }
    }
    open(callback) {
        this.modal = insertHtml(document.body, `beforeEnd`, `
            <div class="esgst-popup-modal"></div>
        `);
        if (this.isCreated) {
            this.popup.classList.remove(`esgst-hidden`);
        } else {
            this.popup.style.display = `block`;
            this.popup.style.position = `absolute`;
        }
        const n = 9999 + document.querySelectorAll(`.esgst-popup:not(.esgst-hidden), .esgst-popout:not(.esgst-hidden)`).length;
        this.modal.style.zIndex = n;
        this.popup.style.zIndex = n + 1;
        this.modal.addEventListener(`click`, () => this.close());
        this.reposition();
        if (callback) {
            callback();
        }
    }
    close() {
        this.modal.remove();
        if (this.isCreated) {
            if (this.temp) {
                this.popup.remove();
            } else {
                this.popup.classList.add(`esgst-hidden`);
            }
        } else {
            this.popup.style = ``;
        }
        if (this.onClose) {
            this.onClose();
        }
    }
    reposition() {
        if (this.isCreated) {
            this.scrollable.style.maxHeight = `${innerHeight * 0.9 - (this.popup.offsetHeight - this.scrollable.offsetHeight)}px`;
        }
        this.popup.style.left = `${(innerWidth - this.popup.offsetWidth) / 2}px`;
        this.popup.style.top = `${(innerHeight - this.popup.offsetHeight) / 2}px`;
    }
}

class ToggleSwitch {
    constructor(context, id, inline, name, sg, st, tooltip, value) {
        this.dependencies = [];
        this.exclusions = [];
        this.id = id;
        this.sg = sg;
        this.st = st;
        this.value = value;
        this.container = insertHtml(context, `beforeEnd`, `
            <div class="esgst-toggle-switch-container ${inline ? `inline` : ``}">
                <label class="esgst-toggle-switch">
                    <input type="checkbox">
                    <div class="esgst-toggle-switch-slider"></div>
                </label>
                <span>${name}</span>
                ${tooltip ? `<i class="fa fa-question-circle" title="${tooltip}"></i>` : ``}
            </div>
        `);
        this.switch = this.container.firstElementChild;
        this.input = this.switch.firstElementChild;
        this.name = this.switch.nextElementSibling;
        this.input.checked = this.value;
        this.input.addEventListener(`change`, () => this.change());
    }
    change() {
        this.value = this.input.checked;
        if (this.id) {
            setSetting(this.id, this.value, this.sg, this.st);
            esgst[this.id] = this.value;
        }
        if (this.value) {
            if (this.onEnabled) {
                this.onEnabled();
            }
            this.dependencies.forEach(dependency => dependency.classList.remove(`esgst-hidden`));
            this.exclusions.forEach(exclusion => exclusion.classList.add(`esgst-hidden`));
        } else {
            if (this.onDisabled) {
                this.onDisabled();
            }
            this.dependencies.forEach(dependency => dependency.classList.add(`esgst-hidden`));
            this.exclusions.forEach(exclusion => exclusion.classList.remove(`esgst-hidden`));
        }
    }
    enable() {
        this.input.checked = true;
        this.change();
    }
    disable() {
        this.input.checked = false;
        this.change();
    }
    toggle() {
        this.input.checked = !this.input.checked;
        this.change();
    }
}

var DOM, esgst;
chrome.storage.onChanged.addListener((changes, namespace) => {
    if (namespace === `local`) {
        let key;
        for (key in changes) {
            esgst.storage[key] = changes[key].newValue;
        }
    }
});
chrome.storage.local.get(null, storage => {
    loadEsgst(storage);
});

function parseHtml(string) {
    return DOM.parser.parseFromString(string, `text/html`);
}

function loadEsgst(storage) {
    DOM = {
        parse: parseHtml,
        parser: new DOMParser()
    };
    esgst = {
        storage: storage,
        sg: location.hostname.match(/www.steamgifts.com/),
        st: location.hostname.match(/www.steamtrades.com/),
        currentVersion: `7.0.2`,
        icon: `data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAqv8DCbP/Hgeq+CQIrf8iCK3/Igit/yIIrf8iB6//Iwit9x8Aqv8DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKr0GAa2/c0DvfzfA7f83QO3/N0Dt/zdA7f83QO+/d4Gs/3OAKP1GQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACm/xQFs/n2Bcf//wW///8FwP//BcD//wW///8Fx///BbP69gC2/xUAAAAAAAAAAAAAAAAA/1UDFptOFxSZMxkLpJktAq720QW1+ugEsfvjA7b92wO2/dsEsfvjBbX66Aau/dEoiO4tUlLWGU5k3hdVVf8DEJxKHxWqT8cVrU7uE6VN0guqny0Apv8XAJfQGwBAVywAQFcsAJfQGwCx/xcogugtS2Lk0lBl6u5Qae7ISmPeHxagSSMVr07jF7lV/xOiSu0brgATAAAAAAAAAA8AAAC/AAAAwAAAABAAAAAAYznjEkth4OxWb/3/T2jv40lf4iMXnksiEq1O3RayUv8UpEnkEo0+HQAAABkAAABBAAAA8QAAAPEAAABBAAAAGUBSvxxOYeDjU2v0/05m7d1LYuEiF55LIhKtTt0Ws1L/FahN2gU1FTAAAADAAAAA7AAAAP0AAAD9AAAA7AAAAMAVG0owUGPm2lNr9P9OZu3dS2LhIheeSyISrU7dFrNS/xWoTdoFNRswAAAAvwAAAOsAAAD9AAAA/QAAAOsAAADAFRtKMFBj6NpTa/T/Tmbt3Uti4SIXnksiEq1O3RayUv8UpEnkEo0+HQAAABgAAABAAAAA8QAAAPEAAABBAAAAGT5PuR1OYeDjU2v0/05m7d1LYuEiFqBJIxWuT+QXuVX/E6JL7QC8XhMAAAAAAAAADwAAAL8AAAC/AAAAEAAAAAAOR/8SSWLh7FZv/f9PaO/jSV/iIxCUSh8Vrk7HFqxN7ROlS9JskzMt1XULGK12EhxGLgYsRy8GK612EhzVgAsYgmxxLU1i39JNZ+vtT2fwx0pj1h8AqlUDF65GFgqZUhlsiC0txH0T0s5/EujJgBPkz4QR28+EEdvJgBPkzn8Q6Md+E9KLdHosM1LWGUZo6BZVVf8DAAAAAAAAAAAAAAAA/2YAFMl9EvbgjRb/14gV/9eIFf/XiBX/14gV/9+NFv/KgBD254YAFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL91FRjKgRHN1IgU3s+EEt3PhBLdz4QS3c+EEt3UiBTezYMRzcJ6FBkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACqqgADxIARHr18FiO8eA8ivHgPIrx4DyK8eA8ivXwPI8SAER7/VQADAAAAAAAAAAAAAAAA78cAAPA3AAD4FwAABCAAADGOAAAE+AAAkBEAAJ55AACYOQAAlgEAAER4AAAXaAAATnoAAPgXAAD0JwAA69cAAA==`,
        sgIcon: `data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAQAQAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIUAAAD5AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAPoAAACFAAAAAAAAAAAAAAD8AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA+QAAAAAAAAAAAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAP8AAAD/AAAA/wAAABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAAD/AAAA/wAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAP8AAAD/AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAAD/AAAA/wAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAP8AAAD/AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAP8AAAD/AAAA/wAAAAAAAAAAAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAPwAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD5AAAAAAAAAAAAAACFAAAA+QAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD5AAAAhQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AADAAwAAwAMAAMfjAADP8wAAz/MAAM/zAADP8wAAz/MAAM/zAADH4wAAwAMAAMADAAD//wAA//8AAA==`,
        stIcon: `data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAQAQAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABbD6SgWw+ucFsPrkBbD6SgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWw+uYFsPr/BbD6/wWw+ucAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFsPrmBbD6/wWw+v8FsPrmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABbD6SQWw+uYFsPrmBbD6SQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFKRLShSkS+cUpEvkFKRLSgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAExi4EpMYuDnTGLg5Exi4EoAAAAAAAAAABSkS+YUpEv/FKRL/xSkS+cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMYuDmTGLg/0xi4P9MYuDnAAAAAAAAAAAUpEvmFKRL/xSkS/8UpEvmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATGLg5kxi4P9MYuD/TGLg5gAAAAAAAAAAFKRLSRSkS+YUpEvmFKRLSQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAExi4ElMYuDmTGLg5kxi4EkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMZ9E0rGfRPnxn0T5MZ9E0oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADGfRPmxn0T/8Z9E//GfRPnAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAxn0T5sZ9E//GfRP/xn0T5gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMZ9E0nGfRPmxn0T5sZ9E0kAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAPw/AAD8PwAA/D8AAPw/AAD//wAAh+EAAIfhAACH4QAAh+EAAP//AAD8PwAA/D8AAPw/AAD8PwAA//8AAA==`,
        endlessFeatures: [],
        gameFeatures: [],
        userFeatures: [],
        giveawayFeatures: [],
        currentGiveaways: [],
        attachedImages: [],
        currentComments: [],
        popupGiveaways: [],
        currentDiscussions: [],
        profileFeatures: [],
        elgbCache: JSON.parse(getValue(`esgst_elgbCache`, `{"descriptions": {}, "timestamp": ${Date.now()}}`)),
        menuPath: location.pathname.match(/^\/esgst\//),
        settingsPath: location.pathname.match(/^\/esgst\/settings/),
        importMenuPath: location.pathname.match(/^\/esgst\/import/),
        exportMenuPath: location.pathname.match(/^\/esgst\/export/),
        deleteMenuPath: location.pathname.match(/^\/esgst\/delete/),
        userPath: location.pathname.match(/^\/user\//),
        groupPath: location.pathname.match(/^\/group\//),
        regionsPath: location.pathname.match(/^\/regions\//),
        groupWishlistPath: location.pathname.match(/^\/group\/(.*?)\/wishlist/),
        mainPath: location.pathname.match(/^\/$/),
        winnersPath: location.pathname.match(/^\/giveaway\/.+\/winners/),
        giveawaysPath: location.href.match(/steamgifts.com($|\/$|\/giveaways(?!.*\/(new|wishlist|created|entered|won)))/),
        giveawayCommentsPath: location.pathname.match(/^\/giveaway\/(?!.+\/(entries|winners|groups))/),
        discussionsTicketsPath: location.pathname.match(/^\/(discussions|support\/tickets)/),
        ticketsPath: location.pathname.match(/^\/support\/tickets/),
        tradesPath: location.href.match(/steamtrades.com($|\/$|\/trades)/),
        discussionsTicketsTradesPath: location.href.match(/steamtrades.com($|\/$)/) || location.pathname.match(/^\/(discussions|support\/tickets|trades)/),
        originalHash: location.hash,
        discussionTicketTradeCommentsPath: location.pathname.match(/^\/(discussion|support\/ticket|trade)\//),
        archivePath: location.pathname.match(/^\/archive/),
        profilePath: location.pathname.match(/^\/account\/settings\/profile/),
        giveawayPath: location.pathname.match(/^\/giveaway\//),
        discussionPath: location.pathname.match(/^\/discussion\//),
        tradePath: location.pathname.match(/^\/trade\//),
        discussionsPath: location.pathname.match(/^\/discussions(?!\/new)/),
        newDiscussionPath: location.pathname.match(/^\/discussions\/new/),
        editDiscussionPath: location.pathname.match(/^\/discussions\/edit/),
        newGiveawayPath: location.pathname.match(/^\/giveaways\/new/),
        newTicketPath: location.pathname.match(/^\/support\/tickets\/new/),
        wishlistPath: location.pathname.match(/^\/giveaways\/wishlist/),
        createdPath: location.pathname.match(/^\/giveaways\/created/),
        wonPath: location.pathname.match(/^\/giveaways\/won/),
        enteredPath: location.pathname.match(/^\/giveaways\/entered/),
        commentsPath: location.pathname.match(/^\/(giveaway\/(?!.*\/(entries|winners|groups))|discussion\/|support\/ticket\/|trade\/)/),
        accountPath: location.pathname.match(/^\/account/),
        whitelistPath: location.pathname.match(/^\/account\/manage\/whitelist/),
        blacklistPath: location.pathname.match(/^\/account\/manage\/blacklist/),
        inboxPath: location.pathname.match(/^\/messages/),
        groupsPath: location.pathname.match(/^\/account\/steam\/groups/)
    };
    esgst.version = getValue(`version`, esgst.currentVersion);
    esgst.settings = JSON.parse(getValue(`settings`, `{}`) || `{}`);
    var logoutButton = document.getElementsByClassName(esgst.sg ? `js__logout` : `js_logout`)[0];
    if (location.pathname.match(/esgst-settings/)) {
        location.href = `/esgst/settings`;
    } else if (location.pathname.match(/esgst-sync/)) {
        location.href = `/esgst/sync`;
    } else if (location.pathname.match(/esgst\/sync/)) {
        setSync();
    } else if (location.pathname.match(/^\/esgst\/dropbox/)) {
        setValue(`dropboxToken`, location.hash.match(/access_token=(.+?)\&/)[1]);
        close();
    } else if (location.pathname.match(/^\/esgst\/imgur/)) {
        setValue(`imgurToken`, location.hash.match(/access_token=(.+?)\&/)[1]);
        close();
    } else if (logoutButton || esgst.menuPath) {
        // User is logged in.
        if (esgst.sg || (esgst.st && esgst.settings.esgst_st)) {
            if (esgst.menuPath) {
                document.head.insertAdjacentHTML(`beforeEnd`, `<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.steamgifts.com/css/minified_v30.css">`);
            }
            if (esgst.sg) {
                esgst.pageOuterWrapClass = `page__outer-wrap`;
                esgst.pageHeadingClass = `page__heading`;
                esgst.pageHeadingBreadcrumbsClass = `page__heading__breadcrumbs`;
                esgst.footer = document.getElementsByClassName(`footer__outer-wrap`)[0];
                esgst.replyBox = document.getElementsByClassName(`comment--submit`)[0];
                esgst.cancelButtonClass = `comment__cancel-button`;
                esgst.paginationNavigationClass = `pagination__navigation`;
                esgst.hiddenClass = `is-hidden`;
                esgst.name = `sg`;
                esgst.selectedClass = `is-selected`;
            } else {
                esgst.pageOuterWrapClass = `page_outer_wrap`;
                esgst.pageHeadingClass = `page_heading`;
                esgst.pageHeadingBreadcrumbsClass = `page_heading_breadcrumbs`;
                esgst.footer = document.getElementsByTagName(`footer`)[0];
                esgst.replyBox = document.getElementsByClassName(`reply_form`)[0];
                esgst.cancelButtonClass = `btn_cancel`;
                esgst.paginationNavigationClass = `pagination_navigation`;
                esgst.hiddenClass = `is_hidden`;
                esgst.name = `st`;
                esgst.selectedClass = `is_selected`;
            }
            esgst.currentPage = location.href.match(/page=(\d+)/);
            if (esgst.currentPage) {
                esgst.currentPage = parseInt(esgst.currentPage[1]);
            } else {
                esgst.currentPage = 1;
            }
            var url = location.href.replace(location.search, ``).replace(location.hash, ``).replace(`/search`, ``);
            esgst.originalUrl = url;
            esgst.favicon = document.querySelector(`[rel="shortcut icon"]`);
            esgst.originalTitle = document.title;
            if (esgst.mainPath) {
                url += esgst.sg ? `giveaways` : `trades`;
            }
            url += `/search?`;
            var parameters = location.search.replace(/^\?/, ``).split(/&/);
            for (var i = 0, n = parameters.length; i < n; ++i) {
                if (parameters[i] && !parameters[i].match(/page/)) {
                    url += parameters[i] + `&`;
                }
            }
            if (location.search) {
                esgst.originalUrl = url.replace(/&$/, ``);
                if (esgst.currentPage > 1) {
                    esgst.originalUrl += `&page=${esgst.currentPage}`;
                }
            }
            url += `page=`;
            esgst.searchUrl = url;
            if (!esgst.menuPath) {
                refreshHeaderElements(document);
            }
            esgst.header = document.getElementsByTagName(`header`)[0];
            esgst.headerNavigationLeft = document.getElementsByClassName(`nav__left-container`)[0];
            esgst.pagination = document.getElementsByClassName(`pagination`)[0];
            esgst.featuredContainer = document.getElementsByClassName(`featured__container`)[0];
            esgst.pageOuterWrap = document.getElementsByClassName(esgst.pageOuterWrapClass)[0];
            esgst.paginationNavigation = document.getElementsByClassName(esgst.paginationNavigationClass)[0];
            esgst.sidebar = document.getElementsByClassName(`sidebar`)[0];
            esgst.activeDiscussions = document.querySelector(`.widget-container--margin-top:last-of-type`);
            esgst.pinnedGiveaways = document.getElementsByClassName(`pinned-giveaways__outer-wrap`)[0];
            esgst.pinnedGiveawaysButton = document.getElementsByClassName(`pinned-giveaways__button`)[0];
            var mainPageHeadingIndex;
            if (esgst.commentsPath) {
                mainPageHeadingIndex = 1;
            } else {
                mainPageHeadingIndex = 0;
            }
            esgst.mainPageHeading = document.getElementsByClassName(esgst.pageHeadingClass)[mainPageHeadingIndex];
            if (!esgst.mainPageHeading && mainPageHeadingIndex === 1) {
                esgst.mainPageHeading = document.getElementsByClassName(esgst.pageHeadingClass)[0];
            }
            if (logoutButton) {
                esgst.xsrfToken = logoutButton.getAttribute(`data-form`).match(/xsrf_token=(.+)/)[1];
            }
            esgst.pageTop = 25;
            esgst.commentsTop = 0;
            esgst.apPopouts = {};
            esgst.tsTables = [];
            esgst.currentUsers = {};
            esgst.currentGames = {
                apps: {},
                subs: {}
            };
            esgst.lastPage = getLastPage(document, true);
            esgst.oldValues = {
                ge: `tge`,
                hideButtons_ge: `hideButtons_tge`,
                gv_ge: `gv_tge`,
                es_ge: `es_tge`,
                enableByDefault: `sm_ebd`,
                showChangelog: `sm_c`,
                hr_g: `hr_dw`,
                hr_m: `hr_mc`,
                at_24: `at_c24`,
                elgb_r: `elgb_rb`,
                gts: `gt`,
                cfh_g: `cfh_ge`,
                un_p: `un_wb`,
                rwscvl_r: `rwscvl_ro`,
                wbh_w: `wbh_cw`,
                wbh_b: `wbh_cb`,
                gt: `ggt`,
                gt_t: `ggt_t`,
                es_d: `es_dtt`,
                es_t: `es_dtt`,
                es_c: `es_dttc`,
                es_l: `es_r`,
                es_r: `es_rs`,
                ags_maxLevel: `agsMaxLevel`,
                ags_minLevel: `agsMinLevel`,
                ags_maxEntries: `agsMaxEntries`,
                ags_minEntries: `agsMinEntries`,
                ags_maxCopies: `agsMaxCopies`,
                ags_minCopies: `agsMinCopies`,
                ags_maxPoints: `agsMaxPoints`,
                ags_minPoints: `agsMinPoints`,
                ags_regionRestricted: `agsRegionRestricted`,
                ags_dlc: `agsDlc`,
                gv_spacing: `gvSpacing`,
                gb_hours: `gbHours`,
                gts_preciseStart: `gts_ps`,
                gts_preciseEnd: `gts_pe`,
                mgc: `gm`,
                mgc_createTrain: `gm_createTrain`,
                cfh_pasteFormatting: `CFH_ALIPF`,
                wbh_w_color: `wbh_cw_color`,
                wbh_w_bgColor: `wbh_cw_bgColor`,
                wbh_b_color: `wbh_cb_color`,
                wbh_b_bgColor: `wbh_cb_bgColor`,
                avatar: `Avatar`,
                username: `Username`,
                steamId: `SteamID64`,
                steamApiKey: `SteamAPIKey`,
                lastSync: `LastSync`,
                syncFrequency: `SyncFrequency`,
                ugs: `UGS`,
                ugs_checkRules: `UGS_SANM`,
                ugs_checkWhitelist: `UGS_SW`,
                ugs_checkMember: `UGS_G`,
                as_searchAppId: `AS_AIS`,
                ugd_clearCache: `UGD_CC`,
                namwc_checkNotActivated: `NAMWC_NAC`,
                namwc_checkMultiple: `NAMWC_MC`,
                nrf_searchMultiple: `NRF_FS`,
                wbc_checkSingle: `WBC_SC`,
                wbc_checkWhitelist: `WBC_FC`,
                wbc_checkAll: `WBC_FLC`,
                wbc_returnWhitelists: `WBC_RW`,
                wbc_returnBlacklists: `WBC_RB`,
                wbc_checkNew: `WBC_RC`,
                wbc_clearCache: `WBC_CC`,
                gwc_e: `gwc`,
                gwr_e: `gwr`
            };
            esgst.defaultValues = {
                cfh_img_remember: false,
                cfh_img_choice: 1,
                elgb_filters: `.|(bestof|(g(ood)?)?)(l(uck)?)?(h(ave)?)?(f(un)?)?|enjoy|(h(umble)?)?(b(undle)?)?(g(ift)?)?(l(ink)?)?`,
                hr_minutes: 1,
                exportBackupIndex: 0,
                gwc_a_b: false,
                gwr_a_b: false,
                vai_i: false,
                exportBackup: true,
                gm_enable: false,
                gm_useRegExp: false,
                sks_exportKeys: false,
                gc_fcvIcon: `calendar`,
                gc_rcvIcon: `calendar-minus-o`,
                gc_ncvIcon: `calendar-times-o`,
                gc_hIcon: `eye-slash`,
                gc_iIcon: `ban`,
                gc_oIcon: `folder`,
                gc_wIcon: `heart`,
                gc_aIcon: `trophy`,
                gc_mpIcon: `users`,
                gc_scIcon: `cloud`,
                gc_tcIcon: `clone`,
                gc_lIcon: `linux`,
                gc_mIcon: `apple`,
                gc_eaIcon: `unlock`,
                gc_rmIcon: `trash`,
                gc_dlcIcon: `download`,
                gc_pIcon: `suitcase`,
                gc_fcvLabel: `Full CV`,
                gc_rcvLabel: `Reduced CV`,
                gc_ncvLabel: `No CV`,
                gc_hLabel: `Hidden`,
                gc_iLabel: `Ignored`,
                gc_oLabel: `Owned`,
                gc_wLabel: `Wishlisted`,
                gc_aLabel: `Achievements`,
                gc_mpLabel: `Multiplayer`,
                gc_scLabel: `Steam Cloud`,
                gc_tcLabel: `Trading Cards`,
                gc_lLabel: `Linux`,
                gc_mLabel: `Mac`,
                gc_eaLabel: `Early Access`,
                gc_rmLabel: `Removed`,
                gc_dlcLabel: `DLC`,
                gc_pLabel: `Package`,
                sk_closePopups: `escape`,
                sk_searchBox: `ctrlKey + q`,
                sk_firstPage: `ctrlKey + arrowup`,
                sk_previousPage: `ctrlKey + arrowleft`,
                sk_nextPage: `ctrlKey + arrowright`,
                sk_lastPage: `ctrlKey + arrowdown`,
                sk_toggleFilters: `altKey + q`,
                sk_hideGame: `altKey + g`,
                sk_hideGiveaway: `altKey + h`,
                sk_giveawayEntry: `ctrlKey + enter`,
                sk_creator: `altKey + c`,
                sk_replyBox: `ctrlKey +  `,
                sk_replyUser: `altKey + u`,
                sk_submitReply: `ctrlKey + enter`,
                gc_categories: [`gc_gi`, `gc_r`, `gc_fcv`, `gc_rcv`, `gc_ncv`, `gc_h`, `gc_i`, `gc_o`, `gc_w`, `gc_a`, `gc_mp`, `gc_sc`, `gc_tc`, `gc_l`, `gc_m`, `gc_ea`, `gc_rm`, `gc_dlc`, `gc_p`, `gc_g`],
                gas_auto: false,
                gas_option: `sortIndex_asc`,
                gas_autoWishlist: false,
                gas_optionWishlist: `sortIndex_asc`,
                gas_autoRecommended: false,
                gas_optionRecommended: `sortIndex_asc`,
                gas_autoGroup: false,
                gas_optionGroup: `sortIndex_asc`,
                gas_autoNew: false,
                gas_optionNew: `sortIndex_asc`,
                gas_autoEntered: false,
                gas_optionEntered: `sortIndex_asc`,
                gas_autoUser: false,
                gas_optionUser: `sortIndex_asc`,
                gas_autoGroups: false,
                gas_optionGroups: `sortIndex_asc`,
                ds_auto: false,
                ds_option: `sortIndex_asc`,
                gc_o_altAccounts: [],
                gc_g_colors: [],
                gwc_colors: [],
                gwr_colors: [],
                ut_colors: {},
                gt_colors: {},
                ugs_checkRules: false,
                ugs_checkWhitelist: false,
                ugs_checkBlacklist: false,
                ugs_checkMember: false,
                ugs_checkDifference: false,
                ugs_difference: 0,
                as_searchAppId: false,
                ugd_getPlaytime: true,
                ugd_getAchievements: false,
                ugd_clearCache: false,
                namwc_checkNotActivated: false,
                namwc_checkMultiple: false,
                nrf_searchMultiple: false,
                wbc_checkSingle: false,
                wbc_checkWhitelist: true,
                wbc_checkAll: false,
                wbc_returnWhitelists: false,
                wbc_returnBlacklists: false,
                wbc_checkNew: false,
                wbc_clearCache: false,
                openSettingsInTab: false,
                enableByDefault: false,
                showChangelog: true,
                checkVersionMain: true,
                checkVersion: true,
                syncGroups: true,
                syncWhitelist: true,
                syncBlacklist: true,
                syncHiddenGames: true,
                syncGames: true,
                syncReducedCvGames: true,
                syncNoCvGames: true,
                syncGiveaways: true,
                ged: true,
                df_enable: true,
                df_preset: null,
                gf_enable: true,
                gf_enableWishlist: true,
                gf_enableRecommended: true,
                gf_enableNew: true,
                gf_enableGroup: true,
                gf_enableCreated: true,
                gf_enableEntered: true,
                gf_enableWon: true,
                gf_enableGroups: true,
                gf_enablePopup: true,
                gf_preset: null,
                gf_presetWishlist: null,
                gf_presetRecommended: null,
                gf_presetNew: null,
                gf_presetGroup: null,
                gf_presetCreated: null,
                gf_presetEntered: null,
                gf_presetWon: null,
                gf_presetGroups: null,
                gf_presetPopup: null,
                ags_maxDate: ``,
                ags_minDate: ``,
                ags_maxScore: ``,
                ags_minScore: ``,
                ags_maxLevel: ``,
                ags_minLevel: ``,
                ags_maxEntries: ``,
                ags_minEntries: ``,
                ags_maxCopies: ``,
                ags_minCopies: ``,
                ags_maxPoints: ``,
                ags_minPoints: ``,
                ags_regionRestricted: false,
                ags_dlc: false,
                ags_app: false,
                ags_sub: false,
                gv_spacing: 0,
                gb_hours: 1,
                gts_preciseStart: false,
                gts_preciseEnd: false,
                mgc_createTrain: true,
                mgc_bumpLast: true,
                mgc_groupKeys: false,
                mgc_reversePosition: false,
                mgc_removeLinks: true,
                adots_index: 0,
                sal_index: 2,
                cfh_pasteFormatting: true,
                gc_h_color: `#ffffff`,
                gc_gi_color: `#ffffff`,
                gc_fcv_color: `#ffffff`,
                gc_rcv_color: `#ffffff`,
                gc_ncv_color: `#ffffff`,
                gc_w_color: `#ffffff`,
                gc_o_color: `#ffffff`,
                gc_i_color: `#ffffff`,
                gc_rm_color: `#ffffff`,
                gc_ea_color: `#ffffff`,
                gc_tc_color: `#ffffff`,
                gc_a_color: `#ffffff`,
                gc_mp_color: `#ffffff`,
                gc_sc_color: `#ffffff`,
                gc_l_color: `#ffffff`,
                gc_m_color: `#ffffff`,
                gc_dlc_color: `#ffffff`,
                gc_p_color: `#ffffff`,
                gc_g_color: `#ffffff`,
                gc_h_bgColor: `#e74c3c`,
                gc_gi_bgColor: `#555555`,
                gc_fcv_bgColor: `#641e16`,
                gc_rcv_bgColor: `#641e16`,
                gc_ncv_bgColor: `#641e16`,
                gc_o_bgColor: `#16a085`,
                gc_w_bgColor: `#3498db`,
                gc_i_bgColor: `#e74c3c`,
                gc_rm_bgColor: `#e74c3c`,
                gc_ea_bgColor: `#3498db`,
                gc_tc_bgColor: `#2ecc71`,
                gc_a_bgColor: `#145a32`,
                gc_mp_bgColor: `#0e6251`,
                gc_sc_bgColor: `#154360`,
                gc_l_bgColor: `#f39c12`,
                gc_m_bgColor: `#d35400`,
                gc_dlc_bgColor: `#8e44ad`,
                gc_p_bgColor: `#8e44ad`,
                gc_g_bgColor: `#7f8c8d`,
                wbh_w_color: `#ffffff`,
                wbh_w_bgColor: `#228b22`,
                wbh_b_color: `#ffffff`,
                wbh_b_bgColor: `#ff4500`,
                npth_previousKey: `ArrowLeft`,
                npth_nextKey: `ArrowRight`,
                avatar: ``,
                username: ``,
                steamId: ``,
                steamApiKey: ``,
                lastSync: 0,
                syncFrequency: 0
            };
            esgst.users = getValue(`users`);
            if (typeof esgst.users === `undefined`) {
                setValue(`users`, `{"steamIds":{},"users":{}}`);
                esgst.users = {
                    steamIds: {},
                    users: {}
                };
            } else {
                esgst.users = JSON.parse(esgst.users);
                var changed = false;
                for (key in esgst.users.users) {
                    var wbc = esgst.users.users[key].wbc;
                    if (wbc && wbc.result && wbc.result !== `whitelisted` && wbc.result !== `blacklisted`) {
                        delete esgst.users.users[key].wbc;
                        changed = true;
                    }
                }
                if (changed) {
                    setValue(`users`, JSON.stringify(esgst.users));
                }
            }
            if (typeof getValue(`${esgst.name}RfiCache`) === `undefined`) {
                setValue(`${esgst.name}RfiCache`, getValue(`esgst_replies`, `{}`));
                delValue(`esgst_replies`);
            }
            if (typeof getValue(`emojis`) === `undefined`) {
                setValue(`emojis`, getValue(`Emojis`, ``));
                delValue(`Emojis`);
            }
            if (esgst.sg) {
                if (typeof getValue(`dfPresets`) === `undefined`) {
                    setValue(`dfPresets`, getValue(`esgst_dfPresets`, `[]`));
                    delValue(`esgst_dfPresets`);
                }
                if (typeof getValue(`templates`) === `undefined`) {
                    setValue(`templates`, getValue(`esgst_templates`, `[]`));
                    delValue(`esgst_templates`);
                }
                if (typeof getValue(`stickiedCountries`) === `undefined`) {
                    setValue(`stickiedCountries`, getValue(`esgst_stickiedCountries`, `[]`));
                    delValue(`esgst_stickiedCountries`);
                }
                if (typeof getValue(`giveaways`) === `undefined`) {
                    setValue(`giveaways`, getValue(`esgst_giveaways`, `{}`));
                    delValue(`esgst_giveaways`);
                }
                esgst.giveaways = JSON.parse(getValue(`giveaways`));
                if (typeof getValue(`discussions`) === `undefined`) {
                    setValue(`discussions`, getValue(`esgst_discussions`, `{}`));
                    delValue(`esgst_discussions`);
                }
                if (typeof getValue(`tickets`) === `undefined`) {
                    setValue(`tickets`, getValue(`esgst_tickets`, `{}`));
                    delValue(`esgst_tickets`);
                }
                delValue(`esgst_gFix`);
                delValue(`esgst_dFix`);
                delValue(`esgst_tFix`);
                if (typeof getValue(`groups`) === `undefined`) {
                    setValue(`groups`, getValue(`esgst_groups`, `[]`));
                    delValue(`esgst_groups`);
                }
                esgst.groups = JSON.parse(getValue(`groups`));
                if (typeof getValue(`entries`) === `undefined`) {
                    setValue(`entries`, getValue(`esgst_entries`, `[]`));
                    delValue(`esgst_entries`);
                }
                if (typeof getValue(`rerolls`) === `undefined`) {
                    setValue(`rerolls`, getValue(`esgst_rerolls`, `[]`));
                    delValue(`esgst_rerolls`);
                }
                esgst.rerolls = JSON.parse(getValue(`rerolls`));
                if (typeof getValue(`winners`) === `undefined`) {
                    setValue(`winners`, getValue(`esgst_winners`, `{}`));
                    delValue(`esgst_winners`);
                }
                esgst.winners = JSON.parse(getValue(`winners`));
            } else {
                if (!getValue(`trades`)) {
                    setValue(`trades`, getValue(`esgst_trades`, `{}`));
                    delValue(`esgst_trades`);
                }
                delValue(`esgst_tFix`);
            }
            esgst.games = getValue(`games`);
            if (typeof esgst.games === `undefined`) {
                setValue(`games`, `
                    {
                        "apps": {},
                        "subs": {}
                    }
                `);
                esgst.games = {
                    apps: {},
                    subs: {}
                };
            } else {
                esgst.games = JSON.parse(esgst.games);
            }
            esgst.values = {};
            esgst.features = [
                {
                    id: `esgst`,
                    name: `Enable ESGST for SteamTrades.`,
                    st: true,
                    type: `other`
                },
                {
                    id: `autoSync`,
                    name: `Automatically sync games/groups when syncing through SG.`,
                    sg: true,
                    type: `other`
                },
                {
                    description: `
                        <ul>
                            <li>With this enabled, you no longer have to sync your whitelist/blacklist every time you add/remove a user to/from those lists.</li>
                        </ul>
                    `,
                    id: `updateWhitelistBlacklist`,
                    name: `Automatically update whitelist/blacklist when adding/removing a user to/from those lists.`,
                    sg: true,
                    type: `other`
                },
                {
                    id: `openSettingsInTab`,
                    name: `Open settings menu in a separate tab.`,
                    sg: true,
                    st: true,
                    type: `other`
                },
                {
                    id: `enableByDefault`,
                    name: `Enable new features and functionalities by default.`,
                    sg: true,
                    st: true,
                    type: `other`
                },
                {
                    id: `showChangelog`,
                    name: `Show changelog from the new version when updating.`,
                    sg: true,
                    st: true,
                    type: `other`
                },
                {
                    id: `checkVersionMain`,
                    name: `Check whether or not you are on the current version when visiting the main discussions page if the ESGST discussion is in the current page.`,
                    sg: true,
                    type: `other`
                },
                {
                    id: `checkVersion`,
                    name: `Check whether or not you are on the current version when visiting the ESGST discussion.`,
                    sg: true,
                    type: `other`
                },
                {
                    description: `
                        <p>Before:</p>
                        <img src="http://i.imgur.com/5QVoZGO.png"/>
                        <p>After:</p>
                        <img src="http://i.imgur.com/gkwzYuS.png"/>
                    `,
                    features: [
                        {
                            id: `hideButtons_as`,
                            name: `Archive Searcher Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_cs`,
                            name: `Comment Searcher`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_ctGo`,
                            name: `Comment Tracker Button - Go to first unread.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_ctRead`,
                            name: `Comment Tracker Button - Read all.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_ctUnread`,
                            name: `Comment Tracker Button - Unread all.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_df`,
                            name: `Discussion Filters Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_ds`,
                            name: `Discussions Sorter Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_esPause`,
                            name: `Endless Scrolling Button - Pause/Resume`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_esRefresh`,
                            name: `Endless Scrolling Button - Refresh`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_esRefreshAll`,
                            name: `Endless Scrolling Button - Refresh All`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_esTop`,
                            name: `Endless Scrolling Button - Scroll To Top`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_gas`,
                            name: `Giveaways Sorter Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_gf`,
                            name: `Giveaway Filters Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_gm`,
                            name: `Giveaways Manager Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_gts`,
                            name: `Giveaway Templates Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_gv`,
                            name: `Grid View Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_hgr`,
                            name: `Hidden Games Remover Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_mpp`,
                            name: `Main Post Popup Button`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_mtGames`,
                            name: `Multi-Tag Button - Games`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_mtUsers`,
                            name: `Multi-Tag Button - Users`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_namwc`,
                            name: `Not Activated/Multiple Wins Checker Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_rbp`,
                            name: `Reply Box Popup Button`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hideButtons_sks`,
                            name: `Sent Keys Searcher Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_tb`,
                            name: `Trades Bumper Button`,
                            st: true
                        },
                        {
                            id: `hideButtons_ge`,
                            name: `Giveaways Extractor Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_ugs`,
                            name: `Unsent Gifts Sender Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_wbc`,
                            name: `Whitelist/Blacklist Checker Button`,
                            sg: true
                        },
                        {
                            id: `hideButtons_wbcAsc`,
                            name: `Whitelist/Blacklist Sorter Button - Ascending`,
                            sg: true
                        },
                        {
                            id: `hideButtons_wbcDesc`,
                            name: `Whitelist/Blacklist Sorter Button - Descending`,
                            sg: true
                        }
                    ],
                    id: `hideButtons`,
                    name: `Hide buttons at the left/right sides of the main page heading to reduce used space.`,
                    sg: true,
                    st: true,
                    type: `other`
                },
                {
                    description: `
                        <ul>
                            <li>Performs specific tasks when certain keys are pressed.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `sk_cp`,
                            input: `sk_closePopups`,
                            name: `Close all currently opened popups.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `sk_sb`,
                            input: `sk_searchBox`,
                            name: `Focus on the search box.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `sk_fp`,
                            input: `sk_firstPage`,
                            name: `Go to the first page.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `sk_pp`,
                            input: `sk_previousPage`,
                            name: `Go to the previous page.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `sk_np`,
                            input: `sk_nextPage`,
                            name: `Go to the next page.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `sk_lp`,
                            input: `sk_lastPage`,
                            name: `Go to the last page.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `sk_tf`,
                            input: `sk_toggleFilters`,
                            name: `Toggle the giveaway filters.`,
                            sg: true
                        },
                        {
                            id: `sk_hg`,
                            input: `sk_hideGame`,
                            name: `Hide the game when inside of a giveaway.`,
                            sg: true
                        },
                        {
                            id: `sk_hga`,
                            input: `sk_hideGiveaway`,
                            name: `Hide the giveaway when inside of a giveaway.`,
                            sg: true
                        },
                        {
                            id: `sk_ge`,
                            input: `sk_giveawayEntry`,
                            name: `Enter/leave the giveaway when inside of a giveaway.`,
                            sg: true
                        },
                        {
                            id: `sk_c`,
                            input: `sk_creator`,
                            name: `Insert the username of the creator of the giveaway/discussion/trade to the current reply box.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `sk_rb`,
                            input: `sk_replyBox`,
                            name: `Focus on the reply box.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `sk_ru`,
                            input: `sk_replyUser`,
                            name: `Insert the username of the user to whom you are replying to the current reply box.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `sk_sr`,
                            input: `sk_submitReply`,
                            name: `Submit the current reply.`,
                            sg: true,
                            st: true
                        }
                    ],
                    id: `sk`,
                    load: loadSk,
                    name: `Shortcut Keys`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Brings back image borders to SG.</li>
                        </ul>
                    `,
                    id: `ib`,
                    load: loadIb,
                    name: `Image Borders`,
                    sg: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Allows the header to stay fixed at the top while you scroll down the page.</li>
                        </ul>
                    `,
                    id: `fh`,
                    load: loadFh,
                    name: `Fixed Header`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Allows the sidebar to stay fixed at the side while you scroll down the page.</li>
                        </ul>
                    `,
                    id: `fs`,
                    load: loadFs,
                    name: `Fixed Sidebar`,
                    sg: true,
                    type: `general`,
                },
                {
                    description: `
                        <ul>
                            <li>Allows the main page heading to stay fixed at the top while you scroll down the page.</li>
                        </ul>
                    `,
                    id: `fmph`,
                    load: loadFmph,
                    name: `Fixed Main Page Heading`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Allows the footer to stay fixed at the bottom while you scroll down the page.</li>
                        </ul>
                    `,
                    id: `ff`,
                    load: loadFf,
                    name: `Fixed Footer`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Refreshes the header icons (created/won/messages for SG and messages for ST) and the points on SG every specified number of minutes.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `hr_b`,
                            name: `Keep refreshing in the background when you go to another tab or minimize the browser.`,
                            sg: true,
                            st: true
                        },
                        {
                            description: `
                                <ul>
                                    <li>A heart icon will appear in the title.</li>
                                </ul>
                            `,
                            features: [
                                {
                                    id: `hr_w_n`,
                                    name: `[NEW] Also show as a browser notification.`,
                                    sg: true
                                }
                            ],
                            id: `hr_w`,
                            name: `Indicate if there are unentered wishlist giveaways open.`,
                            sg: true
                        },
                        {
                            description: `
                                <ul>
                                    <li>A trophy icon will appear in the title.</li>
                                </ul>
                            `,
                            features: [
                                {
                                    id: `hr_g_n`,
                                    name: `[NEW] Also show as a browser notification.`,
                                    sg: true
                                }
                            ],
                            id: `hr_g`,
                            name: `Indicate if there are unviewed keys for won gifts in the tab title.`,
                            sg: true
                        },
                        {
                            features: [
                                {
                                    id: `hr_m_n`,
                                    name: `[NEW] Also show as a browser notification.`,
                                    sg: true,
                                    st: true
                                }
                            ],
                            id: `hr_m`,
                            name: `Show the number of unread messages in the tab icon.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `hr_p`,
                            name: `Show the number of points in the tab title.`,
                            sg: true
                        },
                    ],
                    id: `hr`,
                    input: true,
                    load: loadHr,
                    name: `Header Refresher`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Shows your level progress in the main button of the page.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/5226f7a5e2012c40d201d9d2a44f19dd9df8ab18/687474703a2f2f696d6775722e636f6d2f524a6d436e70522e706e67"/>
                    `,
                    id: `lpv`,
                    load: loadLpv,
                    name: `Level Progress Visualizer`,
                    sg: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to tag multiple users/games at the same time.</li>
                        </ul>
                    `,
                    id: `mt`,
                    name: `Multi-Tag`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Transforms every magnifying glass in search fields into buttons.</li>
                        </ul>
                    `,
                    id: `smgb`,
                    load: loadSmgb,
                    name: `Search Magnifying Glass Button`,
                    sg: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Moves the pagination navigation to the top of the page.</li>
                        </ul>
                    `,
                    id: `pnot`,
                    load: loadPnot,
                    name: `Pagination Navigation On Top`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Adds a "Last Page" link to some places that are missing it, for example: discussion pages with 100+ pages, user pages, group pages with 100+ pages.</li>
                        </ul>
                    `,
                    id: `lpl`,
                    load: loadLpl,
                    name: `Last Page Link`,
                    sg: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Opens the attached images in a carousel.</li>
                        </ul>
                        <img src="http://imgur.com/iJjAs3W.png"/>
                    `,
                    id: `aic`,
                    load: loadAic,
                    name: `Attached Images Carousel`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Shows all attached images by default.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/e12760aaef77b2d9f6832190291ca43fab1d0622/687474703a2f2f692e696d6775722e636f6d2f496f5a374a684b2e706e67"/>
                    `,
                    features: [
                        {
                            id: `vai_gifv`,
                            name: `Rename .gifv images to .gif, so they are properly attached.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `vai_i`,
                            name: `Disable for the inbox page.`,
                            sg: true,
                            st: true
                        }
                    ],
                    id: `vai`,
                    load: loadVai,
                    name: `Visible Attached Images`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Embeds YouTube and Vimeo videos into the page.</li>
                        </ul>
                        <p>Videos are only embedded if they are the only content in a line. For example:</p>
                        <ul>
                            <li>[Orange Sphincter To The Rescue](https://www.youtube.com/watch?v=cD1e0BNNifk) -> Gets embedded.</li>
                            <li>I watched [https://www.youtube.com/watch?v=cD1e0BNNifk](https://www.youtube.com/watch?v=cD1e0BNNifk) and it was hilarious. -> Does not get embedded.</li>
                        </ul>
                    `,
                    id: `ev`,
                    load: loadEv,
                    name: `Embedded Videos`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Shows accurate timestamps. For example, "1/1/2017, 0:00:00 AM" instead of "2 hours ago".</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `at_24`,
                            name: `Use a 24-hour clock.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `at_s`,
                            name: `Show seconds.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `at_g`,
                            name: `Enable for giveaways in the main page.`,
                            sg: true
                        }
                    ],
                    id: `at`,
                    name: `Accurate Timestamps`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Hides the community poll.</li>
                        </ul>
                    `,
                    features :[
                        {
                            id: `hcp_v`,
                            name: `Only hide the poll if you already voted.`,
                            sg: true
                        }
                    ],
                    id: `hcp`,
                    load: loadHcp,
                    name: `Hidden Community Poll`,
                    sg: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Hides blacklist stats in the stats page.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/96accb906d4bb1554a2f9ddfaeb0abce1b54b808/687474703a2f2f692e696d6775722e636f6d2f794233705153492e706e67"/>
                    `,
                    id: `hbs`,
                    load: loadHbs,
                    name: `Hidden Blacklist Stats`,
                    sg: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Keeps track of your visited giveaways/discussions/tickets/trades and fades them.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `gdttt_g`,
                            name: `Fade visited giveaways.`,
                            sg: true
                        },
                        {
                            id: `gdttt_v`,
                            name: `Mark the pages as visited when visiting them.`,
                            sg: true,
                            st: true
                        }
                    ],
                    id: `gdttt`,
                    load: loadGdttt,
                    name: `Giveaways/Discussions/Tickets/Trades Tracker`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to sort tables.</li>
                        </ul>
                        <img src="http://i.imgur.com/hmWWriM.png"/>
                    `,
                    id: `ts`,
                    name: `Tables Sorter`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Hides the featured container in the main pages.</li>
                        </ul>
                    `,
                    id: `hfc`,
                    name: `Hidden Featured Container`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to quickly go to wishlist/recommended/group/new giveaways from any page.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/e831648032c40835a77ba90a0cad0a38be1ca9e2/687474703a2f2f696d6775722e636f6d2f4e4467717a466a2e706e67"/>
                    `,
                    id: `qgb`,
                    load: loadQgb,
                    name: `Quick Giveaway Browsing`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to easily search giveaways using SG's <a href="https://www.steamgifts.com/discussion/8SzdT/">search parameters</a>.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/bf5009c96f65689933567f1a34718682533b7836/687474703a2f2f692e696d6775722e636f6d2f5248596d4147732e706e67"/>
                    `,
                    id: `ags`,
                    name: `Advanced Giveaway Search`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to sort giveaways.</li>
                        </ul>
                    `,
                    id: `gas`,
                    name: `Giveaways Sorter`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Shows giveaways as a grid.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/daaefaee73d0f1f51fb7f830064cdd97d0455998/687474703a2f2f692e696d6775722e636f6d2f6a6864316d34412e706e67"/>
                    `,
                    features: [
                        {
                            id: `gv_gb`,
                            name: `Extend to Giveaway Bookmarks.`,
                            sg: true
                        },
                        {
                            id: `gv_ged`,
                            name: `Extend to Giveaway Encrypter / Decrypter.`,
                            sg: true
                        },
                        {
                            id: `gv_ge`,
                            name: `Extend to Giveaways Extractor.`,
                            sg: true
                        }
                    ],
                    id: `gv`,
                    name: `Grid View`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to filter giveaways.</li>
                            <li>Supports Game Categories.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/d302b8f1a79edae54fd32c943201f452e6378802/687474703a2f2f692e696d6775722e636f6d2f457a344e794d6d2e706e67"/>
                    `,
                    features: [
                        {
                            description: `
                                <ul>
                                    <li>Hidden giveaways can be unhidden through the settings menu.</li>
                                </ul>
                            `,
                            id: `gf_h`,
                            name: `Enable the option to hide giveaways.`,
                            sg: true
                        },
                        {
                            id: `gf_level`,
                            name: `Level`,
                            sg: true
                        },
                        {
                            id: `gf_entries`,
                            name: `Entries`,
                            sg: true
                        },
                        {
                            id: `gf_copies`,
                            name: `Copies`,
                            sg: true
                        },
                        {
                            id: `gf_points`,
                            name: `Points`,
                            sg: true
                        },
                        {
                            id: `gf_minutesToEnd`,
                            name: `Minutes To End`,
                            sg: true
                        },
                        {
                            id: `gf_chance`,
                            name: `Chance`,
                            sg: true
                        },
                        {
                            id: `gf_rating`,
                            name: `Rating`,
                            sg: true
                        },
                        {
                            id: `gf_pinned`,
                            name: `Pinned`,
                            sg: true
                        },
                        {
                            id: `gf_group`,
                            name: `Group`,
                            sg: true
                        },
                        {
                            id: `gf_whitelist`,
                            name: `Whitelist`,
                            sg: true
                        },
                        {
                            id: `gf_regionRestricted`,
                            name: `Region Restricted`,
                            sg: true
                        },
                        {
                            id: `gf_created`,
                            name: `Created`,
                            sg: true
                        },
                        {
                            id: `gf_received`,
                            name: `Received`,
                            sg: true
                        },
                        {
                            id: `gf_notReceived`,
                            name: `Not Received`,
                            sg: true
                        },
                        {
                            id: `gf_awaitingFeedback`,
                            name: `Awaiting Feedback`,
                            sg: true
                        },
                        {
                            id: `gf_entered`,
                            name: `Entered`,
                            sg: true
                        },
                        {
                            id: `gf_started`,
                            name: `Started`,
                            sg: true
                        },
                        {
                            id: `gf_ended`,
                            name: `Ended`,
                            sg: true
                        },
                        {
                            id: `gf_deleted`,
                            name: `Deleted`,
                            sg: true
                        },
                        {
                            id: `gf_owned`,
                            name: `Owned`,
                            sg: true
                        },
                        {
                            id: `gf_wishlisted`,
                            name: `Wishlisted`,
                            sg: true
                        },
                        {
                            id: `gf_hidden`,
                            name: `Hidden`,
                            sg: true
                        },
                        {
                            id: `gf_ignored`,
                            name: `Ignored`,
                            sg: true
                        },
                        {
                            id: `gf_previouslyEntered`,
                            name: `[NEW] Previously Entered`,
                            sg: true
                        },
                        {
                            id: `gf_previouslyWon`,
                            name: `[NEW] Previously Won`,
                            sg: true
                        },
                        {
                            id: `gf_fullCV`,
                            name: `Full CV`,
                            sg: true
                        },
                        {
                            id: `gf_reducedCV`,
                            name: `Reduced CV`,
                            sg: true
                        },
                        {
                            id: `gf_noCV`,
                            name: `No CV`,
                            sg: true
                        },
                        {
                            id: `gf_removed`,
                            name: `Removed`,
                            sg: true
                        },
                        {
                            id: `gf_tradingCards`,
                            name: `Trading Cards`,
                            sg: true
                        },
                        {
                            id: `gf_achievements`,
                            name: `Achievements`,
                            sg: true
                        },
                        {
                            id: `gf_multiplayer`,
                            name: `Multiplayer`,
                            sg: true
                        },
                        {
                            id: `gf_steamCloud`,
                            name: `Steam Cloud`,
                            sg: true
                        },
                        {
                            id: `gf_linux`,
                            name: `Linux`,
                            sg: true
                        },
                        {
                            id: `gf_mac`,
                            name: `Mac`,
                            sg: true
                        },
                        {
                            id: `gf_dlc`,
                            name: `DLC`,
                            sg: true
                        },
                        {
                            id: `gf_package`,
                            name: `Package`,
                            sg: true
                        },
                        {
                            id: `gf_genres`,
                            name: `Genres`,
                            sg: true
                        }
                    ],
                    id: `gf`,
                    name: `Giveaway Filters`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to collapse the pinned giveaways container after expanding it.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/50049f73629b0d6dc17a41fcd52e2184d69b2035/687474703a2f2f692e696d6775722e636f6d2f6f6958644c78332e706e67"/>
                    `,
                    id: `pgb`,
                    load: loadPgb,
                    name: `Pinned Giveaways Button`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Removes SG's default fade for entered giveaways.</li>
                        </ul>
                    `,
                    id: `ueg`,
                    load: loadUeg,
                    name: `Unfaded Entered Giveaways`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to bookmark giveaways to enter later.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/a774e048e349d066cdc7b8122e3a9a58da58adc2/687474703a2f2f692e696d6775722e636f6d2f36653855794c332e706e67"/>
                    `,
                    features: [
                        {
                            description: `
                                <ul>
                                    <li>Giveaways that have not started yet will not appear in the list of bookmarked giveaways. Instead, they will stay in a sort of hidden state until they start. When they start, the header bookmark button will turn green, indicating that you must open the list of bookmarked giveaways so that the started giveaways can be updated with their end times.</li>
                                    <li>When giveaways are about to end, the button will red.</li>
                                    <li>If there are both started and ending giveaways, the button will be colored with a brown-ish color.</li>
                                    <li>Hovering over the button also gives you more details about how many giveaways have started and/or are ending.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/b049009beacaba74aa340d8c6760c39c200b8366/687474703a2f2f692e696d6775722e636f6d2f6b4e7845445a562e706e67"/>
                                <img src="https://camo.githubusercontent.com/6366d5af053ed27538ddc352a2dffb0f75da1756/687474703a2f2f692e696d6775722e636f6d2f374f41595861392e706e67"/>
                            `,
                            id: `gb_h`,
                            input: true,
                            name: `Highlight the button when giveaways have started and/or are about to end.`,
                            sg: true
                        },
                        {
                            description: `
                                <ul>
                                    <li>If disabled, ended giveaways will remain in the bookmarked list until manually unbookmarked.</li>
                                </ul>
                            `,
                            id: `gb_u`,
                            name: `Automatically unbookmark ended giveaways.`,
                            sg: true
                        }
                    ],
                    id: `gb`,
                    load: loadGb,
                    name: `Giveaway Bookmarks`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    id: `ged`,
                    load: loadGed,
                    name: `Giveaway Encrypter/Decrypter`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Highlights the number of copies in giveaways with bold and red.</li>
                        </ul>
                        <img src="http://i.imgur.com/IF32HZ5.png"/>
                    `,
                    id: `gch`,
                    name: `Giveaway Copies Highlighter`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to hide giveaways with one click.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `ochgb_f`,
                            name: `Fade hidden giveaways instead of removing them.`,
                            sg: true
                        }
                    ],
                    id: `ochgb`,
                    load: loadOchgb,
                    name: `One-Click Hide Giveaway Button`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Adds more details to the created/entered/won pages, such as the number of points, the link to the Steam store page of the game, the name of the creator, the type of the giveaway and the level. It also loads the giveaway groups below the giveaway if Giveaway Groups Loader is enabled.</li>
                        </ul>
                    `,
                    id: `cewgd`,
                    load: loadCewgd,
                    name: `Created/Entered/Won Giveaway Details`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Calculates your winning chance for a giveaway.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/3f161b5a39d4723ac361a93e74b7beedc3cd5cd5/687474703a2f2f692e696d6775722e636f6d2f50696235546f6d2e706e67"/>
                    `,
                    features: [
                        {
                            id: `gwc_e`,
                            name: `Show what the chance will be when you enter the giveaway instead of the current chance.`,
                            sg: true
                        },
                        {
                            description: `
                                <ul>
                                    <li>Uses an advanced formula to calculate the chance based on how long ago the giveaway was created, how many entries it currently has, and how long it is until the giveaway ends.</li>
                                </ul>
                            `,
                            features: [
                                {
                                    id: `gwc_a_b`,
                                    name: `Show the basic chance along with the advanced one (the advanced chance will appear in a parenthesis: "Basic% (Advanced%)").`,
                                    sg: true
                                }
                            ],
                            id: `gwc_a`,
                            name: `Use advanced formula.`,
                            sg: true
                        }
                    ],
                    id: `gwc`,
                    load: loadGwc,
                    name: `Giveaway Winning Chance`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Calculates your winning ratio for a giveaway.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/3f161b5a39d4723ac361a93e74b7beedc3cd5cd5/687474703a2f2f692e696d6775722e636f6d2f50696235546f6d2e706e67"/>
                    `,
                    features: [
                        {
                            id: `gwr_e`,
                            name: `Show what the ratio will be when you enter the giveaway instead of the current ratio.`,
                            sg: true
                        },
                        {
                            description: `
                                <ul>
                                    <li>Uses an advanced formula to calculate the chance based on how long ago the giveaway was created, how many entries it currently has, and how long it is until the giveaway ends.</li>
                                </ul>
                            `,
                            features: [
                                {
                                    id: `gwr_a_b`,
                                    name: `Show the basic ratio along with the advanced one (the advanced ratio will appear in a parenthesis: "Basic% (Advanced%)").`,
                                    sg: true
                                }
                            ],
                            id: `gwr_a`,
                            name: `Use advanced formula.`,
                            sg: true
                        }
                    ],
                    id: `gwr`,
                    load: loadGwr,
                    name: `Giveaway Winning Ratio`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Same popup from Enter/Leave Giveaway Button, except it doesn't enter the giveaway before opening the popup, which allows you to see the giveaway description or add a comment to the giveaway without entering it.</li>
                        </ul>
                        <img src="https://i.imgur.com/HV3SfSx.png"/>
                    `,
                    id: `gp`,
                    load: loadGp,
                    name: `Giveaway Popup`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to quickly enter giveaways from any page.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `elgb_c`,
                            name: `Cache repeated descriptions from the same creator for 1 hour and only show them once.`,
                            sg: true
                        },
                        {
                            id: `elgb_f`,
                            input: true,
                            name: `Filter out useless descriptions.`,
                            sg: true
                        },
                        {
                            description: `
                                <ul>
                                    <li>Only shows the enter button in popups (Giveaway Encrypter/Decrypter, Giveaways Extractor, etc...), basically any giveaway that is loaded dynamically by the script.</li>
                                </ul>
                            `,
                            id: `elgb_p`,
                            name: `Only enable for popups.`,
                            sg: true
                        },
                        {
                            features: [
                                {
                                    id: `elgb_r_d`,
                                    name: `Only pop up if the giveaway has a description.`,
                                    sg: true
                                }
                            ],
                            id: `elgb_r`,
                            name: `Pop up a box to reply to the giveaway when entering.`,
                            sg: true
                        }
                    ],
                    id: `elgb`,
                    load: loadElgb,
                    name: `Enter/Leave Giveaway Button`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to easily see the list of groups for a giveaway.</li>
                            <li>Groups that you are a member of are highlighted.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/47417953189500c9f18a5d30bf528e1b8ce30342/687474703a2f2f692e696d6775722e636f6d2f504e37337068762e706e67"/>
                    `,
                    features: [
                        {
                            id: `ggl_m`,
                            name: `Only show groups that you're a member of.`,
                            sg: true
                        },
                        {
                            id: `ggl_p`,
                            name: `Only load groups after clicking the group icon in the giveaway, as a popup.`,
                            sg: true
                        }
                    ],
                    id: `ggl`,
                    load: loadGgl,
                    name: `Giveaway Groups Loader`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Adds a link to the winners page of ended giveaways.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/c7253c39157cbde30b3337b90267260de33e4cab/687474703a2f2f692e696d6775722e636f6d2f67326b614644392e706e67"/>
                    `,
                    id: `gwl`,
                    name: `Giveaway Winners Link`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Adds an icon to ended giveaways with 0 entries in your profile or inside of the giveaways that allows you to recreate those giveaways.</li>
                        </ul>
                        <img src="http://i.imgur.com/DReWyEi.png"/>
                    `,
                    features: [
                        {
                            id: `gr_r`,
                            name: `Remove the button for giveaways that have been recreated.`,
                            sg: true
                        }
                    ],
                    id: `gr`,
                    name: `Giveaway Recreator`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to save giveaway templates for later use.</li>
                        </ul>
                    `,
                    id: `gts`,
                    name: `Giveaway Templates`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to create multiple giveaways or a train of giveaways (multiple giveaways that are linked to one another).</li>
                            <li>You can view detailed information about a giveaway by hovering over it.</li>
                            <li>You can re-order/remove the giveaways by dragging and dropping them in the correspondent areas.</li>
                            <li>All giveaways will be created without reviewing or validating, so make sure all fields are filled correctly, or the giveaway creation will fail (if a train is being created, the failed giveaway will be disconnected and the previous giveaway will be connected to the next instead).</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/1b21ba088a8cdeefbc8787636e7084eddb1c5b84/687474703a2f2f692e696d6775722e636f6d2f5066396a37674e2e706e67"/>
                    `,
                    id: `mgc`,
                    load: loadMgc,
                    name: `Multiple Giveaways Creator`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to sticky countries so that they appear at the top of the country list while creating a giveaway.</li>
                        </ul>
                    `,
                    id: `sgac`,
                    load: loadSgac,
                    name: `Stickied Giveaway Countries`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to sticky groups so that they appear at the top of the group list while creating a giveaway.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/171d8b4db67798b71e9d758ae1e25e5314c5dd4b/687474703a2f2f692e696d6775722e636f6d2f3551654b4f37652e706e67"/>
                    `,
                    id: `sgg`,
                    load: loadSgg,
                    name: `Stickied Giveaway Groups`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    decription: `
                        <ul>
                            <li>Calculates how much real CV you should get for a giveaway.</li>
                            <li>It's only accurate if you have synced the reduced CV/no CV lists from the settings menu and also scanned your sent giveaways using User Giveaways Data. But even then, it's only 100% accurate if the user has 0 not received giveaways, since User Giveaways Data doesn't currently know if the giveaways have been received or not.</li>
                        </ul>
                        <p>In the example below, as I had previously given away 3 copies of Max Payne 3, the sixth copy is worth 10% less (18P). So the 3 new copies would equal 58P:</p>
                        <img src="https://camo.githubusercontent.com/7b57fc903dddbf988ec3b700412fbfcd16bfed3a/687474703a2f2f692e696d6775722e636f6d2f6f4347537455712e706e67"/>
                    `,
                    id: `rcvc`,
                    load: loadRcvc,
                    name: `Real CV Calculator`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to send all your unsent gifts directly from your created page.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/2c54c2015bc7bd8c3aa5f79afa3a4065e4d6e94a/687474703a2f2f692e696d6775722e636f6d2f363977626b55502e706e67"/>
                    `,
                    id: `ugs`,
                    name: `Unsent Gifts Sender`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to search all your sent giveaways for certain keys to check if you have already made giveaways with those keys.</li>
                            <li>Allows you to export all keys you ever sent to a text file.</li>
                        </ul>
                    `,
                    id: `sks`,
                    name: `Sent Keys Searcher`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to manage your created giveaways by exporting them to specific formats and searching & replacing something in their description.</li>
                        </ul>
                        <img src="http://i.imgur.com/fSBKj9Z.png"/>
                    `,
                    id: `gm`,
                    name: `Giveaways Manager`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Tracks your entries and allows you to see your average/history.</li>
                        </ul>
                        <img src="http://i.imgur.com/HfLPZTd.png"/>
                        <img src="http://i.imgur.com/d9YgvBp.png"/>
                    `,
                    id: `et`,
                    name: `Entries Tracker`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to remove owned games from the <a href="https://www.steamgifts.com/account/settings/giveaways/filters">hidden list</a>.</li>
                        </ul>
                        <img src="http://i.imgur.com/a653YCb.png"/>
                    `,
                    id: `hgr`,
                    name: `Hidden Games Remover`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to easily activate won games.</li>
                            <li>The key is automatically copied when clicking the button.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/e16ae91d578df91e788ec62ea9623984b71247b9/687474703a2f2f692e696d6775722e636f6d2f30686e593079442e706e67"/>
                    `,
                    id: `sal`,
                    load: loadSal,
                    name: `Steam Activation Links`,
                    options: {
                        title: `Show links to:`,
                        values: [`Steam Client`, `Browser`, `Both`]
                    },
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Disables the enter button for giveaways for games that you have hidden.</li>
                        </ul>
                    `,
                    id: `hgebd`,
                    name: `Hidden Games Enter Button Disabler`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Adds Is There Any Deal? info to giveaway pages, including the best current deal, the historical lowest price (optional) and the list of bundles that the game has been in, with a cache that can be updated after 24 hours since the last check.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/0d413190b988c4d78ca53abd89f4101b60693491/687474703a2f2f692e696d6775722e636f6d2f65704632616d332e706e67"/>
                    `,
                    features: [
                        {
                            id: `itadi_h`,
                            name: `Also load the historical lowest price of the game (takes longer).`,
                            sg: true
                        }
                    ],
                    id: `itadi`,
                    load: loadItadi,
                    name: `Is There Any Deal? Info`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Shows a confirmation window when trying to delete keys on the giveaway winners page.</li>
                        </ul>
                    `,
                    id: `dkc`,
                    name: `Delete Keys Confirmation`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to move across trains using hotkeys (use Ctrl with the hotkeys to open the giveaways in new tabs). Does not work if you are typing in an input/text area.</li>
                        </ul>
                    `,
                    id: `npth`,
                    load: loadNpth,
                    name: `Next/Previous Train Hotkeys`,
                    input: true,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Extracts all giveaways linked from a discussion/giveaway.</li>
                            <li>You will find the button in discussions/giveaways that have a giveaway link.</li>
                        </ul>
                    `,
                    id: `ge`,
                    load: loadGe,
                    name: `Giveaways Extractor`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    // by Royalgamer06
                    description: `
                        <ul>
                            <li>Provides search links for the game when you cannot access a giveaway.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/030a1474fdbb0b0bbc12b5e0e07937934de227eb/687474703a2f2f692e696d6775722e636f6d2f474d36625833732e706e67"/>
                    `,
                    id: `gesl`,
                    load: loadGesl,
                    name: `Giveaway Error Search Links`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to search the archive by exact title/app id.</li>
                        </ul>
                    `,
                    id: `as`,
                    name: `Archive Searcher`,
                    sg: true,
                    type: `giveaways`
                },
                {
                    description: `
                        <ul>
                            <li>Brings back SG's old active discussions design, while keeping the new Deals section.</li>
                        </ul>
                    `,
                    id: `oadd`,
                    name: `Old Active Discussions Design`,
                    sg: true,
                    type: `discussions`
                },
                {
                    description: `
                        <ul>
                            <li>Moves the active discussions to the top/sidebar of the page.</li>
                        </ul>
                        <p>More about the sidebar option:</p>
                        <ul>
                            <li>If you have Advanced Giveaway Search enabled, it will be hidden and triggered when hovering hover the search field.</li>
                            <li>The username and avatar of the user who last posted will be removed (the button to go to the last comment will remain intact).</li>
                            <li>Accurate Timestamps will not run for any timestamps inside the active discussions.</li>
                            <li>Any user tags you might have saved for users will be hidden inside the active discussions (they will still be visible if you click the tag button to edit them).</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/9f0ebf4ffbf3489529819653853c6cc725cc0047/687474703a2f2f692e696d6775722e636f6d2f584565726f566e2e706e67"/>
                    `,
                    id: `adots`,
                    name: `Active Discussions On Top/Sidebar`,
                    options: {
                        title: `Move to:`,
                        values: [`Top`, `Sidebar`]
                    },
                    sg: true,
                    type: `discussions`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to close/open discussions without having to enter them.</li>
                        </ul>
                    `,
                    id: `codb`,
                    name: `Close/Open Discussion Button`,
                    sg: true,
                    type: `discussions`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to filter discussions.</li>
                        </ul>
                    `,
                    features: [
                        {
                            description: `
                                <ul>
                                    <li>Hidden discussions can be unhidden through the settings menu.</li>
                                </ul>
                            `,
                            id: `df_h`,
                            name: `Enable the option to hide discussions.`,
                            sg: true
                        },
                        {
                            id: `df_comments`,
                            name: `Comments`,
                            sg: true
                        },
                        {
                            id: `df_announcements`,
                            name: `Announcements`,
                            sg: true
                        },
                        {
                            id: `df_bugsSuggestions`,
                            name: `Bugs / Suggestions`,
                            sg: true
                        },
                        {
                            id: `df_deals`,
                            name: `Deals`,
                            sg: true
                        },
                        {
                            id: `df_general`,
                            name: `General`,
                            sg: true
                        },
                        {
                            id: `df_groupRecruitment`,
                            name: `Group Recruitment`,
                            sg: true
                        },
                        {
                            id: `df_letsPlayTogether`,
                            name: `Let's Play Together`,
                            sg: true
                        },
                        {
                            id: `df_offTopic`,
                            name: `Off-Topic`,
                            sg: true
                        },
                        {
                            id: `df_puzzles`,
                            name: `Puzzles`,
                            sg: true
                        },
                        {
                            id: `df_uncategorized`,
                            name: `Uncategorized`,
                            sg: true
                        },
                        {
                            id: `df_created`,
                            name: `Created`,
                            sg: true
                        },
                        {
                            id: `df_poll`,
                            name: `Poll`,
                            sg: true
                        },
                        {
                            id: `df_highlighted`,
                            name: `Highlighted`,
                            sg: true
                        },
                        {
                            id: `df_visited`,
                            name: `Visited`,
                            sg: true
                        },
                        {
                            id: `df_unread`,
                            name: `Unread`,
                            sg: true
                        }
                    ],
                    id: `df`,
                    name: `Discussion Filters`,
                    sg: true,
                    type: `discussions`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to sort discussions by creation date (from newest to oldest).</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/9fd9d276d5c6fc9377b2b9f36fe69c8d4d39562d/687474703a2f2f692e696d6775722e636f6d2f704d416f5671392e706e67"/>
                    `,
                    id: `ds`,
                    name: `Discussions Sorter`,
                    sg: true,
                    type: `discussions`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to highlight discussions.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/62f0877abb79ad392f24d92bc096c947398f9344/687474703a2f2f692e696d6775722e636f6d2f41326f313479772e706e67"/>
                    `,
                    features: [
                        {
                            id: `dh_t`,
                            name: `Bring the highlighted discussions to the top of the page if there are any in the current page.`,
                            sg: true
                        }
                    ],
                    id: `dh`,
                    load: loadDh,
                    name: `Discussions Highlighter`,
                    sg: true,
                    type: `discussions`
                },
                {
                    description: `
                        <ul>
                            <li>Skips to the comments of a discussion if you've used pagination navigation. For example, you enter a discussion and go to page 2, on page 2 the feature will skip the main post and take you directly to the comments.</li>
                        </ul>
                    `,
                    id: `mps`,
                    load: loadMps,
                    name: `Main Post Skipper`,
                    sg: true,
                    type: `discussions`
                },
                {
                    description: `
                        <ul>
                            <li>Hides the main post of discussions and adds a button that pops it up.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/8bc51996cbe378add7adecf071cdc747a711e384/687474703a2f2f692e696d6775722e636f6d2f6c4139514e4c4d2e706e67"/>
                    `,
                    features: [
                        {
                            id: `mpp_r`,
                            name: `Only hide the main post if it has been marked as read (requires Comment Tracker).`,
                            sg: true
                        }
                    ],
                    id: `mpp`,
                    name: `Main Post Popup`,
                    sg: true,
                    type: `discussions`
                },
                {
                    description: `
                        <ul>
                            <li>Detects if the discussion you're posting a comment to has been edited since the time you opened it and saves your comment correctly.</li>
                            <li>This fixes a bug on SteamGifts that does not save your comment to a discussion if you submit it after the discussion has been edited.</li>
                            <li>The feature also replaces every single native "Submit" button with its own "Submit" button, to gather info about comments when posting, which is required for some comment features, like Comment History.</li>
                        </ul>
                    `,
                    id: `ded`,
                    load: loadDed,
                    name: `Discussion Edits Detector`,
                    sg: true,
                    st: true,
                    type: `discussions`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to bump all your current trades with a single click.</li>
                            <li>You will find the button in you created trades page.</li>
                        </ul>
                    `,
                    features: [
                        {
                            description: `
                                <ul>
                                    <li>Auto bumps all your trades every hour.</li>
                                    <li>Requires you to leave SG or ST open.</li>
                                </ul>
                            `,
                            id: `tb_a`,
                            name: `Auto bump every hour.`,
                            sg: true,
                            st: true
                        }
                    ],
                    id: `tb`,
                    name: `Trades Bumper`,
                    sg: true,
                    st: true,
                    type: `trades`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to collapse/expand all replies (level 2+ comments) in a page.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `cerb_a`,
                            name: `Automatically collapse all replies when visiting a page.`,
                            sg: true,
                            st: true
                        }
                    ],
                    id: `cerb`,
                    load: loadCerb,
                    name: `Collapse/Expand Replies Button`,
                    sg: true,
                    st: true,
                    type: `comments`
                },
                {
                    description: `
                        <ul>
                            <li>Adds a mention link to the comment replied to.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/696ce80a48aa3b78f15dc9deb856fa321a88fd68/687474703a2f2f692e696d6775722e636f6d2f5367457a6a58432e706e67"/>
                    `,
                    id: `rml`,
                    load: loadRml,
                    name: `Reply Mention Link`,
                    sg: true,
                    st: true,
                    type: `comments`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to search a giveaway/discussion/ticket/trade for comments from specific users.</li>
                        </ul>
                        <img src="http://i.imgur.com/KpcVxXk.png"/>
                        <img src="http://i.imgur.com/y0QykIf.png"/>
                    `,
                    id: `cs`,
                    name: `Comment Searcher`,
                    sg: true,
                    st: true,
                    type: `comments`
                },
                {
                    description: `
                        <ul>
                            <li>Adds a panel that helps you with comment formatting.</li>
                            <li>Has an option that automatically formats pasted links/images.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/b542cdc0dfcc08a52936603e1da2dcc855ebd33a/687474703a2f2f692e696d6775722e636f6d2f673943336530672e706e67"/>
                    `,
                    features: [
                        {
                            id: `cfh_i`,
                            name: `Italic`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_b`,
                            name: `Bold`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_s`,
                            name: `Spoiler`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_st`,
                            name: `Strikethrough`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_h1`,
                            name: `Heading 1`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_h2`,
                            name: `Heading 2`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_h3`,
                            name: `Heading 3`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_bq`,
                            name: `Blockquote`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_lb`,
                            name: `Line Break`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_ol`,
                            name: `Ordered List`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_ul`,
                            name: `Unordered List`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_ic`,
                            name: `Inline Code`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_lc`,
                            name: `Line Code`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_pc`,
                            name: `Paragraph Code`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_l`,
                            name: `Link`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_img`,
                            name: `Image`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_t`,
                            name: `Table`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_e`,
                            name: `Emojis`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `cfh_g`,
                            name: `Giveaway Encrypter`,
                            sg: true,
                            st: true
                        },
                        {
                            description: `
                                <ul>
                                    <li>Allows you to save replies that you constantly use to quickly post them later.</li>
                                    <img src="http://i.imgur.com/lJJDNah.png"/>
                                </ul>
                            `,
                            id: `cfh_sr`,
                            name: `Saved Replies`,
                            sg: true,
                            st: true
                        }
                    ],
                    id: `cfh`,
                    load: loadCfh,
                    name: `Comment Formatting Helper`,
                    sg: true,
                    st: true,
                    type: `comments`
                },
                {
                    description: `
                        <ul>
                            <li>Moves the reply box to the top of the page.</li>
                        </ul>
                    `,
                    id: `rbot`,
                    load: loadRbot,
                    name: `Reply Box On Top`,
                    sg: true,
                    st: true,
                    type: `comments`
                },
                {
                    description: `
                        <ul>
                            <li>Pops up a reply box when marking a giveaway as received.</li>
                        </ul>
                    `,
                    id: `rrbp`,
                    name: `Received Reply Box Popup`,
                    sg: true,
                    type: `comments`
                },
                {
                    description: `
                        <ul>
                            <li>Adds a button that pops up a box which allows you to add comments to the page.</li>
                            <li>Has Discussion Edit Detector built-in.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/7227b3cad4190a531ee5d109303fec7fe747b65d/687474703a2f2f692e696d6775722e636f6d2f436c477a424e532e706e67"/>
                    `,
                    id: `rbp`,
                    name: `Reply Box Popup`,
                    sg: true,
                    st: true,
                    type: `comments`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to reply to multiple comments at the same time, since each comment has their own comment box and the page isn't reloaded after submitting it.</li>
                            <li>Has Discussion Edit Detector built-in.</li>
                        </ul>
                    `,
                    id: `mr`,
                    load: loadMr,
                    name: `Multi-Reply`,
                    sg: true,
                    st: true,
                    type: `comments`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to reply to your messages directly from your inbox.</li>
                            <li>Has Multi-Reply built-in.</li>
                        </ul>
                    `,
                    features: [
                        {
                            description: `
                                <ul>
                                    <li>Saves replies made from the inbox so that they are still there when you refresh the page.</li>
                                    <li>Replies are deleted from the cache after 1 week.</li>
                                    <li>Editing/deleting/undeleting a saved reply also updates its cache and makes it last 1 week longer.</li>
                                </ul>
                            `,
                            id: `rfi_s`,
                            name: `Save replies.`,
                            sg: true,
                            st: true
                        }
                    ],
                    id: `rfi`,
                    load: loadRfi,
                    name: `Reply From Inbox`,
                    sg: true,
                    st: true,
                    type: `comments`
                },
                {
                    description: `
                        <ul>
                            <li>Fades giveaways / discussions / support tickets / trades you have already visited. Note that this does not mean every comment inside the page has been read, it simply means you have visited it.</li>
                            <li>Keeps track of comments / editions.</li>
                            <li>To mark a comment as read/unread, click on the eye icon below it.</li>
                            <li>Keeps track of discussion comments and shows how many comments are unread on the discussions page.</li>
                            <li>Allows you to go to the first unread comment of a discussion or mark all its comments as read directly from the discussions page.</li>
                        </ul>
                        <img src="https://camo.githubusercontent.com/2688dcd381fc20a68c3f7d8e5c3aa4b7366efa99/687474703a2f2f692e696d6775722e636f6d2f366e414c6838792e706e67"/>
                        <img src="https://camo.githubusercontent.com/3f0bbfef8a301dcfc91bec0d62e9d20c0b6c45e9/687474703a2f2f692e696d6775722e636f6d2f554362353576692e706e67"/>
                        <img src="https://camo.githubusercontent.com/94672a1b6ebb4adeaad8c311c184ddded32f6afc/687474703a2f2f692e696d6775722e636f6d2f3866504d776a472e706e67"/>
                    `,
                    features: [
                        {
                            description: `
                                <ul>
                                    <li>Simply shows the number of comments since the last visit.</li>
                                    <li>Marking a discussion as visited with Giveaways/Discussions/Tickets/Trades Tracker will update the count without having to enter the discussion.</li>
                                    <li>Marking a discussion as unvisited will reset the count to 0.</li>
                                </ul>
                            `,
                            features: [
                                {
                                    id: `ct_s_h`,
                                    name: `Hide count if you haven't visited the discussion yet.`,
                                    sg: true,
                                    st: true
                                }
                            ],
                            id: `ct_s`,
                            name: `Enable simplified version.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `ct_a`,
                            name: `Automatically mark comments as read in the inbox when clicking on the "Mark as Read" button.`,
                            sg: true,
                            st: true
                        },
                        {
                            description: `
                                <ul>
                                    <li>Scans the page from the bottom to top if reverse scrolling is disabled, or from the top to bottom if it's enabled.</li>
                                </ul>
                            `,
                            id: `ct_r`,
                            name: `Search for the first unread comment in reverse order.`,
                            sg: true,
                            st: true
                        }
                    ],
                    id: `ct`,
                    load: loadCt,
                    name: `Comment Tracker`,
                    sg: true,
                    st: true,
                    type: `comments`
                },
                {
                    description: `
                        <ul>
                            <li>Keeps track of the comments you make (they can be seen from header menu).</li>
                            <li>This feature <span class="esgst-bold">only</span> works with Main Comment Box Popup, Discussion Edit Detector and Multi-Reply / Reply From Inbox. If you submit a comment though SG's native comment box, the comment will not be tracked.</li>
                        </ul>
                    `,
                    id: `ch`,
                    name: `Comment History`,
                    sg: true,
                    st: true,
                    type: `comments`
                },
                {
                    load: startCommentFeatures
                },
                {
                    description: `
                        <ul>
                            <li>Keeps track of users from the database and detects username changes every month and every time someone loads the username history of a user.</li>
                            <li>Users that are not already in the database are added when a user loads their username history.</li>
                        </ul>
                    `,
                    id: `uh`,
                    load: loadUh,
                    name: `Username History`,
                    sg: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to add notes to users.</li>
                            <li>The notes are tied to the user's Steam id, so they do not vanish when a user changes their username.</li>
                            <li>If a user has notes saved, the icon will be full. Otherwise it will be empty.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `un_p`,
                            name: `Pop up when whitelisting/blacklisting a user.`,
                            sg: true
                        }
                    ],
                    id: `un`,
                    load: loadUn,
                    name: `User Notes`,
                    sg: true,
                    st: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to filter users' giveaways, discussions and posts.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `uf_g`,
                            name: `Automatically hide giveaways from blacklisted users.`,
                            sg: true
                        },
                        {
                            id: `uf_d`,
                            name: `Automatically hide discussions from blacklisted users.`,
                            sg: true
                        },
                        {
                            id: `uf_p`,
                            name: `Automatically hide posts from blacklisted users.`,
                            sg: true
                        }
                    ],
                    id: `uf`,
                    load: loadUf,
                    name: `User Filters`,
                    sg: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to see which groups you have in common with a user.</li>
                        </ul>
                    `,
                    id: `sgc`,
                    load: loadSgc,
                    name: `Shared Groups Checker`,
                    sg: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to view the real won/sent CV of users directly from their profile.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `rwscvl_r`,
                            name: `Link SGTool's reverse page (from newest to oldest).`,
                            sg: true
                        }
                    ],
                    id: `rwscvl`,
                    load: loadRwscvl,
                    name: `Real Won/Sent CV Links`,
                    sg: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Shows data about a user's giveaways.</li>
                        </ul>
                    `,
                    id: `ugd`,
                    load: loadUgd,
                    name: `User Giveaways Data`,
                    sg: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to check if a user has any not activated/multiple wins.</li>
                        </ul>
                    `,
                    features: [
                        {
                            description: ``,
                            features: [
                                {
                                    description: ``,
                                    id: `namwc_h_i`,
                                    name: `Use icons instead of colors.`,
                                    sg: true
                                },
                                {
                                    id: `namwc_h_f`,
                                    name: `Only highlight users who failed to pass the check.`,
                                    sg: true
                                },
                                {
                                    id: `namwc_h_m`,
                                    name: `Highlight multiple wins as positive.`,
                                    sg: true
                                }
                            ],
                            id: `namwc_h`,
                            name: `Highlight checked users.`,
                            sg: true,
                            st: true
                        }
                    ],
                    id: `namwc`,
                    load: loadNamwc,
                    name: `Not Activated/Multiple Wins Checker`,
                    sg: true,
                    type: `users`
                },
                {
                    description: ``,
                    id: `nrf`,
                    load: loadNrf,
                    name: `Not Received Finder`,
                    sg: true,
                    type: `users`
                },
                {
                    description: ``,
                    id: `swr`,
                    load: loadSwr,
                    name: `Sent/Won Ratio`,
                    sg: true,
                    type: `users`
                },
                {
                    description: ``,
                    id: `luc`,
                    load: loadLuc,
                    name: `Level Up Calculator`,
                    sg: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to easily go to a user's SteamGifts profile from SteamTrades.</li>
                        </ul>
                    `,
                    id: `sgpb`,
                    load: loadSgpb,
                    name: `SteamGifts Profile Button`,
                    st: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to easily go to a user's SteamTrades profile from SteamGifts.</li>
                        </ul>
                    `,
                    id: `stpb`,
                    load: loadStpb,
                    name: `SteamTrades Profile Button`,
                    sg: true,
                    type: `users`
                },
                {
                    description: ``,
                    features: [
                        {
                            id: `wbc_b`,
                            name: `Show blacklist information.`,
                            sg: true
                        },
                        {
                            id: `wbc_h`,
                            name: `Highlight users who have whitelisted/blacklisted you.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `wbc_n`,
                            name: `Save automatic notes to users that you returned whitelist/blacklist for.`,
                            sg: true
                        }
                    ],
                    id: `wbc`,
                    load: loadWbc,
                    name: `Whitelist/Blacklist Checker`,
                    sg: true,
                    type: `users`
                },
                {
                    features: [
                        {
                            colors: true,
                            id: `wbh_w`,
                            name: `Color whitelisted users instead of adding a heart icon next to their username.`,
                            sg: true,
                            st: true
                        },
                        {
                            colors: true,
                            id: `wbh_b`,
                            name: `Color blacklisted users instead of adding a ban icon next to their username.`,
                            sg: true,
                            st: true
                        }
                    ],
                    id: `wbh`,
                    load: loadWbh,
                    name: `Whitelist/Blacklist Highlighter`,
                    sg: true,
                    st: true,
                    type: `users`
                },
                {
                    id: `wbs`,
                    name: `Whitelist/Blacklist Sorter`,
                    sg: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Adds users status to the whitelist/blacklist pages, such as last online, gifts sent, gifts won, ratio and contributor value.</li>
                        </ul>
                        <img src="http://i.imgur.com/SnWasiw.png"/>
                    `,
                    id: `us`,
                    name: `Users Stats`,
                    sg: true,
                    type: `users`
                },
                {
                    id: `iwh`,
                    load: loadIwh,
                    name: `Inbox Winners Highlighter`,
                    sg: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Highlights groups that you are a member of.</li>
                        </ul>
                    `,
                    id: `gh`,
                    load: loadGh,
                    name: `Groups Highlighter`,
                    sg: true,
                    type: `groups`
                },
                {
                    id: `gs`,
                    load: loadGs,
                    name: `Group Stats`,
                    sg: true,
                    type: `groups`
                },
                {
                    description: `
                        <ul>
                            <li>Highlights games that you have already entered giveaways for.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `egh_t`,
                            name: `Enable for discussion tables.`,
                            sg: true
                        }
                    ],
                    id: `egh`,
                    load: loadEgh,
                    name: `Entered Games Highlighter`,
                    sg: true,
                    type: `games`
                },
                {
                    features: [
                        {
                            id: `gt_t`,
                            name: `Enable for discussion tables.`,
                            sg: true
                        }
                    ],
                    id: `gt`,
                    load: loadGt,
                    name: `Game Tags`,
                    sg: true,
                    type: `games`
                },
                {
                    description: `
                        <ul>
                            <li>Shows information about games.</li>
                        </ul>
                    `,
                    features: [
                        {
                            id: `gc_b`,
                            name: `Show the category colors as a bottom border to the giveaways in Grid View.`,
                            sg: true
                        },
                        {
                            id: `gc_t`,
                            name: `Enable for discussion tables.`,
                            sg: true
                        },
                        {
                            id: `gc_il`,
                            name: `Show the panel inline (next to the game name instead of below it).`,
                            sg: true
                        },
                        {
                            colors: true,
                            description: `
                                <ul>
                                    <li>Shows how many giveaways you have already made for a game and how much CV you should get for a new giveaway.</li>
                                    <li>In order for the feature to work properly, you must scan your profile with User Giveaways Data (currently this must be done every time your giveaways end, if you want to keep it updated).</li>
                                    <li>The information is not 100% accurate because it cannot know if all the copies were sent when it comes to giveaways with multiple copies, at the moment.</li>
                                </ul>
                            `,
                            features: [
                                {
                                    id: `gc_gi_t`,
                                    name: `Only show in discussion tables.`,
                                    sg: true
                                },
                                {
                                    id: `gc_gi_cew`,
                                    name: `Only show in the created/entered/won pages.`,
                                    sg: true
                                }
                            ],
                            id: `gc_gi`,
                            name: `Giveaway Info`,
                            sg: true
                        },
                        {
                            features: [
                                {
                                    id: `gc_r_s`,
                                    name: `Show the percentage and number of reviews next to the icon.`,
                                    sg: true
                                }
                            ],
                            id: `gc_r`,
                            name: `Rating`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_fcv_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_fcv_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_fcv`,
                            input: true,
                            name: `Full CV`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_rcv_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_rcv_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_rcv`,
                            input: true,
                            name: `Reduced CV`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_ncv_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_ncv_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                },
                                {
                                    id: `gc_ncv_o`,
                                    name: `Only display "No CV" if game also has "Reduced CV".`,
                                    sg: true
                                }
                            ],
                            id: `gc_ncv`,
                            input: true,
                            name: `No CV`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_h_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_h_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_h`,
                            input: true,
                            name: `Hidden`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_i_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_i_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_i`,
                            input: true,
                            name: `Ignored`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_o_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_o_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                },
                                {
                                    id: `gc_o_t`,
                                    name: `Only show if games are owned by alt accounts in discussion tables.`,
                                    sg: true
                                }
                            ],
                            id: `gc_o`,
                            input: true,
                            name: `Owned`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_w_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_w_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_w`,
                            input: true,
                            name: `Wishlisted`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_a_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_a_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_a`,
                            input: true,
                            name: `Achievements`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_mp_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_mp_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_mp`,
                            input: true,
                            name: `Multiplayer`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_sc_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_sc_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_sc`,
                            input: true,
                            name: `Steam Cloud`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_tc_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_tc_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_tc`,
                            input: true,
                            name: `Trading Cards`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_l_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_l_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_l`,
                            input: true,
                            name: `Linux`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_m_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_m_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_m`,
                            input: true,
                            name: `Mac`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_ea_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_ea_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_ea`,
                            input: true,
                            name: `Early Access`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_rm_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_rm_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_rm`,
                            input: true,
                            name: `Removed`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_dlc_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_dlc_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_dlc`,
                            input: true,
                            name: `DLC`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    description: `
                                        <ul>
                                            <li>Shows the category initials instead of its full name.</li>
                                            <li>Not compatible with custom labels.</li>
                                        </ul>
                                    `,
                                    features: [
                                        {
                                            id: `gc_p_s_i`,
                                            name: `Use icons instead of initials.`,
                                            sg: true
                                        }
                                    ],
                                    id: `gc_p_s`,
                                    name: `Enable the simplified version.`,
                                    sg: true
                                }
                            ],
                            id: `gc_p`,
                            input: true,
                            name: `Package`,
                            sg: true
                        },
                        {
                            colors: true,
                            features: [
                                {
                                    id: `gc_g_udt`,
                                    name: `User-Defined Tags`,
                                    sg: true
                                }
                            ],
                            id: `gc_g`,
                            name: `Genres`,
                            sg: true
                        }
                    ],
                    id: `gc`,
                    name: `Game Categories`,
                    sg: true,
                    type: `games`
                },
                {
                    description: ``,
                    id: `ut`,
                    load: loadUt,
                    name: `User Tags`,
                    sg: true,
                    st: true,
                    type: `users`
                },
                {
                    description: `
                        <ul>
                            <li>Pops out user/group info when hovering their avatars.</li>
                        </ul>
                    `,
                    id: `ap`,
                    load: loadAp,
                    name: `Avatar Popout`,
                    sg: true,
                    type: `general`
                },
                {
                    load: startProfileFeatures
                },
                {
                    load: startGiveawayFeatures
                },
                {
                    load: startGameFeatures
                },
                {
                    load: startUserFeatures
                },
                {
                    description: `
                        <ul>
                            <li>Allows you to endlessly scroll through pages.</li>
                        </ul>
                    `,
                    features: [
                        {
                            features: [
                                {
                                    id: `es_g_d`,
                                    name: `Enable page divisors.`,
                                    sg: true
                                }
                            ],
                            id: `es_g`,
                            name: `Enable for giveaways in the main page.`,
                            sg: true
                        },
                        {
                            features: [
                                {
                                    id: `es_d_d`,
                                    name: `Enable page divisors.`,
                                    sg: true
                                }
                            ],
                            id: `es_d`,
                            name: `Enable for discussions/tickets.`,
                            sg: true
                        },
                        {
                            features: [
                                {
                                    id: `es_t_d`,
                                    name: `Enable page divisors.`,
                                    st: true
                                }
                            ],
                            id: `es_t`,
                            name: `Enable for trades`,
                            st: true
                        },
                        {
                            features: [
                                {
                                    id: `es_c_d`,
                                    name: `Enable page divisors.`,
                                    sg: true,
                                    st: true
                                }
                            ],
                            id: `es_c`,
                            name: `Enable for comments.`,
                            sg: true,
                            st: true
                        },
                        {
                            features: [
                                {
                                    id: `es_l_d`,
                                    name: `Enable page divisors.`,
                                    sg: true,
                                    st: true
                                }
                            ],
                            id: `es_l`,
                            name: `Enable for lists.`,
                            sg: true,
                            st: true
                        },
                        {
                            id: `es_r`,
                            name: `Enable reverse scrolling.`,
                            sg: true
                        },
                        {
                            id: `es_gb`,
                            name: `Enable for Giveaway Bookmarks.`,
                            sg: true
                        },
                        {
                            id: `es_ged`,
                            name: `Enable for Giveaway Encrypter/Decrypter.`,
                            sg: true
                        },
                        {
                            id: `es_ge`,
                            name: `Enable for Giveaways Extractor.`,
                            sg: true
                        },
                        {
                            id: `es_dh`,
                            name: `Enable for Discussions Highlighter.`,
                            sg: true
                        },
                        {
                            id: `es_ch`,
                            name: `Enable for Comment History.`,
                            sg: true
                        },
                        {
                            id: `es_gf`,
                            name: `Enable for Giveaway Filters.`,
                            sg: true
                        },
                        {
                            id: `es_df`,
                            name: `Enable for Discussion Filters.`,
                            sg: true
                        }
                    ],
                    id: `es`,
                    name: `Endless Scrolling`,
                    sg: true,
                    st: true,
                    type: `general`
                },
                {
                    description: `
                        <ul>
                            <li>Opens all links in the same tab.</li>
                        </ul>
                    `,
                    id: `sto`,
                    load: loadSto,
                    name: `Same Tab Opener`,
                    sg: true,
                    st: true,
                    type: `general`
                }
            ];
            for (var key in esgst.defaultValues) {
                esgst[key] = getSetting(key);
            }
            if (esgst.sg && !esgst.menuPath) {
                checkSync();
            }
            esgst.toExecute = [];
            for (i = 0, n = esgst.features.length; i < n; ++i) {
                loadFeature(esgst.features[i]);
            }
            delete esgst.settings.users;
            delete esgst.settings.comments;
            delete esgst.settings.giveaways;
            delete esgst.settings.groups;
            if (esgst.settings.gc_categories.length !== 20) {
                esgst.settings.gc_categories = esgst.defaultValues.gc_categories;
                esgst.gc_categories = esgst.settings.gc_categories;
            }
            setValue(`settings`, JSON.stringify(esgst.settings));
            addStyle();
            var sibling, height;                
            if (esgst.profilePath && esgst.autoSync) {
                document.getElementsByClassName(`form__sync-default`)[0].addEventListener(`click`, setSync.bind(null, true, null));
            }
            if (esgst.menuPath) {
                esgst.favicon.href = esgst.icon;
                if (esgst.settingsPath) {
                    document.title = `ESGST - Settings`;
                    loadSMMenu(true);
                } else if (esgst.importMenuPath) {
                    document.title = `ESGST - Import`;
                    loadDataManagement(true, `import`);
                } else if (esgst.exportMenuPath) {
                    document.title = `ESGST - Export`;
                    loadDataManagement(true, `export`);
                } else if (esgst.deleteMenuPath) {
                    document.title = `ESGST - Delete`;
                    loadDataManagement(true, `delete`);
                }
            } else {
                addHeaderMenu();
                checkNewVersion();
                if (esgst.oadd && esgst.giveawaysPath && esgst.activeDiscussions) {
                    loadOadd();
                } else {
                    if (esgst.adots) {
                        loadAdots();
                    }
                    loadFeatures();
                }
            }
        }
    }
}

function loadFeatures() {
    var button, button1, button2, button3, title, html, rows, mainPageHeadingBefore = document.createDocumentFragment(), mainPageHeadingAfter = document.createDocumentFragment(), hiddenButtonsBefore, hiddenButtonsBeforePopout,  hiddenButtonsAfter, hiddenButtonsAfterPopout;
    if (esgst.hideButtons) {
        hiddenButtonsBefore = document.createElement(`div`);
        hiddenButtonsBefore.className = `esgst-heading-button`;
        hiddenButtonsBefore.innerHTML = `
            <i class="fa fa-ellipsis-v"></i>
        `;
        hiddenButtonsBeforePopout = new Popout(`esgst-hidden-buttons`, hiddenButtonsBefore, 0, true);
        esgst.leftButtons = insertHtml(hiddenButtonsBeforePopout.popout, `beforeEnd`, `
            <div class="esgst-page-heading"></div>
        `);
        hiddenButtonsAfter = document.createElement(`div`);
        hiddenButtonsAfter.className = `esgst-heading-button`;
        hiddenButtonsAfter.innerHTML = `
            <i class="fa fa-ellipsis-v"></i>
        `;
        hiddenButtonsAfterPopout = new Popout(`esgst-hidden-buttons`, hiddenButtonsAfter, 0, true);
        esgst.rightButtons = insertHtml(hiddenButtonsAfterPopout.popout, `beforeEnd`, `
            <div class="esgst-page-heading"></div>
        `);
    }
    if (esgst.sg) {
        if (esgst.wbc) {
            esgst.wbcButton = button = document.createElement(`div`);
            button.className = `esgst-hidden esgst-heading-button`;
            if (esgst.wbc_b) {
                title = `Check for whitelists/blacklists.`;
                html = `
                    <i class="fa fa-heart"></i>
                    <i class="fa fa-ban"></i>
                    <i class="fa fa-question-circle"></i>
                `;
            } else {
                title = `Check for whitelists.`;
                html = `
                    <i class="fa fa-heart"></i>
                    <i class="fa fa-question-circle"></i>
                `;
            }
            button.title = title;
            button.innerHTML = html;
            if (esgst.hideButtons && esgst.hideButtons_wbc) {
                esgst.leftButtons.appendChild(button);
            } else {
                mainPageHeadingBefore.appendChild(button);
            }
            addWBCButton(true, button);
        }
    }
    if (esgst.mt) {
        var mt;
        if (esgst.ut) {
            esgst.mtUserButton = button = document.createElement(`div`);
            mt = {
                button: button,
                type: `user`
            };
            button.className = `esgst-hidden esgst-heading-button`;
            button.title = `Multi-tag users`;
            button.innerHTML = `
                <span></span>
                <span>
                    <i class="fa fa-user"></i>
                    <i class="fa fa-tags"></i>
                </span>
            `;
            toggleSwitch = new ToggleSwitch(button.firstElementChild, null, true, ``);
            toggleSwitch.onEnabled = enableMt.bind(null, mt);
            toggleSwitch.onDisabled = disableMt.bind(null, mt);
            if (esgst.hideButtons && esgst.hideButtons_mtUsers) {
                esgst.leftButtons.appendChild(button);
            } else {
                mainPageHeadingBefore.appendChild(button);
            }
            button.addEventListener(`click`, openMtPopout.bind(null, mt));
        }
        if (esgst.gf) {
            esgst.mtGameButton = button = document.createElement(`div`);
            mt = {
                button: button,
                type: `game`
            };
            button.className = `esgst-hidden esgst-heading-button`;
            button.title = `Multi-tag games`;
            button.innerHTML = `
                <span></span>
                <span>
                    <i class="fa fa-gamepad"></i>
                    <i class="fa fa-tags"></i>
                </span>
            `;
            toggleSwitch = new ToggleSwitch(button.firstElementChild, null, true, ``);
            toggleSwitch.onEnabled = enableMt.bind(null, mt);
            toggleSwitch.onDisabled = disableMt.bind(null, mt);
            if (esgst.hideButtons && esgst.hideButtons_mtGames) {
                esgst.leftButtons.appendChild(button);
            } else {
                mainPageHeadingBefore.appendChild(button);
            }
            button.lastElementChild.addEventListener(`click`, openMtPopout.bind(null, mt));
        }
    }
    if (esgst.giveawaysPath || esgst.discussionsPath) {
        if (esgst.discussionsPath && !esgst.editDiscussionPath) {
            if (esgst.df) {
                if (esgst.hideButtons && esgst.hideButtons_df) {
                    esgst.leftButtons.appendChild(addDfContainer(esgst.mainPageHeading));
                } else {
                    mainPageHeadingBefore.appendChild(addDfContainer(esgst.mainPageHeading));
                }
            }
        }
        esgst.endlessFeatures.push(loadDiscussionFeatures);
        loadDiscussionFeatures(document, true);
    }
    if (esgst.gv && (esgst.giveawaysPath || esgst.gv_gb || esgst.gv_ged || esgst.gv_ge)) {
        esgst.giveawayFeatures.push(setGvContainers);
        esgst.style.insertAdjacentText(`beforeEnd`, `
            .esgst-gv-creator {
                margin: ${esgst.ib ? 10 : 5}px 5px 5px;
                width: ${esgst.ib ? 127 : 132}px;
            }

            .esgst-gv-popout .giveaway__links {
                display: block;
                height: auto;
                margin: 5px 5px ${esgst.ib ? 10 : 5}px;
                text-align: center;
                width: ${esgst.ib ? 127 : 132}px;
            }
        `);
        if (esgst.giveawaysPath) {
            button = document.createElement(`div`);
            button.className = `esgst-heading-button`;
            button.title = `Set Grid View spacing`;
            button.innerHTML = `
                <i class="fa fa-th-large"></i>
            `;
            if (esgst.hideButtons && esgst.hideButtons_gv) {
                esgst.rightButtons.appendChild(button);
            } else {
                mainPageHeadingAfter.appendChild(button);
            }
            loadGv(button);
        }
    }
    if (esgst.gf && esgst.gf_h) {
        esgst.giveawayFeatures.push(getGfGiveaways);
    }
    if (esgst.giveawaysPath) {
        if (esgst.hfc && esgst.featuredContainer) {
            esgst.featuredContainer.classList.add(`esgst-hidden`);
        }
        if (esgst.at && esgst.at_g) {
            esgst.endlessFeatures.push(getTimestamps);
            getTimestamps(document);
        }
        if (esgst.ags) {
            addAgsPanel();
        }
        if (esgst.gf) {
            if (esgst.hideButtons && esgst.hideButtons_gf) {
                esgst.leftButtons.appendChild(addGfContainer(esgst.mainPageHeading));
            } else {
                mainPageHeadingBefore.appendChild(addGfContainer(esgst.mainPageHeading));
            }
        }
        if (esgst.gas) {
            if (esgst.hideButtons && esgst.hideButtons_gas) {
                esgst.leftButtons.appendChild(loadGas());
            } else {
                mainPageHeadingBefore.appendChild(loadGas());
            }
        }
    } else {
        if (esgst.userPath) {
            if (esgst.gas) {
                if (esgst.hideButtons && esgst.hideButtons_gas) {
                    esgst.leftButtons.appendChild(loadGas());
                } else {
                    mainPageHeadingBefore.appendChild(loadGas());
                }
            }
        }
        if (esgst.groupPath) {
            if (esgst.gf) {
                if (esgst.hideButtons && esgst.hideButtons_gf) {
                    esgst.leftButtons.appendChild(addGfContainer(esgst.mainPageHeading));
                } else {
                    mainPageHeadingBefore.appendChild(addGfContainer(esgst.mainPageHeading));
                }
            }
            if (esgst.gas) {
                if (esgst.hideButtons && esgst.hideButtons_gas) {
                    esgst.leftButtons.appendChild(loadGas());
                } else {
                    mainPageHeadingBefore.appendChild(loadGas());
                }
            }
        }
        if (esgst.createdPath) {
            if (esgst.gf) {
                if (esgst.hideButtons && esgst.hideButtons_gf) {
                    esgst.leftButtons.appendChild(addGfContainer(esgst.mainPageHeading));
                } else {
                    mainPageHeadingBefore.appendChild(addGfContainer(esgst.mainPageHeading));
                }
            }
            if (esgst.ugs) {
                button = document.createElement(`div`);
                button.className = `esgst-heading-button`;
                button.title = `Send unsent gifts.`;
                button.innerHTML = `
                    <i class="fa fa-gift"></i>
                    <i class="fa fa-send"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_ugs) {
                    esgst.leftButtons.appendChild(button);
                } else {
                    mainPageHeadingBefore.appendChild(button);
                }
                button.addEventListener(`click`, openUgsPopup.bind(null, {
                    button: button
                }));
            }
            if (esgst.sks) {
                button = document.createElement(`div`);
                button.className = `esgst-heading-button`;
                button.title = `Search keys`;
                button.innerHTML = `
                    <i class="fa fa-key"></i>
                    <i class="fa fa-search"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_sks) {
                    esgst.leftButtons.appendChild(button);
                } else {
                    mainPageHeadingBefore.appendChild(button);
                }
                button.addEventListener(`click`, openSksPopup.bind(null, {
                    button: button
                }));
            }
            if (esgst.gm) {
                esgst.gmCheckboxes = {};
                button = document.createElement(`div`);
                button.className = `esgst-heading-button`;
                button.title = `Manage giveaways`;
                button.innerHTML = `
                    <span></span>
                    <i class="fa fa-gear"></i>
                `;
                var toggleSwitch = new ToggleSwitch(button.firstElementChild, `gm_enable`, true, ``, false, false, null, esgst.gm_enable);
                toggleSwitch.onEnabled = enableGm;
                toggleSwitch.onDisabled = disableGm;
                if (esgst.hideButtons && esgst.hideButtons_gm) {
                    esgst.leftButtons.appendChild(button);
                } else {
                    mainPageHeadingBefore.appendChild(button);
                }
                button.lastElementChild.addEventListener(`click`, openGmPopout.bind(null, null, {
                    button: button
                }));
            }
        } else if (esgst.enteredPath) {
            if (esgst.gf) {
                if (esgst.hideButtons && esgst.hideButtons_gf) {
                    esgst.leftButtons.appendChild(addGfContainer(esgst.mainPageHeading));
                } else {
                    mainPageHeadingBefore.appendChild(addGfContainer(esgst.mainPageHeading));
                }
            }
            if (esgst.et) {
                esgst.endlessFeatures.push(getEtEntries);
                getEtEntries(document);
            }
            if (esgst.gas) {
                if (esgst.hideButtons && esgst.hideButtons_gas) {
                    esgst.leftButtons.appendChild(loadGas());
                } else {
                    mainPageHeadingBefore.appendChild(loadGas());
                }
            }
            if (esgst.gwc || esgst.gwr) {
                esgst.endlessFeatures.push(addGwcrHeading);
                addGwcrHeading(document, true);
            }
        } else if (esgst.wonPath) {
            if (esgst.gf) {
                if (esgst.hideButtons && esgst.hideButtons_gf) {
                    esgst.leftButtons.appendChild(addGfContainer(esgst.mainPageHeading));
                } else {
                    mainPageHeadingBefore.appendChild(addGfContainer(esgst.mainPageHeading));
                }
            }
        } else if (esgst.giveawayPath) {
            if (esgst.dkc) {
                esgst.endlessFeatures.push(getDkcLinks);
                getDkcLinks(document);
            }
            if ((esgst.cewgd || (esgst.gc && esgst.gc_gi) || esgst.lpv || esgst.rcvc) && document.referrer === `https://www.steamgifts.com/giveaways/new`) {
                var popup = new Popup(`fa-circle-o-notch fa-spin`, `Please wait... ESGST is adding this giveaway to the storage...`, true);
                popup.open();
                var giveaways = getGiveaways(document, true, location.href);
                if (giveaways.length) {
                    var giveaway = giveaways[0];
                    ggiveaways = {};
                    ggiveaways[giveaway.code] = giveaway;
                    var user = {
                        steamId: esgst.steamId,
                        username: esgst.username
                    };
                    var savedUser = getUser(null, user), ugd;
                    giveaways = null;
                    if (savedUser) {
                        giveaways = savedUser.giveaways;
                    }
                    if (!giveaways) {
                        giveaways = {
                            sent: {
                                apps: {},
                                subs: {}
                            },
                            won: {
                                apps: {},
                                subs: {}
                            },
                            sentTimestamp: 0,
                            wonTimestamp: 0
                        };
                        if (savedUser) {
                            ugd = savedUser.ugd;
                            if (ugd) {
                                if (ugd.sent) {
                                    for (var key in ugd.sent.apps) {
                                        giveaways.sent.apps[key] = [];
                                        for (var i = 0, n = ugd.sent.apps[key].length; i < n; ++i) {
                                            ggiveaways[ugd.sent.apps[key][i].code] = ugd.sent.apps[key][i];
                                            giveaways.sent.apps[key].push(ugd.sent.apps[key][i].code);
                                        }
                                    }
                                    for (var key in ugd.sent.subs) {
                                        giveaways.sent.subs[key] = [];
                                        for (var i = 0, n = ugd.sent.subs[key].length; i < n; ++i) {
                                            ggiveaways[ugd.sent.subs[key][i].code] = ugd.sent.subs[key][i];
                                            giveaways.sent.subs[key].push(ugd.sent.subs[key][i].code);
                                        }
                                    }
                                    giveaways.sentTimestamp = ugd.sentTimestamp;
                                }
                                if (ugd.won) {
                                    for (var key in ugd.won.apps) {
                                        giveaways.won.apps[key] = [];
                                        for (var i = 0, n = ugd.won.apps[key].length; i < n; ++i) {
                                            ggiveaways[ugd.won.apps[key][i].code] = ugd.won.apps[key][i];
                                            giveaways.won.apps[key].push(ugd.won.apps[key][i].code);
                                        }
                                    }
                                    for (var key in ugd.won.subs) {
                                        giveaways.won.subs[key] = [];
                                        for (var i = 0, n = ugd.won.subs[key].length; i < n; ++i) {
                                            ggiveaways[ugd.won.subs[key][i].code] = ugd.won.subs[key][i];
                                            giveaways.won.subs[key].push(ugd.won.subs[key][i].code);
                                        }
                                    }
                                    giveaways.wonTimestamp = ugd.wonTimestamp;
                                }
                            }
                        }
                    }
                    if (!giveaways.sent[giveaway.gameType][giveaway.gameSteamId]) {
                        giveaways.sent[giveaway.gameType][giveaway.gameSteamId] = [];
                    }
                    if (giveaways.sent[giveaway.gameType][giveaway.gameSteamId].indexOf(giveaway.code) < 0) {
                        giveaways.sent[giveaway.gameType][giveaway.gameSteamId].push(giveaway.code);
                    }
                    user.values = {
                        giveaways: giveaways
                    };
                    lockAndSaveGiveaways(ggiveaways, saveUser.bind(null, null, null, user, () => popup.close()));
                }
            }
            if (!document.getElementsByClassName(`table--summary`)[0]) {
                var entryButton = esgst.sidebar.getElementsByClassName(`sidebar__entry-insert`)[0];
                var deleteButton = esgst.sidebar.getElementsByClassName(`sidebar__entry-delete`)[0];
                var code = location.pathname.match(/^\/giveaway\/(.+?)\//)[1];
                var name = document.getElementsByClassName(`featured__heading__medium`)[0].textContent;
                if (esgst.hgebd) {
                    var errorButton = esgst.sidebar.getElementsByClassName(`sidebar__error`)[0];
                    var hideButton = document.getElementsByClassName(`featured__giveaway__hide`)[0];
                    if ((entryButton || errorButton) && !hideButton) {
                        var parent = (entryButton || errorButton).parentElement;
                        if (entryButton) {
                            entryButton.remove();
                        }
                        if (errorButton) {
                            errorButton.remove();
                        }
                        parent.insertAdjacentHTML(`afterBegin`, `
                            <div class="sidebar__error is-disabled">
                                <i class="fa fa-exclamation-circle"></i> Hidden Game
                            </div>
                        `);
                    }
                }
                if (entryButton) {
                    esgst.enterGiveawayButton = entryButton;
                    if (esgst.et) {
                        entryButton.addEventListener(`click`, setEtEntry.bind(null, code, true, name));
                    }
                }
                if (deleteButton) {
                    esgst.leaveGiveawayButton = deleteButton;
                    if (esgst.et) {
                        deleteButton.addEventListener(`click`, setEtEntry.bind(null, code, false, name));
                    }
                }
            }
        } else if (esgst.discussionsPath) {
            if (esgst.ds) {
                if (esgst.hideButtons && esgst.hideButtons_ds) {
                    esgst.leftButtons.appendChild(loadDs());
                } else {
                    mainPageHeadingBefore.appendChild(loadDs());
                }
            }
        }
        if (esgst.newDiscussionPath) {
            if (esgst.mgc && (getValue(`esgst_mgcAttach_step1`) || getValue(`esgst_mgcAttach_step2`))) {
                delValue(`esgst_mgcAttach_step1`);
                delValue(`esgst_mgcAttach_step2`);
                addMgcCreateAndAttachButton();
            }
        } else if (esgst.editDiscussionPath) {
            if (esgst.mgc && getValue(`esgst_mgcAttach_step4`)) {
                editMgcDiscussion();
            }
        }
        if (location.pathname.match(/^\/account\/settings\/giveaways\/filters/)) {
            if (esgst.hgr) {
                button = document.createElement(`div`);
                button.className = `esgst-heading-button`;
                button.title = `Remove owned games from the list`;
                button.innerHTML = `
                    <i class="fa fa-eye-slash"></i>
                    <i class="fa fa-times-circle"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_hgr) {
                    esgst.leftButtons.appendChild(button);
                } else {
                    mainPageHeadingBefore.appendChild(button);
                }
                button.addEventListener(`click`, openHgrPopup.bind(null, {
                    button: button
                }));
            }
        }
        if (esgst.commentsPath) {
            if (esgst.discussionPath) {
                if (esgst.df && esgst.df_h) {
                    var discussion = {
                        code: location.pathname.match(/^\/discussion\/(.+?)\//)[1],
                        heading: document.getElementsByClassName(`page__heading__breadcrumbs`)[0],
                        headingContainer: document.getElementsByClassName(`page__heading`)[0]
                    };
                    var savedDiscussions = JSON.parse(getValue(`discussions`));
                    if (savedDiscussions[discussion.code] && savedDiscussions[discussion.code].hidden) {
                        addDfUnhideButton(discussion, true);
                    } else {
                        addDfHideButton(discussion, true);
                    }
                }
                if (document.getElementsByClassName(`comment__username`)[0].textContent === esgst.username) {
                    var codes = [];
                    var elements = document.getElementsByClassName(`comment__description`)[0].querySelectorAll(`[href^="ESGST-"]`);
                    for (var i = 0, n = elements.length; i < n; ++i) {
                        var element = elements[i];
                        var encryptedCode = element.getAttribute(`href`).match(/ESGST-(.+)/)[1];
                        if (!encryptedCode.match(/currentVersion/)) {
                            codes.push(decryptGedCode(encryptedCode));
                        }
                    }
                    saveGedGiveaways(codes, location.href);
                }
                if (esgst.mgc) {
                    if (getValue(`esgst_mgcAttach_step2`)) {
                        delValue(`esgst_mgcAttach_step2`);
                        setValue(`esgst_mgcAttach_step3`, location.pathname.match(/\/discussion\/(.+?)\//)[1]);
                        request(`xsrf_token=${esgst.xsrfToken}&do=close_discussion`, null, false, location.href, function () {
                            close();
                        });
                    } else if (getValue(`esgst_mgcAttach_step4`)) {
                        document.querySelector(`form[action="/discussions/edit"]`).submit();
                    } else if (getValue(`esgst_mgcAttach_step5`)) {
                        delValue(`esgst_mgcAttach_step5`);
                        request(`xsrf_token=${esgst.xsrfToken}&do=reopen_discussion`, null, false, location.href, function () {
                            setValue(`esgst_mgcAttach_step6`, true);
                            location.reload();
                        });
                    } else if (getValue(`esgst_mgcAttach_step6`)) {
                        delValue(`esgst_mgcAttach_step6`);
                        new Popup(`fa-check`, `Train created with success! You can close this now.`, true).open();
                    }
                }
                if (esgst.mpp) {
                    button = document.createElement(`div`);
                    button.className = `esgst-heading-button`;
                    button.title = `Open the main post.`;
                    button.innerHTML = `
                        <i class="fa fa-home"></i>
                    `;
                    if (esgst.hideButtons && esgst.hideButtons_mpp) {
                        esgst.leftButtons.appendChild(button);
                    } else {
                        mainPageHeadingBefore.appendChild(button);
                    }
                    loadMpp(button);
                }
            }
            if ((esgst.giveawayPath && !document.getElementsByClassName(`table--summary`)[0]) || !esgst.giveawayPath) {
                if (esgst.cs) {
                    button = document.createElement(`div`);
                    button.className = `esgst-heading-button`;
                    button.title = `Search comments from specific users.`;
                    button.innerHTML = `
                        <i class="fa fa-comments"></i>
                        <i class="fa fa-search"></i>
                    `;
                    if (esgst.hideButtons && esgst.hideButtons_cs) {
                        esgst.leftButtons.appendChild(button);
                    } else {
                        mainPageHeadingBefore.appendChild(button);
                    }
                    button.addEventListener(`click`, openCsPopup.bind(null, {
                        button: button
                    }));
                }
                if (esgst.rbp && esgst.replyBox) {
                    button = document.createElement(`div`);
                    button.className = `esgst-heading-button`;
                    button.title = `Add a comment.`;
                    button.innerHTML = `
                        <i class="fa fa-comment"></i>
                    `;
                    if (esgst.hideButtons && esgst.hideButtons_rbp) {
                        esgst.leftButtons.appendChild(button);
                    } else {
                        mainPageHeadingBefore.appendChild(button);
                    }
                    loadRbp(button);
                }
                if (esgst.ct) {
                    var match = location.pathname.match(/\/(giveaway|discussion|ticket|trade)\/(.+?)\//);
                    if (match) {
                        var element = esgst.mainPageHeading.querySelector(`.page__heading__breadcrumbs, .page_heading_breadcrumbs`).firstElementChild;
                        var type = `${match[1]}s`;
                        code = match[2];
                        var comments = JSON.parse(getValue(type));
                        var diff;
                        var count = parseInt(element.textContent.replace(/,/g, ``).match(/\d+/)[0]);
                        if (comments[code]) {
                            var read;
                            if (esgst.ct_s) {
                                read = comments[code].count || (esgst.ct_s_h ? count : 0);
                            } else {
                                read = 0;
                                for (var id in comments[code].readComments) {
                                    if (!id.match(/^(Count|undefined|)$/) && comments[code].readComments[id]) {
                                        ++read;
                                    }
                                }
                            }
                            diff = count === read ? 0 : count - read;
                        } else if (esgst.ct_s && esgst.ct_s_h) {
                            diff = 0;
                        } else {
                            diff = count;
                        }
                        if (diff > 0) {
                            element.insertAdjacentHTML(`beforeEnd`, ` <span class="esgst-ct-count" title="Unread comments">(+${diff})</span>`);
                        }
                    }
                    if (!esgst.ct_s) {
                        button1 = document.createElement(`div`);
                        button1.className = `esgst-heading-button`;
                        button1.title = `Go to the first unread comment of this page.`;
                        button1.innerHTML = `
                            <i class="fa fa-comments-o"></i>
                        `;
                        if (esgst.hideButtons && esgst.hideButtons_ctGo) {
                            esgst.leftButtons.appendChild(button1);
                        } else {
                            mainPageHeadingBefore.appendChild(button1);
                        }
                        button2 = document.createElement(`div`);
                        button2.className = `esgst-heading-button`;
                        button2.title = `Mark all comments in this page as read.`;
                        button2.innerHTML = `
                            <i class="fa fa-eye"></i>
                        `;
                        if (esgst.hideButtons && esgst.hideButtons_ctRead) {
                            esgst.leftButtons.appendChild(button2);
                        } else {
                            mainPageHeadingBefore.appendChild(button2);
                        }
                        button3 = document.createElement(`div`);
                        button3.className = `esgst-heading-button`;
                        button3.title = `Mark all comments in this page as unread.`;
                        button3.innerHTML = `
                            <i class="fa fa-eye-slash"></i>
                        `;
                        if (esgst.hideButtons && esgst.hideButtons_ctUnread) {
                            esgst.leftButtons.appendChild(button3);
                        } else {
                            mainPageHeadingBefore.appendChild(button3);
                        }
                        addCtCommentPanel(button1, button2, button3);
                    }
                }
            }
        } else if (esgst.inboxPath) {
            if (esgst.ct && !esgst.ct_s) {
                button1 = document.createElement(`div`);
                button1.className = `esgst-heading-button`;
                button1.title = `Go to the first unread comment of this page.`;
                button1.innerHTML = `
                    <i class="fa fa-comments-o"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_ctGo) {
                    esgst.leftButtons.appendChild(button1);
                } else {
                    mainPageHeadingBefore.appendChild(button1);
                }
                button2 = document.createElement(`div`);
                button2.className = `esgst-heading-button`;
                button2.title = `Mark all comments in this page as read.`;
                button2.innerHTML = `
                    <i class="fa fa-eye"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_ctRead) {
                    esgst.leftButtons.appendChild(button2);
                } else {
                    mainPageHeadingBefore.appendChild(button2);
                }
                button3 = document.createElement(`div`);
                button3.className = `esgst-heading-button`;
                button3.title = `Mark all comments in this page as unread.`;
                button3.innerHTML = `
                    <i class="fa fa-eye-slash"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_ctUnread) {
                    esgst.leftButtons.appendChild(button3);
                } else {
                    mainPageHeadingBefore.appendChild(button3);
                }
                addCtCommentPanel(button1, button2, button3);
            }
        } else if (esgst.winnersPath) {
            if (esgst.namwc) {
                button = document.createElement(`div`);
                button.className = `esgst-heading-button`;
                button.title = `Check for not activated/multiple wins.`;
                button.innerHTML = `
                    <i class="fa fa-trophy"></i>
                    <i class="fa fa-question-circle"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_namwc) {
                    esgst.leftButtons.appendChild(button);
                } else {
                    mainPageHeadingBefore.appendChild(button);
                }
                setNAMWCPopup(button);
            }
        } else if (esgst.archivePath) {
            if (esgst.as) {
                button = document.createElement(`div`);
                button.className = `esgst-heading-button`;
                button.title = `Search archive.`;
                button.innerHTML = `
                    <i class="fa fa-folder"></i>
                    <i class="fa fa-search"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_as) {
                    esgst.leftButtons.appendChild(button);
                } else {
                    mainPageHeadingBefore.appendChild(button);
                }
                loadAs(button);
            }
        } else if (esgst.whitelistPath) {
            if (esgst.us) {
                esgst.endlessFeatures.push(getUsUsers);
                getUsUsers(document, true);
            }
            if (esgst.wbs) {
                button1 = document.createElement(`div`);
                button1.className = `esgst-heading-button`;
                button1.title = `Sort by added date from oldest to newest.`;
                button1.innerHTML = `
                    <i class="fa fa-sort-amount-asc"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_wbsAsc) {
                    esgst.leftButtons.appendChild(button1);
                } else {
                    mainPageHeadingBefore.appendChild(button1);
                }
                button2 = document.createElement(`div`);
                button2.className = `esgst-heading-button`;
                button2.title = `Sort by added date from newest to oldest.`;
                button2.innerHTML = `
                    <i class="fa fa-sort-amount-desc"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_wbsDesc) {
                    esgst.leftButtons.appendChild(button2);
                } else {
                    mainPageHeadingBefore.appendChild(button2);
                }
                addWbsButton(`whitelistedDate`, `whitelist`, `whitelisted`, button1, button2);
            }
        } else if (esgst.blacklistPath) {
            if (esgst.us) {
                esgst.endlessFeatures.push(getUsUsers);
                getUsUsers(document, true);
            }
            if (esgst.wbs) {
                button1 = document.createElement(`div`);
                button1.className = `esgst-heading-button`;
                button1.title = `Sort by added date from oldest to newest.`;
                button1.innerHTML = `
                    <i class="fa fa-sort-amount-asc"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_wbsAsc) {
                    esgst.leftButtons.appendChild(button1);
                } else {
                    mainPageHeadingBefore.appendChild(button1);
                }
                button2 = document.createElement(`div`);
                button2.className = `esgst-heading-button`;
                button2.title = `Sort by added date from newest to oldest.`;
                button2.innerHTML = `
                    <i class="fa fa-sort-amount-desc"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_wbsDesc) {
                    esgst.leftButtons.appendChild(button2);
                } else {
                    mainPageHeadingBefore.appendChild(button2);
                }
                addWbsButton(`blacklistedDate`, `blacklist`, `blacklisted`, button1, button2);
            }
        } else if (esgst.newTicketPath) {
            if (esgst.ugs) {
                button = document.getElementsByClassName(`form__submit-button`)[0];
                var category = document.querySelector(`[name="category_id"]`);
                var winner = document.querySelector(`[name="reroll_winner_id"]`);
                button.addEventListener(`click`, saveUgsReroll.bind(null, category, winner));
            }
        }
        if (esgst.newGiveawayPath) {
            if (esgst.gr) {
                loadGrGiveaway();
            }
            if (esgst.gts) {
                rows = document.getElementsByClassName(`form__rows`)[0];
                if (rows) {
                    button = document.createElement(`div`);
                    button.className = `esgst-gts-button esgst-heading-button`;
                    button.title = `View/apply templates.`;
                    button.innerHTML = `
                        <i class="fa fa-file"></i>
                    `;
                    if (esgst.hideButtons && esgst.hideButtons_gts) {
                        esgst.leftButtons.appendChild(button);
                    } else {
                        mainPageHeadingBefore.appendChild(button);
                    }
                    addGtsButtonSection(button, rows);
                }
            }
        }
        if (location.href.match(new RegExp(`\\/trades\\/search\\?user=${esgst.steamId}`))) {
            if (esgst.tb) {
                button = document.createElement(`div`);
                button.className = `esgst-heading-button`;
                button.title = `Bump trades.`;
                button.innerHTML = `
                    <i class="fa fa-chevron-circle-up"></i>
                `;
                if (esgst.hideButtons && esgst.hideButtons_tb) {
                    esgst.leftButtons.appendChild(button);
                } else {
                    mainPageHeadingBefore.appendChild(button);
                }
                button.addEventListener(`click`, getTbTrades.bind(null, button));
                if (esgst.tb_a) {
                    setTbAutoBump(button);
                }
            }
        } else if (esgst.tb && esgst.tb_a) {
            setTbAutoBump(button);
        }
        if (esgst.at) {
            esgst.endlessFeatures.push(getTimestamps);
            getTimestamps(document);
        }
    }
    esgst.mainPageHeading.insertBefore(mainPageHeadingBefore, esgst.mainPageHeading.firstElementChild);
    for (var i = 0, n = esgst.toExecute.length; i < n; ++i) {
        esgst.toExecute[i]();
    }
    if (esgst.hideButtons) {
        if (!esgst.leftButtons.querySelector(`.esgst-heading-button:not(.esgst-hidden)`)) {
            esgst.leftButtons.classList.add(`esgst-hidden`);
        }
        esgst.mainPageHeading.insertBefore(hiddenButtonsBefore, esgst.mainPageHeading.firstElementChild);
    }
    if (esgst.ts) {
        esgst.endlessFeatures.push(getTsTables);
        getTsTables(document);
    }
    goToComment(esgst.originalHash);
    if (esgst.es && esgst.pagination && ((esgst.es_g && esgst.giveawaysPath) || (esgst.es_d && esgst.discussionsTicketsPath) || (esgst.es_t && esgst.tradesPath) || (esgst.es_c && esgst.commentsPath) || (esgst.es_l && !esgst.giveawaysPath && !esgst.discussionsTicketsPath && !esgst.tradesPath && !esgst.commentsPath))) {
        var pauseButton, resumeButton, refreshButton, refreshAllButton, scrollButton;
        pauseButton = document.createElement(`div`);
        pauseButton.className = `esgst-heading-button esgst-es-pause-button`;
        pauseButton.title = `Pause the endless scrolling`;
        pauseButton.innerHTML = `
            <i class="fa fa-pause"></i>
        `;
        resumeButton = document.createElement(`div`);
        resumeButton.className = `esgst-heading-button esgst-es-resume-button esgst-hidden`;
        resumeButton.title = `Resume the endless scrolling`;
        resumeButton.innerHTML = `
            <i class="fa fa-play"></i>
        `;
        if (esgst.hideButtons && esgst.hideButtons_esPause) {
            esgst.rightButtons.appendChild(pauseButton);
            esgst.rightButtons.appendChild(resumeButton);
        } else {
            mainPageHeadingAfter.appendChild(pauseButton);
            mainPageHeadingAfter.appendChild(resumeButton);
        }
        refreshButton = document.createElement(`div`);
        refreshButton.className = `esgst-heading-button esgst-es-refresh-button`;
        refreshButton.title = `Resume current page`;
        refreshButton.innerHTML = `
            <i class="fa fa-refresh"></i>
            <i class="fa fa-map-marker"></i>
        `;
        if (esgst.hideButtons && esgst.hideButtons_esRefresh) {
            esgst.rightButtons.appendChild(refreshButton);
        } else {
            mainPageHeadingAfter.appendChild(refreshButton);
        }
        refreshAllButton = document.createElement(`div`);
        refreshAllButton.className = `esgst-heading-button esgst-es-refresh-all-button`;
        refreshAllButton.title = `Resume all pages`;
        refreshAllButton.innerHTML = `
            <i class="fa fa-refresh"></i>
        `;
        if (esgst.hideButtons && esgst.hideButtons_esRefreshAll) {
            esgst.rightButtons.appendChild(refreshAllButton);
        } else {
            mainPageHeadingAfter.appendChild(refreshAllButton);
        }
        scrollButton = document.createElement(`div`);
        scrollButton.className = `esgst-heading-button esgst-es-scroll-button`;
        scrollButton.title = `Scroll to top`;
        scrollButton.innerHTML = `
            <i class="fa fa-chevron-up"></i>
        `;
        if (esgst.hideButtons && esgst.hideButtons_esScroll) {
            esgst.rightButtons.appendChild(scrollButton);
        } else {
            mainPageHeadingAfter.appendChild(scrollButton);
        }
        esgst.mainPageHeading.appendChild(mainPageHeadingAfter);
        if (esgst.hideButtons && esgst.rightButtons.querySelector(`.esgst-heading-button:not(.esgst-hidden)`)) {
            esgst.mainPageHeading.appendChild(hiddenButtonsAfter);
        }
        loadEs(pauseButton, resumeButton, refreshButton, refreshAllButton, scrollButton);
    } else {
        esgst.mainPageHeading.appendChild(mainPageHeadingAfter);
        if (esgst.hideButtons && esgst.rightButtons.querySelector(`.esgst-heading-button:not(.esgst-hidden)`)) {
            esgst.mainPageHeading.appendChild(hiddenButtonsAfter);
        }
    }
    addEventListener(`beforeunload`, function (event) {
        if (document.getElementsByClassName(`esgst-busy`)[0] || esgst.busy) {
            event.returnValue = true;
            return true;
        }
    });
    addEventListener(`hashchange`, function () {
        goToComment();
    });
    if (location.pathname.match(/^\/discussion\/TDyzv\//) && esgst.checkVersion && document.querySelector(`[href*="ESGST-currentVersion"]`).getAttribute(`href`).match(/currentVersion-(.+)/)[1] !== esgst.version) {
        createAlert(`You are not using the latest ESGST version. Please update before reporting any bugs and make sure the bugs still exist in the latest version.`);
    }
}

function loadFeature(feature) {
    var i, id, n;
    id = feature.id;
    if (id) {
        esgst[id] = getSetting(id, feature.sg, feature.st);
        if (esgst[id] && feature.load) {
            esgst.toExecute.push(feature.load);
        }
    } else if (feature.load) {
        esgst.toExecute.push(feature.load);
    }
    if (feature.features) {
        for (i = 0, n = feature.features.length; i < n; ++i) {
            loadFeature(feature.features[i]);
        }
    }
}

function setSetting(id, value, sg, st) {
    var localId, settings = JSON.parse(getValue(`settings`, `{}`));
    if (sg) {
        id = `${id}_sg`;
    } else if (st) {
        id = `${id}_st`;
    }
    settings[id] = value;
    setValue(`settings`, JSON.stringify(settings));
    esgst.settings[id] = value;
}

function getSetting(key, sg, st) {
    var defaultValue, i, localKey, n;
    if ((esgst.name === `sg` && sg) || (esgst.name === `st` && st) || (!sg && !st)) {
        if (sg || st) {
            localKey = `${key}_${esgst.name}`;
        } else {
            localKey = key;
        }
        if (typeof esgst.settings[localKey] === `undefined` && (key[0] === key[0].toLowerCase())) {
            defaultValue = esgst.defaultValues[key];
            if (typeof defaultValue === `undefined`) {
                defaultValue = key.match(/^sk_/) ? true : (key.match(/^gc_.+?_s$/) ? esgst.settings.gc_s_sg : (key.match(/^gc_.+?_s_i$/) ? esgst.settings.gc_s_i_sg : (key.match(/^(g|d)f_(?!h$)/) ? true : (key.match(/^hide/) ? false : (esgst.enableByDefault || false)))));
            }
            esgst.settings[localKey] = getValue(esgst.oldValues[key] || key, defaultValue);
        }
        return esgst.settings[localKey];
    }
}

function addHeaderMenu() {
    var arrow, button, chRow, changelogRow, className, context, dropdown, html, menu, position, uhRow, updateRow;
    html = `
        <div class="esgst-header-menu">
            <div class="esgst-header-menu-relative-dropdown esgst-hidden">
                <div class="esgst-header-menu-absolute-dropdown">
                    <div class="esgst-header-menu-row">
                        <i class="fa fa-fw fa-refresh blue"></i>
                        <div>
                            <p class="esgst-header-menu-name">Update</p>
                            <p class="esgst-header-menu-description">Check for updates.</p>
                        </div>
                    </div>
                    <a class="esgst-header-menu-row" href="https://github.com/revilheart/ESGST">
                        <i class="fa fa-fw fa-github grey"></i>
                        <div>
                            <p class="esgst-header-menu-name">GitHub</p>
                            <p class="esgst-header-menu-description">Visit the GitHub page.</p>
                        </div>
                    </a>
                    <a class="esgst-header-menu-row" href="https://www.steamgifts.com/discussion/TDyzv/">
                        <i class="fa fa-fw fa-commenting green"></i>
                        <div>
                            <p class="esgst-header-menu-name">Discussion</p>
                            <p class="esgst-header-menu-description">Visit the discussion page.</p>
                        </div>
                    </a>
                    <div class="esgst-header-menu-row">
                        <i class="fa fa-fw fa-user red"></i>
                        <div>
                            <p class="esgst-header-menu-name">Recent Username Changes</p>
                            <p class="esgst-header-menu-description">Check out the recent username changes.</p>
                        </div>
                    </div>
                    <div class="esgst-header-menu-row">
                        <i class="fa fa-fw fa-comments yellow"></i>
                        <div>
                            <p class="esgst-header-menu-name">Comment History</p>
                            <p class="esgst-header-menu-description">Check out your comment history.</p>
                        </div>
                    </div>
                    <div class="esgst-header-menu-row">
                        <i class="fa fa-fw fa-file-text-o grey"></i>
                        <div>
                            <p class="esgst-header-menu-name">Changelog</p>
                            <p class="esgst-header-menu-description">Check out the script's changelog.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="esgst-header-menu-button">
                <i class="fa">
                    <img src="${esgst.icon}"/>
                </i>
                <span>ESGST</span>
            </div>
            <div class="esgst-header-menu-button arrow">
                <i class="fa fa-angle-down"></i>
            </div>
        </div>
    `;
    if (esgst.sg) {
        className = `nav__left-container`;
        position = `beforeEnd`;
    } else {
        className = `nav_logo`;
        position = `afterEnd`;
    }
    context = document.getElementsByClassName(className)[0];
    menu = insertHtml(context, position, html);
    dropdown = menu.firstElementChild;
    button = dropdown.nextElementSibling;
    arrow = button.nextElementSibling;
    updateRow = dropdown.firstElementChild.firstElementChild;
    uhRow = updateRow.nextElementSibling.nextElementSibling.nextElementSibling;
    chRow = uhRow.nextElementSibling;
    changelogRow = chRow.nextElementSibling;
    if (esgst.uh) {
        setSMRecentUsernameChanges(uhRow);
    } else {
        uhRow.classList.add(`esgst-hidden`);
    }
    if (esgst.ch) {
        setSMCommentHistory(chRow);
    } else {
        chRow.classList.add(`esgst-hidden`);
    }
    button.addEventListener(`click`, function () {
        if (esgst.openSettingsInTab) {
            open(`/esgst/settings`);
        } else {
            loadSMMenu();
        }
    });
    arrow.addEventListener(`click`, toggleHeaderMenu.bind(null, arrow, dropdown));
    document.addEventListener(`click`, closeHeaderMenu.bind(null, arrow, dropdown, menu), true);
    changelogRow.addEventListener(`click`, loadChangelog);
    updateRow.addEventListener(`click`, checkUpdate);
}

function toggleHeaderMenu(arrow, dropdown) {
    if (esgst.sg) {
        $(`nav .nav__button`).removeClass(`is-selected`);
        $(`nav .nav__relative-dropdown`).addClass(`is-hidden`);
    } else {
        $(`.nav_btn_dropdown`).removeClass(`is_selected`);
        $(`.page_heading_btn_dropdown`).removeClass(`is_selected`);
        $(`.dropdown`).addClass(`is_hidden`);
    }
    arrow.classList.toggle(`selected`);
    dropdown.classList.toggle(`esgst-hidden`);
}

function closeHeaderMenu(arrow, dropdown, menu, event) {
    if (!menu.contains(event.target) && arrow.classList.contains(`selected`)) {
        arrow.classList.remove(`selected`);
        dropdown.classList.add(`esgst-hidden`);
    }
}

function checkUpdate() {
    request(null, null, false, `https://raw.githubusercontent.com/revilheart/ESGST/master/ESGST.meta.js`, function (response) {
        var version = response.responseText.match(/@version (.+)/);
        if (version) {
            if (version[1] != esgst.version) {
                location.href = `https://raw.githubusercontent.com/revilheart/ESGST/master/ESGST.user.js`;
            } else {
                alert(`No ESGST updates found!`);
            }
        } else {
            alert(`No ESGST updates found!`);
        }
    });
}

function getTimestamp(unixTimestamp, clock24, showSeconds) {
    var months, date, month, day, year, hours, period, minutes, seconds;
    months = [`Jan`, `Feb`, `Mar`, `Apr`, `May`, `Jun`, `Jul`, `Aug`, `Sep`, `Oct`, `Nov`, `Dec`];
    date = new Date(unixTimestamp * 1e3);
    month = date.getMonth();
    day = date.getDate();
    year = date.getFullYear();
    hours = date.getHours();
    if (clock24) {
        period = ``;
    } else {
        if (hours < 12) {
            period = `am`;
        } else {
            period = `pm`;
        }
        hours %= 12;
        if (hours === 0) {
            hours = 12;
        }
    }
    minutes = `0${date.getMinutes()}`.slice(-2);
    if (showSeconds) {
        seconds = `0${date.getSeconds()}`.slice(-2);
        seconds = `:${seconds}`;
    } else {
        seconds = ``;
    }
    return `${months[month]} ${day}, ${year}, ${hours}:${minutes}${seconds}${period}`;
}

function insertHtml(context, position, html) {
    context.insertAdjacentHTML(position, html);
    var positions = {
        beforeBegin: `previousElementSibling`,
        afterBegin: `firstElementChild`,
        beforeEnd: `lastElementChild`,
        afterEnd: `nextElementSibling`
    };
    return context[positions[position]];
}

function setValue(key, value) {
    if (key.match(/^esgst_/)) {
        localStorage.setItem(key, value);
    } else {
        chrome.storage.local.set({[key]: value});
        esgst.storage[key] = value;
    }
}

function getValue(key, value = undefined) {
    if (key.match(/^esgst_/)) {
        return (localStorage.getItem(key) || value);
    } else {
        return (typeof esgst.storage[key] === `undefined` ? value : esgst.storage[key]);
    }
}

function delValue(key) {
    if (key.match(/^esgst_/)) {
        localStorage.removeItem(key);
    } else {
        chrome.storage.local.remove(key);
    }
}

/* User Saving System */

function getUser(savedUsers, user) {
    var savedUser, steamId;
    if (!savedUsers) {
        savedUsers = JSON.parse(getValue(`users`));
    }
    if (user.steamId) {
        savedUser = savedUsers.users[user.steamId];
        if (savedUser) {
            if (!user.id) {
                user.id = savedUser.id;
            }
            if (!user.username) {
                user.username = savedUser.username;
            }
            return savedUser;
        } else {
            return null;
        }
    } else if (user.username) {
        steamId = savedUsers.steamIds[user.username];
        if (steamId) {
            user.steamId = steamId;
            return savedUsers.users[steamId];
        } else {
            return null;
        }
    } else {
        return null;
    }
}

function saveUser(list, savedUsers, user, callback) {
    var savedUser;
    if (!savedUsers) {
        savedUsers = JSON.parse(getValue(`users`));
    }
    savedUser = getUser(savedUsers, user);
    if (savedUser) {
        if (list) {
            if (!user.steamId) {
                user.steamId = savedUsers.steamIds[user.username];
            }
            list.existing.push(user);
            list.count += 1;
        } else {
            continueSavingUser(user, callback);
        }
    } else {
        if (user.steamId && user.username) {
            if (list) {
                list.new.push(user);
                list.count += 1;
            } else {
                addUser(user, callback);
            }
        } else if (user.steamId) {
            getUsername(list, true, user, callback);
        } else {
            getSteamId(list, true, null, user, callback);
        }
    }
}

function continueSavingUser(user, callback) {
    createLock(`userLock`, 300, lockAndSaveUser.bind(null, user, callback));
}

function lockAndSaveUser(user, callback, deleteLock) {
    var key, savedUsers;
    savedUsers = JSON.parse(getValue(`users`));
    for (key in user.values) {
        if (key !== `tags`) {
            savedUsers.users[user.steamId][key] = user.values[key];
        }
    }
    checkUsernameChange(savedUsers, user);
    setValue(`users`, JSON.stringify(savedUsers));
    deleteLock();
    if (callback) {
        callback();
    }
}

function checkUsernameChange(savedUsers, user) {
    var i, n;
    if (typeof savedUsers.users[user.steamId].username !== `undefined` && savedUsers.users[user.steamId].username !== user.username) {
        delete savedUsers.steamIds[savedUsers.users[user.steamId].username];
        savedUsers.users[user.steamId].username = user.username;
        savedUsers.steamIds[user.username] = user.steamId;
        if (user.values.tags) {
            if (!savedUsers.users[user.steamId].tags) {
                savedUsers.users[user.steamId].tags = [];
            }
            for (i = 0, n = user.values.tags.length; i < n; ++i) {
                if (savedUsers.users[user.steamId].tags.indexOf(user.values.tags[i]) < 0) {
                    savedUsers.users[user.steamId].tags.push(user.values.tags[i]);
                }
            }
        }
    } else if (user.values.tags) {
        savedUsers.users[user.steamId].tags = user.values.tags;
    }
}

function addUser(user, callback) {
    createLock(`userLock`, 300, addAndSaveUser.bind(null, user, callback));
}

function addAndSaveUser(user, callback, deleteLock) {
    var key, savedUser, savedUsers;
    savedUsers = JSON.parse(getValue(`users`));
    savedUser = getUser(savedUsers, user);
    if (!savedUser) {
        savedUsers.users[user.steamId] = {};
    }
    if (user.id) {
        savedUsers.users[user.steamId].id = user.id;
    }
    if (user.username) {
        savedUsers.users[user.steamId].username = user.username;
        savedUsers.steamIds[user.username] = user.steamId;
    }
    for (key in user.values) {
        if (key !== `tags`) {
            savedUsers.users[user.steamId][key] = user.values[key];
        }
    }
    checkUsernameChange(savedUsers, user);
    setValue(`users`, JSON.stringify(savedUsers));
    deleteLock();
    if (callback) {
        callback();
    }
}

function getUsername(list, save, user, callback) {
    request(null, null, false, `https://www.steamgifts.com/go/user/${user.steamId}`, lockAndGetUsername.bind(null, list, save, user, callback));
}

function lockAndGetUsername(list, save, user, callback, response) {
    var input, match, responseHtml;
    match = response.finalUrl.match(/\/user\/(.+)/);
    responseHtml = DOM.parse(response.responseText);
    if (match) {
        user.username = match[1];
        input = responseHtml.querySelector(`[name="child_user_id"]`);
        if (input) {
            user.id = input.value;
        }
    }
    if (save) {
        if (list) {
            list.new.push(user);
            list.count += 1;
        } else {
            addUser(user, callback);
        }
    } else {
        callback();
    }
}

function getSteamId(list, save, savedUsers, user, callback) {
    var savedUsers, steamId;
    if (save) {
        request(null, null, false, `https://www.steamgifts.com/user/${user.username}`, lockAndGetSteamId.bind(null, list, save, user, callback));
    } else {
        if (!savedUsers) {
            savedUsers = JSON.parse(getValue(`users`));
        }
        steamId = savedUsers.steamIds[user.username];
        if (steamId) {
            user.steamId = steamId;
            callback();
        } else {
            request(null, null, false, `https://www.steamgifts.com/user/${user.username}`, lockAndGetSteamId.bind(null, list, save, user, callback));
        }
    }
}

function lockAndGetSteamId(list, save, user, callback, response) {
    var input, responseHtml;
    responseHtml = DOM.parse(response.responseText);
    user.steamId = responseHtml.querySelector(`[href*="/profiles/"]`).getAttribute(`href`).match(/\d+/)[0];
    input = responseHtml.querySelector(`[name="child_user_id"]`);
    if (input) {
        user.id = input.value;
    }
    if (save) {
        if (list) {
            list.new.push(user);
            list.count += 1;
        } else {
            addUser(user, callback);
        }
    } else {
        callback();
    }
}

function saveUsers(users, callback) {
    var i, list, n, savedUsers;
    list = {
        count: 0,
        existing: [],
        new: []
    };
    savedUsers = JSON.parse(getValue(`users`));
    for (i = 0, n = users.length; i < n; ++i) {
        saveUser(list, savedUsers, users[i]);
    }
    setTimeout(checkUserSavingComplete, 1000, list, n, callback);
}

function checkUserSavingComplete(list, total, callback) {
    if (list.count === total) {
        createLock(`userLock`, 300, completeUserSaving.bind(null, list, callback));
    } else {
        setTimeout(checkUserSavingComplete, 1000, list, total, callback);
    }
}

function completeUserSaving(list, callback, deleteLock) {
    var i, key, n, savedUser, savedUsers, user;
    savedUsers = JSON.parse(getValue(`users`));
    for (i = 0, n = list.new.length; i < n; ++i) {
        user = list.new[i];
        savedUser = getUser(savedUsers, user);
        if (!savedUser) {
            savedUsers.users[user.steamId] = {};
        }
        if (user.id) {
            savedUsers.users[user.steamId].id = user.id;
        }
        if (user.username) {
            savedUsers.users[user.steamId].username = user.username;
            savedUsers.steamIds[user.username] = user.steamId;
        }
        for (key in user.values) {
            if (key !== `tags`) {
                savedUsers.users[user.steamId][key] = user.values[key];
            }
        }
        checkUsernameChange(savedUsers, user);
    }
    for (i = 0, n = list.existing.length; i < n; ++i) {
        user = list.existing[i];
        for (key in user.values) {
            if (key !== `tags`) {
                savedUsers.users[user.steamId][key] = user.values[key];
            }
        }
        checkUsernameChange(savedUsers, user);
    }
    setValue(`users`, JSON.stringify(savedUsers));
    deleteLock();
    callback();
}

function deleteUserValues(values, callback) {
    createLock(`userLock`, 300, lockAndDeleteValues.bind(null, values, callback));
}

function lockAndDeleteValues(values, callback, deleteLock) {
    var i, key, n, savedUsers;
    savedUsers = JSON.parse(getValue(`users`));
    for (key in savedUsers.users) {
        for (i = 0, n = values.length; i < n; ++i) {
            delete savedUsers.users[key][values[i]];
        }
    }
    setValue(`users`, JSON.stringify(savedUsers));
    deleteLock();
    callback();
}

function getUserId(user, callback) {
    if (user.username) {
        getSteamId(null, false, null, user, callback);
    } else {
        getUsername(null, false, user, callback);
    }
}

/* */

function saveComment(tradeCode, parentId, description, url, status, callback, mainCallback) {
    let data, elements, id;
    data = `xsrf_token=${esgst.xsrfToken}&do=${esgst.sg ? `comment_new` : `comment_insert`}&trade_code=${tradeCode}&parent_id=${parentId}&description=${encodeURIComponent(description)}`;
    request(data, null, false, url, response => {
        if (esgst.sg) {
            if (response.redirected) {
                callback();
                if (parentId) {
                    id = DOM.parse(response.responseText).querySelector(`[data-comment-id="${parentId}"]`).getElementsByClassName(`comment__children`)[0].lastElementChild.getElementsByClassName(`comment__summary`)[0].id;
                } else {
                    elements = DOM.parse(response.responseText).getElementsByClassName(`comments`);
                    id = elements[elements.length - 1].lastElementChild.getElementsByClassName(`comment__summary`)[0].id;
                }
                if (esgst.ch) {
                    saveChComment(id, Date.now());
                }
                if (mainCallback) {
                    mainCallback(id, response, status);
                } else {
                    location.href = `/go/comment/${id}`;
                }
            } else if (url != response.finalUrl) {
                request(data, null, false, response.finalUrl, response => {
                    callback();
                    id = parentId ? DOM.parse(response.responseText).querySelector(`[data-comment-id="${parentId}"]`).getElementsByClassName(`comment__children`)[0].lastElementChild.getElementsByClassName(`comment__summary`)[0].id : DOM.parse(response.responseText).getElementsByClassName(`comments`)[1].lastElementChild.getElementsByClassName(`comment__summary`)[0].id;
                    if (esgst.ch) {
                        saveChComment(id, Date.now());
                    }
                    if (mainCallback) {
                        mainCallback(id, response, status);
                    } else {
                        location.href = `/go/comment/${id}`;
                    }
                });
            } else {
                callback();
                if (mainCallback) {
                    mainCallback(null, null, status);
                } else {
                    status.innerHTML = `
                        <i class="fa fa-times-circle"></i>
                        <span>Failed!</span>
                    `;
                }
            }
        } else {
            responseJson = JSON.parse(response.responseText);
            if (responseJson.success) {
                callback();
                id = DOM.parse(responseJson.html).getElementsByClassName(`comment_outer`)[0].id;
                if (esgst.ch) {
                    saveChComment(id, Date.now());
                }
                if (mainCallback) {
                    mainCallback(id, response, status);
                } else {
                    location.href = `/go/comment/${id}`;
                }
            } else {
                callback();
                if (mainCallback) {
                    mainCallback(null, null, status);
                } else {
                    status.innerHTML = `
                        <i class="fa fa-times-circle"></i>
                        <span>Failed!</span>
                    `;
                }
            }
        }
    });
}

function checkSync(menu, callback) {
    if (menu) {
        if (!esgst.menuPath) {
            if (esgst.sg) {
                setSetting(`username`, document.getElementsByClassName(`nav__avatar-outer-wrap`)[0].href.match(/\/user\/(.+)/)[1]);
                setSetting(`avatar`, document.getElementsByClassName(`nav__avatar-inner-wrap`)[0].style.backgroundImage.match(/\("(.+)"\)/)[1]);
            } else {
                setSetting(`avatar`, document.getElementsByClassName(`nav_avatar`)[0].style.backgroundImage.match(/\("(.+)"\)/)[1]);
            }
        }
        setSync(false, callback);
    } else if (esgst.syncFrequency && Date.now() - esgst.lastSync > esgst.syncFrequency * 86400000) {
        if (esgst.sg) {
            setSetting(`username`, document.getElementsByClassName(`nav__avatar-outer-wrap`)[0].href.match(/\/user\/(.+)/)[1]);
            setSetting(`avatar`, document.getElementsByClassName(`nav__avatar-inner-wrap`)[0].style.backgroundImage.match(/\("(.+)"\)/)[1]);
        } else {
            setSetting(`avatar`, document.getElementsByClassName(`nav_avatar`)[0].style.backgroundImage.match(/\("(.+)"\)/)[1]);
        }
        open(`/esgst/sync`);
    }
}

function setSync(autoSync, mainCallback) {
    var popup, syncer;
    syncer = {
        autoSync: autoSync,
        canceled: false
    };
    if (syncer.autoSync || mainCallback) {
        popup = new Popup(`fa-refresh`, `Sync`);
        if (!syncer.autoSync) {
            new ToggleSwitch(popup.description, `syncGroups`, false, `Steam Groups`, false, false, null, esgst.syncGroups);
            new ToggleSwitch(popup.description, `syncWhitelist`, false, `Whitelist`, false, false, null, esgst.syncWhitelist);
            new ToggleSwitch(popup.description, `syncBlacklist`, false, `Blacklist`, false, false, null, esgst.syncBlacklist);
            new ToggleSwitch(popup.description, `syncHiddenGames`, false, `Hidden Games`, false, false, null, esgst.syncHiddenGames);
            new ToggleSwitch(popup.description, `syncGames`, false, `Owned/Wishlisted/Ignored Games`, false, false, null, esgst.syncGames);
            new ToggleSwitch(popup.description, `syncReducedCvGames`, false, `Reduced CV Games`, false, false, null, esgst.syncReducedCvGames);
            new ToggleSwitch(popup.description, `syncNoCvGames`, false, `No CV Games`, false, false, null, esgst.syncNoCvGames);
            new ToggleSwitch(popup.description, `syncGiveaways`, false, `Giveaways`, false, false, null, esgst.syncGiveaways);
        }
        syncer.progress = insertHtml(popup.description, `beforeEnd`, `
            <div class="esgst-hidden esgst-popup-progress"></div>
        `);
        syncer.scrollable = popup.scrollable;
        set = new ButtonSet(`green`, `grey`, `fa-refresh`, `fa-times`, `Sync`, `Cancel`, sync.bind(null, syncer, mainCallback), cancelSync.bind(null, syncer, mainCallback));
        popup.description.appendChild(set.set);
        popup.onClose = mainCallback;
        popup.open();
        if (syncer.autoSync) {
            set.trigger();
        }
    } else {
        document.body.innerHTML = ``;
        var description = insertHtml(document.body, `beforeEnd`, `
            <div class="description esgst-hidden esgst-popup-progress">
                <div></div>
                <div></div>
            </div>
        `);
        syncer.scrollable = description.firstElementChild;
        syncer.progress = description.lastElementChild;
        sync(syncer);
    }
}

function cancelSync(syncer, callback) {
    syncer.canceled = true;
    callback();
}

function sync(syncer, mainCallback, callback) {
    setSetting(`lastSync`, Date.now());
    syncer.progress.classList.remove(`esgst-hidden`);
    syncer.progress.innerHTML = `
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <span></span>
    `;
    if (!syncer.autoSync && !esgst.steamId && esgst.username) {
        syncer.progress.lastElementChild.textContent = `Syncing your Steam id...`;
        request(null, null, false, `https://www.steamgifts.com/user/${esgst.username}`, getSteamIdAndContinueSync.bind(null, syncer, completeSync.bind(null, syncer, mainCallback, callback)));
    } else {
        continueSyncStep1(syncer, completeSync.bind(null, syncer, mainCallback, callback));
    }
}

function completeSync(syncer, mainCallback, callback) {
    var currentDate;
    syncer.progress.innerHTML = `Synced!`;
    currentDate = new Date();
    setSetting(`lastSync`, currentDate.getTime());
    if (callback) {
        callback();
    }
    if (mainCallback) {
        mainCallback(currentDate);
    }
}

function getSteamIdAndContinueSync(syncer, callback, response) {
    setSetting(`steamId`, DOM.parse(response.responseText).querySelector(`a[href*="/profiles/"]`).getAttribute(`href`).match(/\d+/)[0]);
    continueSyncStep1(syncer, callback);
}

function continueSyncStep1(syncer, callback) {
    var i, key, n, newGroups, savedGiveaways, savedGroups;
    if (esgst.sg && (esgst.settings.syncGroups || syncer.autoSync)) {
        syncer.progress.lastElementChild.textContent = `Syncing your Steam groups...`;
        syncer.groups = {};
        savedGroups = JSON.parse(getValue(`groups`));
        if (!Array.isArray(savedGroups)) {
            newGroups = [];
            for (key in savedGroups) {
                newGroups.push(savedGroups[key]);
            }
            savedGroups = newGroups;
            setValue(`groups`, JSON.stringify(savedGroups));
            savedGiveaways = JSON.parse(getValue(`giveaways`));
            for (key in savedGiveaways) {
                delete savedGiveaways[key].groups;
            }
            setValue(`giveaways`, JSON.stringify(savedGiveaways));
        }
        syncer.currentGroups = {};
        for (i = 0, n = savedGroups.length; i < n; ++i) {
            if (savedGroups[i].member && savedGroups[i].steamId) {
                syncer.currentGroups[savedGroups[i].steamId] = savedGroups[i].name;
            }
        }
        syncer.newGroups = {};
        syncer.savedGroups = savedGroups;
        syncGroups(1, syncer, `https://www.steamgifts.com/account/steam/groups/search?page=`, continueSyncStep2.bind(null, syncer, callback));
    } else {
        continueSyncStep2(syncer, callback);
    }
}

function syncGroups(nextPage, syncer, url, callback) {
    if (!syncer.canceled) {
        request(null, null, false, `${url}${nextPage}`, getGroupsAndContinueSync.bind(null, nextPage, syncer, url, callback));
    }
}

function getGroupsAndContinueSync(nextPage, syncer, url, callback, response) {
    var elements, html, id, pagination, responseHtml, missing, neww;
    responseHtml = DOM.parse(response.responseText);
    elements = responseHtml.getElementsByClassName(`table__row-outer-wrap`);
    getGroupIds(elements, 0, elements.length, syncer, function () {
        pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
        if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
            setTimeout(syncGroups, 0, ++nextPage, syncer, url, callback);
        } else if (!syncer.canceled) {
            lockAndSaveGroups(syncer.groups, true, function () {
                missing = [];
                neww = [];
                for (id in syncer.currentGroups) {
                    if (!syncer.newGroups[id]) {
                        missing.push(`<a href="http://steamcommunity.com/gid/${id}">${syncer.currentGroups[id]}</a>`);
                    }
                }
                for (id in syncer.newGroups) {
                    if (!syncer.currentGroups[id]) {
                        neww.push(`<a href="http://steamcommunity.com/gid/${id}">${syncer.newGroups[id]}</a>`);
                    }
                }
                html = ``;
                if (missing.length) {
                    html += `
                        <div>
                            <span class="esgst-bold">Missing groups:</span> ${missing.join(`, `)}
                        </div>
                    `;
                }
                if (neww.length) {
                    html += `
                        <div>
                            <span class="esgst-bold">New groups:</span> ${neww.join(`, `)}
                        </div>
                    `;
                }
                syncer.scrollable.insertAdjacentHTML(`beforeEnd`, html);
                callback();
            });
        }
    });
}

function getGroupIds(elements, i, n, syncer, callback) {
    var avatar, code, element, heading, j, match, name;
    if (!syncer.canceled) {
        if (i < n) {
            element = elements[i];
            heading = element.getElementsByClassName(`table__column__heading`)[0];
            match = heading.getAttribute(`href`).match(/\/group\/(.+?)\/(.+)/);
            code = match[1];
            name = heading.textContent;
            for (j = syncer.savedGroups.length - 1; j >= 0 && syncer.savedGroups[j].code !== code; --j);
            if (j >= 0 && syncer.savedGroups[j].steamId) {
                syncer.groups[code] = {
                    member: true
                };
                syncer.newGroups[syncer.savedGroups[j].steamId] = name;
                setTimeout(getGroupIds, 0, elements, ++i, n, syncer, callback);
            } else {
                avatar = element.getElementsByClassName(`table_image_avatar`)[0].style.backgroundImage.match(/\/avatars\/(.+)_medium/)[1];
                request(null, null, false, `/group/${code}/`, getGroupId.bind(null, avatar, code, elements, i, n, name, syncer, callback));
            };
        } else {
            callback();
        }
    }
}

function getGroupId(avatar, code, elements, i, n, name, syncer, callback, response) {
    var steamId;
    steamId = DOM.parse(response.responseText).getElementsByClassName(`sidebar__shortcut-inner-wrap`)[0].firstElementChild.getAttribute(`href`).match(/\d+/)[0];
    syncer.groups[code] = {
        avatar: avatar,
        code: code,
        member: true,
        name: name,
        steamId: steamId
    };
    syncer.newGroups[steamId] = name;
    setTimeout(getGroupIds, 0, elements, ++i, n, syncer, callback);
}

function continueSyncStep2(syncer, callback) {
    if (!syncer.autoSync && (esgst.settings.syncWhitelist || esgst.settings.syncBlacklist)) {
        syncWhitelistBlacklist(syncer, continueSyncStep3.bind(null, syncer, callback));
    } else {
        continueSyncStep3(syncer, callback);
    }
}

function syncWhitelistBlacklist(syncer, callback) {
    if (!syncer.canceled) {
        if (esgst.settings.syncWhitelist && esgst.settings.syncBlacklist) {
            deleteUserValues([`whitelisted`, `whitelistedDate`, `blacklisted`, `blacklistedDate`], continueWhitelistBlacklistSync.bind(null, syncer, callback));
        } else if (esgst.settings.syncWhitelist) {
            deleteUserValues([`whitelisted`, `whitelistedDate`], continueWhitelistBlacklistSync.bind(null, syncer, callback));
        } else {
            deleteUserValues([`blacklisted`, `blacklistedDate`], continueWhitelistBlacklistSync.bind(null, syncer, callback));
        }
    }
}

function continueWhitelistBlacklistSync(syncer, callback) {
    if (esgst.settings.syncWhitelist) {
        syncer.progress.lastElementChild.textContent = `Syncing your whitelist...`;
        syncer.users = [];
        getWhitelistBlacklist(`whitelisted`, 1, syncer, `https://www.steamgifts.com/account/manage/whitelist/search?page=`, checkBlacklistSync.bind(null, syncer, callback));
    } else {
        syncer.progress.lastElementChild.textContent = `Syncing your blacklist...`;
        syncer.users = [];
        getWhitelistBlacklist(`blacklisted`, 1, syncer, `https://www.steamgifts.com/account/manage/blacklist/search?page=`, completeWhitelistBlacklistSync.bind(null, syncer, callback));
    }
}

function getWhitelistBlacklist(key, nextPage, syncer, url, callback) {
    if (!syncer.canceled) {
        request(null, null, false, `${url}${nextPage}`, getWhitelistBlacklistAndContinueSync.bind(null, key, nextPage, syncer, url, callback));
    }
}

function getWhitelistBlacklistAndContinueSync(key, nextPage, syncer, url, callback, response) {
    var element, elements, i, n, pagination, responseHtml, user;
    responseHtml = DOM.parse(response.responseText);
    elements = responseHtml.getElementsByClassName(`table__row-outer-wrap`);
    for (i = 0, n = elements.length; i < n; ++i) {
        element = elements[i];
        user = {
            id: element.querySelector(`[name="child_user_id"]`).value,
            username: element.getElementsByClassName(`table__column__heading`)[0].textContent,
            values: {}
        };
        user.values[key] = true;
        user.values[`${key}Date`] = parseInt(element.querySelector(`[data-timestamp]`).getAttribute(`data-timestamp`)) * 1e3;
        syncer.users.push(user);
    }
    pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
    if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
        setTimeout(getWhitelistBlacklist, 0, key, ++nextPage, syncer, url, callback);
    } else if (!syncer.canceled) {
        callback();
    }
}

function checkBlacklistSync(syncer, callback) {
    if (esgst.settings.syncBlacklist) {
        syncer.progress.lastElementChild.textContent = `Syncing your blacklist...`;
        getWhitelistBlacklist(`blacklisted`, 1, syncer, `https://www.steamgifts.com/account/manage/blacklist/search?page=`, completeWhitelistBlacklistSync.bind(null, syncer, callback));
    } else {
        completeWhitelistBlacklistSync(syncer, callback);
    }
}

function completeWhitelistBlacklistSync(syncer, callback) {
    if (!syncer.canceled) {
        syncer.progress.lastElementChild.textContent = `Saving your whitelist/blacklist (this may take a while)...`;
        saveUsers(syncer.users, callback);
    }
}

function continueSyncStep3(syncer, callback) {
    if (!syncer.autoSync && esgst.settings.syncHiddenGames) {
        syncer.progress.lastElementChild.textContent = `Syncing your hidden games...`;
        syncer.hiddenGames = {
            apps: [],
            subs: []
        };
        syncHiddenGames(1, syncer, `https://www.steamgifts.com/account/settings/giveaways/filters/search?page=`, continueSyncStep4.bind(null, syncer, callback));
    } else {
        continueSyncStep4(syncer, callback);
    }
}

function syncHiddenGames(nextPage, syncer, url, callback) {
    request(null, null, false, `${url}${nextPage}`, getHiddenGames.bind(null, nextPage, syncer, url, callback));
}

function getHiddenGames(nextPage, syncer, url, callback, response) {
    var elements, i, match, n, pagination, responseHtml;
    responseHtml = DOM.parse(response.responseText);
    elements = responseHtml.querySelectorAll(`.table__column__secondary-link[href*="store.steampowered.com"]`);
    for (i = 0, n = elements.length; i < n; ++i) {
        match = elements[i].getAttribute(`href`).match(/(app|sub)\/(\d+)/);
        if (match) {
            syncer.hiddenGames[`${match[1]}s`].push(match[2]);
        }
    }
    pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
    if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
        setTimeout(syncHiddenGames, 0, ++nextPage, syncer, url, callback);
    } else {
        createLock(`gameLock`, 300, saveHiddenGames.bind(null, syncer, callback));
    }
}

function saveHiddenGames(syncer, callback, deleteLock) {
    var key, i, n, savedGames;
    savedGames = JSON.parse(getValue(`games`));
    for (key in savedGames.apps) {
        delete savedGames.apps[key].hidden;
    }
    for (key in savedGames.subs) {
        delete savedGames.subs[key].hidden;
    }
    for (i = 0, n = syncer.hiddenGames.apps.length; i < n; ++i) {
        if (!savedGames.apps[syncer.hiddenGames.apps[i]]) {
            savedGames.apps[syncer.hiddenGames.apps[i]] = {};
        }
        savedGames.apps[syncer.hiddenGames.apps[i]].hidden = true;
    }
    for (i = 0, n = syncer.hiddenGames.subs.length; i < n; ++i) {
        if (!savedGames.subs[syncer.hiddenGames.subs[i]]) {
            savedGames.subs[syncer.hiddenGames.subs[i]] = {};
        }
        savedGames.subs[syncer.hiddenGames.subs[i]].hidden = true;
    }
    setValue(`games`, JSON.stringify(savedGames));
    deleteLock();
    callback();
}

function continueSyncStep4(syncer, callback) {
    if (syncer.autoSync || esgst.settings.syncGames) {
        syncer.progress.lastElementChild.textContent = `Syncing your wishlisted/owned/ignored games...`;
        syncGames(syncer, syncAltAccounts.bind(null, 0, esgst.settings.gc_o_altAccounts.length, syncer, continueSyncStep5.bind(null, syncer, callback)));
    } else {
        continueSyncStep5(syncer, callback);
    }
}

function syncGames(syncer, callback) {
    if (esgst.steamApiKey) {
        request(null, null, false, `http://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=${esgst.steamApiKey}&steamid=${esgst.steamId}&format=json`, getApiResponseAndContinueSync.bind(null, syncer, callback));
    } else {
        request(null, null, false, `http://store.steampowered.com/dynamicstore/userdata`, getStoreResponseAndContinueSync.bind(null, syncer, callback, null));
    }
}

function syncAltAccounts(i, n, syncer, callback, games, html) {
    var altAccount;
    if (i < n) {
        altAccount = esgst.settings.gc_o_altAccounts[i];
        request(null, null, false, `http://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=${esgst.steamApiKey}&steamid=${altAccount.steamId}&format=json`, continueGameSync.bind(null, altAccount, html, syncer, setTimeout.bind(null, syncAltAccounts, 0, ++i, n, syncer, callback)));
    } else {
        setSetting(`gc_o_altAccounts`, esgst.settings.gc_o_altAccounts);
        callback(null, html);
    }
}

function getApiResponseAndContinueSync(syncer, callback, response) {
    request(null, null, false, `http://store.steampowered.com/dynamicstore/userdata`, getStoreResponseAndContinueSync.bind(null, syncer, callback, response));
}

function getStoreResponseAndContinueSync(syncer, callback, response1, response2) {
    createLock(`gameLock`, 300, continueGameSync.bind(null, null, null, syncer, callback, response1, response2));
}

function continueGameSync(altAccount, html, syncer, callback, response1, response2, deleteLock) {
    var currentOwned, newOwned, i, id, j, key, mainKey, n, numOwned, numValues, oldValue, owned, ownedGames, responseJson, responseText, result, savedGames, type, types, values;
    owned = 0;
    if (altAccount) {
        savedGames = altAccount.games;
    } else {
        savedGames = JSON.parse(getValue(`games`));
    }
    currentOwned = {
        apps: [],
        subs: []
    };
    newOwned = {
        apps: [],
        subs: []
    };
    for (key in savedGames.apps) {
        if (savedGames.apps[key].owned) {
            currentOwned.apps.push(key);
        }
        delete savedGames.apps[key].wishlist;
        delete savedGames.apps[key].wishlisted;
        delete savedGames.apps[key].owned;
        delete savedGames.apps[key].ignored;
        if (!Object.keys(savedGames.apps[key]).length) {
            delete savedGames.apps[key];
        }
    }
    for (key in savedGames.subs) {
        if (savedGames.subs[key].owned) {
            currentOwned.subs.push(key);
        }
        delete savedGames.subs[key].wishlist;
        delete savedGames.subs[key].wishlisted;
        delete savedGames.subs[key].owned;
        delete savedGames.subs[key].ignored;
        if (!Object.keys(savedGames.subs[key]).length) {
            delete savedGames.subs[key];
        }
    }
    if (response1) {
        responseText = response1.responseText;
        if (!responseText.match(/(<title>Forbidden<\/title>|<TITLE>Access Denied<\/TITLE>)/)) {
            ownedGames = JSON.parse(responseText).response.games;
            for (i = 0, n = ownedGames.length; i < n; ++i) {
                id = ownedGames[i].appid;
                if (!savedGames.apps[id]) {
                    savedGames.apps[id] = {};
                }
                savedGames.apps[id].owned = true;
                ++owned;
                newOwned.apps.push(id.toString());
            }
        }
    }
    if (response2 && !response2.responseText.match(/<TITLE>Access Denied<\/TITLE>/)) {
        responseJson = JSON.parse(response2.responseText);
        numOwned = responseJson.rgOwnedApps.length;
        if (numOwned > 0) {
            types = [
                {
                    key: `wishlisted`,
                    mainKey: `apps`,
                    name: `rgWishlist`
                },
                {
                    key: `owned`,
                    mainKey: `apps`,
                    name: `rgOwnedApps`
                },
                {
                    key: `owned`,
                    mainKey: `subs`,
                    name: `rgOwnedPackages`
                },
                {
                    key: `ignored`,
                    mainKey: `apps`,
                    name: `rgIgnoredApps`
                },
                {
                    key: `ignored`,
                    mainKey: `subs`,
                    name: `rgIgnoredPackages`
                }
            ];
            for (i = 0, n = types.length; i < n; ++i) {
                type = types[i];
                key = type.key;
                mainKey = type.mainKey;
                values = responseJson[type.name];
                for (j = 0, numValues = values.length; j < numValues; ++j) {
                    id = values[j];
                    if (!savedGames[mainKey][id]) {
                        savedGames[mainKey][id] = {};
                    }
                    oldValue = savedGames[mainKey][id][key];
                    savedGames[mainKey][id][key] = true;
                    if (key === `owned` && !oldValue) {
                        ++owned;
                        newOwned[mainKey].push(id.toString());
                    }
                }
            }
        }
    }
    if (!altAccount) {
        if (response1 || response2) {
            if (owned !== getValue(`ownedGames`, 0)) {
                setValue(`ownedGames`, owned);
                result = 1;
            } else {
                result = 2;
            }
        } else {
            result = 3;
        }
        setValue(`games`, JSON.stringify(savedGames));
        deleteLock();
    }
    var missing = {
        apps: [],
        subs: []
    };
    var neww = {
        apps: [],
        subs: []
    };
    for (i = 0, n = currentOwned.apps.length; i < n; ++i) {
        id = currentOwned.apps[i];
        if (newOwned.apps.indexOf(id) < 0) {
            missing.apps.push(`<a href="http://store.steampowered.com/app/${id}">${id}</a>`);
        }
    }
    for (i = 0, n = currentOwned.subs.length; i < n; ++i) {
        id = currentOwned.subs[i];
        if (newOwned.subs.indexOf(id) < 0) {
            missing.subs.push(`<a href="http://store.steampowered.com/sub/${id}">${id}</a>`);
        }
    }
    for (i = 0, n = newOwned.apps.length; i < n; ++i) {
        id = newOwned.apps[i];
        if (currentOwned.apps.indexOf(id) < 0) {
            neww.apps.push(`<a href="http://store.steampowered.com/app/${id}">${id}</a>`);
        }
    }
    for (i = 0, n = newOwned.subs.length; i < n; ++i) {
        id = newOwned.subs[i];
        if (currentOwned.subs.indexOf(id) < 0) {
            neww.subs.push(`<a href="http://store.steampowered.com/sub/${id}">${id}</a>`);
        }
    }
    if (!html) {
        html = ``;
    }
    if (altAccount) {
        html += `
            <div>Alt Account - ${altAccount.name}</div>
        `;
    }
    if (missing.apps.length) {
        html += `
            <div>
                <span class="esgst-bold">Missing apps:</span> ${missing.apps.join(`, `)}
            </div>
        `;
    }
    if (missing.subs.length) {
        html += `
            <div>
                <span class="esgst-bold">Missing packages:</span> ${missing.subs.join(`, `)}
            </div>
        `;
    }
    if (neww.apps.length) {
        html += `
            <div>
                <span class="esgst-bold">New apps:</span> ${neww.apps.join(`, `)}
            </div>
        `;
    }
    if (neww.subs.length) {
        html += `
            <div>
                <span class="esgst-bold">New packages:</span> ${neww.subs.join(`, `)}
            </div>
        `;
    }
    callback(savedGames, html, result);
}

function continueSyncStep5(syncer, callback, games, html) {
    if (html) {
        syncer.scrollable.insertAdjacentHTML(`beforeEnd`, html);
    }
    if (!syncer.autoSync && esgst.settings.syncReducedCvGames) {
        syncer.progress.lastElementChild.textContent = `Syncing reduced CV games...`;
        request(null, null, false, `https://script.google.com/macros/s/AKfycbwJK-7RBh5ghaKprEsmx4DQ6CyXc_3_9eYiOCu3yhI6W4B3W4YN/exec`, syncCvGames.bind(null, syncer, continueSyncStep6.bind(null, syncer, callback)));
    } else {
        continueSyncStep6(syncer, callback);
    }
}

function continueSyncStep6(syncer, callback) {
    if (!syncer.autoSync && esgst.settings.syncNoCvGames) {
        syncer.progress.lastElementChild.textContent = `Syncing no CV games...`;
        request(null, null, false, `https://script.google.com/macros/s/AKfycbym0nzeyr3_b93ViuiZRivkBMl9PBI2dTHQxNC0rtgeQSlCTI-P/exec`, syncCvGames.bind(null, syncer, continueSyncStep7.bind(null, syncer, callback)));
    } else {
        continueSyncStep7(syncer, callback);
    }
}

function continueSyncStep7(syncer, callback) {
    if (!syncer.autoSync && esgst.settings.syncGiveaways && esgst.sg) {
        syncer.progress.lastElementChild.textContent = `Syncing your giveaways...`;
        var user = {
            steamId: esgst.steamId,
            username: esgst.username
        };
        var savedUser = getUser(null, user), ugd, giveaways;
        if (savedUser) {
            giveaways = savedUser.giveaways;
        }
        if (!giveaways) {
            giveaways = {
                sent: {
                    apps: {},
                    subs: {}
                },
                won: {
                    apps: {},
                    subs: {}
                },
                sentTimestamp: 0,
                wonTimestamp: 0
            };
            if (savedUser) {
                ugd = savedUser.ugd;
                if (ugd) {
                    var ggiveaways = {};
                    if (ugd.sent) {
                        for (var key in ugd.sent.apps) {
                            giveaways.sent.apps[key] = [];
                            for (var i = 0, n = ugd.sent.apps[key].length; i < n; ++i) {
                                ggiveaways[ugd.sent.apps[key][i].code] = ugd.sent.apps[key][i];
                                giveaways.sent.apps[key].push(ugd.sent.apps[key][i].code);
                            }
                        }
                        for (var key in ugd.sent.subs) {
                            giveaways.sent.subs[key] = [];
                            for (var i = 0, n = ugd.sent.subs[key].length; i < n; ++i) {
                                ggiveaways[ugd.sent.subs[key][i].code] = ugd.sent.subs[key][i];
                                giveaways.sent.subs[key].push(ugd.sent.subs[key][i].code);
                            }
                        }
                        giveaways.sentTimestamp = ugd.sentTimestamp;
                    }
                    if (ugd.won) {
                        for (var key in ugd.won.apps) {
                            giveaways.won.apps[key] = [];
                            for (var i = 0, n = ugd.won.apps[key].length; i < n; ++i) {
                                ggiveaways[ugd.won.apps[key][i].code] = ugd.won.apps[key][i];
                                giveaways.won.apps[key].push(ugd.won.apps[key][i].code);
                            }
                        }
                        for (var key in ugd.won.subs) {
                            giveaways.won.subs[key] = [];
                            for (var i = 0, n = ugd.won.subs[key].length; i < n; ++i) {
                                ggiveaways[ugd.won.subs[key][i].code] = ugd.won.subs[key][i];
                                giveaways.won.subs[key].push(ugd.won.subs[key][i].code);
                            }
                        }
                        giveaways.wonTimestamp = ugd.wonTimestamp;
                    }
                    if (Object.keys(ggiveaways).length > 0) {
                        lockAndSaveGiveaways(ggiveaways);
                    }
                }
            }
        }
        var UGD = {
            Key: `sent`
        };
        UGD.giveaways = {};
        getUGDGiveaways(UGD, giveaways, 1, `/user/${esgst.username}/search?page=`, esgst.username, function (giveaways) {
            user.values = {
                giveaways: giveaways,
                ugd: null
            };
            saveUser(null, null, user, callback);
        });
    } else {
        callback();
    }
}

function lockAndSaveGiveaways(giveaways, callback) {
    createLock(`giveawayLock`, 300, saveGiveaways.bind(null, giveaways, callback));
}

function saveGiveaways(giveaways, callback, deleteLock) {
    var key, savedGiveaways, subKey;
    savedGiveaways = JSON.parse(getValue(`giveaways`, `{}`));
    for (key in giveaways) {
        if (savedGiveaways[key]) {
            for (subKey in giveaways[key]) {
                savedGiveaways[key][subKey] = giveaways[key][subKey];
            }
        } else {
            savedGiveaways[key] = giveaways[key];
        }
    }
    setValue(`giveaways`, JSON.stringify(savedGiveaways));
    deleteLock();
    if (callback) {
        callback();
    }
}

function lockAndSaveGroups(groups, sync, callback) {
    createLock(`groupLock`, 300, saveGroups.bind(null, groups, sync, callback));
}

function saveGroups(groups, sync, callback, deleteLock) {
    var code, i, key, n, savedGroups;
    savedGroups = JSON.parse(getValue(`groups`, `[]`));
    if (sync) {
        for (i = 0, n = savedGroups.length; i < n; ++i) {
            delete savedGroups[i].member;
        }
    }
    for (code in groups) {
        for (i = 0, n = savedGroups.length; i < n && savedGroups[i].code !== code; ++i);
        if (i < n) {
            for (key in groups[code]) {
                savedGroups[i][key] = groups[code][key];
            }
        } else {
            savedGroups.push(groups[code]);
        }
    }
    setValue(`groups`, JSON.stringify(savedGroups));
    deleteLock();
    if (callback) {
        callback();
    }
}

function sortArray(Array) {
    return Array.sort(function (A, B) {
        return A.localeCompare(B, {
            sensitivity: `base`
        });
    });
}

function sortArrayByKey(array, key) {
    return array.sort(function (a, b) {
        return a[key].localeCompare(b[key], {
            sensitivity: `base`
        });
    });
}

function sortArrayByNumberKey(array, numberKey) {
    return array.sort(function (a, b) {
        if (a[numberKey] < b[numberKey]) {
            return -1;
        } else if (a[numberKey] > b[numberKey]) {
            return 1;
        } else {
            return 0;
        }
    });
}

function setSiblingsOpacity(Element, Opacity) {
    var Siblings, I, N;
    Siblings = Element.parentElement.children;
    for (I = 0, N = Siblings.length; I < N; ++I) {
        if (Siblings[I] != Element) {
            Siblings[I].style.opacity = Opacity;
        }
    }
}

function setHoverOpacity(Element, EnterOpacity, LeaveOpacity) {
    Element.addEventListener(`mouseenter`, function () {
        Element.style.opacity = EnterOpacity;
    });
    Element.addEventListener(`mouseleave`, function () {
        Element.style.opacity = LeaveOpacity;
    });
}

/*
    * Helper Functions
    */

/* Lock */

function createUuid(c) {
    var r, v;
    r = Math.random() * 16 | 0;
    v = c === `x` ? r : (r & 0x3 | 0x8);
    return v.toString(16);
}

function createLock(key, threshold, callback) {
    var lock;
    lock = {
        callback: callback,
        continue: false,
        key: key,
        threshold: threshold,
        uuid: `xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`.replace(/[xy]/g, createUuid)
    };
    checkLock(lock);
}

function checkLock(lock) {
    var locked;
    locked = JSON.parse(getValue(lock.key, `{}`));
    if (!locked || !locked.uuid || locked.timestamp < Date.now() - (lock.threshold + 1000)) {
        setValue(lock.key, JSON.stringify({
            timestamp: Date.now(),
            uuid: lock.uuid
        }));
        setTimeout(function () {
            locked = JSON.parse(getValue(lock.key, `{}`));
            if (locked && locked.uuid === lock.uuid) {
                setTimeout(lock.callback, 0, function () {
                    setValue(lock.key, `{}`);
                });
            } else {
                setTimeout(checkLock, 0, lock);
            }
        }, lock.threshold / 2);
    } else {
        setTimeout(checkLock, lock.threshold / 3, lock);
    }
}

/* Request */

function request(data, headers, queue, url, callback) {
    if (!headers) {
        headers = {};
    }
    if (queue) {
        createLock(`requestLock`, 1000, function (closeLock) {
            continueRequest(data, headers, url, callback, closeLock);
        });
    } else {
        continueRequest(data, headers, url, callback);
    }
}

function continueRequest(data, headers, url, callback, closeLock) {
    if (!headers[`Content-Type`]) {
        headers[`Content-Type`] = `application/x-www-form-urlencoded`;
    }
    chrome.runtime.sendMessage({
        action: `fetch`,
        parameters: JSON.stringify({
            body: data,
            credentials: `include`,
            headers: headers,
            method: data ? `POST` : `GET`,
            redirect: `follow`
        }),
        url: url.replace(/^\//, `https://${location.hostname}/`).replace(/^https?:/, location.href.match(/^http:/) ? `http:` : `https:`)
    }, response => {
        if (closeLock) {
            closeLock();
        }
        response = JSON.parse(response);
        if (response.finalUrl.match(/www.steamgifts.com/)) {
            lookForPopups(response);
        }
        if (callback) {
            callback(response);
        }
    });
}

function lookForPopups(response) {
    var popup, responseHtml;
    responseHtml = DOM.parse(response.responseText);
    popup = responseHtml.querySelector(`.popup--gift-sent, .popup--gift-received`);
    if (popup) {
        document.body.appendChild(popup);
        new Popup(null, null, true, false, popup).open();
    }
}

function createTooltip(context, message) {
    var popout;
    popout = new Popout(`esgst-feature-description markdown`, context, 100);
    popout.popout.style.maxHeight = `300px`;
    popout.popout.style.overflow = `auto`;
    popout.popout.innerHTML = message;
}

function createOptions(options) {
    var context, elements, id, switches;
    context = document.createElement(`div`);
    elements = {};
    switches = {};
    options.forEach(option => {
        if (option.check) {
            id = option.id;
            elements[id] = insertHtml(context, `beforeEnd`, `
                <div></div>
            `);
            switches[id] = new ToggleSwitch(elements[id], id, false, option.description, false, false, option.tooltip, esgst[id]);
        }
    });
    options.forEach(option => {
        let enabled = esgst[option.id];
        if (switches[option.id]) {
            if (option.dependencies) {
                option.dependencies.forEach(dependency => {
                    if (elements[dependency]) {
                        switches[option.id].dependencies.push(elements[dependency]);
                        if (!enabled) {
                            elements[dependency].classList.add(`esgst-hidden`);
                        }
                    }
                });
            }
            if (option.exclusions) {
                option.exclusions.forEach(exclusion => {
                    if (elements[exclusion]) {
                        switches[option.id].exclusions.push(elements[exclusion]);
                        if (enabled) {
                            elements[exclusion].classList.add(`esgst-hidden`);
                        }
                    }
                });
            }
        }
    });
    return context;
}

function createResults(Context, Element, Results) {
    var I, N, Key;
    for (I = 0, N = Results.length; I < N; ++I) {
        Context.insertAdjacentHTML(`beforeEnd`, `
            <li class="esgst-hidden">
                ${Results[I].Icon}
                <span class="esgst-bold">${Results[I].Description} (<span>0</span>):</span>
                <span class="popup__actions"></span>
            </li>
        `);
        Key = Results[I].Key;
        Element[Key] = Context.lastElementChild;
        Element[`${Key}Count`] = Element[Key].firstElementChild.nextElementSibling.firstElementChild;
        Element[`${Key}Users`] = Element[Key].lastElementChild;
    }
}

function goToComment(hash, Element) {
    var element, ID, Top, Permalink;
    if (!hash) {
        hash = location.hash;
    }
    ID = hash.replace(/#/, ``);
    if ((ID || Element) && !location.pathname.match(/^\/account/)) {
        if (!Element && ID) {
            Element = document.getElementById(ID);
        }
        if (Element) {
            Top = Element.offsetTop;
            scrollTo(0, Top);
            scrollBy(0, -esgst.commentsTop);
            Permalink = document.getElementsByClassName(esgst.sg ? `is_permalink` : `author_permalink`)[0];
            if (Permalink) {
                Permalink.remove();
            }
            element = Element.getElementsByClassName(esgst.sg ? `comment__username` : `author_avatar`)[0];
            if (element) {
                element.insertAdjacentHTML(esgst.sg ? `beforeBegin` : `afterEnd`, `
                    <i class="fa fa-share is_permalink author_permalink"></i>
                `);
            }
        }
    }
}

function syncCvGames(syncer, callback, response) {
    lockAndSaveGames(JSON.parse(response.responseText).success, callback);
}

    function lockAndSaveGames(games, callback) {
    createLock(`gameLock`, 300, saveGames.bind(null, games, callback));
}

function saveGames(games, callback, deleteLock) {
    var key, saved, subKey;
    saved = JSON.parse(getValue(`games`));
    for (key in games.apps) {
        if (saved.apps[key]) {
            for (subKey in games.apps[key]) {
                saved.apps[key][subKey] = games.apps[key][subKey];
            }
        } else {
            saved.apps[key] = games.apps[key];
        }
    }
    for (key in games.subs) {
        if (saved.subs[key]) {
            for (subKey in games.subs[key]) {
                saved.subs[key][subKey] = games.subs[key][subKey];
            }
        } else {
            saved.subs[key] = games.subs[key];
        }
    }
    setValue(`games`, JSON.stringify(saved));
    deleteLock();
    if (callback) {
        callback();
    }
}

function formatDate(EntryDate) {
    var Months, Hours, Minutes, OutputDate, Suffix;
    Months = [`Jan`, `Feb`, `Mar`, `Apr`, `May`, `Jun`, `Jul`, `Aug`, `Sep`, `Oct`, `Nov`, `Dec`];
    Hours = EntryDate.getHours();
    Minutes = EntryDate.getMinutes();
    Minutes = (Minutes > 9) ? Minutes : (`0${Minutes}`);
    OutputDate = `${Months[EntryDate.getMonth()]} ${EntryDate.getDate()}, ${EntryDate.getFullYear()} `;
    if (Hours >= 12) {
        if (Hours > 12) {
            Hours -= 12;
        }
        Suffix = `pm`;
    } else {
        if (Hours === 0) {
            Hours = 12;
        }
        Suffix = `am`;
    }
    OutputDate += `${Hours}:${Minutes} ${Suffix}`;
    return OutputDate;
}

/*
    * Features
    */

/* [FH] Fixed Header */

function loadFh() {
    let height;
    esgst.header.classList.add(`esgst-fh`);
    if (esgst.featuredContainer && (!esgst.hfc || !esgst.giveawaysPath)) {
        esgst.featuredContainer.classList.add(`esgst-fh-sibling`);
    } else {
        esgst.pageOuterWrap.classList.add(`esgst-fh-sibling`);
    }
    height = esgst.header.offsetHeight;
    esgst.pageTop += height;
    esgst.commentsTop += height;
    esgst.style.insertAdjacentText(`beforeEnd`, `
        .esgst-fh-sibling {
            margin-top: ${height}px;
        }
    `);
}

/* [FS] Fixed Sidebar */

function loadFs() {
    var ad, sibling, top;
    if (esgst.sidebar) {
        ad = esgst.sidebar.getElementsByClassName(`sidebar__mpu`)[0];
        sibling = esgst.sidebar.nextElementSibling;
        document.addEventListener(`scroll`, fixSidebar);
        fixSidebar();
        esgst.style.insertAdjacentText(`beforeEnd`, `
            .esgst-fs {
                position: fixed;
                top: ${esgst.pageTop}px;
            }
        `);
    }

    function fixSidebar() {
        if (esgst.sidebar.offsetTop >= esgst.pageTop) {
            top = esgst.sidebar.offsetTop - esgst.pageTop;
        } else {
            top = esgst.sidebar.offsetTop;
        }
        if (scrollY > top && document.documentElement.offsetHeight > innerHeight * 2) {
            document.removeEventListener(`scroll`, fixSidebar);
            esgst.sidebar.classList.add(`esgst-fs`);
            if (ad) {
                ad.classList.add(`esgst-hidden`);
            }
            sibling.style.marginLeft = `${esgst.sidebar.offsetWidth + 25}px`;
            document.addEventListener(`scroll`, unfixSidebar);
        }
    }

    function unfixSidebar() {
        if (scrollY <= top) {
            document.removeEventListener(`scroll`, unfixSidebar);
            esgst.sidebar.classList.remove(`esgst-fs`);
            if (ad) {
                ad.classList.remove(`esgst-hidden`);
            }
            sibling.style.marginLeft = `25px`;
            document.addEventListener(`scroll`, fixSidebar);
        }
    }
}

/* [FMPH] Fixed Main Page Heading */

function loadFmph() {
    var height, html, newHeight, width;
    if (esgst.mainPageHeading) {
        html = `
            <div class="esgst-fmph-placeholder esgst-hidden"></div>
            <div class="esgst-fmph-background ${esgst.pageOuterWrapClass} esgst-hidden"></div>
        `;
        esgst.mainPageHeading.insertAdjacentHTML(`afterEnd`, html);
        esgst.mainPageHeadingPlaceholder = esgst.mainPageHeading.nextElementSibling;
        esgst.mainPageHeadingBackground = esgst.mainPageHeadingPlaceholder.nextElementSibling;
        document.addEventListener(`scroll`, fixMainPageHeading);
        fixMainPageHeading();
        height = esgst.mainPageHeading.offsetHeight;
        newHeight = (esgst.gf && (esgst.giveawaysPath || esgst.groupsPath || esgst.createdPath || esgst.enteredPath || esgst.wonPath)) || (esgst.df && esgst.discussionsPath) ? height + 23 : height;
        esgst.style.insertAdjacentText(`beforeEnd`, `
            .esgst-fmph {
                position: fixed;
                top: ${esgst.pageTop}px;
                z-index: 998;
            }
            .esgst-fmph-placeholder {
                height: ${newHeight}px;
            }
            .esgst-fmph-background {
                height: ${esgst.pageTop + newHeight + 5}px;
                padding: 0;
                position: fixed;
                top: 0;
                z-index: 997;
            }
            .esgst-gf-container-fixed {
                position: fixed;
                top: ${esgst.pageTop + 34}px;
                z-index: 998;
            }
        `);
        esgst.commentsTop += height + 30;
    }

    function fixMainPageHeading() {
        if (scrollY > (esgst.mainPageHeading.offsetTop - esgst.pageTop)) {
            document.removeEventListener(`scroll`, fixMainPageHeading);
            esgst.mainPageHeading.classList.add(`esgst-fmph`);
            esgst.mainPageHeadingPlaceholder.classList.remove(`esgst-hidden`);
            esgst.mainPageHeadingBackground.classList.remove(`esgst-hidden`);
            width = `${getComputedStyle(esgst.mainPageHeading.parentElement).getPropertyValue(`width`)}`;
            esgst.mainPageHeading.style.width = width;
            esgst.mainPageHeadingBackground.style.width = width;
            if (esgst.gf && esgst.gf.container) {
                esgst.gf.container.classList.add(`esgst-gf-container-fixed`);
                esgst.gf.container.style.width = width;
            }
            if (esgst.df && esgst.df.container) {
                esgst.df.container.classList.add(`esgst-gf-container-fixed`);
                esgst.df.container.style.width = width;
            }
            document.addEventListener(`scroll`, unfixMainPageHeading);
        }
    }

    function unfixMainPageHeading() {
        if (scrollY <= (esgst.mainPageHeadingPlaceholder.offsetTop - esgst.pageTop)) {
            document.removeEventListener(`scroll`, unfixMainPageHeading);
            esgst.mainPageHeading.classList.remove(`esgst-fmph`);
            esgst.mainPageHeadingPlaceholder.classList.add(`esgst-hidden`);
            esgst.mainPageHeadingBackground.classList.add(`esgst-hidden`);
            width = ``;
            esgst.mainPageHeading.style.width = width;
            esgst.mainPageHeadingBackground.style.width = width;
            if (esgst.gf && esgst.gf.container) {
                esgst.gf.container.classList.remove(`esgst-gf-container-fixed`);
            }
            if (esgst.df && esgst.df.container) {
                esgst.df.container.classList.remove(`esgst-gf-container-fixed`);
            }
            document.addEventListener(`scroll`, fixMainPageHeading);
        }
    }
}

/* [FF] Fixed Footer */

function loadFf() {
    esgst.footer.classList.add(`esgst-ff`);
    esgst.pageOuterWrap.classList.add(`esgst-ff-sibling`);
}

/* [PNOT] Pagination Navigation On Top */

function loadPnot() {
    if (esgst.paginationNavigation && esgst.mainPageHeading) {
        esgst.paginationNavigation.classList.add(`page_heading_btn`);
        esgst.mainPageHeading.appendChild(esgst.paginationNavigation);
    }
}

/* [SK] Shortcut Keys */

function loadSk() {
    let methods = {};
    if (esgst.sk_cp) {
        methods[esgst.sk_closePopups] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/)) {
                let buttons = document.querySelectorAll(`.b-close, .esgst-popup-close`), i;
                for (i = buttons.length - 1; i > -1; --i) {
                    buttons[i].click();
                }
                event.preventDefault();
            }
        };
    }
    if (esgst.sk_sb) {
        methods[esgst.sk_searchBox] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/)) {
                let search = document.getElementsByClassName(`sidebar__search-input`)[0];
                if (search) {
                    search.focus();
                    event.preventDefault();
                }
            }
        };
    }
    if (esgst.sk_fp) {
        methods[esgst.sk_firstPage] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.paginationNavigation && esgst.currentPage > 1) {
                location.href = `${esgst.searchUrl}1`;
                event.preventDefault();
            }
        };
    }
    if (esgst.sk_pp) {
        methods[esgst.sk_previousPage] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.paginationNavigation && esgst.currentPage > 1) {
                location.href = `${esgst.searchUrl}${esgst.currentPage - 1}`;
                event.preventDefault();
            }
        };
    }
    if (esgst.sk_np) {
        methods[esgst.sk_nextPage] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.paginationNavigation && esgst.currentPage < esgst.lastPage) {
                location.href = `${esgst.searchUrl}${esgst.currentPage + 1}`;
                event.preventDefault();
            }
        };
    }
    if (esgst.sk_lp) {
        methods[esgst.sk_lastPage] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.paginationNavigation && esgst.currentPage < esgst.lastPage && esgst.lastPage !== 999999999) {
                location.href = `${esgst.searchUrl}${esgst.lastPage}`;
                event.preventDefault();
            }
        };
    }
    if (esgst.sk_tf) {
        methods[esgst.sk_toggleFilters] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/)) {
                let toggle = document.querySelector(`.esgst-gf-toggle-switch`);
                if (toggle) {
                    toggle.click();
                    event.preventDefault();
                }
            }
        };
    }
    if (esgst.sk_hg) {
        methods[esgst.sk_hideGame] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.giveawayPath) {
                let button = (document.getElementsByClassName(`popup--hide-games`)[0].style.display && document.getElementsByClassName(`popup--hide-games`)[0].style.display !== `none` && document.getElementsByClassName(`js__submit-hide-games`)[0]) || document.querySelector(`.esgst-ochgb, .giveaway__hide, .featured__giveaway__hide`);
                if (button) {
                    button.click();
                    event.preventDefault();
                }
            }
        };
    }
    if (esgst.sk_hga) {
        methods[esgst.sk_hideGiveaway] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.giveawayPath) {
                let button = document.querySelector(`.esgst-gf-hide-button, .esgst-gf-unhide-button`);
                if (button) {
                    button.firstElementChild.click();
                    event.preventDefault();
                }
            }
        };
    }
    if (esgst.sk_ge) {
        methods[esgst.sk_giveawayEntry] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.enterGiveawayButton) {
                if (esgst.enterGiveawayButton.classList.contains(`is-hidden`)) {
                    esgst.leaveGiveawayButton.click();
                } else {
                    esgst.enterGiveawayButton.click();
                }
                event.preventDefault();
            }
        };
    }
    if (esgst.sk_c) {
        methods[esgst.sk_creator] = event => {
            if (event.target.tagName.match(/^(INPUT|TEXTAREA)$/)) {
                let text = event.target.value;
                let end = event.target.selectionEnd;
                let creator = document.querySelector(`.featured__column--width-fill.text-right a, .comment__username, .author_name`);
                if (creator) {
                    creator = creator.textContent;
                    let range = end + creator.length;
                    event.target.value = `${text.slice(0, event.target.selectionStart)}${creator}${text.slice(end)}`;
                    event.target.setSelectionRange(range, range);
                    event.target.focus();
                    event.preventDefault();
                }
            }
        };
    }
    if (esgst.sk_rb) {
        methods[esgst.sk_replyBox] = event => {
            if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.replyBox) {
                esgst.replyBox.getElementsByTagName(`textarea`)[0].focus();
                event.preventDefault();
            }
        };
    }
    if (esgst.sk_ru) {
        methods[esgst.sk_replyUser] = event => {
            if (event.target.tagName === `TEXTAREA`) {
                let text = event.target.value;
                let end = event.target.selectionEnd;
                let user = event.target.closest(`.comment__children, .comment_children`);
                user = (user && user.closest(`.comment, .comment_outer`).querySelector(`.comment__username, .author_name`)) || document.querySelector(`.featured__column--width-fill.text-right a, .comment__username, .author_name`);
                if (user) {
                    user = user.textContent;
                    let range = end + user.length;
                    event.target.value = `${text.slice(0, event.target.selectionStart)}${user}${text.slice(end)}`;
                    event.target.setSelectionRange(range, range);
                    event.target.focus();
                    event.preventDefault();
                }
            }
        };
    }
    if (esgst.sk_sr) {
        methods[esgst.sk_submitReply] = event => {
            if (event.target.tagName === `TEXTAREA`) {
                let reply = event.target.closest(`.comment, .reply_form, .esgst-popup`);
                if (reply) {
                    let button = reply.querySelector(`.esgst-button-set >:first-child, .js_submit`);
                    if (button) {
                        button.click();
                        event.preventDefault();
                    }
                }
            }
        };
    }
    if (Object.keys(methods).length > 0) {
        document.addEventListener(`keydown`, event => {
            event.stopPropagation();
            let value = ``;
            if (event.ctrlKey) {
                value += `ctrlKey + `;
            } else if (event.shiftKey) {
                value += `shiftKey + `;
            } else if (event.altKey) {
                value += `altKey + `;
            }
            value += event.key.toLowerCase();
            if (methods[value]) {
                methods[value](event);
            }
        });
    }
}

/* [IB] Image Borders */

function loadIb() {
    esgst.endlessFeatures.push(addIbBorders);
    addIbBorders(document);
}

function addIbBorders(context) {
    var elements, i, n;
    elements = context.querySelectorAll(`.giveaway_image_avatar, :not(.esgst-ggl-panel) .table_image_avatar`);
    for (i = 0, n = elements.length; i < n; ++i) {
        elements[i].classList.add(`esgst-ib-user`);
    }
    elements = context.querySelectorAll(`.giveaway_image_thumbnail, .giveaway_image_thumbnail_missing`);
    for (i = 0, n = elements.length; i < n; ++i) {
        elements[i].classList.add(`esgst-ib-game`);
    }
}

/* [HR] Header Refresher */

function loadHr() {
    let hr = {
        wishlist: false,
        messages: 0,
        points: esgst.points,
        wins: 0
    };
    notifyHrChange(hr, false);
    setValue(`esgst_hrCache`, JSON.stringify(getHrCache()));
    startHeaderRefresher(hr);
    if (!esgst.hr_b) {
        addEventListener(`focus`, startHeaderRefresher.bind(null, hr));
        addEventListener(`blur`, () => clearTimeout(hr.refresher));
    }
}

function refreshHeaderElements(context) {
    let giveaways, i, navigation;
    navigation = context.querySelector(`.nav__right-container, .header_inner_wrap nav`);
    esgst.mainButton = navigation.querySelector(`.nav__button--is-dropdown, .nav_btn[href^="/user/"]`);
    if (esgst.sg) {
        esgst.pointsContainer = esgst.mainButton.firstElementChild;
        esgst.points = parseInt(esgst.pointsContainer.textContent.match(/\d+/)[0]);
        esgst.levelContainer = esgst.mainButton.lastElementChild;
        esgst.level = parseInt(esgst.levelContainer.textContent.match(/\d+/)[0]);
        esgst.createdButton = navigation.getElementsByClassName(`fa-gift`)[0];
        if (esgst.createdButton) {
            esgst.createdButton = esgst.createdButton.closest(`.nav__button-container`);
        }
        esgst.wonButton = navigation.getElementsByClassName(`fa-trophy`)[0];
        if (esgst.wonButton) {
            esgst.wonButton = esgst.wonButton.closest(`.nav__button-container`);
            let won = esgst.wonButton.getElementsByClassName(`nav__notification`)[0];
            if (won && won.textContent !== getValue(`esgst_wonCount`)) {
                getWonGames(won.textContent);
            }
        }
        if (esgst.hr_g && context !== document) {
            esgst.wishlist = false;
            giveaways = getGiveaways(context, false, null, true);
            for (i = giveaways.length - 1; i >= -1; --i) {
                giveaway = giveaways[i];
                if (giveaway && !giveaway.pinned && !giveaway.entered && (!esgst.giveaways[giveaway.code] || esgst.giveaways[giveaway.code].visited || !esgst.giveaways[giveaway.code].hidden)) {
                    esgst.wishlist = true;
                    break;
                }
            }
        } else {
            esgst.wishlist = false;
        }
    }
    esgst.inboxButton = navigation.getElementsByClassName(`fa-envelope`)[0];
    if (esgst.inboxButton) {
        esgst.inboxButton = esgst.inboxButton.closest(`.nav__button-container, .nav_btn_container`);
        esgst.messageCountContainer = esgst.inboxButton.querySelector(`.nav__notification, .message_count`);
    }
    esgst.messageCount = esgst.messageCountContainer ? esgst.messageCountContainer.textContent : ``;
}

function getWonGames(count) {
    request(null, null, false, `/giveaways/won`, response => {
        let element, elements, i, id, info, responseHtml;
        responseHtml = DOM.parse(response.responseText);
        elements = responseHtml.querySelectorAll(`.table__gift-feedback-awaiting-reply:not(.is-hidden)`);
        savedGames = JSON.parse(getValue(`games`));
        for (id in savedGames.apps) {
            delete savedGames.apps[id].won;
        }
        for (id in savedGames.subs) {
            delete savedGames.subs[id].won;
        }
        for (i = elements.length - 1; i > -1; --i) {
            element = elements[i].closest(`.table__row-inner-wrap`);
            info = getGameInfo(element);
            savedGames[info.type][info.id].won = 1;
        }
        lockAndSaveGames(savedGames, () => {
            setValue(`esgst_wonCount`, count);
        });
    });
}

function getHrCache() {
    let cache = {
        mainButton: esgst.mainButton.outerHTML,
        inboxButton: esgst.inboxButton.outerHTML,
        timestamp: Date.now(),
        username: esgst.username
    };
    if (esgst.sg) {
        cache.createdButton = esgst.createdButton.outerHTML;
        cache.wonButton = esgst.wonButton.outerHTML;
        cache.wishlist = esgst.wishlist;
    }
    return cache;
}

function startHeaderRefresher(hr) {
    let cache;
    request(null, null, false, esgst.sg ? `/giveaways/search?type=wishlist` : `/`, response => {
        refreshHeaderElements(DOM.parse(response.responseText));
        cache = getHrCache();
        setValue(`esgst_hrCache`, JSON.stringify(cache));
        refreshHeader(cache, hr);
        hr.refresher = setTimeout(continueHeaderRefresher, esgst.hr_minutes * 60000, hr);
    });
}

function continueHeaderRefresher(hr) {
    let cache = JSON.parse(getValue(`esgst_hrCache`));
    if (cache.username !== esgst.username || Date.now() - cache.timestamp  > esgst.hr_minutes * 60000) {
        cache.timestamp = Date.now();
        setValue(`esgst_hrCache`, JSON.stringify(cache));
        request(null, null, false, esgst.sg ? `/giveaways/search?type=wishlist` : `/`, response => {
            refreshHeaderElements(DOM.parse(response.responseText));
            cache = getHrCache();
            setValue(`esgst_hrCache`, JSON.stringify(cache));
            refreshHeader(cache, hr, true);
            hr.refresher = setTimeout(continueHeaderRefresher, esgst.hr_minutes * 60000, hr);
        });
    } else {
        refreshHeader(cache, hr);
        setTimeout(continueHeaderRefresher, esgst.hr_minutes * 60000, hr);
    }
}

function refreshHeader(cache, hr, notify) {
    refreshHeaderElements(document);
    esgst.mainButton.outerHTML = cache.mainButton;
    if (esgst.sg) {
        esgst.createdButton.outerHTML = cache.createdButton;
        esgst.wonButton.outerHTML = cache.wonButton;
    }
    esgst.inboxButton.outerHTML = cache.inboxButton;
    refreshHeaderElements(document);
    if (esgst.hr) {
        notifyHrChange(hr, esgst.wishlist || cache.wishlist, notify);
    }
    if (esgst.lpv) {
        setLpvStyle();
    }
}

function notifyHrChange(hr, wishlist, notify) {
    let canvas, context, deliveredNotification, image, messageNotification, messageCount, notification, title, wishlistNotification;
    messageCount = esgst.messageCount;
    if (messageCount !== hr.messageCount) {
        messageNotification = messageCount - hr.messageCount;
        if (messageNotification < 0) {
            messageNotification = 0;
        }
        hr.messageCount = messageCount;
    } else {
        messageNotification = 0;
    }
    if (messageCount > 0 && esgst.hr_m) {
        canvas = document.createElement(`canvas`);
        image = document.createElement(`img`);
        canvas.width = 16;
        canvas.height = 16;
        context = canvas.getContext(`2d`);
        image.onload = () => {
            context.drawImage(image, 0, 0);
            context.fillStyle = `#e9202a`;
            context.fillRect(8, 6, 8, 10);
            context.fillStyle = `#fff`;
            context.font = `bold 10px Arial`;
            context.textAlign = `left`;
            if (messageCount > 9) {
                messageCount = `+`;
            }
            context.fillText(messageCount, 9, 14);
            esgst.favicon.href = canvas.toDataURL(`image/png`);
        };
        image.src = esgst[`${esgst.name}Icon`];
    } else {
        esgst.favicon.href = esgst[`${esgst.name}Icon`];
    }
    if (esgst.sg) {
        if (hr.points !== esgst.points) {
            hr.points = esgst.points;
            updateElgbButtons(hr.points);
        }
        title = ``;
        delivered = esgst.wonButton.getElementsByClassName(`fade_infinite`)[0];
        if (delivered) {
            if (!hr.delivered) {
                deliveredNotification = true;
                hr.delivered = true;
            } else {
                deliveredNotification = false;
            }
        } else {
            hr.delivered = deliveredNotification = false;
        }
        if (esgst.hr_g && delivered) {
            title += ` `;
        }
        if (wishlist) {
            if (!hr.wishlist) {
                wishlistNotification = true;
                hr.wishlist = true;
            } else {
                wishlistNotification = false;
            }
        } else {
            hr.wishlist = wishlistNotification = false;
        }
        if (esgst.hr_w && wishlist) {
            title += ` `;
        }
        if (esgst.hr_p) {
            title += `(${esgst.points}P) `;
        }
        title += esgst.originalTitle;
        if (document.title !== title) {
            document.title = title;
        }
    }
    if (notify) {
        notification = ``;
        if (messageNotification && esgst.hr_m && esgst.hr_m_n) {
            notification += `You have ${messageNotification} new messages. `;
        }
        if (deliveredNotification && esgst.hr_g && esgst.hr_g_n) {
            notification += `You have new gifts delivered. `;
        }
        if (wishlistNotification && esgst.hr_w && esgst.hr_w_n) {
            notification += `You have new wishlist giveaways open. `;
        }
        if (notification) {
            showNotification(notification);
        }
    }
}

function showNotification(notification) {
    Notification.requestPermission().then(result => {
        if (result === `granted`) {
            new Notification(`ESGST Notification`, {
                body: notification,
                icon: `https://dl.dropboxusercontent.com/s/lr3t3bxrxfxylqe/esgstIcon.ico?raw=1`
            });
        }
    });
}

/* [HCP] Hidden Community Poll */

function loadHcp() {
    if (esgst.giveawaysPath && esgst.activeDiscussions) {
        var poll = esgst.activeDiscussions.previousElementSibling;
        if (poll && poll.classList.contains(`widget-container`)) {
            if (!esgst.hcp_v || poll.querySelector(`.table__row-outer-wrap.is-selected`)) {
                poll.classList.add(`esgst-hidden`);
            }
        }
    }
}

/* [LPV] Level Progress Visualizer */

function loadLpv() {
    if (!esgst.hr) {
        setLpvStyle();
    }
}

function setLpvStyle() {
    var active, apps, base, cv, currentTime, dif, firstBar, game, giveaway, giveaways, i, id, level, n, percentage, progress, projectedFirstBar, projectedSecondBar, secondBar, savedUser, sent, style, subs, value, values;
    level = esgst.levelContainer.getAttribute(`title`).match(/(\d+)\.(\d+)/);
    base = parseInt(level[1]);
    percentage = parseInt(level[2]);
    dif = 100 - percentage;
    progress = parseInt(percentage * 1.85);
    firstBar = `${progress}px`;
    secondBar = progress >= 156 ? `${progress - 156 - 0.59}px` : `0`;
    savedUser = esgst.users.users[esgst.steamId];
    cv = 0;
    currentTime = Date.now();
    if (savedUser) {
        giveaways = savedUser.giveaways;
        if (giveaways) {
            apps = giveaways.sent.apps;
            for (id in apps) {
                active = 0;
                sent = 0;
                for (i = 0, n = apps[id].length; i < n; ++i) {
                    giveaway = esgst.giveaways[apps[id][i]];
                    if (giveaway) {
                        value = giveaway.points;
                        if (currentTime < giveaway.endTime) {
                            active += giveaway.copies;
                        } else if (((giveaways.entries < 5) && !giveaway.inviteOnly && !giveaway.group && !giveaway.whitelist) || giveaway.entries >= 5) {
                            sent += giveaway.entries >= giveaway.copies ? giveaway.copies : giveaway.entries;
                        }
                    }
                }
                if (active > 0) {
                    game = esgst.games.apps[id];
                    if (game) {
                        if (game.noCV) {
                            value = 0;
                        } else if (game.reducedCV) {
                            value *= 0.15;
                        }
                    }
                    if (sent > 5 || sent + active > 5) {
                        for (i = 0, n = sent - 5; i < n; ++i) {
                            value *= 0.90;
                        }
                        for (i = 0; i < active; ++i) {
                            value *= 0.90;
                            cv += value;
                        }
                    } else {
                        cv += (value * active);
                    }
                }
            }
            subs = giveaways.sent.subs;
            for (id in subs) {
                active = 0;
                sent = 0;
                for (i = 0, n = subs[id].length; i < n; ++i) {
                    giveaway = esgst.giveaways[subs[id][i]];
                    if (giveaway) {
                        value = giveaway.points;
                        if (currentTime < giveaway.endTime) {
                            active += giveaway.copies;
                        } else if (((giveaways.entries < 5) && !giveaway.inviteOnly && !giveaway.group && !giveaway.whitelist) || giveaway.entries >= 5) {
                            sent += giveaway.entries >= giveaway.copies ? giveaway.copies : giveaway.entries;
                        }
                    }
                }
                if (active > 0) {
                    game = esgst.games.subs[id];
                    if (game) {
                        if (game.noCV) {
                            value = 0;
                        } else if (game.reducedCV) {
                            value *= 0.15;
                        }
                    }
                    if (sent > 5 || sent + active > 5) {
                        for (i = 0, n = sent - 5; i < n; ++i) {
                            value *= 0.90;
                        }
                        for (i = 0; i < active; ++i) {
                            value *= 0.90;
                            cv += value;
                        }
                    } else {
                        cv += (value * active);
                    }
                }
            }
        }
    }
    if (cv > 0) {
        cv = Math.round(cv * 100) / 100;
        values = [0, 0.01, 25.01, 50.01, 100.01, 250.01, 500.01, 1000.01, 2000.01, 3000.01, 5000.01];
        percentage = parseInt(Math.round((percentage + (cv / values[parseInt(base)] * 100)) * 100) / 100);
        progress = percentage > dif ? 100 : parseInt(percentage * 1.85);
        projectedFirstBar = `${progress}px`;
        projectedSecondBar = progress >= 156 ? `${progress - 156 - 0.59}px` : `0`;
        esgst.levelContainer.title = `${esgst.levelContainer.getAttribute(`title`)} (${base + parseInt(percentage / 100)}.${`0${percentage}`.slice(-2)})`;
    } else {
        projectedFirstBar = `0`;
        projectedSecondBar = `0`;
    }
    if (!style) {
        document.head.insertAdjacentHTML(`beforeEnd`, `<style id="esgst-lpv-style"></style>`);
    }
    document.getElementById(`esgst-lpv-style`).innerHTML = `
        .esgst-lpv-container {
            background-image: linear-gradient(to right, var(--esgst-lpv-bar, #609f60) ${firstBar}, var(--esgst-lpv-bar-projected, rgba(96, 159, 96, 0.5)) ${firstBar}, var(--esgst-lpv-bar-projected, rgba(96, 159, 96, 0.5)) ${projectedFirstBar}, transparent ${firstBar}), var(--esgst-lpv-button, linear-gradient(#8a92a1 0px, #757e8f 8px, #4e5666 100%)) !important;
        }
        .esgst-lpv-container .nav__button--is-dropdown:hover {
            background-image: linear-gradient(to right, var(--esgst-lpv-bar-hover, #6dac6d) ${firstBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${firstBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${projectedFirstBar}, transparent ${firstBar}), var(--esgst-lpv-button-hover, linear-gradient(#9ba2b0 0px, #8c94a3 8px, #596070 100%)) !important;
        }
        .esgst-lpv-container .nav__button--is-dropdown-arrow:hover {
            background-image: linear-gradient(to right, var(--esgst-lpv-bar-hover, #6dac6d) ${secondBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${secondBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${projectedSecondBar}, transparent ${secondBar}), var(--esgst-lpv-button-hover, linear-gradient(#9ba2b0 0px, #8c94a3 8px, #596070 100%)) !important;
        }
        .esgst-lpv-container .nav__button--is-dropdown-arrow.is-selected {
            background-image: linear-gradient(to right, var(--esgst-lpv-bar, #609f60) ${secondBar}, var(--esgst-lpv-bar-projected, rgba(96, 159, 96, 0.5)) ${secondBar}, var(--esgst-lpv-bar-projected, rgba(96, 159, 96, 0.5)) ${projectedSecondBar}, transparent ${secondBar}), var(--esgst-lpv-arrow, linear-gradient(#4e525f 0px, #434857 5px, #2b2e3a 100%)) !important;
        }
        .esgst-lpv-container.is-selected .nav__button--is-dropdown {
            background-image: linear-gradient(to right, var(--esgst-lpv-bar-hover, #6dac6d) ${firstBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${firstBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${projectedFirstBar}, transparent ${firstBar}), var(--esgst-lpv-button-selected, linear-gradient(#d0d5de 0px, #c9cdd7 5px, #9097a6 100%)) !important;
        }
        .esgst-lpv-container.is-selected .nav__button--is-dropdown-arrow {
            background-image: linear-gradient(to right, var(--esgst-lpv-bar-hover, #6dac6d) ${secondBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${secondBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${projectedSecondBar}, transparent ${secondBar}), var(--esgst-lpv-button-selected, linear-gradient(#d0d5de 0px, #c9cdd7 5px, #9097a6 100%)) !important;
        }
        .esgst-lpv-container.is-selected .nav__button--is-dropdown:hover {
            background-image: linear-gradient(to right, var(--esgst-lpv-bar-selected, #7ab97a) ${firstBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${firstBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${projectedFirstBar}, transparent ${firstBar}), var(--esgst-lpv-button-selected-hover, linear-gradient(#f0f1f5 0px, #d1d4de 100%)) !important;
        }
        .esgst-lpv-container.is-selected .nav__button--is-dropdown-arrow:hover:not(.is-selected) {
            background-image: linear-gradient(to right, var(--esgst-lpv-bar-selected, #7ab97a) ${secondBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${secondBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${projectedSecondBar}, transparent ${secondBar}), var(--esgst-lpv-button-selected-hover, linear-gradient(#f0f1f5 0px, #d1d4de 100%)) !important;
        }
        .esgst-lpv-container.is-selected .nav__button--is-dropdown-arrow.is-selected {
            background-image: linear-gradient(to right, var(--esgst-lpv-bar-selected, #7ab97a) ${secondBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${secondBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${projectedSecondBar}, transparent ${secondBar}), var(--esgst-lpv-arrow-selected, linear-gradient(#4e525f 0px, #434857 5px, #2b2e3a 100%)) !important;
        }
    `;
    esgst.mainButton.parentElement.classList.add(`esgst-lpv-container`);
}

/* [SMGB] Search Magnifying Glass Button */

function loadSmgb() {
    let buttons, i;
    buttons = document.querySelectorAll(`.sidebar__search-container .fa-search`);
    for (i = buttons.length - 1; i > -1; --i) {
        let button = buttons[i];
        button.classList.add(`esgst-clickable`);
        button.addEventListener(`click`, event => {
            let newEvent = new Event(`keypress`);
            newEvent.which = 13;
            button.previousElementSibling.dispatchEvent(newEvent);
        });
    }
}

/* [LPL] Last Page Link */

function getLastPage(context, main, discussion, user, userWon, group, groupUsers, groupWishlist) {
    var element, first, lastPage, pagination, paginationNavigation, paginationResults, second, third;
    pagination = context.getElementsByClassName(`pagination`)[0];
    paginationResults = context.getElementsByClassName(`pagination__results`)[0];
    paginationNavigation = context.getElementsByClassName(`pagination__navigation`)[0];
    if (paginationNavigation) {
        element = paginationNavigation.lastElementChild;
        if (element.textContent.match(/Last/)) {
            lastPage = parseInt(element.getAttribute(`data-page-number`));
        } else if ((main && esgst.discussionPath) || discussion) {
            if (pagination) {
                lastPage = Math.ceil(parseInt(pagination.firstElementChild.lastElementChild.textContent.replace(/,/g, ``)) / 25);
            } else {
                lastPage = 999999999;
            }
        } else if ((main && esgst.userPath) || user) {
            if ((main && location.pathname.match(/\/giveaways\/won/)) || userWon) {
                lastPage = Math.ceil(parseInt(context.querySelector(`.featured__table__row__right a[href*="/giveaways/won"]`).textContent.replace(/,/g, ``)) / 25);
            } else {
                lastPage = Math.ceil(parseInt(context.getElementsByClassName(`sidebar__navigation__item__count`)[0].textContent.replace(/,/g, ``)) / 25);
            }
        } else if ((main && esgst.groupPath) || group) {
            if ((main && location.pathname.match(/\/users/)) || groupUsers) {
                lastPage = Math.ceil(parseInt(context.getElementsByClassName(`sidebar__navigation__item__count`)[1].textContent.replace(/,/g, ``)) / 25);
            } else if ((main && esgst.groupWishlistPath) || groupWishlist) {
                lastPage = 999999999;
            } else {
                lastPage = Math.ceil(parseInt(context.getElementsByClassName(`sidebar__navigation__item__count`)[0].textContent.replace(/,/g, ``)) / 25);
            }
        } else {
            lastPage = 999999999;
        }
    } else {
        lastPage = 999999999;
    }
    if (lastPage === 999999999 && paginationResults) {
        first = paginationResults.firstElementChild;
        if (first) {
            second = first.nextElementSibling;
            if (second) {
                third = second.nextElementSibling;
                if (third) {
                    lastPage = Math.ceil(parseInt(third.textContent.replace(/,/g, ``)) / parseInt(second.textContent.replace(/,/g, ``)));
                }
            }
        }
    }
    return lastPage;
}

function loadLpl() {
    if (esgst.paginationNavigation) {
        if (esgst.discussionPath) {
            addLplDiscussionLink();
        } else if (esgst.userPath) {
            addLplUserLink();
        } else if (esgst.groupPath) {
            addLplGroupLink();
        }
    }
}

function addLplDiscussionLink() {
    var lastLink, url;
    url = `${location.pathname.replace(`/search`, ``)}/search?page=${esgst.lastPage}`;
    esgst.lastPageLink = `
        <a data-page-number="${esgst.lastPage}" href="${url}">
            <span>Last</span>
            <i class="fa fa-angle-double-right"></i>
        </a>
    `;
    lastLink = esgst.paginationNavigation.lastElementChild;
    if (!lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
        esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
    }
}

function addLplUserLink() {
    var lastLink, lastPage, url, username;
    username = location.pathname.match(/^\/user\/(.+?)(\/.*?)?$/)[1];
    if (location.pathname.match(/\/giveaways\/won/)) {
        url = `/user/${username}/giveaways/won/search?page=${esgst.lastPage}`;
    } else {
        url = `/user/${username}/search?page=${esgst.lastPage}`;
    }
    esgst.lastPageLink = `
        <a data-page-number="${esgst.lastPage}" href="${url}">
            <span>Last</span>
            <i class="fa fa-angle-double-right"></i>
        </a>
    `;
    lastLink = esgst.paginationNavigation.lastElementChild;
    if (esgst.currentPage !== esgst.lastPage && !lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
        esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
    }
}

function addLplGroupLink() {
    var group, lastLink, lastPage, url;
    group = location.pathname.match(/^\/group\/(.+?\/.+?)(\/.*?)?$/)[1];
    if (location.pathname.match(/\/users/)) {
        url = `/group/${group}/users/search?page=${esgst.lastPage}`;
    } else if (esgst.groupWishlistPath) {
        url = `/group/${group}/wishlist/search?page=${esgst.lastPage}`;
    } else {
        url = `/group/${group}/search?page=${esgst.lastPage}`;
    }
    esgst.lastPageLink = `
        <a data-page-number="${esgst.lastPage}" href="${url}">
            <span>Last</span>
            <i class="fa fa-angle-double-right"></i>
        </a>
    `;
    lastLink = esgst.paginationNavigation.lastElementChild;
    if (esgst.currentPage !== esgst.lastPage && !lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
        esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
    }
}

/* [VAI] Visible Attached Images / [AIC] Attached Images Carousel */

function loadVai() {
    esgst.endlessFeatures.push(getAttachedImages);
    getAttachedImages(document);
}

function loadAic() {
    if (!esgst.vai) {
        esgst.endlessFeatures.push(getAttachedImages);
        getAttachedImages(document);
    }
}

function getAttachedImages(context) {
    var button, buttons, comment, i, image, n, url;
    buttons = context.querySelectorAll(`.comment__toggle-attached, .view_attached`);
    for (i = 0, n = buttons.length; i < n; ++i) {
        button = buttons[i];
        image = button.nextElementSibling.firstElementChild;
        if (esgst.aic) {
            i = esgst.attachedImages.length;
            button.addEventListener(`click`, openAicCarousel.bind(null, i));
            image.addEventListener(`click`, openAicCarousel.bind(null, i));
            comment = button.closest(`.comment`);
            esgst.attachedImages.push({
                button: button,
                image: image,
                source: comment && comment.querySelector(`.comment__summary`).id
            });
        }
        if (esgst.vai && (!esgst.inboxPath || !esgst.vai_i)) {
            url = image.getAttribute(`src`);
            if (url && esgst.vai_gifv) {
                url = url.replace(/\.gifv/, `.gif`);
                image.setAttribute(`src`, url);
            }
            image.classList.remove(`is_hidden`, `is-hidden`);
        }
    }
}

function openAicCarousel(i, event) {
    var popup;
    event.preventDefault();
    event.stopPropagation();
    popup = new Popup(null, null, true);
    popup.open();
    showAicImage(insertHtml(popup.description, `beforeEnd`, `<div class="esgst-aic-carousel markdown"></div>`), i, popup);
}

function showAicImage(carousel, i, popup) {
    var attachedImage, n;
    carousel.innerHTML = ``;
    n = esgst.attachedImages.length;
    attachedImage = esgst.attachedImages[i];
    attachedImage.image.classList.remove(`is_hidden`, `is-hidden`);
    attachedImage.image.style.maxHeight = `${innerHeight * 0.9 - (popup.popup.offsetHeight - popup.scrollable.offsetHeight)}px`;
    carousel.innerHTML = `
        ${i > 0 ? `
        <div class="esgst-aic-left-button">
            <i class="fa fa-chevron-left"></i>
        </div>
        ` : ``}
        ${attachedImage.image.outerHTML}
        ${attachedImage.source ? `<div><a href="#${attachedImage.source}">Source</a></div>` : ``}
        ${i < n - 1 ? `
        <div class="esgst-aic-right-button">
            <i class="fa fa-chevron-right"></i>
        </div>
        ` : ``}
    `;
    if (i > 0) {
        carousel.firstElementChild.addEventListener(`click`, showAicImage.bind(null, carousel, i - 1, popup));
    }
    if (i < n - 1) {
        carousel.lastElementChild.addEventListener(`click`, showAicImage.bind(null, carousel, i + 1, popup));
    }
    popup.reposition();
    popup.reposition();
}

/* [EV] Embedded Videos */

function loadEv() {
    esgst.endlessFeatures.push(getEvVideos);
    getEvVideos(document);
}

function getEvVideos(context) {
    var types, i, numTypes, type, videos, j, numVideos, video, previous, next, embedUrl, url, text, title;
    types = [`youtube.com`, `youtu.be`, `vimeo.com`];
    for (i = 0, numTypes = types.length; i < numTypes; ++i) {
        type = types[i];
        videos = context.querySelectorAll(`a[href*="${type}"]`);
        for (j = 0, numVideos = videos.length; j < numVideos; ++j) {
            video = videos[j];
            previous = video.previousSibling;
            next = video.nextSibling;
            if ((!previous || !previous.textContent.trim()) && (!next || !next.textContent.trim())) {
                // video is the only content in the line
                url = video.getAttribute(`href`);
                embedUrl = getVideoEmbedUrl(i, url);
                if (embedUrl) {
                    text = video.textContent;
                    if (url !== text) {
                        title = `<div>${text}</div>`;
                    } else {
                        title = ``;
                    }
                    video.outerHTML = `
                        <div>
                            ${title}
                            <iframe width="640" height="360" src="${embedUrl}" frameborder="0" allowfullscreen></iframe>
                        </div>
                    `;
                }
            }
        }
    }
}

function getVideoEmbedUrl(i, url) {
    var regExps, regExp, match, baseUrls, baseUrl, code;
    regExps = [
        /youtube.com\/watch\?v=(.+?)(\/.*)?(&.*)?$/,
        /youtu.be\/(.+?)(\/.*)?$/,
        /vimeo.com\/(.+?)(\/.*)?$/
    ];
    regExp = regExps[i];
    match = url.match(regExp);
    if (match) {
        baseUrls = [
            `https://www.youtube.com/embed/`,
            `https://www.youtube.com/embed/`,
            `https://player.vimeo.com/video/`
        ];
        baseUrl = baseUrls[i];
        code = match[1];
        return `${baseUrl}${code}`;
    } else {
        return null;
    }
}

/* [AT] Accurate Timestamps */

function getTimestamps(context) {
    var timestamps, i, n, timestamp, text, edited, seconds, accurateTimestamp;
    timestamps = context.querySelectorAll(`[data-timestamp]`);
    for (i = 0, n = timestamps.length; i < n; ++i) {
        timestamp = timestamps[i];
        if (((esgst.activeDiscussions && ((esgst.activeDiscussions.contains(timestamp) && esgst.adots_index === 0) || !esgst.activeDiscussions.contains(timestamp))) || !esgst.activeDiscussions) && !timestamp.classList.contains(`esgst-at`)) {
            text = timestamp.textContent;
            edited = text.match(/\*/);
            seconds = parseInt(timestamp.getAttribute(`data-timestamp`));
            accurateTimestamp = getTimestamp(seconds, esgst.at_24, esgst.at_s);
            if (edited) {
                text = ` (Edited ${accurateTimestamp})`;
            } else {
                text = `${accurateTimestamp} - ${text}`;
            }
            timestamp.classList.add(`esgst-at`);
            timestamp.textContent = text;
        }
    }
}

/* [HBS] Hidden Blacklist Stats */

function loadHbs() {
    var Chart, Match, Points, N, Data, I, CountDate, Year, Month, Day, Count, Context, script;
    if (location.pathname.match(/^\/stats\/personal\/community/)) {
        Chart = document.getElementsByClassName(`chart`)[4];
        Match = Chart.previousElementSibling.textContent.match(/"Whitelists", data: \[(.+)\]},/)[1];
        Points = Match.split(/\],\[/);
        N = Points.length - 1;
        Points[0] = Points[0].replace(/^\[/, ``);
        Points[N] = Points[N].replace(/\/]$/, ``);
        Data = [];
        for (I = 0; I <= N; ++I) {
            Match = Points[I].match(/(.+), (.+)/);
            CountDate = Match[1].match(/\((.+?),(.+?),(.+?)\)/);
            Year = parseInt(CountDate[1]);
            Month = parseInt(CountDate[2]);
            Day = parseInt(CountDate[3]);
            Count = parseInt(Match[2]);
            Data.push([Date.UTC(Year, Month, Day), Count]);
        }
        Context = Chart.firstElementChild;
        Context.lastElementChild.remove();
        Context.lastElementChild.remove();
        Context = Context.nextElementSibling;
        Context.textContent = Context.textContent.replace(/and blacklists\s/, ``);
        Context = Context.nextElementSibling;
        script = document.createElement(`script`);
        script.innerHTML = `
            $(function () {
                chart_options.graph = {
                    colors: ['#6187d4', '#ec656c'],
                    tooltip: {
                        headerFormat: '<p class="chart__tooltip-header">{point.key}</p>',
                        pointFormat: '<p class="chart__tooltip-point" style="color: {point.color};">{point.y:,.0f} {series.name}</p>'
                    },
                    series: [ { name: "Whitelists", data: ${JSON.stringify(Data)} } ]
                };
                $(".chart__personal-community-whitelists-and-blacklists").highcharts(Highcharts.merge(chart_options.default, chart_options.areaspline, chart_options.datetime, chart_options.graph));
            });
        `;
        document.body.appendChild(script);
    }
}

/* [GDTTT] Giveaways/Discussions/Tickets/Trades Tracker */

function loadGdttt() {
    if (((esgst.giveawaysPath || esgst.discussionsPath) && !esgst.ct) || (!esgst.giveawaysPath && !esgst.discussionsPath && esgst.discussionsTicketsTradesPath)) {
        esgst.endlessFeatures.push(addCtDiscussionPanels);
        addCtDiscussionPanels(document);
    }
    if (esgst.commentsPath) {
        var match = location.pathname.match(/(giveaway|discussion|ticket|trade)\/(.+?)\//);
        var type = `${match[1]}s`;
        var code = match[2];
        var savedComments = JSON.parse(getValue(type, `{}`));
        if (esgst.gdttt_v) {
            if (!esgst.ct) {
                createLock(`commentLock`, 300, function (deleteLock) {
                    if (!savedComments[code]) {
                        savedComments[code] = {
                            readComments: {}
                        };
                    }
                    savedComments[code].visited = true;
                    setValue(type, JSON.stringify(savedComments));
                    deleteLock();
                });
            }
        } else if (esgst.discussionPath || esgst.tradePath) {
            if (savedComments[code] && savedComments[code].visited) {
                addGdtttMarkUnvisitedButton(null, code, document.querySelector(`.page__heading, .page_heading`), type);
            } else {
                addGdtttMarkVisitedButton(null, code, document.querySelector(`.page__heading, .page_heading`), type);
            }
        }
    }
    esgst.endlessFeatures.push(checkGdtttVisited);
    checkGdtttVisited(document);
}

function checkGdtttVisited(context) {
    var code, comment, container, heading, i, match, matches, n, source, type, url;
    matches = context.querySelectorAll(`.homepage_table_column_heading, .table__column__heading, .giveaway__heading__name, .column_flex h3 a`);
    for (i = 0, n = matches.length; i < n; ++i) {
        match = matches[i];
        url = match.getAttribute(`href`);
        if (url) {
            source = url.match(/(giveaway|discussion|ticket|trade)\/(.+?)(\/.*)?$/);
            if (source) {
                type = `${source[1]}s`;
                code = source[2];
                container = match.closest(`.table__row-outer-wrap, .giveaway__row-outer-wrap, .row_outer_wrap`);
                comment = JSON.parse(getValue(type))[code];
                if (comment && comment.visited && container) {
                    if ((type === `giveaways` && esgst.gdttt_g) || type !== `giveaways`) {
                        container.classList.add(`esgst-ct-visited`);
                        container.style.opacity = `0.5`;
                        setHoverOpacity(container, `1`, `0.5`);
                    }
                }
            }
        }
    }
}

function addGdtttMarkVisitedButton(button, code, context, type) {
    var comments;
    if (!button) {
        button = insertHtml(context, `afterBegin`, `<div class="esgst-gdttt-button page_heading_btn"><div>`);
    }
    button.innerHTML = `<i class="fa fa-check" title="Mark as visited"></i>`;
    button.firstElementChild.addEventListener(`click`, function() {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        createLock(`commentLock`, 300, function(deleteLock) {
            comments = JSON.parse(getValue(type));
            if (!comments[code]) {
                comments[code] = {
                    readComments: {}
                };
            }
            if (esgst.ct_s) {
                comments[code].count = count;
            }
            comments[code].visited = true;
            setValue(type, JSON.stringify(comments));
            deleteLock();
            addGdtttMarkUnvisitedButton(button, code, context, type);
        });
    });
}

function addGdtttMarkUnvisitedButton(button, code, context, type) {
    var comments;
    if (!button) {
        button = insertHtml(context, `afterBegin`, `<div class="esgst-gdttt-button page_heading_btn"><div>`);
    }
    button.innerHTML = `<i class="fa fa-times" title="Mark as unvisited"></i>`;
    button.firstElementChild.addEventListener(`click`, function() {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        createLock(`commentLock`, 300, function(deleteLock) {
            comments = JSON.parse(getValue(type));
            if (esgst.ct_s) {
                delete comments[code].count;
            }
            delete comments[code].visited;
            setValue(type, JSON.stringify(comments));
            deleteLock();
            addGdtttMarkVisitedButton(button, code, context, type);
        });
    });
}

/* [TS] Tables Sorter */

function getTsTables(context, main, source, endless) {
    var i, n, tables;
    tables = context.getElementsByClassName(`table`);
    for (i = 0, n = tables.length; i < n; ++i) {
        setTsTable(tables[i]);
    }
    if (!endless && !esgst.us) {
        sortTsTables();
    }
}

function sortTsTables() {
    var i, tsTable;
    for (i = esgst.tsTables.length - 1; i > -1; --i) {
        tsTable = esgst.tsTables[i];
        if (tsTable.columnName) {
            sortContent(getTsArray(tsTable.columnName, tsTable.columnIndex, tsTable.table), `${tsTable.key}_${tsTable.name}`);
        }
    }
}

function setTsTable(table) {
    var button, columns, columnName, columns, heading, i, tsTable;
    heading = table.querySelector(`.table__heading, .header`);
    if (heading) {
        tsTable = {
            columnName: ``,
            key: `sortIndex`,
            name: `asc`,
            table: table
        };
        esgst.tsTables.push(tsTable);
        columns = heading.querySelectorAll(`.table__column--width-fill, .table__column--width-medium, .table__column--width-small, .column_flex, .column_medium, .column_small`);
        for (i = 0, n = columns.length; i < n; ++i) {
            column = columns[i];
            columnName = column.textContent.trim();
            if (!columnName.match(/^(Keys|Key|Not\sReceived|Remove)$/) && (!esgst.wonPath || !columnName.match(/^Received$/)) && !column.getElementsByClassName(`esgst-ts-button`)[0]) {
                button = insertHtml(column, `beforeEnd`, `
                    <span class="esgst-ts-button esgst-clickable"></span>
                `);
                addTsDescButton(button, columnName, i, table, tsTable);
            }
        }
    }
}

function addTsAscButton(button, columnName, i, table, tsTable) {
    button.innerHTML = `
        <i class="fa fa-sort-desc" title="Currently sorted descending. Click to sort ascending."></i>
    `;
    button.firstElementChild.addEventListener(`click`, sortTsTable.bind(null, button, columnName, i, `asc`, table, tsTable));
}

function addTsDescButton(button, columnName, i, table, tsTable) {
    button.innerHTML = `
        <i class="fa fa-sort" title="Currently sorted by default. Click to sort descending."></i>
    `;
    button.firstElementChild.addEventListener(`click`, sortTsTable.bind(null, button, columnName, i, `desc`, table, tsTable));
}

function addTsDefButton(button, columnName, i, table, tsTable) {
    button.innerHTML = `
        <i class="fa fa-sort-asc" title="Currently sorted ascending. Click to sort by default."></i>
    `;
    button.firstElementChild.addEventListener(`click`, sortTsTable.bind(null, button, columnName, i, `def`, table, tsTable));
}

function sortTsTable(button, columnName, i, key, table, tsTable) {
    tsTable.columnName = columnName;
    tsTable.columnIndex = i;
    tsTable.key = key === `def` ? `sortIndex` : `value`;
    tsTable.name = key;
    if (key === `desc`) {
        sortContent(getTsArray(columnName, i, table), `value_${key}`);
        addTsAscButton(button, columnName, i, table, tsTable);
    } else if (key === `asc`) {
        sortContent(getTsArray(columnName, i, table), `value_${key}`);
        addTsDefButton(button, columnName, i, table, tsTable);
    } else {
        sortContent(getTsArray(columnName, i, table), `sortIndex_asc`);
        addTsDescButton(button, columnName, i, table, tsTable);
    }
}

function getTsArray(columnName, i, table) {
    var array, column, element, j, match, n, row, rows, value;
    array = [];
    rows = table.querySelectorAll(`.table__row-outer-wrap, .row_outer_wrap`);
    for (j = 0, n = rows.length; j < n; ++j) {
        row = rows[j];
        column = row.querySelectorAll(`.table__column--width-fill, .table__column--width-medium, .table__column--width-small, .column_flex, .column_medium, .column_small`)[i];
        value = column && column.textContent.trim();
        element = {
            outerWrap: row
        };
        if (row.hasAttribute(`data-sort-index`)) {
            element.sortIndex = parseInt(row.getAttribute(`data-sort-index`));
        } else {
            element.sortIndex = j;
            row.setAttribute(`data-sort-index`, j);
        }
        if (value.length > 0 || columnName === `Trending`) {
            if (column.hasAttribute(`data-sort-value`)) {
                element.value = parseFloat(column.getAttribute(`data-sort-value`));
            } else {
                switch (columnName) {
                    case `Trending`:
                        element.value = column.getElementsByClassName(`fa-caret-up`).length - column.getElementsByClassName(`fa-caret-down`).length;
                        break;
                    case `Date Entered`:
                    case `Last Post`:
                    case `Added`:
                    case `Last Online`:
                    case `Last Update`:
                        element.value = value.match(/Online\sNow/) ? Date.now() : parseInt(column.querySelector(`[data-timestamp]`).getAttribute(`data-timestamp`)) * 1e3;
                        break;
                    case `User`:
                    case `Type`:
                    case `Game`:
                        element.value = value;
                        break;
                    default:
                        if (value.match(/\d+\.\d+/)) {
                            element.value = parseFloat(value.replace(/\$/g, ``));
                            if (isNaN(element.value)) {
                                element.value = value;
                            }
                        } else {
                            element.value = parseFloat(value.replace(/,/g, ``).match(/\d+/)[0]);
                        }
                        break;
                }
            }
        } else {
            element.value = 0;
        }
        array.push(element);
    }
    return array;
}

/* [QGB] Quick Giveaway Browsing */

function loadQgb() {
        document.getElementsByClassName(`nav__absolute-dropdown`)[0].insertAdjacentHTML(`beforeEnd`, `
            <a class="nav__row" href="/giveaways/search?type=wishlist">
                <div class="nav__row__summary">
                    <p class="nav__row__summary__name">Browse Wishlist Giveaways</p>
                </div>
            </a>
            <a class="nav__row" href="/giveaways/search?type=recommended">
                <div class="nav__row__summary">
                    <p class="nav__row__summary__name">Browse Recommended Giveaways</p>
                </div>
            </a>
            <a class="nav__row" href="/giveaways/search?type=group">
                <div class="nav__row__summary">
                    <p class="nav__row__summary__name">Browse Group Giveaways</p>
                </div>
            </a>
            <a class="nav__row" href="/giveaways/search?type=new">
                <div class="nav__row__summary">
                    <p class="nav__row__summary__name">Browse New Giveaways</p>
                </div>
            </a>
        `);
}

/* [AGS] Advanced Giveaway Search */

function addAgsPanel() {
    var context, details, element, filter, filterDetails, filters, i, icon, input, match, n, panel, popout, timeout, value;
    context = document.getElementsByClassName(`sidebar__search-container`)[0];
    context.firstElementChild.remove();
    input = insertHtml(context, `afterBegin`, `
        <input class="sidebar__search-input" placeholder="Search..." type="text">
    `);
    icon = input.nextElementSibling;
    icon.classList.add(`esgst-clickable`);
    icon.title = `Use advanced search.`;
    match = location.search.match(/q=(.*?)(&.*?)?$/);
    if (match) {
        input.value = decodeURIComponent(match[1]);
    }
    if ((esgst.adots && esgst.adots_index === 0) || !esgst.adots) {
        panel = insertHtml(context, `afterEnd`, `
            <div class="esgst-ags-panel"></div>
        `);
    } else {
        panel = new Popout(`esgst-ags-panel`, context, 100).popout;
    }
    filterDetails = [
        {
            maxKey: `ags_maxDate`,
            minKey: `ags_minDate`,
            maxParameter: `release_date_max`,
            minParameter: `release_date_min`,
            name: `Release Date`,
            type: `input`
        },
        {
            maxKey: `ags_maxScore`,
            minKey: `ags_minScore`,
            maxParameter: `metascore_max`,
            minParameter: `metascore_min`,
            name: `Metascore`,
            type: `input`
        },
        {
            maxKey: `ags_maxLevel`,
            minKey: `ags_minLevel`,
            maxParameter: `level_max`,
            minParameter: `level_min`,
            name: `Level`,
            type: `select`
        },
        {
            maxKey: `ags_maxEntries`,
            minKey: `ags_minEntries`,
            maxParameter: `entry_max`,
            minParameter: `entry_min`,
            name: `Entries`,
            type: `input`
        },
        {
            maxKey: `ags_maxCopies`,
            minKey: `ags_minCopies`,
            maxParameter: `copy_max`,
            minParameter: `copy_min`,
            name: `Copies`,
            type: `input`
        },
        {
            maxKey: `ags_maxPoints`,
            minKey: `ags_minPoints`,
            maxParameter: `point_max`,
            minParameter: `point_min`,
            name: `Points`,
            type: `input`
        },
        {
            key: `ags_regionRestricted`,
            name: `Region Restricted`,
            parameter: `region_restricted`,
            type: `checkbox`
        },
        {
            key: `ags_dlc`,
            name: `DLC`,
            parameter: `dlc`,
            type: `checkbox`
        },
        {
            key: `ags_app`,
            name: `App`,
            parameter: `app`,
            type: `checkbox`
        },
        {
            key: `ags_sub`,
            name: `Sub`,
            parameter: `sub`,
            type: `checkbox`
        }
    ];
    filters = [];
    for (i = 0, n = filterDetails.length; i < n; ++i) {
        createAgsFilter(filterDetails[i]);
    }
    input.addEventListener(`keydown`, function (event) {
        if (event.key === `Enter`) {
            event.preventDefault();
            searchAgsQuery();
        }
    });
    icon.addEventListener(`click`, function () {
        searchAgsQuery();
    });

    function createAgsFilter(details) {
        var element, filter, html, i, maxFilter, minFilter;
        if (details.type === `checkbox`) {
            element = insertHtml(panel, `beforeEnd`, `
                    <div class="esgst-ags-checkbox-filter">
                        <span>${details.name}</span>
                    </div>
            `);
            filter = new Checkbox(
                element,
                esgst[details.key]
            ).input;
            element.addEventListener(`click`, function () {
                setSetting(details.key, filter.checked);
                esgst[details.key] = filter.checked;
            });
            filters.push({
                filter: filter,
                key: `checked`,
                parameter: details.parameter
            });
        } else {
            if (details.type === `select`) {
                html = `
                    <select>
                        <option></option>
                `;
                for (i = 0; i <= 10; ++i) {
                    html += `
                        <option>${i}</option>
                    `;
                }
                html += `
                    </select>
                `;
            } else if (details.maxKey === `ags_maxDate`) {
                html = `
                    <input type="date">
                `;
            } else {
                html = `
                    <input type="text">
                `;
            }
            element = insertHtml(panel, `beforeEnd`, `
                <div>${details.name} <div class="esgst-ags-filter">${html}</div><div class="esgst-ags-filter">${html}</div></div>
            `);
            maxFilter = element.lastElementChild.lastElementChild;
            maxFilter.value = esgst[details.maxKey];
            maxFilter.addEventListener(`change`, function () {
                setSetting(details.maxKey, maxFilter.value);
                esgst[details.maxKey] = maxFilter.value;
            });
            minFilter = element.firstElementChild.lastElementChild;
            minFilter.value = esgst[details.minKey];
            minFilter.addEventListener(`change`, function () {
                setSetting(details.minKey, minFilter.value);
                esgst[details.minKey] = minFilter.value;
            });
            if (details.type === `input`) {
                maxFilter.addEventListener(`keypress`, event => {
                    if (event.key === `Enter`) {
                        searchAgsQuery();
                    }
                });
                minFilter.addEventListener(`keypress`, event => {
                    if (event.key === `Enter`) {
                        searchAgsQuery();
                    }
                });
            }
            filters.push({
                filter: minFilter,
                key: `value`,
                parameter: details.minParameter
            });
            filters.push({
                filter: maxFilter,
                key: `value`,
                parameter: details.maxParameter
            });
        }
    }

    function searchAgsQuery() {
        var i, match, url;
        if (esgst.ags_app || esgst.ags_sub) {
            url = `https://www.steamgifts.com/giveaways/search?q=`;
        } else {
            url = `https://www.steamgifts.com/giveaways/search?q=${input.value}`;
        }
        match = location.search.match(/(type=.*?)(&.*?)?$/);
        if (match) {
            url += `&${match[1]}`;
        }
        for (i = 0, n = filters.length; i < n; ++i) {
            filter = filters[i];
            value = filter.filter[filter.key];
            if (value) {
                if (filter.parameter === `app`) {
                    url += `&app=${input.value}`;
                } else if (filter.parameter === `sub`) {
                    url += `&sub=${input.value}`;
                } else {
                    url += `&${filter.parameter}=${value}`;
                }
            }
        }
        location.href = url;
    }
}

/* [GAS] Giveaways Sorter */

function loadGas() {
    var gas, type;
    gas = {};
    esgst.gas = {};
    type = location.search.match(/type=(wishlist|recommended|group|new)/);
    if (type) {
        type = type[1].replace(/^(.)/, function (m, p1) {
            return p1.toUpperCase();
        });
    } else if (esgst.enteredPath) {
        type = `Entered`;
    } else if (esgst.userPath) {
        type = `User`;
    } else if (esgst.groupPath) {
        type = `Groups`;
    } else {
        type = ``;
    }
    esgst.gas.autoKey = `gas_auto${type}`;
    esgst.gas.optionKey = `gas_option${type}`;
    gas.button = document.createElement(`div`);
    gas.button.className = `esgst-heading-button`;
    gas.button.title = `Sort giveaways`;
    gas.button.innerHTML = `
        <i class="fa fa-sort"></i>
    `;
    gas.button.addEventListener(`click`, openGasPopout.bind(null, gas));
    return gas.button;
}

function openGasPopout(gas) {
    var optionsHtml, type;
    if (!gas.popout) {
        gas.popout = new Popout(`esgst-gas-popout`, gas.button, 0, true);
        gas.toggle = new ToggleSwitch(gas.popout.popout, esgst.gas.autoKey, false, `Auto Sort`, false, false, `Automatically sorts the giveaways by the selected option when loading the page.`, esgst[esgst.gas.autoKey]);
        optionsHtml = `
            <select>
                <option value="sortIndex_asc">Default</option>
                <option value="name_asc">Game Name - Ascending</option>
                <option value="name_desc">Game Name - Descending</option>
        `;
        if (!esgst.enteredPath) {
            optionsHtml += `
                <option value="points_asc">Points - Ascending</option>
                <option value="points_desc">Points - Descending</option>
            `;
        }
        if (esgst.gc && esgst.gc_r && !esgst.enteredPath) {
            optionsHtml += `
                <option value="rating_asc">Rating - Ascending</option>
                <option value="rating_desc">Rating - Descending</option>
            `;
        }
        optionsHtml += `
                <option value="endTime_asc">End Time - Ascending</option>
                <option value="endTime_desc">End Time - Descending</option>
        `;
        if (!esgst.enteredPath) {
            optionsHtml += `
                <option value="startTime_asc">Start Time - Ascending</option>
                <option value="startTime_desc">Start Time - Descending</option>
                <option value="creator_asc">Creator - Ascending</option>
                <option value="creator_desc">Creator - Descending</option>
                <option value="comments_asc">Comments - Ascending</option>
                <option value="comments_desc">Comments - Descending</option>
            `;
        }
        optionsHtml += `
                <option value="entries_asc">Entries - Ascending</option>
                <option value="entries_desc">Entries - Descending</option>
        `;

        if (esgst.gwc) {
            optionsHtml += `
                <option value="chance_asc">Chance - Ascending</option>
                <option value="chance_desc">Chance - Descending</option>
            `;
        }
        if (esgst.gwr) {
            optionsHtml += `
                <option value="ratio_asc">Ratio - Ascending</option>
                <option value="ratio_desc">Ratio - Descending</option>
            `;
        }
        optionsHtml += `
            </select>
        `;
        gas.options = insertHtml(gas.popout.popout, `beforeEnd`, optionsHtml);
        gas.options.value = esgst[esgst.gas.optionKey];
        gas.options.addEventListener(`change`, saveAndSortContent.bind(null, esgst.gas.optionKey, `currentGiveaways`, gas.options, null));
        gas.popout.popout.appendChild(new ButtonSet(`green`, ``, `fa-arrow-circle-right`, ``, `Sort`, ``, saveAndSortContent.bind(null, esgst.gas.optionKey, `currentGiveaways`, gas.options)).set);
    }
}

function saveAndSortContent(key, mainKey, options, callback) {
    if (callback) {
        callback();
    }
    sortContent(esgst[mainKey], options.value);
    setSetting(key, options.value);
}

function sortContent(array, option) {
    var after, before, divisor, divisors, i, key, n, name;
    name = option.split(/_/);
    key = name[0];
    if (name[1] === `asc`) {
        before = -1;
        after = 1;
    } else {
        before = 1;
        after = -1;
    }
    array.sort(function (a, b) {
        if (typeof a[key] === `string` && typeof b[key] === `string`) {
            return (a[key].toLowerCase().localeCompare(b[key].toLowerCase()) * after);
        } else {
            if (a[key] < b[key]) {
                return before;
            } else if (a[key] > b[key]) {
                return after;
            } else {
                return 0;
            }
        }
    });
    for (i = 0, n = array.length; i < n; ++i) {
        array[i].outerWrap.parentElement.appendChild(array[i].outerWrap);
    }
    if (key === `sortIndex`) {
        divisors = document.getElementsByClassName(`esgst-es-page-divisor`);
        for (i = divisors.length - 1; i > -1; --i) {
            divisor = divisors[i];
            divisor.classList.remove(`esgst-hidden`);
            divisor.parentElement.insertBefore(divisor, document.getElementsByClassName(`esgst-es-page-${i + 2}`)[0]);
        }
    } else {
        divisors = document.querySelectorAll(`.esgst-es-page-divisor:not(.esgst-hidden)`);
        for (i = divisors.length - 1; i > -1; --i) {
            divisors[i].classList.add(`esgst-hidden`);
        }
    }
}

/* [GV] Grid View */

function loadGv(button) {
    var display, element, elements, i, n, popout, spacing, slider;
    popout = new Popout(`esgst-gv-spacing`, button, 0, true);
    spacing = esgst.gv_spacing;
    element = insertHtml(popout.popout, `beforeEnd`, `
        <div>
            <div></div>
            <div>${spacing}px</div>
        </div>
    `);
    slider = element.firstElementChild;
    display = slider.nextElementSibling;
    $(slider).slider({
        slide: function (event, ui) {
            spacing = ui.value;
            elements = document.getElementsByClassName(`esgst-gv-container`);
            for (i = 0, n = elements.length; i < n; ++i) {
                elements[i].style.margin = `${spacing}px`;
            }
            popout.reposition();
            display.textContent = `${spacing}px`;
            setSetting(`gv_spacing`, spacing);
            esgst.gv_spacing = spacing;
        },
        max: 10,
        value: spacing
    });
}

function setGvContainers(giveaways, main, source) {
    var elements, i, n, spacing;
    if ((main && esgst.giveawaysPath) || (!main && ((source === `gb` && esgst.gv_gb) || (source === `ged` && esgst.gv_ged) || (source === `ge` && esgst.gv_ge)))) {
        spacing = esgst.gv_spacing;
        for (i = 0, n = giveaways.length; i < n; ++i) {
            setGvContainer(giveaways[i], spacing);
        }
    }
}

function getRemainingTime(time) {
    var d, dif, h, m, s, w;
    dif = time - Date.now();
    if (dif < 0) {
        dif *= -1;
    }
    w = Math.floor(dif / 604800000);
    if (w > 0) {
        return `${w}w`;
    } else {
        d = Math.floor(dif / 86400000);
        if (d > 0) {
            return `${d}d`;
        } else {
            h = Math.floor(dif / 3600000);
            if (h > 0) {
                return `${h}h`;
            } else {
                m = Math.floor(dif / 60000);
                if (m > 0) {
                    return `${m}m`;
                } else {
                    s = Math.floor(dif / 1000);
                    return `${s}s`;
                }
            }
        }
    }
}

function setGvContainer(giveaway, spacing) {
    var creator, icons;
    giveaway.grid = true;
    popup = giveaway.outerWrap.closest(`.esgst-popup-scrollable`);
    if (popup) {
        giveaway.outerWrap.parentElement.parentElement.classList.add(`esgst-gv-view`);
        giveaway.outerWrap.parentElement.style.display = `inline-block`;
        giveaway.outerWrap.classList.add(`esgst-gv-container`);
        giveaway.outerWrap.style.margin = `${spacing}px`;
    } else {
        giveaway.outerWrap.parentElement.classList.add(`esgst-gv-view`);
        giveaway.outerWrap.classList.add(`esgst-gv-container`);
        giveaway.outerWrap.style.margin = `${spacing}px`;
    }
    giveaway.innerWrap.classList.add(`esgst-gv-box`);
    icons = insertHtml(giveaway.innerWrap, `afterBegin`, `
        <div class="esgst-gv-icons giveaway__columns">
            <div class="esgst-gv-time">
                    <span title="${giveaway.started ? `Ends` : `Starts`} ${giveaway.endTimeColumn.lastElementChild.textContent}">${getRemainingTime(giveaway.endTime)}</span>
                <i class="fa fa-clock-o"></i>
                <span title="Created ${giveaway.startTimeColumn.lastElementChild.previousElementSibling.textContent}">${getRemainingTime(giveaway.startTime)}</span>
            </div>
        </div>
    `);
    if (giveaway.inviteOnly) {
        giveaway.inviteOnly.lastChild.remove();
        icons.appendChild(giveaway.inviteOnly);
    }
    if (giveaway.regionRestricted) {
        icons.appendChild(giveaway.regionRestricted);
    }
    if (giveaway.group) {
        icons.appendChild(giveaway.group);
    }
    if (giveaway.whitelist) {
        icons.appendChild(giveaway.whitelist);
    }
    if (giveaway.levelColumn) {
        giveaway.levelColumn.textContent = giveaway.levelColumn.textContent.replace(/Level\s/, ``);
        icons.appendChild(giveaway.levelColumn);
    }
    giveaway.innerWrap.insertBefore(giveaway.image, icons);
    giveaway.summary.classList.add(`esgst-gv-popout`, `global__image-outer-wrap`);
    giveaway.summary.insertBefore(giveaway.avatar, giveaway.links);
    giveaway.avatar.insertAdjacentHTML(`afterEnd`, `
        <div style="clear: both;"></div>
    `);
    giveaway.headingName.insertAdjacentHTML(`afterEnd`, `<br>`);
    giveaway.pointsContainer.insertAdjacentHTML(`afterEnd`, `<br>`);
    giveaway.endTimeColumn.classList.add(`esgst-hidden`);
    giveaway.startTimeColumn.classList.add(`esgst-hidden`);
    giveaway.entriesLink.lastElementChild.textContent = giveaway.entriesLink.textContent.replace(/[^\d,]+/g, ``);
    giveaway.commentsLink.lastElementChild.textContent = giveaway.commentsLink.textContent.replace(/[^\d,]+/g, ``);
    creator = insertHtml(giveaway.links, `beforeBegin`, `
        <div class="esgst-gv-creator">
            <span>by</span>
        </div>
    `);
    creator.appendChild(giveaway.creatorContainer);
    new Popout(``, giveaway.outerWrap, 100, false, giveaway.summary);
}

/* [GF] Giveaway Filters */

function getGfGiveaways(giveaways, main, source) {
    var giveaway, i, n, savedGiveaways;
    savedGiveaways = JSON.parse(getValue(`giveaways`, `{}`));
    for (i = 0, n = giveaways.length; i < n; ++i) {
        giveaway = giveaways[i];
        if (giveaway.creator !== esgst.username && !giveaway.ended && !giveaway.entered && giveaway.url) {
            if (source === `gf` || esgst.giveawayPath) {
                if (!giveaway.innerWrap.getElementsByClassName(`esgst-gf-unhide-button`)[0] && savedGiveaways[giveaway.code] && savedGiveaways[giveaway.code].hidden) {
                    addGfUnhideButton(giveaway, main);
                }
            }
            if ((source !== `gc` && (esgst.giveawaysPath || esgst.groupPath)) || esgst.giveawayPath) {
                if (!giveaway.innerWrap.getElementsByClassName(`esgst-gf-hide-button`)[0] && (!savedGiveaways[giveaway.code] || !savedGiveaways[giveaway.code].hidden || !savedGiveaways[giveaway.code].code)) {
                    addGfHideButton(giveaway, main);
                }
            }
        }
    }
}

function addGfHideButton(giveaway, main) {
    var button;
    button = insertHtml(giveaway.headingName, `beforeBegin`, `
        <div class="esgst-gf-hide-button" title="Hide giveaway.">
            <i class="fa fa-eye-slash"></i>
        </div>
    `);
    button.firstElementChild.addEventListener(`click`, function() {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        hideGfGiveaway(giveaway, function() {
            button.remove();
            if ((esgst.giveawayPath && !main) || !esgst.giveawayPath) {
                giveaway.outerWrap.remove();
            }
        });
    });
}

function hideGfGiveaway(giveaway, callback) {
    createLock(`giveawayLock`, 300, function(deleteLock) {
        var giveaways;
        giveaways = JSON.parse(getValue(`giveaways`, `{}`));
        if (!giveaways[giveaway.code]) {
            giveaways[giveaway.code] = {};
        }
        giveaways[giveaway.code].code = giveaway.code;
        giveaways[giveaway.code].endTime = giveaway.endTime;
        giveaways[giveaway.code].hidden = true;
        setValue(`giveaways`, JSON.stringify(giveaways));
        deleteLock();
        if (callback) {
            callback();
        }
    });
}

function addGfUnhideButton(giveaway, main) {
    var button;
    button = insertHtml(giveaway.headingName, `beforeBegin`, `
        <div class="esgst-gf-unhide-button" title="Unhide giveaway.">
            <i class="fa fa-eye"></i>
        </div>
    `);
    button.firstElementChild.addEventListener(`click`, function() {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        unhideGfGiveaway(giveaway, function() {
            button.remove();
            if ((esgst.giveawayPath && !main) || !esgst.giveawayPath) {
                giveaway.outerWrap.remove();
            }
        });
    });
}

function unhideGfGiveaway(giveaway, callback) {
    createLock(`giveawayLock`, 300, function(deleteLock) {
        var giveaways;
        giveaways = JSON.parse(getValue(`giveaways`, `{}`));
        if (giveaways[giveaway.code]) {
            giveaways[giveaway.code].hidden = false;
            setValue(`giveaways`, JSON.stringify(giveaways));
        }
        deleteLock();
        if (callback) {
            callback();
        }
    });
}

function setGfOverride(gf, context, key) {
    let button, override;
    button = insertHtml(context, `afterBegin`, `<span class="esgst-gf-override"></span>`);
    gf.overrideButtons[key] = {
        change: () => {
            if (typeof gf.overrides[key] === `undefined`) {
                gf.overrides[key] = 0;
            }
            gf.overrideButtons[key].value = gf.overrides[key];
            if (gf.overrideButtons[key].value) {
                button.innerHTML = `<i class="fa fa-exclamation" title="Click to make this filter overridable"></i>`;
            } else {
                button.innerHTML = `<i class="fa fa-exclamation esgst-faded" title="Click to make this filter non-overridable"></i>`;
            }
        }
    };
    gf.overrideButtons[key].change();
    button.addEventListener(`click`, () => {
        gf.overrides[key] = gf.overrideButtons[key].value ? 0 : 1;
        gf.overrideButtons[key].change();
        filterGfGiveaways(gf);
    });
}

function addGfContainer(heading, popup) {
    var basicFilter, basicFilters, box, button, categoryFilter, categoryFilters, collapseButton, display, exceptionButton, exceptionCount, exceptionPanel, expandButton, filters, genres, gf, headingButton, i, id, infinite, key, maxKey, maxSavedValue, maxValue, minKey, minSavedValue, minValue, name, preset, presetButton, presetDisplay, presetInput, presetMessage, presetPanel, presets, presetWarning, slider, step, toggleSwitch, typeFilter, typeFilters, value;
    gf = {
        advancedSearch: location.search.match(/q=/),
        type: popup ? `Popup` : (esgst.groupPath ? `Groups` : (location.search.match(/type/) ? { wishlist: `Wishlist`, recommended: `Recommended`, group: `Group`, new: `New` }[location.search.match(/type=(wishlist|recommended|group|new)/)[1]] : (esgst.createdPath ? `Created` : (esgst.enteredPath ? `Entered` : (esgst.wonPath ? `Won` : ``)))))
    };
    if (popup) {
        esgst.gfPopup = gf;
    } else {
        esgst.gf = gf;
    }
    headingButton = document.createElement(`div`);
    headingButton.className = `esgst-heading-button esgst-gf-heading-button`;
    headingButton.innerHTML = `
        <span class="esgst-gf-toggle-switch"></span>
        <i class="fa fa-sliders" title="Manage presets"></i>
    `;
    toggleSwitch = new ToggleSwitch(headingButton.firstElementChild, `gf_enable${gf.type}`, true, ``, false, false, null, esgst[`gf_enable${gf.type}`]);
    toggleSwitch.onEnabled = filterGfGiveaways.bind(null, gf);
    toggleSwitch.onDisabled = filterGfGiveaways.bind(null, gf, true);
    presetButton = headingButton.lastElementChild;
    gf.container = insertHtml(heading, `afterEnd`, `
        <div class="esgst-gf-container">
            <div class="esgst-gf-box">
                <div class="esgst-gf-filters esgst-hidden">
                    <div class="esgst-gf-basic-filters esgst-hidden">
                        <div>
                            <span class="esgst-bold">Basic Filters:</span>
                            <i class="fa fa-question-circle" title="The entries/copies filters are infinite. To increase/decrease their max value, simply enter the new max value into the input field and it will be changed."></i>
                        </div>
                    </div>
                    <div class="esgst-gf-type-filters">
                        <div>
                            <span class="esgst-bold">Type Filters:</span>
                        </div>
                    </div>
                    <div class="esgst-gf-category-filters esgst-hidden">
                        <div>
                            <span class="esgst-bold">Category Filters:</span>
                        </div>
                    </div>
                    <div class="esgst-gf-legend-panel">
                        <div>
                            <span class="esgst-bold">Legend:</span>
                            <i class="fa fa-question-circle" title="This legend applies to the type/category filters, except where noted"></i>
                        </div>
                        <div class="esgst-gf-legend"><i class="fa fa-circle-o"></i> - Hide all.</div>
                        <div class="esgst-gf-legend"><i class="fa fa-circle"></i> - Show only.</div>
                        <div class="esgst-gf-legend"><i class="fa fa-check-circle"></i> - Show all.</div>
                        <div class="esgst-gf-legend"><i class="fa fa-exclamation esgst-faded"></i> - Overridable <i class="fa fa-question-circle" title="Overridable filters can be overridden by exceptions"></i></div>
                        <div class="esgst-gf-legend"><i class="fa fa-exclamation"></i> - Non-Overridable <i class="fa fa-question-circle" title="Non-Overridable filters cannot be overridden by exceptions"></i></div>
                    </div>
                    <div class="esgst-gf-preset-panel">
                        <div>
                            <span class="esgst-bold">Preset:</span>
                        </div>
                        <div>
                            <span></span> exceptions <i class="esgst-clickable fa fa-gear" title="Manage exceptions"></i>
                        </div>
                        <input class="form__input-small" type="text"/>
                        <div class="esgst-description esgst-bold"></div>
                        <div class="form__row__error esgst-hidden">
                            <i class="fa fa-exclamation-circle"></i> Please enter a name for the preset.
                        </div>
                        <div class="esgst-description">The name of the preset.</div>
                    </div>
                </div>
            </div>
            <div class="esgst-gf-button">
                <span>Expand</span><span class="esgst-hidden">Collapse</span> filters (<span>0</span> filtered - <span>0</span>P required to enter all unfiltered - <span></span>)
            </div>
        </div>
    `);
    box = gf.container.firstElementChild;
    filters = box.firstElementChild;
    basicFilters = filters.firstElementChild;
    typeFilters = basicFilters.nextElementSibling;
    categoryFilters = typeFilters.nextElementSibling;
    presetPanel = categoryFilters.nextElementSibling.nextElementSibling;
    exceptionPanel = presetPanel.firstElementChild.nextElementSibling;
    exceptionCount = exceptionPanel.firstElementChild;
    exceptionButton = exceptionCount.nextElementSibling;
    presetInput = exceptionPanel.nextElementSibling;
    presetMessage = presetInput.nextElementSibling;
    presetWarning = presetMessage.nextElementSibling;
    presetPanel.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save Preset`, `Saving...`, saveGfPreset.bind(null, gf, presetInput, presetMessage, presetWarning)).set);
    button = box.nextElementSibling;
    expandButton = button.firstElementChild;
    collapseButton = expandButton.nextElementSibling;
    button.addEventListener(`click`, toggleGfFilters.bind(null, collapseButton, expandButton, filters));
    gf.filteredCount = collapseButton.nextElementSibling;
    gf.pointsCount = gf.filteredCount.nextElementSibling;
    if (gf.type !== `popup`) {
        gf.paginationFilteredCount = insertHtml(esgst.pagination.firstElementChild, `beforeEnd`, `
            <span>
                (<span class="esgst-bold">0</span> filtered by Giveaway Filters)
            </span>
        `).firstElementChild;
    }
    presetDisplay = gf.pointsCount.nextElementSibling;
    presetButton.addEventListener(`click`, openGfPresetPopup.bind(null, gf, exceptionCount, presetDisplay, presetInput));
    name = esgst[`gf_preset${gf.type}`];
    if (name) {
        presets = JSON.parse(getValue(`filterPresets`, `[]`));
        for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
        if (i >= 0) {
            preset = presets[i];
            presetDisplay.textContent = presetInput.value = name;
        } else {
            preset = null;
        }
    }
    if (!preset) {
        name = `Default${gf.type}`;
        preset = { name };
        [`maxLevel`, `minLevel`, `maxEntries`, `minEntries`, `maxCopies`, `minCopies`, `maxPoints`, `minPoints`, `maxMinutesToEnd`, `minMinutesToEnd`, `maxChance`, `minChance`, `maxRating`, `minRating`, `pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedabck`, `entered`, `started`, `ended`, `deleted`, `hidden`, `fullCV`, `reducedCV`, `noCV`, `owned`, `wishlisted`, `ignored`, `previouslyEntered`, `previouslyWon`, `removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `package`, `genres`, `genreList`].forEach(key => {
            preset[key] = esgst.settings[`gf_${key}${gf.type}`];
        });
        presets = JSON.parse(getValue(`filterPresets`, `[]`));
        presets.push(preset);
        setValue(`filterPresets`, JSON.stringify(presets));
        setSetting(`gf_preset${gf.type}`, name);
        presetDisplay.textContent = presetInput.value = name;
    }
    if (preset.exceptions) {
        gf.exceptions = preset.exceptions;
        exceptionCount.textContent = preset.exceptions.length;
    } else {
        exceptionCount.textContent = 0;
    }
    gf.overrides = preset.overrides || {};
    gf.overrideButtons = {};
    exceptionButton.addEventListener(`click`, openGfExceptionPopup.bind(null, exceptionCount, gf, presetInput));
    if (!gf.advancedSearch) {
        basicFilters.classList.remove(`esgst-hidden`);
        [ { check: ((!esgst.createdPath || esgst.cewgd) && (!esgst.enteredPath || esgst.cewgd) && (!esgst.wonPath || esgst.cewgd)) || popup, maxValue: 10, minValue: 0, name: `Level` },
            { check: !esgst.wonPath || popup, infinite: true, maxValue: 999999999, minValue: 0, name: `Entries` },
            { check: !esgst.wonPath || popup, infinite: true, maxValue: 999999999, minValue: 1, name: `Copies` },
            { check: ((!esgst.createdPath || esgst.cewgd) && (!esgst.enteredPath || esgst.cewgd) && (!esgst.wonPath || esgst.cewgd)) || popup, maxValue: 100, minValue: 0, name: `Points` },
            { check: !esgst.wonPath || popup, maxValue: 43800, minValue: 0, name: `MinutesToEnd` },
            { check: ((!esgst.enteredPath || esgst.cewgd) && !esgst.createdPath && !esgst.wonPath) || popup, maxValue: 100, minValue: 0, name: `Chance`, step: 0.01 },
            { check: true, maxValue: 100, minValue: 0, name: `Rating` }
        ].forEach(filter => {
            if (filter.check) {
                name = filter.name;
                if (name !== `Rating` || esgst.gc) {
                    maxKey = `max${name}`;
                    maxValue = filter.maxValue;
                    minKey = `min${name}`;
                    minValue = filter.minValue;
                    key = name === `MinutesToEnd` ? `minutesToEnd` : name.toLowerCase();
                    if (esgst[`gf_${key}`]) {
                        infinite = filter.infinite;
                        maxSavedValue = preset[maxKey] || maxValue;
                        minSavedValue = preset[minKey] || minValue;
                        step = filter.step || 1;
                        if (!infinite && maxSavedValue > maxValue) {
                            maxSavedValue = maxValue;
                        }
                        gf[maxKey] = maxSavedValue;
                        gf[minKey] = minSavedValue;
                        basicFilter = insertHtml(basicFilters, `beforeEnd`, `
                            <div class="esgst-gf-basic-filter">
                                <div>${name === `MinutesToEnd` ? `Minutes To End` : name} <span class="esgst-float-right"><input type="text" value="${minSavedValue}"> - <input type="text" value="${maxSavedValue}"></span></div>
                                <div></div>
                            </div>
                        `);
                        display = basicFilter.firstElementChild;
                        setGfOverride(gf, display, key);
                        slider = display.nextElementSibling;
                        gf[`${minKey}Input`] = display.firstElementChild.nextElementSibling.firstElementChild;
                        gf[`${maxKey}Input`] = gf[`${minKey}Input`].nextElementSibling;
                        gf[`${maxKey}Input`].addEventListener(`change`, changeGfMaxValue.bind(null, infinite, slider, step));
                        gf[`${minKey}Input`].addEventListener(`change`, changeGfMinValue.bind(null, slider, step));
                        if (infinite) {
                            maxValue = maxSavedValue;
                        }
                        $(slider).slider({
                            change: changeGfSlider.bind(null, gf, maxKey, minKey),
                            min: minValue,
                            max: maxValue,
                            range: true,
                            slide: slideGfSlider.bind(null, gf, maxKey, minKey),
                            step: step,
                            values: [minSavedValue, maxSavedValue]
                        });
                    } else {
                        gf[maxKey] = maxValue;
                        gf[minKey] = minValue;
                    }
                }
            }
        });
    }
    if (basicFilters.children.length === 1) {
        basicFilters.classList.add(`esgst-hidden`);
    }
    [ { check: esgst.giveawaysPath, key: `pinned`, name: `Pinned` },
        { check: ((!esgst.createdPath || esgst.cewgd) && (!esgst.enteredPath || esgst.cewgd) && (!esgst.wonPath || esgst.cewgd)) || popup, key: `group`, name: `Group` },
        { check: ((!esgst.createdPath || esgst.cewgd) && (!esgst.enteredPath || esgst.cewgd) && (!esgst.wonPath || esgst.cewgd)) || popup, key: `whitelist`, name: `Whitelist`},
        { check: ((!esgst.createdPath || esgst.cewgd) && (!esgst.enteredPath || esgst.cewgd) && (!esgst.wonPath || esgst.cewgd)) || popup, key: `regionRestricted`, name: `Region Restricted` },
        { check: (!esgst.createdPath && !esgst.enteredPath && !esgst.wonPath) || popup, key: `created`, name: `Created` },
        { check: esgst.createdPath, key: `received`, name: `Received` },
        { check: esgst.createdPath, key: `notReceived`, name: `Not Received` },
        { check: esgst.createdPath, key: `awaitingFeedback`, name: `Awaiting Feedback` },
        { check: (!esgst.createdPath && !esgst.enteredPah && !esgst.wonPath) || popup, key: `entered`, name: `Entered` },
        { check: (!esgst.enteredPath && !esgst.wonPath) || popup, key: `started`, name: `Started` },
        { check: !esgst.wonPath || popup, key: `ended`, name: `Ended` },
        { check: esgst.createdPath, key: `deleted`, name: `Deleted` },
        { check: true, key: `owned`, name: `Owned` },
        { check: true, key: `wishlisted`, name: `Wishlisted` },
        { check: true, key: `hidden`, name: `Hidden` },
        { check: true, key: `ignored`, name: `Ignored` },
        { check: true, key: `previouslyEntered`, name: `Previously Entered` },
        { check: true, key: `previouslyWon`, name: `Previously Won` },
        { check: true, key: `fullCV`, name: `Full CV` },
        { check: true, key: `reducedCV`, name: `Reduced CV` },
        { check: true, key: `noCV`, name: `No CV` }
    ].forEach(filter => {
        if (filter.check) {
            key = filter.key;
            if (key !== `regionRestricted` || !gf.advancedSearch) {
                if (esgst[`gf_${key}`]) {
                    name = filter.name;
                    typeFilter = insertHtml(typeFilters, `beforeEnd`, `
                        <div class="esgst-gf-type-filter">
                            <span>${name}</span>
                        </div>
                    `);
                    value = preset[key] || `enabled`;
                    gf[key] = value;
                    gf[`${key}Checkbox`] = new Checkbox(typeFilter, value, true);
                    setGfOverride(gf, typeFilter, key);
                    gf[`${key}Checkbox`].checkbox.addEventListener(`click`, changeGfValue.bind(null, gf[`${key}Checkbox`], gf, key));
                } else {
                    gf[key] = `enabled`;
                }
            }
        }
    });
    if (typeFilters.children.length === 1) {
        typeFilters.classList.add(`esgst-hidden`);
    }
    if (esgst.gc) {
        categoryFilters.classList.remove(`esgst-hidden`);
        [ { id: `gc_rm`, key: `removed`, name: `Removed` },
            { id: `gc_tc`, key: `tradingCards`, name: `Trading Cards` },
            { id: `gc_a`, key: `achievements`, name: `Achievements` },
            { id: `gc_mp`, key: `multiplayer`, name: `Multiplayer` },
            { id: `gc_sc`, key: `steamCloud`, name: `Steam Cloud` },
            { id: `gc_l`, key: `linux`, name: `Linux` },
            { id: `gc_m`, key: `mac`, name: `Mac` },
            { id: `gc_dlc`, key: `dlc`, name: `DLC` },
            { id: `gc_p`, key: `package`, name: `Package` },
            { id: `gc_g`, key: `genres`, name: `Genres` }
        ].forEach(filter => {
            id = filter.id;
            if ((id !== `gc_dlc` || !gf.advancedSearch) && esgst[id]) {
                key = filter.key;
                genres = key === `genres`;
                if (esgst[`gf_${key}`]) {
                    name = filter.name;
                    categoryFilter = insertHtml(categoryFilters, `beforeEnd`, `
                        <div class="esgst-gf-category-filter">
                            <span>${name} ${genres ? `<i class="fa fa-question-circle" title="If disabled, no games will be filtered by genre; if enabled, only games with the listed genres will appear"></i> <input placeholder="Genre1, Genre2" type="text">` : ``}</span>
                        </div>
                    `);
                    value = typeof preset[key] !== `undefined` ? preset[key] : (genres ? false : `enabled`);
                    gf[key] = value;
                    gf[`${key}Checkbox`] = new Checkbox(categoryFilter, value, genres ? false : true);
                    setGfOverride(gf, categoryFilter, key);
                    gf[`${key}Checkbox`].checkbox.addEventListener(`click`, changeGfValue.bind(null, gf[`${key}Checkbox`], gf, key));
                    if (genres) {
                        gf.genreListInput = categoryFilter.lastElementChild.lastElementChild;
                        value = (preset.genreList && preset.genreList.replace(/,(?!\s)/g, `, `)) || ``;
                        gf.genreList = gf.genreListInput.value = value;
                        gf.genreListInput.addEventListener(`change`, changeGfValue.bind(null, gf.genreListInput, gf, `genreList`));
                    }
                } else {
                    gf[key] = genres ? false : `enabled`;
                }
            }
        });
        if (categoryFilters.children.length === 1) {
            categoryFilters.classList.add(`esgst-hidden`);
        }
    }
    return headingButton;
}

function toggleGfFilters(collapseButton, expandButton, filters) {
    collapseButton.classList.toggle(`esgst-hidden`);
    expandButton.classList.toggle(`esgst-hidden`);
    filters.classList.toggle(`esgst-hidden`);
}

function changeGfMaxValue(infinite, slider, step, event) {
    var max, min, value;
    max = $(slider).slider(`values`, 1);
    min = $(slider).slider(`values`, 0);
    value = step ? parseFloat(event.currentTarget.value) : parseInt(event.currentTarget.value);
    if (value !== max && value >= min) {
        if (infinite) {
            $(slider).slider(`option`, `max`, value);
        }
        $(slider).slider(`values`, [min, value]);
    }
}

function changeGfMinValue(slider, step, event) {
    var max, min, value;
    max = $(slider).slider(`values`, 1);
    min = $(slider).slider(`values`, 0);
    value = step ? parseFloat(event.currentTarget.value) : parseInt(event.currentTarget.value);
    if (value !== min && value <= max) {
        $(slider).slider(`values`, [value, max]);
    }
}

function changeGfSlider(gf, maxKey, minKey, event, ui) {
    gf[maxKey] = ui.values[1];
    gf[minKey] = ui.values[0];
    filterGfGiveaways(gf);
}

function slideGfSlider(gf, maxKey, minKey, event, ui) {
    gf[`${maxKey}Input`].value = ui.values[1];
    gf[`${minKey}Input`].value = ui.values[0];
}

function changeGfValue(context, gf, key) {
    gf[key] = context.value;
    filterGfGiveaways(gf);
}

function saveGfPreset(gf, presetInput, presetMessage, presetWarning, callback) {
    var exceptions, name, preset, presets;
    name = presetInput.value;
    if (name) {
        presetWarning.classList.add(`esgst-hidden`);
        preset = { name };
        [`maxLevel`, `minLevel`, `maxEntries`, `minEntries`, `maxCopies`, `minCopies`, `maxPoints`, `minPoints`, `maxMinutesToEnd`, `minMinutesToEnd`, `maxChance`, `minChance`, `maxRating`, `minRating`, `pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedback`, `entered`, `started`, `ended`, `deleted`, `hidden`, `fullCV`, `reducedCV`, `noCV`, `owned`, `wishlisted`, `ignored`, `previouslyEntered`, `previouslyWon`, `removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `package`, `genres`, `genreList`].forEach(key => {
            if (typeof gf[key] !== `undefined`) {
                preset[key] = gf[key];
            }
        });
        preset.overrides = gf.overrides;
        presets = JSON.parse(getValue(`filterPresets`, `[]`));
        for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
        if (i >= 0) {
            exceptions = presets[i].exceptions;
            if (exceptions) {
                preset.exceptions = exceptions;
            }
            presets[i] = preset;
        } else {
            presets.push(preset);
        }
        setValue(`filterPresets`, JSON.stringify(presets));
        setSetting(`gf_preset${gf.type}`, name);
        createFadeMessage(presetMessage, `Saved!`);
        callback();
    } else {
        presetWarning.classList.remove(`esgst-hidden`);
        callback();
    }
}

function openGfPresetPopup(gf, exceptionCount, presetDisplay, presetInput) {
    var deleted, details, heading, hideAll, popup, preset, renameButton, renameInput, row, showOnly, table, undoButton;
    popup = new Popup(`fa-sliders`, `Manage presets:`, true);
    popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-description">To edit a preset, apply it and save it with the same name. To rename a preset, click the edit icon, enter the new name and hit "Enter". Drag and drop presets to move them.</div>`);
    deleted = [];
    undoButton = insertHtml(popup.description, `beforeEnd`, `
        <div class="esgst-clickable esgst-hidden">
            <i class="fa fa-rotate-left"></i>
            <span>Undo Delete</span>
        </div>
    `);
    undoButton.addEventListener(`click`, undoGfDeletePreset.bind(null, deleted, undoButton));
    table = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left popup__keys__list"></div>`);
    JSON.parse(getValue(`filterPresets`, `[]`)).forEach(preset => {
        details = ``;
        [ { key: `Level`, name: `level` },
            { key: `Entries`, name: `entries` },
            { key: `Copies`, name: `copies` },
            { key: `Points`, name: `points` },
            { key: `MinutesToEnd`, name: `minutes to end` },
            { key: `Chance`, name: `chance` },
            { key: `Rating`, name: `rating` }
        ].forEach(filter => {
            if (typeof preset[`max${filter.key}`] !== `undefined`) {
                details += `${preset[`min${filter.key}`]}-${preset[`max${filter.key}`]} ${filter.name}, `;
            }
        });
        hideAll = [];
        showOnly = [];
        [ { key: `pinned`, name: `pinned` },
            { key: `group`, name: `group` },
            { key: `whitelist`, name: `whitelist` },
            { key: `regionRestricted`, name: `region restricted` },
            { key: `created`, name: `created` },
            { key: `received`, name: `received` },
            { key: `notReceived`, name: `not received` },
            { key: `awaitingFeedback`, name: `awaiting feedback` },
            { key: `entered`, name: `entered` },
            { key: `deleted`, name: `deleted` },
            { key: `owned`, name: `owned`},
            { key: `wishlisted`, name: `wishlisted` },
            { key: `hidden`, name: `hidden` },
            { key: `ignored`, name: `ignored` },
            { key: `previouslyEntered`, name: `previously entered`, },
            { key: `previouslyWon`, name: `previously won`, },
            { key: `fullCV`, name: `full CV` },
            { key: `reducedCV`, name: `reduced CV` },
            { key: `noCV`, name: `no CV`, },
            { key: `removed`, name: `removed` },
            { key: `tradingCards`, name: `trading cards` },
            { key: `achievements`, name: `achievements` },
            { key: `multiplayer`, name: `multiplayer` },
            { key: `steamCloud`, name: `steam cloud` },
            { key: `linux`, name: `linux` },
            { key: `mac`, name: `mac` },
            { key: `dlc`, name: `dlc` },
            { key: `package`, name: `package` },
            { key: `genres`, name: `genres` }
        ].forEach(key => {
            if (preset[key.key] === `disabled`) {
                hideAll.push(key.name);
            } else if (preset[key.key] === `none`) {
                showOnly.push(key.name);
            } else if (key.key === `genres` && preset.genres && preset.genreList) {
                showOnly.push(`genres (${preset.genreList.toLowerCase()})`);
            }
        });
        if (hideAll.length > 0) {
            details += `hide: ${hideAll.join(` & `)}, `;
        }
        if (showOnly.length > 0) {
            details += `only show: ${showOnly.join(` & `)}, `;
        }
        row = insertHtml(table, `beforeEnd`, `
            <div ${presetInput.value === preset.name ? `class="esgst-green-highlight"` : ``} draggable="true">
                <div class="esgst-float-left">
                    <input class="esgst-hidden" type="text" value="${preset.name}"/>
                    <strong class="esgst-clickable">${preset.name}</strong>
                </div>
                <div class="esgst-clickable esgst-float-right">
                    <i class="fa fa-edit" title="Rename preset"></i>
                    <span title="Delete preset">
                        <i class="fa fa-trash"></i>
                    </span>
                </div>
                <div class="esgst-clear"></div>
                <div class="esgst-description">${details.slice(0, -2)}</div>
            </div>
        `);
        row.addEventListener(`dragstart`, setGfSource.bind(null, gf, preset, row));
        row.addEventListener(`dragenter`, getGfSource.bind(null, gf, row, table));
        row.addEventListener(`dragend`, saveGfSource.bind(null, gf));
        renameInput = row.firstElementChild.firstElementChild;
        heading = renameInput.nextElementSibling;
        renameInput.addEventListener(`keypress`, renameGfPreset.bind(null, heading, preset, presetDisplay, presetInput));
        heading.addEventListener(`click`, applyGfPreset.bind(null, gf, exceptionCount, popup, preset, presetDisplay, presetInput));
        renameButton = row.firstElementChild.nextElementSibling.firstElementChild;
        renameButton.addEventListener(`click`, showGfRenameInput.bind(null, heading, renameInput));
        renameButton.nextElementSibling.addEventListener(`click`, deleteGfPreset.bind(null, deleted, preset, row, undoButton));
    });
    popup.open();
}

function setGfSource(gf, preset, row) {
    var i, presets;
    gf.source = row;
    presets = JSON.parse(getValue(`filterPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
    gf.sourceIndex = i;
}

function getGfSource(gf, row, table) {
    var current, i;
    current = gf.source;
    i = 0;
    do {
        current = current.previousElementSibling;
        if (current && current === row) {
            gf.sourceNewIndex = i;
            table.insertBefore(gf.source, row);
            return;
        }
        ++i;
    } while (current);
    gf.sourceNewIndex = i - 1;
    table.insertBefore(gf.source, row.nextElementSibling);
}

function saveGfSource(gf) {
    var presets;
    presets = JSON.parse(getValue(`filterPresets`, `[]`));
    presets.splice(gf.sourceNewIndex, 0, presets.splice(gf.sourceIndex, 1)[0]);
    setValue(`filterPresets`, JSON.stringify(presets));
}

function applyGfPreset(gf, exceptionCount, popup, preset, presetDisplay, presetInput) {
    var checkbox, input, key;
    [`maxLevel`, `minLevel`, `maxEntries`, `minEntries`, `maxCopies`, `minCopies`, `maxPoints`, `minPoints`, `maxMinutesToEnd`, `minMinutesToEnd`, `maxChance`, `minChance`, `maxRating`, `minRating`, `pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedabck`, `entered`, `started`, `ended`, `deleted`, `hidden`, `fullCV`, `reducedCV`, `noCV`, `owned`, `wishlisted`, `ignored`, `previouslyEntered`, `previouslyWon`, `removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `package`, `genres`, `genreList`].forEach(key => {
        checkbox = gf[`${key}Checkbox`];
        if (checkbox) {
            if (checkbox.isThreeState) {
                gf[key] = checkbox.value = preset[key];
                checkbox.change(false, gf[key]);
            } else {
                if (preset[key]) {
                    gf[key] = true;
                    checkbox.check();
                } else {
                    gf[key] = false;
                    checkbox.uncheck();
                }
            }
        } else {
            input = gf[`${key}Input`];
            if (input) {
                gf[key] = input.value = preset[key];
                input.dispatchEvent(new Event(`change`));
            }
        }
    });
    presetDisplay.textContent = presetInput.value = preset.name;
    if (preset.exceptions) {
        gf.exceptions = preset.exceptions;
        exceptionCount.textContent = preset.exceptions.length;
    } else {
        exceptionCount.textContent = 0;
    }
    gf.overrides = preset.overrides || {};
    for (key in gf.overrideButtons) {
        gf.overrideButtons[key].change();
    }
    setSetting(`gf_preset${gf.type}`, preset.name);
    popup.close();
    filterGfGiveaways(gf);
}

function showGfRenameInput(heading, renameInput) {
    var value;
    heading.classList.add(`esgst-hidden`);
    renameInput.classList.remove(`esgst-hidden`);
    value = renameInput.value;
    renameInput.value = ``;
    renameInput.focus();
    renameInput.value = value;
}

function renameGfPreset(heading, preset, presetDisplay, presetInput, event) {
    var i, newName, oldName, presets;
    if (event.key === `Enter`) {
        oldName = preset.name;
        newName = event.currentTarget.value;
        presets = JSON.parse(getValue(`filterPresets`));
        for (i = presets.length - 1; i >= 0 && presets[i].name !== oldName; --i);
        preset.name = presets[i].name = newName;
        setValue(`filterPresets`, JSON.stringify(presets));
        heading.textContent = newName;
        if (presetInput.value === oldName) {
            presetDisplay.textContent = presetInput.value = newName;
        }
        [``, `Wishlist`, `Recommended`, `Group`, `New`, `Groups`, `Popup`].forEach(type => {
            if (esgst[`gf_preset${type}`] === oldName) {
                setSetting(`gf_preset${type}`, newName);
            }
        });
        event.currentTarget.classList.add(`esgst-hidden`);
        heading.classList.remove(`esgst-hidden`);
    }
}

function deleteGfPreset(deleted, preset, row, undoButton, event) {
    var deleteButton, i, presets;
    deleteButton = event.currentTarget;
    deleteButton.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
    presets = JSON.parse(getValue(`filterPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
    presets.splice(i, 1);
    setValue(`filterPresets`, JSON.stringify(presets));
    deleteButton.innerHTML = `<i class="fa fa-trash"></i>`;
    row.classList.add(`esgst-hidden`);
    deleted.push({
        details: preset,
        row: row
    });
    undoButton.classList.remove(`esgst-hidden`);
}

function undoGfDeletePreset(deleted, undoButton) {
    var preset, presets;
    preset = deleted.pop();
    preset.row.classList.remove(`esgst-hidden`);
    preset.row.parentElement.appendChild(preset.row);
    presets = JSON.parse(getValue(`filterPresets`, `[]`));
    presets.push(preset.details);
    setValue(`filterPresets`, JSON.stringify(presets));
    if (deleted.length === 0) {
        undoButton.classList.add(`esgst-hidden`);
    }
}

function openGfExceptionPopup(exceptionCount, gf, presetInput) {
    var deleted, details, i, max, min, name, popup, preset, presets, row, table, undoButton;
    popup = new Popup(`fa-gear`, `Manage exceptions: <i class="fa fa-question-circle" title="Exceptions are giveaways that will always appear, no matter which filters are set (they still get filtered by type/category filters). For example, if you have a filter that only shows giveaways with 0.5+ chance, but you have an exception for wishlist, all wishlist giveaways will appear, regardless of their chance.\n\nEach exception works as an AND conjunction, so if you want to make an exception for wishlist giveaways **or** giveaways with multiple copies, you have to create 2 separate exceptions, otherwise the exception will be for giveaways that are both wishlist **and** multiple copies."></i>`, true);
    deleted = [];
    undoButton = insertHtml(popup.description, `beforeEnd`, `
        <div class="esgst-clickable esgst-hidden">
            <i class="fa fa-rotate-left"></i>
            <span>Undo Delete</span>
        </div>
    `);
    table = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left popup__keys__list"></div>`);
    name = presetInput.value;
    presets = JSON.parse(getValue(`filterPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
    preset = presets[i];
    undoButton.addEventListener(`click`, undoGfDeleteException.bind(null, deleted, exceptionCount, gf, preset, undoButton));
    if (preset.exceptions) {
        preset.exceptions.forEach(exception => {
            details = ``;
            [ { key: `Level`, name: `level` },
                { key: `Entries`, name: `entries` },
                { key: `Copies`, name: `copies` },
                { key: `Points`, name: `points` },
                { key: `MinutesToEnd`, name: `minutes to end` },
                { key: `Chance`, name: `chance` },
                { key: `Rating`, name: `rating` }
            ].forEach(filter => {
                max = exception[`max${filter.key}`];
                min = exception[`min${filter.key}`];
                if (typeof max !== `undefined` && typeof min !== `undefined`) {
                    details += `${min}-${max} ${filter.name}, `;
                } else if (typeof max !== `undefined`) {
                    details += `?-${max} ${filter.name}, `;
                } else if (typeof min !== `undefined`) {
                    details += `${min}-? ${filter.name}, `;
                }
            });
            [ { key: `pinned`, name: `pinned` },
                { key: `group`, name: `group` },
                { key: `whitelist`, name: `whitelist` },
                { key: `regionRestricted`, name: `region restricted` },
                { key: `created`, name: `created` },
                { key: `received`, name: `received` },
                { key: `notReceived`, name: `not received` },
                { key: `awaitingFeedback`, name: `awaiting feedback` },
                { key: `entered`, name: `entered` },
                { key: `deleted`, name: `deleted` },
                { key: `owned`, name: `owned`},
                { key: `wishlisted`, name: `wishlisted` },
                { key: `hidden`, name: `hidden` },
                { key: `ignored`, name: `ignored` },
                { key: `previouslyEntered`, name: `previously entered` },
                { key: `previouslyWon`, name: `previously won` },
                { key: `fullCV`, name: `full CV` },
                { key: `reducedCV`, name: `reduced CV` },
                { key: `noCV`, name: `no CV`, },
                { key: `removed`, name: `removed` },
                { key: `tradingCards`, name: `trading cards` },
                { key: `achievements`, name: `achievements` },
                { key: `multiplayer`, name: `multiplayer` },
                { key: `steamCloud`, name: `steam cloud` },
                { key: `linux`, name: `linux` },
                { key: `mac`, name: `mac` },
                { key: `dlc`, name: `dlc` },
                { key: `package`, name: `package` },
                { key: `genres`, name: `genres` }
            ].forEach(key => {
                if (exception[key.key]) {
                    details += (key.key === `genres` ? `genres (${exception.genreList.toLowerCase()}), ` : `${key.name}, `);
                }
            });
            row = insertHtml(table, `beforeEnd`, `
                <div>
                    <div class="esgst-bold esgst-clickable esgst-float-left">${exception.name}</div>
                    <div class="esgst-clickable esgst-float-right">
                        <i class="fa fa-edit" title="Edit exception"></i>
                        <span title="Delete exception">
                            <i class="fa fa-trash"></i>
                        </span>
                    </div>
                    <div class="esgst-clear"></div>
                    <div class="esgst-description">${details.slice(0, -2)}</div>
                </div>
            `);
            heading = row.firstElementChild;
            editButton = heading.nextElementSibling.firstElementChild;
            editButton.addEventListener(`click`, openGfManageExceptionPopup.bind(null, exception, exceptionCount, gf, preset, () => popup.close()));
            editButton.nextElementSibling.addEventListener(`click`, deleteGfException.bind(null, deleted, exception, exceptionCount, gf, heading, preset, row, undoButton));
        });
    }
    popup.description.appendChild(new ButtonSet(`green`, ``, `fa-plus`, ``, `Create Exception`, ``, openGfManageExceptionPopup.bind(null, {}, exceptionCount, gf, preset, () => popup.close())).set);
    popup.open();
}

function openGfManageExceptionPopup(exception, exceptionCount, gf, preset, callback) {
    var basicFilters, categoryFilters, context, typeFilters;
    if (callback) {
        callback();
    }
    popup = new Popup(`fa-edit`, `Create/edit exception:`, true);
    popup.scrollable.classList.add(`esgst-gf-container`, `esgst-gf-filters`, `esgst-text-left`);
    popup.name = insertHtml(popup.description, `afterBegin`, `Name: <input type="text" value="${exception.name || ``}"/>`);
    basicFilters = insertHtml(popup.scrollable, `beforeEnd`, `
        <div class="esgst-gf-basic-filters">
            <div>
                <span class="esgst-bold">Basic Filters:</span>
            </div>
        </div>
    `);
    [{ key: `Level`, name: `Level` },
        { key: `Entries`, name: `Entries` },
        { key: `Copies`, name: `Copies` },
        { key: `Points`, name: `Points` },
        { key: `MinutesToEnd`, name: `Minutes To End` },
        { key: `Chance`, name: `Chance` },
        { key: `Rating`, name: `Rating` }
    ].forEach(filter => {
        context = insertHtml(basicFilters, `beforeEnd`, `
            <div class="esgst-gf-basic-filter esgst-text-left">
                <div>${filter.name} <span class="esgst-float-right"><input type="text" value="${exception[`min${filter.key}`] || ``}"/> - <input type="text" value="${exception[`max${filter.key}`] || ``}"/></span></div>
            </div>
        `).firstElementChild.lastElementChild;
        popup[`min${filter.key}`] = context.firstElementChild;
        popup[`max${filter.key}`] = context.lastElementChild;
    });
    typeFilters = insertHtml(popup.scrollable, `beforeEnd`, `
        <div class="esgst-gf-type-filters">
            <div>
                <span class="esgst-bold">Type Filters:</span>
            </div>
        </div>
    `);
    [{ key: `pinned`, name: `Pinned` },
        { key: `group`, name: `Group` },
        { key: `whitelist`, name: `Whitelist` },
        { key: `regionRestricted`, name: `Region Restricted` },
        { key: `created`, name: `Created` },
        { key: `received`, name: `Received` },
        { key: `notReceived`, name: `Not Received` },
        { key: `awaitingFeedback`, name: `Awaiting Feedback` },
        { key: `entered`, name: `Entered` },
        { key: `started`, name: `Started` },
        { key: `ended`, name: `Ended` },
        { key: `deleted`, name: `Deleted` },
        { key: `owned`, name: `Owned` },
        { key: `wishlisted`, name: `Wishlisted` },
        { key: `hidden`, name: `Hidden` },
        { key: `ignored`, name: `Ignored` },
        { key: `previouslyEntered`, name: `Previously Entered` },
        { key: `previouslyWon`, name: `Previously Won` },
        { key: `fullCV`, name: `Full CV` },
        { key: `reducedCV`, name: `Reduced CV` },
        { key: `noCV`, name: `No CV` }
    ].forEach(filter => {
        popup[filter.key] = new Checkbox(insertHtml(typeFilters, `beforeEnd`, `<div class="esgst-gf-type-filter"><span></span> ${filter.name}</div>`).firstElementChild, exception[filter.key]);
    });
    categoryFilters = insertHtml(popup.scrollable, `beforeEnd`, `
        <div class="esgst-gf-category-filters">
            <div>
                <span class="esgst-bold">Category Filters:</span>
            </div>
        </div>
    `);
    [{ key: `removed`, name: `Removed` },
        { key: `tradingCards`, name: `Trading Cards` },
        { key: `achievements`, name: `Achievements` },
        { key: `multiplayer`, name: `Multiplayer` },
        { key: `steamCloud`, name: `Steam Cloud` },
        { key: `linux`, name: `Linux` },
        { key: `mac`, name: `Mac` },
        { key: `dlc`, name: `DLC` },
        { key: `package`, name: `Package` },
        { key: `genres`, name: `Genres` }
    ].forEach(filter => {
        context = insertHtml(categoryFilters, `beforeEnd`, `<div class="esgst-gf-category-filter"><span></span> ${filter.name}${filter.key === `genres` ? ` <input type="text" value="${exception.genreList || ``}"/>` : ``}</div>`);
        popup[filter.key] = new Checkbox(context.firstElementChild, exception[filter.key]);
        if (filter.key === `genres`) {
            popup.genreList = context.lastElementChild;
        }
    });
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveGfException.bind(null, exceptionCount, gf, preset, popup)).set);
    popup.open();
}

function saveGfException(exceptionCount, gf, preset, popup, callback) {
    var exception, i, presets;
    exception = { name: popup.name.value };
    [`Level`, `Entries`, `Copies`, `Points`, `MinutesToEnd`, `Chance`, `Rating`].forEach(name => {
        if (popup[`max${name}`].value.length) {
            exception[`max${name}`] = parseFloat(popup[`max${name}`].value);
        }
        if (popup[`min${name}`].value.length) {
            exception[`min${name}`] = parseFloat(popup[`min${name}`].value);
        }
    });
    [`pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedback`, `entered`, `started`, `ended`, `deleted`, `owned`, `wishlisted`, `hidden`, `ignored`, `previouslyEntered`, `previouslyWon`, `fullCV`, `reducedCV`, `noCV`, `removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `package`, `genres`].forEach(name => {
        if (popup[name].input.checked) {
            if (name === `genres`) {
                if (popup.genreList.value.length) {
                    exception.genres = 1;
                    exception.genreList = popup.genreList.value;
                }
            } else {
                exception[name] = 1;
            }
        }
    });
    if (!preset.exceptions) {
        preset.exceptions = [];
    }
    for (i = preset.exceptions.length - 1; i >= 0 && preset.exceptions[i].name !== exception.name; --i);
    if (i >= 0) {
        preset.exceptions[i] = exception;
    } else {
        preset.exceptions.push(exception);
        exceptionCount.textContent = preset.exceptions.length;
    }
    gf.exceptions = preset.exceptions;
    presets = JSON.parse(getValue(`filterPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
    presets[i] = preset;
    setValue(`filterPresets`, JSON.stringify(presets));
    callback();
    popup.close();
    filterGfGiveaways(gf);
}

function deleteGfException(deleted, exception, exceptionCount, gf, heading, preset, row, undoButton, event) {
    var deleteButton, exception, i, preset, presets;
    deleteButton = event.currentTarget;
    deleteButton.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
    for (i = preset.exceptions.length - 1; i >= 0 && preset.exceptions[i].name !== exception.name; --i);
    preset.exceptions.splice(i, 1);
    gf.exceptions = preset.exceptions;
    exceptionCount.textContent = preset.exceptions.length;
    presets = JSON.parse(getValue(`filterPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
    presets[i] = preset;
    setValue(`filterPresets`, JSON.stringify(presets));
    deleteButton.innerHTML = `<i class="fa fa-trash"></i>`;
    row.classList.add(`esgst-hidden`);
    deleted.push({
        details: exception,
        row: row
    });
    undoButton.classList.remove(`esgst-hidden`);
    filterGfGiveaways(gf);
}

function undoGfDeleteException(deleted, exceptionCount, gf, preset, undoButton) {
    var exception, i, presets;
    exception = deleted.pop();
    exception.row.classList.remove(`esgst-hidden`);
    exception.row.parentElement.appendChild(exception.row);
    preset.exceptions.push(exception.details);
    gf.exceptions = preset.exceptions;
    exceptionCount.textContent = preset.exceptions.length;
    presets = JSON.parse(getValue(`filterPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
    presets[i] = preset;
    setValue(`filterPresets`, JSON.stringify(presets));
    if (deleted.length === 0) {
        undoButton.classList.add(`esgst-hidden`);
    }
}

function filterGfGiveaways(gf, unfilter, endless) {
    var giveaways;
    giveaways = gf.type === `Popup` ? esgst.popupGiveaways : esgst.currentGiveaways;
    giveaways.forEach(giveaway => {
        if (unfilter) {
            if (giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                giveaway.outerWrap.classList.remove(`esgst-hidden`);
            }
        } else if (filterGfGiveaway(gf, giveaway)) {
            if (!giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                giveaway.outerWrap.classList.add(`esgst-hidden`);
            }
        } else if (giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
            giveaway.outerWrap.classList.remove(`esgst-hidden`);
        }
    });
    updateGfCount(gf, endless);
    if (esgst.gfType !== `Popup` && esgst.checkEndlessScrolling) {
        esgst.checkEndlessScrolling();
    }
}

function filterGfException(gf, giveaway) {
    var basicFilters, categoryFilters, filtered, i, j, key, maxKey, minKey, minutes, n, name, typeFilters;
    basicFilters = [`Level`, `Entries`, `Copies`, `Points`, `MinutesToEnd`, `Chance`, `Rating`];
    typeFilters = [`pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedback`, `entered`, `started`, `ended`, `deleted`, `owned`, `wishlisted`, `hidden`, `ignored`, `previouslyEntered`, `previouslyWon`, `fullCV`, `reducedCV`, `noCV`];
    categoryFilters = [`removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `package`, `genres`];
    filtered = false;
    for (i = 0, n = basicFilters.length; !filtered && i < n; ++i) {
        name = basicFilters[i];
        if ((name === `Rating` && esgst.gc && giveaway.gcReady) || name !== `Rating`) {
            key = name.toLowerCase();
            maxKey = `max${name}`;
            minKey = `min${name}`;
            if (name === `MinutesToEnd`) {
                minutes = (giveaway.endTime - Date.now()) / 60000;
            }
            if (typeof gf[minKey] !== `undefined`) {
                if (name === `MinutesToEnd`) {
                    filtered = minutes >= gf[minKey] && !giveaway.ended ? false : true;
                } else {
                    filtered = giveaway[key] >= gf[minKey] ? false : true;
                }
            }
            if (!filtered) {
                if (typeof gf[maxKey] !== `undefined`) {
                    if (name === `MinutesToEnd`) {
                        filtered = minutes <= gf[maxKey] && !giveaway.ended ? false : true;
                    } else {
                        filtered = giveaway[key] <= gf[maxKey] ? false : true;
                    }
                }
            }
        }
    }
    for (i = 0, n = typeFilters.length; !filtered && i < n; ++i) {
        key = typeFilters[i];
        if ((key === `regionRestricted` && !gf.advancedSearch) || key !== `regionRestricted`) {
            if (gf[key]) {
                filtered = (key === `fullCV` ? !giveaway.reducedCV && !giveaway.noCV : giveaway[key]) ? false : true;
            }
        }
    }
    if (esgst.gc && giveaway.gcReady) {
        for (i = 0, n = categoryFilters.length; !filtered && i < n; ++i) {
            key = categoryFilters[i];
            if (key === `genres` && gf.genres) {
                if (giveaway.genres) {
                    genres = gf.genreList.toLowerCase().split(/,\s/);
                    for (j = genres.length - 1; j >= 0 && giveaway.genres.indexOf(genres[j]) < 0; --j);
                    filtered = j < 0 ? true : false;
                } else {
                    filtered = true;
                }
            } else if (gf[key]) {
                filtered = giveaway[key] ? false : true;
            }
        }
    }
    return filtered;
}

function filterGfGiveaway(gf, giveaway) {
    var basicFilters, categoryFilters, filtered, i, j, key, maxKey, minKey, minutes, n, name, override, typeFilters;
    basicFilters = [`Level`, `Entries`, `Copies`, `Points`, `MinutesToEnd`, `Chance`, `Rating`];
    typeFilters = [`pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedback`, `entered`, `started`, `ended`, `deleted`, `owned`, `wishlisted`, `hidden`, `ignored`, `previouslyEntered`, `previouslyWon`, `fullCV`, `reducedCV`, `noCV`];
    categoryFilters = [`removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `package`, `genres`];
    filtered = false;
    override = 0;
    if (!gf.advancedSearch) {
        for (i = 0, n = basicFilters.length; !filtered && i < n; ++i) {
            name = basicFilters[i];
            if ((name === `Rating` && esgst.gc && giveaway.gcReady) || name !== `Rating`) {
                key = name.toLowerCase();
                maxKey = `max${name}`;
                minKey = `min${name}`;
                if (name === `MinutesToEnd`) {
                    if (!giveaway.ended) {
                        minutes = (giveaway.endTime - Date.now()) / 60000;
                        if (minutes < gf[minKey] || minutes > gf[maxKey]) {
                            filtered = true;
                            override = gf.overrides.minutesToEnd;
                        }
                    }
                } else if (giveaway[key] < gf[minKey] || giveaway[key] > gf[maxKey]) {
                    filtered = true;
                    override = gf.overrides[key];
                }
            }
        }
    }
    for (i = 0, n = typeFilters.length; !filtered && i < n; ++i) {
        key = typeFilters[i];
        if ((key === `regionRestricted` && !gf.advancedSearch) || key !== `regionRestricted`) {
            if ((key === `fullCV` && ((gf.fullCV === `disabled` && !giveaway.reducedCV && !giveaway.noCV) || (gf.fullCV === `none` && (giveaway.reducedCV || giveaway.noCV)))) || (key !== `fullCV` && ((gf[key] === `disabled` && giveaway[key]) || (gf[key] === `none` && !giveaway[key])))) {
                filtered = true;
                override = gf.overrides[key];
            }
        }
    }
    if (esgst.gc && giveaway.gcReady) {
        for (i = 0, n = categoryFilters.length; !filtered && i < n; ++i) {
            key = categoryFilters[i];
            if ((key === `dlc` && !gf.advancedSearch) || key !== `dlc`) {
                if (key === `genres` && gf.genres) {
                    if (giveaway.genres) {
                        genres = gf.genreList.toLowerCase().split(/,\s/);
                        for (j = genres.length - 1; j >= 0 && giveaway.genres.indexOf(genres[j]) < 0; --j);
                        if (j < 0) {
                            filtered = true;
                            override = gf.overrides.genres;
                        }
                    } else {
                        filtered = true;
                        override = gf.overrides.genres;
                    }
                } else if ((gf[key] === `disabled` && giveaway[key]) || (gf[key] === `none` && !giveaway[key])) {
                    filtered = true;
                    override = gf.overrides[key];
                }
            }
        }
    }
    if (gf.exceptions && !override) {
        for (i = gf.exceptions.length - 1; i >= 0 && filtered; --i) {
            filtered = filterGfException(gf.exceptions[i], giveaway);
        }
    }
    return filtered;
}

function updateGfCount(gf, endless) {
    var filtered, giveaway, i, paginationFiltered, points;
    filtered = 0;
    points = 0;
    paginationFiltered = 0;
    key = gf.type === `Popup` ? `popupGiveaways` : `currentGiveaways`;
    for (i = esgst[key].length - 1; i > -1; --i) {
        giveaway = esgst[key][i];
        if (document.body.contains(giveaway.outerWrap) || endless) {
            if (giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                if (!giveaway.pinned) {
                    paginationFiltered += 1;
                }
                filtered += 1;
            } else if (!giveaway.entered) {
                points += giveaway.points;
            }
        } else {
            esgst[key].splice(i, 1);
        }
    }
    gf.filteredCount.textContent = filtered;
    gf.pointsCount.textContent = points;
    if (gf.type !== `Popup`) {
        gf.paginationFilteredCount.textContent = paginationFiltered;
    }
}

/* [PGB] Pinned Giveaways Button */

function loadPgb() {
    var PGBContainer, HTML, PGBIcon;
    if (esgst.pinnedGiveawaysButton) {
        PGBContainer = esgst.pinnedGiveawaysButton.previousElementSibling;
        PGBContainer.classList.add(`esgst-pgb-container`);
        esgst.pinnedGiveawaysButton.remove();
        HTML = `
            <div class="esgst-pgb-button">
                <i class="esgst-pgb-icon fa fa-angle-down"></i>
            </div>
        `;
        PGBContainer.insertAdjacentHTML(`afterEnd`, HTML);
        esgst.pinnedGiveawaysButton = PGBContainer.nextElementSibling;
        PGBIcon = esgst.pinnedGiveawaysButton.firstElementChild;
        esgst.pinnedGiveawaysButton.addEventListener(`click`, togglePGBButton);
    }

    function togglePGBButton() {
        PGBContainer.classList.toggle(`pinned-giveaways__inner-wrap--minimized`);
        PGBIcon.classList.toggle(`fa-angle-down`);
        PGBIcon.classList.toggle(`fa-angle-up`);
    }
}

/* [UEG] Unfaded Entered Giveaways */

function loadUeg() {
    esgst.endlessFeatures.push(removeUegFade);
    removeUegFade(document);
}

function removeUegFade(context) {
    var elements, i, n;
    elements = context.getElementsByClassName(`giveaway__row-inner-wrap is-faded`);
    for (i = 0, n = elements.length; i < n; ++i) {
        elements[i].classList.add(`esgst-ueg`);
    }
}

/* [GB] Giveaway Bookmarks */

function loadGb() {
    esgst.giveawayFeatures.push(getGbGiveaways);
    addGbButton();
}

function addGbButton() {
    var button, context, i, n, html;
    context = document.getElementsByClassName(`nav__left-container`)[0];
    html = `
        <div class="nav__button-container esgst-hidden" title="View your bookmarked giveaways">
            <div class="nav__button">
                <i class="fa fa-bookmark"></i>
            </div>
        </div>
    `;
    button = insertHtml(context, `beforeEnd`, html);
    var bookmarked = [], endingSoon = 1, started = 0, ending = 0;
    createLock(`giveawayLock`, 300, function(deleteLock) {
        var giveaways = JSON.parse(getValue(`giveaways`, `{}`));
        if (esgst.gb_h) {
            button.classList.add(`esgst-gb-highlighted`);
        }
        for (var key in giveaways) {
            if (giveaways[key].bookmarked) {
                if (typeof giveaways[key].started === `undefined`) {
                    giveaways[key].started = true;
                }
                if (Date.now() >= giveaways[key].endTime || !giveaways[key].endTime) {
                    if (giveaways[key].started) {
                        if (esgst.gb_u) {
                            delete giveaways[key].bookmarked;
                        } else {
                            bookmarked.push(giveaways[key]);
                        }
                    } else {
                        bookmarked.push(giveaways[key]);
                        ++started;
                        if (esgst.gb_h) {
                            button.classList.add(`started`);
                        }
                    }
                } else {
                    if (giveaways[key].started) {
                        bookmarked.push(giveaways[key]);
                        endingSoon = giveaways[key].endTime - Date.now() - (esgst.gb_hours * 3600000);
                        if (endingSoon <= 0) {
                            ++ending;
                        }
                    }
                }
            }
        }
        var title;
        if (started || ending) {
            if (started) {
                if (ending) {
                    title = `(${started} started - click to update them, ${ending} ending)`;
                } else {
                    title = `(${started} started - click to update them)`;
                }
            } else {
                title = `(${ending} ending)`;
            }
        } else {
            title = ``;
        }
        button.title = `${button.title} ${title}`;
        if (bookmarked.length) {
            bookmarked.sort(function(a, b) {
                if (a.endTime > b.endTime) {
                    return 1;
                } else if (a.endTime < b.endTime) {
                    return -1;
                } else {
                    return 0;
                }
            });
            for (i = 0, n = bookmarked.length; i < n; ++i) {
                if (Date.now() > bookmarked[i].endTime) {
                    bookmarked.push(bookmarked.splice(i, 1)[0]);
                    i -= 1;
                    n -= 1;
                }
            }
            button.classList.remove(`esgst-hidden`);
            if (esgst.gb_h && ending > 0) {
                button.classList.add(`ending`);
            }
        }
        setValue(`giveaways`, JSON.stringify(giveaways));
        deleteLock();
    });
    button.addEventListener(`click`, function() {
        var popup = new Popup(`fa-bookmark`, `Bookmarked Giveaways`, true);
        var i = 0;
        var n = bookmarked.length;
        var gbGiveaways = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left"></div>`);
        var set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load more...`, `Loading more...`, function (callback) {
            loadGbGiveaways(i, i + 5, bookmarked, gbGiveaways, popup, function (value) {
                i = value;
                if (i > n) {
                    set.set.remove();
                } else if (esgst.es_gb && popup.scrollable.scrollHeight <= popup.scrollable.offsetHeight) {
                    set.trigger();
                }
                callback();
            });
        });
        popup.description.appendChild(set.set);
        popup.open();
        set.trigger();
        if (esgst.es_gb) {
            popup.scrollable.addEventListener(`scroll`, function () {
                if ((popup.scrollable.scrollTop + popup.scrollable.offsetHeight) >= popup.scrollable.scrollHeight && !set.busy) {
                    set.trigger();
                }
            });
        }
    });
}

function loadGbGiveaways(i, n, bookmarked, gbGiveaways, popup, callback) {
    if (i < n) {
        if (bookmarked[i]) {
                request(null, null, true, `/giveaway/${bookmarked[i].code}/`, function (response) {
                    var endTime;
                    var responseHtml = DOM.parse(response.responseText);
                    var container = responseHtml.getElementsByClassName(`featured__outer-wrap--giveaway`)[0];
                    if (container) {
                        var heading = responseHtml.getElementsByClassName(`featured__heading`)[0];
                        var columns = heading.nextElementSibling;
                        var remaining = columns.firstElementChild;
                        endTime = 0;
                        if (!bookmarked[i].started && !remaining.textContent.match(/Begins/)) {
                            endTime = parseInt(remaining.lastElementChild.getAttribute(`data-timestamp`)) * 1e3;
                        }
                            var url = response.finalUrl;
                            var gameId = container.getAttribute(`data-game-id`);
                            var anchors = heading.getElementsByTagName(`a`);
                            var j, numA, numT;
                            for (j = 0, numA = anchors.length; j < numA; ++j) {
                                anchors[j].classList.add(`giveaway__icon`);
                            }
                            var hideButton = heading.getElementsByClassName(`featured__giveaway__hide`)[0];
                            if (hideButton) {
                                hideButton.remove();
                            }
                            var headingName = heading.firstElementChild;
                            headingName.outerHTML = `<a class="giveaway__heading__name" href="${url}">${headingName.innerHTML}</a>`;
                            var thinHeadings = heading.getElementsByClassName(`featured__heading__small`);
                            for (j = 0, numT = thinHeadings.length; j < numT; ++j) {
                                thinHeadings[0].outerHTML = `<span class="giveaway__heading__thin">${thinHeadings[0].innerHTML}</span>`;
                            }
                            remaining.classList.remove(`featured__column`);
                            var created = remaining.nextElementSibling;
                            created.classList.remove(`featured__column`, `featured__column--width-fill`);
                            created.classList.add(`giveaway__column--width-fill`);
                            created.lastElementChild.classList.add(`giveaway__username`);
                            var avatar = columns.lastElementChild;
                            avatar.remove();
                            var element = created.nextElementSibling;
                            while (element) {
                                element.classList.remove(`featured__column`);
                                element.className = element.className.replace(/featured/g, `giveaway`);
                                element = element.nextElementSibling;
                            }
                            var counts = responseHtml.getElementsByClassName(`sidebar__navigation__item__count`);
                            var image = responseHtml.getElementsByClassName(`global__image-outer-wrap--game-large`)[0].firstElementChild.getAttribute(`src`);
                            var popupHtml = `${Date.now() > bookmarked[i].endTime && !gbGiveaways.getElementsByClassName(`row-spacer`)[0] ? `<div class="row-spacer"></div>` : ``}
<div><div class="giveaway__row-outer-wrap" data-game-id="${gameId}">
<div class="giveaway__row-inner-wrap">
<div class="giveaway__summary">
<h2 class="giveaway__heading">
${heading.innerHTML}
</h2>
<div class="giveaway__columns">
${columns.innerHTML}
</div>
<div class="giveaway__links">
<a href="${url}/entries">
<i class="fa fa-tag"></i>
<span>${(counts[1] && counts[1].textContent) || 0} entries</span>
</a>
<a href="${url}/comments">
<i class="fa fa-comment"></i>
<span>${counts[0].textContent} comments</span>
</a>
</div>
</div>
${avatar.outerHTML}
<a class="global__image-outer-wrap global__image-outer-wrap--game-medium" href="${url}">
<div class="global__image-inner-wrap" style="background-image:url(${image});"></div>
</a>
</div>
</div></div>
`;
                            gbGiveaways.insertAdjacentHTML(`beforeEnd`, popupHtml);
                            loadEndlessFeatures(gbGiveaways.lastElementChild, false, `gb`);
                            popup.reposition();
                            if (endTime > 0) {
                                createLock(`giveawayLock`, 300, function (deleteLock) {
                                    var giveaways = JSON.parse(getValue(`giveaways`));
                                    giveaways[bookmarked[i].code].started = true;
                                    giveaways[bookmarked[i].code].endTime = endTime;
                                    setValue(`giveaways`, JSON.stringify(giveaways));
                                    deleteLock();
                                    setTimeout(loadGbGiveaways, 0, ++i, n, bookmarked, gbGiveaways, popup, callback);
                                });
                            } else {
                                setTimeout(loadGbGiveaways, 0, ++i, n, bookmarked, gbGiveaways, popup, callback);
                            }
                        } else {
                            setTimeout(loadGbGiveaways, 0, ++i, n, bookmarked, gbGiveaways, popup, callback);
                        }
                });
            } else {
                callback(i + 1);
            }
    } else {
        callback(i);
    }
}

function getGbGiveaways(giveaways, main) {
    if ((esgst.wonPath && !main) || (!esgst.wonPath)) {
    var savedGiveaways = JSON.parse(getValue(`giveaways`, `{}`));
    for (var i = 0, n = giveaways.length; i < n; ++i) {
        var giveaway = giveaways[i];
        if (((esgst.archivePath && !main) || !esgst.archivePath) && giveaway.creator !== esgst.username && !giveaway.entered && giveaway.url && !giveaway.innerWrap.getElementsByClassName(`esgst-gb-button`)[0]) {
            if (savedGiveaways[giveaway.code] && savedGiveaways[giveaway.code].bookmarked) {
                addGbUnbookmarkButton(giveaway);
            } else if (!giveaway.ended) {
                addGbBookmarkButton(giveaway);
            }
        }
    }
    }
}

function addGbBookmarkButton(giveaway) {
    var button;
    button = insertHtml(giveaway.headingName, `beforeBegin`, `
        <div class="esgst-gb-button" title="Bookmark giveaway">
            <i class="fa fa-bookmark-o"></i>
        </div>
    `);
    button.firstElementChild.addEventListener(`click`, function() {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        bookmarkGbGiveaway(giveaway, function() {
            button.remove();
            addGbUnbookmarkButton(giveaway);
        });
    });
}

function bookmarkGbGiveaway(giveaway, callback) {
    createLock(`giveawayLock`, 300, function(deleteLock) {
        var giveaways;
        giveaways = JSON.parse(getValue(`giveaways`, `{}`));
        if (!giveaways[giveaway.code]) {
            giveaways[giveaway.code] = {};
        }
        giveaways[giveaway.code].code = giveaway.code;
        giveaways[giveaway.code].endTime = giveaway.endTime;
        giveaways[giveaway.code].started = giveaway.started;
        giveaways[giveaway.code].bookmarked = true;
        setValue(`giveaways`, JSON.stringify(giveaways));
        deleteLock();
        if (callback) {
            callback();
        }
    });
}

function addGbUnbookmarkButton(giveaway) {
    var button;
    button = insertHtml(giveaway.headingName, `beforeBegin`, `
        <div class="esgst-gb-button" title="Unbookmark giveaway">
            <i class="fa fa-bookmark"></i>
        </div>
    `);
    button.firstElementChild.addEventListener(`click`, function() {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        unbookmarkGbGiveaway(giveaway, function() {
            button.remove();
            addGbBookmarkButton(giveaway);
        });
    });
}

function unbookmarkGbGiveaway(giveaway, callback) {
        createLock(`giveawayLock`, 300, function(deleteLock) {
            var giveaways;
            giveaways = JSON.parse(getValue(`giveaways`, `{}`));
            if (giveaways[giveaway.code]) {
                delete giveaways[giveaway.code].bookmarked;
            }
            setValue(`giveaways`, JSON.stringify(giveaways));
            deleteLock();
            if (callback) {
                callback();
            }
        });
}

/* [GED] Giveaway Encrypter/Decrypter */

function loadGed() {
    var builtGiveaways, giveaway, button, code, currentDate, filtered, game, giveaways, i, keys, n, newGiveaways, numNew, popup, progress, results, savedGiveaways, set, timestamp;
    newGiveaways = {};
    button = insertHtml(esgst.headerNavigationLeft, `beforeEnd`, `
        <div class="nav__button-container esgst-hidden" title="View your decrypted giveaways.">
            <div class="nav__button">
                <i class="fa fa-star"></i>
            </div>
        </div>
    `);
    createLock(`gedLock`, 300, function (deleteLock) {
        savedGiveaways = getValue(`decryptedGiveaways`, getValue(`exclusiveGiveaways`, {}));
        if (typeof savedGiveaways === `string`) {
            savedGiveaways = JSON.parse(savedGiveaways);
        }
        currentDate = Date.now();
        giveaways = [];
        for (code in savedGiveaways) {
            if (savedGiveaways[code].html) {
                delete savedGiveaways[code].html;
            }
            timestamp = savedGiveaways[code].timestamp;
            giveaway = esgst.giveaways[code];
            if (timestamp > currentDate) {
                filtered = false;
                if (giveaway) {
                    game = null;
                    if (giveaway.gameType && giveaway.gameSteamId) {
                        game = esgst.games[giveaway.gameType][giveaway.gameSteamId];
                    }
                    if (((giveaway.level < esgst.gf_minLevelPopup) || (giveaway.level > esgst.gf_maxLevelPopup)) || ((giveaway.copies < esgst.gf_minCopiesPopup) || (giveaway.copies > esgst.gf_maxCopiesPopup)) || ((giveaway.points < esgst.gf_minPointsPopup) || (giveaway.points > esgst.gf_maxPointsPopup)) || ((esgst.gf_createdPopup === `disabled` && giveaway.creator === esgst.username) || (esgst.gf_createdPopup === `none` && giveaway.creator !== esgst.username)) || (game && (((esgst.gf_hiddenPopup === `disabled` && game.hidden) || (esgst.gf_hiddenPopup === `none` && !game.hidden)) || ((esgst.gf_ownedPopup === `disabled` && game.owned) || (esgst.gf_ownedPopup === `none` && !game.owned)) || ((esgst.gf_ignoredPopup === `disabled` && game.ignored) || (esgst.gf_ignoredPopup === `none` && !game.ignored))))) {
                        filtered = true;
                    }
                }
                if (!filtered) {
                    giveaways.push({
                        code: code,
                        source: savedGiveaways[code].source,
                        timestamp: timestamp
                    });
                }
            }
        }
        setValue(`decryptedGiveaways`, JSON.stringify(savedGiveaways));
        deleteLock();
        n = giveaways.length;
        if (n > 0) {
            button.classList.remove(`esgst-hidden`);
            giveaways.sort(function (a, b) {
                if (a.timestamp < b.timestamp) {
                    return -1;
                } else if (a.timestamp > b.timestamp) {
                    return 1;
                } else {
                    return 0;
                }
            });
        }
        button.addEventListener(`click`, function () {
            var heading;
            popup = new Popup(`fa-star`, `Decrypted Giveaways`, true);
            results = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left"></div>`);
            if (esgst.gf) {
                heading = insertHtml(popup.scrollable, `afterBegin`, `
                    <div class="page__heading"></div>
                `);
                heading.appendChild(addGfContainer(heading, true));
            }
            i = 0;
            set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load More`, `Loading more...`, function (callback) {
                getGedGiveaways({}, giveaways, i, null, i + 5, function (value) {
                    i = value;
                    if (i > n) {
                        set.set.remove();
                    } else if ((esgst.es_ged && popup.scrollable.scrollHeight <= popup.scrollable.offsetHeight) || ((results.children.length - ((esgst.gfPopup && parseInt(esgst.gfPopup.filteredCount.textContent)) || 0)) % 5 !== 0)) {
                        set.trigger();
                    }
                    callback();
                });
            });
            keys = Object.keys(newGiveaways);
            numNew = keys.length;
            if (numNew > 0) {
                progress = insertHtml(popup.description, `beforeEnd`, `
                    <div>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        <span>Decrypting new giveaways...</span>
                    </div>
                `);
                getGedGiveaways({}, newGiveaways, 0, keys, numNew, function () {
                    progress.remove();
                    popup.description.appendChild(set.set);
                    set.trigger();
                });
            } else {
                popup.description.appendChild(set.set);
                set.trigger();
            }
            popup.open();
            if (esgst.es_ged) {
                popup.scrollable.addEventListener(`scroll`, function () {
                    if ((popup.scrollable.scrollTop + popup.scrollable.offsetHeight) >= popup.scrollable.scrollHeight && !set.busy) {
                        set.trigger();
                    }
                });
            }
        });
        esgst.checkGedGiveaways = checkGedGiveaways.bind(null, button, newGiveaways);
        esgst.endlessFeatures.push(esgst.checkGedGiveaways);
        checkGedGiveaways(button, newGiveaways, document);
    });

    function getGedGiveaways(currentGiveaways, giveaways, i, keys, n, callback) {
        var builtGiveaway, data, giveaway, key, responseHtml;
        if (i < n) {
            if (keys) {
                key = keys[i];
                if (key) {
                    giveaway = giveaways[key];
                }
            } else {
                giveaway = giveaways[i];
            }
            if (giveaway) {
                request(null, null, false, `/giveaway/${giveaway.code}/`, function (response) {
                    responseHtml = DOM.parse(response.responseText);
                    builtGiveaway = buildGiveaway(responseHtml, response.finalUrl);
                    if (builtGiveaway) {
                        results.insertAdjacentHTML(`beforeEnd`, builtGiveaway.html);
                        var giveawayy = getGiveawayInfo(results.lastElementChild.lastElementChild, document, esgst.games, null, null, null, false, null, true);
                        esgst.popupGiveaways.push(giveawayy.giveaway);
                        currentGiveaways[giveawayy.data.code] = giveawayy.data;
                        loadEndlessFeatures(results.lastElementChild, false, `ged`);
                        if (giveaway.source) {
                            results.lastElementChild.getElementsByClassName(`giveaway__columns`)[0].insertAdjacentHTML(`afterBegin`, `
                                <a class="esgst-ged-source" href="${giveaway.source.match(/\/discussion\//) ? giveaway.source : `/go/comment/${giveaway.source}`}">Source</a>
                            `);
                        }
                        popup.reposition();
                        if (keys) {
                            results.lastElementChild.getElementsByClassName(`giveaway__heading__name`)[0].insertAdjacentText(`afterBegin`, `[NEW] `);
                            createLock(`gedLock`, 300, function (deleteLock) {
                                savedGiveaways = getValue(`decryptedGiveaways`, getValue(`exclusiveGiveaways`, {}));
                                if (typeof savedGiveaways === `string`) {
                                    savedGiveaways = JSON.parse(savedGiveaways);
                                }
                                savedGiveaways[builtGiveaway.code] = {
                                    source: giveaway.source,
                                    timestamp: builtGiveaway.timestamp
                                };
                                setValue(`decryptedGiveaways`, JSON.stringify(savedGiveaways));
                                deleteLock();
                                setTimeout(getGedGiveaways, 0, currentGiveaways, giveaways, ++i, keys, n, callback);
                            });
                        } else {
                            setTimeout(getGedGiveaways, 0, currentGiveaways, giveaways, ++i, keys, n, callback);
                        }
                    } else {
                        createLock(`gedLock`, 300, function (deleteLock) {
                            savedGiveaways = getValue(`decryptedGiveaways`, getValue(`exclusiveGiveaways`, {}));
                            if (typeof savedGiveaways === `string`) {
                                savedGiveaways = JSON.parse(savedGiveaways);
                            }
                            savedGiveaways[giveaway.code] = {
                                timestamp: 0
                            };
                            setValue(`decryptedGiveaways`, JSON.stringify(savedGiveaways));
                            deleteLock();
                            setTimeout(getGedGiveaways, 0, currentGiveaways, giveaways, ++i, keys, n, callback);
                        });
                    }
                });
            } else {
                lockAndSaveGiveaways(currentGiveaways, callback.bind(null, i + 1));
            }
        } else {
            lockAndSaveGiveaways(currentGiveaways, callback.bind(null, i));
        }
    }
}

function checkGedGiveaways(button, newGiveaways, context) {
    var code, comment, element, elements, elementss, encryptedCode, i, n, n2, newGiveaway, savedGiveaways, source;
    elements = context.querySelectorAll(`[href^="ESGST-"]`);
    n = elements.length;
    savedGiveaways = getValue(`decryptedGiveaways`, getValue(`exclusiveGiveaways`, {}));
    if (typeof savedGiveaways === `string`) {
        savedGiveaways = JSON.parse(savedGiveaways);
    }
    if (n > 0) {
        newGiveaway = false;
        elementss = context.getElementsByClassName(`esgst-ged-icon`);
        for (i = 0, n2 = elementss.length; i < n2; ++i) {
            elementss[0].remove();
        }
        for (i = 0; i < n; ++i) {
            element = elements[i];
            encryptedCode = element.getAttribute(`href`).match(/ESGST-(.+)/)[1];
            if (!encryptedCode.match(/currentVersion/)) {
                code = decryptGedCode(encryptedCode);
                comment = element.closest(`.comment__summary`);
                if (comment) {
                    comment.getElementsByClassName(`comment__actions`)[0].insertAdjacentHTML(`beforeEnd`, `
                        <a class="esgst-ged-icon" href="/giveaway/${code}/" title="ESGST Decrypted Giveaway">
                            <i class="fa fa-star"></i>
                        </a>
                    `);
                    if (comment.querySelector(`.comment__username, .author_name`).textContent !== esgst.username) {
                        source = comment.id || location.href;
                        if (savedGiveaways[code]) {
                            if (!savedGiveaways[code].source) {
                                savedGiveaways[code].source = source;
                            }
                        } else if (!newGiveaways[code]) {
                            newGiveaway = true;
                            newGiveaways[code] = {
                                code: code,
                                source: source
                            };
                        }
                    }
                }
            }
        }
        if (newGiveaway) {
            button.classList.remove(`esgst-hidden`);
            button.firstElementChild.firstElementChild.classList.add(`esgst-positive`);
        }
    } else {
        elements = context.getElementsByClassName(`esgst-ged-icon`);
        for (i = 0, n = elements.length; i < n; ++i) {
            elements[0].remove();
        }
    }
}

function hideGame(button, id, name) {
    var elements, i, popup;
    popup = new Popup(`fa-eye-slash`, `Would you like to hide all giveaways for <span class="esgst-bold">${name}</span>?`, true);
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-check-circle`, `fa-refresh fa-spin`, `Yes`, `Please wait...`, callback => {
        request(`xsrf_token=${esgst.xsrfToken}&do=hide_giveaways_by_game_id&game_id=${id}`, null, false, `/ajax.php`, () => {
            elements = document.querySelectorAll(`.giveaway__row-outer-wrap[data-game-id="${id}"]`);
            for (i = elements.length - 1; i > -1; --i) {
                elements[i].remove();
            }
            button.remove();
            callback();
            popup.close();
        });
    }).set);
    popup.actions.firstElementChild.outerHTML = `
        <a href="/account/settings/giveaways/filters">View Hidden Games</a>
    `;
    popup.open();
}

function buildGiveaway(context, url) {
    var avatar, code, column, columns, comments, counts, endTime, endTimeColumn, entered, entries, giveaway, heading, headingName, i, id, icons, image, n, removeEntryButton, started, startTimeColumn, thinHeadings;
    giveaway = context.getElementsByClassName(`featured__outer-wrap--giveaway`)[0];
    if (giveaway) {
        code = url.match(/giveaway\/(.+?)\//)[1];
        id = giveaway.getAttribute(`data-game-id`);
        heading = giveaway.getElementsByClassName(`featured__heading`)[0];
        icons = heading.getElementsByTagName(`a`);
        for (i = 0, n = icons.length; i < n; ++i) {
            icons[i].classList.add(`giveaway__icon`);
        }
        headingName = heading.firstElementChild;
        headingName.outerHTML = `<a class="giveaway__heading__name" href="${url}">${headingName.innerHTML}</a>`;
        thinHeadings = heading.getElementsByClassName(`featured__heading__small`);
        for (i = 0, n = thinHeadings.length; i < n; ++i) {
            thinHeadings[0].outerHTML = `<span class="giveaway__heading__thin">${thinHeadings[0].innerHTML}</span>`;
        }
        columns = heading.nextElementSibling;
        endTimeColumn = columns.firstElementChild;
        endTimeColumn.classList.remove(`featured__column`);
        endTime = parseInt(endTimeColumn.lastElementChild.getAttribute(`data-timestamp`)) * 1000;
        startTimeColumn = endTimeColumn.nextElementSibling;
        startTimeColumn.classList.remove(`featured__column`, `featured__column--width-fill`);
        startTimeColumn.classList.add(`giveaway__column--width-fill`);
        avatar = columns.lastElementChild;
        avatar.remove();
        startTimeColumn.querySelector(`[style]`).removeAttribute(`style`);
        column = startTimeColumn.nextElementSibling;
        while (column) {
            column.classList.remove(`featured__column`);
            column.className = column.className.replace(/featured/g, `giveaway`);
            column = column.nextElementSibling;
        }
        removeEntryButton = context.getElementsByClassName(`sidebar__entry-delete`)[0];
        if (removeEntryButton && !removeEntryButton.classList.contains(`is-hidden`)) {
            entered = `is-faded`;
        } else {
            entered = ``;
        }
        counts = context.getElementsByClassName(`sidebar__navigation__item__count`);
        if (counts.length > 1) {
            entries = counts[1].textContent;
            comments = counts[0].textContent;
            started = true;
        } else {
            entries = 0;
            comments = counts[0].textContent;
            started = false;
        }
        image = giveaway.getElementsByClassName(`global__image-outer-wrap--game-large`)[0].firstElementChild.getAttribute(`src`);
        return {
            code: code,
            html: `
                <div>
                    <div class="giveaway__row-outer-wrap" data-game-id="${id}">
                        <div class="giveaway__row-inner-wrap ${entered}">
                            <div class="giveaway__summary">
                                <h2 class="giveaway__heading">${heading.innerHTML}</h2>
                                <div class="giveaway__columns">${columns.innerHTML}</div>
                                <div class="giveaway__links">
                                    <a href="${url}/entries">
                                        <i class="fa fa-tag"></i>
                                        <span>${entries} entries</span>
                                    </a>
                                    <a href="${url}/comment">
                                        <i class="fa fa-comment"></i>
                                        <span>${comments} comments</span>
                                    </a>
                                </div>
                            </div>
                            ${avatar.outerHTML}
                            <a class="global__image-outer-wrap global__image-outer-wrap--game-medium" href="${url}">
                                <div class="global__image-inner-wrap" style="background-image: url(${image})"></div>
                            </a>
                        </div>
                    </div>
                </div>
            `,
            started: started,
            timestamp: endTime
        };
    } else {
        return null;
    }
}

function decryptGedCode(encryptedCode) {
    var code, i, n, parts;
    code = ``;
    parts = encryptedCode.split(`-`);
    for (i = 0, n = parts.length; i < n; ++i) {
        code += String.fromCharCode(parseInt(parts[i], 16));
    }
    return rot(code, 13);
}

function encryptGedCode(code) {
    var encryptedCode, i, n, rotated;
    rotated = rot(code, 13);
    encryptedCode = [];
    for (i = 0, n = rotated.length; i < n; ++i) {
        encryptedCode.push(rotated.charCodeAt(i).toString(16));
    }
    return encryptedCode.join(`-`);
}

function rot(string, n) {
    return string.replace(/[a-zA-Z]/g, function (char) {
        return String.fromCharCode(((char <= `Z`) ? 90 : 122) >= ((char = char.charCodeAt(0) + n)) ? char : (char - 26));
    });
}

function saveGedGiveaways(codes, source, callback) {
    var ged, giveaway, giveaways;
    if (codes.length > 0) {
        ged = {
            count: 0,
            decryptedGiveaways: {},
            giveaways: {},
            total: codes.length
        };
        giveaways = getValue(`decryptedGiveaways`, getValue(`exclusiveGiveaways`, {}));
        if (typeof giveaways === `string`) {
            giveaways = JSON.parse(giveaways);
        }
        codes.forEach(code => {
            if (giveaways[code]) {
                ged.count += 1;
            } else {
                giveaway = esgst.giveaways[code];
                if (giveaway && giveaway.endTime) {
                    ged.decryptedGiveaways[code] = {
                        source: source,
                        timestamp: giveaway.endTime
                    };
                    ged.count += 1;
                } else {
                    request(null, null, false, `/giveaway/${code}/`, function (response) {
                        giveaway = getGiveaways(DOM.parse(response.responseText), false, response.finalUrl, false, null, true)[0];
                        ged.giveaways[code] = giveaway;
                        ged.decryptedGiveaways[code] = {
                            source: source,
                            timestamp: giveaway.endTime
                        };
                        ged.count += 1;
                    });
                }
            }
        });
        checkGedComplete(ged, callback);
    } else if (callback) {
        callback();
    }
}

function checkGedComplete(ged, callback) {
    var code, giveaways;
    if (ged.count >= ged.total) {
        giveaways = getValue(`decryptedGiveaways`, getValue(`exclusiveGiveaways`, {}));
        if (typeof giveaways === `string`) {
            giveaways = JSON.parse(giveaways);
        }
        for (code in ged.decryptedGiveaways) {
            giveaways[code] = ged.decryptedGiveaways[code];
        }
        setValue(`decryptedGiveaways`, JSON.stringify(giveaways));
        lockAndSaveGiveaways(ged.giveaways, callback);
    } else {
        setTimeout(checkGedComplete, 100, ged, callback);
    }
}

/* [OCHGB] One-Click Hide Giveaway Button */

function loadOchgb() {
    esgst.giveawayFeatures.push(setOchgbButtons);
}

function setOchgbButtons(giveaways, main) {
    var button, giveaway, i, n;
    for (i = 0, n = giveaways.length; i < n; ++i) {
        giveaway = giveaways[i];
        button = giveaway.innerWrap.querySelector(`.giveaway__hide, .featured__giveaway__hide`);
        if (button) {
            if (esgst.giveawayPath && main) {
                button = button.parentElement;
            }
            giveaway.ochgbButton = insertHtml(button, `afterEnd`, `<a></a>`);
            button.remove();
            giveaway.fade = fadeOchgbGiveaway.bind(null, giveaway, main);
            giveaway.unfade = unfadeOchgbGiveaway.bind(null, giveaway, main);
            addOchgbHideButton(giveaway, main);
        }
    }
}

function addOchgbHideButton(giveaway, main) {
    var button, i, matches, n, newButton;
    giveaway.ochgbButton.innerHTML = `
        <i class="esgst-ochgb ${esgst.giveawayPath && main ? `` : `giveaway__icon`} fa fa-eye-slash" title="Hide game"></i>
    `;
    giveaway.ochgbButton.firstElementChild.addEventListener(`click`, hideOchgbGiveaway.bind(null, giveaway, main));
}

function addOchgbUnhideButton(giveaway, main) {
    var button, i, matches, n, newButton;
    giveaway.ochgbButton.innerHTML = `
        <i class="esgst-ochgb ${esgst.giveawayPath && main ? `` : `giveaway__icon`} fa fa-eye" title="Unhide game"></i>
    `;
    giveaway.ochgbButton.firstElementChild.addEventListener(`click`, unhideOchgbGiveaway.bind(null, giveaway, main));
}

function fadeOchgbGiveaway(giveaway, main) {
    if ((esgst.giveawayPath && !main) || !esgst.giveawayPath) {
        giveaway.innerWrap.classList.add(`esgst-faded`);
    }
    addOchgbUnhideButton(giveaway);
}

function unfadeOchgbGiveaway(giveaway, main) {
    if ((esgst.giveawayPath && !main) || !esgst.giveawayPath) {
        giveaway.innerWrap.classList.remove(`esgst-faded`);
    }
    addOchgbHideButton(giveaway);
}

function hideOchgbGiveaway(giveaway, main, event) {
    event.currentTarget.className = `giveaway__icon fa fa-circle-o-notch fa-spin`;
    request(`xsrf_token=${esgst.xsrfToken}&do=hide_giveaways_by_game_id&game_id=${giveaway.gameId}`, null, false, `/ajax.php`, completeOchgbProcess.bind(null, event.currentTarget, giveaway, `fade`, main));
}

function unhideOchgbGiveaway(giveaway, main, event) {
    event.currentTarget.className = `giveaway__icon fa fa-circle-o-notch fa-spin`;
    request(`xsrf_token=${esgst.xsrfToken}&do=remove_filter&game_id=${giveaway.gameId}`, null, false, `/ajax.php`, completeOchgbProcess.bind(null, event.currentTarget, giveaway, `unfade`, main));
}

function completeOchgbProcess(button, giveaway, key, main) {
    var i, n, source;
    if ((esgst.giveawayPath && !main) || !esgst.giveawayPath) {
        source = main ? `currentGiveaways` : `popupGiveaways`;
        if (esgst.ochgb_f) {
            for (i = 0, n = esgst[source].length; i < n; ++i) {
                if (esgst[source][i].gameId === giveaway.gameId) {
                    esgst[source][i][key]();
                }
            }
        } else {
            for (i = 0, n = esgst[source].length; i < n; ++i) {
                if (esgst[source][i].gameId === giveaway.gameId) {
                    esgst[source][i].outerWrap.remove();
                }
            }
        }
    } else {
        button.remove();
    }
}

/* [GWC] Giveaway Winning Chance */

function loadGwc() {
    esgst.giveawayFeatures.push(addGwcChances);
}

function addGwcChances(giveaways, main, source) {
    var giveaway, i, n;
    if (((esgst.createdPath || esgst.wonPath || esgst.newGiveawayPath) && !main) || (!esgst.createdPath && !esgst.wonPath && !esgst.newGiveawayPath)) {
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            if (((giveaway.inviteOnly && ((main && esgst.giveawayPath) || !main || giveaway.ended)) || !giveaway.inviteOnly) && !giveaway.innerWrap.getElementsByClassName(`esgst-gwc`)[0]) {
                if (giveaway.started) {
                    addGwcChance(insertHtml(giveaway.panel, (esgst.gv && ((main && esgst.giveawaysPath) || (source === `gb` && esgst.gv_gb) || (source === `ged` && esgst.gv_ged) || (source === `ge` && esgst.gv_ge))) ? `afterBegin` : `beforeEnd`, `<div class="${esgst.giveawayPath ? `featured__column` : ``} esgst-gwc" title="Giveaway Winning Chance">`), giveaway);
                } else {
                    giveaway.chance = 100;
                }
            }
        }
    }
}

function addGwcChance(context, giveaway) {
    let advancedChance, basicChance, colors, entries, i;
    entries = giveaway.entered || giveaway.ended || giveaway.created || !esgst.gwc_e ? giveaway.entries : giveaway.entries + 1;
    basicChance = entries > 0 ? Math.round(giveaway.copies / entries * 10000) / 100 : 100;
    basicChance = basicChance > 100 ? 100 : (basicChance <= 0 ? 0.01 : basicChance);
    if (esgst.gwc_a && !giveaway.ended && giveaway.startTime) {
        advancedChance = entries > 0 ? Math.round(giveaway.copies / (entries / (Date.now() - giveaway.startTime) * (giveaway.endTime - giveaway.startTime)) * 10000) / 100 : 100;
        advancedChance = advancedChance > 100 ? 100 : (advancedChance <= 0 ? 0.01 : advancedChance);
    }
    giveaway.chance = esgst.gwc_a && !esgst.gwc_a_b ? advancedChance : basicChance;
    context.setAttribute(`data-chance`, giveaway.chance);
    for (i = esgst.gwc_colors.length - 1; i > -1; --i) {
        colors = esgst.gwc_colors[i];
        if (giveaway.chance >= parseFloat(colors.lower) && giveaway.chance <= parseFloat(colors.upper)) {
            context.style.color = colors.color;
            context.style.fontWeight = `bold`;
            break;
        }
    }
    if (esgst.enteredPath) {
        context.style.display = `inline-block`;
        if (esgst.gwr) {
            context.innerHTML = `
                <span>${esgst.gwc_a && advancedChance ? (esgst.gwc_a_b ? `${basicChance}% (${advancedChance}%)` : `${advancedChance}%`) : `${basicChance}%`} / </span>
            `;
        } else {
            context.innerHTML = `
                <span>${esgst.gwc_a && advancedChance ? (esgst.gwc_a_b ? `${basicChance}% (${advancedChance}%)` : `${advancedChance}%`) : `${basicChance}%`}</span>
            `;
        }
    } else {
        context.innerHTML = `
            <i class="fa fa-area-chart"></i>
            <span>${esgst.gwc_a && advancedChance ? (esgst.gwc_a_b ? `${basicChance}% (${advancedChance}%)` : `${advancedChance}%`) : `${basicChance}%`}</span>
        `;
    }
}

/* [GWR] Giveaway Winning Ratio */

function loadGwr() {
    esgst.giveawayFeatures.push(addGwrRatios);
}

function addGwrRatios(giveaways, main, source) {
    var giveaway, i, n;
    if (((esgst.createdPath || esgst.wonPath || esgst.newGiveawayPath) && !main) || (!esgst.createdPath && !esgst.wonPath && !esgst.newGiveawayPath)) {
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            if (giveaway.started && ((giveaway.inviteOnly && ((main && esgst.giveawayPath) || !main || giveaway.ended)) || !giveaway.inviteOnly) && !giveaway.innerWrap.getElementsByClassName(`esgst-gwr`)[0]) {
                addGwcRatio(insertHtml(giveaway.panel, (esgst.gv && ((main && esgst.giveawaysPath) || (source === `gb` && esgst.gv_gb) || (source === `ged` && esgst.gv_ged) || (source === `ge` && esgst.gv_ge))) ? `afterBegin` : `beforeEnd`, `<div class="${esgst.giveawayPath ? `featured__column` : ``} esgst-gwr" title="Giveaway Winning Ratio">`), giveaway);
            }
        }
    }
}

function addGwcRatio(context, giveaway) {
    let advancedRatio, basicRatio, entries;
    entries = giveaway.entered || giveaway.ended || giveaway.created || !esgst.gwr_e ? giveaway.entries : giveaway.entries + 1;
    basicRatio = Math.round(entries / giveaway.copies);
    if (esgst.gwr_a && !giveaway.ended && giveaway.startTime) {
        advancedRatio = Math.round((entries / (Date.now() - giveaway.startTime) * (giveaway.endTime - giveaway.startTime)) / giveaway.copies);
    }
    giveaway.ratio = esgst.gwr_a && !esgst.gwr_a_b ? advancedRatio : basicRatio;
    context.setAttribute(`data-ratio`, giveaway.ratio);
    for (i = esgst.gwr_colors.length - 1; i > -1; --i) {
        colors = esgst.gwr_colors[i];
        if (giveaway.ratio >= parseInt(colors.lower) && giveaway.ratio <= parseInt(colors.upper)) {
            context.style.color = colors.color;
            context.style.fontWeight = `bold`;
            break;
        }
    }
    if (esgst.enteredPath) {
        context.style.display = `inline-block`;
        context.innerHTML = `
            <span>${esgst.gwr_a && advancedRatio? (esgst.gwr_a_b ? `${basicRatio}:1 (${advancedRatio}:1)` : `${advancedRatio}:1`) : `${basicRatio}:1`}</span>
        `;
    } else {
        context.innerHTML = `
            <i class="fa fa-pie-chart"></i>
            <span>${esgst.gwr_a && advancedRatio ? (esgst.gwr_a_b ? `${basicRatio}:1 (${advancedRatio}:1)` : `${advancedRatio}:1`) : `${basicRatio}:1`}</span>
        `;
    }
}

function addGwcrHeading(context, main) {
    var table, title;
    if ((!esgst.createdPath && !esgst.wonPath) && main) {
        table = context.getElementsByClassName(`table__heading`)[0];
        if (table && !table.getElementsByClassName(`esgst-gwcr-heading`)[0]) {
            if (esgst.gwc && esgst.gwr) {
                title = `Chance / Ratio`;
            } else if (esgst.gwc) {
                title = `Chance`;
            } else {
                title = `Ratio`;
            }
            table.firstElementChild.insertAdjacentHTML(`afterEnd`, `<div class="table__column--width-small text-center esgst-gwcr-heading">${title}</div>`);
        }
    }
}

/* [GP] Giveaway Popup */

function loadGp() {
    esgst.giveawayFeatures.push(addGpButtons);
}

function addGpButtons(giveaways, main, source) {
    let buttonSet;
    if (((esgst.createdPath || esgst.enteredPath || esgst.wonPath || esgst.giveawayPath) && !main) || (!esgst.createdPath && !esgst.enteredPath && !esgst.wonPath && !esgst.giveawayPath)) {
        giveaways.forEach(giveaway => {
            if (!giveaway.innerWrap.getElementsByClassName(`esgst-gp-button`)[0] && (!giveaway.inviteOnly || giveaway.url)) {
                buttonSet = new ButtonSet(`grey`, `grey`, `fa-external-link`, `fa-circle-o-notch fa-spin`, ``, ``, openElgbPopup.bind(null, giveaway, main, source)).set;
                buttonSet.classList.add(`esgst-gp-button`);
                buttonSet.title = `View giveaway description/add a comment`;
                giveaway.panel.appendChild(buttonSet);
            }
        });
    }
}

/* [ELGB] Enter/Leave Giveaway Button */

function loadElgb() {
    esgst.giveawayFeatures.push(addElgbButtons);
}

function addElgbButtons(giveaways, main, source) {
    var games, giveaway, i, n;
    games = JSON.parse(getValue(`games`));
    if (((main && !esgst.elgb_p) || !main) && (((esgst.createdPath || esgst.enteredPath || esgst.wonPath) && !main) || (!esgst.createdPath && !esgst.enteredPath && !esgst.wonPath))) {
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            if (!giveaway.innerWrap.getElementsByClassName(`esgst-elgb-button`)[0]) {
                if (((giveaway.inviteOnly && giveaway.url) || !giveaway.inviteOnly) && giveaway.started && !giveaway.ended && !giveaway.created && giveaway.level <= esgst.level && ((giveaway.id && ((games[giveaway.type][giveaway.id] && !games[giveaway.type][giveaway.id].owned && !games[giveaway.type][giveaway.id].won && (!games[giveaway.type][giveaway.id].hidden || !esgst.hgebd)) || !games[giveaway.type][giveaway.id])) || !giveaway.id)) {
                    if (esgst.giveawayPath && main) {
                        let sidebarButton = document.getElementsByClassName(`sidebar__error is-disabled`)[0];
                        if (sidebarButton && sidebarButton.textContent.trim() === `Not Enough Points`) {
                            giveaway.elgbPanel = insertHtml(sidebarButton.parentElement, `afterBegin`, `<div></div>`);
                            sidebarButton.remove();
                            addElgbButton(giveaway, null, main, source);
                        }
                    } else {
                        addElgbButton(giveaway, null, main, source);
                    }
                }
            }
        }
    }
}

function addElgbButton(giveaway, error, main, source) {
    if (giveaway.elgbButton) {
        giveaway.elgbButton.remove();
    }
    if (giveaway.entered) {
        giveaway.elgbButton = new ButtonSet(`yellow`, `grey`, `fa-minus-circle`, `fa-circle-o-notch fa-spin`, `Leave`, `Leaving...`, leaveElgbGiveaway.bind(null, giveaway, main, source)).set;
        giveaway.elgbButton.removeAttribute(`title`);
    } else if (giveaway.error) {
        giveaway.elgbButton = new ButtonSet(`red`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Enter`, `Entering...`, enterElgbGiveaway.bind(null, giveaway, main, null, source)).set;
        giveaway.elgbButton.setAttribute(`title`, error);
    } else {
        if (giveaway.points <= esgst.points) {
            giveaway.elgbButton = new ButtonSet(`green`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Enter`, `Entering...`, enterElgbGiveaway.bind(null, giveaway, main, null, source)).set;
            giveaway.elgbButton.removeAttribute(`title`);
        } else {
            giveaway.elgbButton = new ButtonSet(`red`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Enter`, `Entering...`, enterElgbGiveaway.bind(null, giveaway, main, null, source)).set;
            giveaway.elgbButton.setAttribute(`title`, `Not Enough Points`);
        }
    }
    giveaway.elgbButton.classList.add(`esgst-elgb-button`);
    if (esgst.gv && ((main && esgst.giveawaysPath) || (source === `gb` && esgst.gv_gb) || (source === `ged` && esgst.gv_ged) || (source === `ge` && esgst.gv_ge))) {
        giveaway.elgbPanel.insertBefore(giveaway.elgbButton, giveaway.elgbPanel.firstElementChild);
    } else {
        giveaway.elgbPanel.appendChild(giveaway.elgbButton);
    }
}

function openElgbPopup(giveaway, main, source, mainCallback) {
    var box, description, popup, set;
    request(null, null, false, giveaway.url, function(response) {
        popup = new Popup(`fa-file-text-o`, `<a href="${giveaway.url}"><span>${giveaway.name}</span></a> by <a href="/user/${giveaway.creator}">${giveaway.creator}</a>`, true);
        if (giveaway.entered) {
            set = new ButtonSet(`yellow`, `grey`, `fa-minus-circle`, `fa-circle-o-notch fa-spin`, `Leave Giveaway`, `Leaving...`, function (callback) {
                leaveElgbGiveaway(giveaway, main, source, function () {
                    callback();
                    popup.close();
                });
            });
            popup.description.appendChild(set.set);
        } else {
            let games = JSON.parse(getValue(`games`));
            if (giveaway.started && !giveaway.ended && !giveaway.created && giveaway.level <= esgst.level && ((giveaway.id && ((games[giveaway.type][giveaway.id] && !games[giveaway.type][giveaway.id].owned && (!games[giveaway.type][giveaway.id].hidden || !esgst.hgebd)) || !games[giveaway.type][giveaway.id])) || !giveaway.id)) {
                set = new ButtonSet(`green`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Enter Giveaway`, `Entering...`, function (callback) {
                    enterElgbGiveaway(giveaway, main, true, source, function () {
                        callback();
                        popup.close();
                    });
                });
                popup.description.appendChild(set.set);
            }
        }
        description = DOM.parse(response.responseText).getElementsByClassName(`page__description`)[0];
        if (description && !mainCallback) {
            if (esgst.elgb_c) {
                if (Date.now() - esgst.elgbCache.timestamp > 3600000) {
                    esgst.elgbCache = {
                        descriptions: {},
                        timestamp: Date.now()
                    };
                    setValue(`esgst_elgbCache`, JSON.stringify(esgst.elgbCache));
                }
                if (!esgst.elgbCache.descriptions[giveaway.creator]) {
                    esgst.elgbCache.descriptions[giveaway.creator] = [];
                }
                let html = description.innerHTML, i;
                for (i = esgst.elgbCache.descriptions[giveaway.creator].length - 1; i > -1 && esgst.elgbCache.descriptions[giveaway.creator][i] !== html; --i);
                if (i > -1) {
                    description = null;
                } else {
                    esgst.elgbCache.descriptions[giveaway.creator].push(html);
                    setValue(`esgst_elgbCache`, JSON.stringify(esgst.elgbCache));
                    if (esgst.elgb_f) {
                        let text = description.textContent.replace(/[^a-zA-Z]/g, ``).toLowerCase();
                        if (text.match(new RegExp(`^(${esgst.elgb_filters})$`))) {
                            description = null;
                        }
                    }
                }
            } else if (esgst.elgb_f) {
                let text = description.textContent.replace(/[^a-zA-Z]/g, ``).toLowerCase();
                if (text.match(new RegExp(`^(${esgst.elgb_filters})$`))) {
                    description = null;
                }
            }
        }
        if (description) {
            description.classList.add(`esgst-text-left`);
            popup.scrollable.insertAdjacentHTML(`beforeEnd`, description.outerHTML);
            if (esgst.elgb_r || mainCallback) {
                box = insertHtml(popup.scrollable, `beforeEnd`, `<textarea></textarea>`);
                addCFHPanel(box);
                popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-arrow-circle-right`, `fa-circle-o-notch fa-spin`, `Add Comment`, `Saving...`, function (callback) {
                    if (box.value) {
                        request(`xsrf_token=${esgst.xsrfToken}&do=comment_new&description=${box.value}`, null, false, giveaway.url, function() {
                            callback();
                            popup.close();
                        });
                    } else {
                        callback();
                        popup.close();
                    }
                }).set);
                if (mainCallback) {
                    popup.onClose = mainCallback;
                }
                set = new ButtonSet(`grey`, `grey`, `fa-eye`, `fa-circle-o-notch fa-spin`, `Add Description To Filters`, `Filtering...`, function (callback) {
                    esgst.elgb_filters = `${esgst.elgb_filters}|${description.textContent.replace(/[^a-zA-Z]/g, ``).toLowerCase()}`;
                    setValue(`elgb_filters`, esgst.elgb_filters);
                    callback();
                    set.remove();
                }).set;
                popup.description.appendChild(set);
                popup.open(function () {
                    box.focus();
                });
            } else {
                if (mainCallback) {
                    popup.onClose = mainCallback;
                }
                set = new ButtonSet(`grey`, `grey`, `fa-eye`, `fa-circle-o-notch fa-spin`, `Add Description To Filters`, `Filtering...`, function (callback) {
                    esgst.elgb_filters = `${esgst.elgb_filters}|${description.textContent.replace(/[^a-zA-Z]/g, ``).toLowerCase()}`;
                    setValue(`elgb_filters`, esgst.elgb_filters);
                    callback();
                    set.remove();
                }).set;
                popup.description.appendChild(set);
                popup.open();
            }
        } else if ((esgst.elgb_r && !esgst.elgb_r_d) || mainCallback) {
            box = insertHtml(popup.scrollable, `beforeEnd`, `<textarea></textarea>`);
            addCFHPanel(box);
            popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-arrow-circle-right`, `fa-circle-o-notch fa-spin`, `Add Comment`, `Saving...`, function (callback) {
                if (box.value) {
                    request(`xsrf_token=${esgst.xsrfToken}&do=comment_new&description=${box.value}`, null, false, giveaway.url, function() {
                        callback();
                        popup.close();
                    });
                } else {
                    callback();
                    popup.close();
                }
            }).set);
            if (mainCallback) {
                popup.onClose = mainCallback;
            }
            popup.open(function () {
                box.focus();
            });
        } else if (mainCallback) {
            mainCallback();
        }
    });
}

function enterElgbGiveaway(giveaway, main, popup, source, callback) {
    request(`xsrf_token=${esgst.xsrfToken}&do=entry_insert&code=${giveaway.code}`, null, false, `/ajax.php`, function(response) {
        var responseJson;
        responseJson = JSON.parse(response.responseText);
        if (responseJson.type === `success`) {
            if (!esgst.giveawayPath || !main) {
                giveaway.innerWrap.classList.add(`is-faded`);
            }
            giveaway.entered = true;
            giveaway.error = false;
            addElgbButton(giveaway, null, main, source);
            if (esgst.et) {
                setEtEntry(giveaway.code, true, giveaway.name);
            }
            esgst.pointsContainer.textContent = responseJson.points;
            refreshHeaderElements(document);
            if (esgst.hr) {
                setValue(`esgst_hrCache`, JSON.stringify(getHrCache()));
            }
            updateElgbButtons();
            if (esgst.egh) {
                saveEghGame(giveaway.id, giveaway.type);
            }
            if (esgst.gb) {
                var button = giveaway.outerWrap.getElementsByClassName(`esgst-gb-button`)[0];
                if (button) {
                    unbookmarkGbGiveaway(giveaway, function() {
                        button.remove();
                        addGbBookmarkButton(giveaway);
                    });
                }
            }
            if (esgst.gf && esgst.gf.filteredCount && esgst[`gf_enable${esgst.gf.type}`]) {
                filterGfGiveaways(esgst.gf);
            }
            if (esgst.gfPopup && esgst.gfPopup.filteredCount && esgst.gf_enablePopup) {
                filterGfGiveaways(esgst.gfPopup);
            }
            callback();
            if (!popup && (!esgst.giveawayPath || !main)) {
                openElgbPopup(giveaway, main, source);
            }
        } else {
            giveaway.entered = false;
            giveaway.error = true;
            addElgbButton(giveaway, responseJson.msg, main, source);
            callback();
        }
    });
}

function leaveElgbGiveaway(giveaway, main, source, callback) {
    request(`xsrf_token=${esgst.xsrfToken}&do=entry_delete&code=${giveaway.code}`, null, false, `/ajax.php`, function(response) {
        var responseJson;
        responseJson = JSON.parse(response.responseText);
        if (responseJson.type === `success`) {
            giveaway.innerWrap.classList.remove(`is-faded`);
            giveaway.entered = false;
            giveaway.error = false;
            addElgbButton(giveaway, null, main, source);
            if (esgst.et) {
                setEtEntry(giveaway.code, false, giveaway.name);
            }
            esgst.pointsContainer.textContent = responseJson.points;
            refreshHeaderElements(document);
            if (esgst.hr) {
                setValue(`esgst_hrCache`, JSON.stringify(getHrCache()));
            }
            updateElgbButtons();
            if (esgst.gf && esgst.gf.filteredCount && esgst[`gf_enable${esgst.gf.type}`]) {
                filterGfGiveaways(esgst.gf);
            }
            if (esgst.gfPopup && esgst.gfPopup.filteredCount && esgst.gf_enablePopup) {
                filterGfGiveaways(esgst.gfPopup);
            }
            callback();
        } else {
            callback();
        }
    });
}

function updateElgbButtons() {
    var giveaway, i, n;
    for (i = 0, n = esgst.currentGiveaways.length; i < n; ++i) {
        giveaway = esgst.currentGiveaways[i];
        if (giveaway.elgbButton && !giveaway.entered) {
            addElgbButton(giveaway, null, true);
        }
    }
}

/* [GGL] Giveaway Groups Loader */

function loadGgl() {
    if (esgst.ggl_p) {
        esgst.giveawayFeatures.push(setGglButtons);
    } else {
        esgst.giveawayFeatures.push(getGglGiveaways);
    }
}

function setGglButtons(giveaways, main) {
    var i, n;
    if ((main && !esgst.createdPath && !esgst.enteredPath && !esgst.wonPath) || !main) {
        for (i = 0, n = giveaways.length; i < n; ++i) {
            setGglButton(giveaways[i]);
        }
    }
}

function setGglButton(giveaway) {
    if (giveaway.group) {
        giveaway.group.classList.add(`esgst-ggl-button`);
        giveaway.group.removeAttribute(`href`);
        giveaway.group.addEventListener(`click`, function() {
            var newGiveaways, newGroups, panel, popup, progress, savedGiveaways, savedGroups;
            popup = new Popup(`fa-user`, `<a href="${giveaway.url}/groups">Giveaway Groups</a>`, true);
            progress = insertHtml(popup.description, `beforeEnd`,  `
                <div>
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Loading groups...</span>
                </div>
            `);
            panel = insertHtml(popup.scrollable, `beforeEnd`, `
                <div class="esgst-text-left table esgst-hidden">
                    <div class="table__rows"></div>
                </div>
            `);
            popup.open();
            newGiveaways = {};
            newGroups = {};
            savedGiveaways = JSON.parse(getValue(`giveaways`, `{}`));
            savedGroups = JSON.parse(getValue(`groups`, `[]`));
            loadGglGroups([giveaway], 0, 1, newGiveaways, newGroups, savedGiveaways, savedGroups, function(groups) {
                var className, code, group, groupCount, i, j, n, link;
                if (groups) {
                    groupCount = 0;
                    for (i = 0, n = groups.length; i < n; ++i) {
                        code = groups[i];
                        for (j = savedGroups.length - 1; j >= 0 && savedGroups[j].code !== code; --j);
                        if (j >= 0) {
                            group = savedGroups[j];
                        } else {
                            group = newGroups[code];
                        }
                        if (group && group.member) {
                            className = `esgst-ggl-member`;
                            groupCount += 1;
                        } else if (esgst.ggl_m) {
                            className = `esgst-hidden`;
                        } else {
                            className = ``;
                            groupCount += 1;
                        }
                        if (className !== `esgst-hidden`) {
                            link = insertHtml(panel.lastElementChild, `beforeEnd`, `
                                <div class="table__row-outer-wrap ${className}">
                                    <div class="table__row-inner-wrap">
                                        <div>
                                            <a class="table_image_avatar" href="/group/${group.code}/" style="background-image:url(http://cdn.edgecast.steamstatic.com/steamcommunity/public/images/avatars/${group.avatar}_medium.jpg)"></a>
                                        </div>
                                        <div class="table__column--width-fill">
                                            <a class="table__column__heading" href="/group/${group.code}/"></a>
                                        </div>
                                    </div>
                                </div>
                            `).getElementsByClassName(`table__column__heading`)[0];
                            link.textContent = group.name;
                        }
                    }
                    if (groupCount === 0) {
                        progress.innerHTML = `
                            <i class="fa fa-exclamation-mark"></i>
                            <span>You are not a member of any group in this giveaway.</span>
                        `;
                    } else {
                        panel.classList.remove(`esgst-hidden`);
                        loadEndlessFeatures(panel);
                        progress.remove();
                    }
                    popup.reposition();
                } else {
                    progress.innerHTML = `
                        <i class="fa fa-times-circle"></i>
                        <span>An error ocurred.</span>
                    `;
                    popup.reposition();
                }
            });
        });
    }
}

function getGglGiveaways(giveaways) {
    var newGiveaways, newGroups, savedGiveaways, savedGroups;
    newGiveaways = {};
    newGroups = {};
    savedGiveaways = JSON.parse(getValue(`giveaways`, `{}`));
    savedGroups = JSON.parse(getValue(`groups`, `[]`));
    loadGglGroups(giveaways, 0, giveaways.length, newGiveaways, newGroups, savedGiveaways, savedGroups);
}

function loadGglGroups(giveaways, i, n, newGiveaways, newGroups, savedGiveaways, savedGroups, callback) {
    var giveaway;
    if (i < n) {
        giveaway = giveaways[i];
        if (giveaway.group) {
            if (savedGiveaways[giveaway.code] && Array.isArray(savedGiveaways[giveaway.code].groups)) {
                if (callback) {
                    callback(savedGiveaways[giveaway.code].groups);
                } else {
                    addGglPanel(giveaway, savedGiveaways[giveaway.code].groups, newGroups, savedGroups);
                }
                setTimeout(loadGglGroups, 0, giveaways, ++i, n, newGiveaways, newGroups, savedGiveaways, savedGroups);
            } else {
                getGglGroups([], 1, newGroups, `${giveaway.url}/groups/search?page=`, function (groups) {
                    if (groups) {
                        newGiveaways[giveaway.code] = {
                            groups: groups
                        };
                        if (callback) {
                            callback(groups);
                        } else {
                            addGglPanel(giveaway, groups, newGroups, savedGroups);
                        }
                        setTimeout(loadGglGroups, 0, giveaways, ++i, n, newGiveaways, newGroups,  savedGiveaways, savedGroups);
                    } else if (callback) {
                        callback(null);
                    } else {
                        setTimeout(loadGglGroups, 0, giveaways, ++i, n, newGiveaways, newGroups,  savedGiveaways, savedGroups);
                    }
                });
            }
        } else {
            setTimeout(loadGglGroups, 0, giveaways, ++i, n, newGiveaways, newGroups,  savedGiveaways, savedGroups);
        }
    } else {
        lockAndSaveGiveaways(newGiveaways);
        lockAndSaveGroups(newGroups);
    }
}

function addGglPanel(giveaway, groups, newGroups, savedGroups) {
    var className, code, group, groupCount, i, link, n, panel;
    if (!giveaway.summary.getElementsByClassName(`esgst-ggl-panel`)[0]) {
        panel = insertHtml(giveaway.summary, `beforeEnd`, `
            <div class="esgst-ggl-panel"></div>
        `);
        groupCount = 0;
        for (i = 0, n = groups.length; i < n; ++i) {
            code = groups[i];
            for (j = savedGroups.length - 1; j >= 0 && savedGroups[j].code !== code; --j);
            if (j >= 0) {
                group = savedGroups[j];
            } else {
                group = newGroups[code];
            }
            if (group && group.member) {
                className = `esgst-ggl-member`;
                groupCount += 1;
            } else if (esgst.ggl_m) {
                className = `esgst-hidden`;
            } else {
                className = ``;
                groupCount += 1;
            }
            if (className !== `esgst-hidden`) {
                link = insertHtml(panel, `beforeEnd`, `
                    <div class="${className}">
                        <a class="table_image_avatar" href="/group/${group.code}/"  style="background-image:url(http://cdn.edgecast.steamstatic.com/steamcommunity/public/images/avatars/${group.avatar}_medium.jpg)"></a>
                        <a href="/group/${group.code}/"></a>
                    </div>
                `).lastElementChild;
                link.textContent = group.name;
                if (esgst.ap) {
                    getApAvatars(panel);
                }
            }
        }
        if (groupCount === 0) {
            panel.remove();
        }
    }
}

function getGglGroups(groups, nextPage, newGroups, url, callback) {
    var code, element, elements, error, heading, i, match, n, pagination, responseHtml;
    request(null, null, false, `${url}${nextPage}`, function(response) {
        responseHtml = DOM.parse(response.responseText);
        error = responseHtml.getElementsByClassName(`table--summary`)[0];
        if (error) {
            setTimeout(callback, 0, null);
        } else {
            elements = responseHtml.getElementsByClassName(`table__row-inner-wrap`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                heading = element.getElementsByClassName(`table__column__heading`)[0];
                match = heading.getAttribute(`href`).match(/group\/(.+?)\//);
                code = match[1];
                newGroups[code] = {
                    avatar: element.getElementsByClassName(`table_image_avatar`)[0].style.backgroundImage.match(/\/avatars\/(.+)_medium/)[1],
                    code: code,
                    name: heading.textContent
                };
                groups.push(code);
            }
            pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
            if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(getGglGroups, 0, groups, ++nextPage, newGroups, url, callback);
            } else {
                setTimeout(callback, 0, groups);
            }
        }
    });
}

/* [GWL] Giveaway Winners Link */

function addGwlLinks(giveaways) {
    var giveaway, i, link, n;
    for (i = 0, n = giveaways.length; i < n; ++i) {
        giveaway = giveaways[i];
        if (!giveaway.innerWrap.getElementsByClassName(`esgst-gwl`)[0]) {
            if (giveaway.ended) {
                link = giveaway.url ? `href="${giveaway.url}/winners"` : ``;
                giveaway.entriesLink.insertAdjacentHTML(`afterEnd`, `
                    <a class="esgst-gwl" ${link}>
                        <i class="fa fa-trophy"></i>
                        <span>${giveaway.winners} winners</span>
                    </a>
                `);
            }
        }
    }
}

/* [GR] Giveaway Recreator */

function recreateGrGiveaway(button, giveaway) {
    var context, elements, giveaways, i, keys, n, responseJson, template;
    button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
    if (esgst.createdPath) {
        request(null, null, false, giveaway.url, function (response) {
            saveGrTemplate(button, getGiveaways(DOM.parse(response.responseText), false, response.finalUrl, false, `giveaway`)[0] || giveaway);
        });
    } else {
        saveGrTemplate(button, giveaway);
    }
}

function saveGrTemplate(button, giveaway) {
    request(`do=autocomplete_giveaway_game&page_number=1&search_query=${encodeURIComponent(giveaway.name)}`, null, false, `/ajax.php`, function(response) {
        template = {
            delay: 0,
            description: ``,
            duration: giveaway.endTime - giveaway.startTime,
            gameName: giveaway.name,
            groups: ``,
            level: giveaway.level,
            region: `0`
        };
        if (giveaway.group || giveaway.whitelist) {
            template.type = `groups`;
            if (giveaway.whitelist) {
                template.whitelist = `1`;
            }
        } else if (giveaway.inviteOnly) {
            template.type = `invite_only`;
        } else {
            template.type = `everyone`;
        }
        elements = DOM.parse(JSON.parse(response.responseText).html).getElementsByClassName(`table__row-outer-wrap`);
        for (i = 0, n = elements.length; i < n && elements[i].getAttribute(`data-autocomplete-name`) !== giveaway.name; ++i);
        if (i < n) {
            template.gameId = elements[i].getAttribute(`data-autocomplete-id`);
        }
        request(`xsrf_token=${esgst.xsrfToken}&do=popup_keys&code=${giveaway.code}`, null, false, `/ajax.php`, function (response) {
            responseJson = JSON.parse(response.responseText);
            keys = [];
            context = DOM.parse(JSON.parse(response.responseText).html).getElementsByClassName(`popup__keys__heading`)[0];
            if (context) {
                elements = context.nextElementSibling.nextElementSibling.children;
                for (i = 0, n = elements.length; i < n; ++i) {
                    keys.push(elements[i].textContent);
                }
            }
            if (keys.length > 0) {
                template.keys = keys.join(`\n`);
            } else {
                template.copies = giveaway.copies;
            }
            setValue(`grTemplate`, JSON.stringify(template));
            giveaways = JSON.parse(getValue(`giveaways`));
            if (!giveaways[giveaway.code]) {
                giveaways[giveaway.code] = {};
            }
            giveaways[giveaway.code].recreated = true;
            setValue(`giveaways`, JSON.stringify(giveaways));
            button.remove();
            open(`/giveaways/new`);
        });
    });
}

function loadGrGiveaway() {
    var template;
    template = getValue(`grTemplate`);
    if (template) {
        delValue(`grTemplate`);
        template = JSON.parse(template);
        applyGtsTemplate(template);
    }
}

/* [GTS] Giveaway Templates */

function addGtsButtonSection(button, rows) {
    var createGiveawayButton, delay, deletedTemplates, edit, endTime, input, message, preciseEndCheckbox, preciseEndOption, preciseStartCheckbox, preciseStartOption, reviewButton, section, set, startTime, undo, warning;
    if (rows) {
        gts = {};
        deletedTemplates = [];
        reviewButton = rows.lastElementChild;
        createGiveawayButton = new ButtonSet(`green`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Create Giveaway`, `Creating...`, function (callback) {
            var data;
            data = `xsrf_token=${esgst.xsrfToken}&next_step=3&`;
            data += `game_id=${document.querySelector(`[name="game_id"]`).value}&`;
            data += `type=${document.querySelector(`[name="type"]`).value}&`;
            data += `copies=${document.querySelector(`[name="copies"]`).value}&`;
            data += `key_string=${document.querySelector(`[name="key_string"]`).value}&`;
            data += `start_time=${document.querySelector(`[name="start_time"]`).value}&`;
            data += `end_time=${document.querySelector(`[name="end_time"]`).value}&`;
            data += `region_restricted=${document.querySelector(`[name="region_restricted"]`).value}&`;
            data += `country_item_string=${document.querySelector(`[name="country_item_string"]`).value.trim()}&`;
            data += `group_item_string=${document.querySelector(`[name="group_item_string"]`).value.trim()}&`;
            data += `who_can_enter=${document.querySelector(`[name="who_can_enter"]`).value}&`;
            data += `whitelist=${document.querySelector(`.form__row--who-can-enter [name="whitelist"]`).value}&`;
            data += `contributor_level=${document.querySelector(`[name="contributor_level"]`).value}&`;
            data += `description=${encodeURIComponent(document.querySelector(`[name="description"]`).value)}`;
            request(data, null, false, `/giveaways/new`, function (response) {
                callback();
                location.href = response.finalUrl;
            });
        });
        rows.appendChild(createGiveawayButton.set);
        button.addEventListener(`click`, function () {
            var days, details, hours, i, n, popup, savedTemplate, savedTemplates, template, templates, time, weeks;
            popup = new Popup(`fa-file`, `View/apply templates:`, true);
            popup.description.insertAdjacentHTML(`afterBegin`, `
                <div class="esgst-description">Drag and drop templates to move them.</div>
            `);
            undo = insertHtml(popup.description, `beforeEnd`, `
                <div class="esgst-clickable esgst-hidden">
                    <i class="fa fa-rotate-left"></i>
                    <span>Undo Delete</span>
                </div>
            `);
            undo.addEventListener(`click`, undoGtsDelete);
            templates = insertHtml(popup.scrollable, `beforeEnd`, `
                <div class="esgst-text-left popup__keys__list"></div>
            `);
            savedTemplates = JSON.parse(getValue(`templates`, `[]`));
            for (i = 0, n = savedTemplates.length; i < n; ++i) {
                savedTemplate = savedTemplates[i];
                details = ``;
                if (savedTemplate.startTime || savedTemplate.endTime) {
                    if (savedTemplate.startTime) {
                        time = new Date(savedTemplate.startTime);
                        details += `${`0${time.getHours()}`.slice(-2)}:${`0${time.getMinutes()}`.slice(-2)}`;
                    } else {
                        details += `?`;
                    }
                    if (savedTemplate.endTime) {
                        time = new Date(savedTemplate.endTime);
                        details += `-${`0${time.getHours()}`.slice(-2)}:${`0${time.getMinutes()}`.slice(-2)}`;
                    } else {
                        details += `-?`;
                    }
                    details += `, `;
                }
                hours = Math.floor(savedTemplate.duration / 3600000);
                if (hours > 23) {
                    days = Math.floor(hours / 24);
                    if (days > 6) {
                        weeks = Math.floor(days / 7);
                        if (weeks === 1) {
                            details += `1 week`;
                        } else {
                            details += `${weeks} weeks`;
                        }
                    } else if (days === 1) {
                        details += `1 day`;
                    } else {
                        details += `${days} days`;
                    }
                } else if (hours === 1) {
                    details += `1 hour`;
                } else {
                    details += `${hours} hours`;
                }
                if (savedTemplate.region !== `0`) {
                    details += `, region restricted`;
                }
                if (savedTemplate.type === `everyone`) {
                    details += `, public`;
                } else if (savedTemplate.type === `invite_only`) {
                    details += `, invite only`;
                } else {
                    if (savedTemplate.whitelist === `1`) {
                        details += `, whitelist`;
                    }
                    if (savedTemplate.groups.trim()) {
                        details += `, groups`;
                    }
                }
                details += `, level ${savedTemplate.level}+`;
                template = insertHtml(templates, `beforeEnd`, `
                    <div draggable="true">
                        <div class="esgst-clickable" style="float: left;">
                            <span class="esgst-bold">${savedTemplate.name}</span>
                        </div>
                        <div class="esgst-clickable" style="float: right;">
                            <i class="fa fa-trash" title="Delete template"></i>
                        </div>
                        <div style="clear: both;"></div>
                        <div class="esgst-description">${details}</div>
                    </div>
                `);
                template.addEventListener(`dragstart`, setGtsSource.bind(null, gts, savedTemplate.name, template));
                template.addEventListener(`dragenter`, getGtsSource.bind(null, gts, template, templates));
                template.addEventListener(`dragend`, saveGtsSource.bind(null, gts));
                setGtsTemplate(popup, template, savedTemplate);
            }
            popup.open();
        });
        section = insertHtml(reviewButton, `beforeBegin`, `
            <div class="esgst-form-row">
                <div class="esgst-form-heading">
                    <div class="esgst-form-heading-number">9.</div>
                    <div class="esgst-form-heading-text">Template</div>
                </div>
                <div class="esgst-gts-section esgst-form-row-indent">
                    <div>
                        <span>Use precise start time.</span>
                    </div>
                    <div>
                        <span>Use precise end time.</span>
                    </div>
                    <input class="form__input-small" type="text"/>
                    <span class="esgst-description esgst-hidden">Saved!</span>
                    <div class="esgst-hidden form__row__error">
                        <i class="fa fa-exclamation-circle"></i> Please enter a name for the template.
                    </div>
                    <div class="esgst-description">The name of the template.</div>
                </div>
            </div>
        `).lastElementChild;
        preciseStartOption = section.firstElementChild;
        preciseEndOption = preciseStartOption.nextElementSibling;
        input = preciseEndOption.nextElementSibling;
        message = input.nextElementSibling;
        warning = message.nextElementSibling;
        preciseStartCheckbox = new Checkbox(preciseStartOption, esgst.gts_preciseStart);
        preciseEndCheckbox = new Checkbox(preciseEndOption, esgst.gts_preciseEnd);
        preciseStartOption.addEventListener(`click`, function () {
            setSetting(`gts_preciseStart`, preciseStartCheckbox.input.checked);
            esgst.gts_preciseStart = preciseStartCheckbox.input.checked;
        });
        preciseEndOption.addEventListener(`click`, function () {
            setSetting(`gts_preciseEnd`, preciseEndCheckbox.input.checked);
            esgst.gts_preciseEnd = preciseEndCheckbox.input.checked;
        });
        set = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save Template`, `Saving...`, function (callback) {
            var i, n, template, savedTemplates;
            if (input.value) {
                warning.classList.add(`esgst-hidden`);
                startTime = new Date(document.querySelector(`[name="start_time"]`).value).getTime();
                endTime = new Date(document.querySelector(`[name="end_time"]`).value).getTime();
                delay = startTime - Date.now();
                if (delay < 0) {
                    delay = 0;
                }
                template = {
                    countries: document.querySelector(`[name="country_item_string"]`).value.trim(),
                    delay: delay,
                    description: document.querySelector(`[name="description"]`).value,
                    duration: endTime - startTime,
                    groups: document.querySelector(`[name="group_item_string"]`).value.trim(),
                    level: document.querySelector(`[name="contributor_level"]`).value,
                    name: input.value,
                    region: document.querySelector(`[name="region_restricted"]`).value,
                    type: document.querySelector(`[name="who_can_enter"]`).value,
                    whitelist: document.querySelector(`.form__row--who-can-enter [name="whitelist"]`).value
                };
                if (preciseStartCheckbox.input.checked) {
                    template.startTime = startTime;
                }
                if (preciseEndCheckbox.input.checked) {
                    template.endTime = endTime;
                }
                createLock(`templateLock`, 300, function(deleteLock) {
                    savedTemplates = JSON.parse(getValue(`templates`, `[]`));
                    for (i = 0, n = savedTemplates.length; i < n && savedTemplates[i].name !== template.name; ++i);
                    if (i < n) {
                        if (edit) {
                            savedTemplates[i] = template;
                            message.classList.remove(`esgst-hidden`);
                            setTimeout(function () {
                                message.classList.add(`esgst-hidden`);
                            }, 2000);
                        } else if (confirm(`There already exists a template with this name. Do you want to overwrite it?`)) {
                            savedTemplates[i] = template;
                            message.classList.remove(`esgst-hidden`);
                            setTimeout(function () {
                                message.classList.add(`esgst-hidden`);
                            }, 2000);
                        }
                    } else {
                        savedTemplates.push(template);
                        message.classList.remove(`esgst-hidden`);
                        setTimeout(function () {
                            message.classList.add(`esgst-hidden`);
                        }, 2000);
                    }
                    setValue(`templates`, JSON.stringify(savedTemplates));
                    deleteLock();
                    callback();
                });
            } else {
                warning.classList.remove(`esgst-hidden`);
                callback();
            }
        });
        section.appendChild(set.set);
        rows.insertBefore(createGiveawayButton.set, rows.firstElementChild);
        rows.insertBefore(reviewButton, rows.firstElementChild);
        createGiveawayButton.set.style.display = `inline-block`;
        createGiveawayButton.set.style.margin = `20px 5px`;
        reviewButton.style.margin = `20px 0`;
        var first, last;
        first = true;
        last = false;
        addEventListener(`scroll`, function () {
            if (scrollY < 138) {
                if (!first) {
                    rows.insertBefore(createGiveawayButton.set, rows.firstElementChild);
                    rows.insertBefore(reviewButton, rows.firstElementChild);
                    createGiveawayButton.set.style.margin = `20px 5px`;
                    reviewButton.style.margin = `20px 0`;
                    first = true;
                    last = false;
                }
            } else if (!last) {
                rows.appendChild(reviewButton);
                rows.appendChild(createGiveawayButton.set);
                reviewButton.style.margin = ``;
                createGiveawayButton.set.style.margin = `0 5px`;
                last = true;
                first = false;
            }
        });
    }

    function setGtsTemplate(popup, template, savedTemplate) {
        var applyButton, deleteButton, i, n, savedTemplates;
        applyButton = template.firstElementChild;
        deleteButton = applyButton.nextElementSibling;
        applyButton.addEventListener(`click`, function () {
            applyGtsTemplate(savedTemplate);
            input.value = savedTemplate.name;
            edit = true;
            popup.close();
        });
        deleteButton.addEventListener(`click`, function () {
            deleteButton.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
            `;
            createLock(`templateLock`, 300, function (deleteLock) {
                savedTemplates = JSON.parse(getValue(`templates`, `[]`));
                for (i = 0, n = savedTemplates.length; i < n && savedTemplates[i].name !== savedTemplate.name; ++i);
                savedTemplates.splice(i, 1);
                setValue(`templates`, JSON.stringify(savedTemplates));
                deleteLock();
                deleteButton.innerHTML = `
                    <i class="fa fa-trash"></i>
                `;
                template.classList.add(`esgst-hidden`);
                deletedTemplates.push({
                    template: template,
                    savedTemplate: savedTemplate
                });
                undo.classList.remove(`esgst-hidden`);
                edit = false;
            });
        });
    }

    function undoGtsDelete() {
        var deletedTemplate;
        deletedTemplate = deletedTemplates.pop();
        deletedTemplate.template.classList.remove(`esgst-hidden`);
        deletedTemplate.template.parentElement.appendChild(deletedTemplate.template);
        savedTemplates = JSON.parse(getValue(`templates`, `[]`));
        savedTemplates.push(deletedTemplate.savedTemplate);
        setValue(`templates`, JSON.stringify(savedTemplates));
        if (deletedTemplates.length === 0) {
            undo.classList.add(`esgst-hidden`);
        }
    }
}

function applyGtsTemplate(savedTemplate) {
    var context, countries, currentDate, days, endTime, groups, i, id, j, matches, n, newEndTime, newEndTimeBackup, newStartTime, startTime, selected;
    currentDate = new Date();
    if (savedTemplate.startTime && savedTemplate.endTime) {
        startTime = new Date(savedTemplate.startTime);
        newStartTime = new Date(currentDate.getTime());
        newStartTime.setHours(startTime.getHours(), startTime.getMinutes(), startTime.getSeconds(), startTime.getMilliseconds());
        if (newStartTime.getTime() < currentDate.getTime()) {
            newStartTime.setDate(newStartTime.getDate() + 1);
        }
        endTime = new Date(savedTemplate.endTime);
        newEndTime = new Date(newStartTime.getTime());
        if (endTime.getMonth() !== startTime.getMonth()) {
            days = (new Date(startTime.getFullYear(), startTime.getMonth() + 1, 0).getDate()) - newStartTime.getDate() + endTime.getDate();
        } else {
            days = endTime.getDate() - startTime.getDate();
        }
        newEndTime.setDate(newStartTime.getDate() + days);
        newEndTime.setHours(endTime.getHours(), endTime.getMinutes(), endTime.getSeconds(), endTime.getMilliseconds());
        document.querySelector(`[name="start_time"]`).value = formatDate(newStartTime);
        document.querySelector(`[name="end_time"]`).value = formatDate(newEndTime);
    } else if (savedTemplate.startTime) {
        startTime = new Date(savedTemplate.startTime);
        newStartTime = new Date(currentDate.getTime());
        newStartTime.setHours(startTime.getHours(), startTime.getMinutes(), startTime.getSeconds(), startTime.getMilliseconds());
        if (newStartTime.getTime() < currentDate.getTime()) {
            newStartTime.setDate(newStartTime.getDate() + 1);
        }
        newEndTime = new Date(newStartTime.getTime() + savedTemplate.duration);
        document.querySelector(`[name="start_time"]`).value = formatDate(newStartTime);
        document.querySelector(`[name="end_time"]`).value = formatDate(newEndTime);
    } else if (savedTemplate.endTime) {
        endTime = new Date(savedTemplate.endTime);
        newStartTime = new Date(currentDate.getTime() + savedTemplate.delay);
        newEndTime = new Date(newStartTime.getTime() + savedTemplate.duration);
        newEndTime.setHours(endTime.getHours(), endTime.getMinutes(), endTime.getSeconds(), endTime.getMilliseconds());
        if (newEndTime.getTime() < newStartTime.getTime()) {
            newEndTime.setDate(newEndTime.getDate() + 1);
        }
        document.querySelector(`[name="start_time"]`).value = formatDate(newStartTime);
        document.querySelector(`[name="end_time"]`).value = formatDate(newEndTime);
    } else {
        document.querySelector(`[name="start_time"]`).value = formatDate(new Date(currentDate.getTime() + savedTemplate.delay));
        document.querySelector(`[name="end_time"]`).value = formatDate(new Date(currentDate.getTime() + savedTemplate.delay + savedTemplate.duration));
    }
    if (!savedTemplate.region.match(/^(1|0)$/)) {
        savedTemplate.region = `0`;
    }
    document.querySelector(`[data-checkbox-value="${savedTemplate.region}"]`).click();
    if (savedTemplate.countries) {
        matches = document.querySelector(`.form_list[data-input="country_item_string"]`).children;
        countries = savedTemplate.countries.trim().split(/\s/);
        for (i = matches.length - 1; i > 0; --i) {
            context = matches[i];
            id = context.getAttribute(`data-item-id`);
            selected = context.classList.contains(`is-selected`);
            j = countries.indexOf(id);
            if ((selected && j < 0) || (!selected && j >= 0)) {
                context.click();
            }
        }
    }
    document.querySelector(`[data-checkbox-value="${savedTemplate.type}"]`).click();
    if (savedTemplate.gameName) {
        document.getElementsByClassName(`js__autocomplete-name`)[0].value = savedTemplate.gameName;
    }
    if (savedTemplate.gameId) {
        document.querySelector(`[name="game_id"]`).value = savedTemplate.gameId;
    }
    if (savedTemplate.copies) {
        document.querySelector(`[data-checkbox-value="gift"]`).click();
        document.querySelector(`[name="copies"]`).value = savedTemplate.copies;
    } else if (savedTemplate.keys) {
        document.querySelector(`[data-checkbox-value="key"]`).click();
        document.querySelector(`[name="key_string"]`).value = savedTemplate.keys;
    }
    if (savedTemplate.type === `groups`) {
        matches = document.querySelector(`.form_list[data-input="group_item_string"]`).children;
        context = matches[0];
        if ((savedTemplate.whitelist === `1` && !context.classList.contains(`is-selected`)) || (savedTemplate.whitelist !== `1` && context.classList.contains(`is-selected`))) {
            context.click();
        }
        if (savedTemplate.groups) {
            groups = savedTemplate.groups.trim().split(/\s/);
            for (i = matches.length - 1; i > 0; --i) {
                context = matches[i];
                id = context.getAttribute(`data-item-id`);
                selected = context.classList.contains(`is-selected`);
                j = groups.indexOf(id);
                if ((selected && j < 0) || (!selected && j >= 0)) {
                    context.click();
                }
            }
        } else {
            for (i = matches.length - 1; i > 0; --i) {
                context = matches[i];
                if (context.classList.contains(`is-selected`)) {
                    context.click();
                }
            }
        }
    }
    if (savedTemplate.level > 0) {
        document.getElementsByClassName(`ui-slider-range`)[0].style.width = `${savedTemplate.level * 10}%`;
        document.getElementsByClassName(`form__level`)[0].textContent = `level ${savedTemplate.level}`;
        document.getElementsByClassName(`form__input-description--no-level`)[0].classList.add(`is-hidden`);
        document.getElementsByClassName(`form__input-description--level`)[0].classList.remove(`is-hidden`);
    } else {
        document.getElementsByClassName(`ui-slider-range`)[0].style.width = `0%`;
        document.getElementsByClassName(`form__input-description--level`)[0].classList.add(`is-hidden`);
        document.getElementsByClassName(`form__input-description--no-level`)[0].classList.remove(`is-hidden`);
    }
    document.getElementsByClassName(`ui-slider-handle`)[0].style.left = `${savedTemplate.level * 10}%`;
    document.querySelector(`[name="contributor_level"]`).value = savedTemplate.level;
    document.querySelector(`[name="description"]`).value = savedTemplate.description;
}

function setGtsSource(gts, name, template) {
    var i, n, savedTemplates;
    gts.source = template;
    savedTemplates = JSON.parse(getValue(`templates`, `[]`));
    for (i = 0, n = savedTemplates.length; i < n && savedTemplates[i].name !== name; ++i);
    if (i < n) {
        gts.sourceIndex = i;
    }
}

function getGtsSource(gts, template, templates) {
    var current, i;
    current = gts.source;
    i = 0;
    do {
        current = current.previousElementSibling;
        if (current && current === template) {
            gts.sourceNewIndex = i;
            templates.insertBefore(gts.source, template);
            return;
        }
        ++i;
    } while (current);
    gts.sourceNewIndex = i - 1;
    templates.insertBefore(gts.source, template.nextElementSibling);
}

function saveGtsSource(gts) {
    var savedTemplates;
    savedTemplates = JSON.parse(getValue(`templates`, `[]`));
    savedTemplates.splice(gts.sourceNewIndex, 0, savedTemplates.splice(gts.sourceIndex, 1)[0]);
    setValue(`templates`, JSON.stringify(savedTemplates));
}

/* [MGC] Multiple Giveaways Creator */

function loadMgc() {
    if (esgst.newGiveawayPath) {
        addMgcSection();
    }
}

function addMgcSection() {
    var addButton, attachButton, createButton, createTrainDescription, createTrainOption, createTrainSwitch, detach, emptyButton, exportButton, importButton, mgc, removeIcon, rows, section, viewButton;
    rows = document.getElementsByClassName(`form__rows`)[0];
    if (rows) {
        mgc = {
            countries: document.querySelector(`[name="country_item_string"]`),
            gameId: document.querySelector(`[name="game_id"]`),
            gameType: document.querySelector(`[name="type"]`),
            copies: document.querySelector(`[name="copies"]`),
            keys: document.querySelector(`[name="key_string"]`),
            startTime: document.querySelector(`[name="start_time"]`),
            endTime: document.querySelector(`[name="end_time"]`),
            region: document.querySelector(`[name="region_restricted"]`),
            type: document.querySelector(`[name="who_can_enter"]`),
            whitelist: document.querySelector(`.form__row--who-can-enter [name="whitelist"]`),
            groups: document.querySelector(`[name="group_item_string"]`),
            level: document.querySelector(`[name="contributor_level"]`),
            description: document.querySelector(`[name="description"]`),
            datas: [],
            values: [],
            created: []
        };
        mgc.gameName = mgc.gameId.nextElementSibling;
        section = insertHtml(rows, `afterBegin`, `
            <div class="esgst-form-row">
                <div class="esgst-form-heading">
                    <div class="esgst-form-heading-number">0.</div>
                    <div class="esgst-form-heading-text">
                        Create Multiple Giveaways <i class="fa fa-question-circle" title="How To Use\n
                        1. Fill the details of the giveaway (you can use templates for it).
                        2. Click 'Add Giveaway' or import giveaways.
                        3. Repeat steps 1-2 until all giveaways have been added.
                        4. Click 'Create Giveaways' and wait.\n
                        For train creations:
                        1. Enable 'Create train.'.
                        2. Fill the details of the giveaway and add the connection/counter style to the description (you can use templates for it).
                        3. Click 'Add Giveaway' or import giveaways.
                        4. Repeat steps 2-3 until all giveaways have been added.
                        5. Click 'Create Giveaways' and wait."></i>
                    </div>
                </div>
                <div class="esgst-gm-section esgst-form-row-indent">
                    <div>
                        <div></div>
                        <div class="esgst-hidden">
                            <div></div>
                        </div>
                    </div>
                </div>
            </div>
        `).lastElementChild;
        createTrainOption = section.firstElementChild;
        createTrainDescription = createTrainOption.lastElementChild;
        if (esgst.mgc_createTrain) {
            createTrainDescription.classList.remove(`esgst-hidden`);
        }
        createTrainSwitch = new ToggleSwitch(createTrainOption.firstElementChild, `mgc_createTrain`, false, `Create train. <i class="fa fa-question-circle"></i>`, false, false, null, esgst.mgc_createTrain);
        createTrainSwitch.dependencies.push(createTrainDescription);
        createTooltip(createTrainSwitch.name.lastElementChild, `
            <div class="esgst-description markdown">
                <div>Add the connection style to the description of the giveaway, wherever you want it to appear, using the format [ESGST-P]...[P]...[/P]...[/ESGST-P]...[ESGST-N]...[N]...[/N]...[/ESGST-N] or the simplified format [ESGST-P]...[/ESGST-P]...[ESGST-N]...[/ESGST-N], where [P]...[/P] and [N]...[/N] delimit the clickable link, [ESGST-P]...[/ESGST-P] and [ESGST-N]...[/ESGST-N] delimit the entire text area that includes the clickable link, and the "..." between [/ESGST-P] and [ESGST-N] delimit the separator between the links. If using the simplified format, [P]...[/P] and [N]...[/N] are not required and the entire text inside [ESGST-P]...[/ESGST-P] and [ESGST-N]...[/ESGST-N] will be turned into a link.</div>
                <br/>
                <div>Some examples:</div>
                <br/>
                <div>[ESGST-P]Previous[/ESGST-P] [ESGST-N]Next[/ESGST-N] -> Result will look like "<a href="">Previous</a> <a href="">Next</a>".</div>
                <br/>
                <div>### [ESGST-P] [P]Previous[/P][/ESGST-P] | [ESGST-N][N]Next[/N] [/ESGST-N] -> Result will look like " <a href="">Previous</a> | <a href="">Next</a> " in medium font size.</div>
                <br/>
                <div>[ESGST-P]Go [P]back[/P].[/ESGST-P] [ESGST-N]Go [N]forward[/N].[/ESGST-N] -> Result will look like "Go <a href="">back</a>. Go <a href="">forward</a>.".</div>
                <br/>
                <div>You can also add a counter style to the description, using the format [ESGST-C]...[/ESGST-C], where "..." delimits the separator between the numbers.</div>
                <br/>
                <div>Some examples:</div>
                <br/>
                <div>[ESGST-C] of [/ESGST-C] -> Result will look like "2 of 10".</div>
                <br/>
                <div>[ESGST-C]/[/ESGST-C] -> Result will look like "2/10".</div>
                <br/>
                <div>An example merging the connection with the counter:</div>
                <br/>
                <div>[ESGST-P]Previous[/ESGST-P] [ESGST-N]Next[/ESGST-N] ([ESGST-C] of [/ESGST-C]) -> Result will look like "<a href="">Previous</a> <a href="">Next</a> (2 of 10)".</div>
            </div>
        `);
        new ToggleSwitch(createTrainDescription.firstElementChild, `mgc_removeLinks`, false, `Remove previous/next links from the first/last wagons.`, false, false, `Disabling this keeps the links as plain text.`, esgst.mgc_removeLinks);
        mgc.editButton = new ButtonSet(`green`, `grey`, `fa-edit`, `fa-circle-o-notch fa-spin`, `Edit`, `Editing...`, getMgcValues.bind(null, true, mgc));
        mgc.editButton.set.classList.add(`esgst-hidden`);
        addButton = new ButtonSet(`green`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Add`, `Adding...`, getMgcValues.bind(null, false, mgc));
        importButton = new ButtonSet(`green`, `grey`, `fa-arrow-circle-up`, `fa-circle-o-notch fa-spin`, `Import`, `Importing...`, importMgcGiveaways.bind(null, mgc));
        exportButton = new ButtonSet(`green`, `grey`, `fa-arrow-circle-down`, `fa-circle-o-notch fa-spin`, `Export`, `Exporting...`, exportMgcGiveaways.bind(null, mgc));
        emptyButton = new ButtonSet(`green`, `grey`, `fa-trash`, `fa-circle-o-notch fa-spin`, `Empty`, `Emptying...`, emptyMgcGiveaways.bind(null, mgc));
        attachButton = new ButtonSet(`green`, `grey`, `fa-paperclip`, `fa-circle-o-notch fa-spin`, `Attach Discussion`, `Attaching...`, attachMgcDiscussion.bind(null, mgc));
        createTrainSwitch.dependencies.push(attachButton.set);
        if (!esgst.mgc_createTrain) {
            attachButton.set.classList.add(`esgst-hidden`);
        }
        viewButton = new ButtonSet(`green`, `grey`, `fa-eye`, `fa-circle-o-notch fa-spin`, `View Results`, `Opening...`, viewMgcResults.bind(null, mgc));
        createButton = new ButtonSet(`green`, `grey`, `fa-arrow-circle-right`, `fa-circle-o-notch fa-spin`, `Create`, `Creating...`, createMgcGiveaways.bind(null, mgc, viewButton));
        viewButton.set.classList.add(`esgst-hidden`);
        section.appendChild(mgc.editButton.set);
        section.appendChild(addButton.set);
        section.appendChild(importButton.set);
        section.appendChild(exportButton.set);
        section.appendChild(emptyButton.set);
        section.appendChild(attachButton.set);
        section.appendChild(createButton.set);
        section.appendChild(viewButton.set);
        mgc.discussionPanel = insertHtml(section, `beforeEnd`, `
            <div class="esgst-hidden">
                <span class="esgst-bold">Discussion Attached:</span> <a></a> <i class="esgst-clickable fa fa-times" title="Detach discussion"></i>
            </div>
        `);
        detach = mgc.discussionPanel.lastElementChild;
        detach.addEventListener(`click`, detachMgcDiscussion.bind(null, mgc));
        mgc.discussionLink = detach.previousElementSibling;
        new ToggleSwitch(mgc.discussionPanel, `mgc_bumpLast`, false, `Only insert the bump link in the last wagon.`, false, false, `If disabled, the bump link will appear on all wagons.`, esgst.mgc_bumpLast);
        mgc.giveaways = insertHtml(section, `beforeEnd`, `
            <div class="pinned-giveaways__outer-wrap">
                <div class="pinned-giveaways__inner-wrap"></div>
                <i class="fa fa-trash" title="Drag a giveaway here to remove it."></i>
                <div class="esgst-description">To edit a giveaway, click on it and a "Edit" button will appear. Then make your alterations and click "Edit".</div>
                <div class="esgst-description">Giveaways successfully created will turn green, giveaways successfully connected will be strikethrough (for train creations) and giveaways that were not successfully created will turn red.</div>
            </div>
        `).firstElementChild;
        removeIcon = mgc.giveaways.nextElementSibling;
        removeIcon.addEventListener(`dragenter`, removeMgcGiveaway.bind(null, mgc));
        var cache = JSON.parse(getValue(`mgcCache`, `[]`));
        cache.forEach(values => {
            addMgcGiveaway(false, mgc, values);
        });
    }
}

function getMgcValues(edit, mgc, callback) {
    var cache, values;
    values = {
        gameId: mgc.gameId.value,
        gameType: mgc.gameType.value,
        copies: mgc.copies.value,
        keys: mgc.keys.value
    };
    if (values.gameId && ((values.gameType === `gift` && parseInt(values.copies) > 0) || (values.gameType === `key` && values.keys))) {
        esgst.busy = true;
        values.countries = mgc.countries.value.trim();
        values.gameName = mgc.gameName.value;
        values.startTime = mgc.startTime.value;
        values.endTime = mgc.endTime.value;
        values.region = mgc.region.value;
        values.type = mgc.type.value;
        values.whitelist = mgc.whitelist.value;
        values.groups = mgc.groups.value.trim();
        values.level = mgc.level.value;
        values.description = mgc.description.value;
        if ((esgst.mgc_createTrain && mgc.description.value.match(/\[ESGST-P\]|\[ESGST-N\]/)) || !esgst.mgc_createTrain) {
            if ((mgc.discussion && mgc.description.value.match(/\[ESGST-B\]/)) || !mgc.discussion) {
                addMgcGiveaway(edit, mgc, values);
                cache = JSON.parse(getValue(`mgcCache`, `[]`));
                if (edit) {
                    cache[mgc.editPos] = values;
                } else {
                    cache.push(values);
                }
                setValue(`mgcCache`, JSON.stringify(cache));
                mgc.copies.value = `1`;
                mgc.keys.value = ``;
            } else {
                createAlert(`The bump link format is missing from the description.`);
            }
        } else {
            createAlert(`The next/previous links format is missing from the description.`);
        }
    } else {
        createAlert(`You must first fill the details of the giveaway.`);
    }
    callback();
}

function addMgcGiveaway(edit, mgc, values) {
    var data, details;
    details = `${values.gameName.replace(/"/g, `&quot;`)}\n`;
    if (values.gameType === `gift`) {
        details += `Gift\n${values.copies} Copies\n`;
    } else {
        details += `Keys\n${values.keys}\n`;
    }
    details += `\n${values.startTime} - ${values.endTime}\n`;
    if (values.region !== `0`) {
        details += `Region Restricted\n`;
    }
    if (values.type === `everyone`) {
        details += `Public\n`;
    } else if (values.type === `invite_only`) {
        details += `Invite Only\n`;
    } else {
        if (values.whitelist === `1`) {
            details += `Whitelist\n`;
        }
        if (values.groups.trim()) {
            details += `Groups\n`;
        }
    }
    details += `Level ${values.level}+\n\n${values.description}`;
    data = `xsrf_token=${esgst.xsrfToken}&next_step=3&game_id=${values.gameId}&type=${values.gameType}&copies=${values.copies}&key_string=${values.keys}&start_time=${values.startTime}&end_time=${values.endTime}&region_restricted=${values.region}&country_item_string=${values.countries}&who_can_enter=${values.type}&whitelist=${values.whitelist}&group_item_string=${values.groups}&contributor_level=${values.level}&description=${encodeURIComponent(values.description)}`;
    if (edit) {
        mgc.datas[mgc.editPos] = data;
        mgc.values[mgc.editPos] = values;
        mgc.giveaways.children[mgc.editPos].title = details;
        mgc.editButton.set.classList.add(`esgst-hidden`);
    } else {
        mgc.datas.push(data);
        mgc.values.push(values);
        setMgcGiveaway(insertHtml(mgc.giveaways, `beforeEnd`, `
            <div class="esgst-gm-giveaway" draggable="true" title="${details}">${mgc.datas.length}</div>
        `), mgc);
    }
}

function setMgcGiveaway(giveaway, mgc) {
    giveaway.addEventListener(`click`, setMgcValues.bind(null, giveaway, mgc))
    giveaway.addEventListener(`dragstart`, setMgcSource.bind(null, giveaway, mgc));
    giveaway.addEventListener(`dragenter`, getMgcSource.bind(null, giveaway, mgc));
}

function setMgcValues(giveaway, mgc) {
    var pos, values;
    pos = parseInt(giveaway.textContent) - 1;
    values = mgc.values[pos];
    mgc.countries.value = values.countries;
    mgc.gameId.value = values.gameId;
    mgc.gameType.value = values.gameType;
    mgc.copies.value = values.copies;
    mgc.keys.value = values.keys;
    mgc.gameName.value = values.gameName;
    mgc.startTime.value = values.startTime;
    mgc.endTime.value = values.endTime;
    mgc.region.value = values.region;
    mgc.type.value = values.type;
    mgc.whitelist.value = values.whitelist;
    mgc.groups.value = values.groups;
    mgc.level.value = values.level;
    mgc.description.value = values.description;
    applyGtsTemplate(values);
    mgc.editPos = pos;
    mgc.editButton.set.classList.remove(`esgst-hidden`);
}

function setMgcSource(giveaway, mgc) {
    mgc.source = giveaway;
}

function getMgcSource(giveaway, mgc) {
    var current;
    current = mgc.source;
    do {
        current = current.previousElementSibling;
        if (current && current === giveaway) {
            mgc.giveaways.insertBefore(mgc.source, giveaway);
            return;
        }
    } while (current);
    mgc.giveaways.insertBefore(mgc.source, giveaway.nextElementSibling);
}

function importMgcGiveaways(mgc, callback) {
    var counter, popup, progress, progressPanel, textArea;
    popup = new Popup(`fa-arrow-up`, `Import Giveaways`, true);
    popup.popup.classList.add(`esgst-popup-large`);
    popup.description.insertAdjacentHTML(`afterBegin`, `
        <div class="esgst-description">
            Insert the keys below. <i class="fa fa-question-circle"></i>
        </div>
    `);
    createTooltip(popup.description.firstElementChild.lastElementChild, `
        <div>Before importing, make sure you have filled the details of the giveaway (time, region, whitelist, group, level and description) or applied a template. Having different details for each giveaway is currently not supported.</div>
        <br/>
        <div>Separate giveaways with a new line. For gift giveaways, write the name of the game (exactly like it is on Steam) and the number of copies (only required if bigger than 1) in the format "(X Copies)" without the quotes and separated from the name of the game by a single space. For key giveaways, write the name of the game (exactly like it is on Steam) and put the key after or before the name of the game, separated from the name of the game by a single space (Steam and HumbleBundle gift links are supported and work just like the keys, but they must start with "http://" or "https://" to be detected). Here's an example:</div>
        <br/>
        <div>Portal</div>
        <div>ABCDE-FGHIJ-KLMNO Portal</div>
        <div>Portal ABCDE-FGHIJ-PQRST</div>
        <div>Portal (2 Copies)</div>
        <div>Portal ABCDE-FGHIJ-UVWXY</div>
        <br/>
        <div>In the example above, 5 giveaways will be created (one for each line) if the option to group keys is disabled. But if the option is enabled, only 4 giveaways will be created, because the two adjacent (next to each other) Portal keys will be grouped in a single giveaway. Note that the last Portal key will not grouped, as it is not adjacent to the other keys.</div>
        <br/>
        <div>You can also put keys in front of each other, separated by a space. The below will generate the same result as above:</div>
        <br/>
        <div>Portal</div>
        <div>Portal ABCDE-FGHIJ-KLMNO ABCDE-FGHIJ-PQRST</div>
        <div>Portal (2 Copies)</div>
        <div>Portal ABCDE-FGHIJ-UVWXY</div>
    `);
    new ToggleSwitch(popup.description, `mgc_groupKeys`, false, `Group adjacent keys for the same game.`, false, false, ``, esgst.mgc_groupKeys);
    textArea = insertHtml(popup.scrollable, `beforeEnd`, `
        <textarea></textarea>
    `);
    progressPanel = insertHtml(popup.description, `beforeEnd`, `
        <div>
            <div class="esgst-progress-bar"></div>
            <div>
                <span>0</span> of <span>0</span> giveaways imported.
            </div>
        </div>
    `);
    progress = {
        bar: progressPanel.firstElementChild,
    };
    counter = progressPanel.lastElementChild;
    progress.current = counter.firstElementChild;
    progress.total = progress.current.nextElementSibling;
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-arrow-circle-up`, `fa-circle-o-notch fa-spin`, `Import`, `Importing...`, getMgcGiveaways.bind(null, mgc, popup, progress, textArea)).set);
    popup.onClose = callback;
    popup.open(focusMgcTextArea.bind(null, textArea));
    textArea.style.height = `${innerHeight * 0.9 - (popup.popup.offsetHeight - popup.scrollable.offsetHeight) - 25}px`;
    textArea.style.overflow = `auto`;
    popup.reposition();
    textArea.addEventListener(`paste`, resizeMgcTextArea.bind(null, popup, textArea));
}

function resizeMgcTextArea(popup, textArea) {
    var interval, value;
    value = textArea.value;
    interval = setInterval(function () {
        if (value !== textArea.value) {
            clearInterval(interval);
            textArea.style.height = `${innerHeight * 0.9 - (popup.popup.offsetHeight - popup.scrollable.offsetHeight) - 25}px`;
            textArea.style.overflow = `auto`;
            popup.reposition();
        }
    }, 250);
}

function getMgcGiveaways(mgc, popup, progress, textArea, callback) {
    var giveaways, lines, max, n, value;
    if ((esgst.mgc_createTrain && mgc.description.value.match(/\[ESGST-P\]|\[ESGST-N\]/)) || !esgst.mgc_createTrain) {
        if ((mgc.discussion && mgc.description.value.match(/\[ESGST-B\]/)) || !mgc.discussion) {
            esgst.busy = true;
            giveaways = [];
            lines = textArea.value.trim().split(/\n/);
            for (i = 0, n = lines.length; i < n; ++i) {
                line = lines[i].trim();
                if (line) {
                    giveaways.push(line);
                }
            }
            textArea.value = giveaways.join(`\n`);
            n = giveaways.length;
            if ($(progress.bar).progressbar(`instance`)) {
                max = $(progress.bar).progressbar(`option`, `max`);
                value = $(progress.bar).progressbar(`option`, `value`);
                if (value + n !== max) {
                    $(progress.bar).progressbar({
                        max: value + n,
                        value: value
                    });
                    progress.total.textContent = value + n;
                }
            } else {
                $(progress.bar).progressbar({
                    max: n
                });
                progress.total.textContent = n;
            }
            importMgcGiveaway(giveaways, 0, mgc, n, popup, progress, textArea, () => popup.close(), callback);
        } else {
            createAlert(`The bump link format is missing from the description.`);
            callback();
        }
    } else {
        createAlert(`The next/previous links format is missing from the description.`);
        callback();
    }
}

function importMgcGiveaway(giveaways, i, mgc, n, popup, progress, textArea, mainCallback, callback) {
    var copies, found, giveaway, j, key, keyPos, match, name, namePos, regExp, values;
    if (i < n) {
        match = giveaways[i].match(/^(([\d\w]{5}(-[\d\w]{5}){2,}\s?|https?:\/\/.+?\s?)+)\s(.+)$/);
        if (match) {
            key = true;
            keyPos = 1;
            namePos = 4;
        } else {
            match = giveaways[i].match(/^(.+?)\s(([\d\w]{5}(-[\d\w]{5}){2,}\s?|https?:\/\/.+?\s?)+)$/);
            if (match) {
                key = true;
                keyPos = 2;
                namePos = 1;
            } else {
                match = giveaways[i].match(/^(.+?)(\s\((\d+?)\sCopies\))?$/);
                if (match) {
                    key = false;
                    namePos = 1;
                }
            }
        }
        if (match) {
            name = match[namePos];
            values = {
                countries: mgc.countries.value.trim(),
                gameName: name,
                startTime: mgc.startTime.value,
                endTime: mgc.endTime.value,
                region: mgc.region.value,
                type: mgc.type.value,
                whitelist: mgc.whitelist.value,
                groups: mgc.groups.value.trim(),
                level: mgc.level.value,
                description: mgc.description.value
            };
            if (key) {
                values.gameType = `key`;
                values.keys = match[keyPos].replace(/\s/g, `\n`);
            } else {
                values.gameType = `gift`;
                copies = match[3];
                if (copies) {
                    values.copies = copies;
                } else {
                    values.copies = `1`;
                }
            }
            j = 1;
            if (esgst.mgc_groupKeys && key) {
                do {
                    found = false;
                    giveaway = giveaways[i + 1];
                    if (giveaway) {
                        match = giveaway.match(/^(([\d\w]{5}(-[\d\w]{5}){2,}\s?|https?:\/\/.+?\s?)+)\s(.+)$/);
                        if (match) {
                            key = true;
                            keyPos = 1;
                            namePos = 4;
                        } else {
                            match = giveaway.match(/^(.+?)\s(([\d\w]{5}(-[\d\w]{5}){2,}\s?|https?:\/\/.+?\s?)+)$/);
                            if (match) {
                                key = true;
                                keyPos = 2;
                                namePos = 1;
                            } else {
                                key = false;
                            }
                        }
                        if (match && key && match[namePos] === name) {
                            found = true;
                            values.keys += `\n${match[keyPos].replace(/\s/g, `\n`)}`;
                            ++i;
                            ++j;
                        }
                    }
                } while (found);
            }
            request(`do=autocomplete_giveaway_game&page_number=1&search_query=${encodeURIComponent(name)}`, null, false, `/ajax.php`, getMgcGiveaway.bind(null, giveaways, i, j, mgc, n, name, popup, progress, textArea, values, mainCallback, callback));
        } else {
            createAlert(`The next giveaway is not in the right format. Please correct it and click on "Import" again to continue importing.`);
            callback();
        }
    } else {
        mainCallback();
    }
}

function getMgcGiveaway(giveaways, i, j, mgc, n, name, popup, progress, textArea, values, mainCallback, callback, response) {
    var cache, elements, k, numElements, value;
    elements = DOM.parse(JSON.parse(response.responseText).html).getElementsByClassName(`table__row-outer-wrap`);
    for (k = 0, numElements = elements.length; k < numElements && elements[k].getAttribute(`data-autocomplete-name`) !== name; ++k);
    if (k < numElements) {
        values.gameId = elements[k].getAttribute(`data-autocomplete-id`);
        addMgcGiveaway(false, mgc, values);
        cache = JSON.parse(getValue(`mgcCache`, `[]`));
        cache.push(values);
        setValue(`mgcCache`, JSON.stringify(cache));
        value = $(progress.bar).progressbar(`option`, `value`) + j;
        $(progress.bar).progressbar(`option`, `value`, value);
        progress.current.textContent = value;
        do {
            textArea.value = textArea.value.replace(/^(.+?)\n/, ``);
            --j;
        } while (j > 0);
        popup.reposition();
        setTimeout(importMgcGiveaway, 0, giveaways, ++i, mgc, n, popup, progress, textArea, mainCallback, callback);
    } else {
        createAlert(`${name} was not found! Please correct the title of the game and click on "Import" again to continue importing (it must be exactly like on Steam).`);
        callback();
    }
}

function focusMgcTextArea(textArea) {
    textArea.focus();
}

function exportMgcGiveaways(mgc, mainCallback) {
    var anchor, file, i, j, n, name, popup, url, values;
    popup = new Popup(`fa-arrow-down`, `Export`);
    new ToggleSwitch(popup.description, `mgc_reversePosition`, false, `Export keys in reverse position (before the name of the game).`, false, false, ``, esgst.mgc_reversePosition);
    popup.description.appendChild(new ButtonSet(`green`, ``, `fa-arrow-down`, ``, `Export`, ``, function (callback) {
        file = ``;
        for (i = 0, n = mgc.giveaways.children.length; i < n; ++i) {
            values = mgc.giveaways.children[i].title.split(/\n/);
            if (values[1] === `Gift`) {
                if (parseInt(values[2].match(/\d+/)[0]) > 1) {
                    file += `${values[0]} (${values[2]})\r\n`;
                } else {
                    file += `${values[0]}\r\n`;
                }
            } else {
                for (j = 2; values[j]; ++j) {
                    if (esgst.mgc_reversePosition) {
                        file += `${values[j]} ${values[0]}\r\n`;
                    } else {
                        file += `${values[0]} ${values[j]}\r\n`;
                    }
                }
            }
        }
        anchor = document.createElement(`a`);
        anchor.download = `giveaways.txt`;
        url = URL.createObjectURL(new Blob([file]));
        anchor.href = url;
        document.body.appendChild(anchor);
        anchor.click();
        anchor.remove();
        URL.revokeObjectURL(url);
        callback();
        mainCallback();
    }).set);
    popup.onClose = mainCallback;
    popup.open();
}

function emptyMgcGiveaways(mgc, callback) {
    if (confirm(`Are you sure you want to empty the creator?`)) {
        delValue(`mgcCache`);
        esgst.busy = false;
        mgc.datas = [];
        mgc.values = [];
        mgc.created = [];
        mgc.giveaways.innerHTML = ``;
        mgc.copies.value = `1`;
        mgc.keys.value = ``;
    }
    callback();
}

function createMgcGiveaways(mgc, viewButton, callback) {
    if ((esgst.mgc_createTrain && mgc.description.value.match(/\[ESGST-P\]|\[ESGST-N\]/)) || !esgst.mgc_createTrain) {
        if ((mgc.discussion && mgc.description.value.match(/\[ESGST-B\]/)) || !mgc.discussion) {
            mgc.copies.value = `1`;
            mgc.keys.value = ``;
            viewButton.set.classList.add(`esgst-hidden`);
            mgc.saveGiveaways = {};
            createMgcGiveaway(0, mgc, mgc.giveaways.children.length, esgst.cewgd || (esgst.gc && esgst.gc_gi) || esgst.lpv || esgst.rcvc ? saveMgcGiveaways.bind(null, mgc, completeMgcCreation.bind(null, mgc, viewButton, callback)) : completeMgcCreation.bind(null, mgc, viewButton, callback));
        } else {
            createAlert(`The bump link format is missing from the description.`);
            callback();
        }
    } else {
        createAlert(`The next/previous links format is missing from the description.`);
        callback();
    }
}

function createMgcGiveaway(i, mgc, n, callback) {
    var j, popup;
    if (i < n) {
        if (!mgc.giveaways.children[i].classList.contains(`success`)) {
            j = parseInt(mgc.giveaways.children[i].textContent) - 1;
            if (j > 0 && mgc.datas[j].replace(/key_string=(.*?)&/, ``).replace(/copies=(.*?)&/, ``) === mgc.datas[j - 1].replace(/key_string=(.*?)&/, ``).replace(/copies=(.*?)&/, ``)) {
                popup = new Popup(`fa-circle-o-notch fa-spin`, `Waiting 2 minutes to create another identical giveaway...`, true);
                popup.open();
                setTimeout(() => {
                    popup.close();
                    request(mgc.datas[j].replace(/start_time=(.+?)&/, correctMgcTime), null, false, `/giveaways/new`, checkMgcCreation.bind(null, i, mgc, n, callback));
                }, 120000);
            } else {
                request(mgc.datas[j].replace(/start_time=(.+?)&/, correctMgcTime), null, false, `/giveaways/new`, checkMgcCreation.bind(null, i, mgc, n, callback));
            }
        } else {
            setTimeout(createMgcGiveaway, 0, ++i, mgc, n, callback);
        }
    } else if (esgst.mgc_createTrain) {
        createMgcTrain(0, mgc, mgc.created.length, callback);
    } else {
        callback();
    }
}

function correctMgcTime(fullMatch, match1) {
    if ((new Date(match1).getTime()) < Date.now()) {
        return `start_time=${formatDate(new Date())}&`;
    } else {
        return fullMatch;
    }
}

function checkMgcCreation(i, mgc, n, callback, response) {
    var errors, errorsTitle, giveaway, j, numErrors, responseHtml;
    giveaway = mgc.giveaways.children[i];
    if (response.finalUrl.match(/\/giveaways\/new/)) {
        giveaway.classList.add(`error`);
        errors = DOM.parse(response.responseText).getElementsByClassName(`form__row__error`);
        errorsTitle = `Errors:\n`;
        for (j = 0, numErrors = errors.length; j < numErrors; ++j) {
            errorsTitle += `${errors[j].textContent}\n`;
        }
        errorsTitle += `\n`;
        giveaway.title = `${errorsTitle}${giveaway.title}`;
    } else {
        giveaway.classList.add(`success`);
        responseHtml = DOM.parse(response.responseText);
        mgc.created.push({
            giveaway: giveaway,
            html: buildGiveaway(responseHtml, response.finalUrl).html,
            url: response.finalUrl
        });
        if (esgst.cewgd || (esgst.gc && esgst.gc_gi) || esgst.lpv || esgst.rcvc) {
            giveaway = getGiveaways(responseHtml, false, response.finalUrl)[0];
            if (giveaway) {
                mgc.saveGiveaways[giveaway.code] = giveaway;
            }
        }
    }
    setTimeout(createMgcGiveaway, 0, ++i, mgc, n, callback);
}

function saveMgcGiveaways(mgc, callback) {
    var user = {
        steamId: esgst.steamId,
        username: esgst.username
    };
    var savedUser = getUser(null, user), ugd;
    var giveaways = null;
    if (savedUser) {
        giveaways = savedUser.giveaways;
    }
    if (!giveaways) {
        giveaways = {
            sent: {
                apps: {},
                subs: {}
            },
            won: {
                apps: {},
                subs: {}
            },
            sentTimestamp: 0,
            wonTimestamp: 0
        };
        if (savedUser) {
            ugd = savedUser.ugd;
            if (ugd) {
                if (ugd.sent) {
                    for (var key in ugd.sent.apps) {
                        giveaways.sent.apps[key] = [];
                        for (var i = 0, n = ugd.sent.apps[key].length; i < n; ++i) {
                            mgc.saveGiveaways[ugd.sent.apps[key][i].code] = ugd.sent.apps[key][i];
                            giveaways.sent.apps[key].push(ugd.sent.apps[key][i].code);
                        }
                    }
                    for (var key in ugd.sent.subs) {
                        giveaways.sent.subs[key] = [];
                        for (var i = 0, n = ugd.sent.subs[key].length; i < n; ++i) {
                            mgc.saveGiveaways[ugd.sent.subs[key][i].code] = ugd.sent.subs[key][i];
                            giveaways.sent.subs[key].push(ugd.sent.subs[key][i].code);
                        }
                    }
                    giveaways.sentTimestamp = ugd.sentTimestamp;
                }
                if (ugd.won) {
                    for (var key in ugd.won.apps) {
                        giveaways.won.apps[key] = [];
                        for (var i = 0, n = ugd.won.apps[key].length; i < n; ++i) {
                            mgc.saveGiveaways[ugd.won.apps[key][i].code] = ugd.won.apps[key][i];
                            giveaways.won.apps[key].push(ugd.won.apps[key][i].code);
                        }
                    }
                    for (var key in ugd.won.subs) {
                        giveaways.won.subs[key] = [];
                        for (var i = 0, n = ugd.won.subs[key].length; i < n; ++i) {
                            mgc.saveGiveaways[ugd.won.subs[key][i].code] = ugd.won.subs[key][i];
                            giveaways.won.subs[key].push(ugd.won.subs[key][i].code);
                        }
                    }
                    giveaways.wonTimestamp = ugd.wonTimestamp;
                }
            }
        }
    }
    for (key in mgc.saveGiveaways) {
        var giveaway = mgc.saveGiveaways[key];
        if (!giveaways.sent[giveaway.gameType][giveaway.gameSteamId]) {
            giveaways.sent[giveaway.gameType][giveaway.gameSteamId] = [];
        }
        if (giveaways.sent[giveaway.gameType][giveaway.gameSteamId].indexOf(giveaway.code) < 0) {
            giveaways.sent[giveaway.gameType][giveaway.gameSteamId].push(giveaway.code);
        }
    }
    user.values = {
        giveaways: giveaways
    };
    lockAndSaveGiveaways(mgc.saveGiveaways, saveUser.bind(null, null, null, user, callback));
}

function createMgcTrain(i, mgc, n, callback) {
    if (i >= n || n - 1 === 0) {
        callback();
    } else {
        request(null, null, false, mgc.created[i].url, createMgcWagon.bind(null, i, mgc, n, callback));
    }
}

function createMgcWagon(i, mgc, n, callback, response) {
    var description, id, replaceCallback, responseHtml;
    responseHtml = DOM.parse(response.responseText);
    id = responseHtml.querySelector(`[name="giveaway_id"]`).value;
    description = responseHtml.querySelector(`[name="description"]`).value;
    if (i === 0) {
        mgc.firstWagon = mgc.created[i].url;
        replaceCallback = getMgcNext;
    } else if (i === n - 1) {
        replaceCallback = getMgcPrevious;
    } else {
        replaceCallback = getMgcBoth;
    }
    description = description.replace(/\[ESGST-P\](.+?)\[\/ESGST-P\](.+?)\[ESGST-N\](.+?)\[\/ESGST-N\]/g, replaceCallback.bind(null, i, mgc, false));
    description = description.replace(/\[ESGST-P\](.+?)\[\/ESGST-P\]|\[ESGST-N\](.+?)\[\/ESGST-N\]/g, replaceCallback.bind(null, i, mgc, true));
    description = description.replace(/\[ESGST-C\](.+?)\[\/ESGST-C\]/g, getMgcCounter.bind(null, i, n));
    if (mgc.discussion && (!esgst.mgc_bumpLast || i === n - 1)) {
        description = description.replace(/\[ESGST-B\](.+?)\[\/ESGST-B\]/g, `[$1](/discussion/${mgc.discussion}/)`);
    } else {
        description = description.replace(/\[ESGST-B\](.+?)\[\/ESGST-B\]/g, ``);
    }
    request(`xsrf_token=${esgst.xsrfToken}&do=edit_giveaway_description&giveaway_id=${id}&description=${encodeURIComponent(description.trim())}`, null, false, `/ajax.php`, connectMgcWagon.bind(null, i, mgc, n, callback));
}

function getMgcNext(i, mgc, single, fullMatch, match1, match2, match3) {
    var match, next, nextPref, nextSuf;
    if ((single && match2) || !single) {
        match = (single ? match2 : match3).match(/(.*?)\[N\](.+?)\[\/N\](.*?)$/);
        if (match) {
            nextPref = match[1];
            next = match[2];
            nextSuf = match[3];
        } else {
            nextPref = ``;
            next = single ? match2 : match3;
            nextSuf = ``;
        }
        if (esgst.mgc_removeLinks || single) {
            return `${nextPref}[${next}](${mgc.created[i + 1].url})${nextSuf}`;
        } else {
            return `${match1}${match2}${nextPref}[${next}](${mgc.created[i + 1].url})${nextSuf}`;
        }
    } else {
        return ``;
    }
}

function getMgcPrevious(i, mgc, single, fullMatch, match1, match2, match3) {
    var match, prev, prevPref, prevSuf;
    if ((single && match1) || !single) {
        match = match1.match(/(.*?)\[P\](.+?)\[\/P\](.*?)$/);
        if (match) {
            prevPref = match[1];
            prev = match[2];
            prevSuf = match[3];
        } else {
            prevPref = ``;
            prev = match1;
            prevSuf = ``;
        }
        if (esgst.mgc_removeLinks || single) {
            return `${prevPref}[${prev}](${mgc.created[i - 1].url})${prevSuf}`;
        } else {
            return `${prevPref}[${prev}](${mgc.created[i - 1].url})${prevSuf}${match2}${match3}`;
        }
    } else {
        return ``;
    }
}

function getMgcBoth(i, mgc, single, fullMatch, match1, match2, match3) {
    var match, next, nextPref, nextSuf, prev, prevPref, prevSuf;
    if (single) {
        if (match1) {
            return getMgcPrevious(i, mgc, true, fullMatch, match1);
        } else {
            return getMgcNext(i, mgc, true, fullMatch, null, match2);
        }
    } else {
        match = match1.match(/(.*?)\[P\](.+?)\[\/P\](.*?)$/);
        if (match) {
            prevPref = match[1];
            prev = match[2];
            prevSuf = match[3];
        } else {
            prevPref = ``;
            prev = match1;
            prevSuf = ``;
        }
        match = match3.match(/(.*?)\[N\](.+?)\[\/N\](.*?)$/);
        if (match) {
            nextPref = match[1];
            next = match[2];
            nextSuf = match[3];
        } else {
            nextPref = ``;
            next = match3;
            nextSuf = ``;
        }
        return `${prevPref}[${prev}](${mgc.created[i - 1].url})${prevSuf}${match2}${nextPref}[${next}](${mgc.created[i + 1].url})${nextSuf}`;
    }
}

function getMgcCounter(i, n, fullMatch, match1) {
    return `${i + 1}${match1}${n}`;
}

function connectMgcWagon(i, mgc, n, callback) {
    mgc.created[i].giveaway.classList.add(`connected`);
    setTimeout(createMgcTrain, 0, ++i, mgc, n, callback);
}

function completeMgcCreation(mgc, viewButton, callback) {
    if (mgc.discussion) {
        if (mgc.created.length) {
            delValue(`mgcCache`);
            setValue(`esgst_mgcAttach_step4`, mgc.firstWagon);
            open(`/discussion/${mgc.discussion}/`);
            viewButton.set.classList.remove(`esgst-hidden`);
        }
        callback();
    } else {
        if (mgc.created.length) {
            delValue(`mgcCache`);
            viewButton.set.classList.remove(`esgst-hidden`);
        }
        callback();
    }
}

function attachMgcDiscussion(mgc, callback) {
    var input, popup;
    callback();
    popup = new Popup(`fa-comments`, `Attach discussion:`);
    popup.description.insertAdjacentHTML(`afterBegin`, `
        <div class="esgst-description">
            <div>You can attach an existing or a new discussion. To attach an existing discussion, simply enter its code below and click "Attach Existing". To attach a new discussion, simply click "Attach New".</div>
            <br/>
            <div>Use [ESGST-B][/ESGST-B] to delimit the bump link in the description of the giveaway, for example: ### [ESGST-B]Bump[/ESGST-B]</div>
            <br/>
            <div>Use [ESGST-T][/ESGST-T] to delimit the train link in the description of the discussion (this link will lead to the first giveaway of the train), for example: ### [ESGST-T]Choo choo![/ESGST-T]</div>
            <br/>
            <div>When the discussion page opens in your browser at the end of the train creation, wait until it has completely finished altering it (you will get a popup when this happens).</div>
        </div>
    `);
    input = insertHtml(popup.description, `beforeEnd`, `<input placeholder="XXXXX" type="text"/>`);
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-paperclip`, `fa-circle-o-notch fa-spin`, `Attach Existing`, `Attaching...`, attachExistingMgcDiscussion.bind(null, input, mgc, popup)).set);
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-paperclip`, `fa-circle-o-notch fa-spin`, `Attach New`, `Attaching...`, attachNewMgcDiscussion.bind(null, mgc, popup)).set);
    popup.open();
}

function attachExistingMgcDiscussion(input, mgc, popup, callback) {
    mgc.discussion = input.value;
    mgc.discussionPanel.classList.remove(`esgst-hidden`);
    mgc.discussionLink.href = `/discussion/${mgc.discussion}/`;
    mgc.discussionLink.textContent = mgc.discussion;
    callback();
    popup.close();
}

function attachNewMgcDiscussion(mgc, popup, callback) {
    var win;
    setValue(`esgst_mgcAttach_step1`, true);
    win = open(`/discussions/new`);
    setTimeout(checkMgcAttached, 100, mgc, popup, win, callback);
}

function checkMgcAttached(mgc, popup, win, callback) {
    if (win.closed) {
        mgc.discussion = getValue(`esgst_mgcAttach_step3`);
        delValue(`esgst_mgcAttach_step3`);
        mgc.discussionPanel.classList.remove(`esgst-hidden`);
        mgc.discussionLink.href = `/discussion/${mgc.discussion}/`;
        mgc.discussionLink.textContent = mgc.discussion;
        callback();
        popup.close();
    } else {
        setTimeout(checkMgcAttached, 100, mgc, popup, win, callback);
    }
}

function addMgcCreateAndAttachButton() {
    var rows;
    rows = document.getElementsByClassName(`form__rows`)[0];
    rows.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Create & Attach`, `Creating & attaching...`, createAndAttachMgcDiscussion.bind(null, rows)).set);
}

function createAndAttachMgcDiscussion(rows) {
    setValue(`esgst_mgcAttach_step2`, true);
    rows.parentElement.submit();
}

function editMgcDiscussion() {
    description = document.querySelector(`[name=description]`);
    description.value = description.value.replace(/\[ESGST-T\](.+?)\[\/ESGST-T\]/g, `[$1](${getValue(`esgst_mgcAttach_step4`)})`);
    delValue(`esgst_mgcAttach_step4`);
    setValue(`esgst_mgcAttach_step5`, true);
    document.getElementsByClassName(`js__submit-form`)[0].click();
}

function detachMgcDiscussion(mgc) {
    mgc.discussion = null;
    mgc.discussionPanel.classList.add(`esgst-hidden`);
}

function viewMgcResults(mgc, callback) {
    var button, html, giveaways, i, n, popup, toggleSwitch, url;
    popup = new Popup(`fa-eye`, `Results`);
    html = ``;
    for (i = 0, n = mgc.created.length; i < n; ++i) {
        html += mgc.created[i].html;
    }
    popup.scrollable.insertAdjacentHTML(`beforeEnd`, `
        <div class="popup__keys__list">
            ${html}
        </div>
    `);
    giveaways = getGiveaways(popup.scrollable);
    if (esgst.gm) {
        esgst.gmCheckboxes = {};
        button = insertHtml(popup.scrollable, `afterBegin`, `
            <div class="esgst-page-heading">
                <div class="esgst-heading-button" title="Manage giveaways">
                    <span></span>
                    <i class="fa fa-gear"></i>
                </div>
            </div>
        `).firstElementChild;
        button.lastElementChild.addEventListener(`click`, openGmPopout.bind(null, giveaways, {
            button: button
        }));
        toggleSwitch = new ToggleSwitch(button.firstElementChild, `gm_enable`, true, ``, false, false, null, esgst.gm_enable);
        toggleSwitch.onEnabled = enableGm.bind(null, giveaways);
        toggleSwitch.onDisabled = disableGm.bind(null, giveaways);
        if (esgst.gm_enable) {
            enableGm(giveaways);
        }
    }
    popup.open();
    callback();
}

function removeMgcGiveaway(mgc) {
    if (confirm(`Are you sure you want to remove this giveaway?`)) {
        mgc.source.remove();
        mgc.source = null;
    }
}

/* [SGAC] Stickied Giveaway Countries */

function loadSgac() {
    if (esgst.newGiveawayPath && !document.getElementsByClassName(`table--summary`)[0]) {
        const stickiedCountries = JSON.parse(getValue(`stickiedCountries`, `[]`));
        const container = document.querySelector(`.form_list[data-input="country_item_string"]`);
        let separator = container.firstElementChild;
        const elements = container.children;
        let context, i, id, n;
        for (i = 0, n = elements.length; i < n; ++i) {
            context = elements[i];
            id = context.getAttribute(`data-item-id`);
            if (stickiedCountries.indexOf(id) >= 0) {
                if (context === separator) {
                    separator = separator.nextElementSibling;
                }
                container.insertBefore(context, separator);
                addSgacUnstickyButton(container, context, id, separator);
            } else {
                addSgacStickyButton(container, context, id, separator);
            }
        }
    }
}

function addSgacStickyButton(container, context, id, separator, button) {
    if (button) {
        button.remove();
    }
    button = insertHtml(context, `afterBegin`, `
        <div class="esgst-sgg-sticky-button">
            <a title="Sticky country">
                <i class="fa fa-thumb-tack"></i>
            </a>
        </div>
    `);
    button.firstElementChild.addEventListener(`click`, (event) => {
        event.stopPropagation();
        button.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
        `;
        if (container) {
            if (context === separator) {
                separator = separator.nextElementSibling;
            }
            container.insertBefore(context, separator);
        }
        let stickiedCountries = JSON.parse(getValue(`stickiedCountries`, `[]`));
        if (stickiedCountries.indexOf(id) < 0) {
            stickiedCountries.push(id);
            setValue(`stickiedCountries`, JSON.stringify(stickiedCountries));
        }
        addSgacUnstickyButton(container, context, id, separator, button);
    });
}

function addSgacUnstickyButton(container, context, id, separator, button) {
    if (button) {
        button.remove();
    }
    button = insertHtml(context, `afterBegin`, `
        <div class="esgst-sgg-unsticky-button">
            <a title="Unsticky country">
                <i class="fa fa-thumb-tack"></i>
            </a>
        </div>
    `);
    button.firstElementChild.addEventListener(`click`, (event) => {
        event.stopPropagation();
        button.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
        `;
        if (container) {
            container.insertBefore(context, separator);
            separator = separator.previousElementSibling;
        }
        let stickiedCountries = JSON.parse(getValue(`stickiedCountries`, `[]`));
        const index = stickiedCountries.indexOf(id);
        if (index >= 0) {
            stickiedCountries.splice(index, 1);
            setValue(`stickiedCountries`, JSON.stringify(stickiedCountries));
        }
        addSgacStickyButton(container, context, id, separator, button);
    });
}

/* [SGG] Stickied Giveaway Groups */

function loadSgg() {
    if (esgst.newGiveawayPath && !document.getElementsByClassName(`table--summary`)[0]) {
        setSggGiveawayGroups();
    } else if (esgst.groupsPath) {
        esgst.endlessFeatures.push(setSggGroups);
        setSggGroups(document);
    }
}

function setSggGiveawayGroups() {
    var avatar, code, container, context, elements, i, id, j, n, savedGroups, separator, stickied;
    savedGroups = JSON.parse(getValue(`groups`, `[]`));
    container = document.querySelector(`.form_list[data-input="group_item_string"]`);
    separator = container.firstElementChild.nextElementSibling;
    elements = container.children;
    for (i = 1, n = elements.length; i < n; ++i) {
        context = elements[i];
        id = context.getAttribute(`data-item-id`);
        avatar = context.firstElementChild.style.backgroundImage;
        code = null;
        stickied = false;
        for (j = savedGroups.length - 1; j >= 0; --j) {
            if (avatar.match(savedGroups[j].avatar)) {
                code = savedGroups[j].code;
                if (savedGroups[j].stickied) {
                    stickied = true;
                }
                break;
            }
        }
        if (code) {
            if (stickied) {
                if (context === separator) {
                    separator = separator.nextElementSibling;
                }
                container.insertBefore(context, separator);
                addSggUnstickyButton(code, container, context, id, separator);
            } else {
                addSggStickyButton(code, container, context, id, separator);
            }
        }
    }
}

function setSggGroups(context) {
    var avatar, code, element, elements, i, j, key, n, savedGroups, stickied;
    savedGroups = JSON.parse(getValue(`groups`, `[]`));
    elements = context.getElementsByClassName(`table__row-inner-wrap`);
    for (i = 0, n = elements.length; i < n; ++i) {
        element = elements[i];
        avatar = element.getElementsByClassName(`table_image_avatar`)[0].style.backgroundImage;
        stickied = false;
        for (j = savedGroups.length - 1; j >= 0; --j) {
            if (avatar.match(savedGroups[j].avatar)) {
                code = savedGroups[j].code;
                if (savedGroups[j].stickied) {
                    stickied = true;
                }
                break;
            }
        }
        if (code) {
            if (stickied) {
                addSggUnstickyButton(code, null, element);
            } else {
                addSggStickyButton(code, null, element);
            }
        }
    }
}

function addSggStickyButton(code, container, context, id, separator, button) {
    if (button) {
        button.remove();
    }
    button = insertHtml(context, `afterBegin`, `
        <div class="esgst-sgg-sticky-button">
            <a title="Sticky group.">
                <i class="fa fa-thumb-tack"></i>
            </a>
        </div>
    `);
    button.firstElementChild.addEventListener(`click`, stickySggGroup.bind(null, code, container, context, id, separator, button));
}

function addSggUnstickyButton(code, container, context, id, separator, button) {
    if (button) {
        button.remove();
    }
    button = insertHtml(context, `afterBegin`, `
        <div class="esgst-sgg-unsticky-button">
            <a title="Unsticky group.">
                <i class="fa fa-thumb-tack"></i>
            </a>
        </div>
    `);
    button.firstElementChild.addEventListener(`click`, unstickySggGroup.bind(null, code, container, context, id, separator, button));
}

function stickySggGroup(code, container, context, id, separator, button, event) {
    var groups;
    event.stopPropagation();
    button.innerHTML = `
        <i class="fa fa-circle-o-notch fa-spin"></i>
    `;
    if (container) {
        if (context === separator) {
            separator = separator.nextElementSibling;
        }
        container.insertBefore(context, separator);
    }
    groups = {};
    groups[code] = {
        stickied: true
    };
    if (id) {
        groups[code].id = id;
    }
    lockAndSaveGroups(groups, false, addSggUnstickyButton.bind(null, code, container, context, id, separator, button));
}

function unstickySggGroup(code, container, context, id, separator, button, event) {
    var groups;
    event.stopPropagation();
    button.innerHTML = `
        <i class="fa fa-circle-o-notch fa-spin"></i>
    `;
    if (container) {
        container.insertBefore(context, separator);
        separator = separator.previousElementSibling;
    }
    groups = {};
    groups[code] = {
        stickied: false
    };
    if (id) {
        groups[code].id = id;
    }
    lockAndSaveGroups(groups, false, addSggStickyButton.bind(null, code, container, context, id, separator, button));
}

/* [RCVC] Real CV Calculator */

function loadRcvc() {
    if (esgst.newGiveawayPath) {
        var table = document.getElementsByClassName(`table--summary`)[0], button;
        if (table) {
            var game = getValue(`rcvcGame`);
            if (game) {
                var type = game.type;
                var id = game.id;
                var i, n;
                var headings = document.getElementsByClassName(`featured__heading__small`);
                var copiesHeading, pointsHeading;
                if (headings.length > 1) {
                    copiesHeading = headings[0];
                    pointsHeading = headings[1];
                } else {
                    pointsHeading = headings[0];
                }
                var copies;
                if (copiesHeading) {
                    copies = parseInt(copiesHeading.textContent.match(/\d+/)[0]);
                } else {
                    copies = 1;
                }
                var value = parseInt(pointsHeading.textContent.match(/\d+/)[0]);
                var games = JSON.parse(getValue(`games`));
                if (games[type][id]) {
                    if (games[type][id].noCV) {
                        value = 0;
                    } else if (games[type][id].reducedCV) {
                        value *= 0.15;
                    }
                }
                var user = {
                    Username: esgst.username,
                    SteamID64: esgst.steamId
                };
                var users = JSON.parse(getValue(`users`));
                var savedUser = users.users[user.SteamID64];
                var sent = 0;
                var currentDate = Date.now();
                if (savedUser && savedUser.giveaways && savedUser.giveaways.sent && savedUser.giveaways.sent[type][id]) {
                    var giveaways = savedUser.giveaways.sent[type][id];
                    for (i = 0, n = giveaways.length; i < n; ++i) {
                        var giveaway = esgst.giveaways[giveaways[i]];
                        if (giveaway && (currentDate < giveaway.endTime || (((giveaways.entries < 5) && !giveaway.inviteOnly && !giveaway.group && !giveaway.whitelist) || (giveaway.entries >= 5)))) {
                            if (giveaway.entries >= giveaway.copies || currentDate < giveaway.endTime) {
                                sent += giveaway.copies;
                            } else {
                                sent += giveaway.entries;
                            }
                        }
                    }
                    if (sent > 5) {
                        for (i = 0, n = sent - 5; i < n; ++i) {
                            value *= 0.90;
                        }
                    }
                }
                var cv;
                if (copies > 1) {
                    var total = copies + sent;
                    if (total > 5) {
                        n = total - 5;
                        cv = (copies - n) * value;
                        for (i = 0; i < n; ++i) {
                            value *= 0.90;
                            cv += value;
                        }
                    } else {
                        cv = value * copies;
                    }
                } else if ((sent + 1) > 5) {
                    cv = value * 0.90;
                } else {
                    cv = value;
                }
                cv = Math.round(cv * 100) / 100;
                var html = `
                    <div class="table__row-outer-wrap">
                        <div class="table__row-inner-wrap">
                            <div class="table__column--width-medium table__column--align-top">
                                <span class="esgst-bold">Real CV</span>
                            </div>
                            <div class="table__column--width-fill">You should get ~$${cv} real CV for this giveaway.</div>
                        </div>
                    </div>
                `;
                table.insertAdjacentHTML(`beforeEnd`, html);
                button = document.getElementsByClassName(`js__submit-form`)[0];
                button.addEventListener(`click`, function () {
                    delValue(`rcvcGame`);
                });
            }
        } else {
            button = document.getElementsByClassName(`js__submit-form`)[0];
            var input = document.querySelector(`[name="game_id"]`);
            button.addEventListener(`click`, function () {
                var selectedId = input.value;
                var selected = document.querySelector(`[data-autocomplete-id="${selectedId}"]`);
                var info = getGameInfo(selected);
                setValue(`rcvcGame`, {
                    type: info.type,
                    id: info.id
                });
            });
        }
    }
}

/* [UGS] Unsent Gifts Sender */

function saveUgsReroll(category, winner) {
    var rerolls;
    if (category.value === `1`) {
        id = winner.value;
        if (id) {
            rerolls = JSON.parse(getValue(`rerolls`));
            if (rerolls.indexOf(id) < 0) {
                rerolls.push(id);
                setValue(`rerolls`, JSON.stringify(rerolls));
            }
        }
    }
}

function openUgsPopup(ugs) {
    var checkMemberSwitch, checkDifferenceSwitch;
    if (!ugs.popup) {
        ugs.popup = new Popup(`fa-gift`, `Send unsent gifts:`);
        new ToggleSwitch(ugs.popup.description, `ugs_checkRules`, false, `Do not send if the winner has any not activated/multiple wins.`, false, false, `The winners will be checked in real time.`, esgst.ugs_checkRules);
        checkMemberSwitch = new ToggleSwitch(ugs.popup.description, `ugs_checkMember`, false, `Do not send if the winner is no longer a member of at least one of the groups for group giveaways.`, false, false, `The winners will be checked in real time.`, esgst.ugs_checkMember);
        checkDifferenceSwitch = new ToggleSwitch(ugs.popup.description, `ugs_checkDifference`, false, `Do not send if the winner has a gift difference lower than <input class="esgst-ugs-difference" step="0.1" type="number" value="${esgst.ugs_difference}"/>.`, false, false, `The winners will be checked in real time.`, esgst.ugs_checkDifference);
        new ToggleSwitch(ugs.popup.description, `ugs_checkWhitelist`, false, `Do not send if the winner is not on your whitelist.`, false, false, `You must sync your whitelist through the settings menu. Whitelisted winners get a pass for broken rules, so if this option is enabled and the winner is whitelisted, the gift will be sent regardless of whether or not the first option is enabled.`, esgst.ugs_checkWhitelist);
        new ToggleSwitch(ugs.popup.description, `ugs_checkBlacklist`, false, `Do not send if the winner on your blacklist.`, false, false, `You must sync your blacklist through the settings menu. If the winner is blacklisted, but is a member of one of the groups, the gift will be sent anyway.`, esgst.ugs_checkBlacklist);
        if (!esgst.ugs_checkMember) {
            checkDifferenceSwitch.container.classList.add(`esgst-hidden`);
        }
        checkDifferenceSwitch.name.firstElementChild.addEventListener(`change`, setUgsDifference);
        checkMemberSwitch.dependencies.push(checkDifferenceSwitch.container);
        ugs.results = insertHtml(ugs.popup.scrollable, `beforeEnd`, `
            <div class="esgst-hidden markdown">
                <ul>
                    <li>
                        <span class="esgst-bold">Successfully sent gifts to <span>0</span> winners:</span> <span></span>
                    </li>
                    <li>
                        <span class="esgst-bold">Failed to send gifts to <span>0</span> winners (check the tooltips to find out the cause of the failures):</span> <span></span>
                    </li>
                </ul>
            </div>
        `);
        ugs.sent = ugs.results.firstElementChild.firstElementChild;
        ugs.sentCount = ugs.sent.firstElementChild.firstElementChild;
        ugs.sentGifts = ugs.sent.lastElementChild;
        ugs.unsent = ugs.sent.nextElementSibling;
        ugs.unsentCount = ugs.unsent.firstElementChild.firstElementChild;
        ugs.unsentGifts = ugs.unsent.lastElementChild;
        ugs.popup.description.appendChild(new ButtonSet(`green`, `red`, `fa-send`, `fa-times-circle`, `Send`, `Cancel`, startUgsSender.bind(null, ugs), cancelUgsSender.bind(null, ugs)).set);
        ugs.progress = insertHtml(ugs.popup.description, `beforeEnd`, `<div></div>`);
        ugs.overallProgress = insertHtml(ugs.popup.description, `beforeEnd`, `<div></div>`);
        ugs.popup.description.appendChild(ugs.popup.scrollable);
    }
    ugs.popup.open();
}

function setUgsDifference(event) {
    setSetting(`ugs_difference`, event.currentTarget.value);
}

function startUgsSender(ugs, callback) {
    var unsent;
    ugs.button.classList.add(`esgst-busy`);
    ugs.results.classList.add(`esgst-hidden`);
    ugs.sent.classList.add(`esgst-hidden`);
    ugs.unsent.classList.add(`esgst-hidden`);
    ugs.sentCount.textContent = ugs.unsentCount.textContent = `0`;
    ugs.sentGifts.innerHTML = ugs.unsentGifts.innerHTML = ``;
    ugs.progress.innerHTML = ``;
    ugs.overallProgress.textContent = ``;
    ugs.giveaways = [];
    ugs.canceled = false;
    unsent = esgst.createdButton.getElementsByClassName(`nav__notification`)[0];
    if (unsent) {
        ugs.count = parseInt(unsent.textContent);
        getUgsGiveaways(document, ugs, esgst.currentPage, continueUgsSender.bind(null, ugs, callback));
    } else {
        ugs.button.classList.remove(`esgst-busy`);
        ugs.progress.innerHTML = `You do not have any unsent gifts.`;
        callback();
        ugs.popup.reposition();
    }
}

function getUgsGiveaways(context, ugs, nextPage, callback) {
    var element, elements, giveaways, heading, i, n, unsent, url;
    if (!ugs.canceled) {
        ugs.popup.reposition();
        if (context) {
            if (nextPage === esgst.currentPage) {
                ugs.lastPage = getLastPage(context);
                ugs.lastPage = ugs.lastPage === 999999999 ? `` : ` of ${ugs.lastPage}`;
            }
            ugs.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Searching for unsent gifts (page ${nextPage - 1}${ugs.lastPage})...</span>
            `;
            giveaways = [];
            elements = context.getElementsByClassName(`table__row-outer-wrap`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                unsent = element.getElementsByClassName(`fa icon-red fa-warning`)[0];
                if (unsent) {
                    heading = element.getElementsByClassName(`table__column__heading`)[0];
                    url = heading.getAttribute(`href`);
                    giveaways.push({
                        code: url.match(/\/giveaway\/(.+?)\//)[1],
                        context: unsent,
                        name: heading.firstChild.textContent.trim().match(/(.+?)(\s\(.+\sCopies\))?$/)[1],
                        url: url
                    });
                }
            }
            n = giveaways.length;
            if (n > 0) {
                setUgsGiveaways(giveaways, ugs, 0, n, checkNextUgsPage.bind(null, context, ugs, nextPage, callback));
            } else {
                checkNextUgsPage(context, ugs, nextPage, callback);
            }
        } else if (document.getElementsByClassName(`esgst-es-page-${nextPage}}`)[0]) {
            setTimeout(getUgsGiveaways, 0, null, ugs, ++nextPage, callback);
        } else if (!ugs.canceled) {
            request(null, null, false, `/giveaways/created/search?page=${nextPage}`, loadNextUgsPage.bind(null, ugs, nextPage, callback));
        }
    }
}

function setUgsGiveaways(giveaways, ugs, i, n, callback) {
    var giveaway;
    if (!ugs.canceled) {
        ugs.overallProgress.textContent = `${i} of ${n} giveaways checked...`;
        if (i < n) {
            giveaway = giveaways[i];
            ugs.giveaways[giveaway.code] = {
                code: giveaway.code,
                context: giveaway.context,
                name: giveaway.name,
                url: giveaway.url,
                winners: []
            };
            getUgsWinners(giveaway.code, ugs, 1, `${giveaway.url}/winners/search?page=`, checkUgsGiveawayGroups.bind(null, giveaway, giveaways, ugs, i, n, callback));
        } else {
            callback();
        }
    }
}

function getUgsWinners(code, ugs, nextPage, url, callback) {
    if (!ugs.canceled) {
        ugs.popup.reposition();
        request(null, null, false, `${url}${nextPage}`, loadNextUgsWinnersPage.bind(null, code, ugs, nextPage, url, callback));
    }
}

function loadNextUgsWinnersPage(code, ugs, nextPage, url, callback, response) {
    var elements, i, n, pagination, responseHtml, unsent;
    if (!ugs.canceled) {
        responseHtml = DOM.parse(response.responseText);
        if (nextPage === 1) {
            ugs.lastWinnersPage = getLastPage(responseHtml);
            ugs.lastWinnersPage = ugs.lastWinnersPage === 999999999 ? `` : ` of ${ugs.lastWinnersPage}`;
        }
        ugs.progress.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <span>Retrieving winners (page ${nextPage - 1}${ugs.lastWinnersPage})...</span>
        `;
        elements = responseHtml.getElementsByClassName(`table__row-outer-wrap`);
        for (i = 0, n = elements.length; i < n; ++i) {
            element = elements[i];
            unsent = element.querySelector(`.table__gift-not-sent:not(.is-hidden)`);
            if (unsent) {
                ugs.giveaways[code].winners.push({
                    username: element.getElementsByClassName(`table__column__heading`)[0].textContent,
                    values: {},
                    winnerId: element.querySelector(`[name="winner_id"]`).value
                });
                ugs.count -= 1;
            }
        }
        pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
        if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
            setTimeout(getUgsWinners, 0, code, ugs, ++nextPage, url, callback);
        } else {
            if (responseHtml.getElementsByClassName(`featured__column--group`)[0]) {
                ugs.giveaways[code].group = true;
            }
            if (responseHtml.getElementsByClassName(`featured__column--whitelist`)[0]) {
                ugs.giveaways[code].whitelist = true;
            }
            callback();
        }
    }
}

function checkUgsGiveawayGroups(giveaway, giveaways, ugs, i, n, callback) {
    if (!ugs.canceled) {
        if (esgst.ugs_checkMember && ugs.giveaways[giveaway.code].group) {
            ugs.giveaways[giveaway.code].groups = [];
            getUgsGroups(giveaway.code, ugs, 1, `${giveaway.url}/groups/search?page=`, setTimeout.bind(null, setUgsGiveaways, 0, giveaways, ugs, ++i, n, callback));
        } else {
            setTimeout(setUgsGiveaways, 0, giveaways, ugs, ++i, n, callback);
        }
    }
}

function getUgsGroups(code, ugs, nextPage, url, callback) {
    if (!ugs.canceled) {
        ugs.popup.reposition();
        request(null, null, false, `${url}${nextPage}`, loadNextUgsGroupsPage.bind(null, code, ugs, nextPage, url, callback));
    }
}

function loadNextUgsGroupsPage(code, ugs, nextPage, url, callback, response) {
    var elements, i, match, n, pagination, responseHtml;
    if (!ugs.canceled) {
        responseHtml = DOM.parse(response.responseText);
        if (nextPage === 1) {
            ugs.lastGroupsPage = getLastPage(responseHtml);
            ugs.lastGroupsPage = ugs.lastGroupsPage === 999999999 ? `` : ` of ${ugs.lastGroupsPage}`;
        }
        ugs.progress.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <span>Retrieving groups (page ${nextPage - 1}${ugs.lastGroupsPage})...</span>
        `;
        elements = responseHtml.getElementsByClassName(`table__column__heading`);
        for (i = 0, n = elements.length; i < n; ++i) {
            match = elements[i].getAttribute(`href`).match(/\/group\/(.+?)\/(.+)/);
            ugs.giveaways[code].groups.push({
                code: match[1],
                name: match[2]
            });
        }
        pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
        if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
            setTimeout(getUgsGroups, 0, code, ugs, ++nextPage, url, callback);
        } else {
            callback();
        }
    }
}

function checkNextUgsPage(context, ugs, nextPage, callback) {
    var pagination;
    if (!ugs.canceled) {
        if (ugs.count > 0) {
            pagination = context.getElementsByClassName(`pagination__navigation`)[0];
            if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(getUgsGiveaways, 0, null, ugs, nextPage, callback);
            } else {
                callback();
            }
        } else {
            callback();
        }
    }
}

function loadNextUgsPage(ugs, nextPage, callback, response) {
    if (!ugs.canceled) {
        setTimeout(getUgsGiveaways, 0, DOM.parse(response.responseText), ugs, ++nextPage, callback);
    }
}

function continueUgsSender(ugs, callback) {
    var n;
    if (!ugs.canceled) {
        codes = Object.keys(ugs.giveaways);
        n = codes.length;
        if (n > 0) {
            ugs.rerolls = JSON.parse(getValue(`rerolls`));
            ugs.sentWinners = {};
            ugs.winners = {};
            ugs.results.classList.remove(`esgst-hidden`);
            checkUgsGifts(codes, ugs, 0, n, completeUgsSender.bind(null, ugs, callback));
        } else {
            ugs.button.classList.remove(`esgst-busy`);
            ugs.progress.innerHTML = `You do not have any unsent gifts.`;
            callback();
            ugs.popup.reposition();
        }
    }
}

function checkUgsGifts(codes, ugs, i, n, callback) {
    var code, giveaway, j, numWinners, savedUser, winner, winners;
    if (!ugs.canceled) {
        if (i < n) {
            ugs.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Checking winners...</span>
            `;
            ugs.popup.reposition();
            ugs.overallProgress.textContent = `${i} of ${n} giveaways checked...`;
            code = codes[i];
            giveaway = ugs.giveaways[code];
            winners = giveaway.winners;
            numWinners = winners.length;
            if (esgst.ugs_checkRules) {
                if (esgst.ugs_checkMember && giveaway.group) {
                    checkUgsRules(code, ugs, 0, numWinners, checkUgsGroups.bind(null, code, ugs, 0, numWinners, sendUgsGifts.bind(null, code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback))));
                } else {
                    checkUgsRules(code, ugs, 0, numWinners, sendUgsGifts.bind(null, code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback)));
                }
            } else if (esgst.ugs_checkMember && giveaway.group) {
                checkUgsGroups(code, ugs, 0, numWinners, sendUgsGifts.bind(null, code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback)));
            } else if (esgst.ugs_checkWhitelist) {
                checkUgsWhitelist(code, ugs, 0, numWinners, sendUgsGifts.bind(null, code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback)));
            } else if (esgst.ugs_checkBlacklist) {
                checkUgsBlacklist(code, ugs, 0, numWinners, sendUgsGifts.bind(null, code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback)));
            } else {
                for (j = 0; j < numWinners; ++j) {
                    winner = winners[j];
                    if (ugs.rerolls.indexOf(winner.winnerId) >= 0) {
                        winner.error = `${winner.username} is currently being rerolled.`;
                    }
                }
                sendUgsGifts(code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback));
            }
        } else {
            callback();
        }
    }
}

function checkUgsWhitelist(code, ugs, i, n, callback) {
    if (!ugs.canceled) {
        if (i < n) {
            giveaway = ugs.giveaways[code];
            winner = giveaway.winners[i];
            if (ugs.rerolls.indexOf(winner.winnerId) < 0) {
                savedUser = getUser(esgst.users, winner);
                if (savedUser && !savedUser.whitelisted) {
                    winner.error = `${winner.username} is not whitelisted.`;
                }
            } else {
                winner.error = `${winner.username} is currently being rerolled.`;
            }
            setTimeout(checkUgsWhitelist, 0, code, ugs, ++i, n, callback);
        } else {
            callback();
        }
    }
}

function checkUgsBlacklist(code, ugs, i, n, callback) {
    if (!ugs.canceled) {
        if (i < n) {
            giveaway = ugs.giveaways[code];
            winner = giveaway.winners[i];
            if (ugs.rerolls.indexOf(winner.winnerId) < 0) {
                savedUser = getUser(esgst.users, winner);
                if (savedUser && savedUser.blacklisted) {
                    winner.error = `${winner.username} is blacklisted.`;
                }
            } else {
                winner.error = `${winner.username} is currently being rerolled.`;
            }
            setTimeout(checkUgsBlacklist, 0, code, ugs, ++i, n, callback);
        } else {
            callback();
        }
    }
}

function checkUgsRules(code, ugs, i, n, callback) {
    var giveaway, namwc, winner;
    if (!ugs.canceled) {
        if (i < n) {
            giveaway = ugs.giveaways[code];
            winner = giveaway.winners[i];
            ugs.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Checking if ${winner.username} has not activated/multiple wins...</span>
            `;
            ugs.popup.reposition();
            if (ugs.rerolls.indexOf(winner.winnerId) < 0) {
                namwc = {
                    lastCheck: Date.now(),
                    results: {}
                };
                checkNAMWCNotActivated(ugs, namwc, winner.username, function (namwc) {
                    checkNAMWCMultiple(ugs, namwc, winner.username, function (namwc) {
                        winner.values.namwc = namwc;
                        if (namwc.results.notActivated || namwc.results.multiple) {
                            if (esgst.ugs_checkWhitelist) {
                                savedUser = getUser(esgst.users, winner);
                                if (savedUser && !savedUser.whitelisted) {
                                    winner.error = `${winner.username} is not whitelisted.`;
                                }
                            } else if (esgst.ugs_checkBlacklist) {
                                savedUser = getUser(esgst.users, winner);
                                if (savedUser && savedUser.blacklisted) {
                                    winner.error = `${winner.username} is blacklisted.`;
                                }
                            } else {
                                if (namwc.results.notActivated && namwc.results.multiple) {
                                    winner.error = `${winner.username} has ${namwc.results.notActivated} not activated wins and ${namwc.results.multiple} multiple wins.`;
                                } else if (namwc.results.notActivated) {
                                    winner.error = `${winner.username} has ${namwc.results.notActivated} not activated wins.`;
                                } else {
                                    winner.error = `${winner.username} has ${namwc.results.multiple} multiple wins.`;
                                }
                            }
                        }
                        setTimeout(checkUgsRules, 0, code, ugs, ++i, n, callback);
                    });
                });
            } else {
                winner.error = `${winner.username} is currently being rerolled.`;
                setTimeout(checkUgsRules, 0, code, ugs, ++i, n, callback);
            }
        } else {
            callback();
        }
    }
}

function checkUgsGroups(code, ugs, i, n, callback) {
    var giveaway, numGroups, winner;
    if (!ugs.canceled) {
        if (i < n) {
            giveaway = ugs.giveaways[code];
            numGroups = giveaway.groups.length;
            winner = giveaway.winners[i];
            ugs.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Checking if ${winner.username} is a member of one of the groups...</span>
            `;
            ugs.popup.reposition();
            if (ugs.rerolls.indexOf(winner.winnerId) < 0) {
                getSteamId(null, false, esgst.users, winner, getUgsGroupMembers.bind(null, giveaway, ugs, 0, numGroups, winner, checkUgsUserGroups.bind(null, giveaway, ugs, winner, setTimeout.bind(null, checkUgsGroups, 0, code, ugs, ++i, n, callback))));
            } else {
                winner.error = `${winner.username} is currently being rerolled.`;
                setTimeout(checkUgsGroups, 0, code, ugs, ++i, n, callback);
            }
        } else {
            callback();
        }
    }
}

function getUgsGroupMembers(giveaway, ugs, i, n, winner, callback) {
    var code, j;
    if (!ugs.canceled) {
        if (i < n) {
            code = giveaway.groups[i].code;
            for (j = esgst.groups.length - 1; j >= 0 && esgst.groups[j].code !== code; --j);
            request(null, null, false, `http://steamcommunity.com/gid/${esgst.groups[j].steamId}/memberslistxml?xml=1`, checkUgsGroupMembers.bind(null, giveaway, ugs, i, n, winner, callback));
        } else {
            callback();
        }
    }
}

function checkUgsGroupMembers(giveaway, ugs, i, n, winner, callback, response) {
    var group;
    if (!ugs.canceled) {
        if (response.responseText.match(new RegExp(`<steamID64>${winner.steamId}</steamID64>`))) {
            if (esgst.ugs_checkDifference) {
                ugs.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Checking if ${winner.username} has a gift difference higher than the one set...</span>
                `;
                ugs.popup.reposition();
                group = giveaway.groups[i];
                request(null, null, false, `/group/${group.code}/${group.name}/users/search?q=${winner.username}`, checkUgsDifference.bind(null, ugs, winner, callback));
            } else {
                callback(true);
            }
        } else {
            setTimeout(getUgsGroupMembers, 0, giveaway, ugs, ++i, n, winner, callback);
        }
    }
}

function checkUgsDifference(ugs, winner, callback, response) {
    var difference, element, username;
    if (!ugs.canceled) {
        element = DOM.parse(response.responseText).getElementsByClassName(`table__row-outer-wrap`)[0];
        if (element) {
            username = element.getElementsByClassName(`table__column__heading`)[0].textContent;
            if (username === winner.username) {
                difference = parseFloat(element.getElementsByClassName(`table__column--width-small`)[2].textContent);
                if (difference >= esgst.ugs_difference) {
                    callback(true);
                } else {
                    winner.error = `${winner.username} has a ${difference} gift difference.`;
                    callback(true);
                }
            } else {
                callback();
            }
        } else {
            callback();
        }
    }
}

function checkUgsUserGroups(giveaway, ugs, winner, callback, member) {
    var savedUser;
    if (!ugs.canceled) {
        if (member) {
            callback();
        } else if (giveaway.whitelist) {
            savedUser = getUser(esgst.users, winner);
            if (savedUser && !savedUser.whitelisted) {
                winner.error = `${winner.username} is not whitelisted.`;
            }
            callback();
        } else {
            winner.error = `${winner.username} is not a member of one of the groups.`;
            callback();
        }
    }
}

function sendUgsGifts(code, ugs, i, n, callback) {
    var giveaway, winner;
    if (!ugs.canceled) {
        if (i < n) {
            ugs.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Sending gifts...</span>
            `;
            ugs.overallProgress.textContent = `${i} of ${n} gifts sent...`;
            ugs.popup.reposition();
            giveaway = ugs.giveaways[code];
            winner = giveaway.winners[i];
            if (!ugs.winners[winner.username]) {
                ugs.winners[winner.username] = [];
            }
            if (ugs.winners[winner.username].indexOf(giveaway.name) < 0) {
                if (winner.error) {
                    ugs.unsent.classList.remove(`esgst-hidden`);
                    ugs.unsentCount.textContent = parseInt(ugs.unsentCount.textContent) + 1;
                    ugs.unsentGifts.insertAdjacentHTML(`beforeEnd`, `
                        <span>
                            <a href="/user/${winner.username}">${winner.username}</a> (<a href="${giveaway.url}/winners">${giveaway.name}</a>)
                            <i class="fa fa-question-circle" title="${winner.error}"></i>
                        </span>
                    `);
                    setTimeout(sendUgsGifts, 0, code, ugs, ++i, n, callback);
                } else if (!ugs.canceled) {
                    request(`xsrf_token=${esgst.xsrfToken}&do=sent_feedback&action=1&winner_id=${winner.winnerId}`, null, false, `/ajax.php`, sendUgsGift.bind(null, code, giveaway, ugs, i, n, winner, callback));
                }
            } else {
                ugs.unsent.classList.remove(`esgst-hidden`);
                ugs.unsentCount.textContent = parseInt(ugs.unsentCount.textContent) + 1;
                ugs.unsentGifts.insertAdjacentHTML(`beforeEnd`, `
                    <span>
                        <a href="/user/${winner.username}">${winner.username}</a> (<a href="${giveaway.url}/winners">${giveaway.name}</a>)
                        <i class="fa fa-question-circle" title="${winner.username} already won ${giveaway.name} from another giveaway of yours."></i>
                    </span>
                `);
                ugs.popup.reposition();
                setTimeout(sendUgsGifts, 0, code, ugs, ++i, n, callback);
            }
        } else {
            callback();
        }
    }
}

function sendUgsGift(code, giveaway, ugs, i, n, winner, callback) {
    if (!ugs.canceled) {
        if (!ugs.sentWinners[giveaway.code]) {
            ugs.sentWinners[giveaway.code] = [];
        }
        ugs.sent.classList.remove(`esgst-hidden`);
        ugs.sentWinners[giveaway.code].push(winner.username);
        ugs.sentCount.textContent = parseInt(ugs.sentCount.textContent) + 1;
        ugs.sentGifts.insertAdjacentHTML(`beforeEnd`, `
            <span>
                <a href="/user/${winner.username}">${winner.username}</a> (<a href="${giveaway.url}/winners">${giveaway.name}</a>)
            </span>
        `);
        ugs.popup.reposition();
        if (!ugs.winners[winner.username]) {
            ugs.winners[winner.username] = [];
        }
        ugs.winners[winner.username].push(giveaway.name);
        if (document.body.contains(giveaway.context)) {
            giveaway.context.className = `fa fa-check-circle icon-green`;
            giveaway.context.nextElementSibling.textContent = `Sent`;
        }
        setTimeout(sendUgsGifts, 0, code, ugs, ++i, n, callback);
    }
}

function completeUgsSender(ugs, callback) {
    var i, key, n, savedUsers, winners;
    if (!ugs.canceled) {
        winners = JSON.parse(getValue(`winners`, `{}`));
        for (key in ugs.sentWinners) {
            if (!winners[key]) {
                winners[key] = [];
            }
            for (i = 0, n = ugs.sentWinners[key].length; i < n; ++i) {
                winners[key].push(ugs.sentWinners[key][i]);
            }
        }
        setValue(`winners`, JSON.stringify(winners));
        savedUsers = [];
        for (key in ugs.giveaways) {
            for (i = 0, n = ugs.giveaways[key].winners.length; i < n; ++i) {
                savedUsers.push(ugs.giveaways[key].winners[i]);
            }
        }
        ugs.progress.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <span>Saving data...</span>
        `;
        ugs.overallProgress.textContent = ``;
        ugs.popup.reposition();
        saveUsers(savedUsers, function() {
            ugs.button.classList.remove(`esgst-busy`);
            ugs.progress.innerHTML = ``;
            callback();
            ugs.popup.reposition();
        });
    }
}

function cancelUgsSender(ugs) {
    ugs.canceled = true;
    ugs.button.classList.remove(`esgst-busy`);
    ugs.progress.innerHTML = ``;
    ugs.overallProgress.textContent = ``;
    ugs.popup.reposition();
}

/* [SKS] Sent Keys Searcher */

function openSksPopup(sks) {
    if (!sks.popup) {
        sks.popup = new Popup(`fa-key`, `Search for keys:`);
        sks.textArea = insertHtml(sks.popup.scrollable, `beforeEnd`, `
            <div class="esgst-description">Insert the keys below, one per line.</div>
            <textarea></textarea>
        `);
        new ToggleSwitch(sks.popup.description, `sks_exportKeys`, false, `Export all keys ever sent.`, false, false, `This will search all your giveaways and export a file with all keys ever sent. You don't need to enter any keys if this option is enabled.`, esgst.sks_exportKeys);
        sks.results = insertHtml(sks.popup.scrollable, `beforeEnd`, `<div></div>`);
        sks.popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-search`, `fa-times`, `Search`, `Cancel`, searchSksGiveaways.bind(null, sks), cancelSksSearch.bind(null, sks)).set);
        sks.progress = insertHtml(sks.popup.description, `beforeEnd`, `<div></div>`);
    }
    sks.popup.open();
}

function searchSksGiveaways(sks, callback) {
    var i, key, keys, n;
    sks.button.classList.add(`esgst-busy`);
    sks.canceled = false;
    sks.count = 0;
    sks.giveaways = {};
    sks.allKeys = [];
    sks.keys = [];
    sks.progress.innerHTML = ``;
    sks.results.innerHTML = ``;
    keys = sks.textArea.value.trim().split(/\n/);
    n = keys.length;
    if ((n > 0 && !esgst.sks_exportKeys) || esgst.sks_exportKeys) {
        for (i = 0, n = keys.length; i < n; ++i) {
            key = keys[i].trim();
            if (key) {
                sks.keys.push(key);
                sks.count += 1;
            }
        }
        sks.textArea.value = sks.keys.join(`\n`);
        getSksGiveaways(document, esgst.currentPage, sks, completeSksSearch.bind(null, sks, callback));
    } else {
        callback();
    }
}

function getSksGiveaways(context, nextPage, sks, callback) {
    var element, elements, giveaways, heading, i, n, unsent, url;
    if (!sks.canceled) {
        sks.popup.reposition();
        if (context) {
            if (nextPage === esgst.currentPage) {
                sks.lastPage = getLastPage(context);
                sks.lastPage = sks.lastPage === 999999999 ? `` : ` of ${sks.lastPage}`;
            }
            sks.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Searching for ${sks.count} keys (page ${nextPage - 1}${sks.lastPage})...</span>
            `;
            giveaways = [];
            elements = context.getElementsByClassName(`trigger-popup--keys`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                giveaways.push({
                    active: Date.now() < (parseInt(element.closest(`.table__row-inner-wrap`).querySelector(`[data-timestamp]`).getAttribute(`data-timestamp`)) * 1e3),
                    code: element.parentElement.querySelector(`[name=code]`).value,
                    name: element.getAttribute(`data-name`)
                });
            }
            n = giveaways.length;
            if (n > 0) {
                checkSksGiveaways(giveaways, 0, n, sks, checkNextSksPage.bind(null, context, nextPage, sks, callback));
            } else {
                checkNextSksPage(context, nextPage, sks, callback);
            }
        } else if (document.getElementsByClassName(`esgst-es-page-${nextPage}}`)[0]) {
            setTimeout(getSksGiveaways, 0, null, ++nextPage, sks, callback);
        } else if (!sks.canceled) {
            request(null, null, false, `/giveaways/created/search?page=${nextPage}`, loadNextSksPage.bind(null, nextPage, sks, callback));
        }
    }
}

function checkSksGiveaways(giveaways, i, n, sks, callback) {
    if (!sks.canceled) {
        if (i < n) {
            request(`xsrf_token=${esgst.xsrfToken}&do=popup_keys&code=${giveaways[i].code}`, null, false, `/ajax.php`, checkSksGiveaway.bind(null, giveaways, i, n, sks, callback));
        } else {
            callback();
        }
    }
}

function checkSksGiveaway(giveaways, i, n, sks, callback, response) {
    var element, heading, j, key;
    heading = DOM.parse(JSON.parse(response.responseText).html).getElementsByClassName(`popup__keys__heading`)[0];
    if (heading && (heading.textContent === `Assigned` || giveaways[i].active)) {
        element = heading.nextElementSibling.nextElementSibling;
        for (j = element.children.length - 1; j >= 0; --j) {
            key = element.children[j].textContent;
            if (sks.keys.indexOf(key) >= 0) {
                sks.giveaways[key] = giveaways[i];
                sks.count -= 1;
            }
            if (esgst.sks_exportKeys) {
                sks.allKeys.push(`${giveaways[i].active ? `[UNASSIGNED] ` : ``}${key} ${giveaways[i].name} https://www.steamgifts.com/giveaway/${giveaways[i].code}/`);
            }
        }
    }
    setTimeout(checkSksGiveaways, 0, giveaways, ++i, n, sks, callback);
}

function checkNextSksPage(context, nextPage, sks, callback) {
    var pagination;
    if (!sks.canceled) {
        if (sks.count > 0 || esgst.sks_exportKeys) {
            pagination = context.getElementsByClassName(`pagination__navigation`)[0];
            if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(getSksGiveaways, 0, null, nextPage, sks, callback);
            } else {
                callback();
            }
        } else {
            callback();
        }
    }
}

function loadNextSksPage(nextPage, sks, callback, response) {
    if (!sks.canceled) {
        setTimeout(getSksGiveaways, 0, DOM.parse(response.responseText), ++nextPage, sks, callback);
    }
}

function completeSksSearch(sks, callback) {
    var anchor, found, giveaway, i, key, n, notFound, url;
    found = [];
    notFound = [];
    for (i = 0, n = sks.keys.length; i < n; ++i) {
        key = sks.keys[i];
        giveaway = sks.giveaways[key];
        if (giveaway) {
            found.push(`<li>${giveaway.active ? `[UNASSIGNED] ` : ``}${key} (<a href="/giveaway/${giveaway.code}/">${giveaway.name}</a>)</li>`);
        } else {
            notFound.push(`<li>${key}</li>`);
        }
    }
    n = found.length;
    if (n > 0) {
        sks.results.insertAdjacentHTML(`beforeEnd`, `
            <div class="markdown">
                <div>
                    <span class="esgst-bold">Found ${n} keys:</span>
                </div>
                <ul>
                    ${found.join(``)}
                </ul>
            </div>
        `);
    }
    n = notFound.length;
    if (n > 0) {
        sks.results.insertAdjacentHTML(`beforeEnd`, `
            <div class="markdown">
                <div>
                    <span class="esgst-bold">Did not find ${n} keys:</span>
                </div>
                <ul>
                    ${notFound.join(``)}
                </ul>
            </div>
        `);
    }
    if (esgst.sks_exportKeys) {
        anchor = document.createElement(`a`);
        anchor.download = `esgst_sks_keys_${new Date().toISOString()}.txt`;
        url = URL.createObjectURL(new Blob([sks.allKeys.join(`\r\n`)]));
        anchor.href = url;
        document.body.appendChild(anchor);
        anchor.click();
        anchor.remove();
        URL.revokeObjectURL(url);
    }
    sks.progress.innerHTML = ``;
    sks.popup.reposition();
    sks.button.classList.remove(`esgst-busy`);
    callback();
}

function cancelSksSearch(sks) {
    sks.canceled = true;
    sks.button.classList.remove(`esgst-busy`);
    sks.progress.innerHTML = ``;
}

/* [ET] Entries Tracker */

function getEtEntries(context) {
    var elements, i, n;
    elements = context.querySelectorAll(`.table__remove-default:not(.is-hidden)`);
    for (i = 0, n = elements.length; i < n; ++i) {
        setEtObserver(elements[i]);
    }
}

function setEtObserver(element) {
    var code, container, heading, name;
    container = element.closest(`.table__row-inner-wrap`);
    heading = container.getElementsByClassName(`table__column__heading`)[0];
    code = heading.getAttribute(`href`).match(/\/giveaway\/(.+?)\//)[1];
    name = heading.firstChild.textContent.trim().match(/(.+?)(\s\(.+\sCopies\))?$/)[1];
    element.addEventListener(`click`, setEtEntry.bind(null, code, false, name));
}

function setEtEntry(code, entry, name) {
    var entries;
    entries = JSON.parse(getValue(`entries`, `[]`));
    entries.push({
        code: code,
        entry: entry,
        name: name,
        timestamp: Date.now()
    });
    setValue(`entries`, JSON.stringify(entries));
}

/* [GM] Giveaways Manager */

function enableGm(giveaways) {
    var checkbox, giveaway, giveaways, i, n;
    if (!giveaways) {
        giveaways = esgst.currentGiveaways;
    }
    for (i = 0, n = giveaways.length; i < n; ++i) {
        giveaway = giveaways[i];
        if (!giveaway.innerWrap.getElementsByClassName(`esgst-gm-checkbox`)[0]) {
            checkbox = new Checkbox(insertHtml(giveaway.innerWrap, `afterBegin`, `
                <div class="esgst-gm-checkbox"></div>
            `));
            checkbox.onEnabled = selectGmGiveaway.bind(null, giveaway, true);
            checkbox.onDisabled = selectGmGiveaway.bind(null, giveaway, false);
            esgst.gmCheckboxes[giveaway.code] = checkbox;
        }
    }
}

function selectGmGiveaway(giveaway, value) {
    giveaway.gm = value;
}

function disableGm(giveaways) {
    var checkbox, giveaway, giveaways, i, n;
    esgst.gmCheckboxes = {};
    if (!giveaways) {
        giveaways = esgst.currentGiveaways;
    }
    for (i = 0, n = giveaways.length; i < n; ++i) {
        giveaway = giveaways[i];
        checkbox = giveaway.innerWrap.getElementsByClassName(`esgst-gm-checkbox`)[0];
        if (checkbox) {
            checkbox.remove();
        }
        giveaway.gm = false;
    }
}

function openGmPopout(giveaways, gm) {
    var checkboxContext, checkbox, textArea, toggleSwitch;
    if (!gm.popout) {
        gm.popout = new Popout(`esgst-gm-popout`, gm.button, 0, true);
        gm.popout.popout.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle`, `fa-circle-o-notch fa-spin`, `Select All`, ``, selectSwitches.bind(null, esgst.gmCheckboxes, `check`)).set);
        gm.popout.popout.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle-o`, `fa-circle-o-notch fa-spin`, `Select None`, ``, selectSwitches.bind(null, esgst.gmCheckboxes, `uncheck`)).set);
        gm.popout.popout.appendChild(new ButtonSet(`grey`, `grey`, `fa-dot-circle-o`, `fa-circle-o-notch fa-spin`, `Select Inverse`, ``, selectSwitches.bind(null, esgst.gmCheckboxes, `toggle`)).set);
        gm.popout.popout.appendChild(new ButtonSet(`green`, ``, `fa-search`, ``, `Search & Replace`, ``, openGmPopup.bind(null, giveaways, gm)).set);
        gm.popout.popout.appendChild(new ButtonSet(`green`, `grey`, `fa-puzzle-piece`, `fa-circle-o-notch fa-spin`, `Export to Encrypted Giveaways`, `Exporting...`, exportGmEncrypted.bind(null, giveaways, gm)).set);
        gm.popout.popout.appendChild(new ButtonSet(`green`, `grey`, `fa-globe`, `fa-circle-o-notch fa-spin`, `Export to Links`, `Exporting...`, exportGmLinks.bind(null, giveaways, gm)).set);
        gm.popout.popout.appendChild(new ButtonSet(`green`, `grey`, `fa-pencil`, `fa-circle-o-notch fa-spin`, `Export to Custom Format`, `Exporting...`, exportGmCustom.bind(null, giveaways, gm)).set);
        createTooltip(insertHtml(gm.popout.popout, `beforeEnd`, `
            <div class="esgst-description">
                Enter the custom format below. <i class="fa fa-question-circle"></i>
            </div>
        `).lastElementChild, `
            <div>Delimit the line to be replaced and duplicated (in case of more than one giveaways selected) with [LINE][/LINE]. Use [TYPE] for "app" or "sub", [ID] for the app/sub id, [STEAM] for the Steam store URL, [NAME] for the game name, [CODE] for the giveaway code, [SHORT-URL] for the giveaway URL without the game name (https://www.steamgifts.com/giveaway/XXXXX/), [URL] for the full giveaway URL (https://www.steamgifts.com/giveaway/XXXXX/game-name), [POINTS] for the points and [LEVEL] for the level.</div>
            <br/>
            <div>[POINTS] and [LEVEL] only work if Created/Entered/Won Giveaway Details is enabled and the details have been loaded in the current page.</div>
            <br/>
            <div>For example, the following format would result in a table:</div>
            <br/>
            <div>Steam | Giveaway | Points | Level | Steam Store<br/>:-: | :-: | :-: | :-:<br/>[LINE][[NAME]]([STEAM]) | [SHORT-URL] | [POINTS]P | [LEVEL]+[/LINE]</div>
        `);
        gm.textArea = insertHtml(gm.popout.popout, `beforeEnd`, `<textarea></textarea>`);
        if (esgst.cfh) {
            addCFHPanel(gm.textArea);
        }
        gm.message = insertHtml(gm.popout.popout, `beforeEnd`, `<div class="esgst-description"></div>`);
        gm.popout.popout.appendChild(new ButtonSet(`grey`, `grey`, `fa-copy`, `fa-circle-o-notch fa-spin`, `Copy`, `Copying...`, copyGmOutput.bind(null, gm)).set);
    }
}

function openGmPopup(giveaways, gm, callback) {
    callback();
    if (!gm.popup) {
        gm.popup = new Popup(`fa-search`, `Search & Replace`);
        new ToggleSwitch(insertHtml(gm.popup.description, `afterBegin`, `<div></div>`), `gm_useRegExp`, false, `Use <a class="esgst-bold" href="https://developer.mozilla.org/en/docs/Web/JavaScript/Guide/Regular_Expressions">regular expression</a>.`, false, false, null, esgst.gm_useRegExp);
        gm.replace = insertHtml(gm.popup.description, `afterBegin`, `Replace with: <input type="text">`);
        gm.message = insertHtml(gm.popup.description, `afterBegin`, `<div class="esgst-description esgst-warning"></div>`);
        gm.search = insertHtml(gm.popup.description, `afterBegin`, `Search for: <input type="text">`);
        gm.results = insertHtml(gm.popup.scrollable, `beforeEnd`, `<div class="markdown"><ul></ul></div>`).firstElementChild;
        gm.popup.description.appendChild(new ButtonSet(`green`, `red`, `fa-search`, `fa-times`, `Search & Replace`, `Cancel`, startGmSearch.bind(null, giveaways, gm), cancelGmSearch.bind(null, gm)).set);
        gm.progress = insertHtml(gm.popup.description, `beforeEnd`, `<div></div>`);
    }
    gm.popup.open();
}

function startGmSearch(giveaways, gm, callback) {
    var giveaway, i, n;
    gm.canceled = false;
    gm.button.classList.add(`esgst-busy`);
    gm.progress.innerHTML = ``;
    gm.giveaways = [];
    if (!giveaways) {
        giveaways = esgst.currentGiveaways;
    }
    for (i = 0, n = giveaways.length; i < n; ++i) {
        giveaway = giveaways[i];
        if (giveaway.gm) {
            gm.giveaways.push(giveaway);
        }
    }
    if (esgst.gm_useRegExp) {
        try {
            parts = gm.search.value.match(/^\/(.+)\/(.*)$/);
            gm.searchValue = new RegExp(parts[1], parts[2]);
            gm.replaceValue = gm.replace.value;
            gm.message.textContent = ``;
            searchGmGiveawaysAndReplace(gm, 0, gm.giveaways.length, cancelGmSearch.bind(null, gm, callback));
        } catch (error) {
            cancelGmSearch(gm, callback);
            gm.message.textContent = `Invalid regular expression!`;
        }
    } else {
        gm.searchValue = gm.search.value;
        gm.replaceValue = gm.replace.value;
        searchGmGiveawaysAndReplace(gm, 0, gm.giveaways.length, cancelGmSearch.bind(null, gm, callback));
    }
}

function searchGmGiveawaysAndReplace(gm, i, n, callback) {
    var description, giveaway, match, responseJson;
    if (!gm.canceled) {
        if (i < n) {
            gm.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Searching & replacing (${i + 1} of ${n})</span>
            `;
            giveaway = gm.giveaways[i];
            request(null, null, false, giveaway.url, function (response) {
                description = DOM.parse(response.responseText).querySelector(`.page__description textarea[name=description]`);
                if (description) {
                    match = description.value.match(gm.searchValue);
                    if (match) {
                        request(`xsrf_token=${esgst.xsrfToken}&do=edit_giveaway_description&giveaway_id=${description.previousElementSibling.value}&description=${encodeURIComponent(description.value.replace(gm.searchValue, gm.replaceValue))}`, null, false, `/ajax.php`, function (response) {
                            responseJson = JSON.parse(response.responseText);
                            if (responseJson.type === `success`) {
                                gm.results.insertAdjacentHTML(`beforeEnd`, `<li>Found and replaced in <a href="${giveaway.url}">${giveaway.name}</a></li>`);
                                gm.popup.reposition();
                                setTimeout(searchGmGiveawaysAndReplace, 0, gm, ++i, n, callback);
                            } else {
                                gm.results.insertAdjacentHTML(`beforeEnd`, `<li>Found, but failed to replace, in <a href="${giveaway.url}">${giveaway.name}</a></li>`);
                                gm.popup.reposition();
                                setTimeout(searchGmGiveawaysAndReplace, 0, gm, ++i, n, callback);
                            }
                        });
                    } else {
                        gm.results.insertAdjacentHTML(`beforeEnd`, `<li>Not found in <a href="${giveaway.url}">${giveaway.name}</a></li>`);
                        gm.popup.reposition();
                        setTimeout(searchGmGiveawaysAndReplace, 0, gm, ++i, n, callback);
                    }
                } else {
                    gm.results.insertAdjacentHTML(`beforeEnd`, `<li>Not found in <a href="${giveaway.url}">${giveaway.name}</a></li>`);
                    gm.popup.reposition();
                    setTimeout(searchGmGiveawaysAndReplace, 0, gm, ++i, n, callback);
                }
            });
        } else {
            callback();
        }
    }
}

function cancelGmSearch(gm, callback) {
    gm.canceled = true;
    gm.progress.innerHTML = ``;
    gm.button.classList.remove(`esgst-busy`);
    if (callback) {
        callback();
    }
}

function exportGmEncrypted(giveaways, gm, callback) {
    var encrypted, giveaway, i, n;
    encrypted = [];
    if (!giveaways) {
        giveaways = esgst.currentGiveaways;
    }
    for (i = 0, n = giveaways.length; i < n; ++i) {
        giveaway = giveaways[i];
        if (giveaway.gm) {
            encrypted.push(`[](ESGST-${encryptGedCode(giveaway.code)})`);
        }
    }
    gm.textArea.value = encrypted.join(` `);
    callback();
}

function exportGmLinks(giveaways, gm, callback) {
    var giveaway, i, links, n;
    links = [];
    if (!giveaways) {
        giveaways = esgst.currentGiveaways;
    }
    for (i = 0, n = giveaways.length; i < n; ++i) {
        giveaway = giveaways[i];
        if (giveaway.gm) {
            links.push(`[${giveaway.name}](https://www.steamgifts.com/giveaway/${giveaway.code}/)`);
        }
    }
    gm.textArea.value = links.join(`\n`);
    callback();
}

function exportGmCustom(giveaways, gm, callback) {
    var giveaway, i, links, n;
    links = [];
    line = gm.textArea.value.match(/\[LINE\](.+)\[\/LINE\]/)[1];
    if (!giveaways) {
        giveaways = esgst.currentGiveaways;
    }
    for (i = 0, n = giveaways.length; i < n; ++i) {
        giveaway = giveaways[i];
        if (giveaway.gm) {
            links.push(line.replace(/\[TYPE\]/g, giveaway.type.slice(0, -1)).replace(/\[ID\]/g, giveaway.id).replace(/\[STEAM\]/g, `http://store.steampowered.com/${giveaway.type.slice(0, -1)}/${giveaway.id}`).replace(/\[NAME\]/g, giveaway.name).replace(/\[CODE\]/g, giveaway.code).replace(/\[SHORT-URL\]/g, `https://www.steamgifts.com/giveaway/${giveaway.code}/`).replace(/\[URL\]/g, `https://www.steamgifts.com${giveaway.url}`).replace(/\[POINTS\]/g, giveaway.points).replace(/\[LEVEL\]/g, giveaway.level));
        }
    }
    gm.textArea.value = gm.textArea.value.replace(/\[LINE\].+\[\/LINE\]/, links.join(`\n`));
    callback();
}

function copyGmOutput(gm, callback) {
    gm.textArea.select();
    document.execCommand(`copy`);
    callback();
    createFadeMessage(gm.message, `Copied!`);
}

/* [HGR] Hidden Games Remover */

function openHgrPopup(hgr) {
    if (!hgr.popup) {
        hgr.popup = new Popup(`fa-times`, `Remove owned games:`);
        hgr.set = new ButtonSet(`green`, `grey`, `fa-arrow-circle-right`, `fa-times`, `Remove`, `Cancel`, startHgrRemover.bind(null, hgr), stopHgrRemover.bind(null, hgr));
        hgr.popup.description.appendChild(hgr.set.set);
        hgr.progress = insertHtml(hgr.popup.description, `beforeEnd`, `<div></div>`);
        hgr.removed = insertHtml(hgr.popup.scrollable, `beforeEnd`, `<div class="markdown"></div>`);
    }
    hgr.popup.open();
}

function startHgrRemover(hgr, callback) {
    hgr.canceled = false;
    hgr.button.classList.add(`esgst-busy`);
    hgr.progress.innerHTML = `
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <span>Removing games...</span>
    `;
    hgr.removed.innerHTML = `<span class="esgst-bold">Removed Games:</span>`;
    removeHgrGames(null, esgst.currentPage, hgr, 1, `/account/settings/giveaways/filters/search?page=`, completeHgrProcess.bind(null, hgr, callback));
}

function removeHgrGames(context, currentPage, hgr, nextPage, url, callback) {
    var button, element, elements, game, heading, i, info, n, pagination;
    if (!hgr.canceled) {
        if (currentPage === nextPage) {
            context = document;
            ++nextPage;
        }
        while (document.getElementsByClassName(`esgst-es-page-${nextPage}}`)[0]) {
            ++nextPage;
        }
        if (context) {
            if (nextPage === 1) {
                hgr.lastPage = getLastPage(context);
                hgr.lastPage = hgr.lastPage === 999999999 ? `` : ` of ${hgr.lastPage}`;
            } else if (!hgr.lastPage) {
                hgr.lastPage = ``;
            }
            hgr.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Removing games (page ${nextPage - 1}${hgr.lastPage})...</span>
            `;
            elements = context.getElementsByClassName(`table__row-outer-wrap`)
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                info = getGameInfo(element);
                if (info) {
                    game = esgst.games[info.type][info.id];
                    if (game && game.owned) {
                        button = element.getElementsByClassName(`table__remove-default`)[0];
                        if (context === document) {
                            button.click();
                        } else {
                            request(`xsrf_token=${esgst.xsrfToken}&do=remove_filter&game_id=${button.parentElement.querySelector(`[name="game_id"]`).value}`, null, false, `/ajax.php`);
                        }
                        heading = element.getElementsByClassName(`table__column__heading`)[0];
                        hgr.removed.insertAdjacentHTML(`beforeEnd`, `
                            <a href="http://store.steampowered.com/${info.type.slice(0, -1)}/${info.id}">${heading.textContent}</a>
                        `);
                        hgr.popup.reposition();
                    }
                }
            }
            pagination = context.getElementsByClassName(`pagination__navigation`)[0];
            if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(removeHgrGames, 0, null, currentPage, hgr, nextPage, url, callback);
            } else {
                callback();
            }
        } else if (!hgr.canceled) {
            request(null, null, false, `${url}${nextPage}`, getNextHgrPage.bind(null, currentPage, hgr, nextPage, url, callback));
        }
    }
}

function getNextHgrPage(currentPage, hgr, nextPage, url, callback, response) {
    setTimeout(removeHgrGames, 0, DOM.parse(response.responseText), currentPage, hgr, ++nextPage, url, callback);
}

function completeHgrProcess(hgr, callback) {
    hgr.button.classList.remove(`esgst-busy`);
    hgr.progress.innerHTML = ``;
    if (hgr.removed.children.length === 1) {
        hgr.removed.innerHTML = `<span class="esgst-bold">0 games removed.</span>`;
    }
    callback();
}

function stopHgrRemover(hgr) {
    hgr.canceled = true;
    hgr.button.classList.remove(`esgst-busy`);
    hgr.progress.innerHTML = ``;
}

/* [SAL] Steam Activation Links */

function loadSal() {
    if (esgst.wonPath) {
        esgst.endlessFeatures.push(addSalLinks);
        addSalLinks(document);
        esgst.endlessFeatures.push(addSalObservers);
        addSalObservers(document);
    }
}

function addSalObservers(context) {
    var elements, i, n;
    elements = context.getElementsByClassName(`view_key_btn`);
    for (i = 0, n = elements.length; i < n; ++i) {
        addSalObserver(elements[i]);
    }
}

function addSalObserver(button) {
    var context, element, interval, match;
    context = button.closest(`.table__row-outer-wrap`);
    button.addEventListener(`click`, function() {
        interval = setInterval(function() {
            if (!context.contains(button)) {
                clearInterval(interval);
                element = context.querySelector(`[data-clipboard-text]`);
                match = element.getAttribute(`data-clipboard-text`).match(/^[\d\w]{5}(-[\d\w]{5}){2,}$/);
                if (match) {
                    addSalLink(element, match[0]);
                }
            }
        }, 100);
    });
}

function addSalLinks(context) {
    var i, element, elements, match, n;
    elements = context.querySelectorAll(`[data-clipboard-text]`);
    for (i = 0, n = elements.length; i < n; ++i) {
        element = elements[i];
        match = element.getAttribute(`data-clipboard-text`).match(/^[\d\w]{5}(-[\d\w]{5}){2,}$/);
        if (match) {
            addSalLink(element, match[0]);
        }
    }
}

function addSalLink(element, match) {
    var link, textArea;
    if ((element.nextElementSibling && !element.nextElementSibling.classList.contains(`esgst-sal`)) || !element.nextElementSibling) {
        link = insertHtml(element, `afterEnd`, `
            <span></span>
        `);
        switch (esgst.sal_index) {
            case 0:
                insertHtml(link, `beforeEnd`, `
                    <span class="esgst-sal esgst-clickable" title="Activate on Steam (client)">
                        <i class="fa fa-steam"></i>
                    </span>
                `).addEventListener(`click`, function () {
                    textArea = insertHtml(document.body, `beforeEnd`, `
                        <textarea></textarea>
                    `);
                    textArea.value = match;
                    textArea.select();
                    document.execCommand(`copy`);
                    textArea.remove();
                    location.href = `steam://open/activateproduct`;
                });
                break;
            case 1:
                link.insertAdjacentHTML(`beforeEnd`, `
                    <a class="esgst-sal esgst-clickable" href="https://store.steampowered.com/account/registerkey?key=${match}" target="_blank" title="Activate on Steam (browser)">
                        <i class="fa fa-globe"></i>
                    </a>
                `);
                break;
            case 2:
                insertHtml(link, `beforeEnd`, `
                    <span class="esgst-sal esgst-clickable" title="Activate on Steam (client)">
                        <i class="fa fa-steam"></i>
                    </span>
                    <a class="esgst-sal esgst-clickable" href="https://store.steampowered.com/account/registerkey?key=${match}" target="_blank" title="Activate on Steam (browser)">
                        <i class="fa fa-globe"></i>
                    </a>
                `).previousElementSibling.addEventListener(`click`, function () {
                    textArea = insertHtml(document.body, `beforeEnd`, `
                        <textarea></textarea>
                    `);
                    textArea.value = match;
                    textArea.select();
                    document.execCommand(`copy`);
                    textArea.remove();
                    location.href = `steam://open/activateproduct`;
                });
                break;
        }
    }
}

/* [CEWGD] Created/Entered/Won Giveaway Details */

function loadCewgd() {
    if (esgst.createdPath || esgst.enteredPath || esgst.wonPath) {
        esgst.giveawayFeatures.push(getCewgdDetails);
        esgst.endlessFeatures.push(addCewgdHeading);
        addCewgdHeading(document);
    }
}

function addCewgdHeading(context) {
    var table;
    table = context.getElementsByClassName(`table__heading`)[0];
    if (table && !table.getElementsByClassName(`esgst-cewgd-heading`)[0]) {
        ((esgst.gwc || esgst.gwr) && esgst.enteredPath ? table.firstElementChild.nextElementSibling : table.firstElementChild).insertAdjacentHTML(`afterEnd`, `
            <div class="table__column--width-small text-center esgst-cewgd-heading">Type</div>
            <div class="table__column--width-small text-center esgst-cewgd-heading">Level</div>
        `);
    }
}

function getCewgdDetails(giveaways, main) {
    var i, n;
    if (main) {
        var cewgd = {
            count: 0,
            giveaways: [],
            savedGiveaways: JSON.parse(getValue(`giveaways`, `{}`))
        };
        for (i = 0, n = giveaways.length; i < n; ++i) {
            getCewgdDetail(cewgd, giveaways, i);
        }
        setTimeout(checkCewgdComplete.bind(null, cewgd, n));
    }
}

function checkCewgdComplete(cewgd, total) {
    var currentGiveaway, i, key, n, savedGiveaways;
    if (cewgd.count === total) {
        createLock(`giveawayLock`, 300, function (deleteLock) {
            savedGiveaways = JSON.parse(getValue(`giveaways`, `{}`));
            for (i = 0, n = cewgd.giveaways.length; i < n; ++i) {
                currentGiveaway = cewgd.giveaways[i];
                if (savedGiveaways[currentGiveaway.code]) {
                    for (key in currentGiveaway) {
                        savedGiveaways[currentGiveaway.code][key] = currentGiveaway[key];
                    }
                } else {
                    savedGiveaways[currentGiveaway.code] = currentGiveaway;
                }
            }
            setValue(`giveaways`, JSON.stringify(savedGiveaways));
            deleteLock();
        });
    } else {
        setTimeout(checkCewgdComplete.bind(null, cewgd, total));
    }
}

function getCewgdDetail(cewgd, giveaways, i) {
    var code, currentCode, currentGiveaway, currentGiveaways, giveaway, key, responseHtml, savedGiveaways;
        giveaway = giveaways[i];
        code = giveaway.code;
        if (cewgd.savedGiveaways[code] && cewgd.savedGiveaways[code].gameSteamId) {
            addCewgdDetails(giveaway, cewgd.savedGiveaways[code]);
            ++cewgd.count;
        } else {
            request(null, null, false, giveaway.url, function (response) {
                responseHtml = DOM.parse(response.responseText);
                currentGiveaways = getGiveaways(responseHtml, false, response.finalUrl);
                if (currentGiveaways.length) {
                    currentGiveaway = currentGiveaways[0];
                    cewgd.giveaways.push(currentGiveaway);
                    addCewgdDetails(giveaway, currentGiveaway);
                    ++cewgd.count;
                } else {
                    (giveaway.panel || (esgst.gm_enable && esgst.createdPath ? giveaway.innerWrap.firstElementChild.nextElementSibling.nextElementSibling : giveaway.innerWrap.firstElementChild.nextElementSibling)).insertAdjacentHTML(`afterEnd`, `
                        <div class="table__column--width-small text-center">-</div>
                        <div class="table__column--width-small text-center">-</div>
                    `);
                    ++cewgd.count;
                }
            });
        }
}

function addCewgdDetails(giveaway, details) {
    var type;
    giveaway.points = details.points;
    giveaway.level = details.level;
    giveaway.headingName.insertAdjacentHTML(`beforeEnd`, `
        <span>(${details.points}P)</span>
        <a class="giveaway__icon" href="http://store.steampowered.com/${details.gameType.slice(0, -1)}/${details.gameSteamId}">
            <i class="fa fa-steam"></i>
        </a>
    `);
    if (details.inviteOnly) {
        if (details.regionRestricted) {
            type = `Invite + Region`;
        } else {
            type = `Invite`;
        }
    } else if (details.group) {
        if (details.whitelist) {
            if (details.regionRestricted) {
                type = `Group + Whitelist + Region`;
            } else {
                type = `Group + Whitelist`;
            }
        } else if (details.regionRestricted) {
            type = `Group + Region`;
        } else {
            type = `Group`;
        }
    } else if (details.whitelist) {
        if (details.regionRestricted) {
            type = `Whitelist + Region`;
        } else {
            type = `Whitelist`;
        }
    } else if (details.regionRestricted) {
        type = `Region`;
    } else {
        type = `Public`;
    }
    (giveaway.panel || giveaway.innerWrap.firstElementChild.nextElementSibling).insertAdjacentHTML(`afterEnd`, `
        <div class="table__column--width-small text-center">${type}</div>
        <div class="table__column--width-small text-center">${details.level}+</div>
    `);
    if (esgst.enteredPath || esgst.wonPath) {
        giveaway.endTimeColumn.insertAdjacentHTML(`beforeEnd`, `
            by <a class="table__column__secondary-link" href="/user/${details.creator}">${details.creator}</a>
        `);
    }
    if (type.match(/Group/) && esgst.ggl) {
        giveaway.group = true;
        getGglGiveaways([giveaway]);
    }
}

/* [ITADI] Is There Any Deal? Info */

function loadItadi() {
    if (esgst.giveawayPath) {
        esgst.giveawayFeatures.push(getItadiInfo);
    }
}

function getItadiInfo(giveaways, main) {
    var game, games, giveaway, loading, plain;
    if (main) {
        giveaway = giveaways[0];
        if (giveaway) {
            games = JSON.parse(getValue(`games`));
            game = games[giveaway.type][giveaway.id];
            plain = getItadiPlain(giveaway.name);
            if (game && game.itadi && ((esgst.itadi_h && typeof game.itadi.historical !== `undefined`) || !esgst.itadi_h) && (Date.now() - game.itadi.lastCheck < 86400000)) {
                addItadiInfo(game.itadi, plain);
            } else {
                loading = insertHtml(esgst.sidebar, `beforeEnd`, `
                    <h3 class="sidebar__heading">
                        <i class="fa fa-circle-o-notch fa-spin"></i> Loading Is There Any Deal? info...
                    </h3>
                `);
                request(null, null, true, `https://isthereanydeal.com/ajax/game/info?plain=${plain}`, function (infoResponse) {
                    if (esgst.itadi_h) {
                        request(null, null, true, `https://isthereanydeal.com/ajax/game/price?plain=${plain}`, function (priceResponse) {
                            loadItadiInfo(giveaway, infoResponse, loading, plain, priceResponse);
                        });
                    } else {
                        loadItadiInfo(giveaway, infoResponse, loading, plain);
                    }
                });
            }
        }
    }
}

function loadItadiInfo(giveaway, infoResponse, loading, plain, priceResponse) {
    var bundles, current, currentBundle, currentBundles, currentDeal, currentDeals, date, deals, found, games, heading, headings, historical, i, infoHtml, itadi, n, name, parent, priceHtml, tag;
    infoHtml = DOM.parse(infoResponse.responseText);
    deals = [];
    currentDeals = infoHtml.getElementsByClassName(`new`);
    n = currentDeals.length;
    if (n > 0) {
        for (i = 0; i < n; ++i) {
            currentDeal = currentDeals[i];
            deals.push({
                price: currentDeal.textContent,
                source: currentDeal.closest(`.row`).firstElementChild.firstElementChild.textContent
            });
        }
        deals.sort(function (a, b) {
            a = parseFloat(a.price.replace(/(\$|\|\)/, ``));
            b = parseFloat(b.price.replace(/(\$|\|\)/, ``));
            if (a < b) {
                return -1;
            } else if (a > b) {
                return 1;
            } else {
                return 0;
            }
        });
        current = deals[0];
    } else {
        current = null;
    }
    if (esgst.itadi_h && priceResponse) {
        priceHtml = DOM.parse(priceResponse.responseText);
        headings = priceHtml.getElementsByTagName(`th`);
        n = headings.length;
        if (n > 0) {
            found = false;
            for (i = 0; i < n && !found; ++i) {
                heading = headings[i];
                if (heading.textContent === `Lowest price`) {
                    found = true;
                    parent = heading.parentElement;
                    historical = {
                        date: parent.getElementsByClassName(`date`)[0].textContent,
                        price: parent.getElementsByClassName(`primary`)[0].textContent,
                        source: parent.getElementsByClassName(`shopTitle`)[0].textContent
                    };
                }
            }
            if (!found) {
                historical = null;
            }
        } else {
            historical = null;
        }
    } else {
        historical = null;
    }
    bundles = [];
    currentBundles = infoHtml.getElementsByClassName(`bundle-head`);
    n = currentBundles.length;
    if (n > 0) {
        for (i = 0; i < n; ++i) {
            currentBundle = currentBundles[i];
            tag = currentBundle.firstElementChild;
            if (tag.textContent === `bundle`) {
                date = tag.nextElementSibling;
                name = date.nextElementSibling.firstElementChild;
                bundles.push({
                    date: date.textContent.replace(/expired\s/, ``),
                    id: name.getAttribute(`href`).match(/\d+/)[0],
                    name: name.textContent
                });
            }
        }
        if (!bundles.length) {
            bundles = null;
        }
    } else {
        bundles = null;
    }
    itadi = {
        bundles: bundles,
        current: current,
        historical: historical,
        lastCheck: Date.now()
    };
    createLock(`gameLock`, 300, function (deleteLock) {
        games = JSON.parse(getValue(`games`));
        if (!games[giveaway.type][giveaway.id]) {
            games[giveaway.type][giveaway.id] = {};
        }
        games[giveaway.type][giveaway.id].itadi = itadi;
        setValue(`games`, JSON.stringify(games));
        deleteLock();
        loading.remove();
        addItadiInfo(itadi, plain);
    });
}

function addItadiInfo(itadi, plain) {
    var bundle, bundlesHtml, bundlesItem, currentHtml, currentItem, historicalHtml, historicalItem, i, n;
    if (itadi.current) {
        currentItem = `
            <li class="sidebar__navigation__item">
                <a class="sidebar__navigation__item__link" href="https://isthereanydeal.com/#/page:game/info?plain=${plain}">
                    <div class="sidebar__navigation__item__name">${itadi.current.source}</div>
                    <div class="sidebar__navigation__item__underline"></div>
                    <div class="sidebar__navigation__item__count">${itadi.current.price}</div>
                </a>
            </li>
        `;
    } else {
        currentItem = `There are no current deals for this game.`;
    }
    currentHtml = `
        <h3 class="sidebar__heading">Best Current Deal</h3>
        <ul class="sidebar__navigation">
            ${currentItem}
        </ul>
    `;
    if (esgst.itadi_h) {
        if (itadi.historical) {
            historicalItem = `
                <li class="sidebar__navigation__item">
                    <a class="sidebar__navigation__item__link" href="https://isthereanydeal.com/#/page:game/price?plain=${plain}">
                        <div class="sidebar__navigation__item__name">${itadi.historical.source}</div>
                        <div class="sidebar__navigation__item__underline"></div>
                        <div class="sidebar__navigation__item__count">${itadi.historical.price} (${itadi.historical.date})</div>
                    </a>
                </li>
            `;
        } else {
            historicalItem = `There is no price history for this game.`;
        }
        historicalHtml = `
            <h3 class="sidebar__heading">Historical Lowest Price</h3>
            <ul class="sidebar__navigation">
                ${historicalItem}
            </ul>
        `;
    } else {
        historicalHtml = ``;
    }
    if (itadi.bundles) {
        bundlesItem = ``;
        for (i = 0, n = itadi.bundles.length; i < n; ++i) {
            bundle = itadi.bundles[i];
            bundlesItem += `
                <li class="sidebar__navigation__item">
                    <a class="sidebar__navigation__item__link" href="https://isthereanydeal.com/specials/#/filter:id/${bundle.id}">
                        <div class="sidebar__navigation__item__name">${bundle.name}</div>
                        <div class="sidebar__navigation__item__underline"></div>
                        <div class="sidebar__navigation__item__count">${bundle.date}</div>
                    </a>
                </li>
            `;
        }
    } else {
        bundlesItem = `This game has never been in a bundle.`;
    }
    bundlesHtml = `
        <h3 class="sidebar__heading">Bundles</h3>
        <ul class="sidebar__navigation">
            ${bundlesItem}
        </ul>
    `;
    esgst.sidebar.insertAdjacentHTML(`beforeEnd`, `
        ${currentHtml}${historicalHtml}${bundlesHtml}
    `);
}

function getItadiPlain(name) {
    var numbers;
    numbers = [`0`, `i`, `ii`, `iii`, `iv`, `v`, `vi`, `vii`, `viii`, `ix`];
    return name.toLowerCase().replace(/\sthe|the\s/g, ``).replace(/\s/g, ``).replace(/\d/g, function (m) {
        return numbers[m];
    }).replace(/\&/g, `and`).replace(/\+/g, `plus`).replace(/[^\d\w]/g, ``);
}

/* [DKC] Delete Keys Confirmation */

function getDkcLinks(context) {
    var i, link, links, newLink;
    links = context.getElementsByClassName(`form__key-btn-delete`);
    for (i = links.length - 1; i > -1; --i) {
        link = links[i];
        newLink = insertHtml(link, `afterEnd`, `
            <span class="table__column__secondary-link esgst-clickable">Delete</span>
        `);
        link.remove();
        newLink.addEventListener(`click`, createConfirmation.bind(null, `Are you sure you want to delete this key?`, deleteDkcKey.bind(null, newLink), null));
    }
}

function deleteDkcKey(link) {
    var row;
    row = link.closest(`.table__row-inner-wrap`);
    row.getElementsByClassName(`form__key-read`)[0].classList.add(`is-hidden`);
    row.getElementsByClassName(`form__key-loading`)[0].classList.remove(`is-hidden`);
    row.querySelector(`[name="key_value"]`).value = ``;
    row.getElementsByClassName(`form__key-value`)[0].textContent = ``;
    request(`xsrf_token=${esgst.xsrfToken}&do=set_gift_key&key_value=&winner_id=${row.querySelector(`[name="winner_id"]`).value}`, null, false, `/ajax.php`, function () {
        row.getElementsByClassName(`form__key-loading`)[0].classList.add(`is-hidden`);
        row.getElementsByClassName(`form__key-insert`)[0].classList.remove(`is-hidden`);
        row.getElementsByClassName(`js__sent-text`)[0].textContent = `Sent Gift`;
        row.getElementsByClassName(`js__sent-text`)[1].textContent = `Sent Gift`;
    });
}

/* [NPTH] Next/Previous Train Hotkeys */

function loadNpth() {
    var description, element, elements, i, n, next, nextMatch, previous, previousMatch;
    if (esgst.giveawayCommentsPath) {
        description = document.getElementsByClassName(`page__description`)[0];
        if (description) {
            elements = description.querySelectorAll(`[href*="/giveaway/"]`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                previousMatch = element.textContent.toLowerCase().match(/prev|back|less|<|/);
                if (previousMatch) {
                    previous = element;
                } else {
                    nextMatch = element.textContent.toLowerCase().match(/next|forw|more|>|/);
                    if (nextMatch) {
                        next = element;
                    }
                }
            }
            if (previous || next) {
                document.addEventListener(`keydown`, loadNpthGiveaway.bind(null, next, previous));
            }
        }
    }
}

function loadNpthGiveaway(next, previous, event) {
    var referrer;
    if (!event.target.closest(`input, textarea`)) {
        if (event.key === esgst.npth_previousKey) {
            if (previous) {
                if (event.ctrlKey) {
                    open(previous.getAttribute(`href`));
                } else {
                    location.href = previous.getAttribute(`href`);
                }
            } else {
                referrer = document.referrer;
                if (referrer.match(/\/giveaway\//) && ((next && referrer !== next.getAttribute(`href`)) || !next)) {
                    if (event.ctrlKey) {
                        open(referrer);
                    } else {
                        location.href = referrer;
                    }
                } else {
                    createAlert(`No previous link found.`);
                }
            }
        } else if (event.key === esgst.npth_nextKey) {
            if (next) {
                if (event.ctrlKey) {
                    open(next.getAttribute(`href`));
                } else {
                    location.href = next.getAttribute(`href`);
                }
            } else {
                createAlert(`No next link found.`);
            }
        }
    }
}

/* [GE] Giveaways Extractor */

function loadGe() {
    if ((esgst.giveawayCommentsPath && !document.getElementsByClassName(`table--summary`)[0]) || esgst.discussionPath) {
        let ge = {
            button: insertHtml(esgst.hideButtons && esgst.hideButtons_ge ? esgst.leftButtons : esgst.mainPageHeading, `afterBegin`, `
                <div class="esgst-heading-button" title="Extract giveaways">
                    <i class="fa fa-gift"></i>
                    <i class="fa fa-search"></i>
                </div>
            `)
        };
        ge.button.addEventListener(`click`, openGePopup.bind(null, ge));
    }
}

function openGePopup(ge) {
    if (!ge.popup) {
        ge.count = 0;
        ge.total = 0;
        ge.extracted = [];
        ge.bumpLink = ``;
        ge.points = 0;
        ge.isDivided = esgst.gc_gi || esgst.gc_r || esgst.gc_rm || esgst.gc_ea || esgst.gc_tc || esgst.gc_a || esgst.gc_mp || esgst.gc_sc || esgst.gc_l || esgst.gc_m || esgst.gc_dlc || esgst.gc_g;
        ge.popup = new Popup(`fa-gift`, `Extracted giveaways:`);
        ge.results = insertHtml(ge.popup.scrollable, `beforeEnd`, `<div class="esgst-text-left"></div>`);
        if (esgst.gf) {
            let heading = insertHtml(ge.popup.scrollable, `afterBegin`, `
                <div class="page__heading"></div>
            `);
            heading.appendChild(addGfContainer(heading, true));
        }
        ge.set = new ButtonSet(`green`, `grey`, `fa-search`, `fa-times`, `Extract`, `Cancel`, callback => {
            if (ge.callback) {
                ge.results.insertAdjacentHTML(`beforeEnd`, `<div></div>`);
                ge.callback();
            } else {
                ge.isCanceled = false;
                ge.button.classList.add(`esgst-busy`);
                ge.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>${ge.total}</span> giveaways extracted.
                `;
                ge.results.insertAdjacentHTML(`beforeEnd`, `<div></div>`);
                ge.mainCallback = callback;
                let giveaways = getGeGiveaways(ge, document);
                extractGeGiveaways(ge, giveaways, 0, giveaways.length, completeGeExtraction.bind(null, ge, callback));
            }
        }, () => {
            ge.isCanceled = true;
            completeGeExtraction(ge);
        });
        ge.popup.description.appendChild(ge.set.set);
        ge.progress = insertHtml(ge.popup.description, `beforeEnd`, `<div></div>`);
        if (esgst.es_ge) {
            ge.popup.scrollable.addEventListener(`scroll`, () => {
                if (ge.popup.scrollable.scrollTop + ge.popup.scrollable.offsetHeight >= ge.popup.scrollable.scrollHeight && ge.set && !ge.set.busy) {
                    ge.set.trigger();
                }
            });
        }
    }
    ge.popup.open();
}

function extractGeGiveaways(ge, giveaways, i, n, callback) {
    if (!ge.isCanceled) {
        if (i < n) {
            extractGeGiveaway(ge, giveaways[i], setTimeout.bind(null, extractGeGiveaways, 0, ge, giveaways, ++i, n, callback));
        } else {
            callback();
        }
    }
}

function extractGeGiveaway(ge, code, callback) {
    if (!ge.isCanceled) {
        if (ge.isDivided && ge.count === 50) {
            let children, filtered, i;
            ge.mainCallback();
            ge.count = 0;
            loadEndlessFeatures(ge.results.lastElementChild, false, `ge`);
            ge.set.set.firstElementChild.lastElementChild.textContent = `Extract More`;
            ge.progress.firstElementChild.remove();
            ge.popup.reposition();
            ge.callback = extractGeGiveaway.bind(null, ge, code, callback);
            filtered = false;
            children = ge.results.lastElementChild.children;
            for (i = children.length - 1; i > -1 && !filtered; --i) {
                if (children[i].firstElementChild.classList.contains(`esgst-hidden`)) {
                    filtered = true;
                }
            }
            if ((esgst.es_ge && ge.popup.scrollable.scrollHeight <= ge.popup.scrollable.offsetHeight) || filtered) {
                ge.set.trigger();
            }
        } else {
            if (ge.extracted.indexOf(code) < 0) {
                request(null, null, false, `/giveaway/${code}/`, response => {
                    let bumpLink, context, description, giveaway, giveaways, n, responseHtml;
                    responseHtml = DOM.parse(response.responseText);
                    giveaway = buildGiveaway(responseHtml, response.finalUrl);
                    if (giveaway) {
                        giveaway = getGiveawayInfo(insertHtml(ge.results.lastElementChild, `beforeEnd`, giveaway.html).firstElementChild, document, esgst.games).giveaway;
                        esgst.popupGiveaways.push(giveaway);
                        ge.points += giveaway.points;
                    }
                    ge.count += 1;
                    ge.total += 1;
                    ge.progress.innerHTML = `
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        <span>${ge.total}</span> giveaways extracted.
                    `;
                    ge.extracted.push(code);
                    description = responseHtml.getElementsByClassName(`page__description`)[0];
                    context = description || responseHtml;
                    if (!ge.bumpLink) {
                        bumpLink = context.querySelector(`[href*="/discussion/"]`);
                        if (bumpLink) {
                            ge.bumpLink = bumpLink.getAttribute(`href`);
                        }
                    }
                    giveaways = getGeGiveaways(ge, context);
                    n = giveaways.length;
                    if (n > 0) {
                        setTimeout(extractGeGiveaways, 0, ge, giveaways, 0, n, callback);
                    } else {
                        callback();
                    }
                });
            } else {
                callback();
            }
        }
    }
}

function getGeGiveaways(ge, context) {
    let code, elements, giveaways, i, n, url;
    elements = context.querySelectorAll(`[href*="sgtools.info/giveaways/"]`);
    for (i = 0, n = elements.length; i < n; ++i) {
        url = elements[i].getAttribute(`href`);
        code = url.match(/\/giveaways\/(.+)/)[1];
        if (ge.extracted.indexOf(code) < 0) {
            ge.results.insertAdjacentHTML(`afterBegin`, `
                <div>
                    <a href="${url}">${url}</a>
                </div>
            `);
            ge.extracted.push(code);
        }
    }
    ge.popup.reposition();
    giveaways = [];
    elements = context.querySelectorAll(`[href*="/giveaway/"]`);
    for (i = 0, n = elements.length; i < n; ++i) {
        code = elements[i].getAttribute(`href`).match(/\/giveaway\/(.+?)(\/.*)?$/)[1];
        if (ge.extracted.indexOf(code) < 0 && giveaways.indexOf(code) < 0) {
            giveaways.push(code);
        }
    }
    return giveaways;
}

function completeGeExtraction(ge, callback) {
    ge.button.classList.remove(`esgst-busy`);
    ge.progress.firstElementChild.remove();
    if (callback) {
        callback();
    }
    loadEndlessFeatures(ge.results.lastElementChild, false, `ge`);
    let html = `            
        <div class="markdown esgst-text-center">
            ${ge.bumpLink && !esgst.discussionPath ? `
                <h2>
                    <a href="${ge.bumpLink}">Bump</a>
                </h2>
            ` : ``}
            ${ge.points}P required to enter all giveaways.
        </div>
    `;
    ge.results.insertAdjacentHTML(`afterBegin`, html);
    ge.results.insertAdjacentHTML(`beforeEnd`, html);
    ge.set.set.remove();
    ge.set = null;
    ge.popup.reposition();
}

/* [GESL] Giveaway Error Search Links (by Royalgamer06) */

function loadGesl() {
    var name;
    if (esgst.giveawayPath && document.getElementsByClassName(`table--summary`)[0]) {
        name = encodeURIComponent(document.getElementsByClassName(`table__column__secondary-link`)[0].textContent);
        document.getElementsByClassName(`table__row-outer-wrap`)[0].insertAdjacentHTML(`afterEnd`, `
            <div class="table__row-outer-wrap">
                <div class="table__row-inner-wrap">
                    <div class="table__column--width-small">
                        <span class="esgst-bold">Search Links</span>
                    </div>
                    <div class="table__column--width-fill">
                        <a href="https://www.steamgifts.com/giveaways/search?q=${name}" target="_blank" title="Search for active giveaways">
                            <i class="fa"><img src="${esgst.sgIcon}"></i>
                        </a>
                        <a href="http://store.steampowered.com/search/?term=${name}" target="_blank" title="Search on Steam">
                            <i class="fa fa-steam"></i>
                        </a>
                        <a href="https://steamdb.info/search/?a=app&q=${name}" target="_blank" title="Search on SteamDB">
                            <i class="fa"><img src="https://steamdb.info/static/logos/favicon-16x16.png"></i>
                        </a>
                    </div>
                </div>
            </div>
        `);
    }
}

/* [AS] Archive Searcher */

function loadAs(ASButton) {
    var popup, Category, AS;
    Category = location.pathname.match(/^\/archive\/(coming-soon|open|closed|deleted)/);
    popup = new Popup(`fa-folder`, `Search archive${Category ? ` for ${Category[1]} giveaways` : ``}:`);
    popup.TextInput = insertHtml(popup.description, `beforeEnd`, `<input type="text">`);
    AS = {};
    insertHtml(popup.description, `beforeEnd`, `<div></div>`).appendChild(createOptions([{
        check: true,
        description: `Search by AppID.`,
        id: `as_searchAppId`,
        tooltip: `If unchecked, a search by exact title will be performed.`
    }]));
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-search`, `fa-times-circle`, `Search`, `Cancel`, function (Callback) {
        ASButton.classList.add(`esgst-busy`);
        AS.Progress.innerHTML = AS.OverallProgress.innerHTML = AS.Results.innerHTML = ``;
        AS.popup.reposition();
        AS.Canceled = false;
        AS.Query = popup.TextInput.value;
        if (AS.Query) {
            if (esgst.as_searchAppId) {
                AS.Progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Retrieving game title...</span>
                `;
                request(null, null, false, `https://steamcommunity.com/app/${AS.Query}`, function (Response) {
                    var Title;
                    Title = DOM.parse(Response.responseText).getElementsByClassName(`apphub_AppName`)[0];
                    if (Title) {
                        AS.Query = Title.textContent;
                        setASSearch(AS, ASButton, Callback);
                    } else {
                        ASButton.classList.remove(`esgst-busy`);
                        AS.Progress.innerHTML = `
                            <i class="fa fa-times-circle"></i>
                            <span>Game title not found. Make sure you are entering a valid AppID. For example, 229580 is the AppID for Dream (http://steamcommunity.com/app/229580).</span>
                        `;
                        Callback();
                    }
                });
            } else {
                setASSearch(AS, ASButton, Callback);
            }
        } else {
            ASButton.classList.remove(`esgst-busy`);
            AS.Progress.innerHTML = `
                <i class="fa fa-times-circle"></i>
                <span>Please enter a title / AppID.</span>
            `;
            Callback();
        }
    }, function () {
        clearInterval(AS.Request);
        AS.Canceled = true;
        setTimeout(function () {
            AS.Progress.innerHTML = ``;
        }, 500);
        ASButton.classList.remove(`esgst-busy`);
    }).set);
    AS.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    AS.OverallProgress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    AS.Results = insertHtml(popup.scrollable, `beforeEnd`, `<div></div>`);
    AS.popup = popup;
    ASButton.addEventListener(`click`, function () {
        popup.open(function () {
            popup.TextInput.focus();
        });
    });
}

function setASSearch(AS, ASButton, Callback) {
    AS.Query = ((AS.Query.length >= 50) ? AS.Query.slice(0, 50) : AS.Query).toLowerCase();
    searchASGame(AS, `${location.href.match(/(.+?)(\/search.+?)?$/)[1]}/search?q=${encodeURIComponent(AS.Query)}&page=`, 1, function () {
        ASButton.classList.remove(`esgst-busy`);
        AS.Progress.innerHTML = ``;
        Callback();
    });
}

function searchASGame(AS, URL, NextPage, Callback) {
    if (!AS.Canceled) {
        AS.Progress.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <span>Loading page ${NextPage}...</span>
        `;
        request(null, null, true, URL + NextPage, function (Response) {
            var ResponseHTML, Matches, I, N, Title, Pagination;
            ResponseHTML = DOM.parse(Response.responseText);
            Matches = ResponseHTML.getElementsByClassName(`table__row-outer-wrap`);
            for (I = 0, N = Matches.length; I < N; ++I) {
                Title = Matches[I].getElementsByClassName(`table__column__heading`)[0].textContent.match(/(.+?)( \(.+ Copies\))?$/)[1];
                if (Title.toLowerCase() === AS.Query) {
                    AS.Results.appendChild(Matches[I].cloneNode(true));
                    loadEndlessFeatures(AS.Results.lastElementChild);
                    AS.popup.reposition();
                }
            }
            AS.OverallProgress.textContent = `${AS.Results.children.length} giveaways found...`;
            Pagination = ResponseHTML.getElementsByClassName(`pagination__navigation`)[0];
            if (Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                searchASGame(AS, URL, ++NextPage, Callback);
            } else {
                Callback();
            }
        });
    }
}

/* [OADD] Old Active Discussions Design */

function loadOadd() {
    var deals, dealsRows, dealsSwitch, discussions, discussionsRows, discussionsSwitch, elements, i, n, response1Html, response2Html, rows;
    request(null, null, false, `/discussions`, function (response1) {
        request(null, null, false, `/discussions/deals`, function (response2) {
            response1Html = DOM.parse(response1.responseText);
            response2Html = DOM.parse(response2.responseText);
            esgst.activeDiscussions.classList.add(`esgst-oadd`);
            esgst.activeDiscussions.innerHTML = `
                <div>
                    <div class="page__heading">
                        <div class="esgst-heading-button" title="Switch to Deals.">
                            <i class="fa fa-retweet"></i>
                        </div>
                        <div class="page__heading__breadcrumbs">
                            <a href="/discussions">Active Discussions</a>
                        </div>
                        <a class="page__heading__button page__heading__button--green" href="/discussions">
                            More<i class="fa fa-angle-right"></i>
                        </a>
                    </div>
                    <div class="table">
                        <div class="table__heading">
                            <div class="table__column--width-fill">Summary</div>
                            <div class="table__column--width-small text-center">Comments</div>
                            <div class="table__column--width-medium text-right">Last Post</div>
                        </div>
                        <div class="table__rows"></div>
                    </div>
                </div>
                <div class="esgst-hidden">
                    <div class="page__heading">
                        <div class="esgst-heading-button" title="Switch to Discussions.">
                            <i class="fa fa-retweet"></i>
                        </div>
                        <div class="page__heading__breadcrumbs">
                            <a href="/discussions/deals">Active Deals</a>
                        </div>
                        <a class="page__heading__button page__heading__button--green" href="/discussions/deals">
                            More<i class="fa fa-angle-right"></i>
                        </a>
                    </div>
                    <div class="table">
                        <div class="table__heading">
                            <div class="table__column--width-fill">Summary</div>
                            <div class="table__column--width-small text-center">Comments</div>
                            <div class="table__column--width-medium text-right">Last Post</div>
                        </div>
                        <div class="table__rows"></div>
                    </div>
                </div>
            `;
            discussions = esgst.activeDiscussions.firstElementChild;
            deals = discussions.nextElementSibling;
            discussionsSwitch = discussions.firstElementChild.firstElementChild;
            discussionsRows = discussions.lastElementChild.lastElementChild;
            dealsSwitch = deals.firstElementChild.firstElementChild;
            dealsRows = deals.lastElementChild.lastElementChild;
            elements = response1Html.getElementsByClassName(`table__row-outer-wrap`);
            for (i = 0; i < 5; ++i) {
                discussionsRows.appendChild(elements[0]);
            }
            elements = response2Html.getElementsByClassName(`table__row-outer-wrap`);
            for (i = 0; i < 5; ++i) {
                dealsRows.appendChild(elements[0]);
            }
            discussionsSwitch.addEventListener(`click`, function () {
                discussions.classList.add(`esgst-hidden`);
                deals.classList.remove(`esgst-hidden`);
            });
            dealsSwitch.addEventListener(`click`, function () {
                discussions.classList.remove(`esgst-hidden`);
                deals.classList.add(`esgst-hidden`);
            });
            if (esgst.adots) {
                loadAdots();
            }
            loadFeatures();
        });
    });
}

/* [ADOTS] Active Discussions On Top/Sidebar */

function loadAdots() {
    var parent, panel, size, tabHeading1, tabHeading2, activeDiscussions, discussions, deals, element, elements, i, icon, n, comments, parent, panel;
    if (esgst.activeDiscussions) {
        esgst.activeDiscussions.classList.remove(`widget-container--margin-top`);
        esgst.activeDiscussions.classList.add(`esgst-adots`);
        if (esgst.adots_index === 0) {
            parent = esgst.activeDiscussions.parentElement;
            parent.insertBefore(esgst.activeDiscussions, parent.firstElementChild);
        } else {
            if (esgst.ib) {
                size = 45;
            } else {
                size = 35;
            }
            esgst.style.insertAdjacentText(`beforeEnd`, `
                .esgst-adots .table__row-inner-wrap >:first-child {
                    float: left;
                    width: ${size}px;
                    height: ${size}px;
                }
                .esgst-adots .table__row-inner-wrap >:first-child >* {
                    width: ${size}px;
                    height: ${size}px;
                }
                .esgst-adots .table__row-inner-wrap >:last-child {
                    margin-left: ${size + 5}px;
                    text-align: left;
                    width: auto;
                }
                .esgst-adots .table__column--width-fill {
                    margin-left: 5px;
                    vertical-align: top;
                    width: calc(100% - ${size + 15}px);
                }
            `);
            panel = insertHtml(esgst.sidebar, `beforeEnd`, `
                <h3 class="sidebar__heading">
                    <span class="esgst-adots-tab-heading esgst-selected">Discussions</span>
                    <span class="esgst-adots-tab-heading">Deals</span>
                    <a class="esgst-float-right sidebar__navigation__item__name" href="/discussions">More</a>
                </h3>
            `);
            tabHeading1 = panel.firstElementChild;
            tabHeading2 = tabHeading1.nextElementSibling;
            if (esgst.oadd) {
                discussions = esgst.activeDiscussions.firstElementChild;
                deals = esgst.activeDiscussions.lastElementChild;
                discussions.firstElementChild.remove();
                discussions.firstElementChild.firstElementChild.remove();
                deals.firstElementChild.remove();
                deals.firstElementChild.firstElementChild.remove();
                elements = esgst.activeDiscussions.getElementsByClassName(`table__column--last-comment`);
                for (i = 0, n = elements.length; i < n; ++i) {
                    icon = elements[0].getElementsByClassName(`table__last-comment-icon`)[0];
                    if (icon) {
                        icon.classList.add(`esgst-float-right`);
                        elements[0].previousElementSibling.appendChild(icon);
                    }
                    elements[0].remove();
                }
                discussions = discussions.firstElementChild.firstElementChild;
                deals = deals.firstElementChild.firstElementChild;
            } else {
                discussions = esgst.activeDiscussions.firstElementChild.firstElementChild.lastElementChild;
                deals = esgst.activeDiscussions.lastElementChild.firstElementChild.lastElementChild;
                elements = discussions.getElementsByClassName(`table__row-outer-wrap`);
                for (i = 0, n = elements.length; i < n; ++i) {
                    element = elements[i];
                    comments = element.getElementsByClassName(`table__column__secondary-link`)[0];
                    parent = comments.parentElement;
                    panel = insertHtml(parent, `afterEnd`, `<p></p><div style="clear: both;"></div>`);
                    panel.appendChild(comments);
                    parent.lastElementChild.classList.add(`esgst-float-right`);
                    panel.appendChild(parent.lastElementChild);
                    parent.remove();
                }
                elements = deals.getElementsByClassName(`table__row-outer-wrap`);
                for (i = 0, n = elements.length; i < n; ++i) {
                    element = elements[i];
                    comments = element.getElementsByClassName(`table__column__secondary-link`)[0];
                    parent = comments.parentElement;
                    panel = insertHtml(parent, `afterEnd`, `<p></p><div style="clear: both;"></div>`);
                    panel.appendChild(comments);
                    parent.lastElementChild.classList.add(`esgst-float-right`);
                    panel.appendChild(parent.lastElementChild);
                    parent.remove();
                }
            }
            deals.classList.add(`esgst-hidden`, `esgst-adots`);
            discussions.classList.add(`esgst-adots`);
            activeDiscussions = insertHtml(esgst.sidebar, `beforeEnd`, `<div></div>`);
            activeDiscussions.appendChild(discussions);
            activeDiscussions.appendChild(deals);
            tabHeading1.addEventListener(`click`, changeAdotsTab.bind(null, tabHeading1, tabHeading2, discussions, deals));
            tabHeading2.addEventListener(`click`, changeAdotsTab.bind(null, tabHeading2, tabHeading1, deals, discussions));
            esgst.activeDiscussions.remove();
            esgst.activeDiscussions = activeDiscussions;
        }
    }
}

function changeAdotsTab(button1, button2, first, second) {
    button2.classList.remove(`esgst-selected`);
    first.classList.remove(`esgst-hidden`);
    second.classList.add(`esgst-hidden`);
    button1.classList.add(`esgst-selected`);
}

/* [DS] Discussions Sorter */

function loadDs() {
    var ds;
    ds = {};
    ds.button = document.createElement(`div`);
    ds.button.className = `esgst-heading-button`;
    ds.button.title = `Sort discussions`;
    ds.button.innerHTML = `
        <i class="fa fa-sort"></i>
    `;
    ds.button.addEventListener(`click`, openDsPopout.bind(null, ds));
    return ds.button;
}

function openDsPopout(ds) {
    if (!ds.popout) {
        ds.popout = new Popout(`esgst-ds-popout`, ds.button, 0, true);
        ds.toggle = new ToggleSwitch(ds.popout.popout, `ds_auto`, false, `Auto Sort`, false, false, `Automatically sorts the discussions by the selected option when loading the page.`, esgst.ds_auto);
        ds.options = insertHtml(ds.popout.popout, `beforeEnd`, `
            <select>
                <option value="sortIndex_asc">Default</option>
                <option value="title_asc">Title - Ascending</option>
                <option value="title_desc">Title - Descending</option>
                <option value="category_asc">Category - Ascending</option>
                <option value="category_desc">Category - Descending</option>
                <option value="createdTime_asc">Created Time - Ascending</option>
                <option value="createdTime_desc">Created Time - Descending</option>
                <option value="author_asc">Author - Ascending</option>
                <option value="author_desc">Author - Descending</option>
                <option value="comments_asc">Comments - Ascending</option>
                <option value="comments_desc">Comments - Descending</option>
            </select>
        `);
        ds.options.value = esgst.ds_option;
        ds.options.addEventListener(`change`, saveAndSortContent.bind(null, `ds_option`, `currentDiscussions`, ds.options, null));
        ds.popout.popout.appendChild(new ButtonSet(`green`, ``, `fa-arrow-circle-right`, ``, `Sort`, ``, saveAndSortContent.bind(null, `ds_option`, `currentDiscussions`, ds.options)).set);
    }
}

/* [CODB] Close/Open Discussion Button */

function addCodbButtons(discussions) {
    discussions.forEach(discussion => {
        if (discussion.author === esgst.username) {
            if (!discussion.heading.parentElement.getElementsByClassName(`esgst-codb-button`)[0]) {
                if (discussion.closed) {
                    discussion.closed.remove();
                    discussion.closed = true;
                }
                if (discussion.closed) {
                    addCodbOpenButton(null, discussion);
                } else {
                    addCodbCloseButton(null, discussion);
                }
            }
        }
    });
}

function addCodbCloseButton(button, discussion) {
    if (!button) {
        button = insertHtml(discussion.headingContainer.firstElementChild, `beforeBegin`, `
            <div class="esgst-codb-button" title="Close discussion">
                <i class="fa fa-lock"></i>
            </div>
        `);
    }
    button.firstElementChild.addEventListener(`click`, function() {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        request(`xsrf_token=${esgst.xsrfToken}&do=close_discussion`, null, false, discussion.url, response => {
            button.innerHTML = `<i class="fa fa-lock"></i>`;
            if (DOM.parse(response.responseText).getElementsByClassName(`page__heading__button--red`)[0]) {
                button.classList.add(`icon-red`);
                button.title = `Open discussion`;
                addCodbOpenButton(button, discussion);
                discussion.closed = true;
                discussion.innerWrap.classList.add(`is-faded`);
            }
        });
    });
}

function addCodbOpenButton(button, discussion) {
    if (!button) {
        button = insertHtml(discussion.headingContainer.firstElementChild, `beforeBegin`, `
            <div class="esgst-codb-button icon-red" title="Open discussion">
                <i class="fa fa-lock"></i>
            </div>
        `);
    }
    button.firstElementChild.addEventListener(`click`, function() {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        request(`xsrf_token=${esgst.xsrfToken}&do=reopen_discussion`, null, false, discussion.url, response => {
            button.innerHTML = `<i class="fa fa-lock"></i>`;
            if (!DOM.parse(response.responseText).getElementsByClassName(`page__heading__button--red`)[0]) {
                button.classList.remove(`icon-red`);
                button.title = `Close discussion`;
                addCodbCloseButton(button, discussion);
                discussion.closed = false;
                discussion.innerWrap.classList.remove(`is-faded`);
            }
        });
    });
}

/* [DF] Discussion Filters */

function addDfHideButton(discussion, main) {
    var button;
    if (!discussion.heading.parentElement.getElementsByClassName(`esgst-df-button`)[0]) {
        button = insertHtml(discussion.headingContainer.firstElementChild, `beforeBegin`, `
            <div class="esgst-df-button" title="Hide discussion">
                <i class="fa fa-eye-slash"></i>
            </div>
        `);
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            hideDfDiscussion(discussion, function() {
                button.remove();
                if ((esgst.discussionPath && !main) || !esgst.discussionPath) {
                    discussion.outerWrap.remove();
                }
            });
        });
    }
}

function hideDfDiscussion(discussion, callback) {
    createLock(`discussionLock`, 300, function(deleteLock) {
        var discussions;
        discussions = JSON.parse(getValue(`discussions`, `{}`));
        if (!discussions[discussion.code]) {
            discussions[discussion.code] = {};
        }
        discussions[discussion.code].hidden = true;
        setValue(`discussions`, JSON.stringify(discussions));
        deleteLock();
        if (callback) {
            callback();
        }
    });
}

function addDfUnhideButton(discussion, main) {
    var button;
    if (!discussion.heading.parentElement.getElementsByClassName(`esgst-df-button`)[0]) {
        button = insertHtml(discussion.headingContainer.firstElementChild, `beforeBegin`, `
            <div class="esgst-df-button" title="Unhide discussion">
                <i class="fa fa-eye"></i>
            </div>
        `);
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            unhideDfDiscussion(discussion, function() {
                button.remove();
                if ((esgst.discussionPath && !main) || !esgst.discussionPath) {
                    discussion.outerWrap.remove();
                }
            });
        });
    }
}

function unhideDfDiscussion(discussion, callback) {
    createLock(`discussionLock`, 300, function(deleteLock) {
        var discussions;
        discussions = JSON.parse(getValue(`discussions`, `{}`));
        if (discussions[discussion.code]) {
            discussions[discussion.code].hidden = false;
            setValue(`discussions`, JSON.stringify(discussions));
        }
        deleteLock();
        if (callback) {
            callback();
        }
    });
}

function setDfOverride(df, context, key) {
    let button, override;
    button = insertHtml(context, `afterBegin`, `<span class="esgst-gf-override"></span>`);
    df.overrideButtons[key] = {
        change: () => {
            if (typeof df.overrides[key] === `undefined`) {
                df.overrides[key] = 0;
            }
            df.overrideButtons[key].value = df.overrides[key];
            if (df.overrideButtons[key].value) {
                button.innerHTML = `<i class="fa fa-exclamation" title="Click to make this filter overridable"></i>`;
            } else {
                button.innerHTML = `<i class="fa fa-exclamation esgst-faded" title="Click to make this filter non-overridable"></i>`;
            }
        }
    };
    df.overrideButtons[key].change();
    button.addEventListener(`click`, () => {
        df.overrides[key] = df.overrideButtons[key].value ? 0 : 1;
        df.overrideButtons[key].change();
        filterDfDiscussions(df);
    });
}

function addDfContainer(heading) {
    var basicFilter, basicFilters, box, button, categoryFilter, categoryFilters, collapseButton, display, exceptionButton, exceptionCount, exceptionPanel, expandButton, filters, genres, df, headingButton, i, id, infinite, key, maxKey, maxSavedValue, maxValue, minKey, minSavedValue, minValue, name, preset, presetButton, presetDisplay, presetInput, presetMessage, presetPanel, presets, presetWarning, slider, step, toggleSwitch, typeFilter, typeFilters, value;
    headingButton = document.createElement(`div`);
    headingButton.className = `esgst-heading-button esgst-gf-heading-button`;
    headingButton.innerHTML = `
        <span class="esgst-gf-toggle-switch"></span>
        <i class="fa fa-sliders" title="Manage presets"></i>
    `;
    toggleSwitch = new ToggleSwitch(headingButton.firstElementChild, `df_enable`, true, ``, false, false, null, esgst.df_enable);
    esgst.df = df = {};
    toggleSwitch.onEnabled = filterDfDiscussions.bind(null, df);
    toggleSwitch.onDisabled = filterDfDiscussions.bind(null, df, true);
    presetButton = headingButton.lastElementChild;
    df.container = insertHtml(heading, `afterEnd`, `
        <div class="esgst-gf-container">
            <div class="esgst-gf-box">
                <div class="esgst-gf-filters esgst-hidden">
                    <div class="esgst-gf-basic-filters esgst-hidden">
                        <div>
                            <span class="esgst-bold">Basic Filters:</span>
                            <i class="fa fa-question-circle" title="The entries/copies filters are infinite. To increase/decrease their max value, simply enter the new max value into the input field and it will be changed."></i>
                        </div>
                    </div>
                    <div class="esgst-gf-type-filters">
                        <div>
                            <span class="esgst-bold">Type Filters:</span>
                        </div>
                    </div>
                    <div class="esgst-gf-legend-panel">
                        <div>
                            <span class="esgst-bold">Legend:</span>
                            <i class="fa fa-question-circle" title="This legend applies to the type filters, except where noted"></i>
                        </div>
                        <div class="esgst-gf-legend"><i class="fa fa-circle-o"></i> - Hide all.</div>
                        <div class="esgst-gf-legend"><i class="fa fa-circle"></i> - Show only.</div>
                        <div class="esgst-gf-legend"><i class="fa fa-check-circle"></i> - Show all.</div>
                        <div class="esgst-gf-legend"><i class="fa fa-exclamation esgst-faded"></i> - Overridable <i class="fa fa-question-circle" title="Overridable filters can be overridden by exceptions"></i></div>
                        <div class="esgst-gf-legend"><i class="fa fa-exclamation"></i> - Non-Overridable <i class="fa fa-question-circle" title="Non-Overridable filters cannot be overridden by exceptions"></i></div>
                    </div>
                    <div class="esgst-gf-preset-panel">
                        <div>
                            <span class="esgst-bold">Preset:</span>
                        </div>
                        <div>
                            <span></span> exceptions <i class="esgst-clickable fa fa-gear" title="Manage exceptions"></i>
                        </div>
                        <input class="form__input-small" type="text"/>
                        <div class="esgst-description esgst-bold"></div>
                        <div class="form__row__error esgst-hidden">
                            <i class="fa fa-exclamation-circle"></i> Please enter a name for the preset.
                        </div>
                        <div class="esgst-description">The name of the preset.</div>
                    </div>
                </div>
            </div>
            <div class="esgst-gf-button">
                <span>Expand</span><span class="esgst-hidden">Collapse</span> filters (<span>0</span> filtered - <span></span>)
            </div>
        </div>
    `);
    box = df.container.firstElementChild;
    filters = box.firstElementChild;
    basicFilters = filters.firstElementChild;
    typeFilters = basicFilters.nextElementSibling;
    presetPanel = typeFilters.nextElementSibling.nextElementSibling;
    exceptionPanel = presetPanel.firstElementChild.nextElementSibling;
    exceptionCount = exceptionPanel.firstElementChild;
    exceptionButton = exceptionCount.nextElementSibling;
    presetInput = exceptionPanel.nextElementSibling;
    presetMessage = presetInput.nextElementSibling;
    presetWarning = presetMessage.nextElementSibling;
    presetPanel.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save Preset`, `Saving...`, saveDfPreset.bind(null, df, presetInput, presetMessage, presetWarning)).set);
    button = box.nextElementSibling;
    expandButton = button.firstElementChild;
    collapseButton = expandButton.nextElementSibling;
    button.addEventListener(`click`, toggleGfFilters.bind(null, collapseButton, expandButton, filters));
    df.filteredCount = collapseButton.nextElementSibling;
    df.paginationFilteredCount = insertHtml(esgst.pagination.firstElementChild, `beforeEnd`, `
        <span>
            (<span class="esgst-bold">0</span> filtered by Discussion Filters)
        </span>
    `).firstElementChild;
    presetDisplay = df.filteredCount.nextElementSibling;
    presetButton.addEventListener(`click`, openDfPresetPopup.bind(null, df, exceptionCount, presetDisplay, presetInput));
    name = esgst[`df_preset`];
    if (name) {
        presets = JSON.parse(getValue(`dfPresets`, `[]`));
        for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
        if (i >= 0) {
            preset = presets[i];
            presetDisplay.textContent = presetInput.value = name;
        } else {
            preset = null;
        }
    }
    if (!preset) {
        name = `Default`;
        preset = { name };
        [`maxComments`, `minComments`, `announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`].forEach(key => {
            preset[key] = esgst.settings[`df_${key}`];
        });
        presets = JSON.parse(getValue(`dfPresets`, `[]`));
        presets.push(preset);
        setValue(`dfPresets`, JSON.stringify(presets));
        setSetting(`df_preset`, name);
        presetDisplay.textContent = presetInput.value = name;
    }
    if (preset.exceptions) {
        df.exceptions = preset.exceptions;
        exceptionCount.textContent = preset.exceptions.length;
    } else {
        exceptionCount.textContent = 0;
    }
    df.overrides = preset.overrides || {};
    df.overrideButtons = {};
    exceptionButton.addEventListener(`click`, openDfExceptionPopup.bind(null, exceptionCount, df, presetInput));
    basicFilters.classList.remove(`esgst-hidden`);
    [ { check: true, infinite: true, maxValue: 999999, minValue: 0, name: `Comments` }
    ].forEach(filter => {
        if (filter.check) {
            name = filter.name;
            maxKey = `max${name}`;
            maxValue = filter.maxValue;
            minKey = `min${name}`;
            minValue = filter.minValue;
            key = name.toLowerCase();
            if (esgst[`df_${key}`]) {
                infinite = filter.infinite;
                maxSavedValue = preset[maxKey] || maxValue;
                minSavedValue = preset[minKey] || minValue;
                step = filter.step || 1;
                if (!infinite && maxSavedValue > maxValue) {
                    maxSavedValue = maxValue;
                }
                df[maxKey] = maxSavedValue;
                df[minKey] = minSavedValue;
                basicFilter = insertHtml(basicFilters, `beforeEnd`, `
                    <div class="esgst-gf-basic-filter">
                        <div>${name} <span class="esgst-float-right"><input type="text" value="${minSavedValue}"> - <input type="text" value="${maxSavedValue}"></span></div>
                        <div></div>
                    </div>
                `);
                display = basicFilter.firstElementChild;
                setDfOverride(df, display, key);
                slider = display.nextElementSibling;
                df[`${minKey}Input`] = display.firstElementChild.nextElementSibling.firstElementChild;
                df[`${maxKey}Input`] = df[`${minKey}Input`].nextElementSibling;
                df[`${maxKey}Input`].addEventListener(`change`, changeGfMaxValue.bind(null, infinite, slider, step));
                df[`${minKey}Input`].addEventListener(`change`, changeGfMinValue.bind(null, slider, step));
                if (infinite) {
                    maxValue = maxSavedValue;
                }
                $(slider).slider({
                    change: changeDfSlider.bind(null, df, maxKey, minKey),
                    min: minValue,
                    max: maxValue,
                    range: true,
                    slide: slideGfSlider.bind(null, df, maxKey, minKey),
                    step: step,
                    values: [minSavedValue, maxSavedValue]
                });
            } else {
                df[maxKey] = maxValue;
                df[minKey] = minValue;
            }
        }
    });
    if (basicFilters.children.length === 1) {
        basicFilters.classList.add(`esgst-hidden`);
    }
    [ { check: true, key: `announcements`, name: `Announcements` },
        { check: true, key: `bugs_suggestions`, name: `Bugs / Suggestion` },
        { check: true, key: `deals`, name: `Deals` },
        { check: true, key: `general`, name: `General` },
        { check: true, key: `groupRecruitment`, name: `Group Recruitment` },
        { check: true, key: `letsPlayTogether`, name: `Let's Play Together` },
        { check: true, key: `offTopic`, name: `Off-Topic` },
        { check: true, key: `puzzles`, name: `Puzzles` },
        { check: true, key: `uncategorized`, name: `Uncategorized` },
        { check: true, key: `created`, name: `Created` },
        { check: true, key: `poll`, name: `Poll` },
        { check: esgst.dh, key: `highlighted`, name: `Highlighted` },
        { check: esgst.gdttt, key: `visited`, name: `Visited` },
        { check: esgst.ct, key: `unread`, name: `Unread` }
    ].forEach(filter => {
        if (filter.check) {
            key = filter.key;
            if (esgst[`df_${key}`]) {
                name = filter.name;
                typeFilter = insertHtml(typeFilters, `beforeEnd`, `
                    <div class="esgst-gf-type-filter">
                        <span>${name}</span>
                    </div>
                `);
                value = preset[key] || `enabled`;
                df[key] = value;
                df[`${key}Checkbox`] = new Checkbox(typeFilter, value, true);
                setDfOverride(df, typeFilter, key);
                df[`${key}Checkbox`].checkbox.addEventListener(`click`, changeDfValue.bind(null, df[`${key}Checkbox`], df, key));
            } else {
                df[key] = `enabled`;
            }
        }
    });
    if (typeFilters.children.length === 1) {
        typeFilters.classList.add(`esgst-hidden`);
    }
    return headingButton;
}

function changeDfSlider(df, maxKey, minKey, event, ui) {
    df[maxKey] = ui.values[1];
    df[minKey] = ui.values[0];
    filterDfDiscussions(df);
}

function changeDfValue(context, df, key) {
    df[key] = context.value;
    filterDfDiscussions(df);
}

function saveDfPreset(df, presetInput, presetMessage, presetWarning, callback) {
    var exceptions, name, preset, presets;
    name = presetInput.value;
    if (name) {
        presetWarning.classList.add(`esgst-hidden`);
        preset = { name };
        [`maxComments`, `minComments`, `announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`].forEach(key => {
            if (typeof df[key] !== `undefined`) {
                preset[key] = df[key];
            }
        });
        preset.overrides = df.overrides;
        presets = JSON.parse(getValue(`dfPresets`, `[]`));
        for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
        if (i >= 0) {
            exceptions = presets[i].exceptions;
            if (exceptions) {
                preset.exceptions = exceptions;
            }
            presets[i] = preset;
        } else {
            presets.push(preset);
        }
        setValue(`dfPresets`, JSON.stringify(presets));
        setSetting(`df_preset`, name);
        createFadeMessage(presetMessage, `Saved!`);
        callback();
    } else {
        presetWarning.classList.remove(`esgst-hidden`);
        callback();
    }
}

function openDfPresetPopup(df, exceptionCount, presetDisplay, presetInput) {
    var deleted, details, heading, hideAll, popup, preset, renameButton, renameInput, row, showOnly, table, undoButton;
    popup = new Popup(`fa-sliders`, `Manage presets:`, true);
    popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-description">To edit a preset, apply it and save it with the same name. To rename a preset, click the edit icon, enter the new name and hit "Enter". Drag and drop presets to move them.</div>`);
    deleted = [];
    undoButton = insertHtml(popup.description, `beforeEnd`, `
        <div class="esgst-clickable esgst-hidden">
            <i class="fa fa-rotate-left"></i>
            <span>Undo Delete</span>
        </div>
    `);
    undoButton.addEventListener(`click`, undoDfDeletePreset.bind(null, deleted, undoButton));
    table = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left popup__keys__list"></div>`);
    JSON.parse(getValue(`dfPresets`, `[]`)).forEach(preset => {
        details = ``;
        [ { key: `Comments`, name: `comments` }
        ].forEach(filter => {
            if (typeof preset[`max${filter.key}`] !== `undefined`) {
                details += `${preset[`min${filter.key}`]}-${preset[`max${filter.key}`]} ${filter.name}, `;
            }
        });
        hideAll = [];
        showOnly = [];
        [ { key: `announcements`, name: `announcements` },
            { key: `bugs_suggestions`, name: `bugs / suggestions` },
            { key: `deals`, name: `deals` },
            { key: `general`, name: `general` },
            { key: `groupRecruitment`, name: `group recruitment` },
            { key: `letsPlayTogether`, name: `let's play together` },
            { key: `offTopic`, name: `off-topic` },
            { key: `puzzles`, name: `puzzles` },
            { key: `uncategorized`, name: `uncategorized` },
            { key: `created`, name: `created` },
            { key: `poll`, name: `poll`},
            { key: `highlighted`, name: `highlighted` },
            { key: `visited`, name: `visited` },
            { key: `unread`, name: `unread` }
        ].forEach(key => {
            if (preset[key.key] === `disabled`) {
                hideAll.push(key.name);
            } else if (preset[key.key] === `none`) {
                showOnly.push(key.name);
            }
        });
        if (hideAll.length > 0) {
            details += `hide: ${hideAll.join(` & `)}, `;
        }
        if (showOnly.length > 0) {
            details += `only show: ${showOnly.join(` & `)}, `;
        }
        row = insertHtml(table, `beforeEnd`, `
            <div ${presetInput.value === preset.name ? `class="esgst-green-highlight"` : ``} draggable="true">
                <div class="esgst-float-left">
                    <input class="esgst-hidden" type="text" value="${preset.name}"/>
                    <strong class="esgst-clickable">${preset.name}</strong>
                </div>
                <div class="esgst-clickable esgst-float-right">
                    <i class="fa fa-edit" title="Rename preset"></i>
                    <span title="Delete preset">
                        <i class="fa fa-trash"></i>
                    </span>
                </div>
                <div class="esgst-clear"></div>
                <div class="esgst-description">${details.slice(0, -2)}</div>
            </div>
        `);
        row.addEventListener(`dragstart`, setDfSource.bind(null, df, preset, row));
        row.addEventListener(`dragenter`, getGfSource.bind(null, df, row, table));
        row.addEventListener(`dragend`, saveDfSource.bind(null, df));
        renameInput = row.firstElementChild.firstElementChild;
        heading = renameInput.nextElementSibling;
        renameInput.addEventListener(`keypress`, renameDfPreset.bind(null, heading, preset, presetDisplay, presetInput));
        heading.addEventListener(`click`, applyDfPreset.bind(null, df, exceptionCount, popup, preset, presetDisplay, presetInput));
        renameButton = row.firstElementChild.nextElementSibling.firstElementChild;
        renameButton.addEventListener(`click`, showGfRenameInput.bind(null, heading, renameInput));
        renameButton.nextElementSibling.addEventListener(`click`, deleteDfPreset.bind(null, deleted, preset, row, undoButton));
    });
    popup.open();
}

function setDfSource(df, preset, row) {
    var i, presets;
    df.source = row;
    presets = JSON.parse(getValue(`dfPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
    df.sourceIndex = i;
}

function saveDfSource(df) {
    var presets;
    presets = JSON.parse(getValue(`dfPresets`, `[]`));
    presets.splice(df.sourceNewIndex, 0, presets.splice(df.sourceIndex, 1)[0]);
    setValue(`dfPresets`, JSON.stringify(presets));
}

function applyDfPreset(df, exceptionCount, popup, preset, presetDisplay, presetInput) {
    var checkbox, input, key;
    [`maxComments`, `minComments`, `announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`].forEach(key => {
        checkbox = df[`${key}Checkbox`];
        if (checkbox) {
            if (checkbox.isThreeState) {
                df[key] = checkbox.value = preset[key];
                checkbox.change(false, df[key]);
            } else {
                if (preset[key]) {
                    df[key] = true;
                    checkbox.check();
                } else {
                    df[key] = false;
                    checkbox.uncheck();
                }
            }
        } else {
            input = df[`${key}Input`];
            if (input) {
                df[key] = input.value = preset[key];
                input.dispatchEvent(new Event(`change`));
            }
        }
    });
    presetDisplay.textContent = presetInput.value = preset.name;
    if (preset.exceptions) {
        df.exceptions = preset.exceptions;
        exceptionCount.textContent = preset.exceptions.length;
    } else {
        exceptionCount.textContent = 0;
    }
    gf.overrides = preset.overrides || {};
    for (key in gf.overrideButtons) {
        gf.overrideButtons[key].change();
    }
    setSetting(`df_preset`, preset.name);
    popup.close();
    filterDfDiscussions(df);
}

function renameDfPreset(heading, preset, presetDisplay, presetInput, event) {
    var i, newName, oldName, presets;
    if (event.key === `Enter`) {
        oldName = preset.name;
        newName = event.currentTarget.value;
        presets = JSON.parse(getValue(`dfPresets`));
        for (i = presets.length - 1; i >= 0 && presets[i].name !== oldName; --i);
        preset.name = presets[i].name = newName;
        setValue(`dfPresets`, JSON.stringify(presets));
        heading.textContent = newName;
        if (presetInput.value === oldName) {
            presetDisplay.textContent = presetInput.value = newName;
        }
        if (esgst[`df_preset`] === oldName) {
            setSetting(`df_preset`, newName);
        }
        event.currentTarget.classList.add(`esgst-hidden`);
        heading.classList.remove(`esgst-hidden`);
    }
}

function deleteDfPreset(deleted, preset, row, undoButton, event) {
    var deleteButton, i, presets;
    deleteButton = event.currentTarget;
    deleteButton.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
    presets = JSON.parse(getValue(`dfPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
    presets.splice(i, 1);
    setValue(`dfPresets`, JSON.stringify(presets));
    deleteButton.innerHTML = `<i class="fa fa-trash"></i>`;
    row.classList.add(`esgst-hidden`);
    deleted.push({
        details: preset,
        row: row
    });
    undoButton.classList.remove(`esgst-hidden`);
}

function undoDfDeletePreset(deleted, undoButton) {
    var preset, presets;
    preset = deleted.pop();
    preset.row.classList.remove(`esgst-hidden`);
    preset.row.parentElement.appendChild(preset.row);
    presets = JSON.parse(getValue(`dfPresets`, `[]`));
    presets.push(preset.details);
    setValue(`dfPresets`, JSON.stringify(presets));
    if (deleted.length === 0) {
        undoButton.classList.add(`esgst-hidden`);
    }
}

function openDfExceptionPopup(exceptionCount, df, presetInput) {
    var deleted, details, i, max, min, name, popup, preset, presets, row, table, undoButton;
    popup = new Popup(`fa-gear`, `Manage exceptions: <i class="fa fa-question-circle" title="Exceptions are discussion that will always appear, no matter which filters are set (they still get filtered by type filters). For example, if you have a filter that only shows discussion with 100+ comments, but you have an exception for deals, all deal discussions will appear, regardless of their number of comments.\n\nEach exception works as an AND conjunction, so if you want to make an exception for deal discussions **or** poll discussions, you have to create 2 separate exceptions, otherwise the exception will be for discussions that are both deal **and** poll."></i>`, true);
    deleted = [];
    undoButton = insertHtml(popup.description, `beforeEnd`, `
        <div class="esgst-clickable esgst-hidden">
            <i class="fa fa-rotate-left"></i>
            <span>Undo Delete</span>
        </div>
    `);
    table = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left popup__keys__list"></div>`);
    name = presetInput.value;
    presets = JSON.parse(getValue(`dfPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
    preset = presets[i];
    undoButton.addEventListener(`click`, undoDfDeleteException.bind(null, deleted, exceptionCount, df, preset, undoButton));
    if (preset.exceptions) {
        preset.exceptions.forEach(exception => {
            details = ``;
            [ { key: `Comments`, name: `comments` }
            ].forEach(filter => {
                max = exception[`max${filter.key}`];
                min = exception[`min${filter.key}`];
                if (typeof max !== `undefined` && typeof min !== `undefined`) {
                    details += `${min}-${max} ${filter.name}, `;
                } else if (typeof max !== `undefined`) {
                    details += `?-${max} ${filter.name}, `;
                } else if (typeof min !== `undefined`) {
                    details += `${min}-? ${filter.name}, `;
                }
            });
            [ { key: `announcements`, name: `announcements` },
                { key: `bugs_suggestions`, name: `bugs / suggestions` },
                { key: `deals`, name: `deals` },
                { key: `general`, name: `general` },
                { key: `groupRecruitment`, name: `group recruitment` },
                { key: `letsPlayTogether`, name: `let's play together` },
                { key: `offTopic`, name: `off-topic` },
                { key: `puzzles`, name: `puzzles` },
                { key: `uncategorized`, name: `uncategorized` },
                { key: `created`, name: `created` },
                { key: `poll`, name: `poll`},
                { key: `highlighted`, name: `highlighted` },
                { key: `visited`, name: `visited` },
                { key: `unread`, name: `unread` }
            ].forEach(key => {
                if (exception[key.key]) {
                    details += `${key.name}, `;
                }
            });
            row = insertHtml(table, `beforeEnd`, `
                <div>
                    <div class="esgst-bold esgst-clickable esgst-float-left">${exception.name}</div>
                    <div class="esgst-clickable esgst-float-right">
                        <i class="fa fa-edit" title="Edit exception"></i>
                        <span title="Delete exception">
                            <i class="fa fa-trash"></i>
                        </span>
                    </div>
                    <div class="esgst-clear"></div>
                    <div class="esgst-description">${details.slice(0, -2)}</div>
                </div>
            `);
            heading = row.firstElementChild;
            editButton = heading.nextElementSibling.firstElementChild;
            editButton.addEventListener(`click`, openDfManageExceptionPopup.bind(null, exception, exceptionCount, df, preset, () => popup.close()));
            editButton.nextElementSibling.addEventListener(`click`, deleteDfException.bind(null, deleted, exception, exceptionCount, df, heading, preset, row, undoButton));
        });
    }
    popup.description.appendChild(new ButtonSet(`green`, ``, `fa-plus`, ``, `Create Exception`, ``, openDfManageExceptionPopup.bind(null, {}, exceptionCount, df, preset, () => popup.close())).set);
    popup.open();
}

function openDfManageExceptionPopup(exception, exceptionCount, df, preset, callback) {
    var basicFilters, categoryFilters, context, typeFilters;
    if (callback) {
        callback();
    }
    popup = new Popup(`fa-edit`, `Create/edit exception:`, true);
    popup.scrollable.classList.add(`esgst-gf-container`, `esgst-gf-filters`, `esgst-text-left`);
    popup.name = insertHtml(popup.description, `afterBegin`, `Name: <input type="text" value="${exception.name || ``}"/>`);
    basicFilters = insertHtml(popup.scrollable, `beforeEnd`, `
        <div class="esgst-gf-basic-filters">
            <div>
                <span class="esgst-bold">Basic Filters:</span>
            </div>
        </div>
    `);
    [{ key: `Comments`, name: `Comments` }
    ].forEach(filter => {
        context = insertHtml(basicFilters, `beforeEnd`, `
            <div class="esgst-gf-basic-filter esgst-text-left">
                <div>${filter.name} <span class="esgst-float-right"><input type="text" value="${exception[`min${filter.key}`] || ``}"/> - <input type="text" value="${exception[`max${filter.key}`] || ``}"/></span></div>
            </div>
        `).firstElementChild.lastElementChild;
        popup[`min${filter.key}`] = context.firstElementChild;
        popup[`max${filter.key}`] = context.lastElementChild;
    });
    typeFilters = insertHtml(popup.scrollable, `beforeEnd`, `
        <div class="esgst-gf-type-filters">
            <div>
                <span class="esgst-bold">Type Filters:</span>
            </div>
        </div>
    `);
    [{ key: `announcements`, name: `Announcements` },
        { key: `bugs_suggestions`, name: `Bugs / Suggestions` },
        { key: `deals`, name: `Deals` },
        { key: `general`, name: `General` },
        { key: `groupRecruitment`, name: `Group Recruitment` },
        { key: `letsPlayTogether`, name: `Let's Play Together` },
        { key: `offTopic`, name: `Off-Topic` },
        { key: `puzzles`, name: `Puzzles` },
        { key: `uncategorized`, name: `Uncategorized` },
        { key: `created`, name: `Created` },
        { key: `poll`, name: `Poll`},
        { key: `highlighted`, name: `Highlighted` },
        { key: `visited`, name: `Visited` },
        { key: `unread`, name: `Unread` }
    ].forEach(filter => {
        popup[filter.key] = new Checkbox(insertHtml(typeFilters, `beforeEnd`, `<div class="esgst-gf-type-filter"><span></span> ${filter.name}</div>`).firstElementChild, exception[filter.key]);
    });
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveDfException.bind(null, exceptionCount, df, preset, popup)).set);
    popup.open();
}

function saveDfException(exceptionCount, df, preset, popup, callback) {
    var exception, i, presets;
    exception = { name: popup.name.value };
    [`Comments`].forEach(name => {
        if (popup[`max${name}`].value.length) {
            exception[`max${name}`] = parseFloat(popup[`max${name}`].value);
        }
        if (popup[`min${name}`].value.length) {
            exception[`min${name}`] = parseFloat(popup[`min${name}`].value);
        }
    });
    [`announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`].forEach(name => {
        if (popup[name].input.checked) {
            if (name === `genres`) {
                if (popup.genreList.value.length) {
                    exception.genres = 1;
                    exception.genreList = popup.genreList.value;
                }
            } else {
                exception[name] = 1;
            }
        }
    });
    if (!preset.exceptions) {
        preset.exceptions = [];
    }
    for (i = preset.exceptions.length - 1; i >= 0 && preset.exceptions[i].name !== exception.name; --i);
    if (i >= 0) {
        preset.exceptions[i] = exception;
    } else {
        preset.exceptions.push(exception);
        exceptionCount.textContent = preset.exceptions.length;
    }
    df.exceptions = preset.exceptions;
    presets = JSON.parse(getValue(`dfPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
    presets[i] = preset;
    setValue(`dfPresets`, JSON.stringify(presets));
    callback();
    popup.close();
    filterDfDiscussions(df);
}

function deleteDfException(deleted, exception, exceptionCount, df, heading, preset, row, undoButton, event) {
    var deleteButton, exception, i, preset, presets;
    deleteButton = event.currentTarget;
    deleteButton.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
    for (i = preset.exceptions.length - 1; i >= 0 && preset.exceptions[i].name !== exception.name; --i);
    preset.exceptions.splice(i, 1);
    df.exceptions = preset.exceptions;
    exceptionCount.textContent = preset.exceptions.length;
    presets = JSON.parse(getValue(`dfPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
    presets[i] = preset;
    setValue(`dfPresets`, JSON.stringify(presets));
    deleteButton.innerHTML = `<i class="fa fa-trash"></i>`;
    row.classList.add(`esgst-hidden`);
    deleted.push({
        details: exception,
        row: row
    });
    undoButton.classList.remove(`esgst-hidden`);
    filterDfDiscussions(df);
}

function undoDfDeleteException(deleted, exceptionCount, df, preset, undoButton) {
    var exception, i, presets;
    exception = deleted.pop();
    exception.row.classList.remove(`esgst-hidden`);
    exception.row.parentElement.appendChild(exception.row);
    preset.exceptions.push(exception.details);
    df.exceptions = preset.exceptions;
    exceptionCount.textContent = preset.exceptions.length;
    presets = JSON.parse(getValue(`dfPresets`, `[]`));
    for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
    presets[i] = preset;
    setValue(`dfPresets`, JSON.stringify(presets));
    if (deleted.length === 0) {
        undoButton.classList.add(`esgst-hidden`);
    }
}

function filterDfDiscussions(df, unfilter, endless) {
    esgst.currentDiscussions.forEach(discussion => {
        if (unfilter) {
            if (discussion.outerWrap.classList.contains(`esgst-hidden`)) {
                discussion.outerWrap.classList.remove(`esgst-hidden`);
            }
        } else if (filterDfDiscussion(df, discussion)) {
            if (!discussion.outerWrap.classList.contains(`esgst-hidden`)) {
                discussion.outerWrap.classList.add(`esgst-hidden`);
            }
        } else if (discussion.outerWrap.classList.contains(`esgst-hidden`)) {
            discussion.outerWrap.classList.remove(`esgst-hidden`);
        }
    });
    updateDfCount(df, endless);
}

function filterDfException(df, discussion) {
    var basicFilters, filtered, i, j, key, maxKey, minKey, n, name, typeFilters;
    basicFilters = [`Comments`];
    typeFilters = [`announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`];
    filtered = false;
    for (i = 0, n = basicFilters.length; !filtered && i < n; ++i) {
        name = basicFilters[i];
        key = name.toLowerCase();
        maxKey = `max${name}`;
        minKey = `min${name}`;
        if (typeof df[minKey] !== `undefined`) {
            filtered = discussion[key] >= df[minKey] ? false : true;
        }
        if (!filtered && typeof df[maxKey] !== `undefined`) {
            filtered = discussion[key] <= df[maxKey] ? false : true;
        }
    }
    for (i = 0, n = typeFilters.length; !filtered && i < n; ++i) {
        key = typeFilters[i];
        if (df[key]) {
            filtered = discussion[key] ? false : true;
        }
    }
    return filtered;
}

function filterDfDiscussion(df, discussion) {
    var basicFilters, filtered, i, j, key, maxKey, minKey, n, name, override, typeFilters;
    basicFilters = [`Comments`];
    typeFilters = [`announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`];
    filtered = false;
    override = 0;
    for (i = 0, n = basicFilters.length; !filtered && i < n; ++i) {
        name = basicFilters[i];
        key = name.toLowerCase();
        maxKey = `max${name}`;
        minKey = `min${name}`;
        if (discussion[key] < df[minKey] || discussion[key] > df[maxKey]) {
            filtered = true;
            override = df.overrides[key];
        }
    }
    for (i = 0, n = typeFilters.length; !filtered && i < n; ++i) {
        key = typeFilters[i];
        if ((df[key] === `disabled` && discussion[key]) || (df[key] === `none` && !discussion[key])) {
            filtered = true;
            override = df.overrides[key];
        }
    }
    if (df.exceptions && !override) {
        for (i = df.exceptions.length - 1; i >= 0 && filtered; --i) {
            filtered = filterDfException(df.exceptions[i], discussion);
        }
    }
    return filtered;
}

function updateDfCount(df, endless) {
    var filtered, discussion, i;
    filtered = 0;
    for (i = esgst.currentDiscussions.length - 1; i > -1; --i) {
        discussion = esgst.currentDiscussions[i];
        if (document.body.contains(discussion.outerWrap) || endless) {
            if (discussion.outerWrap.classList.contains(`esgst-hidden`)) {
                filtered += 1;
            }
        } else {
            esgst.currentDiscussions.splice(i, 1);
        }
    }
    df.filteredCount.textContent = filtered;
    df.paginationFilteredCount.textContent = filtered;
}

/* [DH] Discussions Highlighter */

function loadDh() {
    var button, code, comments, container, heading, source;
        button = insertHtml(document.getElementsByClassName(`nav__absolute-dropdown`)[1], `beforeEnd`, `
            <div class="nav__row esgst-dh-view-button">
                <i class="icon-yellow fa fa-fw fa-star"></i>
                <div class="nav__row__summary">
                    <p class="nav__row__summary__name">Highlighted Discussions</p>
                    <p class="nav__row__summary__description">View your highlighted discussions.</p>
                </div>
            </div>
        `);
        button.addEventListener(`click`, function() {
            var discussions, i, keys, popup, set;
            popup = new Popup(`fa-star`, `Highlighted Discussions`);
            popup.highlightedDiscussions = insertHtml(popup.scrollable, `afterBegin`, `
                <div class="table esgst-text-left">
                    <div class="table__heading">
                        <div class="table__column--width-fill">Summary</div>
                        <div class="table__column--width-small text-center">Comments</div>
                    </div>
                </div>
            `);
            discussions = JSON.parse(getValue(`discussions`));
            keys = Object.keys(discussions);
            i = 0;
            set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load more...`, `Loading more...`, function (callback) {
                getDhHighlightedDiscussions(discussions, i, i, keys, i + 5, popup, function (value) {
                    i = value;
                    if (i > keys.length) {
                        set.set.remove();
                    } else if (esgst.es_dh && popup.scrollable.scrollHeight <= popup.scrollable.offsetHeight) {
                        set.trigger();
                    }
                    callback();
                });
            });
            popup.description.appendChild(set.set);
            popup.open();
            set.trigger();
            if (esgst.es_dh) {
                popup.scrollable.addEventListener(`scroll`, function () {
                    if ((popup.scrollable.scrollTop + popup.scrollable.offsetHeight) >= popup.scrollable.scrollHeight && !set.busy) {
                        set.trigger();
                    }
                });
            }
        });
        if (esgst.discussionPath) {
            comments = JSON.parse(getValue(`discussions`));
            source = location.pathname.match(/^\/discussion\/(.+?)(\/.*)?$/);
            if (source) {
                code = source[1];
                container = document.getElementsByClassName(`page__heading`)[0];
                heading = container.getElementsByClassName(`page__heading__breadcrumbs`)[0];
                if (comments[code] && comments[code].highlighted) {
                    highlightDhDiscussion(code, heading);
                    addDhUnhighlightButton(code, heading, container);
                } else {
                    addDhHighlightButton(code, heading, container);
                }
            }
        }
}

function highlightDhDiscussion(code, context, save) {
    if (save) {
        createLock(`commentLock`, 300, function(deleteLock) {
            var comments;
            comments = JSON.parse(getValue(`discussions`));
            if (!comments[code]) {
                comments[code] = {
                    readComments: {}
                };
            }
            comments[code].highlighted = true;
            setValue(`discussions`, JSON.stringify(comments));
            context.classList.add(`esgst-dh-highlighted`);
            deleteLock();
        });
    } else {
        context.classList.add(`esgst-dh-highlighted`);
    }
}

function unhighlightDhDiscussion(code, context, save) {
    if (save) {
        createLock(`commentLock`, 300, function(deleteLock) {
            var comments;
            comments = JSON.parse(getValue(`discussions`));
            delete comments[code].highlighted;
            setValue(`discussions`, JSON.stringify(comments));
            context.classList.remove(`esgst-dh-highlighted`);
            deleteLock();
        });
    } else {
        context.classList.remove(`esgst-dh-highlighted`);
    }
}

function addDhHighlightButton(code, container, context) {
    var button;
    if (!context.getElementsByClassName(`esgst-dh-button`)[0]) {
        button = insertHtml(context, `afterBegin`, `
            <div class="esgst-dh-button" title="Click to highlight this discussion">
                <i class="fa fa-star-o"></i>
            <div>
        `);
        button.addEventListener(`click`, function() {
            highlightDhDiscussion(code, container, true);
            button.remove();
            addDhUnhighlightButton(code, container, context);
        });
    }
}

function addDhUnhighlightButton(code, container, context) {
    var button;
    if (!context.getElementsByClassName(`esgst-dh-button`)[0]) {
        button = insertHtml(context, `afterBegin`, `
            <div class="esgst-dh-button" title="Click to unhighlight this discussion">
                <i class="fa fa-star"></i>
            </div>
        `);
        button.addEventListener(`click`, function() {
            unhighlightDhDiscussion(code, container, true);
            button.remove();
            addDhHighlightButton(code, container, context);
        });
    }
}

function getDhHighlightedDiscussions(discussions, i, j, keys, n, popup, callback) {
    var key;
    if (i < n) {
        key = keys[j];
        if (key) {
            if (discussions[key].highlighted) {
                request(null, null, false, `/discussion/${key}/`, function(response) {
                    var breadcrumbs, categoryLink, context, usernameLink;
                    context = DOM.parse(response.responseText);
                    breadcrumbs = context.getElementsByClassName(`page__heading__breadcrumbs`);
                    categoryLink = breadcrumbs[0].firstElementChild.nextElementSibling.nextElementSibling;
                    usernameLink = context.getElementsByClassName(`comment__username`)[0].firstElementChild;
                    popup.highlightedDiscussions.insertAdjacentHTML(`beforeEnd`, `
                        <div>
                            <div class="table__row-outer-wrap">
                                <div class="table__row-inner-wrap">
                                    <div>
                                        ${context.getElementsByClassName(`global__image-outer-wrap`)[0].outerHTML}
                                    </div>
                                    <div class="table__column--width-fill">
                                        <h3>
                                            <a class="table__column__heading" href="/discussion/${key}/">${categoryLink.nextElementSibling.nextElementSibling.firstElementChild.textContent}</a>
                                        </h3>
                                        <p>
                                            <a class="table__column__secondary-link" href="${categoryLink.getAttribute(`href`)}">${categoryLink.textContent}</a> -
                                            ${context.querySelector(`.comment [data-timestamp]`).outerHTML} ago by
                                            <a class="table__column__secondary-link" href="${usernameLink.getAttribute(`href`)}">${usernameLink.textContent}</a>
                                        </p>
                                    </div>
                                    <div class="table__column--width-small text-center">
                                        <a class="table__column__secondary-link" href="/discussion/${key}/">${breadcrumbs[1].textContent.match(/(.+) Comments/)[1]}</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `);
                    loadEndlessFeatures(popup.highlightedDiscussions.lastElementChild);
                    if (!esgst.giveawaysPath && !esgst.discussionsPath) {
                        if (esgst.gdttt) {
                            addCtDiscussionPanels(popup.highlightedDiscussions.lastElementChild, false, null, false, true);
                            checkGdtttVisited(popup.highlightedDiscussions.lastElementChild);
                        } else if (esgst.ct) {
                            addCtDiscussionPanels(popup.highlightedDiscussions.lastElementChild, false, null, false, true);
                        }
                        loadDiscussionFeatures(popup.highlightedDiscussions.lastElementChild);
                    }
                    popup.reposition();
                    setTimeout(getDhHighlightedDiscussions, 0, discussions, ++i, ++j, keys, n, popup, callback);
                });
            } else {
                setTimeout(getDhHighlightedDiscussions, 0, discussions, i, ++j, keys, n, popup, callback);
            }
        } else {
            callback(j + 1);
        }
    } else {
        callback(j);
    }
}

/* [MPS] Main Post Skipper */

function loadMps() {
    if (esgst.discussionPath && esgst.paginationNavigation) {
        if (document.referrer.match(new RegExp(`/discussion/${[location.pathname.match(/^\/discussion\/(.+?)\//)[1]]}/`))) {
            goToComment(``, esgst.pagination.previousElementSibling.firstElementChild.firstElementChild);
        }
    }
}

/* [MPP] Main Post Popup */

function loadMpp(button) {
    var discussion, MPPPost, Sibling, Visited, Timestamp, Hidden;
        MPPPost = document.createElement(`div`);
        MPPPost.className = `page__outer-wrap`;
        do {
            Sibling = esgst.mainPageHeading.previousElementSibling;
            if (Sibling) {
                MPPPost.insertBefore(Sibling, MPPPost.firstElementChild);
            }
        } while (Sibling);
        esgst.mainPageHeading.parentElement.insertBefore(MPPPost, esgst.mainPageHeading);
        if (esgst.mpp_r) {
            discussion = JSON.parse(getValue(`discussions`))[location.pathname.match(/^\/discussion\/(.+?)\//)[1]];
            if (discussion) {
                if (discussion.readComments && discussion.readComments[``]) {
                    Hidden = true;
                } else {
                    Hidden = false;
                }
            } else {
                Hidden = false;
            }
        } else {
            Hidden = true;
        }
        MPPPost.classList.add(Hidden ? `esgst-mpp-hidden` : `esgst-mpp-visible`);
        button.addEventListener(`click`, function () {
            if (!Hidden) {
                MPPPost.classList.remove(`esgst-mpp-visible`);
                MPPPost.classList.add(`esgst-mpp-hidden`);
            }
            popup = new Popup(null, null, false, false, MPPPost);
            popup.open();
            popup.onClose = function () {
                if (!Hidden) {
                    MPPPost.classList.remove(`esgst-mpp-hidden`);
                    MPPPost.classList.add(`esgst-mpp-visible`);
                    MPPPost.removeAttribute(`style`);
                    esgst.mainPageHeading.parentElement.insertBefore(MPPPost, esgst.mainPageHeading);
                }
            };
        });
}

/* [DED] Discussion Edits Detector */

function loadDed() {
    if (esgst.replyBox && !esgst.userPath) {
        addDEDButton(esgst.replyBox);
    }
}

function addDEDButton(Context, CommentURL, DEDCallback) {
    var TradeCode, ParentID, Description, URL, DEDButton, DEDStatus, ResponseHTML;
    TradeCode = Context.querySelector(`[name="trade_code"]`);
    TradeCode = TradeCode ? TradeCode.value : ``;
    ParentID = Context.querySelector(`[name="parent_id"]`);
    Description = Context.querySelector(`[name="description"]`);
    URL = esgst.sg ? location.href.match(/(.+?)(#.+?)?$/)[1] : `/ajax.php`;
    Context = Context.getElementsByClassName(esgst.sg ? `align-button-container` : `btn_actions`)[0];
    Context.firstElementChild.remove();
    Context.insertAdjacentHTML(`afterBegin`, `<div class="esgst-ded-button"></div>`);
    Context.insertAdjacentHTML(`beforeEnd`, `<div class="comment__actions action_list esgst-ded-status"></div>`);
    DEDButton = Context.firstElementChild;
    DEDStatus = Context.lastElementChild;
    DEDButton.appendChild(new ButtonSet(`grey`, `grey`, `fa-send`, `fa-circle-o-notch fa-spin`, `Submit`, `Saving...`, function (Callback) {
        DEDStatus.innerHTML = ``;
        if (CommentURL) {
            request(null, null, false, CommentURL, function (Response) {
                ResponseHTML = DOM.parse(Response.responseText);
                TradeCode = esgst.sg ? `` : Response.finalUrl.match(/\/trade\/(.+?)\//)[1];
                ParentID = ResponseHTML.getElementById(CommentURL.match(/\/comment\/(.+)/)[1]);
                ParentID = esgst.sg ? ParentID.closest(`.comment`).getAttribute(`data-comment-id`) : ParentID.getAttribute(`data-id`);
                URL = esgst.sg ? Response.finalUrl.match(/(.+?)(#.+?)?$/)[1] : `/ajax.php`;
                saveComment(TradeCode, ParentID, Description.value, URL, DEDStatus, Callback, DEDCallback);
            });
        } else {
            saveComment(TradeCode, ParentID.value, Description.value, URL, DEDStatus, Callback, DEDCallback);
        }
    }).set);
}

/* [TB] Trades Bumper */

function getTbTrades(button, context, callback) {
    var elements, i, n;
    if (button) {
        button.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
        `;
    }
    elements = context.querySelectorAll(`.row_inner_wrap:not(.is_faded)`);
    n = elements.length;
    if (n > 0) {
        bumpTbTrades(button, elements, 0, n, callback);
    } else if (button) {
        button.innerHTML = `
            <i class="fa fa-chevron-circle-up"></i>
        `;
    }
}

function bumpTbTrades(button, elements, i, n, callback) {
    if (i < n) {
        request(`xsrf_token=${esgst.xsrfToken}&do=trade_bump&code=${elements[i].querySelector(`[href*="/trade/"]`).getAttribute(`href`).match(/\/trade\/(.+?)\//)[1]}`, null, false, `https://www.steamtrades.com/ajax.php`, bumpTbTrades.bind(null, button, elements, ++i, n, callback));
    } else {
        if (button) {
            button.innerHTML = `
                <i class="fa fa-chevron-circle-up"></i>
            `;
        }
        if (callback) {
            callback();
        } else {
            location.reload();
        }
    }
}

function setTbAutoBump(button) {
    var currentTime, dif, lastBump;
    lastBump = getValue(`lastBump`, 0);
    currentTime = Date.now();
    dif = currentTime - lastBump;
    if (dif > 3600000) {
        setValue(`lastBump`, currentTime);
        autoBumpTbTrades(button);
    } else {
        setTimeout(setTbAutoBump, 3600000 - dif, button);
    }
}

function autoBumpTbTrades(button) {
    if (location.href.match(new RegExp(`\\/trades\\/search\\?user=${esgst.steamId}`))) {
        getTbTrades(button, document);
    } else {
        request(null, null, true, `https://www.steamtrades.com/trades/search?user=${esgst.steamId}`, loadTbTrades.bind(null, button));
    }
}

function loadTbTrades(button, response) {
    getTbTrades(null, DOM.parse(response.responseText), setTimeout.bind(null, setTbAutoBump, 3900000, button));
}

/* [RML] Reply Mention Link */

function loadRml() {
    esgst.endlessFeatures.push(addRmlLinks);
    addRmlLinks(document);
}

function addRmlLinks(context) {
    var matches = context.getElementsByClassName(esgst.sg ? `comment__children` : `comment_children`);
    for (var i = 0, n = matches.length; i < n; ++i) {
        var Matches = matches[i].children;
        if (Matches.length) {
            addRMLLink(esgst.sg ? matches[i].parentElement.getElementsByClassName(`comment__summary`)[0] : matches[i].parentElement, Matches);
        }
    }
}

function addRMLLink(Context, Matches) {
    var Username, ID, I, N, RMLLink;
    Username = Context.getElementsByClassName(esgst.sg ? `comment__username` : `author_name`)[0].textContent.trim();
    ID = Context.id;
    for (I = 0, N = Matches.length; I < N; ++I) {
        Context = Matches[I].getElementsByClassName(esgst.sg ? `comment__actions` : `action_list`)[0];
        RMLLink = Context.getElementsByClassName(`esgst-rml-link`)[0];
        if (RMLLink) {
            RMLLink.textContent = `@${Username}`;
        } else {
            Context.insertAdjacentHTML(`beforeEnd`, `<a class="comment__actions__button esgst-rml-link" href="#${ID}">@${Username}</a>`);
        }
    }
}

/* [CFH] Comment Formatting Helper */

function loadCfh(context) {
    esgst.endlessFeatures.push(getCfhAreas);
    getCfhAreas(document);
    esgst.emojis = [ //Top emojis credit to https://greasyfork.org/scripts/21607-steamgifts-comment-formatting
        {
            Emoji: `&#xAF;&#92;&#92;&#92;&#95;&#40;&#x30C4;&#41;&#95;&#47;&#xAF;`,
            Title: ``
        }, {
            Emoji: `&#40; &#x361;&#xB0; &#x35C;&#x296; &#x361;&#xB0;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40; &#x361;&#x2299; &#x35C;&#x296; &#x361;&#x2299;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#x30CE;&#xCA0;&#x76CA;&#xCA0;&#41;&#x30CE;`,
            Title: ``
        }, {
            Emoji: `&#40;&#x256F;&#xB0;&#x25A1;&#xB0;&#xFF09;&#x256F;&#xFE35; &#x253B;&#x2501;&#x253B;`,
            Title: ``
        }, {
            Emoji: `&#x252C;&#x2500;&#x252C;&#x30CE;&#40; &#xBA; &#95; &#xBA;&#x30CE;&#41;`,
            Title: ``
        }, {
            Emoji: `&#x10DA;&#40;&#xCA0;&#x76CA;&#xCA0;&#x10DA;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#x25D5;&#x203F;-&#41;&#x270C;`,
            Title: ``
        }, {
            Emoji: `&#40;&#xFF61;&#x25D5;&#x203F;&#x25D5;&#xFF61;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#x25D1;&#x203F;&#x25D0;&#41;`,
            Title: ``
        }, {
            Emoji: `&#x25D4;&#95;&#x25D4;`,
            Title: ``
        }, {
            Emoji: `&#40;&#x2022;&#x203F;&#x2022;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#xCA0;&#95;&#xCA0;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#xAC;&#xFF64;&#xAC;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#x2500;&#x203F;&#x203F;&#x2500;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#xCA5;&#xFE4F;&#xCA5;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#xCA5;&#x2038;&#xCA5;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#x2310;&#x25A0;&#95;&#x25A0;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#x25B0;&#x2D8;&#x25E1;&#x2D8;&#x25B0;&#41;`,
            Title: ``
        }, {
            Emoji: `&#x4E41;&#40; &#x25D4; &#xC6A;&#x25D4;&#41;&#x310F;`,
            Title: ``
        }, {
            Emoji: `&#40;&#xE07; &#x360;&#xB0; &#x35F;&#x296; &#x361;&#xB0;&#41;&#xE07;`,
            Title: ``
        }, {
            Emoji: `&#x3B6;&#xF3C;&#x19F;&#x346;&#x644;&#x35C;&#x19F;&#x346;&#xF3D;&#x1D98;`,
            Title: ``
        }, {
            Emoji: `&#x295;&#x2022;&#x1D25;&#x2022;&#x294;`,
            Title: ``
        }, {
            Emoji: `&#40; &#x35D;&#xB0; &#x35C;&#x296;&#x361;&#xB0;&#41;`,
            Title: ``
        }, {
            Emoji: `&#40;&#47;&#xFF9F;&#x414;&#xFF9F;&#41;&#47;`,
            Title: ``
        }, {
            Emoji: `&#xB67;&#xF3C;&#xCA0;&#x76CA;&#xCA0;&#xF3D;&#xB68;`,
            Title: ``
        }, {
            Emoji: `&#40;&#xE07; &#x2022;&#x300;&#95;&#x2022;&#x301;&#41;&#xE07;`,
            Title: ``
        }, {
            Emoji: `&#x1F600`,
            Title: `Grinning Face`
        }, {
            Emoji: `&#x1F601`,
            Title: `Grinning Face With Smiling Eyes`
        }, {
            Emoji: `&#x1F602`,
            Title: `Face With Tears Of Joy`
        }, {
            Emoji: `&#x1F923`,
            Title: `Rolling On The Floor Laughing`
        }, {
            Emoji: `&#x1F603`,
            Title: `Smiling Face With Open Mouth`
        }, {
            Emoji: `&#x1F604`,
            Title: `Smiling Face With Open Mouth & Smiling Eyes`
        }, {
            Emoji: `&#x1F605`,
            Title: `Smiling Face With Open Mouth & Cold Sweat`
        }, {
            Emoji: `&#x1F606`,
            Title: `Smiling Face With Open Mouth & Closed Eyes`
        }, {
            Emoji: `&#x1F609`,
            Title: `Winking Face`
        }, {
            Emoji: `&#x1F60A`,
            Title: `Smiling Face With Smiling Eyes`
        }, {
            Emoji: `&#x1F60B`,
            Title: `Face Savouring Delicious Food`
        }, {
            Emoji: `&#x1F60E`,
            Title: `Smiling Face With Sunglasses`
        }, {
            Emoji: `&#x1F60D`,
            Title: `Smiling Face With Heart-Eyes`
        }, {
            Emoji: `&#x1F618`,
            Title: `Face Blowing A Kiss`
        }, {
            Emoji: `&#x1F617`,
            Title: `Kissing Face`
        }, {
            Emoji: `&#x1F619`,
            Title: `Kissing Face With Smiling Eyes`
        }, {
            Emoji: `&#x1F61A`,
            Title: `Kissing Face With Closed Eyes`
        }, {
            Emoji: `&#x263A`,
            Title: `Smiling Face`
        }, {
            Emoji: `&#x1F642`,
            Title: `Slightly Smiling Face`
        }, {
            Emoji: `&#x1F917`,
            Title: `Hugging Face`
        }, {
            Emoji: `&#x1F914`,
            Title: `Thinking Face`
        }, {
            Emoji: `&#x1F610`,
            Title: `Neutral Face`
        }, {
            Emoji: `&#x1F611`,
            Title: `Expressionless Face`
        }, {
            Emoji: `&#x1F636`,
            Title: `Face Without Mouth`
        }, {
            Emoji: `&#x1F644`,
            Title: `Face With Rolling Eyes`
        }, {
            Emoji: `&#x1F60F`,
            Title: `Smirking Face`
        }, {
            Emoji: `&#x1F623`,
            Title: `Persevering Face`
        }, {
            Emoji: `&#x1F625`,
            Title: `Disappointed But Relieved Face`
        }, {
            Emoji: `&#x1F62E`,
            Title: `Face With Open Mouth`
        }, {
            Emoji: `&#x1F910`,
            Title: `Zipper-Mouth Face`
        }, {
            Emoji: `&#x1F62F`,
            Title: `Hushed Face`
        }, {
            Emoji: `&#x1F62A`,
            Title: `Sleepy Face`
        }, {
            Emoji: `&#x1F62B`,
            Title: `Tired Face`
        }, {
            Emoji: `&#x1F634`,
            Title: `Sleeping Face`
        }, {
            Emoji: `&#x1F60C`,
            Title: `Relieved Face`
        }, {
            Emoji: `&#x1F913`,
            Title: `Nerd Face`
        }, {
            Emoji: `&#x1F61B`,
            Title: `Face With Stuck-Out Tongue`
        }, {
            Emoji: `&#x1F61C`,
            Title: `Face With Stuck-Out Tongue & Winking Eye`
        }, {
            Emoji: `&#x1F61D`,
            Title: `Face With Stuck-Out Tongue & Closed Eyes`
        }, {
            Emoji: `&#x1F924`,
            Title: `Drooling Face`
        }, {
            Emoji: `&#x1F612`,
            Title: `Unamused Face`
        }, {
            Emoji: `&#x1F613`,
            Title: `Face With Cold Sweat`
        }, {
            Emoji: `&#x1F614`,
            Title: `Pensive Face`
        }, {
            Emoji: `&#x1F615`,
            Title: `Confused Face`
        }, {
            Emoji: `&#x1F643`,
            Title: `Upside-Down Face`
        }, {
            Emoji: `&#x1F911`,
            Title: `Money-Mouth Face`
        }, {
            Emoji: `&#x1F632`,
            Title: `Astonished Face`
        }, {
            Emoji: `&#x2639`,
            Title: `Frowning Face`
        }, {
            Emoji: `&#x1F641`,
            Title: `Slightly Frowning Face`
        }, {
            Emoji: `&#x1F616`,
            Title: `Confounded Face`
        }, {
            Emoji: `&#x1F61E`,
            Title: `Disappointed Face`
        }, {
            Emoji: `&#x1F61F`,
            Title: `Worried Face`
        }, {
            Emoji: `&#x1F624`,
            Title: `Face With Steam From Nose`
        }, {
            Emoji: `&#x1F622`,
            Title: `Crying Face`
        }, {
            Emoji: `&#x1F62D`,
            Title: `Loudly Crying Face`
        }, {
            Emoji: `&#x1F626`,
            Title: `Frowning Face With Open Mouth`
        }, {
            Emoji: `&#x1F627`,
            Title: `Anguished Face`
        }, {
            Emoji: `&#x1F628`,
            Title: `Fearful Face`
        }, {
            Emoji: `&#x1F629`,
            Title: `Weary Face`
        }, {
            Emoji: `&#x1F62C`,
            Title: `Grimacing Face`
        }, {
            Emoji: `&#x1F630`,
            Title: `Face With Open Mouth & Cold Sweat`
        }, {
            Emoji: `&#x1F631`,
            Title: `Face Screaming In Fear`
        }, {
            Emoji: `&#x1F633`,
            Title: `Flushed Face`
        }, {
            Emoji: `&#x1F635`,
            Title: `Dizzy Face`
        }, {
            Emoji: `&#x1F621`,
            Title: `Pouting Face`
        }, {
            Emoji: `&#x1F620`,
            Title: `Angry Face`
        }, {
            Emoji: `&#x1F607`,
            Title: `Smiling Face With Halo`
        }, {
            Emoji: `&#x1F920`,
            Title: `Cowboy Hat Face`
        }, {
            Emoji: `&#x1F921`,
            Title: `Clown Face`
        }, {
            Emoji: `&#x1F925`,
            Title: `Lying Face`
        }, {
            Emoji: `&#x1F637`,
            Title: `Face With Medical Mask`
        }, {
            Emoji: `&#x1F912`,
            Title: `Face With Thermometer`
        }, {
            Emoji: `&#x1F915`,
            Title: `Face With Head-Bandage`
        }, {
            Emoji: `&#x1F922`,
            Title: `Nauseated Face`
        }, {
            Emoji: `&#x1F927`,
            Title: `Sneezing Face`
        }, {
            Emoji: `&#x1F608`,
            Title: `Smiling Face With Horns`
        }, {
            Emoji: `&#x1F47F`,
            Title: `Angry Face With Horns`
        }, {
            Emoji: `&#x1F479`,
            Title: `Ogre`
        }, {
            Emoji: `&#x1F47A`,
            Title: `Goblin`
        }, {
            Emoji: `&#x1F480`,
            Title: `Skull`
        }, {
            Emoji: `&#x2620`,
            Title: `Skull And Crossbones`
        }, {
            Emoji: `&#x1F47B`,
            Title: `Ghost`
        }, {
            Emoji: `&#x1F47D`,
            Title: `Alien`
        }, {
            Emoji: `&#x1F47E`,
            Title: `Alien Monster`
        }, {
            Emoji: `&#x1F916`,
            Title: `Robot Face`
        }, {
            Emoji: `&#x1F4A9`,
            Title: `Pile Of Poo`
        }, {
            Emoji: `&#x1F63A`,
            Title: `Smiling Cat Face With Open Mouth`
        }, {
            Emoji: `&#x1F638`,
            Title: `Grinning Cat Face With Smiling Eyes`
        }, {
            Emoji: `&#x1F639`,
            Title: `Cat Face With Tears Of Joy`
        }, {
            Emoji: `&#x1F63B`,
            Title: `Smiling Cat Face With Heart-Eyes`
        }, {
            Emoji: `&#x1F63C`,
            Title: `Cat Face With Wry Smile`
        }, {
            Emoji: `&#x1F63D`,
            Title: `Kissing Cat Face With Closed Eyes`
        }, {
            Emoji: `&#x1F640`,
            Title: `Weary Cat Face`
        }, {
            Emoji: `&#x1F63F`,
            Title: `Crying Cat Face`
        }, {
            Emoji: `&#x1F63E`,
            Title: `Pouting Cat Face`
        }, {
            Emoji: `&#x1F648`,
            Title: `See-No-Evil Monkey`
        }, {
            Emoji: `&#x1F649`,
            Title: `Hear-No-Evil Monkey`
        }, {
            Emoji: `&#x1F64A`,
            Title: `Speak-No-Evil Monkey`
        }, {
            Emoji: `&#x1F466`,
            Title: `Boy`
        }, {
            Emoji: `&#x1F466&#x1F3FB`,
            Title: `Boy: Light Skin Tone`
        }, {
            Emoji: `&#x1F466&#x1F3FC`,
            Title: `Boy: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F466&#x1F3FD`,
            Title: `Boy: Medium Skin Tone`
        }, {
            Emoji: `&#x1F466&#x1F3FE`,
            Title: `Boy: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F466&#x1F3FF`,
            Title: `Boy: Dark Skin Tone`
        }, {
            Emoji: `&#x1F467`,
            Title: `Girl`
        }, {
            Emoji: `&#x1F467&#x1F3FB`,
            Title: `Girl: Light Skin Tone`
        }, {
            Emoji: `&#x1F467&#x1F3FC`,
            Title: `Girl: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F467&#x1F3FD`,
            Title: `Girl: Medium Skin Tone`
        }, {
            Emoji: `&#x1F467&#x1F3FE`,
            Title: `Girl: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F467&#x1F3FF`,
            Title: `Girl: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468`,
            Title: `Man`
        }, {
            Emoji: `&#x1F468&#x1F3FB`,
            Title: `Man: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC`,
            Title: `Man: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD`,
            Title: `Man: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE`,
            Title: `Man: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF`,
            Title: `Man: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469`,
            Title: `Woman`
        }, {
            Emoji: `&#x1F469&#x1F3FB`,
            Title: `Woman: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC`,
            Title: `Woman: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD`,
            Title: `Woman: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE`,
            Title: `Woman: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF`,
            Title: `Woman: Dark Skin Tone`
        }, {
            Emoji: `&#x1F474`,
            Title: `Old Man`
        }, {
            Emoji: `&#x1F474&#x1F3FB`,
            Title: `Old Man: Light Skin Tone`
        }, {
            Emoji: `&#x1F474&#x1F3FC`,
            Title: `Old Man: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F474&#x1F3FD`,
            Title: `Old Man: Medium Skin Tone`
        }, {
            Emoji: `&#x1F474&#x1F3FE`,
            Title: `Old Man: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F474&#x1F3FF`,
            Title: `Old Man: Dark Skin Tone`
        }, {
            Emoji: `&#x1F475`,
            Title: `Old Woman`
        }, {
            Emoji: `&#x1F475&#x1F3FB`,
            Title: `Old Woman: Light Skin Tone`
        }, {
            Emoji: `&#x1F475&#x1F3FC`,
            Title: `Old Woman: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F475&#x1F3FD`,
            Title: `Old Woman: Medium Skin Tone`
        }, {
            Emoji: `&#x1F475&#x1F3FE`,
            Title: `Old Woman: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F475&#x1F3FF`,
            Title: `Old Woman: Dark Skin Tone`
        }, {
            Emoji: `&#x1F476`,
            Title: `Baby`
        }, {
            Emoji: `&#x1F476&#x1F3FB`,
            Title: `Baby: Light Skin Tone`
        }, {
            Emoji: `&#x1F476&#x1F3FC`,
            Title: `Baby: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F476&#x1F3FD`,
            Title: `Baby: Medium Skin Tone`
        }, {
            Emoji: `&#x1F476&#x1F3FE`,
            Title: `Baby: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F476&#x1F3FF`,
            Title: `Baby: Dark Skin Tone`
        }, {
            Emoji: `&#x1F47C`,
            Title: `Baby Angel`
        }, {
            Emoji: `&#x1F47C&#x1F3FB`,
            Title: `Baby Angel: Light Skin Tone`
        }, {
            Emoji: `&#x1F47C&#x1F3FC`,
            Title: `Baby Angel: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F47C&#x1F3FD`,
            Title: `Baby Angel: Medium Skin Tone`
        }, {
            Emoji: `&#x1F47C&#x1F3FE`,
            Title: `Baby Angel: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F47C&#x1F3FF`,
            Title: `Baby Angel: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x2695&#xFE0F`,
            Title: `Man Health Worker`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x2695&#xFE0F`,
            Title: `Man Health Worker: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x2695&#xFE0F`,
            Title: `Man Health Worker: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x2695&#xFE0F`,
            Title: `Man Health Worker: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x2695&#xFE0F`,
            Title: `Man Health Worker: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x2695&#xFE0F`,
            Title: `Man Health Worker: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x2695&#xFE0F`,
            Title: `Woman Health Worker`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x2695&#xFE0F`,
            Title: `Woman Health Worker: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x2695&#xFE0F`,
            Title: `Woman Health Worker: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x2695&#xFE0F`,
            Title: `Woman Health Worker: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x2695&#xFE0F`,
            Title: `Woman Health Worker: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x2695&#xFE0F`,
            Title: `Woman Health Worker: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F393`,
            Title: `Man Student`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F393`,
            Title: `Man Student: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F393`,
            Title: `Man Student: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F393`,
            Title: `Man Student: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F393`,
            Title: `Man Student: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F393`,
            Title: `Man Student: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F393`,
            Title: `Woman Student`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F393`,
            Title: `Woman Student: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F393`,
            Title: `Woman Student: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F393`,
            Title: `Woman Student: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F393`,
            Title: `Woman Student: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F393`,
            Title: `Woman Student: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F3EB`,
            Title: `Man Teacher`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F3EB`,
            Title: `Man Teacher: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F3EB`,
            Title: `Man Teacher: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F3EB`,
            Title: `Man Teacher: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F3EB`,
            Title: `Man Teacher: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F3EB`,
            Title: `Man Teacher: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F3EB`,
            Title: `Woman Teacher`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F3EB`,
            Title: `Woman Teacher: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F3EB`,
            Title: `Woman Teacher: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F3EB`,
            Title: `Woman Teacher: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F3EB`,
            Title: `Woman Teacher: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F3EB`,
            Title: `Woman Teacher: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x2696&#xFE0F`,
            Title: `Man Judge`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x2696&#xFE0F`,
            Title: `Man Judge: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x2696&#xFE0F`,
            Title: `Man Judge: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x2696&#xFE0F`,
            Title: `Man Judge: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x2696&#xFE0F`,
            Title: `Man Judge: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x2696&#xFE0F`,
            Title: `Man Judge: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x2696&#xFE0F`,
            Title: `Woman Judge`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x2696&#xFE0F`,
            Title: `Woman Judge: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x2696&#xFE0F`,
            Title: `Woman Judge: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x2696&#xFE0F`,
            Title: `Woman Judge: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x2696&#xFE0F`,
            Title: `Woman Judge: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x2696&#xFE0F`,
            Title: `Woman Judge: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F33E`,
            Title: `Man Farmer`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F33E`,
            Title: `Man Farmer: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F33E`,
            Title: `Man Farmer: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F33E`,
            Title: `Man Farmer: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F33E`,
            Title: `Man Farmer: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F33E`,
            Title: `Man Farmer: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F33E`,
            Title: `Woman Farmer`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F33E`,
            Title: `Woman Farmer: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F33E`,
            Title: `Woman Farmer: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F33E`,
            Title: `Woman Farmer: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F33E`,
            Title: `Woman Farmer: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F33E`,
            Title: `Woman Farmer: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F373`,
            Title: `Man Cook`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F373`,
            Title: `Man Cook: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F373`,
            Title: `Man Cook: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F373`,
            Title: `Man Cook: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F373`,
            Title: `Man Cook: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F373`,
            Title: `Man Cook: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F373`,
            Title: `Woman Cook`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F373`,
            Title: `Woman Cook: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F373`,
            Title: `Woman Cook: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F373`,
            Title: `Woman Cook: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F373`,
            Title: `Woman Cook: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F373`,
            Title: `Woman Cook: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F527`,
            Title: `Man Mechanic`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F527`,
            Title: `Man Mechanic: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F527`,
            Title: `Man Mechanic: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F527`,
            Title: `Man Mechanic: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F527`,
            Title: `Man Mechanic: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F527`,
            Title: `Man Mechanic: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F527`,
            Title: `Woman Mechanic`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F527`,
            Title: `Woman Mechanic: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F527`,
            Title: `Woman Mechanic: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F527`,
            Title: `Woman Mechanic: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F527`,
            Title: `Woman Mechanic: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F527`,
            Title: `Woman Mechanic: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F3ED`,
            Title: `Man Factory Worker`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F3ED`,
            Title: `Man Factory Worker: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F3ED`,
            Title: `Man Factory Worker: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F3ED`,
            Title: `Man Factory Worker: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F3ED`,
            Title: `Man Factory Worker: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F3ED`,
            Title: `Man Factory Worker: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F3ED`,
            Title: `Woman Factory Worker`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F3ED`,
            Title: `Woman Factory Worker: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F3ED`,
            Title: `Woman Factory Worker: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F3ED`,
            Title: `Woman Factory Worker: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F3ED`,
            Title: `Woman Factory Worker: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F3ED`,
            Title: `Woman Factory Worker: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F4BC`,
            Title: `Man Office Worker`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F4BC`,
            Title: `Man Office Worker: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F4BC`,
            Title: `Man Office Worker: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F4BC`,
            Title: `Man Office Worker: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F4BC`,
            Title: `Man Office Worker: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F4BC`,
            Title: `Man Office Worker: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F4BC`,
            Title: `Woman Office Worker`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F4BC`,
            Title: `Woman Office Worker: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F4BC`,
            Title: `Woman Office Worker: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F4BC`,
            Title: `Woman Office Worker: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F4BC`,
            Title: `Woman Office Worker: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F4BC`,
            Title: `Woman Office Worker: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F52C`,
            Title: `Man Scientist`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F52C`,
            Title: `Man Scientist: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F52C`,
            Title: `Man Scientist: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F52C`,
            Title: `Man Scientist: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F52C`,
            Title: `Man Scientist: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F52C`,
            Title: `Man Scientist: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F52C`,
            Title: `Woman Scientist`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F52C`,
            Title: `Woman Scientist: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F52C`,
            Title: `Woman Scientist: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F52C`,
            Title: `Woman Scientist: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F52C`,
            Title: `Woman Scientist: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F52C`,
            Title: `Woman Scientist: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F4BB`,
            Title: `Man Technologist`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F4BB`,
            Title: `Man Technologist: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F4BB`,
            Title: `Man Technologist: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F4BB`,
            Title: `Man Technologist: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F4BB`,
            Title: `Man Technologist: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F4BB`,
            Title: `Man Technologist: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F4BB`,
            Title: `Woman Technologist`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F4BB`,
            Title: `Woman Technologist: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F4BB`,
            Title: `Woman Technologist: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F4BB`,
            Title: `Woman Technologist: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F4BB`,
            Title: `Woman Technologist: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F4BB`,
            Title: `Woman Technologist: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F3A4`,
            Title: `Man Singer`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F3A4`,
            Title: `Man Singer: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F3A4`,
            Title: `Man Singer: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F3A4`,
            Title: `Man Singer: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F3A4`,
            Title: `Man Singer: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F3A4`,
            Title: `Man Singer: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F3A4`,
            Title: `Woman Singer`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F3A4`,
            Title: `Woman Singer: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F3A4`,
            Title: `Woman Singer: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F3A4`,
            Title: `Woman Singer: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F3A4`,
            Title: `Woman Singer: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F3A4`,
            Title: `Woman Singer: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F3A8`,
            Title: `Man Artist`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F3A8`,
            Title: `Man Artist: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F3A8`,
            Title: `Man Artist: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F3A8`,
            Title: `Man Artist: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F3A8`,
            Title: `Man Artist: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F3A8`,
            Title: `Man Artist: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F3A8`,
            Title: `Woman Artist`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F3A8`,
            Title: `Woman Artist: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F3A8`,
            Title: `Woman Artist: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F3A8`,
            Title: `Woman Artist: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F3A8`,
            Title: `Woman Artist: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F3A8`,
            Title: `Woman Artist: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x2708&#xFE0F`,
            Title: `Man Pilot`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x2708&#xFE0F`,
            Title: `Man Pilot: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x2708&#xFE0F`,
            Title: `Man Pilot: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x2708&#xFE0F`,
            Title: `Man Pilot: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x2708&#xFE0F`,
            Title: `Man Pilot: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x2708&#xFE0F`,
            Title: `Man Pilot: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x2708&#xFE0F`,
            Title: `Woman Pilot`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x2708&#xFE0F`,
            Title: `Woman Pilot: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x2708&#xFE0F`,
            Title: `Woman Pilot: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x2708&#xFE0F`,
            Title: `Woman Pilot: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x2708&#xFE0F`,
            Title: `Woman Pilot: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x2708&#xFE0F`,
            Title: `Woman Pilot: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F680`,
            Title: `Man Astronaut`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F680`,
            Title: `Man Astronaut: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F680`,
            Title: `Man Astronaut: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F680`,
            Title: `Man Astronaut: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F680`,
            Title: `Man Astronaut: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F680`,
            Title: `Man Astronaut: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F680`,
            Title: `Woman Astronaut`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F680`,
            Title: `Woman Astronaut: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F680`,
            Title: `Woman Astronaut: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F680`,
            Title: `Woman Astronaut: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F680`,
            Title: `Woman Astronaut: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F680`,
            Title: `Woman Astronaut: Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F692`,
            Title: `Man Firefighter`
        }, {
            Emoji: `&#x1F468&#x1F3FB&#x200D&#x1F692`,
            Title: `Man Firefighter: Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FC&#x200D&#x1F692`,
            Title: `Man Firefighter: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FD&#x200D&#x1F692`,
            Title: `Man Firefighter: Medium Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FE&#x200D&#x1F692`,
            Title: `Man Firefighter: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F468&#x1F3FF&#x200D&#x1F692`,
            Title: `Man Firefighter: Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F692`,
            Title: `Woman Firefighter`
        }, {
            Emoji: `&#x1F469&#x1F3FB&#x200D&#x1F692`,
            Title: `Woman Firefighter: Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FC&#x200D&#x1F692`,
            Title: `Woman Firefighter: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FD&#x200D&#x1F692`,
            Title: `Woman Firefighter: Medium Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FE&#x200D&#x1F692`,
            Title: `Woman Firefighter: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F469&#x1F3FF&#x200D&#x1F692`,
            Title: `Woman Firefighter: Dark Skin Tone`
        }, {
            Emoji: `&#x1F46E`,
            Title: `Police Officer`
        }, {
            Emoji: `&#x1F46E&#x1F3FB`,
            Title: `Police Officer: Light Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FC`,
            Title: `Police Officer: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FD`,
            Title: `Police Officer: Medium Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FE`,
            Title: `Police Officer: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FF`,
            Title: `Police Officer: Dark Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x200D&#x2642&#xFE0F`,
            Title: `Man Police Officer`
        }, {
            Emoji: `&#x1F46E&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Police Officer: Light Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Police Officer: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Police Officer: Medium Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Police Officer: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Police Officer: Dark Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x200D&#x2640&#xFE0F`,
            Title: `Woman Police Officer`
        }, {
            Emoji: `&#x1F46E&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Police Officer: Light Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Police Officer: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Police Officer: Medium Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Police Officer: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F46E&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Police Officer: Dark Skin Tone`
        }, {
            Emoji: `&#x1F575`,
            Title: `Detective`
        }, {
            Emoji: `&#x1F575&#x1F3FB`,
            Title: `Detective: Light Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FC`,
            Title: `Detective: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FD`,
            Title: `Detective: Medium Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FE`,
            Title: `Detective: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FF`,
            Title: `Detective: Dark Skin Tone`
        }, {
            Emoji: `&#x1F575&#xFE0F&#x200D&#x2642&#xFE0F`,
            Title: `Man Detective`
        }, {
            Emoji: `&#x1F575&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Detective: Light Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Detective: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Detective: Medium Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Detective: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Detective: Dark Skin Tone`
        }, {
            Emoji: `&#x1F575&#xFE0F&#x200D&#x2640&#xFE0F`,
            Title: `Woman Detective`
        }, {
            Emoji: `&#x1F575&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Detective: Light Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Detective: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Detective: Medium Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Detective: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F575&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Detective: Dark Skin Tone`
        }, {
            Emoji: `&#x1F482`,
            Title: `Guard`
        }, {
            Emoji: `&#x1F482&#x1F3FB`,
            Title: `Guard: Light Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FC`,
            Title: `Guard: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FD`,
            Title: `Guard: Medium Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FE`,
            Title: `Guard: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FF`,
            Title: `Guard: Dark Skin Tone`
        }, {
            Emoji: `&#x1F482&#x200D&#x2642&#xFE0F`,
            Title: `Man Guard`
        }, {
            Emoji: `&#x1F482&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Guard: Light Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Guard: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Guard: Medium Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Guard: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Guard: Dark Skin Tone`
        }, {
            Emoji: `&#x1F482&#x200D&#x2640&#xFE0F`,
            Title: `Woman Guard`
        }, {
            Emoji: `&#x1F482&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Guard: Light Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Guard: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Guard: Medium Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Guard: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F482&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Guard: Dark Skin Tone`
        }, {
            Emoji: `&#x1F477`,
            Title: `Construction Worker`
        }, {
            Emoji: `&#x1F477&#x1F3FB`,
            Title: `Construction Worker: Light Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FC`,
            Title: `Construction Worker: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FD`,
            Title: `Construction Worker: Medium Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FE`,
            Title: `Construction Worker: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FF`,
            Title: `Construction Worker: Dark Skin Tone`
        }, {
            Emoji: `&#x1F477&#x200D&#x2642&#xFE0F`,
            Title: `Man Construction Worker`
        }, {
            Emoji: `&#x1F477&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Construction Worker: Light Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Construction Worker: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Construction Worker: Medium Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Construction Worker: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Construction Worker: Dark Skin Tone`
        }, {
            Emoji: `&#x1F477&#x200D&#x2640&#xFE0F`,
            Title: `Woman Construction Worker`
        }, {
            Emoji: `&#x1F477&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Construction Worker: Light Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Construction Worker: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Construction Worker: Medium Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Construction Worker: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F477&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Construction Worker: Dark Skin Tone`
        }, {
            Emoji: `&#x1F473`,
            Title: `Person Wearing Turban`
        }, {
            Emoji: `&#x1F473&#x1F3FB`,
            Title: `Person Wearing Turban: Light Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FC`,
            Title: `Person Wearing Turban: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FD`,
            Title: `Person Wearing Turban: Medium Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FE`,
            Title: `Person Wearing Turban: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FF`,
            Title: `Person Wearing Turban: Dark Skin Tone`
        }, {
            Emoji: `&#x1F473&#x200D&#x2642&#xFE0F`,
            Title: `Man Wearing Turban`
        }, {
            Emoji: `&#x1F473&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Wearing Turban: Light Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Wearing Turban: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Wearing Turban: Medium Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Wearing Turban: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Wearing Turban: Dark Skin Tone`
        }, {
            Emoji: `&#x1F473&#x200D&#x2640&#xFE0F`,
            Title: `Woman Wearing Turban`
        }, {
            Emoji: `&#x1F473&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Wearing Turban: Light Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Wearing Turban: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Wearing Turban: Medium Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Wearing Turban: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F473&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Wearing Turban: Dark Skin Tone`
        }, {
            Emoji: `&#x1F471`,
            Title: `Blond-Haired Person`
        }, {
            Emoji: `&#x1F471&#x1F3FB`,
            Title: `Blond-Haired Person: Light Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FC`,
            Title: `Blond-Haired Person: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FD`,
            Title: `Blond-Haired Person: Medium Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FE`,
            Title: `Blond-Haired Person: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FF`,
            Title: `Blond-Haired Person: Dark Skin Tone`
        }, {
            Emoji: `&#x1F471&#x200D&#x2642&#xFE0F`,
            Title: `Blond-Haired Man`
        }, {
            Emoji: `&#x1F471&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Blond-Haired Man: Light Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Blond-Haired Man: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Blond-Haired Man: Medium Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Blond-Haired Man: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Blond-Haired Man: Dark Skin Tone`
        }, {
            Emoji: `&#x1F471&#x200D&#x2640&#xFE0F`,
            Title: `Blond-Haired Woman`
        }, {
            Emoji: `&#x1F471&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Blond-Haired Woman: Light Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Blond-Haired Woman: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Blond-Haired Woman: Medium Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Blond-Haired Woman: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F471&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Blond-Haired Woman: Dark Skin Tone`
        }, {
            Emoji: `&#x1F385`,
            Title: `Santa Claus`
        }, {
            Emoji: `&#x1F385&#x1F3FB`,
            Title: `Santa Claus: Light Skin Tone`
        }, {
            Emoji: `&#x1F385&#x1F3FC`,
            Title: `Santa Claus: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F385&#x1F3FD`,
            Title: `Santa Claus: Medium Skin Tone`
        }, {
            Emoji: `&#x1F385&#x1F3FE`,
            Title: `Santa Claus: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F385&#x1F3FF`,
            Title: `Santa Claus: Dark Skin Tone`
        }, {
            Emoji: `&#x1F936`,
            Title: `Mrs. Claus`
        }, {
            Emoji: `&#x1F936&#x1F3FB`,
            Title: `Mrs. Claus: Light Skin Tone`
        }, {
            Emoji: `&#x1F936&#x1F3FC`,
            Title: `Mrs. Claus: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F936&#x1F3FD`,
            Title: `Mrs. Claus: Medium Skin Tone`
        }, {
            Emoji: `&#x1F936&#x1F3FE`,
            Title: `Mrs. Claus: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F936&#x1F3FF`,
            Title: `Mrs. Claus: Dark Skin Tone`
        }, {
            Emoji: `&#x1F478`,
            Title: `Princess`
        }, {
            Emoji: `&#x1F478&#x1F3FB`,
            Title: `Princess: Light Skin Tone`
        }, {
            Emoji: `&#x1F478&#x1F3FC`,
            Title: `Princess: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F478&#x1F3FD`,
            Title: `Princess: Medium Skin Tone`
        }, {
            Emoji: `&#x1F478&#x1F3FE`,
            Title: `Princess: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F478&#x1F3FF`,
            Title: `Princess: Dark Skin Tone`
        }, {
            Emoji: `&#x1F934`,
            Title: `Prince`
        }, {
            Emoji: `&#x1F934&#x1F3FB`,
            Title: `Prince: Light Skin Tone`
        }, {
            Emoji: `&#x1F934&#x1F3FC`,
            Title: `Prince: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F934&#x1F3FD`,
            Title: `Prince: Medium Skin Tone`
        }, {
            Emoji: `&#x1F934&#x1F3FE`,
            Title: `Prince: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F934&#x1F3FF`,
            Title: `Prince: Dark Skin Tone`
        }, {
            Emoji: `&#x1F470`,
            Title: `Bride With Veil`
        }, {
            Emoji: `&#x1F470&#x1F3FB`,
            Title: `Bride With Veil: Light Skin Tone`
        }, {
            Emoji: `&#x1F470&#x1F3FC`,
            Title: `Bride With Veil: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F470&#x1F3FD`,
            Title: `Bride With Veil: Medium Skin Tone`
        }, {
            Emoji: `&#x1F470&#x1F3FE`,
            Title: `Bride With Veil: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F470&#x1F3FF`,
            Title: `Bride With Veil: Dark Skin Tone`
        }, {
            Emoji: `&#x1F935`,
            Title: `Man In Tuxedo`
        }, {
            Emoji: `&#x1F935&#x1F3FB`,
            Title: `Man In Tuxedo: Light Skin Tone`
        }, {
            Emoji: `&#x1F935&#x1F3FC`,
            Title: `Man In Tuxedo: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F935&#x1F3FD`,
            Title: `Man In Tuxedo: Medium Skin Tone`
        }, {
            Emoji: `&#x1F935&#x1F3FE`,
            Title: `Man In Tuxedo: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F935&#x1F3FF`,
            Title: `Man In Tuxedo: Dark Skin Tone`
        }, {
            Emoji: `&#x1F930`,
            Title: `Pregnant Woman`
        }, {
            Emoji: `&#x1F930&#x1F3FB`,
            Title: `Pregnant Woman: Light Skin Tone`
        }, {
            Emoji: `&#x1F930&#x1F3FC`,
            Title: `Pregnant Woman: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F930&#x1F3FD`,
            Title: `Pregnant Woman: Medium Skin Tone`
        }, {
            Emoji: `&#x1F930&#x1F3FE`,
            Title: `Pregnant Woman: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F930&#x1F3FF`,
            Title: `Pregnant Woman: Dark Skin Tone`
        }, {
            Emoji: `&#x1F472`,
            Title: `Man With Chinese Cap`
        }, {
            Emoji: `&#x1F472&#x1F3FB`,
            Title: `Man With Chinese Cap: Light Skin Tone`
        }, {
            Emoji: `&#x1F472&#x1F3FC`,
            Title: `Man With Chinese Cap: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F472&#x1F3FD`,
            Title: `Man With Chinese Cap: Medium Skin Tone`
        }, {
            Emoji: `&#x1F472&#x1F3FE`,
            Title: `Man With Chinese Cap: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F472&#x1F3FF`,
            Title: `Man With Chinese Cap: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64D`,
            Title: `Person Frowning`
        }, {
            Emoji: `&#x1F64D&#x1F3FB`,
            Title: `Person Frowning: Light Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FC`,
            Title: `Person Frowning: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FD`,
            Title: `Person Frowning: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FE`,
            Title: `Person Frowning: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FF`,
            Title: `Person Frowning: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x200D&#x2642&#xFE0F`,
            Title: `Man Frowning`
        }, {
            Emoji: `&#x1F64D&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Frowning: Light Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Frowning: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Frowning: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Frowning: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Frowning: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x200D&#x2640&#xFE0F`,
            Title: `Woman Frowning`
        }, {
            Emoji: `&#x1F64D&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Frowning: Light Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Frowning: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Frowning: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Frowning: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64D&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Frowning: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64E`,
            Title: `Person Pouting`
        }, {
            Emoji: `&#x1F64E&#x1F3FB`,
            Title: `Person Pouting: Light Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FC`,
            Title: `Person Pouting: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FD`,
            Title: `Person Pouting: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FE`,
            Title: `Person Pouting: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FF`,
            Title: `Person Pouting: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x200D&#x2642&#xFE0F`,
            Title: `Man Pouting`
        }, {
            Emoji: `&#x1F64E&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Pouting: Light Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Pouting: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Pouting: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Pouting: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Pouting: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x200D&#x2640&#xFE0F`,
            Title: `Woman Pouting`
        }, {
            Emoji: `&#x1F64E&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Pouting: Light Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Pouting: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Pouting: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Pouting: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64E&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Pouting: Dark Skin Tone`
        }, {
            Emoji: `&#x1F645`,
            Title: `Person Gesturing NO`
        }, {
            Emoji: `&#x1F645&#x1F3FB`,
            Title: `Person Gesturing NO: Light Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FC`,
            Title: `Person Gesturing NO: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FD`,
            Title: `Person Gesturing NO: Medium Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FE`,
            Title: `Person Gesturing NO: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FF`,
            Title: `Person Gesturing NO: Dark Skin Tone`
        }, {
            Emoji: `&#x1F645&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing NO`
        }, {
            Emoji: `&#x1F645&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing NO: Light Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing NO: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing NO: Medium Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing NO: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing NO: Dark Skin Tone`
        }, {
            Emoji: `&#x1F645&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing NO`
        }, {
            Emoji: `&#x1F645&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing NO: Light Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing NO: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing NO: Medium Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing NO: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F645&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing NO: Dark Skin Tone`
        }, {
            Emoji: `&#x1F646`,
            Title: `Person Gesturing OK`
        }, {
            Emoji: `&#x1F646&#x1F3FB`,
            Title: `Person Gesturing OK: Light Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FC`,
            Title: `Person Gesturing OK: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FD`,
            Title: `Person Gesturing OK: Medium Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FE`,
            Title: `Person Gesturing OK: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FF`,
            Title: `Person Gesturing OK: Dark Skin Tone`
        }, {
            Emoji: `&#x1F646&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing OK`
        }, {
            Emoji: `&#x1F646&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing OK: Light Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing OK: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing OK: Medium Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing OK: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Gesturing OK: Dark Skin Tone`
        }, {
            Emoji: `&#x1F646&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing OK`
        }, {
            Emoji: `&#x1F646&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing OK: Light Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing OK: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing OK: Medium Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing OK: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F646&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Gesturing OK: Dark Skin Tone`
        }, {
            Emoji: `&#x1F481`,
            Title: `Person Tipping Hand`
        }, {
            Emoji: `&#x1F481&#x1F3FB`,
            Title: `Person Tipping Hand: Light Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FC`,
            Title: `Person Tipping Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FD`,
            Title: `Person Tipping Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FE`,
            Title: `Person Tipping Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FF`,
            Title: `Person Tipping Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F481&#x200D&#x2642&#xFE0F`,
            Title: `Man Tipping Hand`
        }, {
            Emoji: `&#x1F481&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Tipping Hand: Light Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Tipping Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Tipping Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Tipping Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Tipping Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F481&#x200D&#x2640&#xFE0F`,
            Title: `Woman Tipping Hand`
        }, {
            Emoji: `&#x1F481&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Tipping Hand: Light Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Tipping Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Tipping Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Tipping Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F481&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Tipping Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64B`,
            Title: `Person Raising Hand`
        }, {
            Emoji: `&#x1F64B&#x1F3FB`,
            Title: `Person Raising Hand: Light Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FC`,
            Title: `Person Raising Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FD`,
            Title: `Person Raising Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FE`,
            Title: `Person Raising Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FF`,
            Title: `Person Raising Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x200D&#x2642&#xFE0F`,
            Title: `Man Raising Hand`
        }, {
            Emoji: `&#x1F64B&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Raising Hand: Light Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Raising Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Raising Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Raising Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Raising Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x200D&#x2640&#xFE0F`,
            Title: `Woman Raising Hand`
        }, {
            Emoji: `&#x1F64B&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Raising Hand: Light Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Raising Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Raising Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Raising Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64B&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Raising Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F647`,
            Title: `Person Bowing`
        }, {
            Emoji: `&#x1F647&#x1F3FB`,
            Title: `Person Bowing: Light Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FC`,
            Title: `Person Bowing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FD`,
            Title: `Person Bowing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FE`,
            Title: `Person Bowing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FF`,
            Title: `Person Bowing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F647&#x200D&#x2642&#xFE0F`,
            Title: `Man Bowing`
        }, {
            Emoji: `&#x1F647&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Bowing: Light Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Bowing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Bowing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Bowing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Bowing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F647&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bowing`
        }, {
            Emoji: `&#x1F647&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bowing: Light Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bowing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bowing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bowing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F647&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bowing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F926`,
            Title: `Person Facepalming`
        }, {
            Emoji: `&#x1F926&#x1F3FB`,
            Title: `Person Facepalming: Light Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FC`,
            Title: `Person Facepalming: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FD`,
            Title: `Person Facepalming: Medium Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FE`,
            Title: `Person Facepalming: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FF`,
            Title: `Person Facepalming: Dark Skin Tone`
        }, {
            Emoji: `&#x1F926&#x200D&#x2642&#xFE0F`,
            Title: `Man Facepalming`
        }, {
            Emoji: `&#x1F926&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Facepalming: Light Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Facepalming: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Facepalming: Medium Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Facepalming: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Facepalming: Dark Skin Tone`
        }, {
            Emoji: `&#x1F926&#x200D&#x2640&#xFE0F`,
            Title: `Woman Facepalming`
        }, {
            Emoji: `&#x1F926&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Facepalming: Light Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Facepalming: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Facepalming: Medium Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Facepalming: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F926&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Facepalming: Dark Skin Tone`
        }, {
            Emoji: `&#x1F937`,
            Title: `Person Shrugging`
        }, {
            Emoji: `&#x1F937&#x1F3FB`,
            Title: `Person Shrugging: Light Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FC`,
            Title: `Person Shrugging: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FD`,
            Title: `Person Shrugging: Medium Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FE`,
            Title: `Person Shrugging: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FF`,
            Title: `Person Shrugging: Dark Skin Tone`
        }, {
            Emoji: `&#x1F937&#x200D&#x2642&#xFE0F`,
            Title: `Man Shrugging`
        }, {
            Emoji: `&#x1F937&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Shrugging: Light Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Shrugging: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Shrugging: Medium Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Shrugging: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Shrugging: Dark Skin Tone`
        }, {
            Emoji: `&#x1F937&#x200D&#x2640&#xFE0F`,
            Title: `Woman Shrugging`
        }, {
            Emoji: `&#x1F937&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Shrugging: Light Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Shrugging: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Shrugging: Medium Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Shrugging: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F937&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Shrugging: Dark Skin Tone`
        }, {
            Emoji: `&#x1F486`,
            Title: `Person Getting Massage`
        }, {
            Emoji: `&#x1F486&#x1F3FB`,
            Title: `Person Getting Massage: Light Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FC`,
            Title: `Person Getting Massage: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FD`,
            Title: `Person Getting Massage: Medium Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FE`,
            Title: `Person Getting Massage: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FF`,
            Title: `Person Getting Massage: Dark Skin Tone`
        }, {
            Emoji: `&#x1F486&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Massage`
        }, {
            Emoji: `&#x1F486&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Massage: Light Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Massage: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Massage: Medium Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Massage: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Massage: Dark Skin Tone`
        }, {
            Emoji: `&#x1F486&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Massage`
        }, {
            Emoji: `&#x1F486&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Massage: Light Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Massage: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Massage: Medium Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Massage: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F486&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Massage: Dark Skin Tone`
        }, {
            Emoji: `&#x1F487`,
            Title: `Person Getting Haircut`
        }, {
            Emoji: `&#x1F487&#x1F3FB`,
            Title: `Person Getting Haircut: Light Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FC`,
            Title: `Person Getting Haircut: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FD`,
            Title: `Person Getting Haircut: Medium Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FE`,
            Title: `Person Getting Haircut: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FF`,
            Title: `Person Getting Haircut: Dark Skin Tone`
        }, {
            Emoji: `&#x1F487&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Haircut`
        }, {
            Emoji: `&#x1F487&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Haircut: Light Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Haircut: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Haircut: Medium Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Haircut: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Getting Haircut: Dark Skin Tone`
        }, {
            Emoji: `&#x1F487&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Haircut`
        }, {
            Emoji: `&#x1F487&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Haircut: Light Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Haircut: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Haircut: Medium Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Haircut: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F487&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Getting Haircut: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B6`,
            Title: `Person Walking`
        }, {
            Emoji: `&#x1F6B6&#x1F3FB`,
            Title: `Person Walking: Light Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FC`,
            Title: `Person Walking: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FD`,
            Title: `Person Walking: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FE`,
            Title: `Person Walking: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FF`,
            Title: `Person Walking: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x200D&#x2642&#xFE0F`,
            Title: `Man Walking`
        }, {
            Emoji: `&#x1F6B6&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Walking: Light Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Walking: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Walking: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Walking: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Walking: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x200D&#x2640&#xFE0F`,
            Title: `Woman Walking`
        }, {
            Emoji: `&#x1F6B6&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Walking: Light Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Walking: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Walking: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Walking: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B6&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Walking: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C3`,
            Title: `Person Running`
        }, {
            Emoji: `&#x1F3C3&#x1F3FB`,
            Title: `Person Running: Light Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FC`,
            Title: `Person Running: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FD`,
            Title: `Person Running: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FE`,
            Title: `Person Running: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FF`,
            Title: `Person Running: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x200D&#x2642&#xFE0F`,
            Title: `Man Running`
        }, {
            Emoji: `&#x1F3C3&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Running: Light Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Running: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Running: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Running: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Running: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x200D&#x2640&#xFE0F`,
            Title: `Woman Running`
        }, {
            Emoji: `&#x1F3C3&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Running: Light Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Running: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Running: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Running: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C3&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Running: Dark Skin Tone`
        }, {
            Emoji: `&#x1F483`,
            Title: `Woman Dancing`
        }, {
            Emoji: `&#x1F483&#x1F3FB`,
            Title: `Woman Dancing: Light Skin Tone`
        }, {
            Emoji: `&#x1F483&#x1F3FC`,
            Title: `Woman Dancing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F483&#x1F3FD`,
            Title: `Woman Dancing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F483&#x1F3FE`,
            Title: `Woman Dancing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F483&#x1F3FF`,
            Title: `Woman Dancing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F57A`,
            Title: `Man Dancing`
        }, {
            Emoji: `&#x1F57A&#x1F3FB`,
            Title: `Man Dancing: Light Skin Tone`
        }, {
            Emoji: `&#x1F57A&#x1F3FC`,
            Title: `Man Dancing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F57A&#x1F3FD`,
            Title: `Man Dancing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F57A&#x1F3FE`,
            Title: `Man Dancing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F57A&#x1F3FF`,
            Title: `Man Dancing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F46F`,
            Title: `People With Bunny Ears Partying`
        }, {
            Emoji: `&#x1F46F&#x200D&#x2642&#xFE0F`,
            Title: `Men With Bunny Ears Partying`
        }, {
            Emoji: `&#x1F46F&#x200D&#x2640&#xFE0F`,
            Title: `Women With Bunny Ears Partying`
        }, {
            Emoji: `&#x1F574`,
            Title: `Man In Business Suit Levitating`
        }, {
            Emoji: `&#x1F574&#x1F3FB`,
            Title: `Man In Business Suit Levitating: Light Skin Tone`
        }, {
            Emoji: `&#x1F574&#x1F3FC`,
            Title: `Man In Business Suit Levitating: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F574&#x1F3FD`,
            Title: `Man In Business Suit Levitating: Medium Skin Tone`
        }, {
            Emoji: `&#x1F574&#x1F3FE`,
            Title: `Man In Business Suit Levitating: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F574&#x1F3FF`,
            Title: `Man In Business Suit Levitating: Dark Skin Tone`
        }, {
            Emoji: `&#x1F5E3`,
            Title: `Speaking Head`
        }, {
            Emoji: `&#x1F464`,
            Title: `Bust In Silhouette`
        }, {
            Emoji: `&#x1F465`,
            Title: `Busts In Silhouette`
        }, {
            Emoji: `&#x1F93A`,
            Title: `Person Fencing`
        }, {
            Emoji: `&#x1F3C7`,
            Title: `Horse Racing`
        }, {
            Emoji: `&#x1F3C7&#x1F3FB`,
            Title: `Horse Racing: Light Skin Tone`
        }, {
            Emoji: `&#x1F3C7&#x1F3FC`,
            Title: `Horse Racing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3C7&#x1F3FD`,
            Title: `Horse Racing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3C7&#x1F3FE`,
            Title: `Horse Racing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C7&#x1F3FF`,
            Title: `Horse Racing: Dark Skin Tone`
        }, {
            Emoji: `&#x26F7`,
            Title: `Skier`
        }, {
            Emoji: `&#x1F3C2`,
            Title: `Snowboarder`
        }, {
            Emoji: `&#x1F3C2&#x1F3FB`,
            Title: `Snowboarder: Light Skin Tone`
        }, {
            Emoji: `&#x1F3C2&#x1F3FC`,
            Title: `Snowboarder: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3C2&#x1F3FD`,
            Title: `Snowboarder: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3C2&#x1F3FE`,
            Title: `Snowboarder: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C2&#x1F3FF`,
            Title: `Snowboarder: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CC`,
            Title: `Person Golfing`
        }, {
            Emoji: `&#x1F3CC&#x1F3FB`,
            Title: `Person Golfing: Light Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FC`,
            Title: `Person Golfing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FD`,
            Title: `Person Golfing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FE`,
            Title: `Person Golfing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FF`,
            Title: `Person Golfing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#xFE0F&#x200D&#x2642&#xFE0F`,
            Title: `Man Golfing`
        }, {
            Emoji: `&#x1F3CC&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Golfing: Light Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Golfing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Golfing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Golfing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Golfing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#xFE0F&#x200D&#x2640&#xFE0F`,
            Title: `Woman Golfing`
        }, {
            Emoji: `&#x1F3CC&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Golfing: Light Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Golfing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Golfing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Golfing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CC&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Golfing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C4`,
            Title: `Person Surfing`
        }, {
            Emoji: `&#x1F3C4&#x1F3FB`,
            Title: `Person Surfing: Light Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FC`,
            Title: `Person Surfing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FD`,
            Title: `Person Surfing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FE`,
            Title: `Person Surfing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FF`,
            Title: `Person Surfing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x200D&#x2642&#xFE0F`,
            Title: `Man Surfing`
        }, {
            Emoji: `&#x1F3C4&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Surfing: Light Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Surfing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Surfing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Surfing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Surfing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x200D&#x2640&#xFE0F`,
            Title: `Woman Surfing`
        }, {
            Emoji: `&#x1F3C4&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Surfing: Light Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Surfing: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Surfing: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Surfing: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3C4&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Surfing: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6A3`,
            Title: `Person Rowing Boat`
        }, {
            Emoji: `&#x1F6A3&#x1F3FB`,
            Title: `Person Rowing Boat: Light Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FC`,
            Title: `Person Rowing Boat: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FD`,
            Title: `Person Rowing Boat: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FE`,
            Title: `Person Rowing Boat: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FF`,
            Title: `Person Rowing Boat: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x200D&#x2642&#xFE0F`,
            Title: `Man Rowing Boat`
        }, {
            Emoji: `&#x1F6A3&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Rowing Boat: Light Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Rowing Boat: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Rowing Boat: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Rowing Boat: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Rowing Boat: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x200D&#x2640&#xFE0F`,
            Title: `Woman Rowing Boat`
        }, {
            Emoji: `&#x1F6A3&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Rowing Boat: Light Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Rowing Boat: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Rowing Boat: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Rowing Boat: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6A3&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Rowing Boat: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CA`,
            Title: `Person Swimming`
        }, {
            Emoji: `&#x1F3CA&#x1F3FB`,
            Title: `Person Swimming: Light Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FC`,
            Title: `Person Swimming: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FD`,
            Title: `Person Swimming: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FE`,
            Title: `Person Swimming: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FF`,
            Title: `Person Swimming: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x200D&#x2642&#xFE0F`,
            Title: `Man Swimming`
        }, {
            Emoji: `&#x1F3CA&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Swimming: Light Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Swimming: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Swimming: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Swimming: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Swimming: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x200D&#x2640&#xFE0F`,
            Title: `Woman Swimming`
        }, {
            Emoji: `&#x1F3CA&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Swimming: Light Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Swimming: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Swimming: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Swimming: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CA&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Swimming: Dark Skin Tone`
        }, {
            Emoji: `&#x26F9`,
            Title: `Person Bouncing Ball`
        }, {
            Emoji: `&#x26F9&#x1F3FB`,
            Title: `Person Bouncing Ball: Light Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FC`,
            Title: `Person Bouncing Ball: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FD`,
            Title: `Person Bouncing Ball: Medium Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FE`,
            Title: `Person Bouncing Ball: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FF`,
            Title: `Person Bouncing Ball: Dark Skin Tone`
        }, {
            Emoji: `&#x26F9&#xFE0F&#x200D&#x2642&#xFE0F`,
            Title: `Man Bouncing Ball`
        }, {
            Emoji: `&#x26F9&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Bouncing Ball: Light Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Bouncing Ball: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Bouncing Ball: Medium Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Bouncing Ball: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Bouncing Ball: Dark Skin Tone`
        }, {
            Emoji: `&#x26F9&#xFE0F&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bouncing Ball`
        }, {
            Emoji: `&#x26F9&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bouncing Ball: Light Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bouncing Ball: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bouncing Ball: Medium Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bouncing Ball: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x26F9&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Bouncing Ball: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CB`,
            Title: `Person Lifting Weights`
        }, {
            Emoji: `&#x1F3CB&#x1F3FB`,
            Title: `Person Lifting Weights: Light Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FC`,
            Title: `Person Lifting Weights: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FD`,
            Title: `Person Lifting Weights: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FE`,
            Title: `Person Lifting Weights: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FF`,
            Title: `Person Lifting Weights: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#xFE0F&#x200D&#x2642&#xFE0F`,
            Title: `Man Lifting Weights`
        }, {
            Emoji: `&#x1F3CB&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Lifting Weights: Light Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Lifting Weights: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Lifting Weights: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Lifting Weights: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Lifting Weights: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#xFE0F&#x200D&#x2640&#xFE0F`,
            Title: `Woman Lifting Weights`
        }, {
            Emoji: `&#x1F3CB&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Lifting Weights: Light Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Lifting Weights: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Lifting Weights: Medium Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Lifting Weights: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CB&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Lifting Weights: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B4`,
            Title: `Person Biking`
        }, {
            Emoji: `&#x1F6B4&#x1F3FB`,
            Title: `Person Biking: Light Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FC`,
            Title: `Person Biking: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FD`,
            Title: `Person Biking: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FE`,
            Title: `Person Biking: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FF`,
            Title: `Person Biking: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x200D&#x2642&#xFE0F`,
            Title: `Man Biking`
        }, {
            Emoji: `&#x1F6B4&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Biking: Light Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Biking: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Biking: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Biking: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Biking: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x200D&#x2640&#xFE0F`,
            Title: `Woman Biking`
        }, {
            Emoji: `&#x1F6B4&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Biking: Light Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Biking: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Biking: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Biking: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B4&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Biking: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B5`,
            Title: `Person Mountain Biking`
        }, {
            Emoji: `&#x1F6B5&#x1F3FB`,
            Title: `Person Mountain Biking: Light Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FC`,
            Title: `Person Mountain Biking: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FD`,
            Title: `Person Mountain Biking: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FE`,
            Title: `Person Mountain Biking: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FF`,
            Title: `Person Mountain Biking: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x200D&#x2642&#xFE0F`,
            Title: `Man Mountain Biking`
        }, {
            Emoji: `&#x1F6B5&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Mountain Biking: Light Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Mountain Biking: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Mountain Biking: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Mountain Biking: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Mountain Biking: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x200D&#x2640&#xFE0F`,
            Title: `Woman Mountain Biking`
        }, {
            Emoji: `&#x1F6B5&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Mountain Biking: Light Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Mountain Biking: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Mountain Biking: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Mountain Biking: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6B5&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Mountain Biking: Dark Skin Tone`
        }, {
            Emoji: `&#x1F3CE`,
            Title: `Racing Car`
        }, {
            Emoji: `&#x1F3CD`,
            Title: `Motorcycle`
        }, {
            Emoji: `&#x1F938`,
            Title: `Person Cartwheeling`
        }, {
            Emoji: `&#x1F938&#x1F3FB`,
            Title: `Person Cartwheeling: Light Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FC`,
            Title: `Person Cartwheeling: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FD`,
            Title: `Person Cartwheeling: Medium Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FE`,
            Title: `Person Cartwheeling: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FF`,
            Title: `Person Cartwheeling: Dark Skin Tone`
        }, {
            Emoji: `&#x1F938&#x200D&#x2642&#xFE0F`,
            Title: `Man Cartwheeling`
        }, {
            Emoji: `&#x1F938&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Cartwheeling: Light Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Cartwheeling: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Cartwheeling: Medium Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Cartwheeling: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Cartwheeling: Dark Skin Tone`
        }, {
            Emoji: `&#x1F938&#x200D&#x2640&#xFE0F`,
            Title: `Woman Cartwheeling`
        }, {
            Emoji: `&#x1F938&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Cartwheeling: Light Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Cartwheeling: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Cartwheeling: Medium Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Cartwheeling: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F938&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Cartwheeling: Dark Skin Tone`
        }, {
            Emoji: `&#x1F93C`,
            Title: `People Wrestling`
        }, {
            Emoji: `&#x1F93C&#x200D&#x2642&#xFE0F`,
            Title: `Men Wrestling`
        }, {
            Emoji: `&#x1F93C&#x200D&#x2640&#xFE0F`,
            Title: `Women Wrestling`
        }, {
            Emoji: `&#x1F93D`,
            Title: `Person Playing Water Polo`
        }, {
            Emoji: `&#x1F93D&#x1F3FB`,
            Title: `Person Playing Water Polo: Light Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FC`,
            Title: `Person Playing Water Polo: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FD`,
            Title: `Person Playing Water Polo: Medium Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FE`,
            Title: `Person Playing Water Polo: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FF`,
            Title: `Person Playing Water Polo: Dark Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Water Polo`
        }, {
            Emoji: `&#x1F93D&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Water Polo: Light Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Water Polo: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Water Polo: Medium Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Water Polo: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Water Polo: Dark Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Water Polo`
        }, {
            Emoji: `&#x1F93D&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Water Polo: Light Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Water Polo: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Water Polo: Medium Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Water Polo: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F93D&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Water Polo: Dark Skin Tone`
        }, {
            Emoji: `&#x1F93E`,
            Title: `Person Playing Handball`
        }, {
            Emoji: `&#x1F93E&#x1F3FB`,
            Title: `Person Playing Handball: Light Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FC`,
            Title: `Person Playing Handball: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FD`,
            Title: `Person Playing Handball: Medium Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FE`,
            Title: `Person Playing Handball: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FF`,
            Title: `Person Playing Handball: Dark Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Handball`
        }, {
            Emoji: `&#x1F93E&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Handball: Light Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Handball: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Handball: Medium Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Handball: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Playing Handball: Dark Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Handball`
        }, {
            Emoji: `&#x1F93E&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Handball: Light Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Handball: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Handball: Medium Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Handball: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F93E&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Playing Handball: Dark Skin Tone`
        }, {
            Emoji: `&#x1F939`,
            Title: `Person Juggling`
        }, {
            Emoji: `&#x1F939&#x1F3FB`,
            Title: `Person Juggling: Light Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FC`,
            Title: `Person Juggling: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FD`,
            Title: `Person Juggling: Medium Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FE`,
            Title: `Person Juggling: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FF`,
            Title: `Person Juggling: Dark Skin Tone`
        }, {
            Emoji: `&#x1F939&#x200D&#x2642&#xFE0F`,
            Title: `Man Juggling`
        }, {
            Emoji: `&#x1F939&#x1F3FB&#x200D&#x2642&#xFE0F`,
            Title: `Man Juggling: Light Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FC&#x200D&#x2642&#xFE0F`,
            Title: `Man Juggling: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FD&#x200D&#x2642&#xFE0F`,
            Title: `Man Juggling: Medium Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FE&#x200D&#x2642&#xFE0F`,
            Title: `Man Juggling: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FF&#x200D&#x2642&#xFE0F`,
            Title: `Man Juggling: Dark Skin Tone`
        }, {
            Emoji: `&#x1F939&#x200D&#x2640&#xFE0F`,
            Title: `Woman Juggling`
        }, {
            Emoji: `&#x1F939&#x1F3FB&#x200D&#x2640&#xFE0F`,
            Title: `Woman Juggling: Light Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FC&#x200D&#x2640&#xFE0F`,
            Title: `Woman Juggling: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FD&#x200D&#x2640&#xFE0F`,
            Title: `Woman Juggling: Medium Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FE&#x200D&#x2640&#xFE0F`,
            Title: `Woman Juggling: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F939&#x1F3FF&#x200D&#x2640&#xFE0F`,
            Title: `Woman Juggling: Dark Skin Tone`
        }, {
            Emoji: `&#x1F46B`,
            Title: `Man And Woman Holding Hands`
        }, {
            Emoji: `&#x1F46C`,
            Title: `Two Men Holding Hands`
        }, {
            Emoji: `&#x1F46D`,
            Title: `Two Women Holding Hands`
        }, {
            Emoji: `&#x1F48F`,
            Title: `Kiss`
        }, {
            Emoji: `&#x1F469&#x200D&#x2764&#xFE0F&#x200D&#x1F48B&#x200D&#x1F468`,
            Title: `Kiss: Woman, Man`
        }, {
            Emoji: `&#x1F468&#x200D&#x2764&#xFE0F&#x200D&#x1F48B&#x200D&#x1F468`,
            Title: `Kiss: Man, Man`
        }, {
            Emoji: `&#x1F469&#x200D&#x2764&#xFE0F&#x200D&#x1F48B&#x200D&#x1F469`,
            Title: `Kiss: Woman, Woman`
        }, {
            Emoji: `&#x1F491`,
            Title: `Couple With Heart`
        }, {
            Emoji: `&#x1F469&#x200D&#x2764&#xFE0F&#x200D&#x1F468`,
            Title: `Couple With Heart: Woman, Man`
        }, {
            Emoji: `&#x1F468&#x200D&#x2764&#xFE0F&#x200D&#x1F468`,
            Title: `Couple With Heart: Man, Man`
        }, {
            Emoji: `&#x1F469&#x200D&#x2764&#xFE0F&#x200D&#x1F469`,
            Title: `Couple With Heart: Woman, Woman`
        }, {
            Emoji: `&#x1F46A`,
            Title: `Family`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F469&#x200D&#x1F466`,
            Title: `Family: Man, Woman, Boy`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F469&#x200D&#x1F467`,
            Title: `Family: Man, Woman, Girl`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F469&#x200D&#x1F467&#x200D&#x1F466`,
            Title: `Family: Man, Woman, Girl, Boy`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F469&#x200D&#x1F466&#x200D&#x1F466`,
            Title: `Family: Man, Woman, Boy, Boy`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F469&#x200D&#x1F467&#x200D&#x1F467`,
            Title: `Family: Man, Woman, Girl, Girl`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F468&#x200D&#x1F466`,
            Title: `Family: Man, Man, Boy`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F468&#x200D&#x1F467`,
            Title: `Family: Man, Man, Girl`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F468&#x200D&#x1F467&#x200D&#x1F466`,
            Title: `Family: Man, Man, Girl, Boy`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F468&#x200D&#x1F466&#x200D&#x1F466`,
            Title: `Family: Man, Man, Boy, Boy`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F468&#x200D&#x1F467&#x200D&#x1F467`,
            Title: `Family: Man, Man, Girl, Girl`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F469&#x200D&#x1F466`,
            Title: `Family: Woman, Woman, Boy`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F469&#x200D&#x1F467`,
            Title: `Family: Woman, Woman, Girl`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F469&#x200D&#x1F467&#x200D&#x1F466`,
            Title: `Family: Woman, Woman, Girl, Boy`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F469&#x200D&#x1F466&#x200D&#x1F466`,
            Title: `Family: Woman, Woman, Boy, Boy`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F469&#x200D&#x1F467&#x200D&#x1F467`,
            Title: `Family: Woman, Woman, Girl, Girl`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F466`,
            Title: `Family: Man, Boy`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F466&#x200D&#x1F466`,
            Title: `Family: Man, Boy, Boy`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F467`,
            Title: `Family: Man, Girl`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F467&#x200D&#x1F466`,
            Title: `Family: Man, Girl, Boy`
        }, {
            Emoji: `&#x1F468&#x200D&#x1F467&#x200D&#x1F467`,
            Title: `Family: Man, Girl, Girl`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F466`,
            Title: `Family: Woman, Boy`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F466&#x200D&#x1F466`,
            Title: `Family: Woman, Boy, Boy`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F467`,
            Title: `Family: Woman, Girl`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F467&#x200D&#x1F466`,
            Title: `Family: Woman, Girl, Boy`
        }, {
            Emoji: `&#x1F469&#x200D&#x1F467&#x200D&#x1F467`,
            Title: `Family: Woman, Girl, Girl`
        }, {
            Emoji: `&#x1F3FB`,
            Title: `Light Skin Tone`
        }, {
            Emoji: `&#x1F3FC`,
            Title: `Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F3FD`,
            Title: `Medium Skin Tone`
        }, {
            Emoji: `&#x1F3FE`,
            Title: `Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F3FF`,
            Title: `Dark Skin Tone`
        }, {
            Emoji: `&#x1F4AA`,
            Title: `Flexed Biceps`
        }, {
            Emoji: `&#x1F4AA&#x1F3FB`,
            Title: `Flexed Biceps: Light Skin Tone`
        }, {
            Emoji: `&#x1F4AA&#x1F3FC`,
            Title: `Flexed Biceps: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F4AA&#x1F3FD`,
            Title: `Flexed Biceps: Medium Skin Tone`
        }, {
            Emoji: `&#x1F4AA&#x1F3FE`,
            Title: `Flexed Biceps: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F4AA&#x1F3FF`,
            Title: `Flexed Biceps: Dark Skin Tone`
        }, {
            Emoji: `&#x1F933`,
            Title: `Selfie`
        }, {
            Emoji: `&#x1F933&#x1F3FB`,
            Title: `Selfie: Light Skin Tone`
        }, {
            Emoji: `&#x1F933&#x1F3FC`,
            Title: `Selfie: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F933&#x1F3FD`,
            Title: `Selfie: Medium Skin Tone`
        }, {
            Emoji: `&#x1F933&#x1F3FE`,
            Title: `Selfie: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F933&#x1F3FF`,
            Title: `Selfie: Dark Skin Tone`
        }, {
            Emoji: `&#x1F448`,
            Title: `Backhand Index Pointing Left`
        }, {
            Emoji: `&#x1F448&#x1F3FB`,
            Title: `Backhand Index Pointing Left: Light Skin Tone`
        }, {
            Emoji: `&#x1F448&#x1F3FC`,
            Title: `Backhand Index Pointing Left: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F448&#x1F3FD`,
            Title: `Backhand Index Pointing Left: Medium Skin Tone`
        }, {
            Emoji: `&#x1F448&#x1F3FE`,
            Title: `Backhand Index Pointing Left: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F448&#x1F3FF`,
            Title: `Backhand Index Pointing Left: Dark Skin Tone`
        }, {
            Emoji: `&#x1F449`,
            Title: `Backhand Index Pointing Right`
        }, {
            Emoji: `&#x1F449&#x1F3FB`,
            Title: `Backhand Index Pointing Right: Light Skin Tone`
        }, {
            Emoji: `&#x1F449&#x1F3FC`,
            Title: `Backhand Index Pointing Right: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F449&#x1F3FD`,
            Title: `Backhand Index Pointing Right: Medium Skin Tone`
        }, {
            Emoji: `&#x1F449&#x1F3FE`,
            Title: `Backhand Index Pointing Right: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F449&#x1F3FF`,
            Title: `Backhand Index Pointing Right: Dark Skin Tone`
        }, {
            Emoji: `&#x261D`,
            Title: `Index Pointing Up`
        }, {
            Emoji: `&#x261D&#x1F3FB`,
            Title: `Index Pointing Up: Light Skin Tone`
        }, {
            Emoji: `&#x261D&#x1F3FC`,
            Title: `Index Pointing Up: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x261D&#x1F3FD`,
            Title: `Index Pointing Up: Medium Skin Tone`
        }, {
            Emoji: `&#x261D&#x1F3FE`,
            Title: `Index Pointing Up: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x261D&#x1F3FF`,
            Title: `Index Pointing Up: Dark Skin Tone`
        }, {
            Emoji: `&#x1F446`,
            Title: `Backhand Index Pointing Up`
        }, {
            Emoji: `&#x1F446&#x1F3FB`,
            Title: `Backhand Index Pointing Up: Light Skin Tone`
        }, {
            Emoji: `&#x1F446&#x1F3FC`,
            Title: `Backhand Index Pointing Up: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F446&#x1F3FD`,
            Title: `Backhand Index Pointing Up: Medium Skin Tone`
        }, {
            Emoji: `&#x1F446&#x1F3FE`,
            Title: `Backhand Index Pointing Up: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F446&#x1F3FF`,
            Title: `Backhand Index Pointing Up: Dark Skin Tone`
        }, {
            Emoji: `&#x1F595`,
            Title: `Middle Finger`
        }, {
            Emoji: `&#x1F595&#x1F3FB`,
            Title: `Middle Finger: Light Skin Tone`
        }, {
            Emoji: `&#x1F595&#x1F3FC`,
            Title: `Middle Finger: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F595&#x1F3FD`,
            Title: `Middle Finger: Medium Skin Tone`
        }, {
            Emoji: `&#x1F595&#x1F3FE`,
            Title: `Middle Finger: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F595&#x1F3FF`,
            Title: `Middle Finger: Dark Skin Tone`
        }, {
            Emoji: `&#x1F447`,
            Title: `Backhand Index Pointing Down`
        }, {
            Emoji: `&#x1F447&#x1F3FB`,
            Title: `Backhand Index Pointing Down: Light Skin Tone`
        }, {
            Emoji: `&#x1F447&#x1F3FC`,
            Title: `Backhand Index Pointing Down: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F447&#x1F3FD`,
            Title: `Backhand Index Pointing Down: Medium Skin Tone`
        }, {
            Emoji: `&#x1F447&#x1F3FE`,
            Title: `Backhand Index Pointing Down: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F447&#x1F3FF`,
            Title: `Backhand Index Pointing Down: Dark Skin Tone`
        }, {
            Emoji: `&#x270C`,
            Title: `Victory Hand`
        }, {
            Emoji: `&#x270C&#x1F3FB`,
            Title: `Victory Hand: Light Skin Tone`
        }, {
            Emoji: `&#x270C&#x1F3FC`,
            Title: `Victory Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x270C&#x1F3FD`,
            Title: `Victory Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x270C&#x1F3FE`,
            Title: `Victory Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x270C&#x1F3FF`,
            Title: `Victory Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F91E`,
            Title: `Crossed Fingers`
        }, {
            Emoji: `&#x1F91E&#x1F3FB`,
            Title: `Crossed Fingers: Light Skin Tone`
        }, {
            Emoji: `&#x1F91E&#x1F3FC`,
            Title: `Crossed Fingers: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F91E&#x1F3FD`,
            Title: `Crossed Fingers: Medium Skin Tone`
        }, {
            Emoji: `&#x1F91E&#x1F3FE`,
            Title: `Crossed Fingers: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F91E&#x1F3FF`,
            Title: `Crossed Fingers: Dark Skin Tone`
        }, {
            Emoji: `&#x1F596`,
            Title: `Vulcan Salute`
        }, {
            Emoji: `&#x1F596&#x1F3FB`,
            Title: `Vulcan Salute: Light Skin Tone`
        }, {
            Emoji: `&#x1F596&#x1F3FC`,
            Title: `Vulcan Salute: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F596&#x1F3FD`,
            Title: `Vulcan Salute: Medium Skin Tone`
        }, {
            Emoji: `&#x1F596&#x1F3FE`,
            Title: `Vulcan Salute: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F596&#x1F3FF`,
            Title: `Vulcan Salute: Dark Skin Tone`
        }, {
            Emoji: `&#x1F918`,
            Title: `Sign Of The Horns`
        }, {
            Emoji: `&#x1F918&#x1F3FB`,
            Title: `Sign Of The Horns: Light Skin Tone`
        }, {
            Emoji: `&#x1F918&#x1F3FC`,
            Title: `Sign Of The Horns: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F918&#x1F3FD`,
            Title: `Sign Of The Horns: Medium Skin Tone`
        }, {
            Emoji: `&#x1F918&#x1F3FE`,
            Title: `Sign Of The Horns: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F918&#x1F3FF`,
            Title: `Sign Of The Horns: Dark Skin Tone`
        }, {
            Emoji: `&#x1F919`,
            Title: `Call Me Hand`
        }, {
            Emoji: `&#x1F919&#x1F3FB`,
            Title: `Call Me Hand: Light Skin Tone`
        }, {
            Emoji: `&#x1F919&#x1F3FC`,
            Title: `Call Me Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F919&#x1F3FD`,
            Title: `Call Me Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x1F919&#x1F3FE`,
            Title: `Call Me Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F919&#x1F3FF`,
            Title: `Call Me Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F590`,
            Title: `Raised Hand With Fingers Splayed`
        }, {
            Emoji: `&#x1F590&#x1F3FB`,
            Title: `Raised Hand With Fingers Splayed: Light Skin Tone`
        }, {
            Emoji: `&#x1F590&#x1F3FC`,
            Title: `Raised Hand With Fingers Splayed: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F590&#x1F3FD`,
            Title: `Raised Hand With Fingers Splayed: Medium Skin Tone`
        }, {
            Emoji: `&#x1F590&#x1F3FE`,
            Title: `Raised Hand With Fingers Splayed: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F590&#x1F3FF`,
            Title: `Raised Hand With Fingers Splayed: Dark Skin Tone`
        }, {
            Emoji: `&#x270B`,
            Title: `Raised Hand`
        }, {
            Emoji: `&#x270B&#x1F3FB`,
            Title: `Raised Hand: Light Skin Tone`
        }, {
            Emoji: `&#x270B&#x1F3FC`,
            Title: `Raised Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x270B&#x1F3FD`,
            Title: `Raised Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x270B&#x1F3FE`,
            Title: `Raised Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x270B&#x1F3FF`,
            Title: `Raised Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F44C`,
            Title: `OK Hand`
        }, {
            Emoji: `&#x1F44C&#x1F3FB`,
            Title: `OK Hand: Light Skin Tone`
        }, {
            Emoji: `&#x1F44C&#x1F3FC`,
            Title: `OK Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F44C&#x1F3FD`,
            Title: `OK Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x1F44C&#x1F3FE`,
            Title: `OK Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F44C&#x1F3FF`,
            Title: `OK Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F44D`,
            Title: `Thumbs Up`
        }, {
            Emoji: `&#x1F44D&#x1F3FB`,
            Title: `Thumbs Up: Light Skin Tone`
        }, {
            Emoji: `&#x1F44D&#x1F3FC`,
            Title: `Thumbs Up: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F44D&#x1F3FD`,
            Title: `Thumbs Up: Medium Skin Tone`
        }, {
            Emoji: `&#x1F44D&#x1F3FE`,
            Title: `Thumbs Up: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F44D&#x1F3FF`,
            Title: `Thumbs Up: Dark Skin Tone`
        }, {
            Emoji: `&#x1F44E`,
            Title: `Thumbs Down`
        }, {
            Emoji: `&#x1F44E&#x1F3FB`,
            Title: `Thumbs Down: Light Skin Tone`
        }, {
            Emoji: `&#x1F44E&#x1F3FC`,
            Title: `Thumbs Down: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F44E&#x1F3FD`,
            Title: `Thumbs Down: Medium Skin Tone`
        }, {
            Emoji: `&#x1F44E&#x1F3FE`,
            Title: `Thumbs Down: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F44E&#x1F3FF`,
            Title: `Thumbs Down: Dark Skin Tone`
        }, {
            Emoji: `&#x270A`,
            Title: `Raised Fist`
        }, {
            Emoji: `&#x270A&#x1F3FB`,
            Title: `Raised Fist: Light Skin Tone`
        }, {
            Emoji: `&#x270A&#x1F3FC`,
            Title: `Raised Fist: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x270A&#x1F3FD`,
            Title: `Raised Fist: Medium Skin Tone`
        }, {
            Emoji: `&#x270A&#x1F3FE`,
            Title: `Raised Fist: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x270A&#x1F3FF`,
            Title: `Raised Fist: Dark Skin Tone`
        }, {
            Emoji: `&#x1F44A`,
            Title: `Oncoming Fist`
        }, {
            Emoji: `&#x1F44A&#x1F3FB`,
            Title: `Oncoming Fist: Light Skin Tone`
        }, {
            Emoji: `&#x1F44A&#x1F3FC`,
            Title: `Oncoming Fist: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F44A&#x1F3FD`,
            Title: `Oncoming Fist: Medium Skin Tone`
        }, {
            Emoji: `&#x1F44A&#x1F3FE`,
            Title: `Oncoming Fist: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F44A&#x1F3FF`,
            Title: `Oncoming Fist: Dark Skin Tone`
        }, {
            Emoji: `&#x1F91B`,
            Title: `Left-Facing Fist`
        }, {
            Emoji: `&#x1F91B&#x1F3FB`,
            Title: `Left-Facing Fist: Light Skin Tone`
        }, {
            Emoji: `&#x1F91B&#x1F3FC`,
            Title: `Left-Facing Fist: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F91B&#x1F3FD`,
            Title: `Left-Facing Fist: Medium Skin Tone`
        }, {
            Emoji: `&#x1F91B&#x1F3FE`,
            Title: `Left-Facing Fist: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F91B&#x1F3FF`,
            Title: `Left-Facing Fist: Dark Skin Tone`
        }, {
            Emoji: `&#x1F91C`,
            Title: `Right-Facing Fist`
        }, {
            Emoji: `&#x1F91C&#x1F3FB`,
            Title: `Right-Facing Fist: Light Skin Tone`
        }, {
            Emoji: `&#x1F91C&#x1F3FC`,
            Title: `Right-Facing Fist: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F91C&#x1F3FD`,
            Title: `Right-Facing Fist: Medium Skin Tone`
        }, {
            Emoji: `&#x1F91C&#x1F3FE`,
            Title: `Right-Facing Fist: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F91C&#x1F3FF`,
            Title: `Right-Facing Fist: Dark Skin Tone`
        }, {
            Emoji: `&#x1F91A`,
            Title: `Raised Back Of Hand`
        }, {
            Emoji: `&#x1F91A&#x1F3FB`,
            Title: `Raised Back Of Hand: Light Skin Tone`
        }, {
            Emoji: `&#x1F91A&#x1F3FC`,
            Title: `Raised Back Of Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F91A&#x1F3FD`,
            Title: `Raised Back Of Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x1F91A&#x1F3FE`,
            Title: `Raised Back Of Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F91A&#x1F3FF`,
            Title: `Raised Back Of Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F44B`,
            Title: `Waving Hand`
        }, {
            Emoji: `&#x1F44B&#x1F3FB`,
            Title: `Waving Hand: Light Skin Tone`
        }, {
            Emoji: `&#x1F44B&#x1F3FC`,
            Title: `Waving Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F44B&#x1F3FD`,
            Title: `Waving Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x1F44B&#x1F3FE`,
            Title: `Waving Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F44B&#x1F3FF`,
            Title: `Waving Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F44F`,
            Title: `Clapping Hands`
        }, {
            Emoji: `&#x1F44F&#x1F3FB`,
            Title: `Clapping Hands: Light Skin Tone`
        }, {
            Emoji: `&#x1F44F&#x1F3FC`,
            Title: `Clapping Hands: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F44F&#x1F3FD`,
            Title: `Clapping Hands: Medium Skin Tone`
        }, {
            Emoji: `&#x1F44F&#x1F3FE`,
            Title: `Clapping Hands: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F44F&#x1F3FF`,
            Title: `Clapping Hands: Dark Skin Tone`
        }, {
            Emoji: `&#x270D`,
            Title: `Writing Hand`
        }, {
            Emoji: `&#x270D&#x1F3FB`,
            Title: `Writing Hand: Light Skin Tone`
        }, {
            Emoji: `&#x270D&#x1F3FC`,
            Title: `Writing Hand: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x270D&#x1F3FD`,
            Title: `Writing Hand: Medium Skin Tone`
        }, {
            Emoji: `&#x270D&#x1F3FE`,
            Title: `Writing Hand: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x270D&#x1F3FF`,
            Title: `Writing Hand: Dark Skin Tone`
        }, {
            Emoji: `&#x1F450`,
            Title: `Open Hands`
        }, {
            Emoji: `&#x1F450&#x1F3FB`,
            Title: `Open Hands: Light Skin Tone`
        }, {
            Emoji: `&#x1F450&#x1F3FC`,
            Title: `Open Hands: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F450&#x1F3FD`,
            Title: `Open Hands: Medium Skin Tone`
        }, {
            Emoji: `&#x1F450&#x1F3FE`,
            Title: `Open Hands: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F450&#x1F3FF`,
            Title: `Open Hands: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64C`,
            Title: `Raising Hands`
        }, {
            Emoji: `&#x1F64C&#x1F3FB`,
            Title: `Raising Hands: Light Skin Tone`
        }, {
            Emoji: `&#x1F64C&#x1F3FC`,
            Title: `Raising Hands: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64C&#x1F3FD`,
            Title: `Raising Hands: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64C&#x1F3FE`,
            Title: `Raising Hands: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64C&#x1F3FF`,
            Title: `Raising Hands: Dark Skin Tone`
        }, {
            Emoji: `&#x1F64F`,
            Title: `Folded Hands`
        }, {
            Emoji: `&#x1F64F&#x1F3FB`,
            Title: `Folded Hands: Light Skin Tone`
        }, {
            Emoji: `&#x1F64F&#x1F3FC`,
            Title: `Folded Hands: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F64F&#x1F3FD`,
            Title: `Folded Hands: Medium Skin Tone`
        }, {
            Emoji: `&#x1F64F&#x1F3FE`,
            Title: `Folded Hands: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F64F&#x1F3FF`,
            Title: `Folded Hands: Dark Skin Tone`
        }, {
            Emoji: `&#x1F91D`,
            Title: `Handshake`
        }, {
            Emoji: `&#x1F485`,
            Title: `Nail Polish`
        }, {
            Emoji: `&#x1F485&#x1F3FB`,
            Title: `Nail Polish: Light Skin Tone`
        }, {
            Emoji: `&#x1F485&#x1F3FC`,
            Title: `Nail Polish: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F485&#x1F3FD`,
            Title: `Nail Polish: Medium Skin Tone`
        }, {
            Emoji: `&#x1F485&#x1F3FE`,
            Title: `Nail Polish: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F485&#x1F3FF`,
            Title: `Nail Polish: Dark Skin Tone`
        }, {
            Emoji: `&#x1F442`,
            Title: `Ear`
        }, {
            Emoji: `&#x1F442&#x1F3FB`,
            Title: `Ear: Light Skin Tone`
        }, {
            Emoji: `&#x1F442&#x1F3FC`,
            Title: `Ear: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F442&#x1F3FD`,
            Title: `Ear: Medium Skin Tone`
        }, {
            Emoji: `&#x1F442&#x1F3FE`,
            Title: `Ear: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F442&#x1F3FF`,
            Title: `Ear: Dark Skin Tone`
        }, {
            Emoji: `&#x1F443`,
            Title: `Nose`
        }, {
            Emoji: `&#x1F443&#x1F3FB`,
            Title: `Nose: Light Skin Tone`
        }, {
            Emoji: `&#x1F443&#x1F3FC`,
            Title: `Nose: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F443&#x1F3FD`,
            Title: `Nose: Medium Skin Tone`
        }, {
            Emoji: `&#x1F443&#x1F3FE`,
            Title: `Nose: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F443&#x1F3FF`,
            Title: `Nose: Dark Skin Tone`
        }, {
            Emoji: `&#x1F463`,
            Title: `Footprints`
        }, {
            Emoji: `&#x1F440`,
            Title: `Eyes`
        }, {
            Emoji: `&#x1F441`,
            Title: `Eye`
        }, {
            Emoji: `&#x1F441&#xFE0F&#x200D&#x1F5E8&#xFE0F`,
            Title: `Eye In Speech Bubble`
        }, {
            Emoji: `&#x1F445`,
            Title: `Tongue`
        }, {
            Emoji: `&#x1F444`,
            Title: `Mouth`
        }, {
            Emoji: `&#x1F48B`,
            Title: `Kiss Mark`
        }, {
            Emoji: `&#x1F498`,
            Title: `Heart With Arrow`
        }, {
            Emoji: `&#x2764`,
            Title: `Red Heart`
        }, {
            Emoji: `&#x1F493`,
            Title: `Beating Heart`
        }, {
            Emoji: `&#x1F494`,
            Title: `Broken Heart`
        }, {
            Emoji: `&#x1F495`,
            Title: `Two Hearts`
        }, {
            Emoji: `&#x1F496`,
            Title: `Sparkling Heart`
        }, {
            Emoji: `&#x1F497`,
            Title: `Growing Heart`
        }, {
            Emoji: `&#x1F499`,
            Title: `Blue Heart`
        }, {
            Emoji: `&#x1F49A`,
            Title: `Green Heart`
        }, {
            Emoji: `&#x1F49B`,
            Title: `Yellow Heart`
        }, {
            Emoji: `&#x1F49C`,
            Title: `Purple Heart`
        }, {
            Emoji: `&#x1F5A4`,
            Title: `Black Heart`
        }, {
            Emoji: `&#x1F49D`,
            Title: `Heart With Ribbon`
        }, {
            Emoji: `&#x1F49E`,
            Title: `Revolving Hearts`
        }, {
            Emoji: `&#x1F49F`,
            Title: `Heart Decoration`
        }, {
            Emoji: `&#x2763`,
            Title: `Heavy Heart Exclamation`
        }, {
            Emoji: `&#x1F48C`,
            Title: `Love Letter`
        }, {
            Emoji: `&#x1F4A4`,
            Title: `Zzz`
        }, {
            Emoji: `&#x1F4A2`,
            Title: `Anger Symbol`
        }, {
            Emoji: `&#x1F4A3`,
            Title: `Bomb`
        }, {
            Emoji: `&#x1F4A5`,
            Title: `Collision`
        }, {
            Emoji: `&#x1F4A6`,
            Title: `Sweat Droplets`
        }, {
            Emoji: `&#x1F4A8`,
            Title: `Dashing Away`
        }, {
            Emoji: `&#x1F4AB`,
            Title: `Dizzy`
        }, {
            Emoji: `&#x1F4AC`,
            Title: `Speech Balloon`
        }, {
            Emoji: `&#x1F5E8`,
            Title: `Left Speech Bubble`
        }, {
            Emoji: `&#x1F5EF`,
            Title: `Right Anger Bubble`
        }, {
            Emoji: `&#x1F4AD`,
            Title: `Thought Balloon`
        }, {
            Emoji: `&#x1F573`,
            Title: `Hole`
        }, {
            Emoji: `&#x1F453`,
            Title: `Glasses`
        }, {
            Emoji: `&#x1F576`,
            Title: `Sunglasses`
        }, {
            Emoji: `&#x1F454`,
            Title: `Necktie`
        }, {
            Emoji: `&#x1F455`,
            Title: `T-Shirt`
        }, {
            Emoji: `&#x1F456`,
            Title: `Jeans`
        }, {
            Emoji: `&#x1F457`,
            Title: `Dress`
        }, {
            Emoji: `&#x1F458`,
            Title: `Kimono`
        }, {
            Emoji: `&#x1F459`,
            Title: `Bikini`
        }, {
            Emoji: `&#x1F45A`,
            Title: `Womans Clothes`
        }, {
            Emoji: `&#x1F45B`,
            Title: `Purse`
        }, {
            Emoji: `&#x1F45C`,
            Title: `Handbag`
        }, {
            Emoji: `&#x1F45D`,
            Title: `Clutch Bag`
        }, {
            Emoji: `&#x1F6CD`,
            Title: `Shopping Bags`
        }, {
            Emoji: `&#x1F392`,
            Title: `School Backpack`
        }, {
            Emoji: `&#x1F45E`,
            Title: `Mans Shoe`
        }, {
            Emoji: `&#x1F45F`,
            Title: `Running Shoe`
        }, {
            Emoji: `&#x1F460`,
            Title: `High-Heeled Shoe`
        }, {
            Emoji: `&#x1F461`,
            Title: `Womans Sandal`
        }, {
            Emoji: `&#x1F462`,
            Title: `Womans Boot`
        }, {
            Emoji: `&#x1F451`,
            Title: `Crown`
        }, {
            Emoji: `&#x1F452`,
            Title: `Womans Hat`
        }, {
            Emoji: `&#x1F3A9`,
            Title: `Top Hat`
        }, {
            Emoji: `&#x1F393`,
            Title: `Graduation Cap`
        }, {
            Emoji: `&#x26D1`,
            Title: `Rescue Workers Helmet`
        }, {
            Emoji: `&#x1F4FF`,
            Title: `Prayer Beads`
        }, {
            Emoji: `&#x1F484`,
            Title: `Lipstick`
        }, {
            Emoji: `&#x1F48D`,
            Title: `Ring`
        }, {
            Emoji: `&#x1F48E`,
            Title: `Gem Stone`
        }, {
            Emoji: `&#x1F435`,
            Title: `Monkey Face`
        }, {
            Emoji: `&#x1F412`,
            Title: `Monkey`
        }, {
            Emoji: `&#x1F98D`,
            Title: `Gorilla`
        }, {
            Emoji: `&#x1F436`,
            Title: `Dog Face`
        }, {
            Emoji: `&#x1F415`,
            Title: `Dog`
        }, {
            Emoji: `&#x1F429`,
            Title: `Poodle`
        }, {
            Emoji: `&#x1F43A`,
            Title: `Wolf Face`
        }, {
            Emoji: `&#x1F98A`,
            Title: `Fox Face`
        }, {
            Emoji: `&#x1F431`,
            Title: `Cat Face`
        }, {
            Emoji: `&#x1F408`,
            Title: `Cat`
        }, {
            Emoji: `&#x1F981`,
            Title: `Lion Face`
        }, {
            Emoji: `&#x1F42F`,
            Title: `Tiger Face`
        }, {
            Emoji: `&#x1F405`,
            Title: `Tiger`
        }, {
            Emoji: `&#x1F406`,
            Title: `Leopard`
        }, {
            Emoji: `&#x1F434`,
            Title: `Horse Face`
        }, {
            Emoji: `&#x1F40E`,
            Title: `Horse`
        }, {
            Emoji: `&#x1F98C`,
            Title: `Deer`
        }, {
            Emoji: `&#x1F984`,
            Title: `Unicorn Face`
        }, {
            Emoji: `&#x1F42E`,
            Title: `Cow Face`
        }, {
            Emoji: `&#x1F402`,
            Title: `Ox`
        }, {
            Emoji: `&#x1F403`,
            Title: `Water Buffalo`
        }, {
            Emoji: `&#x1F404`,
            Title: `Cow`
        }, {
            Emoji: `&#x1F437`,
            Title: `Pig Face`
        }, {
            Emoji: `&#x1F416`,
            Title: `Pig`
        }, {
            Emoji: `&#x1F417`,
            Title: `Boar`
        }, {
            Emoji: `&#x1F43D`,
            Title: `Pig Nose`
        }, {
            Emoji: `&#x1F40F`,
            Title: `Ram`
        }, {
            Emoji: `&#x1F411`,
            Title: `Sheep`
        }, {
            Emoji: `&#x1F410`,
            Title: `Goat`
        }, {
            Emoji: `&#x1F42A`,
            Title: `Camel`
        }, {
            Emoji: `&#x1F42B`,
            Title: `Two-Hump Camel`
        }, {
            Emoji: `&#x1F418`,
            Title: `Elephant`
        }, {
            Emoji: `&#x1F98F`,
            Title: `Rhinoceros`
        }, {
            Emoji: `&#x1F42D`,
            Title: `Mouse Face`
        }, {
            Emoji: `&#x1F401`,
            Title: `Mouse`
        }, {
            Emoji: `&#x1F400`,
            Title: `Rat`
        }, {
            Emoji: `&#x1F439`,
            Title: `Hamster Face`
        }, {
            Emoji: `&#x1F430`,
            Title: `Rabbit Face`
        }, {
            Emoji: `&#x1F407`,
            Title: `Rabbit`
        }, {
            Emoji: `&#x1F43F`,
            Title: `Chipmunk`
        }, {
            Emoji: `&#x1F987`,
            Title: `Bat`
        }, {
            Emoji: `&#x1F43B`,
            Title: `Bear Face`
        }, {
            Emoji: `&#x1F428`,
            Title: `Koala`
        }, {
            Emoji: `&#x1F43C`,
            Title: `Panda Face`
        }, {
            Emoji: `&#x1F43E`,
            Title: `Paw Prints`
        }, {
            Emoji: `&#x1F983`,
            Title: `Turkey`
        }, {
            Emoji: `&#x1F414`,
            Title: `Chicken`
        }, {
            Emoji: `&#x1F413`,
            Title: `Rooster`
        }, {
            Emoji: `&#x1F423`,
            Title: `Hatching Chick`
        }, {
            Emoji: `&#x1F424`,
            Title: `Baby Chick`
        }, {
            Emoji: `&#x1F425`,
            Title: `Front-Facing Baby Chick`
        }, {
            Emoji: `&#x1F426`,
            Title: `Bird`
        }, {
            Emoji: `&#x1F427`,
            Title: `Penguin`
        }, {
            Emoji: `&#x1F54A`,
            Title: `Dove`
        }, {
            Emoji: `&#x1F985`,
            Title: `Eagle`
        }, {
            Emoji: `&#x1F986`,
            Title: `Duck`
        }, {
            Emoji: `&#x1F989`,
            Title: `Owl`
        }, {
            Emoji: `&#x1F438`,
            Title: `Frog Face`
        }, {
            Emoji: `&#x1F40A`,
            Title: `Crocodile`
        }, {
            Emoji: `&#x1F422`,
            Title: `Turtle`
        }, {
            Emoji: `&#x1F98E`,
            Title: `Lizard`
        }, {
            Emoji: `&#x1F40D`,
            Title: `Snake`
        }, {
            Emoji: `&#x1F432`,
            Title: `Dragon Face`
        }, {
            Emoji: `&#x1F409`,
            Title: `Dragon`
        }, {
            Emoji: `&#x1F433`,
            Title: `Spouting Whale`
        }, {
            Emoji: `&#x1F40B`,
            Title: `Whale`
        }, {
            Emoji: `&#x1F42C`,
            Title: `Dolphin`
        }, {
            Emoji: `&#x1F41F`,
            Title: `Fish`
        }, {
            Emoji: `&#x1F420`,
            Title: `Tropical Fish`
        }, {
            Emoji: `&#x1F421`,
            Title: `Blowfish`
        }, {
            Emoji: `&#x1F988`,
            Title: `Shark`
        }, {
            Emoji: `&#x1F419`,
            Title: `Octopus`
        }, {
            Emoji: `&#x1F41A`,
            Title: `Spiral Shell`
        }, {
            Emoji: `&#x1F980`,
            Title: `Crab`
        }, {
            Emoji: `&#x1F990`,
            Title: `Shrimp`
        }, {
            Emoji: `&#x1F991`,
            Title: `Squid`
        }, {
            Emoji: `&#x1F98B`,
            Title: `Butterfly`
        }, {
            Emoji: `&#x1F40C`,
            Title: `Snail`
        }, {
            Emoji: `&#x1F41B`,
            Title: `Bug`
        }, {
            Emoji: `&#x1F41C`,
            Title: `Ant`
        }, {
            Emoji: `&#x1F41D`,
            Title: `Honeybee`
        }, {
            Emoji: `&#x1F41E`,
            Title: `Lady Beetle`
        }, {
            Emoji: `&#x1F577`,
            Title: `Spider`
        }, {
            Emoji: `&#x1F578`,
            Title: `Spider Web`
        }, {
            Emoji: `&#x1F982`,
            Title: `Scorpion`
        }, {
            Emoji: `&#x1F490`,
            Title: `Bouquet`
        }, {
            Emoji: `&#x1F338`,
            Title: `Cherry Blossom`
        }, {
            Emoji: `&#x1F4AE`,
            Title: `White Flower`
        }, {
            Emoji: `&#x1F3F5`,
            Title: `Rosette`
        }, {
            Emoji: `&#x1F339`,
            Title: `Rose`
        }, {
            Emoji: `&#x1F940`,
            Title: `Wilted Flower`
        }, {
            Emoji: `&#x1F33A`,
            Title: `Hibiscus`
        }, {
            Emoji: `&#x1F33B`,
            Title: `Sunflower`
        }, {
            Emoji: `&#x1F33C`,
            Title: `Blossom`
        }, {
            Emoji: `&#x1F337`,
            Title: `Tulip`
        }, {
            Emoji: `&#x1F331`,
            Title: `Seedling`
        }, {
            Emoji: `&#x1F332`,
            Title: `Evergreen Tree`
        }, {
            Emoji: `&#x1F333`,
            Title: `Deciduous Tree`
        }, {
            Emoji: `&#x1F334`,
            Title: `Palm Tree`
        }, {
            Emoji: `&#x1F335`,
            Title: `Cactus`
        }, {
            Emoji: `&#x1F33E`,
            Title: `Sheaf Of Rice`
        }, {
            Emoji: `&#x1F33F`,
            Title: `Herb`
        }, {
            Emoji: `&#x2618`,
            Title: `Shamrock`
        }, {
            Emoji: `&#x1F340`,
            Title: `Four Leaf Clover`
        }, {
            Emoji: `&#x1F341`,
            Title: `Maple Leaf`
        }, {
            Emoji: `&#x1F342`,
            Title: `Fallen Leaf`
        }, {
            Emoji: `&#x1F343`,
            Title: `Leaf Fluttering In Wind`
        }, {
            Emoji: `&#x1F347`,
            Title: `Grapes`
        }, {
            Emoji: `&#x1F348`,
            Title: `Melon`
        }, {
            Emoji: `&#x1F349`,
            Title: `Watermelon`
        }, {
            Emoji: `&#x1F34A`,
            Title: `Tangerine`
        }, {
            Emoji: `&#x1F34B`,
            Title: `Lemon`
        }, {
            Emoji: `&#x1F34C`,
            Title: `Banana`
        }, {
            Emoji: `&#x1F34D`,
            Title: `Pineapple`
        }, {
            Emoji: `&#x1F34E`,
            Title: `Red Apple`
        }, {
            Emoji: `&#x1F34F`,
            Title: `Green Apple`
        }, {
            Emoji: `&#x1F350`,
            Title: `Pear`
        }, {
            Emoji: `&#x1F351`,
            Title: `Peach`
        }, {
            Emoji: `&#x1F352`,
            Title: `Cherries`
        }, {
            Emoji: `&#x1F353`,
            Title: `Strawberry`
        }, {
            Emoji: `&#x1F95D`,
            Title: `Kiwi Fruit`
        }, {
            Emoji: `&#x1F345`,
            Title: `Tomato`
        }, {
            Emoji: `&#x1F951`,
            Title: `Avocado`
        }, {
            Emoji: `&#x1F346`,
            Title: `Eggplant`
        }, {
            Emoji: `&#x1F954`,
            Title: `Potato`
        }, {
            Emoji: `&#x1F955`,
            Title: `Carrot`
        }, {
            Emoji: `&#x1F33D`,
            Title: `Ear Of Corn`
        }, {
            Emoji: `&#x1F336`,
            Title: `Hot Pepper`
        }, {
            Emoji: `&#x1F952`,
            Title: `Cucumber`
        }, {
            Emoji: `&#x1F344`,
            Title: `Mushroom`
        }, {
            Emoji: `&#x1F95C`,
            Title: `Peanuts`
        }, {
            Emoji: `&#x1F330`,
            Title: `Chestnut`
        }, {
            Emoji: `&#x1F35E`,
            Title: `Bread`
        }, {
            Emoji: `&#x1F950`,
            Title: `Croissant`
        }, {
            Emoji: `&#x1F956`,
            Title: `Baguette Bread`
        }, {
            Emoji: `&#x1F95E`,
            Title: `Pancakes`
        }, {
            Emoji: `&#x1F9C0`,
            Title: `Cheese Wedge`
        }, {
            Emoji: `&#x1F356`,
            Title: `Meat On Bone`
        }, {
            Emoji: `&#x1F357`,
            Title: `Poultry Leg`
        }, {
            Emoji: `&#x1F953`,
            Title: `Bacon`
        }, {
            Emoji: `&#x1F354`,
            Title: `Hamburger`
        }, {
            Emoji: `&#x1F35F`,
            Title: `French Fries`
        }, {
            Emoji: `&#x1F355`,
            Title: `Pizza`
        }, {
            Emoji: `&#x1F32D`,
            Title: `Hot Dog`
        }, {
            Emoji: `&#x1F32E`,
            Title: `Taco`
        }, {
            Emoji: `&#x1F32F`,
            Title: `Burrito`
        }, {
            Emoji: `&#x1F959`,
            Title: `Stuffed Flatbread`
        }, {
            Emoji: `&#x1F95A`,
            Title: `Egg`
        }, {
            Emoji: `&#x1F373`,
            Title: `Cooking`
        }, {
            Emoji: `&#x1F958`,
            Title: `Shallow Pan Of Food`
        }, {
            Emoji: `&#x1F372`,
            Title: `Pot Of Food`
        }, {
            Emoji: `&#x1F957`,
            Title: `Green Salad`
        }, {
            Emoji: `&#x1F37F`,
            Title: `Popcorn`
        }, {
            Emoji: `&#x1F371`,
            Title: `Bento Box`
        }, {
            Emoji: `&#x1F358`,
            Title: `Rice Cracker`
        }, {
            Emoji: `&#x1F359`,
            Title: `Rice Ball`
        }, {
            Emoji: `&#x1F35A`,
            Title: `Cooked Rice`
        }, {
            Emoji: `&#x1F35B`,
            Title: `Curry Rice`
        }, {
            Emoji: `&#x1F35C`,
            Title: `Steaming Bowl`
        }, {
            Emoji: `&#x1F35D`,
            Title: `Spaghetti`
        }, {
            Emoji: `&#x1F360`,
            Title: `Roasted Sweet Potato`
        }, {
            Emoji: `&#x1F362`,
            Title: `Oden`
        }, {
            Emoji: `&#x1F363`,
            Title: `Sushi`
        }, {
            Emoji: `&#x1F364`,
            Title: `Fried Shrimp`
        }, {
            Emoji: `&#x1F365`,
            Title: `Fish Cake With Swirl`
        }, {
            Emoji: `&#x1F361`,
            Title: `Dango`
        }, {
            Emoji: `&#x1F366`,
            Title: `Soft Ice Cream`
        }, {
            Emoji: `&#x1F367`,
            Title: `Shaved Ice`
        }, {
            Emoji: `&#x1F368`,
            Title: `Ice Cream`
        }, {
            Emoji: `&#x1F369`,
            Title: `Doughnut`
        }, {
            Emoji: `&#x1F36A`,
            Title: `Cookie`
        }, {
            Emoji: `&#x1F382`,
            Title: `Birthday Cake`
        }, {
            Emoji: `&#x1F370`,
            Title: `Shortcake`
        }, {
            Emoji: `&#x1F36B`,
            Title: `Chocolate Bar`
        }, {
            Emoji: `&#x1F36C`,
            Title: `Candy`
        }, {
            Emoji: `&#x1F36D`,
            Title: `Lollipop`
        }, {
            Emoji: `&#x1F36E`,
            Title: `Custard`
        }, {
            Emoji: `&#x1F36F`,
            Title: `Honey Pot`
        }, {
            Emoji: `&#x1F37C`,
            Title: `Baby Bottle`
        }, {
            Emoji: `&#x1F95B`,
            Title: `Glass Of Milk`
        }, {
            Emoji: `&#x2615`,
            Title: `Hot Beverage`
        }, {
            Emoji: `&#x1F375`,
            Title: `Teacup Without Handle`
        }, {
            Emoji: `&#x1F376`,
            Title: `Sake`
        }, {
            Emoji: `&#x1F37E`,
            Title: `Bottle With Popping Cork`
        }, {
            Emoji: `&#x1F377`,
            Title: `Wine Glass`
        }, {
            Emoji: `&#x1F378`,
            Title: `Cocktail Glass`
        }, {
            Emoji: `&#x1F379`,
            Title: `Tropical Drink`
        }, {
            Emoji: `&#x1F37A`,
            Title: `Beer Mug`
        }, {
            Emoji: `&#x1F37B`,
            Title: `Clinking Beer Mugs`
        }, {
            Emoji: `&#x1F942`,
            Title: `Clinking Glasses`
        }, {
            Emoji: `&#x1F943`,
            Title: `Tumbler Glass`
        }, {
            Emoji: `&#x1F37D`,
            Title: `Fork And Knife With Plate`
        }, {
            Emoji: `&#x1F374`,
            Title: `Fork And Knife`
        }, {
            Emoji: `&#x1F944`,
            Title: `Spoon`
        }, {
            Emoji: `&#x1F52A`,
            Title: `Kitchen Knife`
        }, {
            Emoji: `&#x1F3FA`,
            Title: `Amphora`
        }, {
            Emoji: `&#x1F30D`,
            Title: `Globe Showing Europe-Africa`
        }, {
            Emoji: `&#x1F30E`,
            Title: `Globe Showing Americas`
        }, {
            Emoji: `&#x1F30F`,
            Title: `Globe Showing Asia-Australia`
        }, {
            Emoji: `&#x1F310`,
            Title: `Globe With Meridians`
        }, {
            Emoji: `&#x1F5FA`,
            Title: `World Map`
        }, {
            Emoji: `&#x1F5FE`,
            Title: `Map Of Japan`
        }, {
            Emoji: `&#x1F3D4`,
            Title: `Snow-Capped Mountain`
        }, {
            Emoji: `&#x26F0`,
            Title: `Mountain`
        }, {
            Emoji: `&#x1F30B`,
            Title: `Volcano`
        }, {
            Emoji: `&#x1F5FB`,
            Title: `Mount Fuji`
        }, {
            Emoji: `&#x1F3D5`,
            Title: `Camping`
        }, {
            Emoji: `&#x1F3D6`,
            Title: `Beach With Umbrella`
        }, {
            Emoji: `&#x1F3DC`,
            Title: `Desert`
        }, {
            Emoji: `&#x1F3DD`,
            Title: `Desert Island`
        }, {
            Emoji: `&#x1F3DE`,
            Title: `National Park`
        }, {
            Emoji: `&#x1F3DF`,
            Title: `Stadium`
        }, {
            Emoji: `&#x1F3DB`,
            Title: `Classical Building`
        }, {
            Emoji: `&#x1F3D7`,
            Title: `Building Construction`
        }, {
            Emoji: `&#x1F3D8`,
            Title: `House`
        }, {
            Emoji: `&#x1F3D9`,
            Title: `Cityscape`
        }, {
            Emoji: `&#x1F3DA`,
            Title: `Derelict House`
        }, {
            Emoji: `&#x1F3E0`,
            Title: `House`
        }, {
            Emoji: `&#x1F3E1`,
            Title: `House With Garden`
        }, {
            Emoji: `&#x1F3E2`,
            Title: `Office Building`
        }, {
            Emoji: `&#x1F3E3`,
            Title: `Japanese Post Office`
        }, {
            Emoji: `&#x1F3E4`,
            Title: `Post Office`
        }, {
            Emoji: `&#x1F3E5`,
            Title: `Hospital`
        }, {
            Emoji: `&#x1F3E6`,
            Title: `Bank`
        }, {
            Emoji: `&#x1F3E8`,
            Title: `Hotel`
        }, {
            Emoji: `&#x1F3E9`,
            Title: `Love Hotel`
        }, {
            Emoji: `&#x1F3EA`,
            Title: `Convenience Store`
        }, {
            Emoji: `&#x1F3EB`,
            Title: `School`
        }, {
            Emoji: `&#x1F3EC`,
            Title: `Department Store`
        }, {
            Emoji: `&#x1F3ED`,
            Title: `Factory`
        }, {
            Emoji: `&#x1F3EF`,
            Title: `Japanese Castle`
        }, {
            Emoji: `&#x1F3F0`,
            Title: `Castle`
        }, {
            Emoji: `&#x1F492`,
            Title: `Wedding`
        }, {
            Emoji: `&#x1F5FC`,
            Title: `Tokyo Tower`
        }, {
            Emoji: `&#x1F5FD`,
            Title: `Statue Of Liberty`
        }, {
            Emoji: `&#x26EA`,
            Title: `Church`
        }, {
            Emoji: `&#x1F54C`,
            Title: `Mosque`
        }, {
            Emoji: `&#x1F54D`,
            Title: `Synagogue`
        }, {
            Emoji: `&#x26E9`,
            Title: `Shinto Shrine`
        }, {
            Emoji: `&#x1F54B`,
            Title: `Kaaba`
        }, {
            Emoji: `&#x26F2`,
            Title: `Fountain`
        }, {
            Emoji: `&#x26FA`,
            Title: `Tent`
        }, {
            Emoji: `&#x1F301`,
            Title: `Foggy`
        }, {
            Emoji: `&#x1F303`,
            Title: `Night With Stars`
        }, {
            Emoji: `&#x1F304`,
            Title: `Sunrise Over Mountains`
        }, {
            Emoji: `&#x1F305`,
            Title: `Sunrise`
        }, {
            Emoji: `&#x1F306`,
            Title: `Cityscape At Dusk`
        }, {
            Emoji: `&#x1F307`,
            Title: `Sunset`
        }, {
            Emoji: `&#x1F309`,
            Title: `Bridge At Night`
        }, {
            Emoji: `&#x2668`,
            Title: `Hot Springs`
        }, {
            Emoji: `&#x1F30C`,
            Title: `Milky Way`
        }, {
            Emoji: `&#x1F3A0`,
            Title: `Carousel Horse`
        }, {
            Emoji: `&#x1F3A1`,
            Title: `Ferris Wheel`
        }, {
            Emoji: `&#x1F3A2`,
            Title: `Roller Coaster`
        }, {
            Emoji: `&#x1F488`,
            Title: `Barber Pole`
        }, {
            Emoji: `&#x1F3AA`,
            Title: `Circus Tent`
        }, {
            Emoji: `&#x1F3AD`,
            Title: `Performing Arts`
        }, {
            Emoji: `&#x1F5BC`,
            Title: `Framed Picture`
        }, {
            Emoji: `&#x1F3A8`,
            Title: `Artist Palette`
        }, {
            Emoji: `&#x1F3B0`,
            Title: `Slot Machine`
        }, {
            Emoji: `&#x1F682`,
            Title: `Locomotive`
        }, {
            Emoji: `&#x1F683`,
            Title: `Railway Car`
        }, {
            Emoji: `&#x1F684`,
            Title: `High-Speed Train`
        }, {
            Emoji: `&#x1F685`,
            Title: `High-Speed Train With Bullet Nose`
        }, {
            Emoji: `&#x1F686`,
            Title: `Train`
        }, {
            Emoji: `&#x1F687`,
            Title: `Metro`
        }, {
            Emoji: `&#x1F688`,
            Title: `Light Rail`
        }, {
            Emoji: `&#x1F689`,
            Title: `Station`
        }, {
            Emoji: `&#x1F68A`,
            Title: `Tram`
        }, {
            Emoji: `&#x1F69D`,
            Title: `Monorail`
        }, {
            Emoji: `&#x1F69E`,
            Title: `Mountain Railway`
        }, {
            Emoji: `&#x1F68B`,
            Title: `Tram Car`
        }, {
            Emoji: `&#x1F68C`,
            Title: `Bus`
        }, {
            Emoji: `&#x1F68D`,
            Title: `Oncoming Bus`
        }, {
            Emoji: `&#x1F68E`,
            Title: `Trolleybus`
        }, {
            Emoji: `&#x1F690`,
            Title: `Minibus`
        }, {
            Emoji: `&#x1F691`,
            Title: `Ambulance`
        }, {
            Emoji: `&#x1F692`,
            Title: `Fire Engine`
        }, {
            Emoji: `&#x1F693`,
            Title: `Police Car`
        }, {
            Emoji: `&#x1F694`,
            Title: `Oncoming Police Car`
        }, {
            Emoji: `&#x1F695`,
            Title: `Taxi`
        }, {
            Emoji: `&#x1F696`,
            Title: `Oncoming Taxi`
        }, {
            Emoji: `&#x1F697`,
            Title: `Automobile`
        }, {
            Emoji: `&#x1F698`,
            Title: `Oncoming Automobile`
        }, {
            Emoji: `&#x1F699`,
            Title: `Sport Utility Vehicle`
        }, {
            Emoji: `&#x1F69A`,
            Title: `Delivery Truck`
        }, {
            Emoji: `&#x1F69B`,
            Title: `Articulated Lorry`
        }, {
            Emoji: `&#x1F69C`,
            Title: `Tractor`
        }, {
            Emoji: `&#x1F6B2`,
            Title: `Bicycle`
        }, {
            Emoji: `&#x1F6F4`,
            Title: `Kick Scooter`
        }, {
            Emoji: `&#x1F6F5`,
            Title: `Motor Scooter`
        }, {
            Emoji: `&#x1F68F`,
            Title: `Bus Stop`
        }, {
            Emoji: `&#x1F6E3`,
            Title: `Motorway`
        }, {
            Emoji: `&#x1F6E4`,
            Title: `Railway Track`
        }, {
            Emoji: `&#x26FD`,
            Title: `Fuel Pump`
        }, {
            Emoji: `&#x1F6A8`,
            Title: `Police Car Light`
        }, {
            Emoji: `&#x1F6A5`,
            Title: `Horizontal Traffic Light`
        }, {
            Emoji: `&#x1F6A6`,
            Title: `Vertical Traffic Light`
        }, {
            Emoji: `&#x1F6A7`,
            Title: `Construction`
        }, {
            Emoji: `&#x1F6D1`,
            Title: `Stop Sign`
        }, {
            Emoji: `&#x2693`,
            Title: `Anchor`
        }, {
            Emoji: `&#x26F5`,
            Title: `Sailboat`
        }, {
            Emoji: `&#x1F6F6`,
            Title: `Canoe`
        }, {
            Emoji: `&#x1F6A4`,
            Title: `Speedboat`
        }, {
            Emoji: `&#x1F6F3`,
            Title: `Passenger Ship`
        }, {
            Emoji: `&#x26F4`,
            Title: `Ferry`
        }, {
            Emoji: `&#x1F6E5`,
            Title: `Motor Boat`
        }, {
            Emoji: `&#x1F6A2`,
            Title: `Ship`
        }, {
            Emoji: `&#x2708`,
            Title: `Airplane`
        }, {
            Emoji: `&#x1F6E9`,
            Title: `Small Airplane`
        }, {
            Emoji: `&#x1F6EB`,
            Title: `Airplane Departure`
        }, {
            Emoji: `&#x1F6EC`,
            Title: `Airplane Arrival`
        }, {
            Emoji: `&#x1F4BA`,
            Title: `Seat`
        }, {
            Emoji: `&#x1F681`,
            Title: `Helicopter`
        }, {
            Emoji: `&#x1F69F`,
            Title: `Suspension Railway`
        }, {
            Emoji: `&#x1F6A0`,
            Title: `Mountain Cableway`
        }, {
            Emoji: `&#x1F6A1`,
            Title: `Aerial Tramway`
        }, {
            Emoji: `&#x1F680`,
            Title: `Rocket`
        }, {
            Emoji: `&#x1F6F0`,
            Title: `Satellite`
        }, {
            Emoji: `&#x1F6CE`,
            Title: `Bellhop Bell`
        }, {
            Emoji: `&#x1F6AA`,
            Title: `Door`
        }, {
            Emoji: `&#x1F6CC`,
            Title: `Person In Bed`
        }, {
            Emoji: `&#x1F6CC&#x1F3FB`,
            Title: `Person In Bed: Light Skin Tone`
        }, {
            Emoji: `&#x1F6CC&#x1F3FC`,
            Title: `Person In Bed: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6CC&#x1F3FD`,
            Title: `Person In Bed: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6CC&#x1F3FE`,
            Title: `Person In Bed: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6CC&#x1F3FF`,
            Title: `Person In Bed: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6CF`,
            Title: `Bed`
        }, {
            Emoji: `&#x1F6CB`,
            Title: `Couch And Lamp`
        }, {
            Emoji: `&#x1F6BD`,
            Title: `Toilet`
        }, {
            Emoji: `&#x1F6BF`,
            Title: `Shower`
        }, {
            Emoji: `&#x1F6C0`,
            Title: `Person Taking Bath`
        }, {
            Emoji: `&#x1F6C0&#x1F3FB`,
            Title: `Person Taking Bath: Light Skin Tone`
        }, {
            Emoji: `&#x1F6C0&#x1F3FC`,
            Title: `Person Taking Bath: Medium-Light Skin Tone`
        }, {
            Emoji: `&#x1F6C0&#x1F3FD`,
            Title: `Person Taking Bath: Medium Skin Tone`
        }, {
            Emoji: `&#x1F6C0&#x1F3FE`,
            Title: `Person Taking Bath: Medium-Dark Skin Tone`
        }, {
            Emoji: `&#x1F6C0&#x1F3FF`,
            Title: `Person Taking Bath: Dark Skin Tone`
        }, {
            Emoji: `&#x1F6C1`,
            Title: `Bathtub`
        }, {
            Emoji: `&#x231B`,
            Title: `Hourglass`
        }, {
            Emoji: `&#x23F3`,
            Title: `Hourglass With Flowing Sand`
        }, {
            Emoji: `&#x231A`,
            Title: `Watch`
        }, {
            Emoji: `&#x23F0`,
            Title: `Alarm Clock`
        }, {
            Emoji: `&#x23F1`,
            Title: `Stopwatch`
        }, {
            Emoji: `&#x23F2`,
            Title: `Timer Clock`
        }, {
            Emoji: `&#x1F570`,
            Title: `Mantelpiece Clock`
        }, {
            Emoji: `&#x1F55B`,
            Title: `Twelve Oclock`
        }, {
            Emoji: `&#x1F567`,
            Title: `Twelve-Thirty`
        }, {
            Emoji: `&#x1F550`,
            Title: `One Oclock`
        }, {
            Emoji: `&#x1F55C`,
            Title: `One-Thirty`
        }, {
            Emoji: `&#x1F551`,
            Title: `Two Oclock`
        }, {
            Emoji: `&#x1F55D`,
            Title: `Two-Thirty`
        }, {
            Emoji: `&#x1F552`,
            Title: `Three Oclock`
        }, {
            Emoji: `&#x1F55E`,
            Title: `Three-Thirty`
        }, {
            Emoji: `&#x1F553`,
            Title: `Four Oclock`
        }, {
            Emoji: `&#x1F55F`,
            Title: `Four-Thirty`
        }, {
            Emoji: `&#x1F554`,
            Title: `Five Oclock`
        }, {
            Emoji: `&#x1F560`,
            Title: `Five-Thirty`
        }, {
            Emoji: `&#x1F555`,
            Title: `Six Oclock`
        }, {
            Emoji: `&#x1F561`,
            Title: `Six-Thirty`
        }, {
            Emoji: `&#x1F556`,
            Title: `Seven Oclock`
        }, {
            Emoji: `&#x1F562`,
            Title: `Seven-Thirty`
        }, {
            Emoji: `&#x1F557`,
            Title: `Eight Oclock`
        }, {
            Emoji: `&#x1F563`,
            Title: `Eight-Thirty`
        }, {
            Emoji: `&#x1F558`,
            Title: `Nine Oclock`
        }, {
            Emoji: `&#x1F564`,
            Title: `Nine-Thirty`
        }, {
            Emoji: `&#x1F559`,
            Title: `Ten Oclock`
        }, {
            Emoji: `&#x1F565`,
            Title: `Ten-Thirty`
        }, {
            Emoji: `&#x1F55A`,
            Title: `Eleven Oclock`
        }, {
            Emoji: `&#x1F566`,
            Title: `Eleven-Thirty`
        }, {
            Emoji: `&#x1F311`,
            Title: `New Moon`
        }, {
            Emoji: `&#x1F312`,
            Title: `Waxing Crescent Moon`
        }, {
            Emoji: `&#x1F313`,
            Title: `First Quarter Moon`
        }, {
            Emoji: `&#x1F314`,
            Title: `Waxing Gibbous Moon`
        }, {
            Emoji: `&#x1F315`,
            Title: `Full Moon`
        }, {
            Emoji: `&#x1F316`,
            Title: `Waning Gibbous Moon`
        }, {
            Emoji: `&#x1F317`,
            Title: `Last Quarter Moon`
        }, {
            Emoji: `&#x1F318`,
            Title: `Waning Crescent Moon`
        }, {
            Emoji: `&#x1F319`,
            Title: `Crescent Moon`
        }, {
            Emoji: `&#x1F31A`,
            Title: `New Moon Face`
        }, {
            Emoji: `&#x1F31B`,
            Title: `First Quarter Moon With Face`
        }, {
            Emoji: `&#x1F31C`,
            Title: `Last Quarter Moon With Face`
        }, {
            Emoji: `&#x1F321`,
            Title: `Thermometer`
        }, {
            Emoji: `&#x2600`,
            Title: `Sun`
        }, {
            Emoji: `&#x1F31D`,
            Title: `Full Moon With Face`
        }, {
            Emoji: `&#x1F31E`,
            Title: `Sun With Face`
        }, {
            Emoji: `&#x2B50`,
            Title: `White Medium Star`
        }, {
            Emoji: `&#x1F31F`,
            Title: `Glowing Star`
        }, {
            Emoji: `&#x1F320`,
            Title: `Shooting Star`
        }, {
            Emoji: `&#x2601`,
            Title: `Cloud`
        }, {
            Emoji: `&#x26C5`,
            Title: `Sun Behind Cloud`
        }, {
            Emoji: `&#x26C8`,
            Title: `Cloud With Lightning And Rain`
        }, {
            Emoji: `&#x1F324`,
            Title: `Sun Behind Small Cloud`
        }, {
            Emoji: `&#x1F325`,
            Title: `Sun Behind Large Cloud`
        }, {
            Emoji: `&#x1F326`,
            Title: `Sun Behind Rain Cloud`
        }, {
            Emoji: `&#x1F327`,
            Title: `Cloud With Rain`
        }, {
            Emoji: `&#x1F328`,
            Title: `Cloud With Snow`
        }, {
            Emoji: `&#x1F329`,
            Title: `Cloud With Lightning`
        }, {
            Emoji: `&#x1F32A`,
            Title: `Tornado`
        }, {
            Emoji: `&#x1F32B`,
            Title: `Fog`
        }, {
            Emoji: `&#x1F32C`,
            Title: `Wind Face`
        }, {
            Emoji: `&#x1F300`,
            Title: `Cyclone`
        }, {
            Emoji: `&#x1F308`,
            Title: `Rainbow`
        }, {
            Emoji: `&#x1F302`,
            Title: `Closed Umbrella`
        }, {
            Emoji: `&#x2602`,
            Title: `Umbrella`
        }, {
            Emoji: `&#x2614`,
            Title: `Umbrella With Rain Drops`
        }, {
            Emoji: `&#x26F1`,
            Title: `Umbrella On Ground`
        }, {
            Emoji: `&#x26A1`,
            Title: `High Voltage`
        }, {
            Emoji: `&#x2744`,
            Title: `Snowflake`
        }, {
            Emoji: `&#x2603`,
            Title: `Snowman`
        }, {
            Emoji: `&#x26C4`,
            Title: `Snowman Without Snow`
        }, {
            Emoji: `&#x2604`,
            Title: `Comet`
        }, {
            Emoji: `&#x1F525`,
            Title: `Fire`
        }, {
            Emoji: `&#x1F4A7`,
            Title: `Droplet`
        }, {
            Emoji: `&#x1F30A`,
            Title: `Water Wave`
        }, {
            Emoji: `&#x1F383`,
            Title: `Jack-O-Lantern`
        }, {
            Emoji: `&#x1F384`,
            Title: `Christmas Tree`
        }, {
            Emoji: `&#x1F386`,
            Title: `Fireworks`
        }, {
            Emoji: `&#x1F387`,
            Title: `Sparkler`
        }, {
            Emoji: `&#x2728`,
            Title: `Sparkles`
        }, {
            Emoji: `&#x1F388`,
            Title: `Balloon`
        }, {
            Emoji: `&#x1F389`,
            Title: `Party Popper`
        }, {
            Emoji: `&#x1F38A`,
            Title: `Confetti Ball`
        }, {
            Emoji: `&#x1F38B`,
            Title: `Tanabata Tree`
        }, {
            Emoji: `&#x1F38D`,
            Title: `Pine Decoration`
        }, {
            Emoji: `&#x1F38E`,
            Title: `Japanese Dolls`
        }, {
            Emoji: `&#x1F38F`,
            Title: `Carp Streamer`
        }, {
            Emoji: `&#x1F390`,
            Title: `Wind Chime`
        }, {
            Emoji: `&#x1F391`,
            Title: `Moon Viewing Ceremony`
        }, {
            Emoji: `&#x1F380`,
            Title: `Ribbon`
        }, {
            Emoji: `&#x1F381`,
            Title: `Wrapped Gift`
        }, {
            Emoji: `&#x1F397`,
            Title: `Reminder Ribbon`
        }, {
            Emoji: `&#x1F39F`,
            Title: `Admission Tickets`
        }, {
            Emoji: `&#x1F3AB`,
            Title: `Ticket`
        }, {
            Emoji: `&#x1F396`,
            Title: `Military Medal`
        }, {
            Emoji: `&#x1F3C6`,
            Title: `Trophy`
        }, {
            Emoji: `&#x1F3C5`,
            Title: `Sports Medal`
        }, {
            Emoji: `&#x1F947`,
            Title: `1st Place Medal`
        }, {
            Emoji: `&#x1F948`,
            Title: `2nd Place Medal`
        }, {
            Emoji: `&#x1F949`,
            Title: `3rd Place Medal`
        }, {
            Emoji: `&#x26BD`,
            Title: `Soccer Ball`
        }, {
            Emoji: `&#x26BE`,
            Title: `Baseball`
        }, {
            Emoji: `&#x1F3C0`,
            Title: `Basketball`
        }, {
            Emoji: `&#x1F3D0`,
            Title: `Volleyball`
        }, {
            Emoji: `&#x1F3C8`,
            Title: `American Football`
        }, {
            Emoji: `&#x1F3C9`,
            Title: `Rugby Football`
        }, {
            Emoji: `&#x1F3BE`,
            Title: `Tennis`
        }, {
            Emoji: `&#x1F3B1`,
            Title: `Pool 8 Ball`
        }, {
            Emoji: `&#x1F3B3`,
            Title: `Bowling`
        }, {
            Emoji: `&#x1F3CF`,
            Title: `Cricket`
        }, {
            Emoji: `&#x1F3D1`,
            Title: `Field Hockey`
        }, {
            Emoji: `&#x1F3D2`,
            Title: `Ice Hockey`
        }, {
            Emoji: `&#x1F3D3`,
            Title: `Ping Pong`
        }, {
            Emoji: `&#x1F3F8`,
            Title: `Badminton`
        }, {
            Emoji: `&#x1F94A`,
            Title: `Boxing Glove`
        }, {
            Emoji: `&#x1F94B`,
            Title: `Martial Arts Uniform`
        }, {
            Emoji: `&#x1F945`,
            Title: `Goal Net`
        }, {
            Emoji: `&#x1F3AF`,
            Title: `Direct Hit`
        }, {
            Emoji: `&#x26F3`,
            Title: `Flag In Hole`
        }, {
            Emoji: `&#x26F8`,
            Title: `Ice Skate`
        }, {
            Emoji: `&#x1F3A3`,
            Title: `Fishing Pole`
        }, {
            Emoji: `&#x1F3BD`,
            Title: `Running Shirt`
        }, {
            Emoji: `&#x1F3BF`,
            Title: `Skis`
        }, {
            Emoji: `&#x1F3AE`,
            Title: `Video Game`
        }, {
            Emoji: `&#x1F579`,
            Title: `Joystick`
        }, {
            Emoji: `&#x1F3B2`,
            Title: `Game Die`
        }, {
            Emoji: `&#x2660`,
            Title: `Spade Suit`
        }, {
            Emoji: `&#x2665`,
            Title: `Heart Suit`
        }, {
            Emoji: `&#x2666`,
            Title: `Diamond Suit`
        }, {
            Emoji: `&#x2663`,
            Title: `Club Suit`
        }, {
            Emoji: `&#x1F0CF`,
            Title: `Joker`
        }, {
            Emoji: `&#x1F004`,
            Title: `Mahjong Red Dragon`
        }, {
            Emoji: `&#x1F3B4`,
            Title: `Flower Playing Cards`
        }, {
            Emoji: `&#x1F507`,
            Title: `Muted Speaker`
        }, {
            Emoji: `&#x1F508`,
            Title: `Speaker Low Volume`
        }, {
            Emoji: `&#x1F509`,
            Title: `Speaker Medium Volume`
        }, {
            Emoji: `&#x1F50A`,
            Title: `Speaker High Volume`
        }, {
            Emoji: `&#x1F4E2`,
            Title: `Loudspeaker`
        }, {
            Emoji: `&#x1F4E3`,
            Title: `Megaphone`
        }, {
            Emoji: `&#x1F4EF`,
            Title: `Postal Horn`
        }, {
            Emoji: `&#x1F514`,
            Title: `Bell`
        }, {
            Emoji: `&#x1F515`,
            Title: `Bell With Slash`
        }, {
            Emoji: `&#x1F3BC`,
            Title: `Musical Score`
        }, {
            Emoji: `&#x1F3B5`,
            Title: `Musical Note`
        }, {
            Emoji: `&#x1F3B6`,
            Title: `Musical Notes`
        }, {
            Emoji: `&#x1F399`,
            Title: `Studio Microphone`
        }, {
            Emoji: `&#x1F39A`,
            Title: `Level Slider`
        }, {
            Emoji: `&#x1F39B`,
            Title: `Control Knobs`
        }, {
            Emoji: `&#x1F3A4`,
            Title: `Microphone`
        }, {
            Emoji: `&#x1F3A7`,
            Title: `Headphone`
        }, {
            Emoji: `&#x1F4FB`,
            Title: `Radio`
        }, {
            Emoji: `&#x1F3B7`,
            Title: `Saxophone`
        }, {
            Emoji: `&#x1F3B8`,
            Title: `Guitar`
        }, {
            Emoji: `&#x1F3B9`,
            Title: `Musical Keyboard`
        }, {
            Emoji: `&#x1F3BA`,
            Title: `Trumpet`
        }, {
            Emoji: `&#x1F3BB`,
            Title: `Violin`
        }, {
            Emoji: `&#x1F941`,
            Title: `Drum`
        }, {
            Emoji: `&#x1F4F1`,
            Title: `Mobile Phone`
        }, {
            Emoji: `&#x1F4F2`,
            Title: `Mobile Phone With Arrow`
        }, {
            Emoji: `&#x260E`,
            Title: `Telephone`
        }, {
            Emoji: `&#x1F4DE`,
            Title: `Telephone Receiver`
        }, {
            Emoji: `&#x1F4DF`,
            Title: `Pager`
        }, {
            Emoji: `&#x1F4E0`,
            Title: `Fax Machine`
        }, {
            Emoji: `&#x1F50B`,
            Title: `Battery`
        }, {
            Emoji: `&#x1F50C`,
            Title: `Electric Plug`
        }, {
            Emoji: `&#x1F4BB`,
            Title: `Laptop Computer`
        }, {
            Emoji: `&#x1F5A5`,
            Title: `Desktop Computer`
        }, {
            Emoji: `&#x1F5A8`,
            Title: `Printer`
        }, {
            Emoji: `&#x2328`,
            Title: `Keyboard`
        }, {
            Emoji: `&#x1F5B1`,
            Title: `Computer Mouse`
        }, {
            Emoji: `&#x1F5B2`,
            Title: `Trackball`
        }, {
            Emoji: `&#x1F4BD`,
            Title: `Computer Disk`
        }, {
            Emoji: `&#x1F4BE`,
            Title: `Floppy Disk`
        }, {
            Emoji: `&#x1F4BF`,
            Title: `Optical Disk`
        }, {
            Emoji: `&#x1F4C0`,
            Title: `Dvd`
        }, {
            Emoji: `&#x1F3A5`,
            Title: `Movie Camera`
        }, {
            Emoji: `&#x1F39E`,
            Title: `Film Frames`
        }, {
            Emoji: `&#x1F4FD`,
            Title: `Film Projector`
        }, {
            Emoji: `&#x1F3AC`,
            Title: `Clapper Board`
        }, {
            Emoji: `&#x1F4FA`,
            Title: `Television`
        }, {
            Emoji: `&#x1F4F7`,
            Title: `Camera`
        }, {
            Emoji: `&#x1F4F8`,
            Title: `Camera With Flash`
        }, {
            Emoji: `&#x1F4F9`,
            Title: `Video Camera`
        }, {
            Emoji: `&#x1F4FC`,
            Title: `Videocassette`
        }, {
            Emoji: `&#x1F50D`,
            Title: `Left-Pointing Magnifying Glass`
        }, {
            Emoji: `&#x1F50E`,
            Title: `Right-Pointing Magnifying Glass`
        }, {
            Emoji: `&#x1F52C`,
            Title: `Microscope`
        }, {
            Emoji: `&#x1F52D`,
            Title: `Telescope`
        }, {
            Emoji: `&#x1F4E1`,
            Title: `Satellite Antenna`
        }, {
            Emoji: `&#x1F56F`,
            Title: `Candle`
        }, {
            Emoji: `&#x1F4A1`,
            Title: `Light Bulb`
        }, {
            Emoji: `&#x1F526`,
            Title: `Flashlight`
        }, {
            Emoji: `&#x1F3EE`,
            Title: `Red Paper Lantern`
        }, {
            Emoji: `&#x1F4D4`,
            Title: `Notebook With Decorative Cover`
        }, {
            Emoji: `&#x1F4D5`,
            Title: `Closed Book`
        }, {
            Emoji: `&#x1F4D6`,
            Title: `Open Book`
        }, {
            Emoji: `&#x1F4D7`,
            Title: `Green Book`
        }, {
            Emoji: `&#x1F4D8`,
            Title: `Blue Book`
        }, {
            Emoji: `&#x1F4D9`,
            Title: `Orange Book`
        }, {
            Emoji: `&#x1F4DA`,
            Title: `Books`
        }, {
            Emoji: `&#x1F4D3`,
            Title: `Notebook`
        }, {
            Emoji: `&#x1F4D2`,
            Title: `Ledger`
        }, {
            Emoji: `&#x1F4C3`,
            Title: `Page With Curl`
        }, {
            Emoji: `&#x1F4DC`,
            Title: `Scroll`
        }, {
            Emoji: `&#x1F4C4`,
            Title: `Page Facing Up`
        }, {
            Emoji: `&#x1F4F0`,
            Title: `Newspaper`
        }, {
            Emoji: `&#x1F5DE`,
            Title: `Rolled-Up Newspaper`
        }, {
            Emoji: `&#x1F4D1`,
            Title: `Bookmark Tabs`
        }, {
            Emoji: `&#x1F516`,
            Title: `Bookmark`
        }, {
            Emoji: `&#x1F3F7`,
            Title: `Label`
        }, {
            Emoji: `&#x1F4B0`,
            Title: `Money Bag`
        }, {
            Emoji: `&#x1F4B4`,
            Title: `Yen Banknote`
        }, {
            Emoji: `&#x1F4B5`,
            Title: `Dollar Banknote`
        }, {
            Emoji: `&#x1F4B6`,
            Title: `Euro Banknote`
        }, {
            Emoji: `&#x1F4B7`,
            Title: `Pound Banknote`
        }, {
            Emoji: `&#x1F4B8`,
            Title: `Money With Wings`
        }, {
            Emoji: `&#x1F4B3`,
            Title: `Credit Card`
        }, {
            Emoji: `&#x1F4B9`,
            Title: `Chart Increasing With Yen`
        }, {
            Emoji: `&#x1F4B1`,
            Title: `Currency Exchange`
        }, {
            Emoji: `&#x1F4B2`,
            Title: `Heavy Dollar Sign`
        }, {
            Emoji: `&#x2709`,
            Title: `Envelope`
        }, {
            Emoji: `&#x1F4E7`,
            Title: `E-Mail`
        }, {
            Emoji: `&#x1F4E8`,
            Title: `Incoming Envelope`
        }, {
            Emoji: `&#x1F4E9`,
            Title: `Envelope With Arrow`
        }, {
            Emoji: `&#x1F4E4`,
            Title: `Outbox Tray`
        }, {
            Emoji: `&#x1F4E5`,
            Title: `Inbox Tray`
        }, {
            Emoji: `&#x1F4E6`,
            Title: `Package`
        }, {
            Emoji: `&#x1F4EB`,
            Title: `Closed Mailbox With Raised Flag`
        }, {
            Emoji: `&#x1F4EA`,
            Title: `Closed Mailbox With Lowered Flag`
        }, {
            Emoji: `&#x1F4EC`,
            Title: `Open Mailbox With Raised Flag`
        }, {
            Emoji: `&#x1F4ED`,
            Title: `Open Mailbox With Lowered Flag`
        }, {
            Emoji: `&#x1F4EE`,
            Title: `Postbox`
        }, {
            Emoji: `&#x1F5F3`,
            Title: `Ballot Box With Ballot`
        }, {
            Emoji: `&#x270F`,
            Title: `Pencil`
        }, {
            Emoji: `&#x2712`,
            Title: `Black Nib`
        }, {
            Emoji: `&#x1F58B`,
            Title: `Fountain Pen`
        }, {
            Emoji: `&#x1F58A`,
            Title: `Pen`
        }, {
            Emoji: `&#x1F58C`,
            Title: `Paintbrush`
        }, {
            Emoji: `&#x1F58D`,
            Title: `Crayon`
        }, {
            Emoji: `&#x1F4DD`,
            Title: `Memo`
        }, {
            Emoji: `&#x1F4BC`,
            Title: `Briefcase`
        }, {
            Emoji: `&#x1F4C1`,
            Title: `File Folder`
        }, {
            Emoji: `&#x1F4C2`,
            Title: `Open File Folder`
        }, {
            Emoji: `&#x1F5C2`,
            Title: `Card Index Dividers`
        }, {
            Emoji: `&#x1F4C5`,
            Title: `Calendar`
        }, {
            Emoji: `&#x1F4C6`,
            Title: `Tear-Off Calendar`
        }, {
            Emoji: `&#x1F5D2`,
            Title: `Spiral Notepad`
        }, {
            Emoji: `&#x1F5D3`,
            Title: `Spiral Calendar`
        }, {
            Emoji: `&#x1F4C7`,
            Title: `Card Index`
        }, {
            Emoji: `&#x1F4C8`,
            Title: `Chart Increasing`
        }, {
            Emoji: `&#x1F4C9`,
            Title: `Chart Decreasing`
        }, {
            Emoji: `&#x1F4CA`,
            Title: `Bar Chart`
        }, {
            Emoji: `&#x1F4CB`,
            Title: `Clipboard`
        }, {
            Emoji: `&#x1F4CC`,
            Title: `Pushpin`
        }, {
            Emoji: `&#x1F4CD`,
            Title: `Round Pushpin`
        }, {
            Emoji: `&#x1F4CE`,
            Title: `Paperclip`
        }, {
            Emoji: `&#x1F587`,
            Title: `Linked Paperclips`
        }, {
            Emoji: `&#x1F4CF`,
            Title: `Straight Ruler`
        }, {
            Emoji: `&#x1F4D0`,
            Title: `Triangular Ruler`
        }, {
            Emoji: `&#x2702`,
            Title: `Scissors`
        }, {
            Emoji: `&#x1F5C3`,
            Title: `Card File Box`
        }, {
            Emoji: `&#x1F5C4`,
            Title: `File Cabinet`
        }, {
            Emoji: `&#x1F5D1`,
            Title: `Wastebasket`
        }, {
            Emoji: `&#x1F512`,
            Title: `Locked`
        }, {
            Emoji: `&#x1F513`,
            Title: `Unlocked`
        }, {
            Emoji: `&#x1F50F`,
            Title: `Locked With Pen`
        }, {
            Emoji: `&#x1F510`,
            Title: `Locked With Key`
        }, {
            Emoji: `&#x1F511`,
            Title: `Key`
        }, {
            Emoji: `&#x1F5DD`,
            Title: `Old Key`
        }, {
            Emoji: `&#x1F528`,
            Title: `Hammer`
        }, {
            Emoji: `&#x26CF`,
            Title: `Pick`
        }, {
            Emoji: `&#x2692`,
            Title: `Hammer And Pick`
        }, {
            Emoji: `&#x1F6E0`,
            Title: `Hammer And Wrench`
        }, {
            Emoji: `&#x1F5E1`,
            Title: `Dagger`
        }, {
            Emoji: `&#x2694`,
            Title: `Crossed Swords`
        }, {
            Emoji: `&#x1F52B`,
            Title: `Pistol`
        }, {
            Emoji: `&#x1F3F9`,
            Title: `Bow And Arrow`
        }, {
            Emoji: `&#x1F6E1`,
            Title: `Shield`
        }, {
            Emoji: `&#x1F527`,
            Title: `Wrench`
        }, {
            Emoji: `&#x1F529`,
            Title: `Nut And Bolt`
        }, {
            Emoji: `&#x2699`,
            Title: `Gear`
        }, {
            Emoji: `&#x1F5DC`,
            Title: `Clamp`
        }, {
            Emoji: `&#x2697`,
            Title: `Alembic`
        }, {
            Emoji: `&#x2696`,
            Title: `Balance Scale`
        }, {
            Emoji: `&#x1F517`,
            Title: `Link`
        }, {
            Emoji: `&#x26D3`,
            Title: `Chains`
        }, {
            Emoji: `&#x1F489`,
            Title: `Syringe`
        }, {
            Emoji: `&#x1F48A`,
            Title: `Pill`
        }, {
            Emoji: `&#x1F6AC`,
            Title: `Cigarette`
        }, {
            Emoji: `&#x26B0`,
            Title: `Coffin`
        }, {
            Emoji: `&#x26B1`,
            Title: `Funeral Urn`
        }, {
            Emoji: `&#x1F5FF`,
            Title: `Moai`
        }, {
            Emoji: `&#x1F6E2`,
            Title: `Oil Drum`
        }, {
            Emoji: `&#x1F52E`,
            Title: `Crystal Ball`
        }, {
            Emoji: `&#x1F6D2`,
            Title: `Shopping Cart`
        }, {
            Emoji: `&#x1F3E7`,
            Title: `ATM Sign`
        }, {
            Emoji: `&#x1F6AE`,
            Title: `Litter In Bin Sign`
        }, {
            Emoji: `&#x1F6B0`,
            Title: `Potable Water`
        }, {
            Emoji: `&#x267F`,
            Title: `Wheelchair Symbol`
        }, {
            Emoji: `&#x1F6B9`,
            Title: `Mens Room`
        }, {
            Emoji: `&#x1F6BA`,
            Title: `Womens Room`
        }, {
            Emoji: `&#x1F6BB`,
            Title: `Restroom`
        }, {
            Emoji: `&#x1F6BC`,
            Title: `Baby Symbol`
        }, {
            Emoji: `&#x1F6BE`,
            Title: `Water Closet`
        }, {
            Emoji: `&#x1F6C2`,
            Title: `Passport Control`
        }, {
            Emoji: `&#x1F6C3`,
            Title: `Customs`
        }, {
            Emoji: `&#x1F6C4`,
            Title: `Baggage Claim`
        }, {
            Emoji: `&#x1F6C5`,
            Title: `Left Luggage`
        }, {
            Emoji: `&#x26A0`,
            Title: `Warning`
        }, {
            Emoji: `&#x1F6B8`,
            Title: `Children Crossing`
        }, {
            Emoji: `&#x26D4`,
            Title: `No Entry`
        }, {
            Emoji: `&#x1F6AB`,
            Title: `Prohibited`
        }, {
            Emoji: `&#x1F6B3`,
            Title: `No Bicycles`
        }, {
            Emoji: `&#x1F6AD`,
            Title: `No Smoking`
        }, {
            Emoji: `&#x1F6AF`,
            Title: `No Littering`
        }, {
            Emoji: `&#x1F6B1`,
            Title: `Non-Potable Water`
        }, {
            Emoji: `&#x1F6B7`,
            Title: `No Pedestrians`
        }, {
            Emoji: `&#x1F4F5`,
            Title: `No Mobile Phones`
        }, {
            Emoji: `&#x1F51E`,
            Title: `No One Under Eighteen`
        }, {
            Emoji: `&#x2622`,
            Title: `Radioactive`
        }, {
            Emoji: `&#x2623`,
            Title: `Biohazard`
        }, {
            Emoji: `&#x2B06`,
            Title: `Up Arrow`
        }, {
            Emoji: `&#x2197`,
            Title: `Up-Right Arrow`
        }, {
            Emoji: `&#x27A1`,
            Title: `Right Arrow`
        }, {
            Emoji: `&#x2198`,
            Title: `Down-Right Arrow`
        }, {
            Emoji: `&#x2B07`,
            Title: `Down Arrow`
        }, {
            Emoji: `&#x2199`,
            Title: `Down-Left Arrow`
        }, {
            Emoji: `&#x2B05`,
            Title: `Left Arrow`
        }, {
            Emoji: `&#x2196`,
            Title: `Up-Left Arrow`
        }, {
            Emoji: `&#x2195`,
            Title: `Up-Down Arrow`
        }, {
            Emoji: `&#x2194`,
            Title: `Left-Right Arrow`
        }, {
            Emoji: `&#x21A9`,
            Title: `Right Arrow Curving Left`
        }, {
            Emoji: `&#x21AA`,
            Title: `Left Arrow Curving Right`
        }, {
            Emoji: `&#x2934`,
            Title: `Right Arrow Curving Up`
        }, {
            Emoji: `&#x2935`,
            Title: `Right Arrow Curving Down`
        }, {
            Emoji: `&#x1F503`,
            Title: `Clockwise Vertical Arrows`
        }, {
            Emoji: `&#x1F504`,
            Title: `Anticlockwise Arrows Button`
        }, {
            Emoji: `&#x1F519`,
            Title: `BACK Arrow`
        }, {
            Emoji: `&#x1F51A`,
            Title: `END Arrow`
        }, {
            Emoji: `&#x1F51B`,
            Title: `ON! Arrow`
        }, {
            Emoji: `&#x1F51C`,
            Title: `SOON Arrow`
        }, {
            Emoji: `&#x1F51D`,
            Title: `TOP Arrow`
        }, {
            Emoji: `&#x1F6D0`,
            Title: `Place Of Worship`
        }, {
            Emoji: `&#x269B`,
            Title: `Atom Symbol`
        }, {
            Emoji: `&#x1F549`,
            Title: `Om`
        }, {
            Emoji: `&#x2721`,
            Title: `Star Of David`
        }, {
            Emoji: `&#x2638`,
            Title: `Wheel Of Dharma`
        }, {
            Emoji: `&#x262F`,
            Title: `Yin Yang`
        }, {
            Emoji: `&#x271D`,
            Title: `Latin Cross`
        }, {
            Emoji: `&#x2626`,
            Title: `Orthodox Cross`
        }, {
            Emoji: `&#x262A`,
            Title: `Star And Crescent`
        }, {
            Emoji: `&#x262E`,
            Title: `Peace Symbol`
        }, {
            Emoji: `&#x1F54E`,
            Title: `Menorah`
        }, {
            Emoji: `&#x1F52F`,
            Title: `Dotted Six-Pointed Star`
        }, {
            Emoji: `&#x2648`,
            Title: `Aries`
        }, {
            Emoji: `&#x2649`,
            Title: `Taurus`
        }, {
            Emoji: `&#x264A`,
            Title: `Gemini`
        }, {
            Emoji: `&#x264B`,
            Title: `Cancer`
        }, {
            Emoji: `&#x264C`,
            Title: `Leo`
        }, {
            Emoji: `&#x264D`,
            Title: `Virgo`
        }, {
            Emoji: `&#x264E`,
            Title: `Libra`
        }, {
            Emoji: `&#x264F`,
            Title: `Scorpius`
        }, {
            Emoji: `&#x2650`,
            Title: `Sagittarius`
        }, {
            Emoji: `&#x2651`,
            Title: `Capricorn`
        }, {
            Emoji: `&#x2652`,
            Title: `Aquarius`
        }, {
            Emoji: `&#x2653`,
            Title: `Pisces`
        }, {
            Emoji: `&#x26CE`,
            Title: `Ophiuchus`
        }, {
            Emoji: `&#x1F500`,
            Title: `Shuffle Tracks Button`
        }, {
            Emoji: `&#x1F501`,
            Title: `Repeat Button`
        }, {
            Emoji: `&#x1F502`,
            Title: `Repeat Single Button`
        }, {
            Emoji: `&#x25B6`,
            Title: `Play Button`
        }, {
            Emoji: `&#x23E9`,
            Title: `Fast-Forward Button`
        }, {
            Emoji: `&#x23ED`,
            Title: `Next Track Button`
        }, {
            Emoji: `&#x23EF`,
            Title: `Play Or Pause Button`
        }, {
            Emoji: `&#x25C0`,
            Title: `Reverse Button`
        }, {
            Emoji: `&#x23EA`,
            Title: `Fast Reverse Button`
        }, {
            Emoji: `&#x23EE`,
            Title: `Last Track Button`
        }, {
            Emoji: `&#x1F53C`,
            Title: `Up Button`
        }, {
            Emoji: `&#x23EB`,
            Title: `Fast Up Button`
        }, {
            Emoji: `&#x1F53D`,
            Title: `Down Button`
        }, {
            Emoji: `&#x23EC`,
            Title: `Fast Down Button`
        }, {
            Emoji: `&#x23F8`,
            Title: `Pause Button`
        }, {
            Emoji: `&#x23F9`,
            Title: `Stop Button`
        }, {
            Emoji: `&#x23FA`,
            Title: `Record Button`
        }, {
            Emoji: `&#x23CF`,
            Title: `Eject Button`
        }, {
            Emoji: `&#x1F3A6`,
            Title: `Cinema`
        }, {
            Emoji: `&#x1F505`,
            Title: `Dim Button`
        }, {
            Emoji: `&#x1F506`,
            Title: `Bright Button`
        }, {
            Emoji: `&#x1F4F6`,
            Title: `Antenna Bars`
        }, {
            Emoji: `&#x1F4F3`,
            Title: `Vibration Mode`
        }, {
            Emoji: `&#x1F4F4`,
            Title: `Mobile Phone Off`
        }, {
            Emoji: `&#x267B`,
            Title: `Recycling Symbol`
        }, {
            Emoji: `&#x1F4DB`,
            Title: `Name Badge`
        }, {
            Emoji: `&#x269C`,
            Title: `Fleur-De-Lis`
        }, {
            Emoji: `&#x1F530`,
            Title: `Japanese Symbol For Beginner`
        }, {
            Emoji: `&#x1F531`,
            Title: `Trident Emblem`
        }, {
            Emoji: `&#x2B55`,
            Title: `Heavy Large Circle`
        }, {
            Emoji: `&#x2705`,
            Title: `White Heavy Check Mark`
        }, {
            Emoji: `&#x2611`,
            Title: `Ballot Box With Check`
        }, {
            Emoji: `&#x2714`,
            Title: `Heavy Check Mark`
        }, {
            Emoji: `&#x2716`,
            Title: `Heavy Multiplication X`
        }, {
            Emoji: `&#x274C`,
            Title: `Cross Mark`
        }, {
            Emoji: `&#x274E`,
            Title: `Cross Mark Button`
        }, {
            Emoji: `&#x2795`,
            Title: `Heavy Plus Sign`
        }, {
            Emoji: `&#x2640`,
            Title: `Female Sign`
        }, {
            Emoji: `&#x2642`,
            Title: `Male Sign`
        }, {
            Emoji: `&#x2695`,
            Title: `Medical Symbol`
        }, {
            Emoji: `&#x2796`,
            Title: `Heavy Minus Sign`
        }, {
            Emoji: `&#x2797`,
            Title: `Heavy Division Sign`
        }, {
            Emoji: `&#x27B0`,
            Title: `Curly Loop`
        }, {
            Emoji: `&#x27BF`,
            Title: `Double Curly Loop`
        }, {
            Emoji: `&#x303D`,
            Title: `Part Alternation Mark`
        }, {
            Emoji: `&#x2733`,
            Title: `Eight-Spoked Asterisk`
        }, {
            Emoji: `&#x2734`,
            Title: `Eight-Pointed Star`
        }, {
            Emoji: `&#x2747`,
            Title: `Sparkle`
        }, {
            Emoji: `&#x203C`,
            Title: `Double Exclamation Mark`
        }, {
            Emoji: `&#x2049`,
            Title: `Exclamation Question Mark`
        }, {
            Emoji: `&#x2753`,
            Title: `Question Mark`
        }, {
            Emoji: `&#x2754`,
            Title: `White Question Mark`
        }, {
            Emoji: `&#x2755`,
            Title: `White Exclamation Mark`
        }, {
            Emoji: `&#x2757`,
            Title: `Exclamation Mark`
        }, {
            Emoji: `&#x3030`,
            Title: `Wavy Dash`
        }, {
            Emoji: `&#x00A9`,
            Title: `Copyright`
        }, {
            Emoji: `&#x00AE`,
            Title: `Registered`
        }, {
            Emoji: `&#x2122`,
            Title: `Trade Mark`
        }, {
            Emoji: `&#x0023&#xFE0F&#x20E3`,
            Title: `Keycap: #`
        }, {
            Emoji: `&#x002A&#xFE0F&#x20E3`,
            Title: `Keycap: *`
        }, {
            Emoji: `&#x0030&#xFE0F&#x20E3`,
            Title: `Keycap: 0`
        }, {
            Emoji: `&#x0031&#xFE0F&#x20E3`,
            Title: `Keycap: 1`
        }, {
            Emoji: `&#x0032&#xFE0F&#x20E3`,
            Title: `Keycap: 2`
        }, {
            Emoji: `&#x0033&#xFE0F&#x20E3`,
            Title: `Keycap: 3`
        }, {
            Emoji: `&#x0034&#xFE0F&#x20E3`,
            Title: `Keycap: 4`
        }, {
            Emoji: `&#x0035&#xFE0F&#x20E3`,
            Title: `Keycap: 5`
        }, {
            Emoji: `&#x0036&#xFE0F&#x20E3`,
            Title: `Keycap: 6`
        }, {
            Emoji: `&#x0037&#xFE0F&#x20E3`,
            Title: `Keycap: 7`
        }, {
            Emoji: `&#x0038&#xFE0F&#x20E3`,
            Title: `Keycap: 8`
        }, {
            Emoji: `&#x0039&#xFE0F&#x20E3`,
            Title: `Keycap: 9`
        }, {
            Emoji: `&#x1F51F`,
            Title: `Keycap 10`
        }, {
            Emoji: `&#x1F4AF`,
            Title: `Hundred Points`
        }, {
            Emoji: `&#x1F520`,
            Title: `Input Latin Uppercase`
        }, {
            Emoji: `&#x1F521`,
            Title: `Input Latin Lowercase`
        }, {
            Emoji: `&#x1F522`,
            Title: `Input Numbers`
        }, {
            Emoji: `&#x1F523`,
            Title: `Input Symbols`
        }, {
            Emoji: `&#x1F524`,
            Title: `Input Latin Letters`
        }, {
            Emoji: `&#x1F170`,
            Title: `A Button (blood Type)`
        }, {
            Emoji: `&#x1F18E`,
            Title: `AB Button (blood Type)`
        }, {
            Emoji: `&#x1F171`,
            Title: `B Button (blood Type)`
        }, {
            Emoji: `&#x1F191`,
            Title: `CL Button`
        }, {
            Emoji: `&#x1F192`,
            Title: `COOL Button`
        }, {
            Emoji: `&#x1F193`,
            Title: `FREE Button`
        }, {
            Emoji: `&#x2139`,
            Title: `Information`
        }, {
            Emoji: `&#x1F194`,
            Title: `ID Button`
        }, {
            Emoji: `&#x24C2`,
            Title: `Circled M`
        }, {
            Emoji: `&#x1F195`,
            Title: `NEW Button`
        }, {
            Emoji: `&#x1F196`,
            Title: `NG Button`
        }, {
            Emoji: `&#x1F17E`,
            Title: `O Button (blood Type)`
        }, {
            Emoji: `&#x1F197`,
            Title: `OK Button`
        }, {
            Emoji: `&#x1F17F`,
            Title: `P Button`
        }, {
            Emoji: `&#x1F198`,
            Title: `SOS Button`
        }, {
            Emoji: `&#x1F199`,
            Title: `UP! Button`
        }, {
            Emoji: `&#x1F19A`,
            Title: `VS Button`
        }, {
            Emoji: `&#x1F201`,
            Title: `Japanese here Button`
        }, {
            Emoji: `&#x1F202`,
            Title: `Japanese service Charge Button`
        }, {
            Emoji: `&#x1F237`,
            Title: `Japanese monthly Amount Button`
        }, {
            Emoji: `&#x1F236`,
            Title: `Japanese not Free Of Charge Button`
        }, {
            Emoji: `&#x1F22F`,
            Title: `Japanese reserved Button`
        }, {
            Emoji: `&#x1F250`,
            Title: `Japanese bargain Button`
        }, {
            Emoji: `&#x1F239`,
            Title: `Japanese discount Button`
        }, {
            Emoji: `&#x1F21A`,
            Title: `Japanese free Of Charge Button`
        }, {
            Emoji: `&#x1F232`,
            Title: `Japanese prohibited Button`
        }, {
            Emoji: `&#x1F251`,
            Title: `Japanese acceptable Button`
        }, {
            Emoji: `&#x1F238`,
            Title: `Japanese application Button`
        }, {
            Emoji: `&#x1F234`,
            Title: `Japanese passing Grade Button`
        }, {
            Emoji: `&#x1F233`,
            Title: `Japanese vacancy Button`
        }, {
            Emoji: `&#x3297`,
            Title: `Japanese congratulations Button`
        }, {
            Emoji: `&#x3299`,
            Title: `Japanese secret Button`
        }, {
            Emoji: `&#x1F23A`,
            Title: `Japanese open For Business Button`
        }, {
            Emoji: `&#x1F235`,
            Title: `Japanese no Vacancy Button`
        }, {
            Emoji: `&#x25AA`,
            Title: `Black Small Square`
        }, {
            Emoji: `&#x25AB`,
            Title: `White Small Square`
        }, {
            Emoji: `&#x25FB`,
            Title: `White Medium Square`
        }, {
            Emoji: `&#x25FC`,
            Title: `Black Medium Square`
        }, {
            Emoji: `&#x25FD`,
            Title: `White Medium-Small Square`
        }, {
            Emoji: `&#x25FE`,
            Title: `Black Medium-Small Square`
        }, {
            Emoji: `&#x2B1B`,
            Title: `Black Large Square`
        }, {
            Emoji: `&#x2B1C`,
            Title: `White Large Square`
        }, {
            Emoji: `&#x1F536`,
            Title: `Large Orange Diamond`
        }, {
            Emoji: `&#x1F537`,
            Title: `Large Blue Diamond`
        }, {
            Emoji: `&#x1F538`,
            Title: `Small Orange Diamond`
        }, {
            Emoji: `&#x1F539`,
            Title: `Small Blue Diamond`
        }, {
            Emoji: `&#x1F53A`,
            Title: `Red Triangle Pointed Up`
        }, {
            Emoji: `&#x1F53B`,
            Title: `Red Triangle Pointed Down`
        }, {
            Emoji: `&#x1F4A0`,
            Title: `Diamond With A Dot`
        }, {
            Emoji: `&#x1F518`,
            Title: `Radio Button`
        }, {
            Emoji: `&#x1F532`,
            Title: `Black Square Button`
        }, {
            Emoji: `&#x1F533`,
            Title: `White Square Button`
        }, {
            Emoji: `&#x26AA`,
            Title: `White Circle`
        }, {
            Emoji: `&#x26AB`,
            Title: `Black Circle`
        }, {
            Emoji: `&#x1F534`,
            Title: `Red Circle`
        }, {
            Emoji: `&#x1F535`,
            Title: `Blue Circle`
        }, {
            Emoji: `&#x1F3C1`,
            Title: `Chequered Flag`
        }, {
            Emoji: `&#x1F6A9`,
            Title: `Triangular Flag`
        }, {
            Emoji: `&#x1F38C`,
            Title: `Crossed Flags`
        }, {
            Emoji: `&#x1F3F4`,
            Title: `Black Flag`
        }, {
            Emoji: `&#x1F3F3`,
            Title: `White Flag`
        }, {
            Emoji: `&#x1F3F3&#xFE0F&#x200D&#x1F308`,
            Title: `Rainbow Flag`
        }, {
            Emoji: `&#x1F1E6&#x1F1E8`,
            Title: `Ascension Island`
        }, {
            Emoji: `&#x1F1E6&#x1F1E9`,
            Title: `Andorra`
        }, {
            Emoji: `&#x1F1E6&#x1F1EA`,
            Title: `United Arab Emirates`
        }, {
            Emoji: `&#x1F1E6&#x1F1EB`,
            Title: `Afghanistan`
        }, {
            Emoji: `&#x1F1E6&#x1F1EC`,
            Title: `Antigua & Barbuda`
        }, {
            Emoji: `&#x1F1E6&#x1F1EE`,
            Title: `Anguilla`
        }, {
            Emoji: `&#x1F1E6&#x1F1F1`,
            Title: `Albania`
        }, {
            Emoji: `&#x1F1E6&#x1F1F2`,
            Title: `Armenia`
        }, {
            Emoji: `&#x1F1E6&#x1F1F4`,
            Title: `Angola`
        }, {
            Emoji: `&#x1F1E6&#x1F1F6`,
            Title: `Antarctica`
        }, {
            Emoji: `&#x1F1E6&#x1F1F7`,
            Title: `Argentina`
        }, {
            Emoji: `&#x1F1E6&#x1F1F8`,
            Title: `American Samoa`
        }, {
            Emoji: `&#x1F1E6&#x1F1F9`,
            Title: `Austria`
        }, {
            Emoji: `&#x1F1E6&#x1F1FA`,
            Title: `Australia`
        }, {
            Emoji: `&#x1F1E6&#x1F1FC`,
            Title: `Aruba`
        }, {
            Emoji: `&#x1F1E6&#x1F1FD`,
            Title: `land Islands`
        }, {
            Emoji: `&#x1F1E6&#x1F1FF`,
            Title: `Azerbaijan`
        }, {
            Emoji: `&#x1F1E7&#x1F1E6`,
            Title: `Bosnia & Herzegovina`
        }, {
            Emoji: `&#x1F1E7&#x1F1E7`,
            Title: `Barbados`
        }, {
            Emoji: `&#x1F1E7&#x1F1E9`,
            Title: `Bangladesh`
        }, {
            Emoji: `&#x1F1E7&#x1F1EA`,
            Title: `Belgium`
        }, {
            Emoji: `&#x1F1E7&#x1F1EB`,
            Title: `Burkina Faso`
        }, {
            Emoji: `&#x1F1E7&#x1F1EC`,
            Title: `Bulgaria`
        }, {
            Emoji: `&#x1F1E7&#x1F1ED`,
            Title: `Bahrain`
        }, {
            Emoji: `&#x1F1E7&#x1F1EE`,
            Title: `Burundi`
        }, {
            Emoji: `&#x1F1E7&#x1F1EF`,
            Title: `Benin`
        }, {
            Emoji: `&#x1F1E7&#x1F1F1`,
            Title: `St. Barthlemy`
        }, {
            Emoji: `&#x1F1E7&#x1F1F2`,
            Title: `Bermuda`
        }, {
            Emoji: `&#x1F1E7&#x1F1F3`,
            Title: `Brunei`
        }, {
            Emoji: `&#x1F1E7&#x1F1F4`,
            Title: `Bolivia`
        }, {
            Emoji: `&#x1F1E7&#x1F1F6`,
            Title: `Caribbean Netherlands`
        }, {
            Emoji: `&#x1F1E7&#x1F1F7`,
            Title: `Brazil`
        }, {
            Emoji: `&#x1F1E7&#x1F1F8`,
            Title: `Bahamas`
        }, {
            Emoji: `&#x1F1E7&#x1F1F9`,
            Title: `Bhutan`
        }, {
            Emoji: `&#x1F1E7&#x1F1FB`,
            Title: `Bouvet Island`
        }, {
            Emoji: `&#x1F1E7&#x1F1FC`,
            Title: `Botswana`
        }, {
            Emoji: `&#x1F1E7&#x1F1FE`,
            Title: `Belarus`
        }, {
            Emoji: `&#x1F1E7&#x1F1FF`,
            Title: `Belize`
        }, {
            Emoji: `&#x1F1E8&#x1F1E6`,
            Title: `Canada`
        }, {
            Emoji: `&#x1F1E8&#x1F1E8`,
            Title: `Cocos (Keeling) Islands`
        }, {
            Emoji: `&#x1F1E8&#x1F1E9`,
            Title: `Congo - Kinshasa`
        }, {
            Emoji: `&#x1F1E8&#x1F1EB`,
            Title: `Central African Republic`
        }, {
            Emoji: `&#x1F1E8&#x1F1EC`,
            Title: `Congo - Brazzaville`
        }, {
            Emoji: `&#x1F1E8&#x1F1ED`,
            Title: `Switzerland`
        }, {
            Emoji: `&#x1F1E8&#x1F1EE`,
            Title: `Cte DIvoire`
        }, {
            Emoji: `&#x1F1E8&#x1F1F0`,
            Title: `Cook Islands`
        }, {
            Emoji: `&#x1F1E8&#x1F1F1`,
            Title: `Chile`
        }, {
            Emoji: `&#x1F1E8&#x1F1F2`,
            Title: `Cameroon`
        }, {
            Emoji: `&#x1F1E8&#x1F1F3`,
            Title: `China`
        }, {
            Emoji: `&#x1F1E8&#x1F1F4`,
            Title: `Colombia`
        }, {
            Emoji: `&#x1F1E8&#x1F1F5`,
            Title: `Clipperton Island`
        }, {
            Emoji: `&#x1F1E8&#x1F1F7`,
            Title: `Costa Rica`
        }, {
            Emoji: `&#x1F1E8&#x1F1FA`,
            Title: `Cuba`
        }, {
            Emoji: `&#x1F1E8&#x1F1FB`,
            Title: `Cape Verde`
        }, {
            Emoji: `&#x1F1E8&#x1F1FC`,
            Title: `Curaao`
        }, {
            Emoji: `&#x1F1E8&#x1F1FD`,
            Title: `Christmas Island`
        }, {
            Emoji: `&#x1F1E8&#x1F1FE`,
            Title: `Cyprus`
        }, {
            Emoji: `&#x1F1E8&#x1F1FF`,
            Title: `Czech Republic`
        }, {
            Emoji: `&#x1F1E9&#x1F1EA`,
            Title: `Germany`
        }, {
            Emoji: `&#x1F1E9&#x1F1EC`,
            Title: `Diego Garcia`
        }, {
            Emoji: `&#x1F1E9&#x1F1EF`,
            Title: `Djibouti`
        }, {
            Emoji: `&#x1F1E9&#x1F1F0`,
            Title: `Denmark`
        }, {
            Emoji: `&#x1F1E9&#x1F1F2`,
            Title: `Dominica`
        }, {
            Emoji: `&#x1F1E9&#x1F1F4`,
            Title: `Dominican Republic`
        }, {
            Emoji: `&#x1F1E9&#x1F1FF`,
            Title: `Algeria`
        }, {
            Emoji: `&#x1F1EA&#x1F1E6`,
            Title: `Ceuta & Melilla`
        }, {
            Emoji: `&#x1F1EA&#x1F1E8`,
            Title: `Ecuador`
        }, {
            Emoji: `&#x1F1EA&#x1F1EA`,
            Title: `Estonia`
        }, {
            Emoji: `&#x1F1EA&#x1F1EC`,
            Title: `Egypt`
        }, {
            Emoji: `&#x1F1EA&#x1F1ED`,
            Title: `Western Sahara`
        }, {
            Emoji: `&#x1F1EA&#x1F1F7`,
            Title: `Eritrea`
        }, {
            Emoji: `&#x1F1EA&#x1F1F8`,
            Title: `Spain`
        }, {
            Emoji: `&#x1F1EA&#x1F1F9`,
            Title: `Ethiopia`
        }, {
            Emoji: `&#x1F1EA&#x1F1FA`,
            Title: `European Union`
        }, {
            Emoji: `&#x1F1EB&#x1F1EE`,
            Title: `Finland`
        }, {
            Emoji: `&#x1F1EB&#x1F1EF`,
            Title: `Fiji`
        }, {
            Emoji: `&#x1F1EB&#x1F1F0`,
            Title: `Falkland Islands`
        }, {
            Emoji: `&#x1F1EB&#x1F1F2`,
            Title: `Micronesia`
        }, {
            Emoji: `&#x1F1EB&#x1F1F4`,
            Title: `Faroe Islands`
        }, {
            Emoji: `&#x1F1EB&#x1F1F7`,
            Title: `France`
        }, {
            Emoji: `&#x1F1EC&#x1F1E6`,
            Title: `Gabon`
        }, {
            Emoji: `&#x1F1EC&#x1F1E7`,
            Title: `United Kingdom`
        }, {
            Emoji: `&#x1F1EC&#x1F1E9`,
            Title: `Grenada`
        }, {
            Emoji: `&#x1F1EC&#x1F1EA`,
            Title: `Georgia`
        }, {
            Emoji: `&#x1F1EC&#x1F1EB`,
            Title: `French Guiana`
        }, {
            Emoji: `&#x1F1EC&#x1F1EC`,
            Title: `Guernsey`
        }, {
            Emoji: `&#x1F1EC&#x1F1ED`,
            Title: `Ghana`
        }, {
            Emoji: `&#x1F1EC&#x1F1EE`,
            Title: `Gibraltar`
        }, {
            Emoji: `&#x1F1EC&#x1F1F1`,
            Title: `Greenland`
        }, {
            Emoji: `&#x1F1EC&#x1F1F2`,
            Title: `Gambia`
        }, {
            Emoji: `&#x1F1EC&#x1F1F3`,
            Title: `Guinea`
        }, {
            Emoji: `&#x1F1EC&#x1F1F5`,
            Title: `Guadeloupe`
        }, {
            Emoji: `&#x1F1EC&#x1F1F6`,
            Title: `Equatorial Guinea`
        }, {
            Emoji: `&#x1F1EC&#x1F1F7`,
            Title: `Greece`
        }, {
            Emoji: `&#x1F1EC&#x1F1F8`,
            Title: `South Georgia & South Sandwich Islands`
        }, {
            Emoji: `&#x1F1EC&#x1F1F9`,
            Title: `Guatemala`
        }, {
            Emoji: `&#x1F1EC&#x1F1FA`,
            Title: `Guam`
        }, {
            Emoji: `&#x1F1EC&#x1F1FC`,
            Title: `Guinea-Bissau`
        }, {
            Emoji: `&#x1F1EC&#x1F1FE`,
            Title: `Guyana`
        }, {
            Emoji: `&#x1F1ED&#x1F1F0`,
            Title: `Hong Kong SAR China`
        }, {
            Emoji: `&#x1F1ED&#x1F1F2`,
            Title: `Heard & McDonald Islands`
        }, {
            Emoji: `&#x1F1ED&#x1F1F3`,
            Title: `Honduras`
        }, {
            Emoji: `&#x1F1ED&#x1F1F7`,
            Title: `Croatia`
        }, {
            Emoji: `&#x1F1ED&#x1F1F9`,
            Title: `Haiti`
        }, {
            Emoji: `&#x1F1ED&#x1F1FA`,
            Title: `Hungary`
        }, {
            Emoji: `&#x1F1EE&#x1F1E8`,
            Title: `Canary Islands`
        }, {
            Emoji: `&#x1F1EE&#x1F1E9`,
            Title: `Indonesia`
        }, {
            Emoji: `&#x1F1EE&#x1F1EA`,
            Title: `Ireland`
        }, {
            Emoji: `&#x1F1EE&#x1F1F1`,
            Title: `Israel`
        }, {
            Emoji: `&#x1F1EE&#x1F1F2`,
            Title: `Isle Of Man`
        }, {
            Emoji: `&#x1F1EE&#x1F1F3`,
            Title: `India`
        }, {
            Emoji: `&#x1F1EE&#x1F1F4`,
            Title: `British Indian Ocean Territory`
        }, {
            Emoji: `&#x1F1EE&#x1F1F6`,
            Title: `Iraq`
        }, {
            Emoji: `&#x1F1EE&#x1F1F7`,
            Title: `Iran`
        }, {
            Emoji: `&#x1F1EE&#x1F1F8`,
            Title: `Iceland`
        }, {
            Emoji: `&#x1F1EE&#x1F1F9`,
            Title: `Italy`
        }, {
            Emoji: `&#x1F1EF&#x1F1EA`,
            Title: `Jersey`
        }, {
            Emoji: `&#x1F1EF&#x1F1F2`,
            Title: `Jamaica`
        }, {
            Emoji: `&#x1F1EF&#x1F1F4`,
            Title: `Jordan`
        }, {
            Emoji: `&#x1F1EF&#x1F1F5`,
            Title: `Japan`
        }, {
            Emoji: `&#x1F1F0&#x1F1EA`,
            Title: `Kenya`
        }, {
            Emoji: `&#x1F1F0&#x1F1EC`,
            Title: `Kyrgyzstan`
        }, {
            Emoji: `&#x1F1F0&#x1F1ED`,
            Title: `Cambodia`
        }, {
            Emoji: `&#x1F1F0&#x1F1EE`,
            Title: `Kiribati`
        }, {
            Emoji: `&#x1F1F0&#x1F1F2`,
            Title: `Comoros`
        }, {
            Emoji: `&#x1F1F0&#x1F1F3`,
            Title: `St. Kitts & Nevis`
        }, {
            Emoji: `&#x1F1F0&#x1F1F5`,
            Title: `North Korea`
        }, {
            Emoji: `&#x1F1F0&#x1F1F7`,
            Title: `South Korea`
        }, {
            Emoji: `&#x1F1F0&#x1F1FC`,
            Title: `Kuwait`
        }, {
            Emoji: `&#x1F1F0&#x1F1FE`,
            Title: `Cayman Islands`
        }, {
            Emoji: `&#x1F1F0&#x1F1FF`,
            Title: `Kazakhstan`
        }, {
            Emoji: `&#x1F1F1&#x1F1E6`,
            Title: `Laos`
        }, {
            Emoji: `&#x1F1F1&#x1F1E7`,
            Title: `Lebanon`
        }, {
            Emoji: `&#x1F1F1&#x1F1E8`,
            Title: `St. Lucia`
        }, {
            Emoji: `&#x1F1F1&#x1F1EE`,
            Title: `Liechtenstein`
        }, {
            Emoji: `&#x1F1F1&#x1F1F0`,
            Title: `Sri Lanka`
        }, {
            Emoji: `&#x1F1F1&#x1F1F7`,
            Title: `Liberia`
        }, {
            Emoji: `&#x1F1F1&#x1F1F8`,
            Title: `Lesotho`
        }, {
            Emoji: `&#x1F1F1&#x1F1F9`,
            Title: `Lithuania`
        }, {
            Emoji: `&#x1F1F1&#x1F1FA`,
            Title: `Luxembourg`
        }, {
            Emoji: `&#x1F1F1&#x1F1FB`,
            Title: `Latvia`
        }, {
            Emoji: `&#x1F1F1&#x1F1FE`,
            Title: `Libya`
        }, {
            Emoji: `&#x1F1F2&#x1F1E6`,
            Title: `Morocco`
        }, {
            Emoji: `&#x1F1F2&#x1F1E8`,
            Title: `Monaco`
        }, {
            Emoji: `&#x1F1F2&#x1F1E9`,
            Title: `Moldova`
        }, {
            Emoji: `&#x1F1F2&#x1F1EA`,
            Title: `Montenegro`
        }, {
            Emoji: `&#x1F1F2&#x1F1EB`,
            Title: `St. Martin`
        }, {
            Emoji: `&#x1F1F2&#x1F1EC`,
            Title: `Madagascar`
        }, {
            Emoji: `&#x1F1F2&#x1F1ED`,
            Title: `Marshall Islands`
        }, {
            Emoji: `&#x1F1F2&#x1F1F0`,
            Title: `Macedonia`
        }, {
            Emoji: `&#x1F1F2&#x1F1F1`,
            Title: `Mali`
        }, {
            Emoji: `&#x1F1F2&#x1F1F2`,
            Title: `Myanmar (Burma)`
        }, {
            Emoji: `&#x1F1F2&#x1F1F3`,
            Title: `Mongolia`
        }, {
            Emoji: `&#x1F1F2&#x1F1F4`,
            Title: `Macau SAR China`
        }, {
            Emoji: `&#x1F1F2&#x1F1F5`,
            Title: `Northern Mariana Islands`
        }, {
            Emoji: `&#x1F1F2&#x1F1F6`,
            Title: `Martinique`
        }, {
            Emoji: `&#x1F1F2&#x1F1F7`,
            Title: `Mauritania`
        }, {
            Emoji: `&#x1F1F2&#x1F1F8`,
            Title: `Montserrat`
        }, {
            Emoji: `&#x1F1F2&#x1F1F9`,
            Title: `Malta`
        }, {
            Emoji: `&#x1F1F2&#x1F1FA`,
            Title: `Mauritius`
        }, {
            Emoji: `&#x1F1F2&#x1F1FB`,
            Title: `Maldives`
        }, {
            Emoji: `&#x1F1F2&#x1F1FC`,
            Title: `Malawi`
        }, {
            Emoji: `&#x1F1F2&#x1F1FD`,
            Title: `Mexico`
        }, {
            Emoji: `&#x1F1F2&#x1F1FE`,
            Title: `Malaysia`
        }, {
            Emoji: `&#x1F1F2&#x1F1FF`,
            Title: `Mozambique`
        }, {
            Emoji: `&#x1F1F3&#x1F1E6`,
            Title: `Namibia`
        }, {
            Emoji: `&#x1F1F3&#x1F1E8`,
            Title: `New Caledonia`
        }, {
            Emoji: `&#x1F1F3&#x1F1EA`,
            Title: `Niger`
        }, {
            Emoji: `&#x1F1F3&#x1F1EB`,
            Title: `Norfolk Island`
        }, {
            Emoji: `&#x1F1F3&#x1F1EC`,
            Title: `Nigeria`
        }, {
            Emoji: `&#x1F1F3&#x1F1EE`,
            Title: `Nicaragua`
        }, {
            Emoji: `&#x1F1F3&#x1F1F1`,
            Title: `Netherlands`
        }, {
            Emoji: `&#x1F1F3&#x1F1F4`,
            Title: `Norway`
        }, {
            Emoji: `&#x1F1F3&#x1F1F5`,
            Title: `Nepal`
        }, {
            Emoji: `&#x1F1F3&#x1F1F7`,
            Title: `Nauru`
        }, {
            Emoji: `&#x1F1F3&#x1F1FA`,
            Title: `Niue`
        }, {
            Emoji: `&#x1F1F3&#x1F1FF`,
            Title: `New Zealand`
        }, {
            Emoji: `&#x1F1F4&#x1F1F2`,
            Title: `Oman`
        }, {
            Emoji: `&#x1F1F5&#x1F1E6`,
            Title: `Panama`
        }, {
            Emoji: `&#x1F1F5&#x1F1EA`,
            Title: `Peru`
        }, {
            Emoji: `&#x1F1F5&#x1F1EB`,
            Title: `French Polynesia`
        }, {
            Emoji: `&#x1F1F5&#x1F1EC`,
            Title: `Papua New Guinea`
        }, {
            Emoji: `&#x1F1F5&#x1F1ED`,
            Title: `Philippines`
        }, {
            Emoji: `&#x1F1F5&#x1F1F0`,
            Title: `Pakistan`
        }, {
            Emoji: `&#x1F1F5&#x1F1F1`,
            Title: `Poland`
        }, {
            Emoji: `&#x1F1F5&#x1F1F2`,
            Title: `St. Pierre & Miquelon`
        }, {
            Emoji: `&#x1F1F5&#x1F1F3`,
            Title: `Pitcairn Islands`
        }, {
            Emoji: `&#x1F1F5&#x1F1F7`,
            Title: `Puerto Rico`
        }, {
            Emoji: `&#x1F1F5&#x1F1F8`,
            Title: `Palestinian Territories`
        }, {
            Emoji: `&#x1F1F5&#x1F1F9`,
            Title: `Portugal`
        }, {
            Emoji: `&#x1F1F5&#x1F1FC`,
            Title: `Palau`
        }, {
            Emoji: `&#x1F1F5&#x1F1FE`,
            Title: `Paraguay`
        }, {
            Emoji: `&#x1F1F6&#x1F1E6`,
            Title: `Qatar`
        }, {
            Emoji: `&#x1F1F7&#x1F1EA`,
            Title: `Runion`
        }, {
            Emoji: `&#x1F1F7&#x1F1F4`,
            Title: `Romania`
        }, {
            Emoji: `&#x1F1F7&#x1F1F8`,
            Title: `Serbia`
        }, {
            Emoji: `&#x1F1F7&#x1F1FA`,
            Title: `Russia`
        }, {
            Emoji: `&#x1F1F7&#x1F1FC`,
            Title: `Rwanda`
        }, {
            Emoji: `&#x1F1F8&#x1F1E6`,
            Title: `Saudi Arabia`
        }, {
            Emoji: `&#x1F1F8&#x1F1E7`,
            Title: `Solomon Islands`
        }, {
            Emoji: `&#x1F1F8&#x1F1E8`,
            Title: `Seychelles`
        }, {
            Emoji: `&#x1F1F8&#x1F1E9`,
            Title: `Sudan`
        }, {
            Emoji: `&#x1F1F8&#x1F1EA`,
            Title: `Sweden`
        }, {
            Emoji: `&#x1F1F8&#x1F1EC`,
            Title: `Singapore`
        }, {
            Emoji: `&#x1F1F8&#x1F1ED`,
            Title: `St. Helena`
        }, {
            Emoji: `&#x1F1F8&#x1F1EE`,
            Title: `Slovenia`
        }, {
            Emoji: `&#x1F1F8&#x1F1EF`,
            Title: `Svalbard & Jan Mayen`
        }, {
            Emoji: `&#x1F1F8&#x1F1F0`,
            Title: `Slovakia`
        }, {
            Emoji: `&#x1F1F8&#x1F1F1`,
            Title: `Sierra Leone`
        }, {
            Emoji: `&#x1F1F8&#x1F1F2`,
            Title: `San Marino`
        }, {
            Emoji: `&#x1F1F8&#x1F1F3`,
            Title: `Senegal`
        }, {
            Emoji: `&#x1F1F8&#x1F1F4`,
            Title: `Somalia`
        }, {
            Emoji: `&#x1F1F8&#x1F1F7`,
            Title: `Suriname`
        }, {
            Emoji: `&#x1F1F8&#x1F1F8`,
            Title: `South Sudan`
        }, {
            Emoji: `&#x1F1F8&#x1F1F9`,
            Title: `So Tom & Prncipe`
        }, {
            Emoji: `&#x1F1F8&#x1F1FB`,
            Title: `El Salvador`
        }, {
            Emoji: `&#x1F1F8&#x1F1FD`,
            Title: `Sint Maarten`
        }, {
            Emoji: `&#x1F1F8&#x1F1FE`,
            Title: `Syria`
        }, {
            Emoji: `&#x1F1F8&#x1F1FF`,
            Title: `Swaziland`
        }, {
            Emoji: `&#x1F1F9&#x1F1E6`,
            Title: `Tristan Da Cunha`
        }, {
            Emoji: `&#x1F1F9&#x1F1E8`,
            Title: `Turks & Caicos Islands`
        }, {
            Emoji: `&#x1F1F9&#x1F1E9`,
            Title: `Chad`
        }, {
            Emoji: `&#x1F1F9&#x1F1EB`,
            Title: `French Southern Territories`
        }, {
            Emoji: `&#x1F1F9&#x1F1EC`,
            Title: `Togo`
        }, {
            Emoji: `&#x1F1F9&#x1F1ED`,
            Title: `Thailand`
        }, {
            Emoji: `&#x1F1F9&#x1F1EF`,
            Title: `Tajikistan`
        }, {
            Emoji: `&#x1F1F9&#x1F1F0`,
            Title: `Tokelau`
        }, {
            Emoji: `&#x1F1F9&#x1F1F1`,
            Title: `Timor-Leste`
        }, {
            Emoji: `&#x1F1F9&#x1F1F2`,
            Title: `Turkmenistan`
        }, {
            Emoji: `&#x1F1F9&#x1F1F3`,
            Title: `Tunisia`
        }, {
            Emoji: `&#x1F1F9&#x1F1F4`,
            Title: `Tonga`
        }, {
            Emoji: `&#x1F1F9&#x1F1F7`,
            Title: `Turkey`
        }, {
            Emoji: `&#x1F1F9&#x1F1F9`,
            Title: `Trinidad & Tobago`
        }, {
            Emoji: `&#x1F1F9&#x1F1FB`,
            Title: `Tuvalu`
        }, {
            Emoji: `&#x1F1F9&#x1F1FC`,
            Title: `Taiwan`
        }, {
            Emoji: `&#x1F1F9&#x1F1FF`,
            Title: `Tanzania`
        }, {
            Emoji: `&#x1F1FA&#x1F1E6`,
            Title: `Ukraine`
        }, {
            Emoji: `&#x1F1FA&#x1F1EC`,
            Title: `Uganda`
        }, {
            Emoji: `&#x1F1FA&#x1F1F2`,
            Title: `U.S. Outlying Islands`
        }, {
            Emoji: `&#x1F1FA&#x1F1F3`,
            Title: `United Nations`
        }, {
            Emoji: `&#x1F1FA&#x1F1F8`,
            Title: `United States`
        }, {
            Emoji: `&#x1F1FA&#x1F1FE`,
            Title: `Uruguay`
        }, {
            Emoji: `&#x1F1FA&#x1F1FF`,
            Title: `Uzbekistan`
        }, {
            Emoji: `&#x1F1FB&#x1F1E6`,
            Title: `Vatican City`
        }, {
            Emoji: `&#x1F1FB&#x1F1E8`,
            Title: `St. Vincent & Grenadines`
        }, {
            Emoji: `&#x1F1FB&#x1F1EA`,
            Title: `Venezuela`
        }, {
            Emoji: `&#x1F1FB&#x1F1EC`,
            Title: `British Virgin Islands`
        }, {
            Emoji: `&#x1F1FB&#x1F1EE`,
            Title: `U.S. Virgin Islands`
        }, {
            Emoji: `&#x1F1FB&#x1F1F3`,
            Title: `Vietnam`
        }, {
            Emoji: `&#x1F1FB&#x1F1FA`,
            Title: `Vanuatu`
        }, {
            Emoji: `&#x1F1FC&#x1F1EB`,
            Title: `Wallis & Futuna`
        }, {
            Emoji: `&#x1F1FC&#x1F1F8`,
            Title: `Samoa`
        }, {
            Emoji: `&#x1F1FD&#x1F1F0`,
            Title: `Kosovo`
        }, {
            Emoji: `&#x1F1FE&#x1F1EA`,
            Title: `Yemen`
        }, {
            Emoji: `&#x1F1FE&#x1F1F9`,
            Title: `Mayotte`
        }, {
            Emoji: `&#x1F1FF&#x1F1E6`,
            Title: `South Africa`
        }, {
            Emoji: `&#x1F1FF&#x1F1F2`,
            Title: `Zambia`
        }
    ];
}

function getCfhAreas(context) {
    var textAreas = context.querySelectorAll(`textarea[name*="description"]`);
    for (var i = 0, n = textAreas.length; i < n; ++i) {
        addCFHPanel(textAreas[i]);
    }
}

function addCFHPanel(Context) {
    var CFH, I, N;
    if (!Context.parentElement.getElementsByClassName(`esgst-cfh-panel`)[0]) {
        Context.insertAdjacentHTML(`beforeBegin`, `<div class="page__heading page_heading esgst-cfh-panel"></div>`);
        CFH = {
            Items: [{
                ID: `cfh_i`,
                Name: `Italic`,
                Icon: `fa-italic`,
                Prefix: `*`,
                Suffix: `*`
            }, {
                ID: `cfh_b`,
                Name: `Bold`,
                Icon: `fa-bold`,
                Prefix: `**`,
                Suffix: `**`
            }, {
                ID: `cfh_s`,
                Name: `Spoiler`,
                Icon: `fa-eye-slash`,
                Prefix: `~`,
                Suffix: `~`
            }, {
                ID: `cfh_st`,
                Name: `Strikethrough`,
                Icon: `fa-strikethrough`,
                Prefix: `~~`,
                Suffix: `~~`
            }, {
                ID: `cfh_h1`,
                Name: `Heading 1`,
                Icon: `fa-header`,
                Text: `1`,
                Prefix: `# `
            }, {
                ID: `cfh_h2`,
                Name: `Heading 2`,
                Icon: `fa-header`,
                Text: `2`,
                Prefix: `## `
            }, {
                ID: `cfh_h3`,
                Name: `Heading 3`,
                Icon: `fa-header`,
                Text: `3`,
                Prefix: `### `
            }, {
                ID: `cfh_bq`,
                Name: `Blockquote`,
                Icon: `fa-quote-left`,
                Prefix: `> `
            }, {
                ID: `cfh_lb`,
                Name: `Line Break`,
                Icon: `fa-minus`,
                Prefix: `\n---\n\n`
            }, {
                ID: `cfh_ol`,
                Name: `Ordered List`,
                Icon: `fa-list-ol`,
                OrderedList: true
            }, {
                ID: `cfh_ul`,
                Name: `Unordered List`,
                Icon: `fa-list-ul`,
                UnorderedList: true
            }, {
                ID: `cfh_ic`,
                Name: `Inline Code`,
                Icon: `fa-code`,
                Prefix: `\``,
                Suffix: `\``
            }, {
                ID: `cfh_lc`,
                Name: `Line Code`,
                Icon: `fa-code`,
                SecondaryIcon: `fa-indent`,
                Prefix: `    `
            }, {
                ID: `cfh_pc`,
                Name: `Paragraph Code`,
                Icon: `fa-code`,
                SecondaryIcon: `fa-paragraph`,
                Prefix: `\`\`\`\n`,
                Suffix: `\n\`\`\``
            }, {
                ID: `cfh_l`,
                Name: `Link`,
                Icon: `fa-globe`,
                setPopout: function (popout) {
                    var URL, Title;
                    popout.popout.innerHTML = `
                        <div>URL: <input placeholder="http://www.example.com" type="text"/></div>
                        <div>Title: <input placeholder="Cat" type="text"/></div>
                        <div class="form__saving-button btn_action white">Add</div>
                    `;
                    URL = popout.popout.firstElementChild.firstElementChild;
                    Title = popout.popout.firstElementChild.nextElementSibling.firstElementChild;
                    popout.popout.lastElementChild.addEventListener(`click`, function () {
                        wrapCFHLinkImage(CFH, Title.value, URL.value);
                        URL.value = ``;
                        Title.value = ``;
                        popout.close();
                    });
                },
                Callback: function (popout) {
                    var Value = CFH.TextArea.value;
                    var Start = CFH.TextArea.selectionStart;
                    var End = CFH.TextArea.selectionEnd;
                    popout.firstElementChild.nextElementSibling.firstElementChild.value = Value.slice(Start, End);
                    setTimeout(function () {
                        popout.firstElementChild.firstElementChild.focus();
                    }, 0);
                }
            }, {
                ID: `cfh_img`,
                Name: `Image`,
                Icon: `fa-image`,
                setPopout: function (popout) {
                    var imgur, URL, Title;
                    popout.popout.innerHTML = `
                        <div>URL: <input placeholder="http://www.example.com/image.jpg" type="text"/> <i class="esgst-clickable fa fa-upload" title="Upload image to Imgur and use it"></i></div>
                        <div>Title: <input placeholder="Cats" type="text"/></div>
                        <div class="form__saving-button btn_action white">Add</div>
                    `;
                    URL = popout.popout.firstElementChild.firstElementChild;
                    imgur = URL.nextElementSibling;
                    Title = popout.popout.firstElementChild.nextElementSibling.firstElementChild;
                    popout.popout.lastElementChild.addEventListener(`click`, function () {
                        wrapCFHLinkImage(CFH, Title.value, URL.value, true);
                        URL.value = ``;
                        Title.value = ``;
                        popout.close();
                    });
                    imgur.addEventListener(`click`, () => {
                        multiChoice(`grey`, `fa-user-secret`, `Anonymously`, `grey`, `fa-user`, `Through Account`, `How would you like to upload?`, uploadImgurImage.bind(null, `Client-ID e25283ef48ab9aa`, popout, URL), () => {
                            if (getValue(`imgurToken`)) {
                                checkImgurComplete(popout, URL);
                            } else {
                                checkImgurComplete(popout, URL, open(`https://api.imgur.com/oauth2/authorize?client_id=e25283ef48ab9aa&response_type=token`));
                            }
                        });
                    });
                },
                Callback: function (popout) {
                    var Value = CFH.TextArea.value;
                    var Start = CFH.TextArea.selectionStart;
                    var End = CFH.TextArea.selectionEnd;
                    popout.firstElementChild.nextElementSibling.firstElementChild.value = Value.slice(Start, End);
                    setTimeout(function () {
                        let url = popout.firstElementChild.firstElementChild;
                        let title = popout.firstElementChild.nextElementSibling.firstElementChild;
                        if (url.value && title.value) {
                            popout.lastElementChild.click();
                        } else if (url.value) {
                            title.focus();
                        } else {
                            url.focus();
                        }
                    }, 0);
                }
            }, {
                ID: `cfh_t`,
                Name: `Table`,
                Icon: `fa-table`,
                setPopup: function (popup) {
                    var Table, InsertRow, InsertColumn, popout;
                    popout = popup.scrollable;
                    popout.innerHTML = `
                        <table></table>
                        <div class="form__saving-button btn_action white">Insert Row</div>
                        <div class="form__saving-button btn_action white">Insert Column</div>
                        <div class="form__saving-button btn_action white">Add</div>
                    `;
                    Table = popout.firstElementChild;
                    InsertRow = Table.nextElementSibling;
                    InsertColumn = InsertRow.nextElementSibling;
                    insertCFHTableRows(4, Table);
                    insertCFHTableColumns(2, Table);
                    InsertRow.addEventListener(`click`, function () {
                        insertCFHTableRows(1, Table);
                    });
                    InsertColumn.addEventListener(`click`, function () {
                        insertCFHTableColumns(1, Table);
                    });
                    InsertColumn.nextElementSibling.addEventListener(`click`, function () {
                        var Rows, I, NumRows, J, NumColumns, Value, Start, End;
                        Rows = Table.rows;
                        for (I = 1, NumRows = Rows.length; I < NumRows; ++I) {
                            for (J = 1, NumColumns = Rows[0].cells.length; J < NumColumns; ++J) {
                                if (!Rows[I].cells[J].firstElementChild.value) {
                                    I = NumRows + 1;
                                    J = NumColumns + 1;
                                }
                            }
                        }
                        if ((I <= NumRows) || ((I > NumRows) && confirm(`Some cells are empty. This might lead to unexpected results. Are you sure you want to continue?`))) {
                            Value = ``;
                            for (I = 1; I < NumRows; ++I) {
                                Value += `\n`;
                                for (J = 1; J < NumColumns; ++J) {
                                    Value += Rows[I].cells[J].firstElementChild.value + ((J < (NumColumns - 1)) ? ` | ` : ``);
                                }
                            }
                            Value += `\n\n`;
                            Start = CFH.TextArea.selectionStart;
                            End = CFH.TextArea.selectionEnd;
                            CFH.TextArea.value = CFH.TextArea.value.slice(0, Start) + Value + CFH.TextArea.value.slice(End);
                            CFH.TextArea.setSelectionRange(End + Value.length, End + Value.length);
                            CFH.TextArea.focus();
                            popup.close();
                        }
                    });
                }
            }, {
                ID: `cfh_e`,
                Name: `Emojis`,
                Icon: `fa-smile-o`,
                setPopout: function (popout) {
                    var Emojis;
                    popout.popout.innerHTML = `
                        <div class="esgst-cfh-emojis">${getValue(`emojis`, ``)}</div>
                        <div class="form__saving-button btn_action white">Select Emojis</div>
                    `;
                    Emojis = popout.popout.firstElementChild;
                    setCFHEmojis(Emojis, CFH);

                    Emojis.nextElementSibling.addEventListener(`click`, function () {
                        var popup, emoji, filter, i, I, N, Emoji, SavedEmojis;
                        popup = new Popup(`fa-smile-o`, `Select emojis:`);
                        popup.scrollable.insertAdjacentHTML(`afterBegin`, `
                            <input placeholder="Filter emojis..." type="text"/>
                            <div class="esgst-cfh-emojis"></div>
                            <div class="esgst-description">Drag the emojis you want to use and drop them in the box below. Click on an emoji to remove it.</div>
                            <div class="global__image-outer-wrap page_heading_btn esgst-cfh-emojis">${getValue(`emojis`, ``)}</div>
                        `);
                        filter = popup.scrollable.firstElementChild;
                        Emojis = filter.nextElementSibling;
                        for (I = 0, N = esgst.emojis.length; I < N; ++I) {
                            Emoji = esgst.emojis[I].Emoji;
                            Emojis.insertAdjacentHTML(`beforeEnd`, `<span data-id="${Emoji}" draggable="true" title="${esgst.emojis[I].Title}">${Emoji}</span>`);
                            Emojis.lastElementChild.addEventListener(`dragstart`, function (Event) {
                                Event.dataTransfer.setData(`text`, Event.currentTarget.getAttribute(`data-id`));
                            });
                        }
                        filter.addEventListener(`input`, () => {
                            if (filter.value) {
                                for (i = Emojis.children.length - 1; i > -1; --i) {
                                    emoji = Emojis.children[i];
                                    if (emoji.getAttribute(`title`).toLowerCase().match(filter.value)) {
                                        emoji.classList.remove(`esgst-hidden`);
                                    } else {
                                        emoji.classList.add(`esgst-hidden`);
                                    }
                                }
                            } else {
                                for (i = Emojis.children.length - 1; i > -1; --i) {
                                    Emojis.children[i].classList.remove(`esgst-hidden`);
                                }
                            }
                            popup.reposition();
                        });
                        SavedEmojis = Emojis.nextElementSibling.nextElementSibling;
                        for (I = 0, N = SavedEmojis.children.length; I < N; ++I) {
                            SavedEmojis.children[I].addEventListener(`click`, function (Event) {
                                Event.currentTarget.remove();
                                setValue(`emojis`, SavedEmojis.innerHTML);
                                popup.reposition();
                            });
                        }
                        SavedEmojis.addEventListener(`dragover`, function (Event) {
                            Event.preventDefault();
                        });
                        SavedEmojis.addEventListener(`drop`, function (Event) {
                            var ID;
                            Event.preventDefault();
                            ID = Event.dataTransfer.getData(`text`).replace(/\\/g, `\\\\`);
                            if (!SavedEmojis.querySelector(`[data-id="${ID}"]`)) {
                                SavedEmojis.appendChild(document.querySelector(`[data-id="${ID}"]`).cloneNode(true));
                                setValue(`emojis`, SavedEmojis.innerHTML);
                                popup.reposition();
                                SavedEmojis.lastElementChild.addEventListener(`click`, function (Event) {
                                    Event.currentTarget.remove();
                                    setValue(`emojis`, SavedEmojis.innerHTML);
                                    popup.reposition();
                                });
                            }
                        });
                        popup.open(function () {
                            popout.popout.classList.add(`esgst-hidden`);
                        });
                    });
                },
                Callback: function (popout) {
                    var Emojis;
                    Emojis = popout.firstElementChild;
                    Emojis.innerHTML = getValue(`emojis`, ``);
                    setCFHEmojis(Emojis, CFH);
                }
            }, {
                Name: `Links / Images Paste Formatting`,
                Icon: `fa-paste`,
                Callback: function (Context) {
                    CFH.ALIPF = Context.firstElementChild;
                    setCFHALIPF(CFH, esgst.cfh_pasteFormatting);
                },
                OnClick: function () {
                    setCFHALIPF(CFH);
                }
            }, {
                ID: `cfh_g`,
                Name: `Giveaway Encrypter`,
                Icon: `fa-star`,
                setPopout: function (popout) {
                    var Code;
                    popout.popout.innerHTML = `
                        Giveaway Code: <input placeholder="XXXXX" type="text"/>
                        <div class="form__saving-button btn_action white">Add</div>
                    `;
                    Code = popout.popout.firstElementChild;
                    Code.nextElementSibling.addEventListener(`click`, function () {
                        if (Code.value.match(/^[\d\w]{5}$/)) {
                            var encodedCode = encryptGedCode(Code.value);
                            wrapCFHLinkImage(CFH, ``, `ESGST-${encodedCode}`);
                            Code.value = ``;
                            popout.close();
                        } else {
                            alert(`Wrong format. The right format is XXXXX.`);
                        }
                    });
                },
                Callback: function (popout) {
                    var Value = CFH.TextArea.value;
                    var Start = CFH.TextArea.selectionStart;
                    var End = CFH.TextArea.selectionEnd;
                    popout.firstElementChild.nextElementSibling.value = Value.slice(Start, End);
                    setTimeout(function () {
                        popout.firstElementChild.focus();
                    }, 0);
                }
            }, {
                ID: `cfh_sr`,
                Name: `Saved Replies`,
                Icon: `fa-floppy-o`,
                setPopout: function (popout) {
                    var addButton, filter, i, n, reply, replies, savedReply, savedReplies;
                    savedReplies = JSON.parse(getValue(`savedReplies`, `[]`));
                    popout.popout.innerHTML = `
                        <div>
                            <input placeholder="Filter replies..." type="text"/>
                        </div>
                        <div class="esgst-cfh-sr-container"></div>
                        <div class="form__saving-button btn_action white">Add New Reply</div>
                        <div class="esgst-clickable esgst-hidden">
                            <i class="fa fa-rotate-left"></i>
                            <span>Undo Delete</span>
                        </div>
                    `;
                    CFH.deleted = [];
                    filter = popout.popout.firstElementChild.firstElementChild;
                    CFH.undo = popout.popout.lastElementChild;
                    CFH.undo.addEventListener(`click`, undoCfhDelete.bind(null, CFH));
                    addButton = CFH.undo.previousElementSibling;
                    replies = addButton.previousElementSibling;
                    for (i = 0, n = savedReplies.length; i < n; ++i) {
                        savedReply = savedReplies[i];
                        setCfhReply(CFH, replies, savedReply);
                    }
                    filter.addEventListener(`input`, filterCfhReplies.bind(null, replies));
                    addButton.addEventListener(`click`, openCfhReplyPopup.bind(null, CFH, null, null, replies, null));
                },
                Callback: function (popout) {
                    setTimeout(function () {
                        popout.firstElementChild.firstElementChild.focus();
                    }, 0);
                }
            }],
            Panel: Context.previousElementSibling,
            TextArea: Context,
        };
        for (I = 0, N = CFH.Items.length; I < N; ++I) {
            addCFHItem(CFH.Items[I], CFH);
        }
        CFH.TextArea.addEventListener(`paste`, function (Event) {
            var Value;
            if (esgst.cfh_pasteFormatting) {
                Value = Event.clipboardData.getData(`text/plain`);
                if (Value.match(/^https?:/)) {
                    Event.preventDefault();
                    wrapCFHLinkImage(CFH, ``, Value, Value.match(/\.(jpg|jpeg|gif|bmp|png)/) ? true : false);
                }
            }
        });

    }
}

function checkImgurComplete(popout, url, win) {
    if (!win || win.closed) {
        uploadImgurImage(`Bearer ${getValue(`imgurToken`)}`, popout, url);
    } else {
        setTimeout(checkImgurComplete, 250, popout, url, win);
    }
}

function uploadImgurImage(authorization, popout, url) {
    let popup = new Popup(`fa-upload`, `Upload Image`, true);
    let input = insertHtml(popup.description, `beforeEnd`, `<input type="file"/>`);
    let warning = insertHtml(popup.description, `beforeEnd`, `<div class="esgst-description esgst-warning"></div>`);
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-upload`, `fa-circle-o-notch fa-spin`, `Upload`, `Uploading...`, callback => {
        let file = input.files[0];
        if (file) {
            if (file.type.match(/^image/)) {
                if (file.size / 1024 / 1024 <= 10) {
                    reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = readImgurFile.bind(null, authorization, popout, popup, reader, url, warning, callback);
                } else {
                    createFadeMessage(warning, `Image is larger than 10 MB!`);
                    callback();
                }
            } else {
                createFadeMessage(warning, `File is not an image!`);
                callback();
            }
        } else {
            createFadeMessage(warning, `No file was loaded!`);
            callback();
        }
    }).set);
    popup.open();
}

function readImgurFile(authorization, popout, popup, reader, url, warning, callback) {
    request(`image=${encodeURIComponent(reader.result.match(/base64,(.+)/)[1])}`, {authorization}, false, `https://api.imgur.com/3/image`, response => {
        let responseJson = JSON.parse(response.responseText);
        if (responseJson.success) {
            callback();
            popup.close();
            url.value = responseJson.data.link;
            popout.open();
        } else {
            createFadeMessage(warning, `Could not upload image!`);
            callback();
        }
    });
}

function setCfhReply(cfh, replies, savedReply) {
    var controls, current, deleteButton, description, editButton, i, n, matches, name, reply, savedReplies, start, summary, end, value;
    reply = insertHtml(replies, `beforeEnd`, `
        <div class="esgst-cfh-sr-box" draggable="true">
            <div class="esgst-cfh-sr-summary">
                <div class="esgst-cfh-sr-name">${savedReply.name}</div>
                <div class="esgst-cfh-sr-description">${savedReply.description}</div>
            </div>
            <div class="esgst-cfh-sr-controls">
                <i class="esgst-clickable fa fa-edit" title="Edit reply."></i>
                <i class="esgst-clickable fa fa-trash" title="Delete reply."></i>
                <i class="fa fa-question-circle" title="Drag the reply to move it."></i>
            </div>
        </div>
    `);
    summary = reply.firstElementChild;
    name = summary.firstElementChild;
    description = name.nextElementSibling;
    controls = summary.nextElementSibling;
    editButton = controls.firstElementChild;
    deleteButton = editButton.nextElementSibling;
    summary.addEventListener(`click`, function () {
        start = cfh.TextArea.selectionStart;
        end = cfh.TextArea.selectionEnd;
        value = savedReply.description;
        matches = value.match(/\[ESGST-R\][\s\S]+?\[\/ESGST-R\]/g);
        if (matches) {
            n = matches.length;
            i = Math.floor(Math.random() * n);
            value = matches[i].match(/\[ESGST-R\]([\s\S]+?)\[\/ESGST-R\]/)[1];
        }
        cfh.TextArea.value = cfh.TextArea.value.slice(0, start) + value + cfh.TextArea.value.slice(end);
        cfh.TextArea.setSelectionRange(end + value.length, end + value.length);
        cfh.TextArea.focus();
    });
    reply.addEventListener(`dragstart`, setCfhSource.bind(null, cfh, description, name, reply));
    reply.addEventListener(`dragenter`, getCfhSource.bind(null, cfh, reply, replies));
    reply.addEventListener(`dragend`, saveCfhSource.bind(null, cfh));
    editButton.addEventListener(`click`, function () {
        openCfhReplyPopup(cfh, savedReply.description, savedReply.name, replies, summary);
    });
    deleteButton.addEventListener(`click`, function () {
        savedReplies = JSON.parse(getValue(`savedReplies`, `[]`));
        for (i = 0, n = savedReplies.length; i < n && savedReplies[i].name !== name.textContent && savedReplies[i].description !== description.textContent; ++i);
        if (i < n) {
            savedReplies.splice(i, 1);
            setValue(`savedReplies`, JSON.stringify(savedReplies));
            reply.classList.add(`esgst-hidden`);
            cfh.deleted.push({
                reply: reply,
                savedReply: savedReply
            });
            cfh.undo.classList.remove(`esgst-hidden`);
        }
    });
}

function undoCfhDelete(cfh) {
    var deleted, saved;
    deleted = cfh.deleted.pop();
    deleted.reply.classList.remove(`esgst-hidden`);
    deleted.reply.parentElement.appendChild(deleted.reply);
    saved = JSON.parse(getValue(`savedReplies`, `[]`));
    saved.push(deleted.savedReply);
    setValue(`savedReplies`, JSON.stringify(saved));
    if (cfh.deleted.length === 0) {
        cfh.undo.classList.add(`esgst-hidden`);
    }
}

function setCfhSource(cfh, description, name, reply) {
    var i, n, savedReplies;
    cfh.source = reply;
    savedReplies = JSON.parse(getValue(`savedReplies`, `[]`));
    for (i = 0, n = savedReplies.length; i < n && savedReplies[i].name !== name.textContent && savedReplies[i].description !== description.textContent; ++i);
    if (i < n) {
        cfh.sourceIndex = i;
    }
}

function getCfhSource(cfh, reply, replies) {
    var current, i;
    current = cfh.source;
    i = 0;
    do {
        current = current.previousElementSibling;
        if (current && current === reply) {
            cfh.sourceNewIndex = i;
            replies.insertBefore(cfh.source, reply);
            return;
        }
        ++i;
    } while (current);
    cfh.sourceNewIndex = i - 1;
    replies.insertBefore(cfh.source, reply.nextElementSibling);
}

function saveCfhSource(cfh) {
    var savedReplies;
    savedReplies = JSON.parse(getValue(`savedReplies`, `[]`));
    savedReplies.splice(cfh.sourceNewIndex, 0, savedReplies.splice(cfh.sourceIndex, 1)[0]);
    setValue(`savedReplies`, JSON.stringify(savedReplies));
}

function filterCfhReplies(replies, event) {
    var i, n, reply, value;
    value = event.currentTarget.value;
    for (i = 0, n = replies.children.length; i < n; ++i) {
        reply = replies.children[i];
        if (reply.textContent.toLowerCase().match(value.toLowerCase())) {
            reply.classList.remove(`esgst-hidden`);
        } else {
            reply.classList.add(`esgst-hidden`);
        }
    }
}

function openCfhReplyPopup(cfh, description, name, replies, summary) {
    var descriptionArea, nameArea, panel, popup;
    popup = new Popup(`fa-floppy-o`, summary ? `Edit reply:` : `Save new reply:`, true);
    popup.scrollable.insertAdjacentHTML(`beforeEnd`, `
        <div class="esgst-description">
            You can save a defined list of replies to be picked at random when using it. To do so, enclose each option with <span class="esgst-bold">[ESGST-R][/ESGST-R]</span>. For example, a defined list that renders a random "thank you" comment when using it would look like this:<br/><br/>
            [ESGST-R]Thanks![/ESGST-R]<br/>
            [ESGST-R]Thank you![/ESGST-R]<br/>
            [ESGST-R]Thank you so much!<br/><br/>
            Can't wait to play this game![/ESGST-R]
        </div>
    `);
    panel = insertHtml(popup.scrollable, `beforeEnd`, `
        <div>
            <div>
                <div>Name:</div>
                <input type="text" value="${name || ``}"/>
            </div>
            <div>
                <div>Description:</div>
                <textarea>${description || ``}</textarea>
            </div>
        </div>
    `);
    nameArea = panel.firstElementChild;
    descriptionArea = nameArea.nextElementSibling;
    nameArea = nameArea.lastElementChild;
    descriptionArea = descriptionArea.lastElementChild;
    addCFHPanel(descriptionArea);
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveCfhReply.bind(null, cfh, description, descriptionArea, name, nameArea, popup, replies, summary)).set);
    popup.open();
}

function saveCfhReply(cfh, description, descriptionArea, name, nameArea, popup, replies, summary, callback) {
    var descVal, i, n, nameVal, reply, savedReplies, savedReply;
    descVal = descriptionArea.value.trim();
    nameVal = nameArea.value.trim();
    if (descVal && nameVal) {
        savedReplies = JSON.parse(getValue(`savedReplies`, `[]`));
        savedReply = {
            description: descVal,
            name: nameVal
        };
        if (summary) {
            for (i = 0, n = savedReplies.length; i < n && savedReplies[i].name !== name && savedReplies[i].description !== description; ++i);
            if (i < n) {
                savedReplies[i] = savedReply;
                summary.firstElementChild.textContent = nameVal;
                summary.lastElementChild.textContent = descVal;
            }
        } else {
            savedReplies.push(savedReply);
            setCfhReply(cfh, replies, savedReply);
        }
        setValue(`savedReplies`, JSON.stringify(savedReplies));
        callback();
        popup.close();
    } else {
        callback();
        createAlert(`Both fields are required.`);
    }
}

function wrapCFHLinkImage(CFH, Title, URL, Image) {
    var Start, End, Value;
    Start = CFH.TextArea.selectionStart;
    End = CFH.TextArea.selectionEnd;
    Value = `${Image ? `!` : ``}[${Title}](${URL})`;
    CFH.TextArea.value = CFH.TextArea.value.slice(0, Start) + Value + CFH.TextArea.value.slice(End);
    CFH.TextArea.setSelectionRange(End + Value.length, End + Value.length);
    CFH.TextArea.focus();
}

function insertCFHTableRows(N, Table) {
    while (N > 0) {
        insertCFHTableRow(Table);
        --N;
    }
}

function insertCFHTableRow(Table) {
    var N, Row, I, J, Delete;
    N = Table.rows.length;
    Row = Table.insertRow(N);
    for (I = 0, J = Table.rows[0].cells.length - 1; I < J; ++I) {
        Row.insertCell(0).innerHTML = `<input placeholder="Value" type="text"/>`;
    }
    Delete = Row.insertCell(0);
    if (N > 2) {
        Delete.innerHTML = `
            <a>
                <i class="fa fa-times-circle" title="Delete row"></i>
            </a>
        `;
        Delete.firstElementChild.addEventListener(`click`, function () {
            if (Table.rows.length > 4) {
                Row.remove();
            } else {
                alert(`A table must have a least one row and two columns.`);
            }
        });
    }
}

function insertCFHTableColumns(N, Table) {
    while (N > 0) {
        insertCFHTableColumn(Table);
        --N;
    }
}

function insertCFHTableColumn(Table) {
    var Rows, N, I, J, Delete, Column;
    Rows = Table.rows;
    N = Rows[0].cells.length;
    for (I = 3, J = Rows.length; I < J; ++I) {
        Rows[I].insertCell(N).innerHTML = `<input placeholder="Value" type="text"/>`;
    }
    Rows[2].insertCell(N).innerHTML = `
        <select>
            <option value=":-">Left</option>
            <option value=":-:">Center</option>
            <option value="-:">Right</option>
        </select>
    `;
    Delete = Rows[0].insertCell(N);
    Delete.innerHTML = `
        <a>
            <i class="fa fa-times-circle" title="Delete column"></i>
        </a>
    `;
    Column = Rows[1].insertCell(N);
    Column.innerHTML = `<input placeholder="Header" type="text"/>`;
    Delete.firstElementChild.addEventListener(`click`, function () {
        Rows = Table.rows;
        N = Rows[1].cells.length;
        if (N > 3) {
            do {
                --N;
            } while (Rows[1].cells[N] != Column);
            for (I = 0, J = Rows.length; I < J; ++I) {
                Rows[I].deleteCell(N);
            }
        } else {
            alert(`A table must have at least one row and two columns.`);
        }
    });
}

function setCFHEmojis(Emojis, CFH) {
    var I, N;
    for (I = 0, N = Emojis.children.length; I < N; ++I) {
        Emojis.children[I].addEventListener(`click`, function (Event) {
            wrapCFHFormat(CFH, Event.currentTarget.textContent);
        });
    }
}

function addCFHItem(Item, CFH) {
    var Context, Button, popout;
    if ((Item.ID && esgst[Item.ID]) || !Item.ID) {
        CFH.Panel.insertAdjacentHTML(`beforeEnd`, `
            <span>
                <a class="page_heading_btn" title="${Item.Name}">
                    <i class="fa ${Item.Icon}"></i>
                    ${Item.SecondaryIcon ? `
                        <i class="fa ${Item.SecondaryIcon}"></i>
                    ` : ``}
                    ${Item.Text ? `
                        <span>${Item.Text}</span>
                    ` : ``}
                </a>
            </span>
        `);
        Context = CFH.Panel.lastElementChild;
        Button = Context.firstElementChild;
        if (Item.setPopout) {
            popout = new Popout(`esgst-cfh-popout`, Button, 0, true, null, Item.Callback);
            Item.setPopout(popout);
        } else if (Item.setPopup) {
            var popup;
            Button.addEventListener(`click`, function () {
                if (popup) {
                    popup.open();
                } else {
                    popup = new Popup(`fa-table`, `Add a table:`);
                    Item.setPopup(popup);
                    popup.open();
                }
            });
        } else {
            if (Item.Callback) {
                Item.Callback(Context);
            }
            Context.addEventListener(`click`, function () {
                if (Item.OnClick) {
                    Item.OnClick();
                } else {
                    wrapCFHFormat(CFH, Item.Prefix, Item.Suffix, Item.OrderedList, Item.UnorderedList);
                }
            });
        }
    }
}

function wrapCFHFormat(CFH, Prefix, Suffix, OrderedList, UnorderedList) {
    var Value, Start, End, N;
    Value = CFH.TextArea.value;
    Start = CFH.TextArea.selectionStart;
    End = CFH.TextArea.selectionEnd;
    if (OrderedList || UnorderedList) {
        if (OrderedList) {
            N = 1;
            Prefix = `${N}. ${Value.slice(Start, End).replace(/\n/g, function () {
                return `\n${++N}. `;
            })}`;
        } else {
            Prefix = `* ${Value.slice(Start, End).replace(/\n/g, `\n* `)}`;
        }
    }
    CFH.TextArea.value = `${Value.slice(0, Start)}${Prefix}${OrderedList || UnorderedList ? `` : `${Value.slice(Start, End)}${Suffix ? Suffix : ``}`}${Value.slice(End)}`;
    CFH.TextArea.setSelectionRange(End + Prefix.length, End + Prefix.length);
    CFH.TextArea.focus();
}

function setCFHALIPF(CFH, Value) {
    if (typeof Value === `undefined`) {
        Value = esgst.cfh_pasteFormatting ? false : true;
    }
    setSetting(`cfh_pasteFormatting`, Value);
    esgst.cfh_pasteFormatting = Value;
    if (Value) {
        CFH.ALIPF.title = `Links / Images Paste Formatting: On`;
        CFH.ALIPF.classList.remove(`esgst-cfh-alipf`);
    } else {
        CFH.ALIPF.title = `Links / Images Paste Formatting: Off`;
        CFH.ALIPF.classList.add(`esgst-cfh-alipf`);
    }
}

/* [CERB] Collapse/Expand Replies Button */

function loadCerb() {
    var button, collapse, comments, expand, id;
    if (esgst.cerb && esgst.commentsPath) {
        comments = document.getElementsByClassName(`comments`)[0];
        if (comments && comments.children.length) {
            esgst.cerbButtons = [];
            button = insertHtml(esgst.mainPageHeadingBackground || esgst.mainPageHeading, `afterEnd`, `
                <div class="esgst-cerb-button esgst-clickable">
                    <span>
                        <i class="fa fa-minus-square"></i> Collapse all replies
                    </span>
                    <span class="esgst-hidden">
                        <i class="fa fa-plus-square"></i> Expand all replies
                    </span>
                </div>
            `);
            collapse = button.firstElementChild;
            expand = collapse.nextElementSibling;
            collapse.addEventListener(`click`, collapseAllCerbReplies.bind(null, collapse, expand));
            expand.addEventListener(`click`, expandAllCerbReplies.bind(null, collapse, expand));
            esgst.endlessFeatures.push(getCerbReplies.bind(null, collapse, expand, null));
            id = location.hash.replace(/#/, ``);
            getCerbReplies(collapse, expand, id ? document.getElementById(id) : null, document);
        }
    }
}

function getCerbReplies(collapse, expand, permalink, context) {
    var elements, i, n, reply, replies;
    elements = context.querySelectorAll(`:not(.esgst-popup) .comments > .comment, :not(.esgst-popup) .comments > .comment_outer`);
    for (i = 0, n = elements.length; i < n; ++i) {
        reply = elements[i];
        replies = reply.querySelector(`.comment__children, .comment_children`);
        if (replies && replies.children.length) {
            setCerbButton(insertHtml(reply.firstElementChild, `afterBegin`, `
                <div class="esgst-cerb-reply-button esgst-clickable">
                    <span title="Collapse all replies">
                        <i class="fa fa-minus-square"></i>
                    </span>
                    <span class="esgst-hidden" title="Expand all replies">
                        <i class="fa fa-plus-square"></i>
                    </span>
                </div>
            `), permalink && reply.contains(permalink), reply, replies.children);
        }
    }
    if (context === document && esgst.cerb_a) {
        collapseAllCerbReplies(collapse, expand);
    }
}

function setCerbButton(button, permalink,  reply, replies) {
    var collapse, expand;
    collapse = button.firstElementChild;
    expand = collapse.nextElementSibling;
    esgst.cerbButtons.push({
        collapse: collapseCerbReplies.bind(null, collapse, expand, replies),
        expand: expandCerbReplies.bind(null, collapse, expand, replies),
        permalink: permalink
    });
    collapse.addEventListener(`click`, collapseCerbReplies.bind(null, collapse, expand, replies));
    expand.addEventListener(`click`, expandCerbReplies.bind(null, collapse, expand, replies));
    if (esgst.cerb_a && !permalink) {
        collapse.classList.toggle(`esgst-hidden`);
        expand.classList.toggle(`esgst-hidden`);
    }
}

function collapseCerbReplies(collapse, expand, replies) {
    var i, n, replies;
    for (i = 0, n = replies.length; i < n; ++i) {
        replies[i].classList.add(`esgst-hidden`);
    }
    collapse.classList.add(`esgst-hidden`);
    expand.classList.remove(`esgst-hidden`);
}

function expandCerbReplies(collapse, expand, replies) {
    var i, n, replies;
    for (i = 0, n = replies.length; i < n; ++i) {
        replies[i].classList.remove(`esgst-hidden`);
    }
    collapse.classList.remove(`esgst-hidden`);
    expand.classList.add(`esgst-hidden`);
}

function collapseAllCerbReplies(collapse, expand) {
    var i, n;
    for (i = 0, n = esgst.cerbButtons.length; i < n; ++i) {
        if (!esgst.cerbButtons[i].permalink) {
            esgst.cerbButtons[i].collapse();
        }
    }
    collapse.classList.add(`esgst-hidden`);
    expand.classList.remove(`esgst-hidden`);
}

function expandAllCerbReplies(collapse, expand) {
    var i, n;
    for (i = 0, n = esgst.cerbButtons.length; i < n; ++i) {
        esgst.cerbButtons[i].expand();
    }
    collapse.classList.remove(`esgst-hidden`);
    expand.classList.add(`esgst-hidden`);
}

/* [RBOT] Reply Box On Top */

function loadRbot() {
    if (esgst.replyBox) {
        var html = `
            <div class="esgst-rbot"></div>
        `;
        var sibling;
        if (esgst.mainPageHeadingBackground) {
            sibling = esgst.mainPageHeadingBackground;
        } else {
            sibling = esgst.mainPageHeading;
        }
        sibling.insertAdjacentHTML(`afterEnd`, html);
        var box = sibling.nextElementSibling;
        box.appendChild(esgst.replyBox);
        var button = box.getElementsByClassName(esgst.cancelButtonClass)[0];
        if (button) {
            button.addEventListener(`click`, waitToRestoreReplyBox);
        }
    }

    function waitToRestoreReplyBox() {
        setTimeout(restoreReplyBox, 0);
    }

    function restoreReplyBox() {
        box.appendChild(esgst.replyBox);
    }
}

/* [CS] Comment Searcher */

function openCsPopup(cs) {
    if (!cs.popup) {
        cs.popup = new Popup(`fa-comments` , `Search comments from specific users:`);
        cs.input = insertHtml(cs.popup.description, `afterBegin`, `<input type="text" placeholder="username1, username2, ..."/>`);
        cs.input.addEventListener(`keydown`, triggerCsInput.bind(null, cs));
        cs.results = insertHtml(cs.popup.scrollable, `beforeEnd`, `<div class="esgst-text-left"></div>`);
        cs.set = new ButtonSet(`green`, `grey`, `fa-search`, `fa-times`, `Search`, `Cancel`, startCsSearch.bind(null, cs), cancelCsSearch.bind(null, cs));
        cs.popup.description.appendChild(cs.set.set);
        cs.progress = insertHtml(cs.popup.description, `beforeEnd`, `<div></div>`);
    }
    cs.popup.open(focusCsInput.bind(null, cs));
}

function focusCsInput(cs) {
    cs.input.focus();
}

function triggerCsInput(cs, event) {
    if (event.key === `Enter`) {
        cs.set.trigger();
    }
}

function startCsSearch(cs, callback) {
    var cache, csCache;
    cs.canceled = false;
    cs.button.classList.add(`esgst-busy`);
    cs.results.innerHTML = ``;
    cs.usernames = cs.input.value.toLowerCase().replace(/(,\s*)+/g, function (match, p1, offset, string) {
        return (((offset === 0) || (offset === (string.length - match.length))) ? `` : `, `);
    }).split(`, `);
    match = location.pathname.match(/^\/(giveaway|discussion|support\/ticket|trade)\/(.+?)\//);
    cs.code = match[2];
    cs.type = match[1];
    cs.title = esgst.originalTitle.replace(/\s-\sPage\s\d+/, ``);
    searchCsComments(cs, 1, esgst.searchUrl, completeCsSearch.bind(null, cs, callback));
}

function searchCsComments(cs, nextPage, url, callback) {
    if (!cs.canceled) {
        request(null, null, false, `${url}${nextPage}`, getNextCsPage.bind(null, cs, nextPage, url, callback));
    }
}

function getNextCsPage(cs, nextPage, url, callback, response) {
    var comments, element, elements, html, i, n, pagination, parent;
    if (!cs.canceled) {
        responseHtml = DOM.parse(response.responseText);
        if (nextPage === 1) {
            cs.lastPage = getLastPage(responseHtml, false, esgst.discussionPath);
            cs.lastPage = cs.lastPage === 999999999 ? `` : ` of ${cs.lastPage}`;
        }
        cs.progress.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <span>Searching comments (page ${nextPage - 1}${cs.lastPage})...</span>
        `;
        comments = responseHtml.getElementsByClassName(`comments`);
        comments = comments[1] || comments[0];
        elements = comments.querySelectorAll(`.comment:not(.comment--submit), .comment_outer`);
        for (i = 0, n = elements.length; i < n; ++i) {
            element = elements[i];
            if (esgst.sg) {
                element.firstElementChild.classList.remove(`comment__parent`);
                element.firstElementChild.classList.add(`comment__child`);
            }
            parent = element.parentElement.closest(`.comment, .comment_outer`);
            element = element.cloneNode(true);
            element.lastElementChild.innerHTML = ``;
            html = `<div class="comment comments comment_outer">`;
            if (parent) {
                parent = parent.cloneNode(true);
                parent.lastElementChild.remove();
                parent.insertAdjacentHTML(`beforeEnd`, `
                    <div class="comment__children comment_children">${element.outerHTML}</div>
                `);
                html += parent.outerHTML;
            } else {
                if (esgst.st) {
                    element.getElementsByClassName(`action_list`)[0].firstElementChild.insertAdjacentHTML(`afterEnd`, `
                        <a href="/${cs.type}/${cs.code}/">${cs.title} - Page ${nextPage}</a>
                    `);
                }
                html += esgst.sg ? `
                    <div class="comments__entity">
                        <p class="comments__entity__name">
                            <a href="/${cs.type}/${cs.code}/">${cs.title} - Page ${nextPage}</a>
                        </p>
                    </div>` : ``;
                html += `<div class="comment__children comment_children">${element.outerHTML}</div>`;
            }
            html += `</div>`;
            if (cs.usernames.indexOf(element.querySelector(`.comment__username, .author_name`).textContent.trim().toLowerCase()) >= 0) {
                cs.results.insertAdjacentHTML(`beforeEnd`, html);
            }
            cs.popup.reposition();
        }
        pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
        if (pagination && !pagination.lastElementChild.classList.contains(esgst.selectedClass)) {
            setTimeout(searchCsComments, 0, cs, ++nextPage, url, callback);
        } else {
            callback();
        }
    }
}

function completeCsSearch(cs, callback) {
    cs.button.classList.remove(`esgst-busy`);
    cs.progress.innerHTML = `${cs.results.children.length} results found.`;
    loadEndlessFeatures(cs.results);
    callback();
}

function cancelCsSearch(cs) {
    cs.button.classList.remove(`esgst-busy`);
    cs.canceled = true;
    cs.progress.innerHTML = `${cs.results.children.length} results found.`;
    loadEndlessFeatures(cs.results);
}

/* [RRBP] Received Reply Box Popup */

function openRrbp(giveaway) {
    var popup, progress, textArea;
    popup = new Popup(`fa-comment`, `Add a comment:`);
    textArea = insertHtml(popup.scrollable, `beforeEnd`, `<textarea></textarea>`);
    if (esgst.cfh) {
        addCFHPanel(textArea);
    }
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, function (callback) {
        progress.innerHTML = ``;
        saveComment(``, ``, textArea.value, giveaway.url, progress, callback, function () {
            popup.close();
        });
    }).set);
    progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    popup.open(function () {
        textArea.focus();
    });
}

/* [RBP] Reply Box Popup */

function loadRbp(button) {
    var popup;
    popup = new Popup(`fa-comment`, `Add a comment:`);
    popup.TextArea = insertHtml(popup.scrollable, `beforeEnd`, `<textarea></textarea>`);
    if (esgst.cfh) {
        addCFHPanel(popup.TextArea);
    }
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, function (Callback) {
        popup.Progress.innerHTML = ``;
        saveComment(esgst.sg ? `` : document.querySelector(`[name="trade_code"]`).value, ``, popup.TextArea.value, esgst.sg ? location.href.match(/(.+?)(#.+?)?$/)[1] : `/ajax.php`, popup.Progress,
            Callback);
    }).set);
    popup.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    button.addEventListener(`click`, function () {
        popup.open(function () {
            popup.TextArea.focus();
        });
    });
}

/* [MR] Multi-Reply */
/* [RFI] Reply From Inbox */

function loadMr() {
    if (!esgst.inboxPath) {
        esgst.endlessFeatures.push(getMrRfiButtons);
        getMrRfiButtons(document);
    }
}

function loadRfi() {
    if (esgst.inboxPath) {
        esgst.endlessFeatures.push(getMrRfiButtons);
        getMrRfiButtons(document);
    }
}

function getMrRfiButtons(context) {
    var matches = context.getElementsByClassName(esgst.sg ? `comment__actions` : `action_list`);
    for (var i = 0, n = matches.length; i < n; ++i) {
        addMRButton(matches[i]);
    }
}

function addMRButton(Context) {
    var MR, Parent, ReplyButton, Permalink;
    MR = {
        Context: Context,
        Comment: Context.closest(esgst.sg ? `.comment` : `.comment_outer`)
    };
    if (MR.Comment) {
        Parent = MR.Comment.closest(esgst.sg ? `.comment` : `.comment_outer`);
        MR.Container = MR.Comment.getElementsByClassName(esgst.sg ? `comment__summary` : `comment_inner`)[0];
        MR.Timestamp = MR.Context.firstElementChild;
        ReplyButton = MR.Context.getElementsByClassName(esgst.sg ? `js__comment-reply` : `js_comment_reply`)[0];
        Permalink = MR.Context.querySelectorAll(`[href*="/go/comment/"]`);
        Permalink = Permalink[Permalink.length - 1];
        if (ReplyButton || location.pathname.match(/^\/messages/)) {
            if (ReplyButton) {
                ReplyButton.remove();
                MR.ParentID = Parent.getAttribute(esgst.sg ? `data-comment-id` : `data-id`);
                if (location.pathname.match(/^\/messages/)) {
                    MR.URL = Permalink.getAttribute(`href`);
                }
                MR.url = Permalink.getAttribute(`href`);
            } else {
                MR.url = MR.URL = Permalink.getAttribute(`href`);
                MR.Comment.insertAdjacentHTML(`beforeEnd`, `<div class="comment__children comment_children"></div>`);
            }
            if (esgst.sg) {
                MR.TradeCode = ``;
            } else {
                if (!location.pathname.match(/^\/messages/)) {
                    MR.TradeCode = location.pathname.match(/^\/trade\/(.+?)\//)[1];
                }
                MR.Username = MR.Comment.getElementsByClassName(`author_name`)[0].textContent;
            }
            MR.Timestamp.insertAdjacentHTML(`afterEnd`, `<a class="comment__actions__button esgst-mr-reply">Reply</a>`);
            MR.Timestamp.nextElementSibling.addEventListener(`click`, function () {
                if (!MR.Box) {
                    addMRBox(MR);
                } else {
                    MR.Description.focus();
                }
            });
        }
        MR.Children = MR.Comment.getElementsByClassName(esgst.sg ? `comment__children` : `comment_children`)[0];
        setMREdit(MR);
        setMrDelete(MR);
        setMrUndelete(MR);
    }
}

function addMRBox(MR) {
    var Username;
    Username = esgst.username;
    MR.Children.insertAdjacentHTML(`afterBegin`, `
        <div class="comment reply_form MRBox">
        ${esgst.sg ? `
            <div class="comment__child">
                <a href="/user/${Username}" class="global__image-outer-wrap global__image-outer-wrap--avatar-small">
                    <div class="global__image-inner-wrap" style="background-image: url(${esgst.avatar});"></div>
                </a>
                <div class="comment__summary">
                    <div class="comment__author">
                        <div class="comment__username">
                            <a href="/user/${Username}">${Username}</a>
                        </div>
                    </div>
                    <div class="comment__display-state">
                        <div class="comment__description">
        ` : ``}
                            <input name="trade_code" type="hidden" value="${MR.TradeCode}">
                            <input name="parent_id" type="hidden" value="${MR.ParentID}">
                            <textarea class="esgst-mr-description" name="description"${esgst.sg ? `` : ` placeholder="Write a reply to ${MR.Username}..."`}></textarea>
                            <div class="align-button-container btn_actions">
                                <div></div>
                                <div class="comment__cancel-button btn_cancel esgst-mr-cancel">
                                    <span>Cancel</span>
                                </div>
                            </div>
        ${esgst.sg ? `
                        </div>
                    </div>
                </div>
            </div>
        ` : ``}
        </div>
    `);
    MR.Box = MR.Children.firstElementChild;
    MR.Description = MR.Box.getElementsByClassName(`esgst-mr-description`)[0];
    MR.Cancel = MR.Box.getElementsByClassName(`esgst-mr-cancel`)[0];
    if (esgst.cfh) {
        addCFHPanel(MR.Description);
    }
    MR.Description.focus();
    addDEDButton(MR.Box, MR.URL, function (id, Response, DEDStatus) {
        var encryptedCode, codes, ReplyID, Reply, ResponseJSON;
        if (esgst.sg) {
            if (id) {
                Reply = DOM.parse(Response.responseText).getElementById(id).closest(`.comment`);
                codes = [];
                var elements = Reply.querySelectorAll(`[href^="ESGST-"]`);
                for (var i = 0, n = elements.length; i < n; ++i) {
                    var element = elements[i];
                    encryptedCode = element.getAttribute(`href`).match(/ESGST-(.+)/)[1];
                    if (!encryptedCode.match(/currentVersion/)) {
                        codes.push(decryptGedCode(encryptedCode));
                    }
                }
                saveGedGiveaways(codes, id, function () {
                    if (esgst.rfi && esgst.rfi_s) {
                        saveRfiReply(id, Reply.outerHTML, MR.url);
                    }
                    addRMLLink(MR.Container, [Reply]);
                    loadEndlessFeatures(Reply);
                    MR.Box.remove();
                    MR.Children.appendChild(Reply);
                    location.hash = id;
                });
            } else {
                DEDStatus.innerHTML = `
                    <i class="fa fa-times"></i>
                    <span>Failed!</span>
                `;
            }
        } else {
            if (id) {
                Reply = DOM.parse(JSON.parse(Response.responseText).html).getElementById(id);
                codes = [];
                var elements = Reply.querySelectorAll(`[href^="ESGST-"]`);
                for (var i = 0, n = elements.length; i < n; ++i) {
                    var element = elements[i];
                    encryptedCode = element.getAttribute(`href`).match(/ESGST-(.+)/)[1];
                    if (!encryptedCode.match(/currentVersion/)) {
                        codes.push(decryptGedCode(encryptedCode));
                    }
                }
                saveGedGiveaways(codes, id, function () {
                    if (esgst.rfi && esgst.rfi_s) {
                        saveRfiReply(id, Reply.outerHTML, MR.url);
                    }
                    addRMLLink(MR.Container, [Reply]);
                    loadEndlessFeatures(Reply);
                    MR.Box.remove();
                    MR.Children.appendChild(Reply);
                    location.hash = id;
                });
            } else {
                DEDStatus.innerHTML = `
                    <i class="fa fa-times"></i>
                    <span>Failed!</span>
                `;
            }
        }
    });
    MR.Cancel.addEventListener(`click`, function () {
        MR.Box.remove();
        MR.Box = null;
    });
}

function saveRfiReply(id, reply, url, edit) {
    var i, n, source, saved;
    if (url) {
        source = url.match(/\/comment\/(.+)/)[1];
    }
    saved = JSON.parse(getValue(`${esgst.name}RfiCache`, `{}`));
    if (edit) {
        for (key in saved) {
            for (i = 0, n = saved[key].length; i < n && saved[key][i].id !== id; ++i);
            if (i < n) {
                saved[key][i].reply = reply;
                saved[key][i].timestamp = Date.now();
            }
        }
    } else {
        if (!saved[source]) {
            saved[source] = [];
        }
        saved[source].push({
            id: id,
            reply: reply,
            timestamp: Date.now()
        });
    }
    setValue(`${esgst.name}RfiCache`, JSON.stringify(saved));
}

function getRfiReplies(comments, main) {
    var children, comment, i, id, ids, j, key, n, numReplies, saved, toDelte;
    ids = [];
    saved = JSON.parse(getValue(`${esgst.name}RfiCache`, `{}`));
    for (i = 0, n = comments.length; i < n; ++i) {
        comment = comments[i];
        id = comment.id;
        if (id && saved[id]) {
            children = comment.comment.closest(`.comment, .comment_outer`).querySelector(`.comment__children, .comment_children`);
            for (j = 0, numReplies = saved[id].length; j < numReplies; ++j) {
                children.insertAdjacentHTML(`beforeEnd`, saved[id][j].reply);
            }
            if (main) {
                loadEndlessFeatures(children);
            }
        }
    }
    for (key in saved) {
        for (i = 0, n = saved[key].length; i < n; ++i) {
            if (Date.now() - saved[key][i].timestamp > 604800000) {
                saved[key].splice(i, 1);
                i -= 1;
                n -= 1;
            }
        }
        if (!saved[key].length) {
            delete saved[key];
        }
    }
    setValue(`${esgst.name}RfiCache`, JSON.stringify(saved));
}

function setMREdit(MR) {
    var DisplayState, EditState, EditSave, ID, AllowReplies, Description;
    MR.Edit = MR.Context.getElementsByClassName(esgst.sg ? `js__comment-edit` : `js_comment_edit`)[0];
    if (MR.Edit) {
        MR.Edit.insertAdjacentHTML(`afterEnd`, `<a class="comment__actions__button esgst-mr-edit">Edit</a>`);
        MR.Edit = MR.Edit.nextElementSibling;
        MR.Edit.previousElementSibling.remove();
        DisplayState = MR.Comment.getElementsByClassName(esgst.sg ? `comment__display-state` : `comment_body_default`)[0];
        EditState = MR.Comment.getElementsByClassName(esgst.sg ? `comment__edit-state` : `edit_form`)[0];
        EditSave = EditState.querySelector(`.js__comment-edit-save, .js_submit, .EditSave`);
        EditSave.insertAdjacentHTML(`afterEnd`, `
            <a class="comment__submit-button btn_action white EditSave">
                <i class="fa fa-edit"></i>
                <span>Edit</span>
            </a>
        `);
        EditSave = EditSave.nextElementSibling;
        EditSave.previousElementSibling.remove();
        ID = EditState.querySelector(`[name="comment_id"]`).value;
        AllowReplies = esgst.sg ? EditState.querySelector(`[name="allow_replies"]`).value : ``;
        Description = EditState.querySelector(`[name="description"]`);
        MR.Edit.addEventListener(`click`, function () {
            var Temp;
            if (esgst.sg) {
                DisplayState.classList.add(`is-hidden`);
                MR.Context.classList.add(`is-hidden`);
            } else {
                MR.Container.classList.add(`is_hidden`);
            }
            EditState.classList.remove(esgst.sg ? `is-hidden` : `is_hidden`);
            Temp = Description.value;
            Description.focus();
            Description.value = ``;
            Description.value = Temp;
        });
        EditSave.addEventListener(`click`, function () {
            request(`xsrf_token=${esgst.xsrfToken}&do=comment_edit&comment_id=${ID}&allow_replies=${AllowReplies}&description=${encodeURIComponent(Description.value)}`, null, false,
                `/ajax.php`, function (Response) {
                    var codes, encryptedCode, ResponseJSON, ResponseHTML;
                    ResponseJSON = JSON.parse(Response.responseText);
                    if (ResponseJSON.type === `success` || ResponseJSON.success) {
                        ResponseHTML = DOM.parse(ResponseJSON[esgst.sg ? `comment` : `html`]);
                        codes = [];
                        var elements = ResponseHTML.querySelectorAll(`[href^="ESGST-"]`);
                        for (var i = 0, n = elements.length; i < n; ++i) {
                            var element = elements[i];
                            encryptedCode = element.getAttribute(`href`).match(/ESGST-(.+)/)[1];
                            if (!encryptedCode.match(/currentVersion/)) {
                                codes.push(decryptGedCode(encryptedCode));
                            }
                        }
                        saveGedGiveaways(codes, MR.url.match(/\/comment\/(.+)/)[1], function () {
                            if (esgst.rfi && esgst.rfi_s) {
                                var reply = MR.Comment.cloneNode(true);
                                if (esgst.sg) {
                                    reply.innerHTML = `
                                        <div class="ajax comment__child">${ResponseHTML.body.innerHTML}</div>
                                        <div class="comment__children"></div>
                                    `;
                                } else {
                                    reply.innerHTML = `
                                        ${ResponseHTML.body.innerHTML}
                                        <div class="comment_children"></div>
                                    `;
                                }
                                saveRfiReply(MR.url.match(/\/comment\/(.+)/)[1], reply.outerHTML, null, true);
                            }
                            DisplayState.innerHTML = ResponseHTML.getElementsByClassName(esgst.sg ? `comment__display-state` : `comment_body_default`)[0].innerHTML;
                            EditState.classList.add(esgst.sg ? `is-hidden` : `is_hidden`);
                            MR.Timestamp.innerHTML = ResponseHTML.getElementsByClassName(esgst.sg ? `comment__actions` : `action_list`)[0].firstElementChild.innerHTML;
                            if (esgst.at) {
                                getTimestamps(MR.Timestamp);
                            }
                            if (esgst.ged) {
                                esgst.checkGedGiveaways(MR.Container);
                            }
                            if (esgst.sg) {
                                DisplayState.classList.remove(`is-hidden`);
                                MR.Context.classList.remove(`is-hidden`);
                            } else {
                                MR.Container.classList.remove(`is_hidden`);
                            }
                        });
                    }
                });
        });
    }
}

function setMrDelete(mr) {
    var allowReplies, data, id;
    mr.delete = mr.Context.getElementsByClassName(esgst.sg ? `js__comment-delete` : `js_comment_delete`)[0];
    if (mr.delete) {
        if (esgst.sg) {
            allowReplies = mr.delete.parentElement.querySelector(`[name="allow_replies"]`).value;
            id = mr.delete.parentElement.querySelector(`[name="comment_id"]`).value;
            data = `xsrf_token=${esgst.xsrfToken}&do=comment_delete&allow_replies=${allowReplies}&comment_id=${id}`;
        } else {
            data = mr.delete.getAttribute(`data-form`);
        }
        mr.delete.insertAdjacentHTML(`afterEnd`, `<a class="comment__actions__button esgst-mr-delete">Delete</a>`);
        mr.delete = mr.delete.nextElementSibling;
        mr.delete.previousElementSibling.remove();
        mr.delete.addEventListener(`click`, request.bind(null, data, null, false, `/ajax.php`, editMrReply.bind(null, mr)));
    }
}

function setMrUndelete(mr) {
    var allowReplies, data, id;
    mr.undelete = mr.Context.getElementsByClassName(esgst.sg ? `js__comment-undelete` : `js_comment_undelete`)[0];
    if (mr.undelete) {
        if (esgst.sg) {
            allowReplies = mr.undelete.parentElement.querySelector(`[name="allow_replies"]`).value;
            id = mr.undelete.parentElement.querySelector(`[name="comment_id"]`).value;
            data = `xsrf_token=${esgst.xsrfToken}&do=comment_undelete&allow_replies=${allowReplies}&comment_id=${id}`;
        } else {
            data = mr.undelete.getAttribute(`data-form`);
        }
        mr.undelete.insertAdjacentHTML(`afterEnd`, `<a class="comment__actions__button esgst-mr-undelete">Undelete</a>`);
        mr.undelete = mr.undelete.nextElementSibling;
        mr.undelete.previousElementSibling.remove();
        mr.undelete.addEventListener(`click`, request.bind(null, data, null, false, `/ajax.php`, editMrReply.bind(null, mr)));
    }
}

function editMrReply(mr, response) {
    var responseHtml, responseJson;
    responseJson = JSON.parse(response.responseText);
    if (responseJson.type === `success` || responseJson.success) {
        responseHtml = DOM.parse(responseJson[esgst.sg ? `comment` : `html`]);
        if (esgst.sg) {
            mr.Container.innerHTML = responseHtml.getElementsByClassName(`comment__summary`)[0].innerHTML;
        } else {
            mr.Container.innerHTML = responseHtml.getElementsByClassName(`comment_inner`)[0].innerHTML;
        }
        if (esgst.rfi && esgst.rfi_s) {
            var reply = mr.Comment.cloneNode(true);
            if (esgst.sg) {
                reply.innerHTML = `
                    <div class="ajax comment__child">${responseHtml.body.innerHTML}</div>
                    <div class="comment__children"></div>
                `;
            } else {
                reply.innerHTML = `
                    ${responseHtml.body.innerHTML}
                    <div class="comment_children"></div>
                `;
            }
            saveRfiReply(mr.url.match(/\/comment\/(.+)/)[1], reply.outerHTML, null, true);
        }
        loadEndlessFeatures(mr.Container);
    }
}

/* [CT] Comment Tracker */

function loadCt() {
    if ((esgst.giveawaysPath || esgst.commentsPath || esgst.inboxPath || esgst.discussionsPath) && !document.getElementsByClassName(`table--summary`)[0]) {
        if (esgst.commentsPath || esgst.inboxPath) {
        } else {
            esgst.endlessFeatures.push(addCtDiscussionPanels);
            addCtDiscussionPanels(document);
        }
    }
}

function getCtComments(count, comments, index, goToUnread, markRead, markUnread, callback) {
    if (goToUnread) {
        checkCtComments(count, comments, index, true, false, false, callback);
    } else {
        createLock(`commentLock`, 300, function(deleteLock) {
            checkCtComments(count, comments, index, false, markRead, markUnread, callback);
            deleteLock();
        });
    }
}

function checkCtComments(count, comments, index, goToUnread, markRead, markUnread, callback) {
    var button, code, comment, found, i, n, saved, source, type, unread;
    if (esgst.sg) {
        saved = {
            giveaways: JSON.parse(getValue(`giveaways`)),
            discussions: JSON.parse(getValue(`discussions`)),
            tickets: JSON.parse(getValue(`tickets`))
        };
    } else {
        saved = {
            trades: JSON.parse(getValue(`trades`))
        };
    }
    n = comments.length;
    if (n > 0) {
        found = false;
        for (i = index || 0; i < n; ++i) {
            comment = comments[i];
            if (comment.id || comment.id.match(/^$/)) {
                if (!saved[comment.type][comment.code]) {
                    saved[comment.type][comment.code] = {
                        readComments: {}
                    };
                } else if (!saved[comment.type][comment.code].readComments) {
                    saved[comment.type][comment.code].readComments = {};
                }
                if (count > 0) {
                    saved[comment.type][comment.code].count = count;
                }
                if (esgst.gdttt && esgst.gdttt_v) {
                    saved[comment.type][comment.code].visited = true;
                }
                if (!esgst.ct_s) {
                    buttons = comment.comment.getElementsByClassName(`esgst-ct-comment-button`);
                    if (comment.author === esgst.username) {
                        markCtCommentRead(comment, saved);
                    } else if (!saved[comment.type][comment.code].readComments[comment.id] || comment.timestamp !== saved[comment.type][comment.code].readComments[comment.id]) {
                        if (goToUnread) {
                            if ((esgst.discussionPath && ((esgst.ct_r && esgst.es_r) || (!esgst.ct_r && !esgst.es_r))) || (!esgst.discussionPath && !esgst.ct_r)) {
                                unread = comment;
                                found = true;
                            } else {
                                if (esgst.discussionsPath) {
                                    esgst.ctUnreadFound = true;
                                    if (esgst.sto) {
                                        if (comment.id) {
                                            location.href = `/go/comment/${comment.id}`;
                                        } else {
                                            location.href = `/discussion/${comment.code}/`;
                                        }
                                    } else {
                                        if (comment.id) {
                                            open(`/go/comment/${comment.id}`);
                                        } else {
                                            open(`/discussion/${comment.code}/`);
                                        }
                                    }
                                } else {
                                    goToComment(comment.id, comment.comment);
                                }
                                found = true;
                                break;
                            }
                        } else {
                            if (markRead) {
                                markCtCommentRead(comment, saved);
                                addCtUnreadCommentButton(buttons[0], comment);
                            } else {
                                markCtCommentUnread(comment, saved);
                                addCtReadCommentButton(buttons[0], comment);
                            }
                            addCtReadUntilHereButton(buttons[1], comment);
                            addCtUnreadUntilHereButton(buttons[2], comment);
                        }
                    } else {
                        if (markUnread) {
                            markCtCommentUnread(comment, saved);
                            addCtReadCommentButton(buttons[0], comment);
                        } else {
                            markCtCommentRead(comment, saved);
                            addCtUnreadCommentButton(buttons[0], comment);
                        }
                        addCtReadUntilHereButton(buttons[1], comment);
                        addCtUnreadUntilHereButton(buttons[2], comment);
                    }
                }
            }
        }
        if (!esgst.ct_s && goToUnread) {
            if (unread) {
                if (esgst.discussionsPath) {
                    esgst.ctUnreadFound = true;
                    if (esgst.sto) {
                        if (unread.id) {
                            location.href = `/go/comment/${unread.id}`;
                        } else {
                            location.href = `/discussion/${unread.code}/`;
                        }
                    } else {
                        if (unread.id) {
                            open(`/go/comment/${unread.id}`);
                        } else {
                            open(`/discussion/${unread.code}/`);
                        }
                    }
                } else {
                    goToComment(unread.id, unread.comment);
                }
            }
        } else {
            if (esgst.sg) {
                setValue(`giveaways`, JSON.stringify(saved.giveaways));
                setValue(`discussions`, JSON.stringify(saved.discussions));
                setValue(`tickets`, JSON.stringify(saved.tickets));
            } else {
                setValue(`trades`, JSON.stringify(saved.trades));
            }
        }
        if (callback) {
            callback(found);
        }
    } else {
        source = location.pathname.match(/(giveaway|discussion|trade|ticket)\/(.+?)(\/.*)?$/);
        if (source) {
            type = `${source[1]}s`;
            code = source[2];
            if (!saved[type][code]) {
                saved[type][code] = {
                    readComments: {},
                    visited: true
                };
            }
            if (count > 0) {
                saved[type][code].count = count;
            }
            if (esgst.sg) {
                setValue(`giveaways`, JSON.stringify(saved.giveaways));
                setValue(`discussions`, JSON.stringify(saved.discussions));
                setValue(`tickets`, JSON.stringify(saved.tickets));
            } else {
                setValue(`trades`, JSON.stringify(saved.trades));
            }
        }
        if (callback) {
            callback();
        }
    }
}

function markCtCommentRead(comment, comments, save, callback) {
    var count;
    if (save) {
        createLock(`commentLock`, 300, function(deleteLock) {
            comments = JSON.parse(getValue(comment.type));
            if (comment.id && !comments[comment.code].readComments[comment.id] && esgst.commentsPath) {
                count = document.getElementsByClassName(`esgst-ct-count`)[0];
                count.textContent = ` (+${parseInt(count.textContent.match(/\d+/)[0]) - 1})`;
            }
            comments[comment.code].readComments[comment.id] = comment.timestamp;
            setValue(comment.type, JSON.stringify(comments));
            deleteLock();
            comment.comment.classList.add(`esgst-ct-comment-read`);
            comment.comment.style.opacity = `0.5`;
            setHoverOpacity(comment.comment, `1`, `0.5`);
            callback();
        });
    } else {
        if (comments) {
            if (comment.id && !comments[comment.type][comment.code].readComments[comment.id] && esgst.commentsPath) {
                count = document.getElementsByClassName(`esgst-ct-count`)[0];
                count.textContent = ` (+${parseInt(count.textContent.match(/\d+/)[0]) - 1})`;
            }
            comments[comment.type][comment.code].readComments[comment.id] = comment.timestamp;
        }
        comment.comment.classList.add(`esgst-ct-comment-read`);
        comment.comment.style.opacity = `0.5`;
        setHoverOpacity(comment.comment, `1`, `0.5`);
    }
}

function markCtCommentUnread(comment, comments, save, callback) {
    var count;
    if (save) {
        createLock(`commentLock`, 300, function(deleteLock) {
            var comments;
            comments = JSON.parse(getValue(comment.type));
            if (comments[comment.code].readComments[comment.id]) {
                delete comments[comment.code].readComments[comment.id];
                setValue(comment.type, JSON.stringify(comments));
                deleteLock();
                if (comment.id && esgst.commentsPath) {
                    count = document.getElementsByClassName(`esgst-ct-count`)[0];
                    count.textContent = ` (+${parseInt(count.textContent.match(/\d+/)[0]) + 1})`;
                }
            }
            comment.comment.classList.remove(`esgst-ct-comment-read`);
            comment.comment.style.opacity = `1`;
            setHoverOpacity(comment.comment, `1`, `1`);
            callback();
        });
    } else {
        if (comments && comments[comment.type][comment.code].readComments[comment.id]) {
            if (comment.id && esgst.commentsPath) {
                count = document.getElementsByClassName(`esgst-ct-count`)[0];
                count.textContent = ` (+${parseInt(count.textContent.match(/\d+/)[0]) + 1})`;
            }
            delete comments[comment.type][comment.code].readComments[comment.id];
        }
        comment.comment.classList.remove(`esgst-ct-comment-read`);
        comment.comment.style.opacity = `1`;
        setHoverOpacity(comment.comment, `1`, `1`);
    }
}

function addCtReadUntilHereButton(button, comment) {
    if (!button) {
        button = insertHtml(comment.actions, `beforeEnd`, `<div class="esgst-ct-comment-button" title="Mark all comments from this comment upwards as read"></div>`);
    }
    button.innerHTML = `
        <span>
            <i class="fa fa-eye"></i>
            <i class="fa fa-angle-up"></i>
        </span>
    `;
    button.firstElementChild.addEventListener(`click`, function () {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        getCtComments(0, esgst.currentComments, comment.index, false, true, false, function () {
            addCtReadUntilHereButton(button, comment);
        });
    });
}

function addCtUnreadUntilHereButton(button, comment) {
    if (!button) {
        button = insertHtml(comment.actions, `beforeEnd`, `<div class="esgst-ct-comment-button" title="Mark all comments from this comment upwards as unread"></div>`);
    }
    button.innerHTML = `
        <span>
            <i class="fa fa-eye-slash"></i>
            <i class="fa fa-angle-up"></i>
        </span>
    `;
    button.firstElementChild.addEventListener(`click`, function () {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        getCtComments(0, esgst.currentComments, comment.index, false, false, true, function () {
            addCtReadUntilHereButton(button, comment);
        });
    });
}

function addCtReadCommentButton(button, comment) {
    if (!button) {
        button = insertHtml(comment.actions, `beforeEnd`, `<div class="esgst-ct-comment-button"></div>`);
    }
    button.innerHTML = `
        <i class="fa fa-eye" title="Mark this comment as read"></i>
        <span title="Mark this comment as read and go to the next unread comment">
            <i class="fa fa-eye"></i>
            <i class="fa fa-angle-double-right"></i>
        </span>
    `;
    button.firstElementChild.addEventListener(`click`, function () {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        markCtCommentRead(comment, null, true, function () {
            button.innerHTML = ``;
            addCtUnreadCommentButton(button, comment);
        });
    });
    button.lastElementChild.addEventListener(`click`, function () {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        markCtCommentRead(comment, null, true, function () {
            button.innerHTML = ``;
            addCtUnreadCommentButton(button, comment);
            getCtComments(0, esgst.currentComments, null, true);
        });
    });
}

function addCtUnreadCommentButton(button, comment) {
    if (!button) {
        button = insertHtml(comment.actions, `beforeEnd`, `<div class="esgst-ct-comment-button"></div>`);
    }
    button.innerHTML = `<i class="fa fa-eye-slash" title="Mark comment as unread">`;
    button.firstElementChild.addEventListener(`click`, function() {
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        markCtCommentUnread(comment, null, true, function() {
            button.innerHTML = ``;
            addCtReadCommentButton(button, comment);
        });
    });
}

function addCtCommentPanel(goToUnread, markRead, markUnread) {
    var button, key, newButton, url;
    goToUnread.addEventListener(`click`, goToCtUnread.bind(null, goToUnread));
    markRead.addEventListener(`click`, markCtCommentsRead.bind(null, markRead, null));
    markUnread.addEventListener(`click`, markCtCommentsUnread.bind(null, markUnread));
    if (esgst.ct_a && esgst.inboxPath) {
        button = document.querySelector(`.js__submit-form, .js_mark_as_read`);
        if (button) {
            if (esgst.sg) {
                newButton = insertHtml(button, `afterEnd`, `
                    <div class="sidebar__action-button">
                        <i class="fa fa-check-circle"></i> Mark as Read
                    </div>
                `);
                key = `read_messages`;
                url = `/messages`;
            } else {
                newButton = insertHtml(button, `afterEnd`, `
                    <a class="page_heading_btn green">
                        <i class="fa fa-check-square-o"></i>
                        <span>Mark as Read</span>
                    </a>
                `);
                key = `mark_as_read`;
                url = `/ajax.php`;
            }
            button.remove();
            newButton.addEventListener(`click`, request.bind(null, `xsrf_token=${esgst.xsrfToken}&do=${key}`, null, false, url, markCtCommentsRead.bind(null, markRead, completeCtInboxRead.bind(null, newButton))));
        }
    }
}

function completeCtInboxRead(newButton) {
    var elements, i, n;
    elements = document.querySelectorAll(`.comment__envelope, .comment_unread`);
    for (i = 0, n = elements.length; i < n; ++i) {
        elements[i].remove();
    }
    newButton.remove();
}

function goToCtUnread(goToUnread) {
    goToUnread.innerHTML = `
        <i class="fa fa-circle-o-notch fa-spin"></i>
    `;
    getCtComments(0, esgst.currentComments, null, true, false, false, function (found) {
        goToUnread.innerHTML = `
            <i class="fa fa-comments-o"></i>
        `;
        if (!found) {
            createAlert(`No unread comments were found.`);
        }
    });
}

function markCtCommentsRead(markRead, callback) {
    markRead.innerHTML = `
        <i class="fa fa-circle-o-notch fa-spin"></i>
    `;
    getCtComments(0, esgst.currentComments, null, false, true, false, function () {
        markRead.innerHTML = `
            <i class="fa fa-eye"></i>
        `;
        if (callback) {
            callback();
        }
    });
}

function markCtCommentsUnread(markUnread) {
    markUnread.innerHTML = `
        <i class="fa fa-circle-o-notch fa-spin"></i>
    `;
    getCtComments(0, esgst.currentComments, null, false, false, true, function () {
        markUnread.innerHTML = `
            <i class="fa fa-eye-slash"></i>
        `;
    });
}

function addCtDiscussionPanels(context, main, source, endless, dh) {
    var code, comments, count, countLink, diff, i, id, j, match, matches, n, read, url, key;
    if (esgst.discussionsPath || dh) {
        key = `discussions`;
    } else if (esgst.ticketsPath) {
        key = `tickets`;
    } else if (esgst.tradesPath) {
        key = `trades`;
    } else {
        key = `discussions`;
    }
    comments = JSON.parse(getValue(key, `{}`));
    matches = context.querySelectorAll(`.table__row-outer-wrap, .row_outer_wrap`);
    for (i = 0, n = matches.length; i < n; ++i) {
        match = matches[i];
        countLink = match.querySelector(`.table__column__secondary-link[href*="/discussion/"], .table__column--width-small.text-center, .column_small.text_center`);
        if (countLink) {
            count = parseInt(countLink.textContent.replace(/,/g, ``));
            url = match.querySelector(`.homepage_table_column_heading, .table__column__heading, .column_flex h3 a`).getAttribute(`href`);
            if (url) {
                code = url.match(new RegExp(`/${key.slice(0, -1)}/(.+?)(/.*)?$`));
                if (code) {
                    code = code[1];
                    if (comments[code]) {
                        if (esgst.ct_s) {
                            read = comments[code].count || (esgst.ct_s_h ? count : 0);
                        } else {
                            read = 0;
                            for (id in comments[code].readComments) {
                                if (!id.match(/^(Count|undefined|)$/) && comments[code].readComments[id]) {
                                    ++read;
                                }
                            }
                        }
                        diff = count === read ? 0 : count - read;
                    } else if (esgst.ct_s && esgst.ct_s_h) {
                        diff = 0;
                    } else {
                        diff = count;
                    }
                    if (key === `discussions` && diff > 0) {
                        for (j = esgst.currentDiscussions.length - 1; j > -1 && esgst.currentDiscussions[j].code !== code; --j);
                        if (j > -1) {
                            esgst.currentDiscussions[j].unread = true;
                        }
                    }
                    addCtDiscussionPanel(code, comments, match, countLink, count, diff, url, key, dh);
                }
            }
        }
    }
    if (esgst.df && esgst.df.filteredCount && esgst[`df_enable`]) {
        filterDfDiscussions(esgst.df, false, endless);
    }
}

function addCtDiscussionPanel(code, comments, container, context, count, diff, url, type, dh) {
    var diffContainer, goToUnread, loadingIcon, markRead, markUnread, markVisited, markUnvisited, panel;
    panel = insertHtml(context, esgst.giveawaysPath && !esgst.oadd ? `afterEnd` : `beforeEnd`, `
        <span>
            <span class="esgst-ct-count esgst-hidden">(+${diff})</span>
            <div class="esgst-heading-button esgst-hidden" title="Go to first unread comment of this discussion">
                <i class="fa fa-comments-o"></i>
            </div>
            <div class="esgst-heading-button esgst-hidden" title="Mark all comments in this discussion as read">
                <i class="fa fa-eye"></i>
            </div>
            <div class="esgst-heading-button esgst-hidden" title="Mark all comments in this discussion as unread">
                <i class="fa fa-eye-slash"></i>
            </div>
            <div class="esgst-heading-button esgst-hidden" title="Mark this discussion as visited">
                <i class="fa fa-check"></i>
            </div>
            <div class="esgst-heading-button esgst-hidden" title="Mark this discussion as unvisited">
                <i class="fa fa-times"></i>
            </div>
            <i class="fa fa-circle-o-notch fa-spin esgst-hidden"></i>
        </span>
    `);
    diffContainer = panel.firstElementChild;
    goToUnread = diffContainer.nextElementSibling;
    markRead = goToUnread.nextElementSibling;
    markUnread = markRead.nextElementSibling;
    markVisited = markUnread.nextElementSibling;
    markUnvisited = markVisited.nextElementSibling;
    loadingIcon = markUnvisited.nextElementSibling;
    if (esgst.ct && (esgst.giveawaysPath || esgst.discussionsPath || dh)) {
        if (esgst.ct_s) {
            if (diff > 0) {
                diffContainer.classList.remove(`esgst-hidden`);
            }
        } else {
            if (diff > 0) {
                diffContainer.classList.remove(`esgst-hidden`);
                goToUnread.classList.remove(`esgst-hidden`);
                markRead.classList.remove(`esgst-hidden`);
                if (diff !== count) {
                    markUnread.classList.remove(`esgst-hidden`);
                }
            } else {
                markUnread.classList.remove(`esgst-hidden`);
            }
        }
    }
    if (esgst.gdttt) {
        if (!comments[code] || !comments[code].visited) {
            markVisited.classList.remove(`esgst-hidden`);
        } else {
            markUnvisited.classList.remove(`esgst-hidden`);
        }
    }
    goToUnread.addEventListener(`click`, function() {
        goToUnread.classList.add(`esgst-hidden`);
        markRead.classList.add(`esgst-hidden`);
        markUnread.classList.add(`esgst-hidden`);
        loadingIcon.classList.remove(`esgst-hidden`);
        esgst.ctUnreadFound = false;
        markCtCommentsReadUnread(true, true, false, false, false, 1, `${url}/search?page=`, function() {
            loadingIcon.classList.add(`esgst-hidden`);
            diffContainer.classList.add(`esgst-hidden`);
            goToUnread.classList.remove(`esgst-hidden`);
            markRead.classList.remove(`esgst-hidden`);
            markUnread.classList.remove(`esgst-hidden`);
        });
    });
    markRead.addEventListener(`click`, function() {
        goToUnread.classList.add(`esgst-hidden`);
        markRead.classList.add(`esgst-hidden`);
        markUnread.classList.add(`esgst-hidden`);
        loadingIcon.classList.remove(`esgst-hidden`);
        markCtCommentsReadUnread(true, false, false, true, false, 1, `${url}/search?page=`, function() {
            loadingIcon.classList.add(`esgst-hidden`);
            diffContainer.classList.add(`esgst-hidden`);
            markUnread.classList.remove(`esgst-hidden`);
        });
    });
    markUnread.addEventListener(`click`, function() {
        goToUnread.classList.add(`esgst-hidden`);
        markRead.classList.add(`esgst-hidden`);
        markUnread.classList.add(`esgst-hidden`);
        loadingIcon.classList.remove(`esgst-hidden`);
        createLock(`commentLock`, 300, function(deleteLock) {
            var key;
            comments = JSON.parse(getValue(`discussions`));
            for (key in comments[code].readComments) {
                delete comments[code].readComments[key];
            }
            setValue(`discussions`, JSON.stringify(comments));
            deleteLock();
            loadingIcon.classList.add(`esgst-hidden`);
            diffContainer.classList.remove(`esgst-hidden`);
            diffContainer.textContent = `(+${count})`;
            goToUnread.classList.remove(`esgst-hidden`);
            markRead.classList.remove(`esgst-hidden`);
        });
    });
    markVisited.addEventListener(`click`, function() {
        goToUnread.classList.add(`esgst-hidden`);
        markRead.classList.add(`esgst-hidden`);
        markUnread.classList.add(`esgst-hidden`);
        markVisited.classList.add(`esgst-hidden`);
        loadingIcon.classList.remove(`esgst-hidden`);
        createLock(`commentLock`, 300, function(deleteLock) {
            comments = JSON.parse(getValue(type));
            if (!comments[code]) {
                comments[code] = {
                    readComments: {}
                };
            }
            if (esgst.ct_s) {
                comments[code].count = count;
                diffContainer.textContent = ``;
            }
            comments[code].visited = true;
            setValue(type, JSON.stringify(comments));
            deleteLock();
            loadingIcon.classList.add(`esgst-hidden`);
            if (esgst.ct && !esgst.ct_s && (esgst.giveawaysPath || esgst.discussionsPath || dh)) {
                goToUnread.classList.remove(`esgst-hidden`);
                markRead.classList.remove(`esgst-hidden`);
                markUnread.classList.remove(`esgst-hidden`);
            }
            markUnvisited.classList.remove(`esgst-hidden`);
            container.classList.add(`esgst-ct-visited`);
            container.style.opacity = `0.5`;
            setHoverOpacity(container, `1`, `0.5`);
        });
    });
    markUnvisited.addEventListener(`click`, function() {
        goToUnread.classList.add(`esgst-hidden`);
        markRead.classList.add(`esgst-hidden`);
        markUnread.classList.add(`esgst-hidden`);
        markUnvisited.classList.add(`esgst-hidden`);
        loadingIcon.classList.remove(`esgst-hidden`);
        createLock(`commentLock`, 300, function(deleteLock) {
            comments = JSON.parse(getValue(type));
            if (esgst.ct_s) {
                delete comments[code].count;
                diffContainer.textContent = `(+${count})`;
            }
            delete comments[code].visited;
            setValue(type, JSON.stringify(comments));
            deleteLock();
            loadingIcon.classList.add(`esgst-hidden`);
            if (esgst.ct && !esgst.ct_s && (esgst.giveawaysPath || esgst.discussionsPath || dh)) {
                goToUnread.classList.remove(`esgst-hidden`);
                markRead.classList.remove(`esgst-hidden`);
                markUnread.classList.remove(`esgst-hidden`);
            }
            markVisited.classList.remove(`esgst-hidden`);
            container.classList.remove(`esgst-ct-visited`);
            container.style.opacity = `1`;
            setHoverOpacity(container, `1`, `1`);
        });
    });
}

function markCtCommentsReadUnread(firstRun, goToUnread, lastPageMissing, markRead, markUnread, nextPage, url, callback) {
    request(null, null, true, `${url}${nextPage}`, function(response) {
        var context, lastLink, pagination;
        context = DOM.parse(response.responseText);
        getCtComments(0, getComments(context, context), null, goToUnread, markRead, markUnread);
        if ((goToUnread && !esgst.ctUnreadFound) || !goToUnread) {
            pagination = context.getElementsByClassName(`pagination__navigation`)[0];
            ++nextPage;
            if (pagination && ((goToUnread && ((esgst.ct_r && nextPage > 1) || (!esgst.ct_r && !pagination.lastElementChild.classList.contains(`is-selected`)))) || (!goToUnread && !pagination.lastElementChild.classList.contains(`is-selected`)))) {
                if (goToUnread && esgst.ct_r) {
                    if (firstRun) {
                        lastLink = pagination.lastElementChild;
                        if (lastLink.textContent.match(/Last/)) {
                            nextPage = parseInt(lastLink.getAttribute(`data-page-number`));
                        } else {
                            nextPage = 999999999;
                            lastPageMissing = true;
                        }
                    } else {
                        if (lastPageMissing) {
                            nextPage = parseInt(pagination.lastElementChild.getAttribute(`data-page-number`)) - 1;
                        } else {
                            nextPage -= 2;
                        }
                    }
                    if (nextPage > 1) {
                        setTimeout(markCtCommentsReadUnread, 0, false, goToUnread, lastPageMissing, markRead, markUnread, nextPage, url, callback);
                    } else {
                        callback();
                    }
                } else {
                    setTimeout(markCtCommentsReadUnread, 0, false, goToUnread, lastPageMissing, markRead, markUnread, nextPage, url, callback);
                }
            } else {
                callback();
            }
        } else {
            callback();
        }
    });
}

/* [CH] Comment History */

function saveChComment(id, timestamp) {
    createLock(`${esgst.name}CommentHistoryLock`, 300, function (deleteLock) {
        var comments, key;
        key = `${esgst.name}CommentHistory`;
        comments = JSON.parse(getValue(key, `[]`));
        comments.unshift({
            id: id,
            timestamp: timestamp
        });
        setValue(key, JSON.stringify(comments));
        deleteLock();
    });
}

function getChComments(comments, i, n, popup, callback) {
    var comment, id;
    if (i < n) {
        comment = comments[i];
        if (comment) {
            id = comment.id;
            request(null, null, false, `https://${location.hostname}/go/comment/${id}`, function (response) {
                var html, parent, responseHtml;
                responseHtml = DOM.parse(response.responseText);
                comment = responseHtml.getElementById(id);
                if (esgst.sg) {
                    comment = comment.closest(`.comment`);
                    comment.firstElementChild.classList.remove(`comment__parent`);
                    comment.firstElementChild.classList.add(`comment__child`);
                }
                comment.lastElementChild.remove();
                parent = comment.parentElement.closest(`.comment, .comment_outer`);
                if (parent) {
                    parent.lastElementChild.remove();
                    parent.insertAdjacentHTML(`beforeEnd`, `
                        <div class="comment__children comment_children">${comment.outerHTML}</div>
                    `);
                    html = parent.outerHTML;
                } else {
                    if (esgst.st) {
                        comment.getElementsByClassName(`action_list`)[0].firstElementChild.insertAdjacentHTML(`afterEnd`, `
                            <a href="${response.finalUrl}">${responseHtml.title}</a>
                        `);
                    }
                    html = esgst.sg ? `
                        <div class="comments__entity">
                            <p class="comments__entity__name">
                                <a href="${response.finalUrl}">${responseHtml.title}</a>
                            </p>
                        </div>` : ``;
                    html += `<div class="comment__children comment_children">${comment.outerHTML}</div>`;
                }
                popup.commentHistory.insertAdjacentHTML(`beforeEnd`, `<div class="comment comments comment_outer">${html}</div>`);
                loadEndlessFeatures(popup.commentHistory.lastElementChild);
                popup.reposition();
                setTimeout(getChComments, 0, comments, ++i, n, popup, callback);
            });
        } else {
            callback(i + 1);
        }
    } else {
        callback(i);
    }
}

/* [UH] Username History */

function loadUh() {
    if (esgst.userPath || esgst.ap) {
        esgst.profileFeatures.push(addUhContainer);
    }
}

function addUhContainer(profile) {
    var button, box, container, list;
    container = insertHtml(profile.heading, `beforeEnd`, `
        <div class="esgst-uh-container">
            <a class="esgst-uh-button" title="View username history.">
                <i class="fa fa-caret-down"></i>
            </a>
            <div class="esgst-uh-box esgst-hidden">
                <div class="esgst-uh-title">
                    <span>Username History</span>
                    <a href="https://goo.gl/C2wjUh" target="_blank" title="Expand the database.">
                        <i class="fa fa-expand"></i>
                    </a>
                </div>
                <ul class="esgst-uh-list"></ul>
            </div>
        </div>
    `);
    button = container.firstElementChild;
    box = button.nextElementSibling;
    list = box.lastElementChild;
    button.addEventListener(`click`, toggleUhBox.bind(null, box, profile, list));
    document.addEventListener(`click`, closeUhBox.bind(null, box, container));
}

function toggleUhBox(box, profile, list) {
    var progress, url;
    box.classList.toggle(`esgst-hidden`);
    if (!list.innerHTML) {
        progress = insertHtml(list, `beforeEnd`, `
            <div>
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Loading username history...</span>
            </div>
        `);
        url = `https://script.google.com/macros/s/AKfycbzvOuHG913mRIXOsqHIeAuQUkLYyxTHOZim5n8iP-k80iza6g0/exec?Action=1&SteamID64=${profile.steamId}&Username=${profile.username}`;
        request(null, null, false, url, loadUhList.bind(null, list, progress));
    }
}

function loadUhList(list, progress, response) {
    var responseJson, usernames;
    responseJson = JSON.parse(response.responseText);
    usernames = responseJson.Usernames.join(`</li><li>`);
    progress.remove();
    list.innerHTML = `<li>${usernames}</li>`;
}

function closeUhBox(box, container, event) {
    if (!box.classList.contains(`esgst-hidden`) && !container.contains(event.target)) {
        box.classList.add(`esgst-hidden`);
    }
}

/* [UN] User Notes */

function loadUn() {
    if (esgst.userPath || esgst.ap) {
        esgst.profileFeatures.push(addUnButton);
    }
}

function addUnButton(profile, savedUser) {
    var blacklistButton, position, whitelistButton;
    if (esgst.sg) {
        position = `beforeEnd`;
        if (esgst.un_p) {
            whitelistButton = profile.steamButtonContainer.getElementsByClassName(`sidebar__shortcut__whitelist`)[0];
            if (whitelistButton) {
                whitelistButton.addEventListener(`click`, openUnPopup.bind(null, profile));
            }
            blacklistButton = profile.steamButtonContainer.getElementsByClassName(`sidebar__shortcut__blacklist`)[0];
            if (blacklistButton) {
                blacklistButton.addEventListener(`click`, openUnPopup.bind(null, profile));
            }
        }
    } else {
        position = `afterBegin`;
    }
    profile.unButton = insertHtml(profile.heading, position, `
        <a class="esgst-un-button" title="Edit user notes.">
            <i class="fa"></i>
        </a>
    `);
    profile.unIcon = profile.unButton.firstElementChild;
    if (savedUser && savedUser.notes) {
        profile.unIcon.classList.add(`fa-sticky-note`);
    } else {
        profile.unIcon.classList.add(`fa-sticky-note-o`);
    }
    profile.unButton.addEventListener(`click`, openUnPopup.bind(null, profile));
}

function openUnPopup(profile) {
    var set;
    profile.unPopup = new Popup(`fa-sticky-note`, `Edit user notes for <span>${profile.name}</span>:`, true);
    profile.unTextArea = insertHtml(profile.unPopup.scrollable, `beforeEnd`, `
        <textarea></textarea>
    `);
    set = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveUnNotes.bind(null, profile));
    profile.unPopup.description.appendChild(set.set);
    profile.unPopup.open(getUnNotes.bind(null, profile));
}

function saveUnNotes(profile, resetButton) {
    var notes, user;
    notes = profile.unTextArea.value.trim();
    user = {
        steamId: profile.steamId,
        id: profile.id,
        username: profile.username,
        values: {
            notes: notes
        }
    };
    if (notes) {
        profile.unIcon.classList.remove(`fa-sticky-note-o`);
        profile.unIcon.classList.add(`fa-sticky-note`);
    } else {
        profile.unIcon.classList.remove(`fa-sticky-note`);
        profile.unIcon.classList.add(`fa-sticky-note-o`);
    }
    saveUser(null, null, user, closeUnPopup.bind(null, profile, resetButton));
}

function closeUnPopup(profile, resetButton) {
    resetButton();
    profile.unPopup.close();
}

function getUnNotes(profile) {
    var notes, savedUser, savedUsers;
    profile.unTextArea.focus();
    savedUsers = JSON.parse(getValue(`users`));
    savedUser = savedUsers.users[profile.steamId];
    if (savedUser) {
        notes = savedUser.notes;
        if (notes) {
            profile.unTextArea.value = notes;
        }
    }
}

/* [UF] User Filters */

function loadUf() {
    if (esgst.userPath || esgst.ap) {
        esgst.profileFeatures.push(addUfButton);
    }
}

function addUfButton(profile, savedUser) {
    var uf;
    if (profile.username !== esgst.username) {
        profile.ufButton = insertHtml(profile.heading, `beforeEnd`, `
            <a class="esgst-uf-button" title="Edit user filters.">
                <i class="fa"></i>
            </a>
        `);
        profile.ufIcon = profile.ufButton.firstElementChild;
        if (savedUser) {
            profile.ufValues = savedUser.uf;
            if (profile.ufValues && (profile.ufValues.giveaways || profile.ufValues.discussions || profile.ufValues.posts)) {
                profile.ufIcon.classList.add(`fa-eye-slash`);
            } else {
                profile.ufIcon.classList.add(`fa-eye`);
                profile.ufValues = {
                    giveaways: false,
                    discussions: false,
                    posts: false
                };
            }
        } else {
            profile.ufIcon.classList.add(`fa-eye`);
            profile.ufValues = {
                giveaways: false,
                discussions: false,
                posts: false
            };
        }
        profile.ufButton.addEventListener(`click`, openUfPopup.bind(null, profile));
    }
}

function openUfPopup(profile) {
    var resetSet, saveSet;
    profile.ufPopup = new Popup(`fa-eye`, `Apply user filters for <span>${profile.name}</span>:`, true);
    profile.ufOptions = insertHtml(profile.ufPopup.description, `beforeEnd`, `<div></div>`);
    profile.ufGiveawaysOption = new ToggleSwitch(profile.ufOptions, null, false, `Filter this user's giveaways.`, false, false, `Hides the user's giveaways from the main pages.`, profile.ufValues.giveaways);
    profile.ufDiscussionsOption = new ToggleSwitch(profile.ufOptions, null, false, `Filter this user's discussions.`, false, false, `Hides the user's discussions from the main pages.`, profile.ufValues.discussions);
    profile.ufPostsOption = new ToggleSwitch(profile.ufOptions, null, false, `Filter this user's posts.`, false, false, `Hides the user's posts everywhere.`, profile.ufValues.posts);
    saveSet = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save Settings`, `Saving...`, saveUfSettings.bind(null, profile, false));
    resetSet = new ButtonSet(`green`, `grey`, `fa-rotate-left`, `fa-circle-o-notch fa-spin`, `Reset Settings`, `Resetting...`, saveUfSettings.bind(null, profile, true));
    saveSet.dependencies.push(resetSet.set);
    resetSet.dependencies.push(saveSet.set);
    profile.ufPopup.description.appendChild(saveSet.set);
    profile.ufPopup.description.appendChild(resetSet.set);
    profile.ufPopup.open();
}

function saveUfSettings(profile, reset, resetButton) {
    var uf, user;
    if (reset) {
        uf = null;
        profile.ufGiveawaysOption.input.checked = false;
        profile.ufDiscussionsOption.input.checked = false;
        profile.ufPostsOption.input.checked = false;
        profile.ufValues = {
            giveaways: false,
            discussions: false,
            posts: false
        };
    } else {
        profile.ufValues = {
            giveaways: profile.ufGiveawaysOption.input.checked,
            discussions: profile.ufDiscussionsOption.input.checked,
            posts: profile.ufPostsOption.input.checked
        };
    }
    user = {
        steamId: profile.steamId,
        id: profile.id,
        username: profile.username,
        values: {
            uf: profile.ufValues
        }
    };
    if (profile.ufValues && (profile.ufValues.giveaways || profile.ufValues.discussions || profile.ufValues.posts)) {
        profile.ufIcon.classList.remove(`fa-eye`);
        profile.ufIcon.classList.add(`fa-eye-slash`);
    } else {
        profile.ufIcon.classList.remove(`fa-eye-slash`);
        profile.ufIcon.classList.add(`fa-eye`);
    }
    saveUser(null, null, user, closeUfPopup.bind(null, profile, resetButton));
}

function closeUfPopup(profile, resetButton) {
    resetButton();
    profile.ufPopup.close();
}

function updateUfCount(context, extraCount) {
    var count;
    count = context.getElementsByClassName(`esgst-uf-count`)[0];
    context = context.firstElementChild;
    if (!extraCount) {
        extraCount = 0;
    }
    if (count) {
        count.innerHTML = `
            (<span class="esgst-bold">${parseInt(count.firstElementChild.textContent) + 1 + extraCount}</span> filtered by User Filters)
        `;
    } else {
        context.insertAdjacentHTML(`beforeEnd`, `
            <span class="esgst-uf-count">
                (<span class="esgst-bold">${1 + extraCount}</span> filtered by User Filters)
            </span>
        `);
    }
}

/* [SGC] Shared Groups Checker */

function loadSgc() {
    if (esgst.userPath || esgst.ap) {
        esgst.profileFeatures.push(addSgcButton);
    }
}

function addSgcButton(profile) {
    if (profile.username !== esgst.username) {
        profile.sgcButton = insertHtml(profile.heading, `beforeEnd`, `
            <a class="esgst-sgc-button" title="Check shared groups.">
                <i class="fa fa-users"></i>
            </a>
        `);
        profile.sgcButton.addEventListener(`click`, openSgcPopup.bind(null, profile));
    }
}

function openSgcPopup(profile) {
    if (profile.sgcPopup) {
        profile.sgcPopup.open();
    } else {
        profile.sgcPopup = new Popup(`fa-users`, `Shared Groups`);
        profile.sgcProgress = insertHtml(profile.sgcPopup.description, `beforeEnd`, `
            <div>
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Checking shared groups...</span>
            </div>
        `);
        profile.sgcResults = insertHtml(profile.sgcPopup.scrollable, `beforeEnd`, `
            <div class="esgst-text-left table esgst-hidden">
                <div class="table__heading">
                    <div class="table__column--width-fill">Group</div>
                </div>
                <div class="table__rows"></div>
            </div>
        `);
        profile.sgcPopup.open();
        request(null, null, false, `http://www.steamcommunity.com/profiles/${profile.steamId}/groups`, loadSgcGroups.bind(null, profile));
    }
}

function loadSgcGroups(profile, response) {
    var avatar, element, elements, groups, i, n, name, responseHtml, savedGroup, savedGroups;
    groups = [];
    savedGroups = JSON.parse(getValue(`groups`, `[]`));
    responseHtml = DOM.parse(response.responseText);
    elements = responseHtml.getElementsByClassName(`groupBlock`);
    for (i = 0, n = elements.length; i < n; ++i) {
        element = elements[i];
        name = element.getElementsByClassName(`linkTitle`)[0].textContent;
        avatar = element.getElementsByClassName(`playerAvatar`)[0].firstElementChild.firstElementChild.getAttribute(`src`);
        for (j = savedGroups.length - 1; j >= 0 && savedGroups[j].name !== name; --j);
        if (j >= 0 && savedGroups[j].member) {
            groups.push({
                name: name,
                html: `
                    <div class="table__row-outer-wrap">
                        <div class="table__row-inner-wrap">
                            <div>
                                <a class="table_image_avatar" href="/group/${savedGroups[j].code}/" style="background-image:url(${avatar})"></a>
                            </div>
                            <div class="table__column--width-fill">
                                <a class="table__column__heading" href="/group/${savedGroups[j].code}/"></a>
                            </div>
                        </div>
                    </div>
                `
            });
        }
    }
    n = groups.length;
    if (n > 0) {
        groups = sortArrayByKey(groups, `name`);
        profile.sgcResults.classList.remove(`esgst-hidden`);
        for (i = 0; i < n; ++i) {
            insertHtml(profile.sgcResults.lastElementChild, `beforeEnd`, groups[i].html).getElementsByClassName(`table__column__heading`)[0].textContent = groups[i].name;
        }
        profile.sgcProgress.remove();
        profile.sgcProgress = null;
        loadEndlessFeatures(profile.sgcResults);
        profile.sgcPopup.reposition();
    } else {
        profile.sgcProgress.innerHTML = `
            <div>No shared groups found.</div>
        `;
    }
    profile.sgcPopup.reposition();
}

/* [RWSCVL] Real Won/Sent CL Link */

function loadRwscvl() {
    if (esgst.userPath || esgst.ap) {
        esgst.profileFeatures.push(addRwscvlLinks);
    }
}

function addRwscvlLinks(profile, savedUser) {
    var sentUrl, wonUrl;
    wonUrl = `http://www.sgtools.info/won/${profile.username}`;
    sentUrl = `http://www.sgtools.info/sent/${profile.username}`;
    if (esgst.rwscvl_r) {
        wonUrl += `/newestfirst`;
        sentUrl += `/newestfirst`;
    }
    profile.wonRowLeft.innerHTML = `
        <a class="esgst-rwscvl-link" href="${wonUrl}" target="_blank">Gifts Won</a>
    `;
    profile.sentRowLeft.innerHTML = `
        <a class="esgst-rwscvl-link" href="${sentUrl}" target="_blank">Gifts Sent</a>
    `;
}

    /* [UGD] User Giveaways Data */

function loadUgd() {
    if (esgst.userPath || esgst.ap) {
        esgst.profileFeatures.push(addUgdButtons);
    }
}

function addUgdButtons(profile) {
    var user = {
        steamId: profile.steamId,
        id: profile.id,
        username: profile.username
    };
    addUgdButton(profile.wonRowLeft, `won`, user);
    addUgdButton(profile.sentRowLeft, `sent`, user);
}

function addUgdButton(Context, Key, user) {
    var UGD, UGDButton, popup;
    UGD = {
        Key: Key
    };
    Context.insertAdjacentHTML(`beforeEnd`, `
        <span class="esgst-ugd-button" title="Get ${UGD.Key} giveaways data">
            <i class="fa fa-bar-chart"></i>
        </span>
    `);
    UGDButton = Context.lastElementChild;
    popup = new Popup(`fa-bar-chart`, `Get ${user.username}'s ${UGD.Key} giveaways data:`);
    insertHtml(popup.description, `beforeEnd`, `<div></div>`).appendChild(createOptions([{
        check: UGD.Key === `won`,
        dependencies: [`ugd_getAchievements`],
        description: `Get playtime stats.`,
        id: `ugd_getPlaytime`,
        tooltip: `Get playtime stats for each won game by this user (requires a Steam API Key inserted into the settings menu - does not check DLCs/packages).`
    }, {
        check: UGD.Key === `won`,
        description: `Get achievements stats.`,
        id: `ugd_getAchievements`,
        tooltip: `Get achievements stats for each won game by this user (slower - does not check DLCs/packages).`
    }, {
        check: true,
        description: `Clear cache.`,
        id: `ugd_clearCache`,
        tooltip: `If enabled, the cache will be cleared and all giveaways will be retrieved again (slower).`
    }]));
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-bar-chart`, `fa-times-circle`, `Get Data`, `Cancel`, function (Callback) {
        UGD.Canceled = false;
        UGDButton.classList.add(`esgst-busy`);
        var savedUser = getUser(null, user), ugd, giveaways;
        if (savedUser) {
            giveaways = savedUser.giveaways;
        }
        if (!giveaways) {
            giveaways = {
                sent: {
                    apps: {},
                    subs: {}
                },
                won: {
                    apps: {},
                    subs: {}
                },
                sentTimestamp: 0,
                wonTimestamp: 0
            };
            if (savedUser) {
                ugd = savedUser.ugd;
                if (ugd) {
                    var ggiveaways = {};
                    if (ugd.sent) {
                        for (var key in ugd.sent.apps) {
                            giveaways.sent.apps[key] = [];
                            for (var i = 0, n = ugd.sent.apps[key].length; i < n; ++i) {
                                ggiveaways[ugd.sent.apps[key][i].code] = ugd.sent.apps[key][i];
                                giveaways.sent.apps[key].push(ugd.sent.apps[key][i].code);
                            }
                        }
                        for (var key in ugd.sent.subs) {
                            giveaways.sent.subs[key] = [];
                            for (var i = 0, n = ugd.sent.subs[key].length; i < n; ++i) {
                                ggiveaways[ugd.sent.subs[key][i].code] = ugd.sent.subs[key][i];
                                giveaways.sent.subs[key].push(ugd.sent.subs[key][i].code);
                            }
                        }
                        giveaways.sentTimestamp = ugd.sentTimestamp;
                    }
                    if (ugd.won) {
                        for (var key in ugd.won.apps) {
                            giveaways.won.apps[key] = [];
                            for (var i = 0, n = ugd.won.apps[key].length; i < n; ++i) {
                                ggiveaways[ugd.won.apps[key][i].code] = ugd.won.apps[key][i];
                                giveaways.won.apps[key].push(ugd.won.apps[key][i].code);
                            }
                        }
                        for (var key in ugd.won.subs) {
                            giveaways.won.subs[key] = [];
                            for (var i = 0, n = ugd.won.subs[key].length; i < n; ++i) {
                                ggiveaways[ugd.won.subs[key][i].code] = ugd.won.subs[key][i];
                                giveaways.won.subs[key].push(ugd.won.subs[key][i].code);
                            }
                        }
                        giveaways.wonTimestamp = ugd.wonTimestamp;
                    }
                    if (Object.keys(ggiveaways).length > 0) {
                        lockAndSaveGiveaways(ggiveaways);
                    }
                }
            }
        }
        if (esgst.ugd_clearCache) {
            giveaways[UGD.Key] = null;
        }
        if (!giveaways.sent) {
            giveaways.sent = {
                apps: {},
                subs: {}
            };
            giveaways.sentTimestamp = 0;
        }
        if (!giveaways.won) {
            giveaways.won = {
                apps: {},
                subs: {}
            };
            giveaways.wonTimestamp = 0;
        }
        var Match = location.pathname.match(new RegExp(`^\/user\/${user.username}${UGD.Key === `won` ? `/giveaways/won` : ``}`));
        var CurrentPage = location.href.match(/page=(\d+)/);
        CurrentPage = Match ? (CurrentPage ? parseInt(CurrentPage[1]) : 1) : 0;
        UGD.giveaways = {};
        getUGDGiveaways(UGD, giveaways, 1, `/user/${user.username}${UGD.Key === `won` ? `/giveaways/won` : ``}/search?page=`, user.username, function (giveaways) {
            user.values = {
                giveaways: giveaways,
                ugd: null
            };
            saveUser(null, null, user, function () {
                var Giveaways, Types, TypesTotal, Frequencies, Total, LevelsTotal;
                UGDButton.classList.remove(`esgst-busy`);
                Giveaways = giveaways[UGD.Key];
                    Types = {
                        Everyone: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        Invite: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        Group: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        Whitelist: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        Group_Whitelist: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        Region: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        Region_Invite: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        Region_Group: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        Region_Whitelist: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        Region_Group_Whitelist: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                    };
                    TypesTotal = {
                        Everyone: 0,
                        Invite: 0,
                        Group: 0,
                        Whitelist: 0,
                        Group_Whitelist: 0,
                        Region: 0,
                        Region_Invite: 0,
                        Region_Group: 0,
                        Region_Whitelist: 0,
                        Region_Group_Whitelist: 0
                    };
                    LevelsTotal = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                    Total = 0;
                    Frequencies = {};
                UGD.Progress.textContent = `Calculating stats...`;
                countUgdGiveaways(Frequencies, Giveaways.apps, LevelsTotal, Total, UGD.Key === `won` ? `creators` : `apps`, Types, TypesTotal, UGD, function(LevelsTotal, Total) {
                    countUgdGiveaways(Frequencies, Giveaways.subs, LevelsTotal, Total, UGD.Key === `won` ? `creators` : `subs`, Types, TypesTotal, UGD, function(LevelsTotal, Total) {
                        var Type, I, N, Value, Ordered;
                        UGD.HTML = `
                            <div class="esgst-ugd-table table">
                                <div class="table__heading">
                                    <div class="table__column--width-small text-center">Type</div>
                                    <div class="table__column--width-small text-center">Level 0</div>
                                    <div class="table__column--width-small text-center">Level 1</div>
                                    <div class="table__column--width-small text-center">Level 2</div>
                                    <div class="table__column--width-small text-center">Level 3</div>
                                    <div class="table__column--width-small text-center">Level 4</div>
                                    <div class="table__column--width-small text-center">Level 5</div>
                                    <div class="table__column--width-small text-center">Level 6</div>
                                    <div class="table__column--width-small text-center">Level 7</div>
                                    <div class="table__column--width-small text-center">Level 8</div>
                                    <div class="table__column--width-small text-center">Level 9</div>
                                    <div class="table__column--width-small text-center">Level 10</div>
                                    <div class="table__column--width-small text-center">Total</div>
                                </div>
                                <div class="table__rows">
                        `;
                        for (Type in Types) {
                            UGD.HTML += `
                                    <div class="table__row-outer-wrap">
                                        <div class="table__row-inner-wrap">
                                            <div class="table__column--width-small text-center">${Type.replace(/_/g, ` + `)}</div>
                            `;
                            for (I = 0; I <= 10; ++I) {
                                Value = Types[Type][I];
                                UGD.HTML += `
                                            <div class="table__column--width-small text-center${Value ? `` : ` is-faded`}">${Value}</div>
                                `;
                            }
                            Value = Math.round(TypesTotal[Type] / Total * 10000) / 100;
                            UGD.HTML += `
                                            <div class="table__column--width-small text-center${Value ? `` : ` is-faded`}">${TypesTotal[Type]} (${Value}%)</div>
                                        </div>
                                    </div>
                            `;
                        }
                        UGD.HTML += `
                                    <div class="table__row-outer-wrap">
                                        <div class="table__row-inner-wrap">
                                            <div class="table__column--width-small text-center">Total</div>
                        `;
                        for (I = 0; I <= 10; ++I) {
                            Value = Math.round(LevelsTotal[I] / Total * 10000) / 100;
                            UGD.HTML += `
                                            <div class="table__column--width-small text-center${Value ? `` : ` is-faded`}">${LevelsTotal[I]} (${Value}%)</div>
                            `;
                        }
                        UGD.HTML += `
                                            <div class="table__column--width-small text-center${Total ? `` : ` is-faded`}">${Total}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        Ordered = [];
                        for (Key in Frequencies.apps) {
                            for (I = 0, N = Ordered.length; (I < N) && (Frequencies.apps[Key].frequency <= Ordered[I].frequency); ++I);
                            Ordered.splice(I, 0, Frequencies.apps[Key]);
                        }
                        for (Key in Frequencies.subs) {
                            for (I = 0, N = Ordered.length; (I < N) && (Frequencies.subs[Key].frequency <= Ordered[I].frequency); ++I);
                            Ordered.splice(I, 0, Frequencies.subs[Key]);
                        }
                        for (Key in Frequencies.creators) {
                            for (I = 0, N = Ordered.length; (I < N) && (Frequencies.creators[Key].frequency <= Ordered[I].frequency); ++I);
                            Ordered.splice(I, 0, Frequencies.creators[Key]);
                        }
                        UGD.ordered = Ordered;
                        if (UGD.Key === `won` && esgst.ugd_getPlaytime && esgst.steamApiKey) {
                            UGD.Progress.textContent = `Retrieving game stats...`;
                            UGD.HTML += `
                                <div class="esgst-ugd-table table">
                                    <div class="table__heading">
                                        <div class="table__column--width-fill">Game</div>
                                        <div class="table__column--width-small text-center">Playtime (Last 2 Weeks)</div>
                                        <div class="table__column--width-small text-center">Playtime (Forever)</div>
                                        ${esgst.ugd_getAchievements ? `<div class="table__column--width-small text-center">Achievements</div>` : ``}
                                        <div class="table__column--width-small text-center">Gifter</div>
                                    </div>
                                    <div class="table__rows">
                            `;
                            request(null, null, false, `https://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=${esgst.steamApiKey}&steamid=${user.steamId}&format=json`, response => {
                                let games = JSON.parse(response.responseText).response.games, id;
                                UGD.count = 0;
                                UGD.playedCount = 0;
                                UGD.achievementsCount = 0;
                                UGD.achievementsTotal = 0;
                                UGD.total = Object.keys(Giveaways.apps).length + Object.keys(Giveaways.subs).length;
                                for (id in Giveaways.apps) {
                                    for (i = games.length - 1; i >= 0 && games[i].appid !== parseInt(id); --i);
                                    let giveaway = esgst.giveaways[Giveaways.apps[id][0]];
                                    if (i >= 0) {
                                        let game = games[i];
                                        let time2Weeks = game.playtime_2weeks;
                                        let timeForever = game.playtime_forever;
                                        if (timeForever > 0) {
                                            UGD.playedCount += 1;
                                        }
                                        time2Weeks = time2Weeks && time2Weeks > 0 ? (time2Weeks > 60 ? `${Math.round(time2Weeks / 60 * 100) / 100}h` : `${time2Weeks}m`) : `0`;
                                        timeForever = timeForever > 0 ? (timeForever > 60 ? `${Math.round(timeForever / 60 * 100) / 100}h` : `${timeForever}m`) : `0`;
                                        if (esgst.ugd_getAchievements) {
                                            request(null, null, false, `http://api.steampowered.com/ISteamUserStats/GetPlayerAchievements/v0001/?appid=${game.appid}&key=${esgst.steamApiKey}&steamid=${user.steamId}`, response => {
                                                let responseJson = JSON.parse(response.responseText).playerstats, achievements, count = 0, total = 0;
                                                if (responseJson.success && responseJson.achievements) {
                                                    responseJson.achievements.forEach(achievement => {
                                                        if (achievement.achieved) {
                                                            count += 1;
                                                        }
                                                        total += 1;
                                                    });
                                                    if (count > 0) {
                                                        UGD.achievementsCount += 1;
                                                    }
                                                    UGD.achievementsTotal += 1;
                                                    achievements = `${count}/${total} (${Math.round(count / total * 10000) / 100}%)`;
                                                } else {
                                                    achievements = `0/0`;
                                                }
                                                UGD.HTML += `
                                                    <div class="table__row-outer-wrap">
                                                        <div class="table__row-inner-wrap">
                                                            <div class="table__column--width-fill">${giveaway.gameName}</div>
                                                            <div class="table__column--width-small text-center" data-sort-value="${game.playtime_2weeks || 0}">${time2Weeks}</div>
                                                            <div class="table__column--width-small text-center" data-sort-value="${game.playtime_forever}">${timeForever}</div>
                                                            <div class="table__column--width-small text-center" data-sort-value="${Math.round(count / total * 10000) / 100}">${achievements}</div>
                                                            <div class="table__column--width-small text-center"><a class="table__column__secondary-link" href="/user/${giveaway.creator}">${giveaway.creator}</a></div>
                                                        </div>
                                                    </div>
                                                `;
                                                UGD.count += 1;
                                            });
                                        } else {
                                            UGD.HTML += `
                                                <div class="table__row-outer-wrap">
                                                    <div class="table__row-inner-wrap">
                                                        <div class="table__column--width-fill">${giveaway.gameName}</div>
                                                        <div class="table__column--width-small text-center" data-sort-value="${game.playtime_2weeks || 0}">${time2Weeks}</div>
                                                        <div class="table__column--width-small text-center" data-sort-value="${game.playtime_forever}">${timeForever}</div>
                                                        <div class="table__column--width-small text-center"><a class="table__column__secondary-link" href="/user/${giveaway.creator}">${giveaway.creator}</a></div>
                                                    </div>
                                                </div>
                                            `;
                                            UGD.count += 1;
                                        }
                                    } else {
                                        UGD.HTML += `
                                            <div class="table__row-outer-wrap">
                                                <div class="table__row-inner-wrap">
                                                    <div class="table__column--width-fill">${giveaway.gameName}</div>
                                                    <div class="table__column--width-small text-center">0</div>
                                                    <div class="table__column--width-small text-center">0</div>
                                                    ${esgst.ugd_getAchievements ? `<div class="table__column--width-small text-center">0/0</div>` : ``}
                                                    <div class="table__column--width-small text-center"><a class="table__column__secondary-link" href="/user/${giveaway.creator}">${giveaway.creator}</a></div>
                                                </div>
                                            </div>
                                        `;
                                        UGD.count += 1;
                                    }
                                }
                                for (id in Giveaways.subs) {
                                    let giveaway = esgst.giveaways[Giveaways.subs[id][0]];
                                    UGD.HTML += `
                                        <div class="table__row-outer-wrap">
                                            <div class="table__row-inner-wrap">
                                                <div class="table__column--width-fill">${giveaway.gameName}</div>
                                                <div class="table__column--width-small text-center">0</div>
                                                <div class="table__column--width-small text-center">0</div>
                                                ${esgst.ugd_getAchievements ? `<div class="table__column--width-small text-center">0/0</div>` : ``}
                                                <div class="table__column--width-small text-center"><a class="table__column__secondary-link" href="/user/${giveaway.creator}">${giveaway.creator}</a></div>
                                            </div>
                                        </div>
                                    `;
                                    UGD.count += 1;
                                }
                                checkUgdComplete(popup, UGD, Callback);
                            });
                        } else {
                            UGD.total = UGD.count = 0;
                            checkUgdComplete(popup, UGD, Callback);
                        }
                    });
                });
            });
        });
    }, function () {
            clearInterval(UGD.Request);
            clearInterval(UGD.Save);
            UGD.Canceled = true;
            setTimeout(function () {
                UGD.Progress.innerHTML = UGD.OverallProgress = ``;
            }, 500);
            UGDButton.classList.remove(`esgst-busy`);
    }).set);
    UGD.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    UGD.OverallProgress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    popup.Results = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left"></div>`);
    UGD.popup = popup;
    UGDButton.addEventListener(`click`, function () {
        popup.open();
    });
}

function checkUgdComplete(popup, UGD, callback) {
    UGD.Progress.textContent = `Retrieving game stats (${UGD.count} of ${UGD.total})...`;
    if (UGD.count >= UGD.total) {
        let key;
        if (UGD.Key === `won` && esgst.ugd_getPlaytime && esgst.steamApiKey) {
            UGD.HTML += `
                    </div>
                </div>
                <div class="esgst-bold">${UGD.playedCount} out of ${UGD.total} games with more than 0 hours playtime (${Math.round(UGD.playedCount / UGD.total * 10000) / 100}%)</div>
                ${esgst.ugd_getAchievements ? `<div class="esgst-bold">${UGD.achievementsCount} out of ${UGD.achievementsTotal} games with more than 0 achievements (${Math.round(UGD.achievementsCount / UGD.achievementsTotal * 10000) / 100}%)</div>` : ``}
                <br/>
            `;
        }
        UGD.HTML += `
            <div class="esgst-text-center markdown">
                <div class="esgst-bold">${UGD.Key === `sent` ? `Most given away:` : `Most won from:`}</div>
                <ol>
        `;
        for (key in UGD.ordered) {
            UGD.HTML += `
                    <li>${UGD.ordered[key].name} - <span class="esgst-bold">${UGD.ordered[key].frequency}</span></li>
            `;
        }
        UGD.HTML += `
                </ol>
            </div>
        `;
        popup.Results.innerHTML = UGD.HTML;
        UGD.Progress.innerHTML = ``;
        loadEndlessFeatures(popup.Results);
        UGD.popup.reposition();
        callback();
    } else {
        setTimeout(checkUgdComplete, 250, popup, UGD, callback);
    }
}

function countUgdGiveaways(Frequencies, Giveaways, LevelsTotal, Total, type, Types, TypesTotal, UGD, Callback) {
    var Key, I, N, Giveaway, Private, Group, Whitelist, Region, Level, Copies;
    var savedGiveaways = JSON.parse(getValue(`giveaways`));
    for (Key in Giveaways) {
        for (I = 0, N = Giveaways[Key].length; I < N; ++I) {
            Giveaway = typeof Giveaways[Key][I] === `string` ? savedGiveaways[Giveaways[Key][I]] : Giveaways[Key][I];
            if (Giveaway && Giveaway.entries > 0) {
                Private = Giveaway.inviteOnly;
                Group = Giveaway.group;
                Whitelist = Giveaway.whitelist;
                Region = Giveaway.regionRestricted;
                Level = Giveaway.level;
                Copies = (UGD.Key === `sent`) ? Giveaway.copies : 1;
                if (Private) {
                    if (Region) {
                        Types.Region_Invite[Level] += Copies;
                        TypesTotal.Region_Invite += Copies;
                    } else {
                        Types.Invite[Level] += Copies;
                        TypesTotal.Invite += Copies;
                    }
                } else if (Group) {
                    if (Region) {
                        Types.Region_Group[Level] += Copies;
                        TypesTotal.Region_Group += Copies;
                    } else if (Whitelist) {
                        if (Region) {
                            Types.Region_Group_Whitelist[Level] += Copies;
                            TypesTotal.Region_Group_Whitelist += Copies;
                        } else {
                            Types.Group_Whitelist[Level] += Copies;
                            TypesTotal.Group_Whitelist += Copies;
                        }
                    } else {
                        Types.Group[Level] += Copies;
                        TypesTotal.Group += Copies;
                    }
                } else if (Whitelist) {
                    if (Region) {
                        Types.Region_Whitelist[Level] += Copies;
                        TypesTotal.Region_Whitelist += Copies;
                    } else {
                        Types.Whitelist[Level] += Copies;
                        TypesTotal.Whitelist += Copies;
                    }
                } else if (Region) {
                    Types.Region[Level] += Copies;
                    TypesTotal.Region += Copies;
                } else {
                    Types.Everyone[Level] += Copies;
                    TypesTotal.Everyone += Copies;
                }
                LevelsTotal[Level] += Copies;
                Total += Copies;
                if (UGD.Key === `sent`) {
                    if (!Frequencies[type]) {
                        Frequencies[type] = {};
                    }
                    if (!Frequencies[type][Key]) {
                        Frequencies[type][Key] = {
                            name: Giveaway.gameName,
                            frequency: 0
                        };
                    }
                    Frequencies[type][Key].frequency += Copies;
                } else {
                    if (!Frequencies[type]) {
                        Frequencies[type] = {};
                    }
                    if (!Frequencies[type][Giveaway.creator]) {
                        Frequencies[type][Giveaway.creator] = {
                            name: Giveaway.creator,
                            frequency: 0
                        };
                    }
                    ++Frequencies[type][Giveaway.creator].frequency;
                }
            }
        }
    }
    Callback(LevelsTotal, Total);
}

function getUGDGiveaways(UGD, giveaways, NextPage, URL, username, Callback, Context) {
    var Giveaways, I, NumGiveaways, Giveaway, Found, Pagination;
    if (!UGD.Canceled) {
        if (Context) {
            if (UGD.Progress) {
                if (NextPage === 2) {
                    UGD.lastPage = getLastPage(Context, false, false, true, UGD.Key === `won`);
                    UGD.lastPage = UGD.lastPage === 999999999 ? `` : ` of ${UGD.lastPage}`;
                }
                UGD.Progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Retrieving giveaways (page ${NextPage - 1}${UGD.lastPage})...</span>
                `;
            }
            Giveaways = Context.getElementsByClassName(`giveaway__row-outer-wrap`);
            for (I = 0, NumGiveaways = Giveaways.length; I < NumGiveaways; ++I) {
                Giveaway = getGiveawayInfo(Giveaways[I], document, null, null, username, UGD.Key).data;
                if (Giveaway.endTime < (new Date().getTime())) {
                    if (!UGD.Timestamp) {
                        UGD.Timestamp = Giveaway.endTime;
                    }
                    if (Giveaway.endTime > giveaways[`${UGD.Key}Timestamp`]) {
                        if (Giveaway.gameSteamId) {
                            if (!giveaways[UGD.Key][Giveaway.gameType][Giveaway.gameSteamId]) {
                                giveaways[UGD.Key][Giveaway.gameType][Giveaway.gameSteamId] = [];
                            }
                            if (Giveaway.code) {
                                giveaways[UGD.Key][Giveaway.gameType][Giveaway.gameSteamId].push(Giveaway.code);
                                UGD.giveaways[Giveaway.code] = Giveaway;
                            } else {
                                giveaways[UGD.Key][Giveaway.gameType][Giveaway.gameSteamId].push(Giveaway);
                            }
                        }
                    } else {
                        Found = true;
                        break;
                    }
                }
            }
            Pagination = Context.getElementsByClassName(`pagination__navigation`)[0];
            if (!Found && Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(getUGDGiveaways, 0, UGD, giveaways, NextPage, URL, username, Callback);
            } else {
                giveaways[`${UGD.Key}Timestamp`] = UGD.Timestamp;
                lockAndSaveGiveaways(UGD.giveaways, Callback.bind(null, giveaways));
            }
        } else if (!UGD.Canceled) {
            request(null, null, true, URL + NextPage, function (Response) {
                setTimeout(getUGDGiveaways, 0, UGD, giveaways, ++NextPage, URL, username, Callback, DOM.parse(Response.responseText));
            });
        }
    }
}

/* [NAMWC] Not Activated/Multiple Wins Checker */

function loadNamwc() {
        if (esgst.sg) {
            if (esgst.userPath || esgst.ap) {
                esgst.profileFeatures.push(addNamwcProfileButton);
            }
        }
        if (esgst.namwc_h) {
            esgst.userFeatures.push(highlightNamwcUsers);
        }
}

function addNamwcProfileButton(profile) {
    setNAMWCPopup(insertHtml(profile.wonRowLeft, `beforeEnd`, `
        <span class="esgst-namwc-button">
            <i class="fa fa-question-circle" title="Check for not activated/multiple wins."></i>
        </span>
    `), {
        SteamID64: profile.steamId,
        ID: profile.id,
        Username: profile.username
    });
}

function setNAMWCPopup(NAMWCButton, User, Mnu) {
    var popup, NAMWC;
    NAMWC = {
        User: (User ? User : null)
    };
    popup = new Popup(!Mnu ? `fa-question` : `fa-cog`, !Mnu ? `Check for ${NAMWC.User ? `${NAMWC.User.Username}'s ` : ``} not activated / multiple wins:` : `Manage Not Activated / Multiple Wins Checker caches:`);
    if (!Mnu) {
        popup.Options = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        popup.Options.appendChild(createOptions([{
            check: true,
            description: `Only check for not activated wins.`,
            exclusions: [`namwc_checkMultiple`],
            id: `namwc_checkNotActivated`,
            tooltip: `If enabled, multiple wins will not be checked (faster).`
        }, {
            check: true,
            description: `Only check for multiple wins.`,
            exclusions: [`namwc_checkNotActivated`],
            id: `namwc_checkMultiple`,
            tooltip: `If enabled, not activated wins will not be checked (faster).`
        }]));
        popup.Options.insertAdjacentHTML(`afterEnd`, `<div class="esgst-description">If an user is highlighted, that means they have been either checked for the first time or updated.</div>`);
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-question-circle`, `fa-times-circle`, `Check`, `Cancel`, function (Callback) {
            NAMWC.ShowResults = false;
            NAMWCButton.classList.add(`esgst-busy`);
            setNAMWCCheck(NAMWC, function () {
                NAMWCButton.classList.remove(`esgst-busy`);
                Callback();
            });
        }, function () {
            clearInterval(NAMWC.Request);
            clearInterval(NAMWC.Save);
            NAMWC.Canceled = true;
            setTimeout(function () {
                NAMWC.Progress.innerHTML = ``;
            }, 500);
            NAMWCButton.classList.remove(`esgst-busy`);
        }).set);
    }
    NAMWC.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    NAMWC.OverallProgress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    popup.Results = insertHtml(popup.scrollable, `beforeEnd`, `<div></div>`);
    createResults(popup.Results, NAMWC, [{
        Icon: `<i class="fa fa-check-circle esgst-positive"></i> `,
        Description: `Users with 0 not activated wins`,
        Key: `activated`
    }, {
        Icon: `<i class="fa fa-check-circle esgst-positive"></i> `,
        Description: `Users with 0 multiple wins`,
        Key: `notMultiple`
    }, {
        Icon: `<i class="fa fa-times-circle esgst-negative"></i> `,
        Description: `Users with not activated wins`,
        Key: `notActivated`
    }, {
        Icon: `<i class="fa fa-times-circle esgst-negative"></i> `,
        Description: `Users with multiple wins`,
        Key: `multiple`
    }, {
        Icon: `<i class="fa fa-question-circle"></i> `,
        Description: `Users who cannot be checked for not activated wins either because they have a private profile or SteamCommunity is down`,
        Key: `unknown`
    }]);
    NAMWC.popup = popup;
    NAMWCButton.addEventListener(`click`, function () {
        popup.open(function () {
            if (Mnu) {
                NAMWC.ShowResults = true;
                setNAMWCCheck(NAMWC);
            }
        });
    });
}

function setNAMWCCheck(NAMWC, Callback) {
    var SavedUsers, I, N, Username;
    NAMWC.Progress.innerHTML = NAMWC.OverallProgress.innerHTML = ``;
    NAMWC.activated.classList.add(`esgst-hidden`);
    NAMWC.notMultiple.classList.add(`esgst-hidden`);
    NAMWC.notActivated.classList.add(`esgst-hidden`);
    NAMWC.multiple.classList.add(`esgst-hidden`);
    NAMWC.unknown.classList.add(`esgst-hidden`);
    NAMWC.activatedCount.textContent = NAMWC.notMultipleCount.textContent = NAMWC.notActivatedCount.textContent = NAMWC.multipleCount.textContent = NAMWC.unknownCount.textContent = `0`;
    NAMWC.activatedUsers.innerHTML = NAMWC.notMultipleUsers.textContent = NAMWC.notActivatedUsers.innerHTML = NAMWC.multipleUsers.innerHTML = NAMWC.unknownUsers.innerHTML = ``;
    NAMWC.popup.reposition();
    NAMWC.Users = [];
    NAMWC.Canceled = false;
    if (NAMWC.ShowResults) {
        SavedUsers = JSON.parse(getValue(`users`));
        for (I in SavedUsers.users) {
            if (SavedUsers.users[I].namwc && SavedUsers.users[I].namwc.results) {
                NAMWC.Users.push(SavedUsers.users[I].username);
            }
        }
        NAMWC.Users = sortArray(NAMWC.Users);
        for (I = 0, N = NAMWC.Users.length; I < N; ++I) {
            var user = {
                steamId: SavedUsers.steamIds[NAMWC.Users[I]],
                username: NAMWC.Users[I]
            };
            setNAMWCResult(NAMWC, user, SavedUsers.users[SavedUsers.steamIds[NAMWC.Users[I]]].namwc, false);
        }
        NAMWC.popup.reposition();
    } else if (NAMWC.User) {
        NAMWC.Users.push(NAMWC.User.Username);
        checkNAMWCUsers(NAMWC, 0, 1, Callback);
    } else {
        for (Username in esgst.currentUsers) {
            if (Username != esgst.username) {
                if (NAMWC.Users.length < 26) {
                    NAMWC.Users.push(Username);
                } else {
                    break;
                }
            }
        }
        NAMWC.Users = sortArray(NAMWC.Users);
        checkNAMWCUsers(NAMWC, 0, NAMWC.Users.length, Callback);
    }
}

function checkNAMWCUsers(NAMWC, I, N, Callback) {
    var User, Results, Key, newR;
    if (!NAMWC.Canceled) {
        NAMWC.Progress.innerHTML = ``;
        NAMWC.OverallProgress.textContent = `${I} of ${N} users checked...`;
        if (I < N) {
            User = NAMWC.User ? NAMWC.User : {
                Username: NAMWC.Users[I]
            };
            var user = {
                steamId: User.SteamID64,
                id: User.ID,
                username: User.Username
            };
            var savedUser = getUser(null, user), namwc = null;
            if (savedUser) {
                namwc = savedUser.namwc;
            }
                if (namwc && namwc.results) {
                    Results = namwc.results;
                }
                checkNAMWCUser(NAMWC, namwc, user.username, function(namwc) {
                    if (Results) {
                        for (Key in Results) {
                            if (Results[Key] !== namwc.results[Key]) {
                                newR = true;
                                break;
                            }
                        }
                    } else {
                        newR = true;
                    }
                    setTimeout(setNAMWCResult, 0, NAMWC, user, namwc, newR, I, N, Callback);
                });
        } else if (Callback) {
            Callback();
        }
    }
}

function setNAMWCResult(NAMWC, user, namwc, New, I, N, Callback) {
    var Key;
    if (!NAMWC.Canceled) {
        for (Key in namwc.results) {
            if (namwc.results[Key]) {
                NAMWC[Key].classList.remove(`esgst-hidden`);
                NAMWC[`${Key}Count`].textContent = parseInt(NAMWC[`${Key}Count`].textContent) + 1;
                NAMWC[`${Key}Users`].insertAdjacentHTML(`beforeEnd`, `
                    <a ${New ? `class="esgst-bold esgst-italic" ` : ``}href="http://www.sgtools.info/${Key.match(/multiple|notMultiple/) ? `multiple` : `nonactivated`}/${user.username}" target="_blank">${user.username}${Key.match(/^(notActivated|multiple)$/) ? ` (${namwc.results[Key]})` : ``}</a>
                `);
            }
        }
        NAMWC.popup.reposition();
        if (!NAMWC.ShowResults) {
            user.values = {
                namwc: namwc
            };
            saveUser(null, null, user, function () {
                NAMWC.Progress.innerHTML = ``;
                setTimeout(checkNAMWCUsers, 0, NAMWC, ++I, N, Callback);
            });
        }
    }
}

function checkNAMWCUser(NAMWC, namwc, username, Callback) {
    if (!NAMWC.Canceled) {
        if (!namwc) {
            namwc = {
                lastCheck: 0,
                results: {}
            };
        }
        if ((Date.now() - namwc.lastCheck) > 604800000) {
            if (esgst.namwc_checkNotActivated) {
                checkNAMWCNotActivated(NAMWC, namwc, username, Callback);
            } else if (esgst.namwc_checkMultiple) {
                checkNAMWCMultiple(NAMWC, namwc, username, Callback);
            } else {
                checkNAMWCNotActivated(NAMWC, namwc, username, function (namwc) {
                    checkNAMWCMultiple(NAMWC, namwc, username, Callback);
                });
            }
        } else {
            Callback(namwc);
        }
    }
}

function checkNAMWCNotActivated(NAMWC, namwc, username, Callback) {
    var N, ResponseText;
    if (!NAMWC.Canceled) {
        if (NAMWC.Progress) {
            NAMWC.Progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Retrieving ${username}'s not activated wins...</span>
            `;
        }
        request(null, null, true, `http://www.sgtools.info/nonactivated/${username}`, function (Response) {
            ResponseText = Response.responseText;
            if (ResponseText.match(/has a private profile/)) {
                namwc.results.activated = false;
                namwc.results.notActivated = 0;
                namwc.results.unknown = true;
            } else {
                N = DOM.parse(ResponseText).getElementsByClassName(`notActivatedGame`).length;
                namwc.results.activated = N === 0 ? true : false;
                namwc.results.notActivated = N;
                namwc.results.unknown = false;
            }
            namwc.lastCheck = Date.now();
            Callback(namwc);
        });
    }
}

function checkNAMWCMultiple(NAMWC, namwc, username, Callback) {
    var N;
    if (!NAMWC.Canceled) {
        if (NAMWC.Progress) {
            NAMWC.Progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Retrieving ${username}'s multiple wins...</span>
            `;
        }
        request(null, null, true, `http://www.sgtools.info/multiple/${username}`, function (Response) {
            N = DOM.parse(Response.responseText).getElementsByClassName(`multiplewins`).length;
            namwc.results.notMultiple = N === 0 ? true : false;
            namwc.results.multiple = N;
            namwc.lastCheck = Date.now();
            Callback(namwc);
        });
    }
}

function highlightNamwcUsers(currentUsers) {
    var container, context, highlight, html, i, icon, id, key, matches, n, notActivated, results, savedUser, title;
    for (key in esgst.users.users) {
        savedUser = esgst.users.users[key];
        if (esgst.sg) {
            id = savedUser.username;
        } else {
            id = key;
        }
        if (currentUsers[id] && savedUser.namwc && savedUser.namwc.results) {
            results = savedUser.namwc.results;
            if (results.activated && (results.notMultiple || (results.multiple && esgst.namwc_h_m))) {
                highlight = `positive`;
                icon = `fa-thumbs-up`;
            } else if (results.unknown) {
                highlight = `unknown`;
                icon = `fa-warning`;
            } else {
                highlight = `negative`;
                icon = `fa-thumbs-down`;
            }
            if (((highlight === `positive` || highlight === `unknown`) && !esgst.namwc_h_f) || highlight === `negative`) {
                if (results.unknown) {
                    notActivated = `?`;
                } else {
                    notActivated = results.notActivated;
                }
                title = `${savedUser.username} has ${notActivated} not activated wins and ${results.multiple} multiple wins (last checked ${getTimestamp(savedUser.namwc.lastCheck / 1e3)})`;
                if (esgst.namwc_h_i || esgst.wbh_w || esgst.wbh_b) {
                    html = `
                        <span class="esgst-user-icon" title="${title}">
                            <i class="fa ${icon} esgst-${highlight}"></i>
                        </span>
                    `;
                    matches = currentUsers[id];
                    for (i = 0, n = matches.length; i < n; ++i) {
                        context = matches[i];
                        container = context.parentElement;
                        if (container.classList.contains(`comment__username`)) {
                            context = container;
                        }
                        context.insertAdjacentHTML(`beforeBegin`, html);
                    }
                } else {
                    matches = currentUsers[id];
                    for (i = 0, n = matches.length; i < n; ++i) {
                        context = matches[i];
                        context.classList.add(`esgst-namwc-highlight`, highlight);
                        context.title = title;
                    }
                }
            }
        }
    }
}

/* [NRF] Not Received Finder */

function loadNrf(Context, User) {
    if (esgst.userPath || esgst.ap) {
        esgst.profileFeatures.push(addNrfButton);
    }
}

function addNrfButton(profile, savedUser) {
    var NRF;
    NRF = {
        N: profile.notSent
    };
    if (NRF.N > 0) {
        NRF.I = 0;
        NRF.Multiple = [];
        profile.sentRowLeft.insertAdjacentHTML(`beforeEnd`, `
            <span class="esgst-nrf-button">
                <i class="fa fa-times-circle" title="Find not received giveaways"></i>
            </span>
        `);
        setNRFPopup(NRF, profile.sentRowLeft.lastElementChild, profile);
    }
}

function setNRFPopup(NRF, NRFButton, profile) {
    var popup;
    popup = new Popup(`fa-times`, `Find ${profile.username}'s not received giveaways:`);
    popup.Options = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    popup.Options.appendChild(createOptions([{
        check: true,
        description: `Also search inside giveaways with multiple copies.`,
        id: `nrf_searchMultiple`,
        tooltip: `If disabled, only giveaways with visible not received copies will be found (faster).`
    }]));
    popup.Options.insertAdjacentHTML(`afterEnd`, `<div class="esgst-description">If you're blacklisted / not whitelisted / not a member of the same Steam groups, not all giveaways will be found.`);
    popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-search`, `fa-times-circle`, `Find`, `Cancel`, function (Callback) {
        NRFButton.classList.add(`esgst-busy`);
        setNRFSearch(NRF, profile, function () {
            NRF.Progress.innerHTML = ``;
            NRFButton.classList.remove(`esgst-busy`);
            Callback();
        });
    }, function () {
        clearInterval(NRF.Request);
        clearInterval(NRF.Save);
        NRF.Canceled = true;
        setTimeout(function () {
            NRF.Progress.innerHTML = ``;
        }, 500);
        NRFButton.classList.remove(`esgst-busy`);
    }).set);
    NRF.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    NRF.OverallProgress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    NRF.Results = insertHtml(popup.scrollable, `beforeEnd`, `<div></div>`);
    NRF.popup = popup;
    NRFButton.addEventListener(`click`, function () {
        popup.open();
    });
}

function setNRFSearch(NRF, profile, Callback) {
    NRF.Progress.innerHTML = NRF.OverallProgress.innerHTML = NRF.Results.innerHTML = ``;
    NRF.popup.reposition();
    NRF.Canceled = false;
    var user = {
        steamId: profile.steamId,
        id: profile.id,
        username: profile.username
    };
    var savedUser = getUser(null, user), nrf;
    if (savedUser) {
        nrf = savedUser.nrf;
    }
            if (!nrf) {
                nrf = {
                    lastCheck: 0,
                    found: 0,
                    total: 0,
                    results: ``
                };
            }
            if ((Date.now() - nrf.lastCheck) > 604800000) {
                searchNRFUser(NRF, user.username, 1, 0, `/user/${user.username}/search?page=`, function () {
                    nrf.lastCheck = Date.now();
                    nrf.found = NRF.I;
                    nrf.total = NRF.N;
                    nrf.results = NRF.Results.innerHTML;
                    user.values = {
                        nrf: nrf
                    };
                    saveUser(null, null, user, function () {
                        loadEndlessFeatures(NRF.Results);
                        NRF.Progress.innerHTML = ``;
                        Callback();
                    });
                });
            } else {
                NRF.Results.innerHTML = nrf.results;
                NRF.OverallProgress.innerHTML = `${nrf.found} of ${nrf.total} not received giveaways found...`;
                NRF.popup.reposition();
                loadEndlessFeatures(NRF.Results);
                Callback();
            }
}

function searchNRFUser(NRF, username, NextPage, CurrentPage, URL, Callback, Context) {
    var Matches, I, N, Match, Pagination;
    if (!NRF.Canceled) {
        if (Context) {
            if (NextPage === 2) {
                NRF.lastPage = getLastPage(Context, false, false, true);
                NRF.lastPage = NRF.lastPage === 999999999 ? `` : ` of ${NRF.lastPage}`;
            }
            NRF.Progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Searching ${username}'s giveaways (page ${NextPage - 1}${NRF.lastPage})...</span>
            `;
            Matches = Context.querySelectorAll(`div.giveaway__column--negative`);
            for (I = 0, N = Matches.length; I < N; ++I) {
                NRF.I += Matches[I].querySelectorAll(`a[href*="/user/"]`).length;
                NRF.Results.appendChild(Matches[I].closest(`.giveaway__row-outer-wrap`).cloneNode(true));
                NRF.popup.reposition();
            }
            NRF.OverallProgress.innerHTML = `${NRF.I} of ${NRF.N} not received giveaways found...`;
            if (NRF.I < NRF.N) {
                if (esgst.nrf_searchMultiple) {
                    Matches = Context.getElementsByClassName(`giveaway__heading__thin`);
                    for (I = 0, N = Matches.length; I < N; ++I) {
                        Match = Matches[I].textContent.match(/\((.+) Copies\)/);
                        if (Match && (parseInt(Match[1]) > 3)) {
                            NRF.Multiple.push(Matches[I].closest(`.giveaway__row-outer-wrap`).cloneNode(true));
                        }
                    }
                }
                Pagination = Context.getElementsByClassName(`pagination__navigation`)[0];
                if (Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(searchNRFUser, 0, NRF, username, NextPage, CurrentPage, URL, Callback);
                } else if (esgst.nrf_searchMultiple && NRF.Multiple.length) {
                    setTimeout(searchNRFMultiple, 0, NRF, 0, NRF.Multiple.length, Callback);
                } else {
                    Callback();
                }
            } else {
                Callback();
            }
        } else if (!NRF.Canceled) {
            request(null, null, true, URL + NextPage, function (Response) {
                setTimeout(searchNRFUser, 0, NRF, username, ++NextPage, CurrentPage, URL, Callback, DOM.parse(Response.responseText));
            });
        }
    }
}

function searchNRFMultiple(NRF, I, N, Callback) {
    if (!NRF.Canceled) {
        NRF.Progress.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <span>Searching inside giveaways with multiple copies (${I - 1} of ${N})...</span>
        `;
        if (I < N) {
            searchNRFGiveaway(NRF, `${NRF.Multiple[I].getElementsByClassName(`giveaway__heading__name`)[0].getAttribute(`href`)}/winners/search?page=`, 1, function (Found) {
                if (Found) {
                    NRF.Results.appendChild(NRF.Multiple[I].cloneNode(true));
                }
                if (NRF.I < NRF.N) {
                    setTimeout(searchNRFMultiple, 0, NRF, ++I, N, Callback);
                } else {
                    Callback();
                }
            });
        } else {
            Callback();
        }
    }
}

function searchNRFGiveaway(NRF, URL, NextPage, Callback) {
    if (!NRF.Canceled) {
        request(null, null, true, URL + NextPage, function (Response) {
            var ResponseHTML, Matches, I, N, Found, Pagination;
            ResponseHTML = DOM.parse(Response.responseText);
            Matches = ResponseHTML.getElementsByClassName(`table__column--width-small`);
            for (I = 0, N = Matches.length; I < N; ++I) {
                if (Matches[I].textContent.match(/Not Received/)) {
                    Found = true;
                    ++NRF.I;
                    NRF.OverallProgress.innerHTML = `${NRF.I} of ${NRF.N} not received giveaways found...`;
                    if (NRF.I >= NRF.N) {
                        break;
                    }
                }
            }
            Pagination = ResponseHTML.getElementsByClassName(`pagination__navigation`)[0];
            if ((NRF.I < NRF.N) && Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(searchNRFGiveaway, 0, NRF, URL, ++NextPage, Callback);
            } else {
                Callback(Found);
            }
        });
    }
}

/* [SWR] Sent/Won Ratio */

function loadSwr() {
    if (esgst.userPath || esgst.ap) {
        esgst.profileFeatures.push(addSwrRatio);
    }
}

function addSwrRatio(profile) {
    var ratio, fullRatio, reducedRatio, zeroRatio, cvRatio, realCVRatio;
    ratio = profile.wonCount > 0 ? Math.round(profile.sentCount / profile.wonCount * 100) / 100 : 0;
    fullRatio = profile.wonFull > 0 ? Math.round(profile.sentFull / profile.wonFull * 100) / 100 : 0;
    reducedRatio = profile.wonReduced > 0 ? Math.round(profile.sentReduced / profile.wonReduced * 100) / 100 : 0;
    zeroRatio = profile.wonZero > 0 ? Math.round(profile.sentZero / profile.wonZero * 100) / 100 : 0;
    cvRatio = profile.wonCV > 0 ? Math.round(profile.sentCV / profile.wonCV * 100) / 100 : 0;
    realCVRatio = profile.realWonCV > 0 ? Math.round(profile.realSentCV / profile.realWonCV * 100) / 100 : 0;
    var ratioTooltip = {
        rows: [
            {
                columns: [
                    {
                        name: `Ratio`
                    },
                    {
                        color: `#8f96a6`,
                        name: ratio
                    }
                ],
                icon: [
                    {
                        class: `fa-pie-chart`,
                        color: `#77899a`
                    }
                ]
            },
            {
                columns: [
                    {
                        color: `#8f96a6`,
                        name: `Full Value`
                    },
                    {
                        color: `#8f96a6`,
                        name: fullRatio
                    }
                ],
                indent: `80px`
            },
            {
                columns: [
                    {
                        color: `#8f96a6`,
                        name: `Reduced Value`
                    },
                    {
                        color: `#8f96a6`,
                        name: reducedRatio
                    }
                ],
                indent: `80px`
            },
            {
                columns: [
                    {
                        color: `#8f96a6`,
                        name: `No Value`
                    },
                    {
                        color: `#8f96a6`,
                        name: zeroRatio
                    }
                ],
                indent: `80px;`
            }
        ]
    };
    var cvTooltip = {
        rows: [
            {
                columns: [
                    {
                        name: `Real Value`
                    },
                    {
                        color: `#8f96a6`,
                        name: `\$${realCVRatio}`
                    }
                ],
                icon : [
                    {
                        class: `fa-dollar`,
                        color: `#84cfda`
                    }
                ]
            }
        ]
    };
    profile.sentRow.insertAdjacentHTML(`afterEnd`, `
        <div class="esgst-swr-ratio featured__table__row">
            <div class="featured__table__row__left">Ratio</div>
            <div class="featured__table__row__right">
                <span data-ui-tooltip='${JSON.stringify(ratioTooltip)}'>${ratio}</span>
                (<span data-ui-tooltip='${JSON.stringify(cvTooltip)}'>\$${cvRatio}</span>)
            </div>
        </div>
    `);
}

/* [LUC] Level Up Calculator */

function loadLuc() {
    if (esgst.userPath || esgst.ap) {
        esgst.profileFeatures.push(calculateLuvValue);
    }
}

function calculateLuvValue(profile) {
    var base, lower, upper, value, values;
    base = parseInt(profile.level);
    if (base < 10) {
        values = [0, 0.01, 25.01, 50.01, 100.01, 250.01, 500.01, 1000.01, 2000.01, 3000.01, 5000.01];
        lower = values[base];
        upper = values[base + 1];
        value = Math.round((upper - (lower + ((upper - lower) * (profile.level - base)))) * 100) / 100;
        profile.levelRowRight.insertAdjacentHTML(`beforeEnd`, `<span class="esgst-luc-value">(~\$${value} real CV to level ${base + 1})</span>`);
    }
}

/* [SGPB] SteamGifts Profile Button */

function loadSgpb() {
    if (esgst.userPath) {
        esgst.profileFeatures.push(addSgpbButton);
    }
}

function addSgpbButton(profile) {
    var button;
    button = insertHtml(profile.steamButtonContainer, `beforeEnd`, `
        <div class="esgst-sgpb-container">
            <a class="esgst-sgpb-button" href="https://www.steamgifts.com/go/user/${profile.steamId}" rel="nofollow" target="_blank">
                <i class="fa">
                    <img src="${esgst.sgIcon}">
                </i>
                <span>Visit SteamGifts Profile</span>
            </a>
        </div>
    `);
    button.insertBefore(profile.steamButton, button.firstElementChild);
}

/* [STPB] SteamTrades Profile Button */

function loadStpb() {
    if (esgst.userPath || esgst.ap) {
        esgst.profileFeatures.push(addStpbButton);
    }
}

function addStpbButton(profile) {
    var button, tooltip;
    button = insertHtml(profile.steamButtonContainer.firstElementChild, `beforeEnd`, `
        <a class="esgst-stpb-button" href="https://www.steamtrades.com/user/${profile.steamId}" rel="nofollow" target="_blank">
            <i class="fa fa-fw">
                <img src="${esgst.stIcon}">
            </i>
        </a>
    `);
    tooltip = profile.steamButtonContainer.getElementsByClassName(`js-tooltip`)[0];
    if (tooltip) {
        button.addEventListener(`mouseenter`, showStpbTooltip.bind(null, button, tooltip));
        button.addEventListener(`mouseleave`, hideStpbTooltip.bind(null, button));
    }
}

function showStpbTooltip(button, tooltip) {
    tooltip.textContent = `Visit SteamTrades Profile`;
    setSiblingsOpacity(button, `0.2`);
}

function hideStpbTooltip(button) {
    setSiblingsOpacity(button, `1`);
}

/* Whitelist/Blacklist Checker */

function loadWbc() {
    var keys, n;
    if (esgst.wbc_h) {
        esgst.userFeatures.push(addWbcIcons);
    }
}

function addWBCButton(Context, WBCButton) {
    var popup, WBC;
    WBC = {
        Update: (Context ? false : true),
        B: esgst.wbc_b,
        Username: esgst.username
    };
    popup = new Popup(WBC.Update ? `fa-cog` : `fa-question`, WBC.Update ? `Manage Whitelist/Blacklist Checker caches:` : `Check for whitelists${WBC.B ? `/blacklists` : ``}:`);
    if (location.pathname.match(new RegExp(`^\/user\/(?!${WBC.Username})`))) {
        WBC.User = {
            Username: document.getElementsByClassName(`featured__heading__medium`)[0].textContent,
            ID: document.querySelector(`[name="child_user_id"]`).value,
            SteamID64: document.querySelector(`a[href*="/profiles/"]`).href.match(/\d+/)[0],
        };
    }
    popup.Options = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    popup.Options.appendChild(createOptions([{
        check: WBC.User,
        description: `Only check ${WBC.User ? WBC.User.Username : `current user`}.`,
        exclusions: [`wbc_checkAll`],
        id: `wbc_checkSingle`,
        tooltip: `If disabled, all users in the current page will be checked.`
    }, {
        check: WBC.B,
        description: `Also check whitelist.`,
        id: `wbc_checkWhitelist`,
        tooltip: `If disabled, a blacklist-only check will be performed (faster).`
    }, {
        check: ((((WBC.User && !esgst.wbc_checkSingle) || !WBC.User) && !WBC.Update && !location.pathname.match(/^\/(discussions|users|archive)/)) ? true : false),
        description: `Check all pages.`,
        exclusions: [`wbc_checkSingle`],
        id: `wbc_checkAll`,
        tooltip: `If disabled, only the current page will be checked.`
    }, {
        check: true,
        description: `Return whitelists.`,
        id: `wbc_returnWhitelist`,
        tooltip: `If enabled, everyone who has whitelisted you will be whitelisted back.`,
    }, {
        check: WBC.B,
        description: `Return blacklists.`,
        id: `wbc_returnBlacklist`,
        tooltip: `If enabled, everyone who has blacklisted you will be blacklisted back.`,
    }, {
        check: true,
        description: `Only check users who have not whitelisted ${WBC.B ? `/blacklisted` : ``} you.`,
        id: `wbc_checkNew`,
        tooltip: `If enabled, everyone who has whitelisted ${WBC.B ? `/blacklisted` : ``} you will be ignored (might lead to outdated data if someone who had whitelisted ${WBC.B ? `/blacklisted` : ``} you in the past removed you from those lists).`
    }, {
        check: true,
        description: `Clear caches.`,
        id: `wbc_clearCache`,
        tooltip: `If enabled, the caches of all checked users will be cleared (slower).`
    }]));
    popup.Options.insertAdjacentHTML(`afterEnd`, `<div class="esgst-description">If an user is highlighted, that means they have been either checked for the first time or updated.</div>`);
    popup.description.appendChild(new ButtonSet(`green`, `grey`, WBC.Update ? `fa-refresh` : `fa-question-circle`, `fa-times-circle`, WBC.Update ? `Update` : `Check`, `Cancel`, function (Callback) {
        WBC.ShowResults = false;
        WBCButton.classList.add(`esgst-busy`);
        setWBCCheck(WBC, function () {
            WBCButton.classList.remove(`esgst-busy`);
            Callback();
        });
    }, function () {
        clearInterval(WBC.Request);
        clearInterval(WBC.Save);
        WBC.Canceled = true;
        setTimeout(function () {
            WBC.Progress.innerHTML = ``;
        }, 500);
        WBCButton.classList.remove(`esgst-busy`);
    }).set);
    WBC.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    WBC.OverallProgress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
    popup.Results = insertHtml(popup.scrollable, `beforeEnd`, `<div></div>`);
    createResults(popup.Results, WBC, [{
        Icon: `<i class="fa fa-heart esgst-whitelist"></i> `,
        Description: `You are whitelisted by`,
        Key: `whitelisted`
    }, {
        Icon: `<i class="fa fa-ban esgst-blacklist"></i> `,
        Description: `You are blacklisted by`,
        Key: `blacklisted`
    }, {
        Icon: `<i class="fa fa-check-circle"></i> `,
        Description: WBC.B ? "You are neither whitelisted nor blacklisted by" : `You are not whitelisted by`,
        Key: `none`
    }, {
        Icon: `<i class="fa fa-question-circle"></i> `,
        Description: `You are not blacklisted and there is not enough information to know if you are whitelisted by`,
        Key: `notBlacklisted`
    }, {
        Icon: `<i class="fa fa-question-circle"></i> `,
        Description: `There is not enough information to know if you are whitelisted${WBC.B ? ` or blacklisted` : ``} by`,
        Key: `unknown`
    }]);
    WBCButton.addEventListener(`click`, function () {
        WBC.popup = popup;
        popup.open(function () {
            if (WBC.Update) {
                WBC.ShowResults = true;
                setWBCCheck(WBC);
            }
        });
    });
}

function setWBCCheck(WBC, Callback) {
    var SavedUsers, I, N, Username;
    WBC.Progress.innerHTML = WBC.OverallProgress.innerHTML = ``;
    WBC.whitelisted.classList.add(`esgst-hidden`);
    WBC.blacklisted.classList.add(`esgst-hidden`);
    WBC.none.classList.add(`esgst-hidden`);
    WBC.notBlacklisted.classList.add(`esgst-hidden`);
    WBC.unknown.classList.add(`esgst-hidden`);
    WBC.whitelistedCount.textContent = WBC.blacklistedCount.textContent = WBC.noneCount.textContent = WBC.notBlacklistedCount.textContent = WBC.unknownCount.textContent = `0`;
    WBC.whitelistedUsers.innerHTML = WBC.blacklistedUsers.innerHTML = WBC.noneUsers.innerHTML = WBC.notBlacklistedUsers.innerHTML = WBC.unknownUsers.innerHTML = ``;
    WBC.popup.reposition();
    WBC.Users = [];
    WBC.Canceled = false;
    if (WBC.Update) {
        SavedUsers = JSON.parse(getValue(`users`));
        for (I in SavedUsers.users) {
            if (SavedUsers.users[I].wbc && SavedUsers.users[I].wbc.result) {
                WBC.Users.push(SavedUsers.users[I].username);
            }
        }
        WBC.Users = sortArray(WBC.Users);
        if (WBC.ShowResults) {
            for (I = 0, N = WBC.Users.length; I < N; ++I) {
                var user = {
                    steamId: SavedUsers.steamIds[WBC.Users[I]],
                    id: SavedUsers.users[SavedUsers.steamIds[WBC.Users[I]]].id,
                    username: WBC.Users[I]
                };
                setWBCResult(WBC, user, SavedUsers.users[SavedUsers.steamIds[WBC.Users[I]]].wbc, SavedUsers.users[SavedUsers.steamIds[WBC.Users[I]]].notes, SavedUsers.users[SavedUsers.steamIds[WBC.Users[I]]].whitelisted, SavedUsers.users[SavedUsers.steamIds[WBC.Users[I]]].blacklisted, false);
            }
            WBC.popup.reposition();
        } else {
            checkWBCUsers(WBC, 0, WBC.Users.length, Callback);
        }
    } else if (WBC.User && esgst.wbc_checkSingle) {
        WBC.Users.push(WBC.User.Username);
        checkWBCUsers(WBC, 0, 1, Callback);
    } else {
        for (Username in esgst.currentUsers) {
            if (Username != WBC.Username) {
                WBC.Users.push(Username);
            }
        }
        if (esgst.wbc_checkAll && ((((WBC.User && !esgst.wbc_checkSingle) || !WBC.User) && !WBC.Update && !location.pathname.match(/^\/(discussions|users|archive)/)))) {
            getWBCUsers(WBC, 1, esgst.currentPage, esgst.searchUrl, function () {
                WBC.Users = sortArray(WBC.Users);
                checkWBCUsers(WBC, 0, WBC.Users.length, Callback);
            });
        } else {
            WBC.Users = sortArray(WBC.Users);
            checkWBCUsers(WBC, 0, WBC.Users.length, Callback);
        }
    }
}

function checkWBCUsers(WBC, I, N, Callback) {
    var User, Result;
    if (!WBC.Canceled) {
        WBC.Progress.innerHTML = ``;
        WBC.OverallProgress.textContent = `${I} of ${N} users checked...`;
        if (I < N) {
            User = (WBC.User && esgst.wbc_checkSingle) ? WBC.User : {
                Username: WBC.Users[I]
            };
            var user = {
                steamId: User.SteamID64,
                id: User.ID,
                username: User.Username
            };
            var savedUser = getUser(null, user), notes, whitelisted, blacklisted, wbc;
            if (savedUser) {
                notes = savedUser.notes;
                whitelisted = savedUser.whitelisted;
                blacklisted = savedUser.blacklisted;
                wbc = savedUser.wbc;
            }
            if (wbc && wbc.result) {
                Result = wbc.result;
            }
            if (!wbc || !esgst.wbc_checkNew) {
                checkWBCUser(WBC, wbc, user.username, function (wbc) {
                    setTimeout(setWBCResult, 0, WBC, user, wbc, notes, whitelisted, blacklisted, (Result != wbc.result) ? true : false, I, N, Callback);
                });
            } else {
                setTimeout(setWBCResult, 0, WBC, user, wbc, notes, whitelisted, blacklisted, (Result != wbc.result) ? true : false, I, N, Callback);
            }
        } else if (Callback) {
            Callback();
        }
    }
}

function setWBCResult(WBC, user, wbc, notes, whitelisted, blacklisted, New, I, N, Callback) {
    var Key;
    if (!WBC.Canceled) {
        Key = ((wbc.result === `blacklisted` || wbc.result === `notBlacklisted`) && !WBC.B) ? `unknown` : wbc.result;
        WBC[Key].classList.remove(`esgst-hidden`);
        WBC[`${Key}Count`].textContent = parseInt(WBC[`${Key}Count`].textContent) + 1;
        WBC[`${Key}Users`].insertAdjacentHTML(`beforeEnd`, `<a ${New ? `class="esgst-bold esgst-italic" ` : ``}href="/user/${user.username}">${user.username}</a>`);
        WBC.popup.reposition();
        if (!WBC.ShowResults) {
            if ((esgst.wbc_returnWhitelist && (wbc.result === `whitelisted`) && !whitelisted) || (WBC.B && esgst.wbc_returnBlacklist && (wbc.result === `blacklisted`) && !blacklisted)) {
                if (user.id) {
                    returnWBCWhitelistBlacklist(WBC, wbc, user.username, user.id, notes, function (success, notes) {
                        if (success) {
                            user.values = {
                                wbc: wbc,
                                whitelisted: false,
                                blacklisted: false
                            };
                            if (notes) {
                                user.values.notes = notes;
                            }
                            user.values[wbc.result] = true;
                            user.values[`${wbc.result}Date`] = Date.now();
                        }
                        saveUser(null, null, user, function () {
                            setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
                        });
                    });
                } else {
                    getUserId(user, function() {
                        returnWBCWhitelistBlacklist(WBC, wbc, user.username, user.id, notes, function (success, notes) {
                            if (success) {
                                user.values = {
                                    wbc: wbc,
                                    whitelisted: false,
                                    blacklisted: false
                                };
                                if (notes) {
                                    user.values.notes = notes;
                                }
                                user.values[wbc.result] = true;
                                user.values[`${wbc.result}Date`] = Date.now();
                            }
                            saveUser(null, null, user, function () {
                                setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
                            });
                        });
                    });
                }
            } else if (wbc.result === `whitelisted` || wbc.result === `blacklisted`) {
                user.values = {
                    wbc: wbc
                };
                saveUser(null, null, user, function() {
                    setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
                });
            } else {
                setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
            }
        }
    }
}

function returnWBCWhitelistBlacklist(WBC, wbc, username, id, notes, Callback) {
    var Key, Type;
    if (!WBC.Canceled) {
        Key = wbc.result;
        Type = Key.match(/(.+)ed/)[1];
        WBC.Progress.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <span>Returning ${Type} for ${username}...</span>
        `;
        if (location.pathname.match(new RegExp(`^\/user\/${username}`))) {
            document.getElementsByClassName(`sidebar__shortcut__${Type}`)[0].click();
            if (esgst.wbc_n) {
                var msg = `Returned ${Type}.`;
                if (notes) {
                    notes = `${msg}\n\n${notes}`;
                } else {
                    notes = msg;
                }
            }
            Callback(true, notes);
        } else {
            request(`xsrf_token=${esgst.xsrfToken}&do=${Type}&child_user_id=${id}&action=insert`, null, true, `/ajax.php`, function (Response) {
                var success = false;
                if (JSON.parse(Response.responseText).type === `success`) {
                    success = true;
                    if (esgst.wbc_n) {
                        var msg = `${Key} in return.`;
                        if (notes) {
                            notes = `${msg}\n\n${notes}`;
                        } else {
                            notes = msg;
                        }
                    }
                }
                Callback(success, notes);
            });
        }
    }
}

function checkWBCUser(WBC, wbc, username, Callback) {
    var Match;
    if (!WBC.Canceled) {
        if (esgst.wbc_clearCache) {
            wbc = null;
        }
        if (!wbc) {
            wbc = {
                lastCheck: 0,
                timestamp: 0
            };
        }
        if (((Date.now() - wbc.lastCheck) > 86400000) || WBC.Update) {
            if (((esgst.wbc_checkWhitelist || !WBC.B) && wbc.whitelistGiveaway) || (!esgst.wbc_checkWhitelist && WBC.B && wbc.giveaway)) {
                WBC.Timestamp = wbc.timestamp;
                checkWBCGiveaway(WBC, wbc, Callback);
            } else {
                WBC.Timestamp = 0;
                WBC.GroupGiveaways = [];
                Match = location.href.match(new RegExp(`\/user\/${username}(\/search\?page=(\d+))?`));
                getWBCGiveaways(WBC, wbc, username, 1, Match ? (Match[2] ? parseInt(Match[2]) : 1) : 0, `/user/${username}/search?page=`, Callback);
            }
        } else {
            Callback(wbc);
        }
    }
}

function checkWBCGiveaway(WBC, wbc, Callback) {
    if (!WBC.Canceled) {
        request(null, null, true, wbc.whitelistGiveaway || wbc.giveaway, function (Response) {
            var responseHtml = DOM.parse(Response.responseText);
            var errorMessage = responseHtml.getElementsByClassName(`table--summary`)[0];
            var stop;
            if (errorMessage) {
                errorMessage = errorMessage.textContent;
                if (errorMessage.match(/blacklisted the giveaway creator/)) {
                    wbc.result = `notBlacklisted`;
                    stop = true;
                } else if (errorMessage.match(/blacklisted by the giveaway creator/)) {
                    wbc.result = `blacklisted`;
                } else if (errorMessage.match(/not a member of the giveaway creator's whitelist/)) {
                    wbc.result = `none`;
                } else {
                    wbc.result = `notBlacklisted`;
                }
            } else if (wbc.whitelistGiveaway) {
                wbc.result = `whitelisted`;
            } else {
                wbc.result = `notBlacklisted`;
            }
            wbc.lastCheck = Date.now();
            wbc.timestamp = WBC.Timestamp;
            Callback(wbc, stop);
        });
    }
}

function getWBCGiveaways(WBC, wbc, username, NextPage, CurrentPage, URL, Callback, Context) {
    var Giveaway, Pagination;
    if (!WBC.Canceled) {
        if (Context) {
            if (NextPage === 2) {
                WBC.lastPage = getLastPage(Context, false, false, true);
                WBC.lastPage = WBC.lastPage === 999999999 ? `` : ` of ${WBC.lastPage}`;
            }
            WBC.Progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Retrieving ${username}'s giveaways (page ${NextPage - 1}${WBC.lastPage})...</span>
            `;
            if (!wbc.giveaway) {
                Giveaway = Context.querySelector(`[class="giveaway__heading__name"][href*="/giveaway/"]`);
                wbc.giveaway = Giveaway ? Giveaway.getAttribute(`href`) : null;
            }
            Pagination = Context.getElementsByClassName(`pagination__navigation`)[0];
            Giveaway = Context.getElementsByClassName(`giveaway__summary`)[0];
            if (Giveaway && (WBC.Timestamp === 0)) {
                WBC.Timestamp = parseInt(Giveaway.querySelector(`[data-timestamp]`).getAttribute(`data-timestamp`));
                if (WBC.Timestamp >= (new Date().getTime())) {
                    WBC.Timestamp = 0;
                }
            }
            if (wbc.giveaway) {
                checkWBCGiveaway(WBC, wbc, function (wbc, stop) {
                    var WhitelistGiveaways, I, N, GroupGiveaway;
                    if ((wbc.result === `notBlacklisted`) && !stop && (esgst.wbc_checkWhitelist || !WBC.B)) {
                        WhitelistGiveaways = Context.getElementsByClassName(`giveaway__column--whitelist`);
                        for (I = 0, N = WhitelistGiveaways.length; (I < N) && !wbc.whitelistGiveaway; ++I) {
                            GroupGiveaway = WhitelistGiveaways[I].parentElement.getElementsByClassName(`giveaway__column--group`)[0];
                            if (GroupGiveaway) {
                                WBC.GroupGiveaways.push(GroupGiveaway.getAttribute(`href`));
                            } else {
                                wbc.whitelistGiveaway = WhitelistGiveaways[I].closest(`.giveaway__summary`).getElementsByClassName(`giveaway__heading__name`)[0].getAttribute(`href`);
                            }
                        }
                        if (wbc.whitelistGiveaway) {
                            checkWBCGiveaway(WBC, wbc, Callback);
                        } else if (((WBC.Timestamp >= wbc.timestamp) || (WBC.Timestamp === 0)) && Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                            setTimeout(getWBCGiveaways, 0, WBC, wbc, username, NextPage, CurrentPage, URL, Callback);
                        } else if ((wbc.groupGiveaways && wbc.groupGiveaways.length) || WBC.GroupGiveaways.length) {
                            getWBCGroupGiveaways(WBC, 0, WBC.GroupGiveaways.length, wbc, username, function (wbc, Result) {
                                var Groups, GroupGiveaways, Found, J, NumGroups;
                                if (Result) {
                                    Callback(wbc);
                                } else {
                                    Groups = JSON.parse(getValue(`groups`, `[]`));
                                    for (GroupGiveaway in wbc.groupGiveaways) {
                                        Found = false;
                                        GroupGiveaways = wbc.groupGiveaways[GroupGiveaway];
                                        for (I = 0, N = GroupGiveaways.length; (I < N) && !Found; ++I) {
                                            var i;
                                            for (i = Groups.length - 1; i >= 0 && Groups[i].code !== GroupGiveaways[I]; --i);
                                            if (i >= 0 && Groups[i].member) {
                                                Found = true;
                                            }
                                        }
                                        if (!Found) {
                                            break;
                                        }
                                    }
                                    if (Found) {
                                        Callback(wbc);
                                    } else {
                                        wbc.result = `whitelisted`;
                                        Callback(wbc);
                                    }
                                }
                            });
                        } else {
                            Callback(wbc);
                        }
                    } else {
                        Callback(wbc);
                    }
                });
            } else if (((WBC.Timestamp >= wbc.timestamp) || (WBC.Timestamp === 0)) && Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(getWBCGiveaways, 0, WBC, wbc, username, NextPage, CurrentPage, URL, Callback);
            } else {
                wbc.result = `unknown`;
                wbc.lastCheck = Date.now();
                wbc.timestamp = WBC.Timestamp;
                Callback(wbc);
            }
        } else if (!WBC.Canceled) {
            if (CurrentPage != NextPage) {
                request(null, null, true, URL + NextPage, function (Response) {
                    if (Response.finalUrl.match(/\/user\//)) {
                        setTimeout(getWBCGiveaways, 0, WBC, wbc, username, ++NextPage, CurrentPage, URL, Callback, DOM.parse(Response.responseText));
                    } else {
                        wbc.result = `unknown`;
                        wbc.lastCheck = Date.now();
                        wbc.timestamp = WBC.Timestamp;
                        Callback(wbc);
                    }
                });
            } else {
                setTimeout(getWBCGiveaways, 0, WBC, wbc, username, ++NextPage, CurrentPage, URL, Callback, document);
            }
        }
    }
}

function getWBCGroupGiveaways(WBC, I, N, wbc, username, Callback) {
    if (!WBC.Canceled) {
        if (I < N) {
            WBC.Progress.innerHTML = `
                <i class="fa fa-circle-o-notch"></i>
                <span>Retrieving ${username}'s group giveaways (${I - 1} of ${N})...</span>
            `;
            getWBCGroups(WBC, `${WBC.GroupGiveaways[I]}/search?page=`, 1, wbc, function (wbc, Result) {
                if (Result) {
                    Callback(wbc, Result);
                } else {
                    setTimeout(getWBCGroupGiveaways, 0, WBC, ++I, N, wbc, username, Callback);
                }
            });
        } else {
            Callback(wbc);
        }
    }
}

function getWBCGroups(WBC, URL, NextPage, wbc, Callback) {
    if (!WBC.Canceled) {
        request(null, null, true, URL + NextPage, function (Response) {
            var ResponseText, ResponseHTML, Groups, N, GroupGiveaway, I, Group, Pagination;
            ResponseText = Response.responseText;
            ResponseHTML = DOM.parse(ResponseText);
            Groups = ResponseHTML.getElementsByClassName(`table__column__heading`);
            N = Groups.length;
            if (N > 0) {
                if (!wbc.groupGiveaways) {
                    wbc.groupGiveaways = {};
                }
                GroupGiveaway = URL.match(/\/giveaway\/(.+)\//)[1];
                if (!wbc.groupGiveaways[GroupGiveaway]) {
                    wbc.groupGiveaways[GroupGiveaway] = [];
                }
                for (I = 0; I < N; ++I) {
                    Group = Groups[I].getAttribute(`href`).match(/\/group\/(.+?)\//)[1];
                    if (wbc.groupGiveaways[GroupGiveaway].indexOf(Group) < 0) {
                        wbc.groupGiveaways[GroupGiveaway].push(Group);
                    }
                }
                Pagination = ResponseHTML.getElementsByClassName(`pagination__navigation`)[0];
                if (Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(getWBCGroups, 0, WBC, URL, ++NextPage, wbc, Callback);
                } else {
                    Callback(wbc);
                }
            } else {
                var errorMessage = ResponseHTML.getElementsByClassName(`table--summary`)[0];
                if (errorMessage && errorMessage.textContent.match(/not a member of the giveaway creator's whitelist/)) {
                    wbc.result = `none`;
                    Callback(wbc, true);
                } else {
                    Callback(wbc, true);
                }
            }
        });
    }
}

function getWBCUsers(WBC, NextPage, CurrentPage, URL, Callback, Context) {
    var Matches, I, N, Match, Username, Pagination;
    if (!WBC.Canceled) {
        if (Context) {
            if (NextPage === 2) {
                WBC.lastPage = getLastPage(Context, true);
                WBC.lastPage = WBC.lastPage === 999999999 ? `` : ` of ${WBC.lastPage}`;
            }
            WBC.Progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Retrieving users (page ${NextPage - 1}${WBC.lastPage})...</span>
            `;
            Matches = Context.querySelectorAll(`a[href*="/user/"]`);
            for (I = 0, N = Matches.length; I < N; ++I) {
                Match = Matches[I].getAttribute(`href`).match(/\/user\/(.+)/);
                if (Match) {
                    Username = Match[1];
                    if ((WBC.Users.indexOf(Username) < 0) && (Username != WBC.Username) && (Username === Matches[I].textContent) && !Matches[I].closest(`.markdown`)) {
                        WBC.Users.push(Username);
                    }
                }
            }
            Pagination = Context.getElementsByClassName(`pagination__navigation`)[0];
            if (Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(getWBCUsers, 0, WBC, NextPage, CurrentPage, URL, Callback);
            } else {
                Callback();
            }
        } else if (!WBC.Canceled) {
            if (CurrentPage != NextPage) {
                request(null, null, true, URL + NextPage, function (Response) {
                    setTimeout(getWBCUsers, 0, WBC, ++NextPage, CurrentPage, URL, Callback, DOM.parse(Response.responseText));
                });
            } else {
                setTimeout(getWBCUsers, 0, WBC, ++NextPage, CurrentPage, URL, Callback, document);
            }
        }
    }
}

function addWbcIcons(currentUsers) {
    var container, context, html, i, id, key, lastChecked, matches, n, result, savedUser;
    for (key in esgst.users.users) {
        savedUser = esgst.users.users[key];
        id = esgst.sg ? savedUser.username : key;
        if (currentUsers[id] && savedUser.wbc) {
            result = savedUser.wbc.result;
            if ((result === `whitelisted`) || ((result === `blacklisted`) && esgst.wbc_b)) {
                lastChecked = getTimestamp(savedUser.wbc.lastCheck / 1e3);
                html = `
                    <span class="esgst-user-icon" title="${savedUser.username} has ${result} you (last checked ${lastChecked})">
                        <i class="fa ${(result === `whitelisted`) ? `fa-check esgst-whitelist` : `fa-times esgst-blacklist`}"></i>
                    </span>
                `;
                matches = currentUsers[id];
                for (i = 0, n = matches.length; i < n; ++i) {
                    context = matches[i];
                    container = context.parentElement;
                    if (container.classList.contains(`comment__username`)) {
                        context = container;
                    }
                    context.insertAdjacentHTML(`beforeBegin`, html);
                }
            }
        }
    }
}

/* [WBH] Whitelist/Blacklist Highlighter */

function loadWbh() {
    if (!esgst.accountPath) {
        esgst.userFeatures.push(addWbhIcons);
    }
}

function addWbhIcons(currentUsers) {
    var container, context, html, i, icon, id, key, matches, n, savedUser, status, title;
    for (key in esgst.users.users) {
        savedUser = esgst.users.users[key];
        id = esgst.sg ? savedUser.username : key;
        if (currentUsers[id] && (savedUser.whitelisted || savedUser.blacklisted)) {
            if (savedUser.whitelisted) {
                status = `whitelisted`;
                icon = `fa-heart sidebar__shortcut__whitelist`;
            } else {
                status = `blacklisted`;
                icon = `fa-ban sidebar__shortcut__blacklist`;
            }
            title = `You ${status} ${savedUser.username} on ${getTimestamp(savedUser[`${status}Date`] / 1e3)}`;
            matches = currentUsers[id];
            if ((esgst.wbh_w && savedUser.whitelisted) || (esgst.wbh_b && savedUser.blacklisted)) {
                for (i = 0, n = matches.length; i < n; ++i) {
                    context = matches[i];
                    context.classList.add(`esgst-wbh-highlight`, `esgst-wbh-highlight-${status}`);
                    context.title = title;
                }
            } else {
                html = `
                    <span class="esgst-user-icon" title="${title}">
                        <i class="fa ${icon} esgst-${status.slice(0, -2)}"></i>
                    </span>
                `;
                for (i = 0, n = matches.length; i < n; ++i) {
                    context = matches[i];
                    container = context.parentElement;
                    if (container.classList.contains(`comment__username`)) {
                        context = container;
                    }
                    insertHtml(context, `beforeBegin`, html);
                }
            }
        }
    }
}

/* [WBS] Whitelist/Blacklist Sorter */

function addWbsButton(dateKey, key, saveKey, sortAscButton, sortDescButton) {
    sortAscButton.addEventListener(`click`, function () {
            sortWbsList(true, dateKey, `fa-sort-amount-asc`, key, saveKey, `Oldest to newest ${saveKey} users:`);
    });
    sortDescButton.addEventListener(`click`, function () {
            sortWbsList(false, dateKey, `fa-sort-amount-desc`, key, saveKey, `Newest to oldest ${saveKey} users:`);
    });
}

function sortWbsList(asc, dateKey, icon, key, saveKey, title) {
    var i, n, popup, row, rows, savedUsers, steamId, table, user, users;
    users = [];
    savedUsers = JSON.parse(getValue(`users`)).users;
    for (steamId in savedUsers) {
        if (savedUsers[steamId][saveKey]) {
            users.push({
                steamId: steamId,
                user: savedUsers[steamId]
            });
        }
    }
    users.sort(function (a, b) {
        if (a.user[dateKey] < b.user[dateKey]) {
            if (asc) {
                return -1;
            } else {
                return 1;
            }
        } else if (a.user[dateKey] > b.user[dateKey]) {
            if (asc) {
                return 1;
            } else {
                return -1;
            }
        } else {
            return 0;
        }
    });
    popup = new Popup(icon, title, true);
    popup.popup.classList.add(`esgst-wbs-popup`);
    table = insertHtml(popup.scrollable, `beforeEnd`, `
        <div class="esgst-text-left table">
            <div class="table__heading">
            <div class="table__column--width-fill">User</div>
            <div class="table__column--width-small text-center">Added</div>
                <div class="table__column--width-small text-center">Remove</div>
            </div>
            <div class="table__rows"></div>
        </div>
    `);
    rows = table.lastElementChild;
    for (i = 0, n = users.length; i < n; ++i) {
        user = users[i].user;
        steamId = users[i].steamId;
        row = insertHtml(rows, `beforeEnd`, `
            <div class="table__row-outer-wrap">
                <div class="table__row-inner-wrap">
                    <div class="table__column--width-fill">
                        <a class="table__column__heading" href="/user/${user.username}">${user.username}</a>
                    </div>
                    <div class="table__column--width-small text-center">${getTimestamp(user[dateKey] / 1e3)}</div>
                    <div class="table__column--width-small text-center">
                        <div class="table__remove-default esgst-clickable">
                            <i class="icon-red fa fa-times-circle"></i>
                            <span class="table__column__secondary-link">Remove</span>
                        </div>
                        <div class="table__remove-loading esgst-hidden">
                            <i class="fa fa-refresh fa-spin"></i> Removing...
                        </div>
                        <div class="table__remove-complete esgst-hidden">
                            <i class="fa fa-times-circle"></i> Removed
                        </div>
                    </div>
                </div>
            </div>
        `);
        setWbsRemove(dateKey, key, row, saveKey, steamId, user);
    }
    loadEndlessFeatures(table);
    popup.open();
}

function setWbsRemove(dateKey, key, row, saveKey, steamId, user) {
    var removeButton, removedButton, removingButton, savedUsers;
    removeButton = row.firstElementChild.lastElementChild.firstElementChild;
    removingButton = removeButton.nextElementSibling;
    removedButton = removingButton.nextElementSibling;
    removeButton.addEventListener(`click`, function () {
        removeButton.classList.add(`esgst-hidden`);
        removingButton.classList.remove(`esgst-hidden`);
        request(`xsrf_token=${esgst.xsrfToken}&do=${key}&action=delete&child_user_id=${user.id}`, null, false, `/ajax.php`, function () {
            createLock(`userLock`, 300, function (deleteLock) {
                savedUsers = JSON.parse(getValue(`users`));
                delete savedUsers.users[steamId][saveKey];
                delete savedUsers.users[steamId][dateKey];
                setValue(`users`, JSON.stringify(savedUsers));
                removingButton.classList.add(`esgst-hidden`);
                removedButton.classList.remove(`esgst-hidden`);
            });
        });
    });
}

/* [US] Users Stats */

function getUsUsers(context, main) {
    var element, elements, i, n, us, username, users;
    if (main || context.closest(`.esgst-wbs-popup`)) {
        if (context === document || !main) {
            context.getElementsByClassName(`table__heading`)[0].firstElementChild.insertAdjacentHTML(`afterEnd`, `
                <div class="table__column--width-small text-center">Last Online</div>
                <div class="table__column--width-small text-center">Gifts Won</div>
                <div class="table__column--width-small text-center">Gifts Sent</div>
                <div class="table__column--width-small text-center">Ratio</div>
                <div class="table__column--width-small text-center">Contributor Level</div>
            `);
        }
        users = {};
        elements = context.getElementsByClassName(`table__row-inner-wrap`);
        for (i = 0, n = elements.length; i < n; ++i) {
            element = elements[i];
            users[element.getElementsByClassName(`table__column__heading`)[0].textContent] = (main && element.firstElementChild.nextElementSibling) || element.firstElementChild;
        }
        us = {
            count: 0,
            total: Object.keys(users).length
        };
        for (username in users) {
            request(null, null, false, `/user/${username}`, loadUsStats.bind(null, users[username], us, username));
        }
        checkUsComplete(us);
    }
}

function checkUsComplete(us) {
    if (us.count >= us.total) {
        sortTsTables();
    } else {
        setTimeout(checkUsComplete, 100, us);
    }
}

function loadUsStats(context, us, username, response) {
    var element, elements, html, i, n, profile;
    html = [];
    profile = {};
    elements = DOM.parse(response.responseText).getElementsByClassName(`featured__table__row__left`);
    for (i = 0, n = elements.length; i < n; ++i) {
        element = elements[i];
        switch (element.textContent) {
            case `Last Online`:
                html.push(`
                    <div class="table__column--width-small text-center">${element.nextElementSibling.innerHTML}</div>
                `);
                break;
            case `Gifts Won`:
                profile.wonRow = element.parentElement;
                profile.wonRowLeft = element;
                profile.wonRowRight = element.nextElementSibling;
                rows = JSON.parse(profile.wonRowRight.firstElementChild.firstElementChild.getAttribute(`data-ui-tooltip`)).rows;
                profile.wonCount = parseInt(rows[0].columns[1].name.replace(/,/g, ``));
                profile.wonFull = parseInt(rows[1].columns[1].name.replace(/,/g, ``));
                profile.wonReduced = parseInt(rows[2].columns[1].name.replace(/,/g, ``));
                profile.wonZero = parseInt(rows[3].columns[1].name.replace(/,/g, ``));
                cvrow = profile.wonRowRight.firstElementChild.lastElementChild;
                rows = JSON.parse(cvrow.getAttribute(`data-ui-tooltip`)).rows;
                profile.wonCV = parseFloat(cvrow.textContent.replace(/\$|,/g, ``));
                profile.realWonCV = parseFloat(rows[0].columns[1].name.replace(/\$|,/g, ``));
                element.nextElementSibling.firstElementChild.firstElementChild.firstElementChild.removeAttribute(`style`);
                html.push(`
                    <div class="table__column--width-small text-center">${element.nextElementSibling.innerHTML}</div>
                `);
                break;
            case `Gifts Sent`:
                profile.sentRow = element.parentElement;
                profile.sentRowLeft = element;
                profile.sentRowRight = element.nextElementSibling;
                rows = JSON.parse(profile.sentRowRight.firstElementChild.firstElementChild.getAttribute(`data-ui-tooltip`)).rows;
                profile.sentCount = parseInt(rows[0].columns[1].name.replace(/,/g, ``));
                profile.sentFull = parseInt(rows[1].columns[1].name.replace(/,/g, ``));
                profile.sentReduced = parseInt(rows[2].columns[1].name.replace(/,/g, ``));
                profile.sentZero = parseInt(rows[3].columns[1].name.replace(/,/g, ``));
                profile.notSent = parseInt(rows[5].columns[1].name.replace(/,/g, ``));
                cvrow = profile.sentRowRight.firstElementChild.lastElementChild;
                rows = JSON.parse(cvrow.getAttribute(`data-ui-tooltip`)).rows;
                profile.sentCV = parseFloat(cvrow.textContent.replace(/\$|,/g, ``));
                profile.realSentCV = parseFloat(rows[0].columns[1].name.replace(/\$|,/g, ``));
                element.nextElementSibling.firstElementChild.firstElementChild.firstElementChild.removeAttribute(`style`);
                html.push(`
                    <div class="table__column--width-small text-center">${element.nextElementSibling.innerHTML}</div>
                `);
                break;
            case `Contributor Level`:
                addSwrRatio(profile);
                html.push(`
                    <div class="table__column--width-small text-center">${profile.sentRow.nextElementSibling.lastElementChild.innerHTML}</div>
                `);
                html.push(`
                    <div class="table__column--width-small text-center">${parseFloat(JSON.parse(element.nextElementSibling.firstElementChild.getAttribute(`data-ui-tooltip`)).rows[0].columns[1].name)}</div>
                `);
                break;
        }
    }
    context.insertAdjacentHTML(`afterEnd`, html.join(``));
    us.count += 1;
}

/* [IBH] Inbox Winners Highlighter */

function loadIwh() {
    if (esgst.winnersPath || esgst.inboxPath) {
        esgst.endlessFeatures.push(getIwhUsers);
        getIwhUsers(document);
    }
}

function getIwhUsers(context) {
    var className;
    var callback;
    if (esgst.winnersPath) {
        className = `table__gift-not-sent`;
        callback = setIWHObserver;
    } else {
        className = `comments__entity`;
        callback = highlightIWHWinner;
    }
    var matches = context.getElementsByClassName(className);
    for (var i = 0, n = matches.length; i < n; ++i) {
        callback(matches[i]);
    }
}

function setIWHObserver(Context) {
    var Key, Username;
    Key = location.pathname.match(/\/giveaway\/(.+?)\//)[1];
    Username = Context.closest(`.table__row-inner-wrap`).getElementsByClassName(`table__column__heading`)[0].querySelector(`a[href*="/user/"]`).textContent;
    Context.addEventListener(`click`, function () {
        var Winners;
        Winners = JSON.parse(getValue(`winners`, `{}`));
        if (!Winners[Key]) {
            Winners[Key] = [];
        }
        if (Winners[Key].indexOf(Username) < 0) {
            Winners[Key].push(Username);
        }
        setValue(`winners`, JSON.stringify(Winners));
    });
}

function highlightIWHWinner(Context) {
    var Match, Key, Winners, Matches, I, N, Username;
    Match = Context.firstElementChild.firstElementChild.getAttribute(`href`).match(/\/giveaway\/(.+?)\//);
    if (Match) {
        Key = Match[1];
        Winners = JSON.parse(getValue(`winners`, `{}`));
        if (Winners[Key]) {
            Matches = Context.nextElementSibling.children;
            for (I = 0, N = Matches.length; I < N; ++I) {
                Context = Matches[I].getElementsByClassName(`comment__username`)[0];
                Username = Context.textContent;
                if (Winners[Key].indexOf(Username) >= 0) {
                    Context.insertAdjacentHTML(`afterEnd`, `<i class="fa fa-trophy esgst-iwh-icon" title="This is the winner or one of the winners of this giveaway"></i>`);
                }
            }
        }
    }
}

/* [GH] Groups Highlighter */

function loadGh() {
    if (!esgst.groupsPath) {
        esgst.endlessFeatures.push(highlightGhGroups);
        highlightGhGroups(document);
    }
}

function highlightGhGroups(context) {
    var code, element, elements, i, j, key, n, savedGroups;
    savedGroups = JSON.parse(getValue(`groups`, `[]`));
    elements = context.querySelectorAll(`.table__column__heading[href*="/group/"]`);
    for (i = 0, n = elements.length; i < n; ++i) {
        element = elements[i];
        code = element.getAttribute(`href`).match(/\/group\/(.+?)\//)[1];
        for (j = savedGroups.length - 1; j >= 0 && savedGroups[j].code !== code; --j);
        if (j >= 0 && savedGroups[j].member) {
            element.closest(`.table__row-outer-wrap`).classList.add(`esgst-gh-highlight`);
        }
    }
}

/* [GS] Group Stats */

function loadGs() {
    if (esgst.groupsPath) {
        esgst.endlessFeatures.push(getGsGroups);
        addGSHeading();
        getGsGroups(document);
    }
}

function getGsGroups(context) {
    elements = context.getElementsByClassName(`table__row-inner-wrap`);
    addGsStatus(elements, 0, elements.length);
}

function addGSHeading() {
    var Context;
    Context = document.getElementsByClassName(`table__heading`)[0];
    Context.insertAdjacentHTML(`beforeEnd`, `
        <div class="table__column--width-small text-center">Sent</div>
        <div class="table__column--width-small text-center">Received</div>
        <div class="table__column--width-small text-center">Gift Difference</div>
        <div class="table__column--width-small text-center">Value Difference</div>
    `);
}

function addGsStatus(groups, i, n) {
    var element, elements, group, j, numElements, responseHtml, url, username;
    if (i < n) {
        group = groups[i];
        url = `${group.getElementsByClassName(`table__column__heading`)[0].getAttribute(`href`)}/users/search?q=${esgst.username}`;
        request(null, null, false, url, function (response) {
            var Matches, I, N;
            responseHtml = DOM.parse(response.responseText);
            element = responseHtml.getElementsByClassName(`table__row-inner-wrap`)[0];
            if (element) {
                username = element.getElementsByClassName(`table__column__heading`)[0].textContent;
                if (username === esgst.username) {
                    elements = element.getElementsByClassName(`table__column--width-small`);
                    for (j = 0, numElements = elements.length; j < numElements; ++j) {
                        group.appendChild(elements[0]);
                    }
                    setTimeout(addGsStatus, 0, groups, ++i, n);
                } else {
                    setTimeout(addGsStatus, 0, groups, ++i, n);
                }
            } else {
                setTimeout(addGsStatus, 0, groups, ++i, n);
            }
        });
    }
}

/* [EGH] Entered Games Highlighter */

function loadEgh() {
        if (esgst.giveawayPath) {
            setEghObserver(document);
        }
        if (!esgst.menuPath) {
        esgst.gameFeatures.push(function (games) {
            var savedGames;
            savedGames = JSON.parse(getValue(`games`));
            highlightEghGames(games.apps, savedGames.apps, `apps`);
            highlightEghGames(games.subs, savedGames.subs, `subs`);
        });
        }
}

function setEghObserver(context) {
    var button, info;
    button = context.querySelector(`.sidebar__entry-insert`);
    if (button) {
        info = getGameInfo(context);
        if (info) {
            button.addEventListener(`click`, function () {
                saveEghGame(info.id, info.type);
            });
        }
    }
}

function saveEghGame(id, type) {
    var games;
    if (id && type) {
        games = JSON.parse(getValue(`games`));
        if (!games[type][id] || !games[type][id].entered) {
            createLock(`gameLock`, 300, function (deleteLock) {
                games = JSON.parse(getValue(`games`));
                if (!games[type][id]) {
                    games[type][id] = {};
                }
                games[type][id].entered = true;
                setValue(`games`, JSON.stringify(games));
                deleteLock();
            });
        }
    }
}

function highlightEghGames(games, savedGames, type) {
    var i, id, n;
    for (id in savedGames) {
        if (savedGames[id].entered && games[id]) {
            for (i = 0, n = games[id].length; i < n; ++i) {
                if (!games[id][i].container.getElementsByClassName(`esgst-egh-button`)[0] && ((games[id][i].table && esgst.egh_t) || !games[id][i].table)) {
                    addEghIcon(games[id][i], id, type);
                }
            }
        }
    }
}

function addEghIcon(game, id, type) {
    var icon;
    icon = insertHtml((game.container.closest(`.poll`) && game.container.getElementsByClassName(`table__column__heading`)[0]) || game.headingName, `beforeBegin`, `
        <a class="esgst-egh-button">
            <i class="fa fa-star esgst-egh-icon" title="You have entered giveaways for this game before. Click to unhighlight it"></i>
        </a>
    `);
    icon.addEventListener(`click`, unhighlightGame);

    function unhighlightGame() {
        icon.removeEventListener(`click`, unhighlightGame);
        icon.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        createLock(`gameLock`, 300, function (deleteLock) {
            var games;
            games = JSON.parse(getValue(`games`));
            delete games[type][id].entered;
            setValue(`games`, JSON.stringify(games));
            icon.remove();
            deleteLock();
        });
    }
}

/* [GT] Game Tags */

function loadGt() {
    var savedGames;
    esgst.gameFeatures.push(function (games, table) {
        savedGames = JSON.parse(getValue(`games`));
        getGtGames(games.apps, savedGames.apps, `apps`);
        getGtGames(games.subs, savedGames.subs, `subs`);
    });
}

function getGtGames(games, savedGames, type) {
    var i, id, n;
    for (id in games) {
        for (i = 0, n = games[id].length; i < n; ++i) {
            if ((games[id][i].table && esgst.gt_t) || !games[id][i].table) {
                addGtButton(games[id][i], id, type);
            }
        }
    }
    for (id in savedGames) {
        if (savedGames[id].tags && games[id]) {
            addGtTags(games[id], id, savedGames[id].tags, type);
        }
    }
}

function addGtButton(game, id, type) {
    if (!game.container.getElementsByClassName(`esgst-gt-button`)[0]) {
        insertHtml((game.container.closest(`.poll`) && game.container.getElementsByClassName(`table__column__heading`)[0]) || game.heading.lastElementChild || game.heading, `afterEnd`, `
            <a class="esgst-faded esgst-gt-button" title="Edit game tags">
                <i class="fa fa-tag"></i>
                <span class="esgst-gt-tags"></span>
            </a>
        `).addEventListener(`click`, openGtPopup.bind(null, game, id, type));
    }
}

function openGtPopup(game, id, type) {
    var popup, set;
    popup = new Popup(`fa-tag`, `Edit game tags for <span>${game.name}</span>:`);
    set = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveGtTags.bind(null, id, popup, type));
    popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Drag the tags to move them.<br/><br/>When editing a tag color, it will also alter the color for all games with that tag (you have to refresh the page for it to take effect).</div>`);
    popup.tags = insertHtml(popup.description, `beforeEnd`, `<div class="esgst-gt-tags"></div>`);
    popup.input = insertHtml(popup.description, `beforeEnd`, `<input type="text"/>`);
    popup.input.addEventListener(`keydown`, triggerSetOnEnter.bind(null, set));
    popup.input.addEventListener(`input`, createGtTags.bind(null, popup));
    popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Use commas to separate tags, for example: Tag1, Tag2, ...</div>`);
    popup.description.appendChild(set.set);
    popup.open(loadGtTags.bind(null, id, popup, type));
}

function createGtTags(popup) {
    var i, n, tags;
    tags = popup.input.value.replace(/(,\s*)+/g, formatTags).split(`, `);
    popup.tags.innerHTML = ``;
    for (i = 0, n = tags.length; i < n; ++i) {
        createGtTag(popup, tags[i]);
    }
    popup.reposition();
}

function createGtTag(popup, tag) {
    var bgColorInput, colorInput, colors, container, deleteButton, editButton, input, tagBox, tagContainer;
    container = insertHtml(popup.tags, `beforeEnd`, `
        <div class="esgst-gt-preview" draggable="true">
            <div class="esgst-gt-tags">
                <span class="global__image-outer-wrap author_avatar is_icon">${tag}</span>
            </div>
            <input class="esgst-hidden" type="text"/>
            <input title="Set text color for this tag" type="color"/>
            <input title="Set background color for this tag" type="color"/>
            <i class="esgst-clickable fa fa-edit" title="Edit tag"></i>
            <i class="esgst-clickable fa fa-trash" title="Delete tag"></i>
        </div>
    `);
    tagContainer = container.firstElementChild;
    tagBox = tagContainer.firstElementChild;
    input = tagContainer.nextElementSibling;
    colorInput = input.nextElementSibling;
    bgColorInput = colorInput.nextElementSibling;
    editButton = bgColorInput.nextElementSibling;
    deleteButton = editButton.nextElementSibling;
    colors = esgst.gt_colors[tag];
    if (colors) {
        colorInput.value = tagBox.style.color = colors.color;
        bgColorInput.value = tagBox.style.backgroundColor = colors.bgColor;
    }
    container.addEventListener(`dragstart`, startGtDrag.bind(null, container, popup));
    container.addEventListener(`dragenter`, continueGtDrag.bind(null, container, popup));
    container.addEventListener(`dragend`, endGtDrag.bind(null, popup));
    input.addEventListener(`keydown`, editGtTag.bind(null, bgColorInput, colorInput, input, popup, tagBox, tagContainer));
    colorInput.addEventListener(`change`, saveGtColor.bind(null, colorInput, `color`, `color`, tagBox));
    bgColorInput.addEventListener(`change`, saveGtColor.bind(null, bgColorInput, `backgroundColor`, `bgColor`, tagBox));
    editButton.addEventListener(`click`, showGtEdit.bind(null, input, tagBox, tagContainer));
    deleteButton.addEventListener(`click`, deleteGtTag.bind(null, container, popup));
}

function startGtDrag(container, popup) {
    popup.dragged = container;
}

function continueGtDrag(container, popup) {
    var current;
    current = popup.dragged;
    do {
        current = current.previousElementSibling;
        if (current && current === container) {
            popup.tags.insertBefore(popup.dragged, container);
            return;
        }
    } while (current);
    popup.tags.insertBefore(popup.dragged, container.nextElementSibling);
}

function endGtDrag(popup) {
    var children, i, n, tags;
    tags = [];
    children = popup.tags.children;
    for (i = 0, n = children.length; i < n; ++i) {
        tags.push(children[i].firstElementChild.firstElementChild.textContent);
    }
    popup.input.value = tags.join(`, `);
    popup.reposition();
}

function editGtTag(bgColorInput, colorInput, input, popup, tagBox, tagContainer, event) {
    var colors, name, oldName, tag;
    if (event.key === `Enter`) {
        tagContainer.classList.remove(`esgst-hidden`);
        input.classList.add(`esgst-hidden`);
        oldName = tagBox.textContent;
        tag = input.value;
        tagBox.textContent = tag;
        colors = esgst.gt_colors[tag];
        if (colors) {
            colorInput.value = tagBox.style.color = colors.color;
            bgColorInput.value = tagBox.style.backgroundColor = colors.bgColor;
        }
        endGtDrag(popup);
    }
}

function saveGtColor(input, key, saveKey, tagBox) {
    var tag;
    tag = tagBox.textContent;
    if (!esgst.gt_colors[tag]) {
        esgst.gt_colors[tag] = {
            bgColor: ``,
            color: ``
        };
    }
    esgst.gt_colors[tag][saveKey] = tagBox.style[key] = input.value;
}

function showGtEdit(input, tagBox, tagContainer) {
    tagContainer.classList.add(`esgst-hidden`);
    input.classList.remove(`esgst-hidden`);
    input.value = tagBox.textContent;
    input.focus();
    popup.reposition();
}

function deleteGtTag(container, popup) {
    container.remove();
    endGtDrag(popup);
}

function saveGtTags(id, popup, type, callback) {
    var savedGames, tags;
    tags = popup.input.value.replace(/(,\s*)+/g, formatTags).split(`, `);
    createLock(`gameLock`, 300, function (deleteLock) {
        savedGames = JSON.parse(getValue(`games`));
        if (!savedGames[type][id]) {
            savedGames[type][id] = {};
        }
        savedGames[type][id].tags = tags;
        setValue(`games`, JSON.stringify(savedGames));
        deleteLock();
        completeGtSave(id, popup, tags, type, callback);
    });
}

function completeGtSave(id, popup, tags, type, callback) {
    setSetting(`gt_colors`, esgst.gt_colors);
    addGtTags(null, id, tags, type);
    callback();
    popup.close();
}

function loadGtTags(id, popup, type) {
    var game, i, n, savedGames, tags;
    savedGames = JSON.parse(getValue(`games`));
    game = savedGames[type][id];
    popup.input.focus();
    if (game) {
        tags = game.tags;
        if (tags) {
            popup.tags.innerHTML = ``;
            for (i = 0, n = tags.length; i < n; ++i) {
                createGtTag(popup, tags[i]);
            }
            popup.input.value = tags.join(`, `);
            popup.reposition();
        }
    }
}

function addGtTags(games, id, tags, type) {
    var button, children, colors, game, html, i, j, n, numTags, prefix, suffix, tagsBox, tagsContainer;
    prefix = `<span class="global__image-outer-wrap author_avatar is_icon">`;
    suffix = `</span>`;
    html = tags.length && tags[0] ? `${prefix}${tags.join(`${suffix}${prefix}`)}${suffix}` : ``;
    if (!games) {
        games = getGames(document)[type][id];
    }
    if (games) {
        for (i = 0, n = games.length; i < n; ++i) {
            game = games[i];
            if ((game.table && esgst.gt_t) || !game.table) {
                button = game.container.getElementsByClassName(`esgst-gt-button`)[0];
                if (html) {
                    button.classList.remove(`esgst-faded`);
                } else {
                    button.classList.add(`esgst-faded`);
                }
                tagsContainer = button.lastElementChild;
                tagsContainer.innerHTML = html;
                children = tagsContainer.children;
                for (j = 0, numTags = children.length; j < numTags; ++j) {
                    tagsBox = children[j];
                    colors = esgst.gt_colors[tagsBox.textContent];
                    if (colors) {
                        tagsBox.style.color = colors.color;
                        tagsBox.style.backgroundColor = colors.bgColor;
                    }
                }
            }
        }
    }
}

/* [GC] Game Categories */

function getGcGames(games, endless) {
    var gc, element, elements, i, id, missingApps, missingSubs, n, numApps, numSubs, savedGames;
    gc = {
        apps: Object.keys(games.apps),
        cache: {
            apps: {},
            subs: {}
        },
        subs: Object.keys(games.subs)
    };
    for (id in games.apps) {
        elements = games.apps[id];
        for (i = 0, n = elements.length; i < n; ++i) {
            element = elements[i];
            if (!element.container.getElementsByClassName(`esgst-gc-panel`)[0] && ((element.table && esgst.gc_t) || !element.table)) {
                if (element.container.closest(`.poll`)) {
                    element.container.getElementsByClassName(`table__column__heading`)[0].insertAdjacentHTML(`afterEnd`, `<div class="esgst-gc-panel"></div>`);
                } else {
                    element.heading.insertAdjacentHTML(`afterEnd`, `<div class="esgst-gc-panel"></div>`);
                }
            }
        }
    }
    for (id in games.subs) {
        elements = games.subs[id];
        for (i = 0, n = elements.length; i < n; ++i) {
            element = elements[i];
            if (!element.container.getElementsByClassName(`esgst-gc-panel`)[0] && ((element.table && esgst.gc_t) || !element.table)) {
                if (element.container.closest(`.poll`)) {
                    element.container.getElementsByClassName(`table__column__heading`)[0].insertAdjacentHTML(`afterEnd`, `<div class="esgst-gc-panel"></div>`);
                } else {
                    element.heading.insertAdjacentHTML(`afterEnd`, `<div class="esgst-gc-panel"></div>`);
                }
            }
        }
    }
    if (esgst.gc_gi || esgst.gc_r || esgst.gc_a || esgst.gc_mp || esgst.gc_sc || esgst.gc_tc || esgst.gc_l || esgst.gc_m || esgst.gc_dlc || esgst.gc_ea || esgst.gc_rm || esgst.gc_g) {
        gc.cache = JSON.parse(getValue(`gcCache`, `{ "apps": {}, "subs": {}, "timestamp": 0 }`));
        var currentTime = Date.now();
        for (id in gc.cache.apps) {
            if (gc.cache.apps[id].lastCheck) {
                if (currentTime - gc.cache.apps[id].lastCheck > 604800000 || gc.cache.apps[id].price === -1 || (!gc.cache.apps[id].tags && !gc.cache.apps[id].rating)) {
                    delete gc.cache.apps[id];
                }
            } else {
                gc.cache.apps[id].lastCheck = currentTime;
            }
        }
        for (id in gc.cache.subs) {
            if (gc.cache.subs[id].lastCheck) {
                if (currentTime - gc.cache.subs[id].lastCheck > 604800000 || gc.cache.subs[id].price === -1) {
                    delete gc.cache.subs[id];
                }
            } else {
                gc.cache.subs[id].lastCheck = currentTime;
            }
        }
        setValue(`gcCache`, JSON.stringify(gc.cache));
        missingApps = [];
        missingSubs = [];
        for (i = 0, n = gc.apps.length; i < n; ++i) {
            id = gc.apps[i];
            if (!gc.cache.apps[id]) {
                missingApps.push(id);
            }
        }
        for (i = 0, n = gc.subs.length; i < n; ++i) {
            id = gc.subs[i];
            if (!gc.cache.subs[id]) {
                missingSubs.push(id);
            }
        }
        numApps = missingApps.length;
        numSubs = missingSubs.length;
        if (numApps || numSubs) {
            gc.count = 0;
            gc.total = numApps + numSubs;
            for (i = 0, n = missingApps.length; i < n; ++i) {
                getGcCategories(gc, missingApps[i], `apps`);
            }
            for (i = 0, n = missingSubs.length; i < n; ++i) {
                getGcCategories(gc, missingSubs[i], `subs`);
            }
            setTimeout(checkGcComplete, 1000, games, gc, endless);
        } else {
            addGcCategories(games, gc, endless);
        }
    } else {
        addGcCategories(games, gc, endless);
    }
}

function getGcCategories(gc, id, type) {
    var categories, data, elements, genres, i, match, n, platforms, price, response, responseHtml, responseJson, tags;
    request(null, null, false, `http://store.steampowered.com/api/${type === `apps` ? `appdetails?appids=` : `packagedetails?packageids=`}${id}&filters=basic,categories,genres,name,platforms,price,price_overview&cc=us&l=en`, function (response) {
        try {
            categories = {
                achievements: 0,
                dlc: 0,
                earlyAccess: 0,
                genres: ``,
                linux: 0,
                mac: 0,
                multiplayer: 0,
                name: ``,
                price: -1,
                rating: ``,
                ratingType: ``,
                removed: 1,
                steamCloud: 0,
                tags: ``,
                tradingCards: 0
            };
            responseJson = JSON.parse(response.responseText);
            if (responseJson && responseJson[id]) {
                data = responseJson[id].data;
                if (data) {
                    if (data.categories) {
                        for (i = 0, n = data.categories.length; i < n; ++i) {
                            switch (data.categories[i].description) {
                                case `Steam Achievements`:
                                    categories.achievements = 1;
                                    break;
                                case `Multi-player`:
                                    categories.multiplayer = 1;
                                    break;
                                case `Steam Cloud`:
                                    categories.steamCloud = 1;
                                    break;
                                case `Steam Trading Cards`:
                                    categories.tradingCards = 1;
                                    break;
                                default:
                                    break;
                            }
                        }
                    }
                    categories.dlc = data.type === `dlc` ? 1 : 0;
                    genres = [];
                    if (data.genres) {
                        for (i = 0, n = data.genres.length; i < n; ++i) {
                            genres.push(data.genres[i].description.trim());
                        }
                    }
                    genres.sort(function (a, b) {
                        return a.localeCompare(b, {
                            sensitivity: `base`
                        });
                    });
                    categories.earlyAccess = genres.indexOf(`Early Access`) >= 0 ? 1 : 0;
                    categories.genres = genres.join(`, `);
                    platforms = data.platforms;
                    categories.linux = platforms.linux ? 1 : 0;
                    categories.mac = platforms.mac ? 1 : 0;
                    categories.name = data.name;
                    price = data.price || data.price_overview;
                    categories.price = price ? (price.currency === `USD` ? Math.ceil(price.initial / 100) : -1) : 0;
                }
            }
            request(null, null, false, `http://store.steampowered.com/${type.slice(0, -1)}/${id}`, function (response) {
                responseHtml = DOM.parse(response.responseText);
                if (response.finalUrl.match(id)) {
                    elements = responseHtml.getElementsByClassName(`user_reviews_summary_row`);
                    n = elements.length;
                    if (n > 0) {
                        var rating = elements[n - 1].getAttribute(`data-store-tooltip`).replace(/,|\./g, ``);
                        match = rating.match(/(\d+)%.+?(\d+)/);
                        var percentageIndex = 1;
                        var countIndex = 2;
                        if (!match) {
                            match = rating.match(/(\d+).+?(\d+)%/);
                            percentageIndex = 2;
                            countIndex = 1;
                        }
                        if (match) {
                            categories.rating = `${match[percentageIndex]}% (${match[countIndex]})`;
                            rating = parseInt(match[percentageIndex]);
                            if (rating >= 0) {
                                if (rating < 40) {
                                    categories.ratingType = `Negative`;
                                } else if (rating < 70) {
                                    categories.ratingType = `Mixed`;
                                } else {
                                    categories.ratingType = `Positive`;
                                }
                            } else {
                                categories.ratingType = `?`;
                            }
                        }
                    }
                    categories.removed = 0;
                    tags = [];
                    elements = responseHtml.querySelectorAll(`a.app_tag`);
                    for (i = 0, n = elements.length; i < n; ++i) {
                        tags.push(elements[i].textContent.trim());
                    }
                    tags.sort(function (a, b) {
                        return a.localeCompare(b, {
                            sensitivity: `base`
                        });
                    });
                    categories.tags = tags.join(`, `);
                }
                gc.cache[type][id] = categories;
                gc.count += 1;
            });
        } catch (error) {
            gc.count += 1;
            console.log(error);
        }
    });
}

function checkGcComplete(games, gc, endless) {
    if (gc.count >= gc.total) {
        setValue(`gcCache`, JSON.stringify(gc.cache));
        addGcCategories(games, gc, endless);
    } else {
        setTimeout(checkGcComplete, 1000, games, gc, endless);
    }
}

function addGcCategories(games, gc, endless) {
    var borders, category, categoryNames, categories, giveaway, i, j, id, n, numCategories, savedGames;
    savedGames = JSON.parse(getValue(`games`));
    for (i = 0, n = gc.apps.length; i < n; ++i) {
        id = gc.apps[i];
        addGcCategory(gc.cache.apps[id], games.apps[id], id, savedGames.apps[id], `apps`);
    }
    for (i = 0, n = gc.subs.length; i < n; ++i) {
        id = gc.subs[i];
        addGcCategory(gc.cache.subs[id], games.subs[id], id, savedGames.subs[id], `subs`);
    }
    categories = [`achievements`, `dlc`, `genres`, `linux`, `mac`, `multiplayer`, `package`, `rating`, `removed`, `steamCloud`, `tradingCards`];
    for (i = 0, n = esgst.currentGiveaways.length; i < n; ++i) {
        giveaway = esgst.currentGiveaways[i];
        if (!giveaway.gcReady && giveaway.outerWrap.getElementsByClassName(`esgst-gc-panel`)[0]) {
            for (j = 0, numCategories = categories.length; j < numCategories; ++j) {
                id = categories[j];
                category = giveaway.outerWrap.getElementsByClassName(`esgst-gc-${id}`)[0];
                if (category) {
                    if (id === `genres`) {
                        giveaway.genres = category.textContent.toLowerCase().split(/,\s/);
                    } else if (id === `rating`) {
                        giveaway.rating = parseInt(category.title.match(/(\d+)%/)[1]);
                    } else {
                        giveaway[id] = true;
                    }
                } else if (id === `rating`) {
                    giveaway.rating = 0;
                }
            }
            if (giveaway.grid && esgst.gc_b) {
                borders = insertHtml(giveaway.outerWrap, `beforeEnd`, `<div class="esgst-gc-border"></div>`);
                categoryNames = {
                    gc_fcv: `fullCV`,
                    gc_rcv: `reducedCV`,
                    gc_ncv: `noCV`,
                    gc_h: `hidden`,
                    gc_i: `ignored`,
                    gc_o: `owned`,
                    gc_w: `wishlisted`,
                    gc_a: `achievements`,
                    gc_mp: `multiplayer`,
                    gc_sc: `steamCloud`,
                    gc_tc: `tradingCards`,
                    gc_l: `linux`,
                    gc_m: `mac`,
                    gc_ea: `earlyAccess`,
                    gc_rm: `removed`,
                    gc_dlc: `dlc`,
                    gc_p: `package`
                };
                esgst.gc_categories.forEach(category => {
                    if (categoryNames[category] && giveaway.innerWrap.getElementsByClassName(`esgst-gc-${categoryNames[category]}`)[0]) {
                        borders.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-gc-${categoryNames[category]}"></div>`);
                    }
                });
            }
            giveaway.gcReady = true;
        }
    }
    for (i = 0, n = esgst.popupGiveaways.length; i < n; ++i) {
        giveaway = esgst.popupGiveaways[i];
        if (!giveaway.gcReady && giveaway.outerWrap.getElementsByClassName(`esgst-gc-panel`)[0]) {
            for (j = 0, numCategories = categories.length; j < numCategories; ++j) {
                id = categories[j];
                category = giveaway.outerWrap.getElementsByClassName(`esgst-gc-${id}`)[0];
                if (category) {
                    if (id === `genres`) {
                        giveaway.genres = category.textContent.toLowerCase().split(/,\s/);
                    } else if (id === `rating`) {
                        giveaway.rating = parseInt(category.title.match(/(\d+)%/)[1]);
                    } else {
                        giveaway[id] = true;
                    }
                } else if (id === `rating`) {
                    giveaway.rating = 0;
                }
            }
            if (giveaway.grid && esgst.gc_b) {
                borders = insertHtml(giveaway.outerWrap, `beforeEnd`, `<div class="esgst-gc-border"></div>`);
                categoryNames = {
                    gc_fcv: `fullCV`,
                    gc_rcv: `reducedCV`,
                    gc_ncv: `noCV`,
                    gc_h: `hidden`,
                    gc_i: `ignored`,
                    gc_o: `owned`,
                    gc_w: `wishlisted`,
                    gc_a: `achievements`,
                    gc_mp: `multiplayer`,
                    gc_sc: `steamCloud`,
                    gc_tc: `tradingCards`,
                    gc_l: `linux`,
                    gc_m: `mac`,
                    gc_ea: `earlyAccess`,
                    gc_rm: `removed`,
                    gc_dlc: `dlc`,
                    gc_p: `package`
                };
                esgst.gc_categories.forEach(category => {
                    if (categoryNames[category] && giveaway.innerWrap.getElementsByClassName(`esgst-gc-${categoryNames[category]}`)[0]) {
                        borders.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-gc-${categoryNames[category]}"></div>`);
                    }
                });
            }
            giveaway.gcReady = true;
        }
    }
    if (esgst.gf && esgst.gf.filteredCount && esgst[`gf_enable${esgst.gf.type}`]) {
        filterGfGiveaways(esgst.gf, false, endless);
    }
    if (esgst.gfPopup && esgst.gfPopup.filteredCount && esgst.gf_enablePopup) {
        filterGfGiveaways(esgst.gfPopup);
    }
}

function addGcCategory(cache, games, id, savedGame, type) {
    var category, colored, count, cv, elements, encodedName, genre, genreList, genres, giveaway, giveaways, html, i, icons, j, k, n, panel, name, ratingType, sent, singularType, user, value;
    singularType = type.slice(0, -1);
    name = cache ? cache.name : games[0].name;
    encodedName = encodeURIComponent(name.replace(/\.\.\.$/, ``));
    elements = [];
    for (i = 0, n = esgst.gc_categories.length; i < n; ++i) {
        category = esgst.gc_categories[i];
        if (esgst[category]) {
            switch (category) {
                case `gc_fcv`:
                    if ((savedGame && !savedGame.reducedCV && !savedGame.noCV) || !savedGame) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-fullCV" href="https://www.steamgifts.com/bundle-games/search?q=${encodedName}" title="Full CV">${esgst.gc_fcv_s ? (esgst.gc_fcv_s_i ? `<i class="fa fa-${esgst.gc_fcvIcon}"></i>` : `FCV`) : esgst.gc_fcvLabel}</a>
                        `);
                    }
                    break;
                case `gc_rcv`:
                    if (savedGame && savedGame.reducedCV && !location.pathname.match(/^\/bundle-games/) && (!esgst.gc_ncv_o || !savedGame.noCV)) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-reducedCV" href="https://www.steamgifts.com/bundle-games/search?q=${encodedName}" title="Reduced CV since ${savedGame.reducedCV}">${esgst.gc_rcv_s ? (esgst.gc_rcv_s_i ? `<i class="fa fa-${esgst.gc_rcvIcon}"></i>` : `RCV`) : esgst.gc_rcvLabel}</a>
                        `);
                    }
                    break;
                case `gc_ncv`:
                    if (savedGame && savedGame.noCV) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-noCV" href="https://www.steamgifts.com/bundle-games/search?q=${encodedName}" title="No CV since ${savedGame.noCV}">${esgst.gc_ncv_s ? (esgst.gc_ncv_s_i ? `<i class="fa fa-${esgst.gc_ncvIcon}"></i>` : `NCV`) : esgst.gc_ncvLabel}</a>
                        `);
                    }
                    break;
                case `gc_h`:
                    if (savedGame && savedGame.hidden) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-hidden" href="https://www.steamgifts.com/account/settings/giveaways/filters/search?q=${encodedName}" title="Hidden">${esgst.gc_h_s ? (esgst.gc_h_s_i ? `<i class="fa fa-${esgst.gc_hIcon}"></i>` : `H`) : esgst.gc_hLabel}</a>
                        `);
                    }
                    break;
                case `gc_i`:
                    if (savedGame && savedGame.ignored) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-ignored" href="http://store.steampowered.com/${singularType}/${id}" title="Ignored">${esgst.gc_i_s ? (esgst.gc_i_s_i ? `<i class="fa fa-${esgst.gc_iIcon}"></i>` : `I`) : esgst.gc_iLabel}</a>
                        `);
                    }
                    break;
                case `gc_o`:
                    if (savedGame && savedGame.owned) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-owned" href="https://www.steamgifts.com/account/steam/games/search?q=${encodedName}" title="Owned">${esgst.gc_o_s ? (esgst.gc_o_s_i ? `<i class="fa fa-${esgst.gc_oIcon}"></i>` : `O`) : esgst.gc_oLabel}</a>
                        `);
                    }
                    if (!esgst.gc_o_t || games[0].table) {
                        esgst.gc_o_altAccounts.forEach(account => {
                            var game = account.games[type][id];
                            if (game && game.owned) {
                                elements.push(`
                                    <a class="esgst-gc esgst-gc-owned" href="http://steamcommunity.com/profiles/${account.steamId}/games" style="background-color: ${account.bgColor} !important; color: ${account.color} !important;" title="Owned by ${account.name}">${esgst.gc_o_s ? (esgst.gc_o_s_i ? `<i class="fa fa-${account.icon}"></i>` : `O`) : account.label}</a>
                                `);
                            }
                        });
                    }
                    break;
                case `gc_w`:
                    if (savedGame && savedGame.wishlisted) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-wishlisted" href="https://www.steamgifts.com/account/steam/wishlist/search?q=${encodedName}" title="Wishlisted">${esgst.gc_w_s ? (esgst.gc_w_s_i ? `<i class="fa fa-${esgst.gc_wIcon}"></i>` : `W`) : esgst.gc_wLabel}</a>
                        `);
                    }
                    break;
                case `gc_gi`:
                    if (((esgst.gc_gi_t && games[0].table) || !esgst.gc_gi_t) && (esgst.gc_gi_cew && (esgst.createdPath || esgst.enteredPath || esgst.wonPath) || !esgst.gc_gi_cew) && cache && cache.price) {
                        user = esgst.users.users[esgst.steamId];
                        if (user) {
                            giveaways = user.giveaways;
                            if (giveaways) {
                                giveaways = giveaways.sent[type][id];
                                count = 0;
                                if (giveaways) {
                                    sent = 0;
                                    var currentDate = Date.now();
                                    for (j = 0, numGiveaways = giveaways.length; j < numGiveaways; ++j) {
                                        giveaway = esgst.giveaways[giveaways[j]];
                                        if (giveaway && (currentDate < giveaway.endTime || (((giveaways.entries < 5) && !giveaway.inviteOnly && !giveaway.group && !giveaway.whitelist) || (giveaway.entries >= 5)))) {
                                            sent += giveaway.entries >= giveaway.copies || currentDate < giveaway.endTime ? giveaway.copies : giveaway.entries;
                                        }
                                        if (giveaway.winners > 0) {
                                            count += giveaway.winners;
                                        } else if (currentDate < giveaway.endTime) {
                                            count += giveaway.copies;
                                        }
                                    }
                                    value = cache.price;
                                    if (savedGame) {
                                        if (savedGame.noCV) {
                                            value = 0;
                                        } else if (savedGame.reducedCV) {
                                            value *= 0.15;
                                        }
                                    }
                                    if (sent > 5) {
                                        for (j = 0, numGiveaways = sent - 5; j < numGiveaways; ++j) {
                                            value *= 0.90;
                                        }
                                    }
                                    cv = (sent + 1) > 5 ? value * 0.90 : value;
                                    cv = Math.round(cv * 100) / 100;
                                } else {
                                    value = cache.price;
                                    if (savedGame) {
                                        if (savedGame.noCV) {
                                            value = 0;
                                        } else if (savedGame.reducedCV) {
                                            value *= 0.15;
                                        }
                                    }
                                    cv = Math.round(value * 100) / 100;
                                }
                                elements.push(`
                                    <a class="esgst-gc esgst-gc-giveawayInfo" href="https://www.steamgifts.com/user/${esgst.username}" title="You have made ${count} giveaways for this game. You should get \$${cv} real CV if you make a new giveaway for this game."><i class="fa fa-info"></i> ${count} <i class="fa fa-dollar"></i> ${cv}</a>
                                `);
                            }
                        }
                    }
                    break;
                case `gc_r`:
                    if (cache && cache.rating) {
                        icons = {
                            positive: `thumbs-up`,
                            negative: `thumbs-down`,
                            mixed: `minus-circle`
                        };
                        ratingType = cache.ratingType.toLowerCase();
                        elements.push(`
                            <a class="esgst-gc esgst-gc-rating esgst-gc-rating-${ratingType}" href="http://store.steampowered.com/${singularType}/${id}" title="${cache.rating}"><i class="fa fa-${icons[ratingType]}"></i>${esgst.gc_r_s ? ` ${cache.rating}` : ``}</a>
                        `);
                    }
                    break;
                case `gc_a`:
                    if (cache && cache.achievements) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-achievements" href="http://steamcommunity.com/stats/${id}/achievements" title="Achievements">${esgst.gc_a_s ? (esgst.gc_a_s_i ? `<i class="fa fa-${esgst.gc_aIcon}"></i>` : `A`) : esgst.gc_aLabel}</a>
                        `);
                    }
                    break;
                case `gc_mp`:
                    if (cache && cache.multiplayer) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-multiplayer" href="http://store.steampowered.com/${singularType}/${id}" title="Multiplayer">${esgst.gc_mp_s ? (esgst.gc_mp_s_i ? `<i class="fa fa-${esgst.gc_mpIcon}"></i>` : `MP`) : esgst.gc_mpLabel}</a>
                        `);
                    }
                    break;
                case `gc_sc`:
                    if (cache && cache.steamCloud) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-steamCloud" href="http://store.steampowered.com/${singularType}/${id}" title="Steam Cloud">${esgst.gc_sc_s ? (esgst.gc_sc_s_i ? `<i class="fa fa-${esgst.gc_scIcon}"></i>` : `SC`) : esgst.gc_scLabel}</a>
                        `);
                    }
                    break;
                case `gc_tc`:
                    if (cache && cache.tradingCards) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-tradingCards" href="http://www.steamcardexchange.net/index.php?gamepage-${singularType}id-${id}" title="Trading Cards">${esgst.gc_tc_s ? (esgst.gc_tc_s_i ? `<i class="fa fa-${esgst.gc_tcIcon}"></i>` : `TC`) : esgst.gc_tcLabel}</a>
                        `);
                    }
                    break;
                case `gc_l`:
                    if (cache && cache.linux) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-linux" href="http://store.steampowered.com/${singularType}/${id}" title="Linux">${esgst.gc_l_s ? (esgst.gc_l_s_i ? `<i class="fa fa-${esgst.gc_lIcon}"></i>` : `L`) : esgst.gc_lLabel}</a>
                        `);
                    }
                    break;
                case `gc_m`:
                    if (cache && cache.mac) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-mac" href="http://store.steampowered.com/${singularType}/${id}" title="Mac">${esgst.gc_m_s ? (esgst.gc_m_s_i ? `<i class="fa fa-${esgst.gc_mIcon}"></i>` : `M`) : esgst.gc_mLabel}</a>
                        `);
                    }
                    break;
                case `gc_dlc`:
                    if (cache && cache.dlc) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-dlc" href="http://store.steampowered.com/${singularType}/${id}" title="DLC">${esgst.gc_dlc_s ? (esgst.gc_dlc_s_i ? `<i class="fa fa-${esgst.gc_dlcIcon}"></i>` : `DLC`) : esgst.gc_dlcLabel}</a>
                        `);
                    }
                    break;
                case `gc_p`:
                    if (type === `subs`) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-package" href="http://store.steampowered.com/${singularType}/${id}" title="Package">${esgst.gc_p_s ? (esgst.gc_p_s_i ? `<i class="fa fa-${esgst.gc_pIcon}"></i>` : `P`) : esgst.gc_pLabel}</a>
                        `);
                    }
                    break;
                case `gc_ea`:
                    if (cache && cache.earlyAccess) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-earlyAccess" href="http://store.steampowered.com/${singularType}/${id}" title="Early Access">${esgst.gc_ea_s ? (esgst.gc_ea_s_i ? `<i class="fa fa-${esgst.gc_eaIcon}"></i>` : `EA`) : esgst.gc_eaLabel}</a>
                        `);
                    }
                    break;
                case `gc_rm`:
                    if (cache && cache.removed) {
                        elements.push(`
                            <a class="esgst-gc esgst-gc-removed" href="http://steamdb.info/${singularType}/${id}" title="Removed">${esgst.gc_rm_s ? (esgst.gc_rm_s_i ? `<i class="fa fa-${esgst.gc_rmIcon}"></i>` : `RM`) : esgst.gc_rmLabel}</a>
                        `);
                    }
                    break;
                case `gc_g`:
                    if (cache && cache.genres) {
                        genres = esgst.gc_g_udt && cache.tags ? `${cache.genres}, ${cache.tags}` : cache.genres;
                        genreList = sortArray(Array.from(new Set(genres.split(/,\s/))));
                        genres = genreList.join(`, `);
                        colored = [];
                        for (j = genreList.length - 1; j >= 0; --j) {
                            genre = genreList[j].toLowerCase();
                            for (k = esgst.gc_g_colors.length - 1; k >= 0 && esgst.gc_g_colors[k].genre.toLowerCase() !== genre; --k);
                            if (k >= 0) {
                                colored.push(`<span style="color: ${esgst.gc_g_colors[k].color}">${genreList.splice(j, 1)}</span>`);
                            }
                        }
                        if (colored.length) {
                            colored = sortArray(colored);
                            for (j = colored.length - 1; j >= 0; --j) {
                                genreList.unshift(colored[j]);
                            }
                        }
                        elements.push(`
                            <a class="esgst-gc esgst-gc-genres" href="http://store.steampowered.com/${singularType}/${id}" title="${genres}">${genreList.join(`, `)}</a>
                        `);
                    }
                    break;
            }
        }
    }
    html = elements.join(``);
    for (i = 0, n = games.length; i < n; ++i) {
        panel = games[i].container.getElementsByClassName(`esgst-gc-panel`)[0];
        if (panel && !panel.innerHTML) {
            if (esgst.gc_il && !esgst.giveawayPath) {
                panel.previousElementSibling.style.display = `inline-block`;
                panel.classList.add(`esgst-gc-panel-inline`);
            }
            panel.innerHTML = html;
        }
    }
}

/* [MT] Multi-Tag */

function enableMt(mt, current) {
    var checkbox, container, id;
    if (mt.type === `user`) {
        mt.users = {};
        mt.userCheckboxes = [];
        mt.selectedUsers = [];
        if (!current) {
            current = esgst.currentUsers;
        }
        for (id in current) {
            current[id].forEach(element => {
                container = element.parentElement;
                if (!container.classList.contains(`esgst-hidden`)) {
                    if (container.classList.contains(`comment__username`)) {
                        element = container;
                    }
                    checkbox = new Checkbox(insertHtml(element, `beforeBegin`, `
                        <span class="esgst-mt-checkbox"></span>
                    `));
                    checkbox.onEnabled = addMtUser.bind(null, id, mt);
                    checkbox.onDisabled = removeMtUser.bind(null, id, mt);
                    if (!mt.users[id]) {
                        mt.users[id] = {
                            checkboxes: []
                        };
                    }
                    mt.users[id].checkboxes.push(checkbox);
                    mt.userCheckboxes.push(checkbox);
                }
            });
        }
    } else {
        mt.games = {
            apps: {},
            subs: {}
        };
        mt.gameCheckboxes = [];
        mt.selectedGames = {
            apps: [],
            subs: []
        };
        if (!current) {
            current = esgst.currentGames;
        }
        for (id in current.apps) {
            current.apps[id].forEach(element => {
                if (!element.heading.classList.contains(`esgst-hidden`)) {
                    checkbox = new Checkbox(insertHtml(element.heading, `afterBegin`, `
                        <span class="esgst-mt-checkbox"></span>
                    `));
                    checkbox.onEnabled = addMtGame.bind(null, id, mt, `apps`);
                    checkbox.onDisabled = removeMtGame.bind(null, id, mt, `apps`);
                    if (!mt.games.apps[id]) {
                        mt.games.apps[id] = {
                            checkboxes: []
                        };
                    }
                    mt.games.apps[id].checkboxes.push(checkbox);
                    mt.gameCheckboxes.push(checkbox);
                }
            });
        }
        for (id in current.subs) {
            current.subs[id].forEach(element => {
                if (!element.heading.classList.contains(`esgst-hidden`)) {
                    checkbox = new Checkbox(insertHtml(element.heading, `afterBegin`, `
                        <span class="esgst-mt-checkbox"></span>
                    `));
                    checkbox.onEnabled = addMtGame.bind(null, id, mt, `subs`);
                    checkbox.onDisabled = removeMtGame.bind(null, id, mt, `subs`);
                    if (!mt.games.subs[id]) {
                        mt.games.subs[id] = {
                            checkboxes: []
                        };
                    }
                    mt.games.subs[id].checkboxes.push(checkbox);
                    mt.gameCheckboxes.push(checkbox);
                }
            });
        }
    }
    if (!mt.popout) {
        openMtPopout(mt);
    }
}

function addMtUser(id, mt) {
    var count;
    if (mt.selectedUsers.indexOf(id) < 0) {
        mt.selectedUsers.push(id);
        mt.users[id].checkboxes.forEach(checkbox => {
            checkbox.check();
        });
        count = parseInt(mt.count.textContent) + 1
        mt.count.textContent = count;
        if (count > 1) {
            mt.tagButton.classList.remove(`esgst-hidden`);
        }
    }
}

function removeMtUser(id, mt) {
    var count, index;
    index = mt.selectedUsers.indexOf(id);
    if (index >= 0) {
        mt.selectedUsers.splice(index, 1);
        mt.users[id].checkboxes.forEach(checkbox => {
            checkbox.uncheck();
        });
        count = parseInt(mt.count.textContent) - 1;
        mt.count.textContent = count;
        if (count <= 1) {
            mt.tagButton.classList.add(`esgst-hidden`);
        }
    }
}

function addMtGame(id, mt, type) {
    var count;
    if (mt.selectedGames[type].indexOf(id) < 0) {
        mt.selectedGames[type].push(id);
        mt.games[type][id].checkboxes.forEach(checkbox => {
            checkbox.check();
        });
        count = parseInt(mt.count.textContent) + 1
        mt.count.textContent = count;
        if (count > 1) {
            mt.tagButton.classList.remove(`esgst-hidden`);
        }
    }
}

function removeMtGame(id, mt, type) {
    var count, index;
    index = mt.selectedGames[type].indexOf(id);
    if (index >= 0) {
        mt.selectedGames[type].splice(index, 1);
        mt.games[type][id].checkboxes.forEach(checkbox => {
            checkbox.uncheck();
        });
        count = parseInt(mt.count.textContent) - 1;
        mt.count.textContent = count;
        if (count <= 1) {
            mt.tagButton.classList.add(`esgst-hidden`);
        }
    }
}

function disableMt(mt) {
    mt[`${mt.type}Checkboxes`].forEach(checkbox => {
        checkbox.checkbox.parentElement.remove();
    });
    mt.count.textContent = 0;
    mt.tagButton.classList.add(`esgst-hidden`);
}

function openMtPopout(mt) {
    if (!mt.popout) {
        mt.popout = new Popout(`esgst-mt-popout`, mt.button, 0, true);
        mt.popout.popout.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle`, `fa-circle-o-notch fa-spin`, `Select All`, ``, selectMtCheckboxes.bind(null, mt, `check`)).set);
        mt.popout.popout.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle-o`, `fa-circle-o-notch fa-spin`, `Select None`, ``, selectMtCheckboxes.bind(null, mt, `uncheck`)).set);
        mt.popout.popout.appendChild(new ButtonSet(`grey`, `grey`, `fa-dot-circle-o`, `fa-circle-o-notch fa-spin`, `Select Inverse`, ``, selectMtCheckboxes.bind(null, mt, `toggle`)).set);
        mt.tagButton = new ButtonSet(`green`, ``, `fa-tags`, ``, `Multi-Tag`, ``, openMtPopup.bind(null, mt)).set;
        mt.tagButton.classList.add(`esgst-hidden`);
        mt.popout.popout.appendChild(mt.tagButton);
        mt.count = insertHtml(mt.popout.popout, `beforeEnd`, `
            <div><span>0</span> selected.</div>
        `).firstElementChild;
    }
}

function selectMtCheckboxes(mt, key, callback) {
    callback();
    selectSwitches(mt[`${mt.type}Checkboxes`], key);
}

function openMtPopup(mt, callback) {
    callback();
    popup = new Popup(`fa-tags`, `Multi-tag <span>${mt.count.textContent}</span> ${mt.type}s:`);
    set = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveMtTags.bind(null, mt, popup));
    popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Drag the tags to move them.<br/><br/>When editing a tag color, it will also alter the color for all users/games with that tag (you have to refresh the page for it to take effect).<br/><br/>[*] means that there are tags that are not shared between all users/games. If you delete the [*] tag, those individual tags will be deleted.</div>`);
    popup.tags = insertHtml(popup.description, `beforeEnd`, `<div class="esgst-${mt.type === `user` ? `ut` : `gt`}-tags"></div>`);
    popup.input = insertHtml(popup.description, `beforeEnd`, `<input type="text"/>`);
    popup.input.addEventListener(`keydown`, triggerSetOnEnter.bind(null, set));
    if (mt.type === `user`) {
        popup.input.addEventListener(`input`, createUtTags.bind(null, popup));
    } else {
        popup.input.addEventListener(`input`, createGtTags.bind(null, popup));
    }
    popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Use commas to separate tags, for example: Tag1, Tag2, ...</div>`);
    popup.description.appendChild(set.set);
    popup.open(loadMtTags.bind(null, mt, popup));
}

function loadMtTags(mt, popup) {
    var index, individual, savedUser, savedUsers, tags;
    mt.tags = [];
    if (mt.type === `user`) {
        savedUsers = JSON.parse(getValue(`users`));
        mt.selectedUsers.forEach(username => {
            savedUser = getUser(savedUsers, {
                username: username
            });
            if (savedUser) {
                tags = savedUser.tags;
                if (tags) {
                    mt.users[username].tags = tags;
                    tags.forEach(tag => {
                        if (mt.tags.indexOf(tag) < 0) {
                            mt.tags.push(tag);
                        }
                    });
                } else {
                    mt.users[username].tags = [];
                }
            } else {
                mt.users[username].tags = [];
            }
        });
        individual = false;
        mt.selectedUsers.forEach(username => {
            mt.users[username].tags.forEach(tag => {
                mt.selectedUsers.forEach(subUsername => {
                    if (subUsername !== username && mt.users[subUsername].tags.indexOf(tag) < 0) {
                        index = mt.tags.indexOf(tag);
                        if (index >= 0) {
                            mt.tags.splice(index, 1);
                        }
                        individual = true;
                    }
                });
            });
        });
        if (individual) {
            mt.tags.push(`[*]`);
        }
        mt.tags.forEach(tag => {
            createUtTag(popup, tag);
        });
    } else {
        savedGames = JSON.parse(getValue(`games`));
        mt.selectedGames.apps.forEach(id => {
            savedGame = savedGames.apps[id];
            if (savedGame) {
                tags = savedGame.tags;
                if (tags) {
                    mt.games.apps[id].tags = tags;
                    tags.forEach(tag => {
                        if (mt.tags.indexOf(tag) < 0) {
                            mt.tags.push(tag);
                        }
                    });
                } else {
                    mt.games.apps[id].tags = [];
                }
            } else {
                mt.games.apps[id].tags = [];
            }
        });
        mt.selectedGames.subs.forEach(id => {
            savedGame = savedGames.subs[id];
            if (savedGame) {
                tags = savedGame.tags;
                if (tags) {
                    mt.games.subs[id].tags = tags;
                    tags.forEach(tag => {
                        if (mt.tags.indexOf(tag) < 0) {
                            mt.tags.push(tag);
                        }
                    });
                } else {
                    mt.games.subs[id].tags = [];
                }
            } else {
                mt.games.subs[id].tags = [];
            }
        });
        individual = false;
        mt.selectedGames.apps.forEach(id => {
            mt.games.apps[id].tags.forEach(tag => {
                mt.selectedGames.apps.forEach(subId => {
                    if (subId !== id && mt.games.apps[subId].tags.indexOf(tag) < 0) {
                        index = mt.tags.indexOf(tag);
                        if (index >= 0) {
                            mt.tags.splice(index, 1);
                        }
                        individual = true;
                    }
                });
                mt.selectedGames.subs.forEach(subId => {
                    if (subId !== id && mt.games.subs[subId].tags.indexOf(tag) < 0) {
                        index = mt.tags.indexOf(tag);
                        if (index >= 0) {
                            mt.tags.splice(index, 1);
                        }
                        individual = true;
                    }
                });
            });
        });
        mt.selectedGames.subs.forEach(id => {
            mt.games.subs[id].tags.forEach(tag => {
                mt.selectedGames.apps.forEach(subId => {
                    if (subId !== id && mt.games.apps[subId].tags.indexOf(tag) < 0) {
                        index = mt.tags.indexOf(tag);
                        if (index >= 0) {
                            mt.tags.splice(index, 1);
                        }
                        individual = true;
                    }
                });
                mt.selectedGames.subs.forEach(subId => {
                    if (subId !== id && mt.games.subs[subId].tags.indexOf(tag) < 0) {
                        index = mt.tags.indexOf(tag);
                        if (index >= 0) {
                            mt.tags.splice(index, 1);
                        }
                        individual = true;
                    }
                });
            });
        });
        if (individual) {
            mt.tags.push(`[*]`);
        }
        mt.tags.forEach(tag => {
            createGtTag(popup, tag);
        });
    }
    popup.input.value = mt.tags.join(`, `);
    popup.reposition();
}

function saveMtTags(mt, popup, callback) {
    var games, i, index, tags, users;
    if (mt.type === `user`) {
        users = [];
        tags = popup.input.value.replace(/(,\s*)+/g, formatTags);
        mt.selectedUsers.forEach(username => {
            mt.tags.forEach(tag => {
                index = mt.users[username].tags.indexOf(tag);
                if (index >= 0) {
                    mt.users[username].tags.splice(index, 1);
                }
            });
            if (mt.users[username].tags.length > 0) {
                mt.users[username].tags = tags.replace(/\[\*\]/, mt.users[username].tags.join(`, `)).split(/,\s/);
            } else {
                mt.users[username].tags = tags.replace(/\[\*\]|,\s\[\*\]/, ``).split(/,\s/);
            }
            for (i = mt.users[username].tags.length - 1; i >= 0; --i) {
                if (!mt.users[username].tags[i]) {
                    mt.users[username].tags.splice(i, 1);
                }
            }
            users.push({
                username: username,
                values: {
                    tags: Array.from(new Set(mt.users[username].tags))
                }
            });
        });
        saveUsers(users, completeMtSave.bind(null, mt, popup, callback));
    } else {
        games = {
            apps: {},
            subs: {}
        };
        tags = popup.input.value.replace(/(,\s*)+/g, formatTags);
        mt.selectedGames.apps.forEach(id => {
            mt.tags.forEach(tag => {
                index = mt.games.apps[id].tags.indexOf(tag);
                if (index >= 0) {
                    mt.games.apps[id].tags.splice(index, 1);
                }
            });
            if (mt.games.apps[id].tags.length > 0) {
                mt.games.apps[id].tags = tags.replace(/\[\*\]/, mt.games.apps[id].tags.join(`, `)).split(/,\s/);
            } else {
                mt.games.apps[id].tags = tags.replace(/\[\*\]|,\s\[\*\]/, ``).split(/,\s/);
            }
            for (i = mt.games.apps[id].tags.length - 1; i >= 0; --i) {
                if (!mt.games.apps[id].tags[i]) {
                    mt.games.apps[id].tags.splice(i, 1);
                }
            }
            games.apps[id] = {
                tags: Array.from(new Set(mt.games.apps[id].tags))
            };
        });
        mt.selectedGames.subs.forEach(id => {
            mt.tags.forEach(tag => {
                index = mt.games.subs[id].tags.indexOf(tag);
                if (index >= 0) {
                    mt.games.subs[id].tags.splice(index, 1);
                }
            });
            if (mt.games.subs[id].tags.length > 0) {
                mt.games.subs[id].tags = tags.replace(/\[\*\]/, mt.games.subs[id].tags.join(`, `)).split(/,\s/);
            } else {
                mt.games.subs[id].tags = tags.replace(/\[\*\]|,\s\[\*\]/, ``).split(/,\s/);
            }
            for (i = mt.games.subs[id].tags.length - 1; i >= 0; --i) {
                if (!mt.games.subs[id].tags[i]) {
                    mt.games.subs[id].tags.splice(i, 1);
                }
            }
            games.subs[id] = {
                tags: Array.from(new Set(mt.games.subs[id].tags))
            };
        });
        lockAndSaveGames(games, completeMtSave.bind(null, mt, popup, callback));
    }
}

function completeMtSave(mt, popup, callback) {
    if (mt.type === `user`) {
        setSetting(`ut_colors`, esgst.ut_colors);
        mt.selectedUsers.forEach(username => {
            addUtTags(username, mt.users[username].tags);
        });
    } else {
        setSetting(`gt_colors`, esgst.gt_colors);
        mt.selectedGames.apps.forEach(id => {
            addGtTags(null, id, mt.games.apps[id].tags, `apps`);
        });
        mt.selectedGames.subs.forEach(id => {
            addGtTags(null, id, mt.games.subs[id].tags, `subs`);
        });
    }
    callback();
    popup.close();
}

/* */

function loadSMMenu(tab) {
    var Selected, Item, SMSyncFrequency, I, Container, SMGeneral, SMGiveaways, SMDiscussions, SMCommenting, SMUsers, SMOthers, SMManageFilteredUsers,
        SMGeneralFeatures, SMGiveawayFeatures, SMDiscussionFeatures, SMCommentingFeatures, SMUserGroupGamesFeatures, SMOtherFeatures,
        SMLastSync, LastSync, SMAPIKey;
    var popup;
    if (tab) {
        document.body.className = `esgst-tab-menu`;
        Container = document.body;
    } else {
        popup = new Popup(`fa-gear`, `Settings`, true, true);
        popup.description.classList.add(`esgst-text-left`);
        Container = popup.scrollable;
    }
    SMSyncFrequency = `<select class="esgst-sync-frequency">`;
    for (I = 0; I <= 30; ++I) {
        SMSyncFrequency += `<option>${I}</option>`;
    }
    SMSyncFrequency += `</select>`;
    Container.innerHTML = `
        <div class="esgst-page-heading"></div>
        <div class="esgst-settings-menu"></div>
    `;
    var heading = Container.getElementsByClassName(`esgst-page-heading`)[0];
    createSMButtons(heading, [{
        Check: true,
        Icons: [`fa-arrow-circle-up`],
        Name: `esgst-heading-button`,
        Title: `Import data`
    }, {
        Check: true,
        Icons: [`fa-arrow-circle-down`],
        Name: `esgst-heading-button`,
        Title: `Export data`
    }, {
        Check: true,
        Icons: [`fa-trash`],
        Name: `esgst-heading-button`,
        Title: `Delete data`
    }, {
        Check: esgst.uf,
        Icons: [`fa-user`, `fa-eye-slash`],
        Name: `SMManageFilteredUsers esgst-heading-button`,
        Title: `See list of filtered users.`
    }, {
        Check: esgst.sg && esgst.gf && esgst.gf_h,
        Icons: [`fa-gift`, `fa-eye-slash`],
        Name: `SMManageFilteredGiveaways esgst-heading-button`,
        Title: `Manage hidden giveaways.`
    }, {
        Check: esgst.sg && esgst.df && esgst.df_h,
        Icons: [`fa-comments`, `fa-eye-slash`],
        Name: `SMManageFilteredDiscussions esgst-heading-button`,
        Title: `Manage hidden discussions`
    }, {
        Check: esgst.sg && esgst.et,
        Icons: [`fa-ticket`, `fa-history`],
        Name: `SMManageEntriesTracker esgst-heading-button`,
        Title: `Manage Entries Tracker stats.`
    }, {
        Check: esgst.ut,
        Icons: [`fa-user`, `fa-tags`],
        Name: `SMManageUserTags esgst-heading-button`,
        Title: `Manage user tags`
    }, {
        Check: esgst.gt,
        Icons: [`fa-gamepad`, `fa-tags`],
        Name: `SMManageGameTags esgst-heading-button`,
        Title: `Manage game tags`
    }, {
        Check: esgst.wbc,
        Icons: [`fa-heart`, `fa-ban`, `fa-cog`],
        Name: `esgst-wbc-button esgst-heading-button`,
        Title: `Manage Whitelist / Blacklist Checker caches.`
    }, {
        Check: esgst.namwc,
        Icons: [`fa-trophy`, `fa-cog`],
        Name: `esgst-namwc-button esgst-heading-button`,
        Title: `Manage Not Activated / Multiple Wins Checker caches.`
    }]);
    var SMMenu = Container.getElementsByClassName(`esgst-settings-menu`)[0];
    var sections = {
        general: {
            index: 1
        },
        giveaways: {
            index: 1
        },
        discussions: {
            index: 1
        },
        trades: {
            index: 1
        },
        comments: {
            index: 1
        },
        users: {
            index: 1
        },
        groups: {
            index: 1
        },
        games: {
            index: 1
        },
        other: {
            index: 1
        }
    };
    var j = 0;
    for (var key in sections) {
        if ((key === `trades` && esgst.settings.esgst_st) || key !== `trades`) {
            var title = key.replace(/^./, function (m) {
                return m.toUpperCase();
            });
            sections[key].section = insertHtml(SMMenu, `beforeEnd`, `
                ${createSMSections(++j, [{
                    Title: title
                }])}
            `);
        }
    }
    for (var i = 0, n = esgst.features.length; i < n; ++i) {
        var feature = esgst.features[i];
        if (feature.type && ((feature.type === `trades` && esgst.settings.esgst_st) || feature.type !== `trades`)) {
            var ft = getSMFeature(feature, sections[feature.type].index);
            if (ft) {
                sections[feature.type].section.lastElementChild.appendChild(ft);
                ++sections[feature.type].index;
            }
        }
    }
    SMMenu.insertAdjacentHTML(`beforeEnd`,
        createSMSections(++j, [{
            Title: `Sync`,
            HTML: `
                ${SMSyncFrequency}
                <div class="esgst-description">Select from how many days to how many days you want the automatic sync to run (0 to disable it).</div>
                <div class="esgst-form-sync">
                    <div class="esgst-form-sync-data">
                        <div class="esgst-notification esgst-notification-warning esgst-last-sync">
                            <i class="fa fa-question-circle"></i> Never synced.
                        </div>
                    </div>
                    <div class="form__sync-default esgst-sync">
                        <i class="fa fa-refresh"></i> Sync
                    </div>
                </div>
            `
        }, {
            Title: `Steam API Key`,
            HTML: `
                <input class="esgst-steam-api-key" type="text"/>
                <div class="esgst-description">This is optional for syncing owned games faster and required for syncing alt accounts. Get a Steam API Key <a class="esgst-bold" href="https://steamcommunity.com/dev/apikey" target="_blank">here</a>.</div>
            `
        }]));
    SMManageFilteredUsers = Container.getElementsByClassName(`SMManageFilteredUsers`)[0];
    var SMManageFilteredGiveaways = Container.getElementsByClassName(`SMManageFilteredGiveaways`)[0];
    var SMManageFilteredDiscussions = Container.getElementsByClassName(`SMManageFilteredDiscussions`)[0];
    var SMManageEntriesTracker = Container.getElementsByClassName(`SMManageEntriesTracker`)[0];
    var SMManageUserTags = Container.getElementsByClassName(`SMManageUserTags`)[0];
    var SMManageGameTags = Container.getElementsByClassName(`SMManageGameTags`)[0];
    SMSyncFrequency = Container.getElementsByClassName(`esgst-sync-frequency`)[0];
    if (esgst.wbc) {
        addWBCButton(null, Container.getElementsByClassName(`esgst-wbc-button`)[0]);
    }
    var SMNAMWCButton = Container.getElementsByClassName(`esgst-namwc-button`)[0];
    if (esgst.namwc) {
        setNAMWCPopup(SMNAMWCButton, null, true);
    }
    SMLastSync = Container.getElementsByClassName(`esgst-last-sync`)[0];
    var SMSync = Container.getElementsByClassName(`esgst-sync`)[0];
    SMAPIKey = Container.getElementsByClassName(`esgst-steam-api-key`)[0];
    SMSyncFrequency.selectedIndex = esgst.syncFrequency;
    LastSync = esgst.lastSync;
    if (LastSync) {
        SMLastSync.classList.remove(`esgst-notification-warning`);
        SMLastSync.classList.add(`esgst-notification-success`);
        SMLastSync.innerHTML = `<i class="fa fa-check-circle"></i> Last synced ${new Date(LastSync).toLocaleString()}.`;
    }
    SMSync.addEventListener(`click`, function () {
        SMSync.classList.add(`esgst-busy`);
        checkSync(true, function (CurrentDate) {
            SMSync.classList.remove(`esgst-busy`);
            if (CurrentDate) {
                SMLastSync.classList.remove(`esgst-notification-warning`);
                SMLastSync.classList.add(`esgst-notification-success`);
                SMLastSync.innerHTML = `
                    <i class="fa fa-check-circle"></i> Last synced ${CurrentDate.toLocaleString()}.
                `;
            }
        });
    });
    key = esgst.steamApiKey;
    if (key) {
        SMAPIKey.value = key;
    }
    SMSyncFrequency.addEventListener(`change`, function () {
        setSetting(`syncFrequency`, SMSyncFrequency.selectedIndex);
    });
    heading.firstElementChild.addEventListener(`click`, loadDataManagement.bind(null, false, `import`));
    heading.firstElementChild.nextElementSibling.addEventListener(`click`, loadDataManagement.bind(null, false, `export`));
    heading.firstElementChild.nextElementSibling.nextElementSibling.addEventListener(`click`, loadDataManagement.bind(null, false, `delete`));
    if (SMManageUserTags) {
        SMManageUserTags.addEventListener(`click`, openManageUserTagsPopup);
    }
    if (SMManageGameTags) {
        SMManageGameTags.addEventListener(`click`, openManageGameTagsPopup);
    }
    if (SMManageFilteredUsers) {
        setSMManageFilteredUsers(SMManageFilteredUsers);
    }
    if (SMManageFilteredGiveaways) {
        setSMManageFilteredGiveaways(SMManageFilteredGiveaways);
    }
    if (SMManageFilteredDiscussions) {
        setSMManageFilteredDiscussions(SMManageFilteredDiscussions);
    }
    if (SMManageEntriesTracker) {
        setSMManageEntriesTracker(SMManageEntriesTracker);
    }
    SMAPIKey.addEventListener(`input`, function () {
        setSetting(`steamApiKey`, SMAPIKey.value);
    });
    if (!tab) {
        popup.open();
    }
}

function getSMFeature(Feature, aaa) {
    var Menu, Checkbox, CheckboxInput, SMFeatures;
    Menu = document.createElement(`div`);
    Menu.insertAdjacentHTML(`beforeEnd`, `
        <div class="esgst-sm-small-number esgst-form-heading-number">${aaa}.</div>
    `);
    var ID, localID, val, val1, val2;
    ID = Feature.id;
    var siwtchSg, siwtchSt;
    if (Feature.sg) {
        localID = `${ID}_sg`;
        val1 = esgst.settings[localID];
        if (typeof val1 === `undefined`) {
            val1 = false;
        }
        siwtchSg = new ToggleSwitch(Menu, ID, true, esgst.settings.esgst_st ? `[SG]` : ``, true, false, null, val1);
    }
    if (Feature.st && (esgst.settings.esgst_st || Feature.id === `esgst`)) {
        localID = `${ID}_st`;
        val2 = esgst.settings[localID];
        if (typeof val2 === `undefined`) {
            val2 = false;
        }
        siwtchSt = new ToggleSwitch(Menu, ID, true, `[ST]`, false, true, null, val2);
    }
    if (siwtchSg || siwtchSt) {
    val = val1 || val2;
    Menu.insertAdjacentHTML(`beforeEnd`, `
        <span>${esgst.settings.esgst_st ? `- ` : ``}${Feature.name}</span> ${Feature.features ? `<i class="fa fa-ellipsis-h" title="This option has sub-options"></i>` : ``} ${Feature.description ? `<i class="fa fa-question-circle esgst-clickable"></i>` : ``}
        <div class="esgst-form-row-indent SMFeatures esgst-hidden"></div>
    `);
    SMFeatures = Menu.lastElementChild;
    if (Feature.description) {
        var tool = SMFeatures.previousElementSibling;
        var popout;
        popout = new Popout(`esgst-feature-description markdown`, tool, 100);
        popout.popout.style.maxHeight = `300px`;
        popout.popout.style.overflow = `auto`;
        popout.popout.innerHTML = Feature.description;
    }
    if (Feature.features) {
        for (var i = 0, n = Feature.features.length; i < n; ++i) {
            var ft = getSMFeature(Feature.features[i], i + 1);
            if (ft) {
                SMFeatures.appendChild(ft);
            }
        }
        if (siwtchSg) {
            siwtchSg.dependencies.push(SMFeatures);
        }
        if (siwtchSt) {
            siwtchSt.dependencies.push(SMFeatures);
        }
        if (val) {
            SMFeatures.classList.remove(`esgst-hidden`);
        }
    }
    if (Feature.id === `gc`) {
        var elements = [];
        for (i = 0, n = esgst.gc_categories.length; i < n; ++i) {
            switch (esgst.gc_categories[i]) {
                case `gc_fcv`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-fullCV ${esgst.gc_fcv ? `` : `esgst-hidden`}" draggable="true" id="gc_fcv" title="Full CV">${esgst.gc_fcv_s ? (esgst.gc_fcv_s_i ? `<i class="fa fa-${esgst.gc_fcvIcon}"></i>` : `FCV`) : esgst.gc_fcvLabel}</div>
                    `);
                    break;
                case `gc_rcv`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-reducedCV ${esgst.gc_rcv ? `` : `esgst-hidden`}" draggable="true" id="gc_rcv" title="Reduced CV">${esgst.gc_rcv_s ? (esgst.gc_rcv_s_i ? `<i class="fa fa-${esgst.gc_rcvIcon}"></i>` : `RCV`) : esgst.gc_rcvLabel}</div>
                    `);
                    break;
                case `gc_ncv`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-noCV ${esgst.gc_ncv ? `` : `esgst-hidden`}" draggable="true" id="gc_ncv" title="No CV">${esgst.gc_ncv_s ? (esgst.gc_ncv_s_i ? `<i class="fa fa-${esgst.gc_ncvIcon}"></i>` : `NCV`) : esgst.gc_ncvLabel}</div>
                    `);
                    break;
                case `gc_h`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-hidden ${esgst.gc_h ? `` : `esgst-hidden`}" draggable="true" id="gc_h" title="Hidden">${esgst.gc_h_s ? (esgst.gc_h_s_i ? `<i class="fa fa-${esgst.gc_hIcon}"></i>` : `H`) : esgst.gc_hLabel}</div>
                    `);
                    break;
                case `gc_i`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-ignored ${esgst.gc_i ? `` : `esgst-hidden`}" draggable="true" id="gc_i" title="Ignored">${esgst.gc_i_s ? (esgst.gc_i_s_i ? `<i class="fa fa-${esgst.gc_iIcon}"></i>` : `I`) : esgst.gc_iLabel}</div>
                    `);
                    break;
                case `gc_o`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-owned ${esgst.gc_o ? `` : `esgst-hidden`}" draggable="true" id="gc_o" title="Owned">${esgst.gc_o_s ? (esgst.gc_o_s_i ? `<i class="fa fa-${esgst.gc_oIcon}"></i>` : `O`) : esgst.gc_oLabel}</div>
                    `);
                    esgst.gc_o_altAccounts.forEach(account => {
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-owned ${esgst.gc_o ? `` : `esgst-hidden`}" draggable="true" id="gc_o" style="background-color: ${account.bgColor} !important; color: ${account.color} !important;" title="Owned by ${account.name}">${esgst.gc_o_s ? (esgst.gc_o_s_i ? `<i class="fa fa-${account.icon}"></i>` : `O`) : account.label}</div>
                        `);
                    });
                    break;
                case `gc_w`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-wishlisted ${esgst.gc_w ? `` : `esgst-hidden`}" draggable="true" id="gc_w" title="Wishlisted">${esgst.gc_w_s ? (esgst.gc_w_s_i ? `<i class="fa fa-${esgst.gc_wIcon}"></i>` : `W`) : esgst.gc_wLabel}</div>
                    `);
                    break;
                case `gc_gi`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-giveawayInfo ${esgst.gc_gi ? `` : `esgst-hidden`}" draggable="true" id="gc_gi" title="Giveaway Info"><i class="fa fa-info"></i> 0 <i class="fa fa-dollar"></i> 0</div>
                    `);
                    break;
                case `gc_r`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-rating esgst-gc-rating-positive ${esgst.gc_r ? `` : `esgst-hidden`}" draggable="true" id="gc_r" title="Rating"><i class="fa fa-thumbs-up"></i>${esgst.gc_r_s ? ` 0% (0)` : ``}</div>
                    `);
                    break;
                case `gc_a`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-achievements ${esgst.gc_a ? `` : `esgst-hidden`}" draggable="true" id="gc_a" title="Achievements">${esgst.gc_a_s ? (esgst.gc_a_s_i ? `<i class="fa fa-${esgst.gc_aIcon}"></i>` : `A`) : esgst.gc_aLabel}</div>
                    `);
                    break;
                case `gc_mp`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-multiplayer ${esgst.gc_mp ? `` : `esgst-hidden`}" draggable="true" id="gc_mp" title="Multiplayer">${esgst.gc_mp_s ? (esgst.gc_mp_s_i ? `<i class="fa fa-${esgst.gc_mpIcon}"></i>` : `MP`) : esgst.gc_mpLabel}</div>
                    `);
                    break;
                case `gc_sc`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-steamCloud ${esgst.gc_sc ? `` : `esgst-hidden`}" draggable="true" id="gc_sc" title="Steam Cloud">${esgst.gc_sc_s ? (esgst.gc_sc_s_i ? `<i class="fa fa-${esgst.gc_scIcon}"></i>` : `SC`) : esgst.gc_scLabel}</div>
                    `);
                    break;
                case `gc_tc`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-tradingCards ${esgst.gc_tc ? `` : `esgst-hidden`}" draggable="true" id="gc_tc" title="Trading Cards">${esgst.gc_tc_s ? (esgst.gc_tc_s_i ? `<i class="fa fa-${esgst.gc_tcIcon}"></i>` : `TC`) : esgst.gc_tcLabel}</div>
                    `);
                    break;
                case `gc_l`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-linux ${esgst.gc_l ? `` : `esgst-hidden`}" draggable="true" id="gc_l" title="Linux">${esgst.gc_l_s ? (esgst.gc_l_s_i ? `<i class="fa fa-${esgst.gc_lIcon}"></i>` : `L`) : esgst.gc_lLabel}</div>
                    `);
                    break;
                case `gc_m`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-mac ${esgst.gc_m ? `` : `esgst-hidden`}" draggable="true" id="gc_m" title="Mac">${esgst.gc_m_s ? (esgst.gc_m_s_i ? `<i class="fa fa-${esgst.gc_mIcon}"></i>` : `M`) : esgst.gc_mLabel}</div>
                    `);
                    break;
                case `gc_dlc`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-dlc ${esgst.gc_dlc ? `` : `esgst-hidden`}" draggable="true" id="gc_dlc" title="DLC">${esgst.gc_dlc_s ? (esgst.gc_dlc_s_i ? `<i class="fa fa-${esgst.gc_dlcIcon}"></i>` : `DLC`) : esgst.gc_dlcLabel}</div>
                    `);
                    break;
                case `gc_p`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-package ${esgst.gc_p ? `` : `esgst-hidden`}" draggable="true" id="gc_p" title="Package">${esgst.gc_p_s ? (esgst.gc_p_s_i ? `<i class="fa fa-${esgst.gc_pIcon}"></i>` : `P`) : esgst.gc_pLabel}</div>
                    `);
                    break;
                case `gc_ea`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-earlyAccess ${esgst.gc_ea ? `` : `esgst-hidden`}" draggable="true" id="gc_ea" title="Early Access">${esgst.gc_ea_s ? (esgst.gc_ea_s_i ? `<i class="fa fa-${esgst.gc_eaIcon}"></i>` : `EA`) : esgst.gc_eaLabel}</div>
                    `);
                    break;
                case `gc_rm`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-removed ${esgst.gc_rm ? `` : `esgst-hidden`}" draggable="true" id="gc_rm" title="Removed">${esgst.gc_rm_s ? (esgst.gc_rm_s_i ? `<i class="fa fa-${esgst.gc_rmIcon}"></i>` : `RM`) : esgst.gc_rmLabel}</div>
                    `);
                    break;
                case `gc_g`:
                    elements.push(`
                        <div class="esgst-clickable esgst-gc esgst-gc-genres ${esgst.gc_g ? `` : `esgst-hidden`}" draggable="true" id="gc_g" title="Genres">Genres</div>
                    `);
                    break;
            }
        }
        var panel = insertHtml(SMFeatures, `beforeEnd`, `
            <div class="esgst-description">Drag the categories to sort them.</div>
            <div class="esgst-gc-panel">${elements.join(``)}</div>
        `);
        var sm = {
            panel: panel
        };
        for (i = 0, n = panel.children.length; i < n; ++i) {
            var child = panel.children[i];
            child.addEventListener(`dragstart`, setSmSource.bind(null, child, sm));
            child.addEventListener(`dragenter`, getSmSource.bind(null, child, sm));
            child.addEventListener(`dragend`, saveSmSource.bind(null, sm));
        }
    } else if (Feature.id === `gwc`) {
        addGwcrMenuPanel(SMFeatures, `gwc_colors`, `chance`);
    } else if (Feature.id === `gwr`) {
        addGwcrMenuPanel(SMFeatures, `gwr_colors`, `ratio`);
    } else if (Feature.colors) {
        var color = esgst[`${Feature.id}_color`];
        var bgColor = esgst[`${Feature.id}_bgColor`];
        var html = `
            <div class="esgst-sm-colors">
                Text: <input type="color" value="${color}">
                Background: <input type="color" value="${bgColor}">
                <div class="form__saving-button esgst-sm-colors-default">Use Default</div>
            </div>
        `;
        SMFeatures.insertAdjacentHTML(`beforeEnd`, html);
        var colorContext = SMFeatures.lastElementChild.firstElementChild;
        var bgColorContext = colorContext.nextElementSibling;
        addColorObserver(colorContext, Feature.id, `color`);
        addColorObserver(bgColorContext, Feature.id, `bgColor`);
        bgColorContext.nextElementSibling.addEventListener(`click`, function () {
            colorContext.value = esgst.defaultValues[`${Feature.id}_color`];
            setSetting(`${Feature.id}_color`, colorContext.value);
            bgColorContext.value = esgst.defaultValues[`${Feature.id}_bgColor`];
            setSetting(`${Feature.id}_bgColor`, bgColorContext.value);
        });
        if (Feature.id === `gc_g`) {
            addGcMenuPanel(SMFeatures);
        } else if (Feature.id === `gc_o`) {
            addGcAltMenuPanel(SMFeatures);
        }
        if (Feature.input) {
            input = insertHtml(SMFeatures, `beforeEnd`, `
                <div class="esgst-sm-colors">
                    Icon: <input type="text" value="${esgst[`${Feature.id}Icon`]}"> <i class="esgst-clickable fa fa-question-circle"></i>
                    <br/>
                    Label: <input type="text" value="${esgst[`${Feature.id}Label`]}">
                </div>
            `);
            createTooltip(input.firstElementChild.nextElementSibling, `The name of the icon must be any name in this page: <a href="http://fontawesome.io/icons/">http://fontawesome.io/icons/</a> (except for the 41 new icons from 4.7, SG doesn't support that)`);
            input.firstElementChild.addEventListener(`change`, function() {
                setSetting(`${Feature.id}Icon`, input.firstElementChild.value);
                esgst[`${Feature.id}Icon`] = input.firstElementChild.value;
            });
            input.lastElementChild.addEventListener(`change`, function() {
                setSetting(`${Feature.id}Label`, input.lastElementChild.value);
                esgst[`${Feature.id}Label`] = input.lastElementChild.value;
            });
        }
        if (siwtchSg) {
            siwtchSg.dependencies.push(SMFeatures);
        }
        if (siwtchSt) {
            siwtchSt.dependencies.push(SMFeatures);
        }
        if (val) {
            SMFeatures.classList.remove(`esgst-hidden`);
        }
    } else if (Feature.input) {
        var input, prev, next;
        if (Feature.id === `npth`) {
            input = insertHtml(SMFeatures, `beforeEnd`, `
                <div class="esgst-sm-colors">
                    Enter the key you want to use for previous links: <input type="text" value=${esgst.npth_previousKey}>
                    <br/>
                    Enter the key you want to use for next links: <input type="text" value=${esgst.npth_nextKey}>
                </div>
            `);
            prev = input.firstElementChild;
            next = input.lastElementChild;
            prev.addEventListener(`keydown`, function (e) {
                e.preventDefault();
                setSetting(`npth_previousKey`, e.key);
                esgst.npth_previousKey = e.key;
                prev.value = e.key;
            });
            next.addEventListener(`keydown`, function (e) {
                e.preventDefault();
                setSetting(`npth_nextKey`, e.key);
                esgst.npth_nextKey = e.key;
                next.value = e.key;
            });
        } else if (Feature.id.match(/^sk_/)) {
            setSkMenu(Feature.input, insertHtml(SMFeatures, `beforeEnd`, `
                <div class="esgst-sm-colors"></div>`
            ));
        } else if (Feature.id === `gb_h`) {
            var hours = esgst.gb_hours;
            input = insertHtml(SMFeatures, `beforeEnd`, `
                <div class="esgst-sm-colors">
                    Time range to trigger highlight: <input type="text" value=${hours}> hours
                </div>
            `);
            input.firstElementChild.addEventListener(`change`, function() {
                setSetting(`gb_hours`, input.firstElementChild.value);
                esgst.gb_hours = input.firstElementChild.value;
            });
        } else if (Feature.id === `hr`) {
            input = insertHtml(SMFeatures, `beforeEnd`, `
                <div class="esgst-sm-colors">
                    Refresh every <input type="text" value=${esgst.hr_minutes}> minutes
                </div>
            `);
            input.firstElementChild.addEventListener(`change`, function() {
                setSetting(`hr_minutes`, input.firstElementChild.value);
                esgst.hr_minutes = input.firstElementChild.value;
            });
        } else if (Feature.id === `elgb_f`) {
            input = insertHtml(SMFeatures, `beforeEnd`, `
                <div class="esgst-sm-colors">
                    Filters: <input style="width: 300px;" type="text" value="${esgst.elgb_filters}"> <i class="fa fa-question-circle" title="Enter only lowercase letters with no spaces and separate filters with '|'.\n\nFor example, if you want to filter out 'Good luck! No need to thank, unless you're the winner.', use the filter 'goodlucknoneedtothankunlessyourethewinner'.\n\nIf you're familiar with regular expressions, you can also use them. For example, to include a variation of the description above that uses 'you are' instead of 'you're' you could use the filter 'goodlucknoneedtothankunlessyoua?rethewinner'. 'a?' will match or not an 'a' between 'you' and 're'.\n\nThe '.' filter, for example, filters out any descriptions that only have one letter."></i>
                </div>
            `);
            input.firstElementChild.addEventListener(`change`, function() {
                setSetting(`elgb_filters`, input.firstElementChild.value);
                esgst.elgb_filters = input.firstElementChild.value;
            });
        }
        if (siwtchSg) {
            siwtchSg.dependencies.push(SMFeatures);
        }
        if (siwtchSt) {
            siwtchSt.dependencies.push(SMFeatures);
        }
        if (val) {
            SMFeatures.classList.remove(`esgst-hidden`);
        }
    } else if (Feature.options) {
        var index = esgst[`${Feature.id}_index`];
        var options = ``;
        for (var j = 0, jj = Feature.options.values.length; j < jj; ++j) {
            options += `<option>${Feature.options.values[j]}</option>`;
        }
        var select = insertHtml(SMFeatures, `beforeEnd`, `
            <div class="esgst-sm-colors">
                ${Feature.options.title}
                <select>
                    ${options}
                </select>
            </div>
        `);
        select.firstElementChild.selectedIndex = index;
        select.firstElementChild.addEventListener(`change`, function() {
            setSetting(`${Feature.id}_index`, select.firstElementChild.selectedIndex);
            esgst[`${Feature.id}_index`] = select.firstElementChild.selectedIndex;
        });
        if (siwtchSg) {
            siwtchSg.dependencies.push(SMFeatures);
        }
        if (siwtchSt) {
            siwtchSt.dependencies.push(SMFeatures);
        }
        if (val) {
            SMFeatures.classList.remove(`esgst-hidden`);
        }
    }
    return Menu;
    } else {
        Menu.lastElementChild.remove();
        return null;
    }
}

function setSkMenu(id, input) {
    let value, context = insertHtml(input, `beforeEnd`, `
        Enter the key you want to use for this task: <input type="text" value="${esgst[id]}">
    `);
    context.addEventListener(`keydown`, event => {
        event.preventDefault();
        event.stopPropagation();
        if (!event.repeat) {
            value = ``;
            if (event.ctrlKey) {
                value += `ctrlKey + `;
            } else if (event.shiftKey) {
                value += `shiftKey + `;
            } else if (event.altKey) {
                value += `altKey + `;
            }
            value += event.key.toLowerCase();
        }
    }, true);
    context.addEventListener(`keyup`, event => {
        setSetting(id, value);
        esgst[id] = value;
        event.currentTarget.value = value;
    });
}

function setSmSource(child, sm) {
    sm.source = child;
}

function getSmSource(child, sm) {
    var categories, current, i, n;
    current = sm.source;
    do {
        current = current.previousElementSibling;
        if (current && current === child) {
            sm.panel.insertBefore(sm.source, child);
            return;
        }
    } while (current);
    sm.panel.insertBefore(sm.source, child.nextElementSibling);
}

function saveSmSource(sm) {
    var categories, i, n;
    categories = [];
    for (i = 0, n = sm.panel.children.length; i < n; ++i) {
        categories.push(sm.panel.children[i].id);
    }
    setSetting(`gc_categories`, categories);
}

function addGwcrMenuPanel(context, id, key) {
    var button, colors, i, n, panel;
    panel = insertHtml(context, `beforeEnd`, `
        <div class="esgst-sm-colors">
            <div class="form__saving-button esgst-sm-colors-default">
                <span>Add Color Setting</span>
            </div>
            <i class="fa fa-question-circle" title="Allows you to set different colors for different ${key} ranges."></i>
        </div>
    `);
    button = panel.firstElementChild;
    for (i = 0, n = esgst[id].length; i < n; ++i) {
        addGwcColorSetting(esgst[id][i], id, key, panel);
    }
    button.addEventListener(`click`, function () {
        colors = {
            color: `#ffffff`,
            lower: `0`,
            upper: `100`
        };
        esgst[id].push(colors);
        addGwcColorSetting(colors, id, key, panel);
    });
}

function addGwcColorSetting(colors, id, key, panel) {
    var color, i, lower, n, remove, setting, upper;
    setting = insertHtml(panel, `beforeEnd`, `
        <div>
            From <input step="0.01" type="number" value="${colors.lower}"/> to <input step="0.01" type="number" value="${colors.upper}"/> ${key}, color it as <input type="color" value="${colors.color}"/>. <i class="esgst-clickable fa fa-times" title="Delete this setting."></i>
        </div>
    `);
    lower = setting.firstElementChild;
    upper = lower.nextElementSibling;
    color = upper.nextElementSibling;
    remove = color.nextElementSibling;
    lower.addEventListener(`change`, function () {
        colors.lower = lower.value;
        setSetting(id, esgst[id]);
    });
    upper.addEventListener(`change`, function () {
        colors.upper = upper.value;
        setSetting(id, esgst[id]);
    });
    color.addEventListener(`change`, function () {
        colors.color = color.value;
        setSetting(id, esgst[id]);
    });
    remove.addEventListener(`click`, function () {
        if (confirm(`Are you sure you want to delete this setting?`)) {
            for (i = 0, n = esgst[id].length; i < n && esgst[id][i] !== colors; ++i);
            if (i < n) {
                esgst[id].splice(i, 1);
                setSetting(id, esgst[id]);
                setting.remove();
            }
        }
    });
}

function addGcMenuPanel(context) {
    var button, colorSetting, i, n, panel;
    panel = insertHtml(context, `beforeEnd`, `
        <div class="esgst-sm-colors">
            <div class="form__saving-button esgst-sm-colors-default">
                <span>Add Custom Genre Color</span>
            </div>
            <i class="fa fa-question-circle" title="Allows you to color genres (colored genres will appear at the beginning of the list)."></i>
        </div>
    `);
    button = panel.firstElementChild;
    for (i = 0, n = esgst.gc_g_colors.length; i < n; ++i) {
        addGcColorSetting(esgst.gc_g_colors[i], panel);
    }
    button.addEventListener(`click`, function () {
        colorSetting = {
            color: `#ffffff`,
            genre: ``
        };
        esgst.gc_g_colors.push(colorSetting);
        addGcColorSetting(colorSetting, panel);
    });
}

function addGcColorSetting(colorSetting, panel) {
    var color, genre, i, n, remove, setting;
    setting = insertHtml(panel, `beforeEnd`, `
        <div>
            For genre <input type="text" value="${colorSetting.genre}"/>, color it as <input type="color" value="${colorSetting.color}"/>. <i class="esgst-clickable fa fa-times" title="Delete this setting."></i>
        </div>
    `);
    genre = setting.firstElementChild;
    color = genre.nextElementSibling;
    remove = color.nextElementSibling;
    genre.addEventListener(`change`, function () {
        colorSetting.genre = genre.value;
        setSetting(`gc_g_colors`, esgst.gc_g_colors);
    });
    color.addEventListener(`change`, function () {
        colorSetting.color = color.value;
        setSetting(`gc_g_colors`, esgst.gc_g_colors);
    });
    remove.addEventListener(`click`, function () {
        if (confirm(`Are you sure you want to delete this setting?`)) {
            for (i = 0, n = esgst.gc_g_colors.length; i < n && esgst.gc_g_colors[i] !== colorSetting; ++i);
            if (i < n) {
                esgst.gc_g_colors.splice(i, 1);
                setSetting(`gc_g_colors`, esgst.gc_g_colors);
                setting.remove();
            }
        }
    });
}

function addGcAltMenuPanel(context) {
    var altSetting, button, i, n, panel;
    panel = insertHtml(context, `beforeEnd`, `
        <div class="esgst-sm-colors">
            <div class="form__saving-button esgst-sm-colors-default">
                <span>Add Alt Account</span>
            </div>
        </div>
    `);
    button = panel.firstElementChild;
    createTooltip(insertHtml(panel, `beforeEnd`, `<i class="fa fa-question-circle"></i>`), `
        <div>You must sync your owned games normally for the script to pick up the games owned by your alt accounts. Syncing with alt accounts only works with a Steam API Key though, so make sure one is set at the last section of this menu.</div>
        <br/>
        <div>Steam ID is the number that comes after "steamcommunity.com/profiles/" in your alt account's URL. If your alt account has a URL in the format "steamcommunity.com/id/" though, you can get your Steam ID <a href="https://steamid.io/">here</a> by entering your URL in the input (you want the steamID64 one).</div>
        <br/>
        <div>You must fill the fields relative to your settings. For example, if you have simplified version enabled with icons, you must fill the "icon" field. If you don't have simplified version enabled, you must fill the "label" field. The current text in the fields are simply placeholders.</div>
    `);
    for (i = 0, n = esgst.gc_o_altAccounts.length; i < n; ++i) {
        addGcAltSetting(esgst.gc_o_altAccounts[i], panel);
    }
    button.addEventListener(`click`, function () {
        altSetting = {
            bgColor: `#000000`,
            color: `#ffffff`,
            games: {
                apps: {},
                subs: {}
            },
            icon: ``,
            label: ``,
            name: ``,
            steamId: ``
        };
        esgst.gc_o_altAccounts.push(altSetting);
        addGcAltSetting(altSetting, panel);
    });
}

function addGcAltSetting(altSetting, panel) {
    var color, bgColor, i, icon, label, n, name, remove, setting, steamId;
    setting = insertHtml(panel, `beforeEnd`, `
        <div>
            For account with Steam ID <input placeholder="0000000000000000" type="text" value="${altSetting.steamId}"/>, using the nickname <input placeholder="alt1" type="text" value="${altSetting.name}"/>, <br/>color it as <input type="color" value="${altSetting.color}"/> with background <input type="color" value="${altSetting.bgColor}"/>, icon <input placeholder="folder" type="text" value="${altSetting.icon}"/> and label <input placeholder="Owned by alt1" type="text" value="${altSetting.label}"/>. <i class="esgst-clickable fa fa-times" title="Delete this setting."></i>
        </div>
    `);
    steamId = setting.firstElementChild;
    name = steamId.nextElementSibling;
    color = name.nextElementSibling.nextElementSibling;
    bgColor = color.nextElementSibling;
    icon = bgColor.nextElementSibling;
    label = icon.nextElementSibling;
    remove = label.nextElementSibling;
    steamId.addEventListener(`change`, function () {
        altSetting.steamId = steamId.value;
        setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
    });
    name.addEventListener(`change`, function () {
        altSetting.name = name.value;
        setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
    });
    color.addEventListener(`change`, function () {
        altSetting.color = color.value;
        setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
    });
    bgColor.addEventListener(`change`, function () {
        altSetting.bgColor = bgColor.value;
        setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
    });
    icon.addEventListener(`change`, function () {
        altSetting.icon = icon.value;
        setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
    });
    label.addEventListener(`change`, function () {
        altSetting.label = label.value;
        setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
    });
    remove.addEventListener(`click`, function () {
        if (confirm(`Are you sure you want to delete this setting?`)) {
            for (i = 0, n = esgst.gc_o_altAccounts.length; i < n && esgst.gc_o_altAccounts[i] !== altSetting; ++i);
            if (i < n) {
                esgst.gc_o_altAccounts.splice(i, 1);
                setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
                setting.remove();
            }
        }
    });
}

function addColorObserver(context, id, key) {
    context.addEventListener(`change`, function () {
        setSetting(`${id}_${key}`, context.value);
    });
}

function createSMSections(J, Sections) {
    var SectionsHTML, I, N;
    SectionsHTML = ``;
    for (I = 0, N = Sections.length; I < N; ++I) {
        SectionsHTML += `
            <div class="esgst-form-row">
                <div class="esgst-form-heading">
                    <div class="esgst-form-heading-number">${J}.</div>
                    <div class="esgst-form-heading-text">${Sections[I].Title}</div>
                </div>
                <div class="esgst-form-row-indent${Sections[I].Name ? ` ${Sections[I].Name}` : ``}">${Sections[I].HTML ? Sections[I].HTML : ``}</div>
            </div>
        `;
        ++J;
    }
    return SectionsHTML;
}

function createSMButtons(Heading, Items) {
    var I, N, Item, Icons, J, NumIcons;
    for (I = 0, N = Items.length; I < N; ++I) {
        Item = Items[I];
        if (Item.Check) {
            Icons = ``;
            for (J = 0, NumIcons = Item.Icons.length; J < NumIcons; ++J) {
                Icons += `<i class="fa ${Item.Icons[J]}"></i> `;
            }
            Heading.insertAdjacentHTML(`beforeEnd`, `<a class="${Item.Name}" title="${Item.Title}">${Icons}</a>`);
        }
    }
}

function setSMManageFilteredUsers(SMManageFilteredUsers) {
        var popup;
    SMManageFilteredUsers.addEventListener(`click`, function() {
        if (!popup) {
            popup = new Popup(`fa-eye-slash`, `Filtered Users`);
        var users = JSON.parse(getValue(`users`));
        var filtered = [];
        for (var key in users.users) {
            if (users.users[key].uf && (users.users[key].uf.posts || users.users[key].uf.giveaways || users.users[key].uf.discussions)) {
                filtered.push(users.users[key]);
            }
        }
        filtered.sort(function(a, b) {
            if (a.username > b.username) {
                return -1;
            } else {
                return 1;
            }
        });
        var table = insertHtml(popup.scrollable, `beforeEnd`, `
            <div class="table">
                <div class="table__heading">
                    <div class="table__column--width-fill">Username</div>
                    <div class="table__column--width-small">Posts Hidden</div>
                    <div class="table__column--width-small">Discussions Hidden</div>
                    <div class="table__column--width-small">Giveaways Hidden</div>
                </div>
                <div class="table__rows"></div>
            </div>
        `);
        for (var i = 0, n = filtered.length; i < n; ++i) {
            var postsIcon = filtered[i].uf.posts ? `<i class="fa fa-check"></i>` : ``;
            var discussionsIcon = filtered[i].uf.discussions ? `<i class="fa fa-check"></i>` : ``;
            var giveawaysIcon = filtered[i].uf.giveaways ? `<i class="fa fa-check"></i>` : ``;
            table.lastElementChild.insertAdjacentHTML(`beforeEnd`, `
                <div class="table__row-outer-wrap">
                    <div class="table__row-inner-wrap">
                        <div class="table__column--width-fill"><a href="/user/${filtered[i].username}">${filtered[i].username}</a></div>
                        <div class="table__column--width-small">${postsIcon}</div>
                        <div class="table__column--width-small">${discussionsIcon}</div>
                        <div class="table__column--width-small">${giveawaysIcon}</div>
                    </div>
                </div>
            `);
        }
        }
        popup.open();
    });
}

function setSMManageFilteredDiscussions(SMManageFilteredDiscussions) {
    var discussions, hidden, i, popup, set;
    SMManageFilteredDiscussions.addEventListener(`click`, function() {
        popup = new Popup(`fa-comments`, `Hidden Discussions`);
        popup.discussions = insertHtml(popup.scrollable, `afterBegin`, `
            <div class="table esgst-text-left">
                <div class="table__heading">
                    <div class="table__column--width-fill">Summary</div>
                    <div class="table__column--width-small text-center">Comments</div>
                </div>
            </div>
        `);
        discussions = JSON.parse(getValue(`discussions`));
        hidden = [];
        for (key in discussions) {
            if (discussions[key].hidden) {
                hidden.push(key);
            }
        }
        i = 0;
        set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load more...`, `Loading more...`, function (callback) {
            getDfDiscussions(hidden, i, i, i + 5, popup, function (value) {
                i = value;
                if (i > hidden.length) {
                    set.set.remove();
                } else if (esgst.es_df && popup.scrollable.scrollHeight <= popup.scrollable.offsetHeight) {
                    set.trigger();
                }
                callback();
            });
        });
        popup.description.appendChild(set.set);
        popup.open();
        set.trigger();
        if (esgst.es_df) {
            popup.scrollable.addEventListener(`scroll`, function () {
                if ((popup.scrollable.scrollTop + popup.scrollable.offsetHeight) >= popup.scrollable.scrollHeight && !set.busy) {
                    set.trigger();
                }
            });
        }
    });
}

function getDfDiscussions(hidden, i, j, n, popup, callback) {
    var key;
    if (i < n) {
        if (hidden[i]) {
            request(null, null, false, `/discussion/${hidden[i]}/`, function(response) {
                var breadcrumbs, categoryLink, context, usernameLink;
                context = DOM.parse(response.responseText);
                breadcrumbs = context.getElementsByClassName(`page__heading__breadcrumbs`);
                categoryLink = breadcrumbs[0].firstElementChild.nextElementSibling.nextElementSibling;
                usernameLink = context.getElementsByClassName(`comment__username`)[0].firstElementChild;
                popup.discussions.insertAdjacentHTML(`beforeEnd`, `
                    <div>
                        <div class="table__row-outer-wrap">
                            <div class="table__row-inner-wrap">
                                <div>
                                    ${context.getElementsByClassName(`global__image-outer-wrap`)[0].outerHTML}
                                </div>
                                <div class="table__column--width-fill">
                                    <h3>
                                        <a class="table__column__heading" href="/discussion/${hidden[i]}/">${categoryLink.nextElementSibling.nextElementSibling.firstElementChild.textContent}</a>
                                    </h3>
                                    <p>
                                        <a class="table__column__secondary-link" href="${categoryLink.getAttribute(`href`)}">${categoryLink.textContent}</a> -
                                        ${context.querySelector(`.comment [data-timestamp]`).outerHTML} ago by
                                        <a class="table__column__secondary-link" href="${usernameLink.getAttribute(`href`)}">${usernameLink.textContent}</a>
                                    </p>
                                </div>
                                <div class="table__column--width-small text-center">
                                    <a class="table__column__secondary-link" href="/discussion/${hidden[i]}/">${breadcrumbs[1].textContent.match(/(.+) Comments/)[1]}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                `);
                loadEndlessFeatures(popup.discussions.lastElementChild);
                if (!esgst.giveawaysPath && !esgst.discussionsPath) {
                    if (esgst.gdttt) {
                        addCtDiscussionPanels(popup.discussions.lastElementChild, true);
                        checkGdtttVisited(popup.discussions.lastElementChild);
                    } else if (esgst.ct) {
                        addCtDiscussionPanels(popup.discussions.lastElementChild, true);
                    }
                    loadDiscussionFeatures(popup.discussions.lastElementChild);
                }
                popup.reposition();
                setTimeout(getDfDiscussions, 0, hidden, ++i, ++j, n, popup, callback);
            });
        } else {
            callback(j + 1);
        }
    } else {
        callback(j);
    }
}

function setSMManageFilteredGiveaways(SMManageFilteredGiveaways) {
    var gfGiveaways, giveaway, hidden, i, key, n, popup, set;
    SMManageFilteredGiveaways.addEventListener(`click`, function() {
        popup = new Popup(`fa-gift`, `Hidden Giveaways`, true);
        hidden = [];
        for (key in esgst.giveaways) {
            giveaway = esgst.giveaways[key];
            if (giveaway.hidden && giveaway.code && giveaway.endTime) {
                if (Date.now() >= giveaway.endTime) {
                    giveaway.hidden = false;
                } else {
                    hidden.push(giveaway.code);
                }
            } else {
                giveaway.hidden = false;
            }
        }
        setValue(`giveaways`, JSON.stringify(esgst.giveaways));
        i = 0;
        n = hidden.length;
        gfGiveaways = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left"></div>`);
        if (n > 0) {
            set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load more...`, `Loading more...`, function (callback) {
                loadGfGiveaways(i, i + 5, hidden, gfGiveaways, popup, function (value) {
                    i = value;
                    if (i > n) {
                        set.set.remove();
                    } else if (esgst.es_gf && popup.scrollable.scrollHeight <= popup.scrollable.offsetHeight) {
                        set.trigger();
                    }
                    callback();
                });
            });
            popup.description.appendChild(set.set);
            popup.open();
            set.trigger();
            if (esgst.es_gf) {
                popup.scrollable.addEventListener(`scroll`, function () {
                    if ((popup.scrollable.scrollTop + popup.scrollable.offsetHeight) >= popup.scrollable.scrollHeight && !set.busy) {
                        set.trigger();
                    }
                });
            }
        } else {
            gfGiveaways.textContent = `No hidden giveaways found.`;
            popup.open();
        }
    });
}

function loadGfGiveaways(i, n, hidden, gfGiveaways, popup, callback) {
    var giveaway;
    if (i < n) {
        if (hidden[i]) {
            request(null, null, true, `https://www.steamgifts.com/giveaway/${hidden[i]}/`, function (response) {
                giveaway = buildGiveaway(DOM.parse(response.responseText), response.finalUrl);
                if (giveaway) {
                    gfGiveaways.insertAdjacentHTML(`beforeEnd`, giveaway.html);
                    loadEndlessFeatures(gfGiveaways.lastElementChild, false, `gf`);
                    popup.reposition();
                    setTimeout(loadGfGiveaways, 0, ++i, n, hidden, gfGiveaways, popup, callback);
                } else {
                    setTimeout(loadGfGiveaways, 0, ++i, n, hidden, gfGiveaways, popup, callback);
                }
            });
        } else {
            callback(i + 1);
        }
    } else {
        callback(i);
    }
}

function getMonthDay(timestamp) {
    var date, month, months;
    date = new Date(timestamp);
    months = [`Jan`, `Feb`, `Mar`, `Apr`, `May`, `Jun`, `Jul`, `Aug`, `Sep`, `Oct`, `Nov`, `Dec`];
    month = months[date.getMonth()];
    return `${month} ${date.getDate()}`;
}

function setSMManageEntriesTracker(button) {
    var average, date, dates, entry, entries, history, historyHtml, i, key, keys, popup, table, tableHtml, total;
    button.addEventListener(`click`, function () {
        entries = JSON.parse(getValue(`entries`, `[]`));
        historyHtml = ``;
        dates = {};
        for (i = entries.length - 1; i >= 0; --i) {
            entry = entries[i];
            historyHtml += `
                <li>
                    ${entry.entry ? `Entered` : `Left`} <a href="/giveaway/${entry.code}/">${entry.name}</a> on ${getTimestamp(entry.timestamp / 1e3, esgst.at_24, esgst.at_s)}
                </li>
            `;
            date = getMonthDay(entry.timestamp);
            if (!dates[date]) {
                dates[date] = {
                    entered: 0,
                    left: 0
                };
            }
            if (entry.entry) {
                dates[date].entered += 1;
            } else {
                dates[date].left += 1;
            }
        }
        tableHtml = `
            <div class="esgst-text-left esgst-float-right table" style="padding-left: 5px; width: auto;">
                <div class="table__heading">
                    <div class="table__column--width-small">Date</div>
                    <div class="table__column--width-small">Entered</div>
                    <div class="table__column--width-small">Left</div>
                </div>
                <div class="table__rows">
        `;
        keys = Object.keys(dates);
        keys.sort();
        total = 0;
        for (i = keys.length - 1; i >= 0; --i) {
            key = keys[i];
            tableHtml += `
                <div class="table__row-outer-wrap">
                    <div class="table__row-inner-wrap">
                        <div class="table__column--width-small">${key}</div>
                        <div class="table__column--width-small">${dates[key].entered}</div>
                        <div class="table__column--width-small">${dates[key].left}</div>
                    </div>
                </div>
            `;
            total += dates[key].entered;
        }
        tableHtml += `
                </div>
            </div>
        `;
        average = Math.round(total / keys.length * 100) / 100;
        popup = new Popup(`fa-history`, `Entries Tracker`, true);
        popup.description.insertAdjacentHTML(`afterBegin`, `
            <div>
                You enter on average <span class="esgst-bold">${average}</span> giveaways per day.
            </div>
        `);
        history = insertHtml(popup.scrollable, `beforeEnd`, `
            <div class="esgst-text-left esgst-float-left markdown" style="border-right: 1px solid #ccc; padding-right: 5px;">
                <ul>${historyHtml}</ul>
            </div>
        `);
        table = insertHtml(popup.scrollable, `beforeEnd`, tableHtml);
        popup.scrollable.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-clear"></div>`);
        popup.open();
    });
}

function openManageUserTagsPopup() {
    var button, context, current, input, mt, popup, savedUser, savedUsers, toggleSwitch, users;
    popup = new Popup(`fa-tags`, `Manage user tags:`, true);
    input = insertHtml(popup.description, `afterBegin`, `<input type="text"/>`);
    popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-description">Type tags below to filter the users by.</div>`);
    button = insertHtml(popup.description, `afterBegin`, `
        <div class="esgst-page-heading">
            <div class="esgst-heading-button">
                <span></span>
                <span>
                    <i class="fa fa-user"></i>
                    <i class="fa fa-tags"></i>
                </span>
            </div>
        </div>
    `).firstElementChild;
    toggleSwitch = new ToggleSwitch(button.firstElementChild, null, true, ``);
    savedUsers = JSON.parse(getValue(`users`));
    current = {};
    users = {};
    for (steamId in savedUsers.users) {
        savedUser = savedUsers.users[steamId];
        if (savedUser.tags) {
            context = insertHtml(popup.scrollable, `beforeEnd`, `
                <div>
                    <a href="/user/${savedUser.username}">${savedUser.username}</a>
                </div>
            `);
            current[savedUser.username] = [context.firstElementChild];
            users[savedUser.username] = {
                context: context
            };
        }
    }
    loadEndlessFeatures(popup.scrollable);
    mt = {
        button: button,
        type: `user`
    };
    toggleSwitch.onEnabled = enableMt.bind(null, mt, current);
    toggleSwitch.onDisabled = disableMt.bind(null, mt);
    button.lastElementChild.addEventListener(`click`, openMtPopout.bind(null, mt));
    input.addEventListener(`input`, filterUserTags.bind(null, current, mt, popup, users));
    popup.open();
}

function filterUserTags(current, mt, popup, users, event) {
    var i, tags, username, userTags;
    if (event.currentTarget.value) {
        tags = event.currentTarget.value.replace(/,\s+/g, ``).split(/,\s/);
        for (username in users) {
            userTags = users[username].context.getElementsByClassName(`esgst-ut-tags`)[0];
            for (i = tags.length - 1; i >= 0 && !userTags.innerHTML.match(new RegExp(`>${tags[i]}<`)); --i);
            if (i < 0) {
                users[username].context.classList.add(`esgst-hidden`);
            } else {
                users[username].context.classList.remove(`esgst-hidden`);
            }
        }
    } else {
        for (username in users) {
            users[username].context.classList.remove(`esgst-hidden`);
        }
    }
    if (mt.popout) {
        disableMt(mt);
        enableMt(mt, current);
    }
    popup.reposition();
}

function openManageGameTagsPopup() {
    var button, context, current, games, input, mt, popup, savedGame, savedGames, toggleSwitch;
    popup = new Popup(`fa-tags`, `Manage game tags:`, true);
    input = insertHtml(popup.description, `afterBegin`, `<input type="text"/>`);
    popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-description">Type tags below to filter the games by.</div>`);
    button = insertHtml(popup.description, `afterBegin`, `
        <div class="esgst-page-heading">
            <div class="esgst-heading-button">
                <span></span>
                <span>
                    <i class="fa fa-gamepad"></i>
                    <i class="fa fa-tags"></i>
                </span>
            </div>
        </div>
    `).firstElementChild;
    toggleSwitch = new ToggleSwitch(button.firstElementChild, null, true, ``);
    savedGames = JSON.parse(getValue(`games`));
    current = {
        apps: {},
        subs: {}
    };
    games = {
        apps: {},
        subs: {}
    };
    for (id in savedGames.apps) {
        savedGame = savedGames.apps[id];
        if (savedGame.tags) {
            context = insertHtml(popup.scrollable, `beforeEnd`, `
                <div class="table__row-outer-wrap">
                    <a class="table__column__heading" href="http://store.steampowered.com/app/${id}">App - ${id}</a>
                </div>
            `);
            current.apps[id] = [{
                heading: context
            }];
            games.apps[id] = {
                context: context
            };
        }
    }
    for (id in savedGames.subs) {
        savedGame = savedGames.subs[id];
        if (savedGame.tags) {
            context = insertHtml(popup.scrollable, `beforeEnd`, `
                <div class="table__row-outer-wrap">
                    <a class="table__column__heading" href="http://store.steampowered.com/sub/${id}">Sub - ${id}</a>
                </div>
            `);
            current.subs[id] = [{
                heading: context
            }];
            games.subs[id] = {
                context: context
            };
        }
    }
    loadEndlessFeatures(popup.scrollable);
    mt = {
        button: button,
        type: `game`
    };
    toggleSwitch.onEnabled = enableMt.bind(null, mt, current);
    toggleSwitch.onDisabled = disableMt.bind(null, mt);
    button.lastElementChild.addEventListener(`click`, openMtPopout.bind(null, mt));
    input.addEventListener(`input`, filterGameTags.bind(null, current, games, mt, popup));
    popup.open();
}

function filterGameTags(current, games, mt, popup, event) {
    var gameTags, i, id, tags;
    if (event.currentTarget.value) {
        tags = event.currentTarget.value.replace(/,\s+/g, ``).split(/,\s/);
        for (id in games.apps) {
            gameTags = games.apps[id].context.getElementsByClassName(`esgst-gt-tags`)[0];
            for (i = tags.length - 1; i >= 0 && !gameTags.innerHTML.match(new RegExp(`>${tags[i]}<`)); --i);
            if (i < 0) {
                games.apps[id].context.classList.add(`esgst-hidden`);
            } else {
                games.apps[id].context.classList.remove(`esgst-hidden`);
            }
        }
        for (id in games.subs) {
            gameTags = games.subs[id].context.getElementsByClassName(`esgst-gt-tags`)[0];
            for (i = tags.length - 1; i >= 0 && !gameTags.innerHTML.match(new RegExp(`>${tags[i]}<`)); --i);
            if (i < 0) {
                games.subs[id].context.classList.add(`esgst-hidden`);
            } else {
                games.subs[id].context.classList.remove(`esgst-hidden`);
            }
        }
    } else {
        for (id in games.apps) {
            games.apps[id].context.classList.remove(`esgst-hidden`);
        }
        for (id in games.subs) {
            games.subs[id].context.classList.remove(`esgst-hidden`);
        }
    }
    if (mt.popout) {
        disableMt(mt);
        enableMt(mt, current);
    }
    popup.reposition();
}

function setSMRecentUsernameChanges(SMRecentUsernameChanges) {
    SMRecentUsernameChanges.addEventListener(`click`, function () {
        var popup, SMRecentUsernameChangesPopup;
        popup = new Popup(`fa-comments`, `Recent Username Changes`);
        popup.Progress = insertHtml(popup.description, `beforeEnd`, `
            <div>
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Loading recent username changes...</span>
            </div>
        `);
        popup.Results = insertHtml(popup.scrollable, `beforeEnd`, `
            <div class="esgst-uh-popup"></div>
        `);
        request(null, null, false, `https://script.google.com/macros/s/AKfycbzvOuHG913mRIXOsqHIeAuQUkLYyxTHOZim5n8iP-k80iza6g0/exec?Action=2`, function (Response) {
            var RecentChanges, HTML, I, N;
            popup.Progress.innerHTML = ``;
            RecentChanges = JSON.parse(Response.responseText).RecentChanges;
            HTML = ``;
            for (I = 0, N = RecentChanges.length; I < N; ++I) {
                HTML += `<div>${RecentChanges[I][0]} changed to <a class="esgst-bold" href="/user/${RecentChanges[I][1]}">${RecentChanges[I][1]}</a></div>`;
            }
            popup.Results.innerHTML = HTML;
            if (esgst.sg) {
                loadEndlessFeatures(popup.Results);
            }
            popup.reposition();
        });
        popup.open();
    });
}

function setSMCommentHistory(SMCommentHistory) {
    SMCommentHistory.addEventListener(`click`, function () {
        var comments, i, popup, set;
        popup = new Popup(`fa-comments`, `Comment History`);
        popup.commentHistory = insertHtml(popup.scrollable, `afterBegin`, `<div class="comments esgst-text-left"></div>`);
        comments = JSON.parse(getValue(`${esgst.name}CommentHistory`, `[]`));
        i = 0;
        set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load more...`, `Loading more...`, function (callback) {
            getChComments(comments, i, i + 5, popup, function (value) {
                i = value;
                if (i > comments.length) {
                    set.set.remove();
                } else if (esgst.es_ch && popup.scrollable.scrollHeight <= popup.scrollable.offsetHeight) {
                    set.trigger();
                }
                callback();
            });
        });
        popup.description.appendChild(set.set);
        popup.open();
        set.trigger();
        if (esgst.es_ch) {
            popup.scrollable.addEventListener(`scroll`, function () {
                if ((popup.scrollable.scrollTop + popup.scrollable.offsetHeight) >= popup.scrollable.scrollHeight && !set.busy) {
                    set.trigger();
                }
            });
        }
    });
}

function checkNewVersion() {
    if (esgst.version !== esgst.currentVersion) {
        if (esgst.showChangelog) {
            loadChangelog(esgst.version);
        }
        esgst.version = esgst.currentVersion;
        setValue(`version`, esgst.version);
    }
}

function startGiveawayFeatures() {
    if (esgst.gv || esgst.ochgb || esgst.ggl || esgst.gb || esgst.gwc || esgst.gwr || esgst.elgb || esgst.gwl || esgst.gf || esgst.uf) {
        esgst.endlessFeatures.push(loadGiveawayFeatures);
        loadGiveawayFeatures(document, true);
    }
}

function loadGiveawayFeatures(context, main, source, endless) {
    var giveaways, i, n, savedGiveaways;
    giveaways = getGiveaways(context, main, null, false, null, false, endless);
    if (main) {
        for (i = giveaways.length - 1; i > -1; --i) {
            giveaways[i].sortIndex = esgst.currentGiveaways.length;
            esgst.currentGiveaways.push(giveaways[i]);
        }
    }
    if (esgst.gwl && (((esgst.createdPath || esgst.enteredPath || esgst.wonPath || esgst.giveawayPath) && !main) || (!esgst.giveawayPath && !esgst.createdPath && !esgst.enteredPath && !esgst.wonPath))) {
        addGwlLinks(giveaways);
    }
    for (i = 0, n = esgst.giveawayFeatures.length; i < n; ++i) {
        esgst.giveawayFeatures[i](giveaways, main, source);
    }
    if (esgst.gas && esgst[esgst.gas.autoKey]) {
        sortContent(giveaways, esgst[esgst.gas.optionKey]);
    }
    if (esgst.gf && esgst.gf.filteredCount && esgst[`gf_enable${esgst.gf.type}`]) {
        filterGfGiveaways(esgst.gf, false, endless);
    }
    if (esgst.gfPopup && esgst.gfPopup.filteredCount && esgst.gf_enablePopup) {
        filterGfGiveaways(esgst.gfPopup);
    }
    if (main && esgst.createdPath && esgst.gm_enable) {
        enableGm();
    }
}

function getGiveaways(context, main, mainUrl, hr, key, ged, endless) {
    var games, giveaway, giveaways, i, mainContext, matches, n, query, savedUsers;
    games = JSON.parse(getValue(`games`));
    savedUsers = JSON.parse(getValue(`users`));
    giveaways = [];
    if (!hr && (esgst.createdPath || esgst.enteredPath || esgst.wonPath)) {
        query = `.giveaway__row-outer-wrap, .featured__outer-wrap--giveaway, .table:not(.table--summary) .table__row-outer-wrap`;
    } else {
        query = `.giveaway__row-outer-wrap, .featured__outer-wrap--giveaway`;
    }
    if (key) {
        mainContext = context;
    } else {
        if (mainUrl) {
            mainContext = context;
            key = `data`;
        } else {
            mainContext = document;
            key = `giveaway`;
        }
    }
    matches = context.querySelectorAll(query);
    for (i = matches.length - 1; i > -1; --i) {
        giveaway = getGiveawayInfo(matches[i], mainContext, games, savedUsers, null, null, main, mainUrl, ged, endless);
        if (giveaway) {
            giveaways.push(giveaway[key]);
        }
    }
    return giveaways;
}

function getGiveawayInfo(context, mainContext, games, savedUsers, ugd, ugdType, main, mainUrl, ged, endless) {
    var category, categories, chance, element, giveaway, i, id, info, key, keys, match, n, savedUser, uf, thinHeadings;
    giveaway = {};
    giveaway.outerWrap = context;
    giveaway.gameId = giveaway.outerWrap.getAttribute(`data-game-id`);
    info = getGameInfo(giveaway.outerWrap);
    if (info) {
        giveaway.id = info.id;
        giveaway.type = info.type;
        if (games && games[giveaway.type][giveaway.id]) {
            keys = [`owned`, `wishlisted`, `hidden`, `ignored`, `previouslyEntered`, `previouslyWon`, `reducedCV`, `noCV`];
            for (i = 0, n = keys.length; i < n; ++i) {
                key = keys[i];
                if (games[giveaway.type][giveaway.id][key === `previouslyEntered` ? `entered` : (key === `previouslyWon` ? `won` : key)]) {
                    giveaway[key] = true;
                }
            }
        }
    }
    if (giveaway.outerWrap.classList.contains(`table__row-outer-wrap`) && esgst.giveawayPath) {
        return;
    }
    giveaway.innerWrap = giveaway.outerWrap.querySelector(`.giveaway__row-inner-wrap, .featured__inner-wrap, .table__row-inner-wrap`);
    giveaway.avatar = giveaway.outerWrap.querySelector(`.giveaway_image_avatar, .featured_giveaway_image_avatar`);
    giveaway.image = giveaway.outerWrap.querySelector(`.giveaway_image_thumbnail, .giveaway_image_thumbnail_missing, .global__image-outer-wrap--game-medium`);
    giveaway.summary = giveaway.innerWrap.querySelector(`.giveaway__summary, .featured__summary, .table__column--width-fill`);
    if (esgst.giveawayPath && main) {
        var button = mainContext.getElementsByClassName(`sidebar__entry-delete`)[0];
        if (button) {
            giveaway.entered = !button.classList.contains(`is-hidden`);
        }
    } else {
        giveaway.entered = giveaway.innerWrap.classList.contains(`is-faded`);
    }
    giveaway.headingName = giveaway.innerWrap.querySelector(`.giveaway__heading__name, .featured__heading__medium, .table__column__heading`);
    giveaway.name = giveaway.headingName.textContent;
    match = giveaway.name.match(/\s\((.+) Copies\)/);
    if (match) {
        giveaway.name = giveaway.name.replace(match[0], ``);
        giveaway.copies = parseInt(match[1].replace(/,/g, ``).match(/\d+/)[0]);
    } else {
        giveaway.copies = 1;
    }
    giveaway.url = esgst.giveawayPath && main && !ugd ? location.pathname : (mainUrl || giveaway.headingName.getAttribute(`href`));
    if (giveaway.url) {
        match = giveaway.url.match(/\/giveaway\/(.+?)(\/.+?)$/);
        if (match) {
            giveaway.code = match[1];
        } else {
            return null;
        }
    }
    giveaway.pinned = giveaway.outerWrap.closest(`.pinned-giveaways__outer-wrap`);
    thinHeadings = giveaway.innerWrap.querySelectorAll(`.giveaway__heading__thin, .featured__heading__small`);
    n = thinHeadings.length;
    giveaway.points = 0;
    if (n > 0) {
        if (n > 1) {
            if (esgst.gch && !giveaway.pinned) {
                thinHeadings[0].classList.add(`esgst-bold`, `esgst-red`);
            }
            giveaway.copies = parseInt(thinHeadings[0].textContent.replace(/,/g, ``).match(/\d+/)[0]);
            giveaway.pointsContainer = thinHeadings[1];
            giveaway.points = parseInt(thinHeadings[1].textContent.match(/\d+/)[0]);
        } else {
            giveaway.copies = 1;
            giveaway.pointsContainer = thinHeadings[0];
            giveaway.points = parseInt(thinHeadings[0].textContent.match(/\d+/)[0]);
        }
    }
    giveaway.columns = giveaway.innerWrap.querySelector(`.giveaway__columns, .featured__columns`);
    if (giveaway.columns && ((esgst.archivePath && !main) || !esgst.archivePath)) {
        giveaway.endTimeColumn = giveaway.columns.firstElementChild;
        giveaway.started = !giveaway.endTimeColumn.textContent.match(/Begins/);
        giveaway.endTime = parseInt(giveaway.endTimeColumn.lastElementChild.getAttribute(`data-timestamp`)) * 1e3;
        giveaway.ended = giveaway.endTime < Date.now();
        if (giveaway.ended && (esgst.userPath || esgst.groupPath || ugd)) {
            giveaway.startTimeColumn = giveaway.endTimeColumn.nextElementSibling.nextElementSibling;
        } else {
            giveaway.startTimeColumn = giveaway.endTimeColumn.nextElementSibling;
        }
        giveaway.startTime = parseInt(giveaway.startTimeColumn.firstElementChild.getAttribute(`data-timestamp`)) * 1e3;
        if (!esgst.userPath || (ugd && ugdType === `won`) || ged) {
            giveaway.creatorContainer = giveaway.startTimeColumn.lastElementChild;
            giveaway.creator = giveaway.creatorContainer.textContent;
        }
        giveaway.winners = giveaway.columns.textContent.match(/No winners/) ? 0 : giveaway.copies;
    } else {
        giveaway.started = true;
    }
    if (!giveaway.endTime && (esgst.createdPath || esgst.enteredPath || esgst.wonPath)) {
        giveaway.endTime = giveaway.innerWrap.querySelector(`[data-timestamp]`);
        if (giveaway.endTime) {
            giveaway.endTimeColumn = giveaway.endTime.parentElement;
            giveaway.started = !giveaway.endTimeColumn.textContent.match(/Begins/);
            giveaway.deleted = giveaway.endTimeColumn.parentElement.textContent.match(/Deleted/);
            giveaway.endTime = parseInt(giveaway.endTime.getAttribute(`data-timestamp`)) * 1e3;
        } else {
            giveaway.endTime = 0;
        }
        giveaway.ended = giveaway.endTime < Date.now();
    }
    if (!giveaway.ended) {
        giveaway.winners = 0;
    }
    if (ugd) {
        if (ugdType === `sent`) {
            giveaway.creator = ugd;
        }
    } else if (esgst.userPath && !ged) {
        giveaway.creator = location.pathname.match(/^\/user\/(.+?)(\/.*)?$/)[1];
    } else if (esgst.createdPath && main) {
        giveaway.creator = esgst.username;
    }
    if (esgst.createdPath && main) {
        var status = giveaway.outerWrap.querySelector(`.table__column--width-small.text-center:last-of-type`);
        if (status) {
            if (status.textContent.match(/Not\sReceived/)) {
                giveaway.notReceived = true;
            } else if (status.textContent.match(/Received/)) {
                giveaway.received = true;
            } else if (status.textContent.match(/Awaiting\sFeedback/)) {
                giveaway.awaitingFeedback = true;
            }
        }
    }
    giveaway.created = giveaway.creator === esgst.username;
    if (esgst.uf && esgst.giveawaysPath && savedUsers) {
        savedUser = getUser(savedUsers, {
            username: giveaway.creator
        });
        if (savedUser) {
            uf = savedUser.uf;
            if (esgst.uf_g && savedUser.blacklisted && !uf) {
                updateUfCount(giveaway.outerWrap.parentElement.nextElementSibling);
                giveaway.outerWrap.remove();
                return null;
            } else if (uf && uf.giveaways) {
                updateUfCount(giveaway.outerWrap.parentElement.nextElementSibling);
                giveaway.outerWrap.remove();
                return null;
            }
        }
    }
    if (esgst.gf && esgst.gf_h && main) {
        var savedGiveaway = esgst.giveaways[giveaway.code];
        if ((esgst.giveawaysPath || esgst.groupPath) && savedGiveaway && savedGiveaway.hidden && savedGiveaway.code) {
            giveaway.outerWrap.remove();
            return null;
        }
    }
    giveaway.links = giveaway.innerWrap.getElementsByClassName(`giveaway__links`)[0];
    if (giveaway.links) {
        giveaway.links.classList.add(`esgst-giveaway-links`);
        giveaway.entriesLink = giveaway.links.firstElementChild;
        giveaway.commentsLink = giveaway.entriesLink.nextElementSibling;
    } else {
        giveaway.entriesLink = mainContext.getElementsByClassName(`sidebar__navigation__item__count`)[1];
        giveaway.commentsLink = mainContext.getElementsByClassName(`sidebar__navigation__item__count`)[0];
    }
    if (giveaway.entriesLink && giveaway.commentsLink) {
        giveaway.entries = parseInt(giveaway.entriesLink.textContent.replace(/,/g, ``).match(/\d+/)[0]);
        giveaway.comments = parseInt(giveaway.commentsLink.textContent.replace(/,/g, ``).match(/\d+/)[0]);
    }
    giveaway.panel = giveaway.innerWrap.getElementsByClassName(`esgst-giveaway-panel`)[0];        
    if (!giveaway.panel && (esgst.gwc || esgst.gwr || esgst.gp || esgst.elgb || esgst.cewgd)) {
        if (giveaway.links) {
            giveaway.panel = insertHtml(giveaway.links, `afterEnd`, `
                <div class="giveaway__columns esgst-giveaway-panel"></div>
                <div style="clear: both;"></div>
            `);
            if (giveaway.startTimeColumn) {
                element = giveaway.startTimeColumn.nextElementSibling;
                while (element) {
                    giveaway.panel.appendChild(element);
                    element = giveaway.startTimeColumn.nextElementSibling;
                }
            }
        } else if (giveaway.columns) {
            giveaway.panel = insertHtml(giveaway.columns, `afterEnd`, `<div class="featured__columns esgst-giveaway-panel"></div>`);
        } else if (esgst.enteredPath && (esgst.gwc || esgst.gwr)) {
            giveaway.panel = insertHtml(giveaway.innerWrap.firstElementChild.nextElementSibling, `afterEnd`, `<div class="table__column--width-small text-center esgst-giveaway-panel"></div>`);
        }
    }
    giveaway.elgbPanel = giveaway.panel;
    if (!giveaway.entriesLink) {
        var ct = giveaway.panel || (esgst.gm_enable && esgst.createdPath ? giveaway.innerWrap.firstElementChild.nextElementSibling.nextElementSibling : giveaway.innerWrap.firstElementChild.nextElementSibling);
        if (ct.nextElementSibling) {
            giveaway.entries = parseInt(ct.nextElementSibling.textContent.replace(/,/g, ``));
        }
    }
    giveaway.levelColumn = giveaway.outerWrap.querySelector(`.giveaway__column--contributor-level, .featured__column--contributor-level`);
    giveaway.level = giveaway.levelColumn ? parseInt(giveaway.levelColumn.textContent.match(/\d+/)[0]) : 0;
    giveaway.inviteOnly = giveaway.outerWrap.querySelector(`.giveaway__column--invite-only, .featured__column--invite-only`);
    giveaway.regionRestricted = giveaway.outerWrap.querySelector(`.giveaway__column--region-restricted, .featured__column--region-restricted`);
    giveaway.group = giveaway.outerWrap.querySelector(`.giveaway__column--group, .featured__column--group`);
    giveaway.whitelist = giveaway.outerWrap.querySelector(`.giveaway__column--whitelist, .featured__column--whitelist`);
    chance = context.getElementsByClassName(`esgst-gwc`)[0];
    giveaway.chance = chance ? parseFloat(chance.getAttribute(`data-chance`)) : 0;
    var feedback = giveaway.outerWrap.getElementsByClassName(`table__gift-feedback-awaiting-reply`)[0];
    if (esgst.rrbp && feedback) {
        feedback.addEventListener(`click`, openRrbp.bind(null, giveaway));
    }
    if (main) {
        if (esgst.gr && giveaway.ended && giveaway.creator === esgst.username && (giveaway.entries === 0 || giveaway.entries < giveaway.copies) && (!esgst.gr_r || !esgst.giveaways[giveaway.code] || !esgst.giveaways[giveaway.code].recreated) && !giveaway.headingName.parentElement.getElementsByClassName(`esgst-gr-button`)[0]) {
            var button = insertHtml(giveaway.headingName, `beforeBegin`, `
                <div class="esgst-gr-button" title="Recreate giveaway">
                    <i class="fa fa-rotate-left"></i>
                </div>
            `);
            button.firstElementChild.addEventListener(`click`, recreateGrGiveaway.bind(null, button, giveaway));
        }
    }
    if (!main || endless) {
        let hideButton = giveaway.innerWrap.querySelector(`.giveaway__hide, .featured__giveaway__hide`);
        if (hideButton) {
            if (hideButton.classList.contains(`featured__giveaway__hide`)) {
                hideButton = hideButton.parentElement;
            }
            const temp = hideButton.previousElementSibling;
            hideButton.outerHTML = `
                <i class="fa fa-eye-slash giveaway__hide giveaway__icon"></i>
            `;
            hideButton = temp.nextElementSibling;
            hideButton.addEventListener(`click`, hideGame.bind(null, hideButton, giveaway.gameId, giveaway.name));
        }
    }
    return {
        giveaway: giveaway,
        data: {
            gameId: giveaway.gameId,
            gameSteamId: giveaway.id,
            gameType: giveaway.type,
            gameName: giveaway.name,
            code: giveaway.code,
            copies: giveaway.copies,
            points: giveaway.points,
            endTime: giveaway.endTime,
            startTime: giveaway.startTime,
            started: giveaway.started,
            creator: giveaway.creator,
            winners: giveaway.winners,
            entries: giveaway.entries,
            comments: giveaway.comments,
            level: giveaway.level,
            inviteOnly: giveaway.inviteOnly ? true : false,
            regionRestricted: giveaway.regionRestricted ? true : false,
            group: giveaway.group ? true : false,
            whitelist: giveaway.whitelist ? true : false
        }
    };
}

function loadDiscussionFeatures(context, main, source, endless) {
    var i, n, discussion, discussions, savedDiscussion, savedDiscussions;
    savedDiscussions = JSON.parse(getValue(`discussions`, `{}`));
    discussions = getDiscussions(context, main, savedDiscussions);
    for (i = discussions.length - 1; i > -1; --i) {
        discussions[i].sortIndex = esgst.currentDiscussions.length;
        esgst.currentDiscussions.push(discussions[i]);
    }
    if (esgst.codb) {
        addCodbButtons(discussions);
    }
    if ((esgst.df && esgst.df_h) || esgst.dh) {
        for (i = 0, n = discussions.length; i < n; ++i) {
            discussion = discussions[i];
            savedDiscussion = savedDiscussions[discussion.code];
            if (savedDiscussion) {
                if (esgst.df && esgst.df_h) {
                    if (savedDiscussion.hidden) {
                        addDfUnhideButton(discussion, main);
                    } else {
                        addDfHideButton(discussion, main);
                    }
                }
                if (esgst.dh) {
                    if (savedDiscussion.highlighted) {
                        highlightDhDiscussion(discussion.code, discussion.outerWrap);
                        addDhUnhighlightButton(discussion.code, discussion.outerWrap, discussion.heading.parentElement);
                        if (esgst.dh_t) {
                            discussion.outerWrap.parentElement.insertBefore(discussion.outerWrap, discussion.outerWrap.parentElement.firstElementChild);
                        }
                    } else {
                        addDhHighlightButton(discussion.code, discussion.outerWrap, discussion.heading.parentElement);
                    }
                }
            } else {
                if (esgst.df && esgst.df_h) {
                    addDfHideButton(discussion, main);
                }
                if (esgst.dh) {
                    addDhHighlightButton(discussion.code, discussion.outerWrap, discussion.heading.parentElement);
                }
            }
        }
    }
    if (esgst.df && esgst.df.filteredCount && esgst[`df_enable`]) {
        filterDfDiscussions(esgst.df, false, endless);
    }
    if (esgst.ds && esgst.ds_auto) {
        sortContent(discussions, esgst.ds_option);
    }
}

function getDiscussions(context, main, savedDiscussions) {
    var discussion, discussions, elements, i, n, savedUsers;
    discussions = [];
    savedUsers = JSON.parse(getValue(`users`));
    elements = context.getElementsByClassName(`table__row-outer-wrap`);
    for (i = elements.length - 1; i > -1; --i) {
        discussion = getDiscussionInfo(elements[i], main, savedDiscussions, savedUsers);
        if (discussion) {
            discussions.push(discussion);
        }
    }
    return discussions;
}

function getDiscussionInfo(context, main, savedDiscussions, savedUsers) {
    var match, discussion, savedUser, uf;
    discussion = {};
    discussion.outerWrap = context;
    discussion.innerWrap = discussion.outerWrap.firstElementChild;
    discussion.avatarColumn = discussion.innerWrap.firstElementChild;
    if (!discussion.avatarColumn) {
        return null;
    }
    discussion.avatar = discussion.avatarColumn.firstElementChild;
    discussion.headingColumn = discussion.avatarColumn.nextElementSibling;
    discussion.headingContainer = discussion.headingColumn.firstElementChild;
    discussion.closed = discussion.headingContainer.getElementsByClassName(`fa-lock`)[0];
    discussion.heading = discussion.headingContainer.lastElementChild;
    discussion.info = discussion.headingContainer.nextElementSibling;
    if (discussion.heading) {
        discussion.title = discussion.heading.textContent;
        discussion.url = discussion.heading.getAttribute(`href`);
        if (discussion.url) {
            match = discussion.url.match(/discussion\/(.+?)\//);
            if (match) {
                discussion.code = match[1];
                if (discussion.code === `TDyzv` && esgst.checkVersionMain && discussion.title.match(/v(.+?)\s/)[1] !== esgst.version) {
                    createAlert(`There are new updates available for ESGST.`);
                }
                if (main && esgst.df && esgst.df_h && savedDiscussions[discussion.code] && savedDiscussions[discussion.code].hidden) {
                    discussion.outerWrap.remove();
                    return null;
                }
                if (savedDiscussions[discussion.code]) {
                    discussion.highlighted = savedDiscussions[discussion.code].highlighted;
                    discussion.visited = savedDiscussions[discussion.code].visited;
                }
                discussion.categoryContainer = discussion.info.firstElementChild;
                discussion.category = discussion.categoryContainer.textContent;
                discussion[discussion.category.replace(/\W/g, ``).replace(/^(.)/, (m, p1) => { return p1.toLowerCase(); })] = true;
                discussion.createdContainer = discussion.categoryContainer.nextElementSibling;
                discussion.createdTime = parseInt(discussion.createdContainer.getAttribute(`data-timestamp`)) * 1e3;
                if (esgst.giveawaysPath) {
                    discussion.author = discussion.avatar.getAttribute(`href`).match(/\/user\/(.+)/)[1];
                } else {
                    discussion.author = discussion.createdContainer.nextElementSibling.textContent;
                }
                discussion.created = discussion.author === esgst.username;
                discussion.poll = discussion.outerWrap.getElementsByClassName(`fa-align-left`)[0];
                if (esgst.discussionsPath) {
                    discussion.commentsColumn = discussion.headingColumn.nextElementSibling;
                    discussion.comments = parseInt(discussion.commentsColumn.firstElementChild.textContent.replace(/,/g, ``));
                }
                if (esgst.uf && savedUsers) {
                    savedUser = getUser(savedUsers, {
                        username: discussion.author
                    });
                    if (savedUser) {
                        uf = savedUser.uf;
                        if (esgst.uf_d && savedUser.blacklisted && !uf) {
                            if (!esgst.giveawaysPath) {
                                updateUfCount(discussion.outerWrap.parentElement.parentElement.nextElementSibling);
                            }
                            discussion.outerWrap.remove();
                            return null;
                        } else if (uf && uf.discussions) {
                            if (!esgst.giveawaysPath) {
                                updateUfCount(discussion.outerWrap.parentElement.parentElement.nextElementSibling);
                            }
                            discussion.outerWrap.remove();
                            return null;
                        }
                    }
                }
                return discussion;
            } else {
                return null;
            }
        } else {
            return null;
        }
    } else {
        return null;
    }
}

function startCommentFeatures() {
    if (esgst.commentsPath || esgst.inboxPath) {
        if (esgst.es && esgst.es_r && esgst.discussionPath && esgst.pagination) {
            reverseComments(esgst.pagination.previousElementSibling);
        }
        esgst.endlessFeatures.push(loadCommentFeatures);
        loadCommentFeatures(document, true);
    }
}

function loadCommentFeatures(context, main) {
    var count, comments, i, n, pagination;
    comments = getComments(context, document, main);
    if (main) {
        for (i = 0, n = comments.length; i < n; ++i) {
            comments[i].index = i;
            esgst.currentComments.push(comments[i]);
        }
    }
    if (esgst.ct) {
        if (esgst.inboxPath) {
            count = 0;
        } else {
            count = context.getElementsByClassName(`page__heading__breadcrumbs`)[1];
            if (count) {
                count = parseInt(count.firstElementChild.textContent.replace(/,/g, ``).match(/\d+/));
            } else {
                count = 0;
            }
        }
        getCtComments(count, comments);
    }
    if (esgst.rfi && esgst.rfi_s && esgst.inboxPath) {
        getRfiReplies(comments, main);
    }
}

function getComments(context, mainContext, main) {
    var comment, comments, i, matches, sourceLink, savedUsers;
    comments = [];
    savedUsers = JSON.parse(getValue(`users`));
    matches = context.querySelectorAll(`:not(.comment--submit) > .comment__parent, .comment__child, .comment_inner`);
    sourceLink = mainContext.querySelector(`.page__heading__breadcrumbs a[href*="/giveaway/"], .page__heading__breadcrumbs a[href*="/discussion/"], .page__heading__breadcrumbs a[href*="/ticket/"], .page_heading_breadcrumbs a[href*="/trade/"]`);
    for (i = matches.length - 1; i >= 0; --i) {
        comment = getCommentInfo(matches[i], sourceLink, savedUsers, main);
        if (comment) {
            comments.push(comment);
        }
    }
    return comments;
}

function getCommentInfo(context, sourceLink, savedUsers, main) {
    var comment, matches, n, source;
    comment = {};
    comment.comment = context;
    comment.author = comment.comment.querySelector(`.comment__author, .author_name`).textContent.trim();
            if (esgst.uf && savedUsers) {
                var savedUser = getUser(savedUsers, {
                    username: comment.author
                });
                if (savedUser) {
                    var uf = savedUser.uf, comments, extraCount;
                    if (esgst.uf_p && savedUser.blacklisted && !uf) {
                        comments = comment.comment.closest(`.comments`);
                        if (esgst.inboxPath) {
                            updateUfCount(comments.parentElement.nextElementSibling);
                            comment.comment.parentElement.remove();
                            if (!comments.children.length) {
                                comments.previousElementSibling.remove();
                                comments.remove();
                            }
                        } else {
                            if (comment.comment.nextElementSibling) {
                                extraCount = comment.comment.nextElementSibling.children.length;
                            } else {
                                extraCount = 0;
                            }
                            updateUfCount(comments.nextElementSibling, extraCount);
                            comment.comment.parentElement.remove();
                        }
                        return null;
                    } else if (uf && uf.posts) {
                        comments = comment.comment.closest(`.comments`);
                        updateUfCount(comment.comment.closest(`.comments`).nextElementSibling);
                        if (esgst.inboxPath) {
                            updateUfCount(comments.parentElement.nextElementSibling);
                            comment.comment.parentElement.remove();
                            if (!comments.children.length) {
                                comments.previousElementSibling.remove();
                                comments.remove();
                            }
                        } else {
                            if (comment.comment.nextElementSibling) {
                                extraCount = comment.comment.nextElementSibling.children.length;
                            } else {
                                extraCount = 0;
                            }
                            updateUfCount(comments.nextElementSibling, extraCount);
                            comment.comment.parentElement.remove();
                        }
                        return null;
                    }
                }
            }
    comment.actions = comment.comment.querySelector(`.comment__actions, .action_list`);
    matches = comment.actions.querySelectorAll(`[href*="/comment/"]`);
    n = matches.length;
    if (n > 0) {
        comment.permalink = matches[n - 1];
    }
    comment.id = comment.permalink ? comment.permalink.getAttribute(`href`).match(/\/comment\/(.+)/)[1] : ``;
    comment.timestamp = parseInt(comment.actions.firstElementChild.lastElementChild.getAttribute(`data-timestamp`));
    if (main && esgst.inboxPath) {
        if (esgst.sg) {
            source = comment.comment.closest(`.comments`).previousElementSibling.firstElementChild.firstElementChild.getAttribute(`href`);
        } else {
            source = comment.actions.querySelector(`[href*="/trade/"]`).getAttribute(`href`);
        }
    } else if (sourceLink) {
        source = sourceLink.getAttribute(`href`);
    }
    if (source) {
        source = source.match(/(giveaway|discussion|ticket|trade)\/(.+?)(\/.*)?$/);
        comment.type = `${source[1]}s`;
        comment.code = source[2];
        return comment;
    } else {
        return null;
    }
}

function startProfileFeatures() {
    if (esgst.userPath) {
        loadProfileFeatures(document);
    }
}

function loadProfileFeatures(context) {
    var action, cvrow, element, elements, i, input, key, match, n, profile, rows, savedUsers;
    profile = {};
    if (esgst.sg) {
        profile.heading = context.getElementsByClassName(`featured__heading`)[0];
        input = context.querySelector(`[name="child_user_id"]`);
        if (input) {
            profile.id = input.value;
        } else {
            profile.id = ``;
        }
        profile.username = profile.heading.textContent.replace(/\s[\s\S]*/, ``);
        profile.steamButtonContainer = context.getElementsByClassName(`sidebar__shortcut-outer-wrap`)[0];
        profile.steamButton = profile.steamButtonContainer.querySelector(`[href*="/profiles/"]`);
        profile.steamId = profile.steamButton.getAttribute(`href`).match(/\d+/)[0];
        profile.name = profile.username;
    } else {
        profile.heading = esgst.mainPageHeading;
        profile.id = ``;
        profile.username = ``;
        profile.steamButtonContainer = context.getElementsByClassName(`profile_links`)[0];
        profile.steamButton = profile.steamButtonContainer.querySelector(`[href*="/profiles/"]`);
        profile.steamId = profile.steamButton.getAttribute(`href`).match(/\d+/)[0];
        profile.name = profile.steamId;
    }
    elements = context.getElementsByClassName(`featured__table__row__left`);
    for (i = elements.length - 1; i >= 0; --i) {
        element = elements[i];
        match = element.textContent.match(/(Gifts (Won|Sent)|Contributor Level)/);
        if (match) {
            key = match[2];
            if (key) {
                if (key === `Won`) {
                    profile.wonRow = element.parentElement;
                    profile.wonRowLeft = element;
                    profile.wonRowRight = element.nextElementSibling;
                    rows = JSON.parse(profile.wonRowRight.firstElementChild.firstElementChild.getAttribute(`data-ui-tooltip`)).rows;
                    profile.wonCount = parseInt(rows[0].columns[1].name.replace(/,/g, ``));
                    profile.wonFull = parseInt(rows[1].columns[1].name.replace(/,/g, ``));
                    profile.wonReduced = parseInt(rows[2].columns[1].name.replace(/,/g, ``));
                    profile.wonZero = parseInt(rows[3].columns[1].name.replace(/,/g, ``));
                    cvrow = profile.wonRowRight.firstElementChild.lastElementChild;
                    rows = JSON.parse(cvrow.getAttribute(`data-ui-tooltip`)).rows;
                    profile.wonCV = parseFloat(cvrow.textContent.replace(/\$|,/g, ``));
                    profile.realWonCV = parseFloat(rows[0].columns[1].name.replace(/\$|,/g, ``));
                } else {
                    profile.sentRow = element.parentElement;
                    profile.sentRowLeft = element;
                    profile.sentRowRight = element.nextElementSibling;
                    rows = JSON.parse(profile.sentRowRight.firstElementChild.firstElementChild.getAttribute(`data-ui-tooltip`)).rows;
                    profile.sentCount = parseInt(rows[0].columns[1].name.replace(/,/g, ``));
                    profile.sentFull = parseInt(rows[1].columns[1].name.replace(/,/g, ``));
                    profile.sentReduced = parseInt(rows[2].columns[1].name.replace(/,/g, ``));
                    profile.sentZero = parseInt(rows[3].columns[1].name.replace(/,/g, ``));
                    profile.notSent = parseInt(rows[5].columns[1].name.replace(/,/g, ``));
                    cvrow = profile.sentRowRight.firstElementChild.lastElementChild;
                    rows = JSON.parse(cvrow.getAttribute(`data-ui-tooltip`)).rows;
                    profile.sentCV = parseFloat(cvrow.textContent.replace(/\$|,/g, ``));
                    profile.realSentCV = parseFloat(rows[0].columns[1].name.replace(/\$|,/g, ``));
                }
            } else {
                profile.levelRow = element.parentElement;
                profile.levelRowLeft = element;
                profile.levelRowRight = element.nextElementSibling;
                rows = JSON.parse(profile.levelRowRight.firstElementChild.getAttribute(`data-ui-tooltip`)).rows;
                profile.level = parseFloat(rows[0].columns[1].name);
            }
        }
    }
    profile.whitelistButton = profile.steamButtonContainer.getElementsByClassName(`sidebar__shortcut__whitelist`)[0];
    profile.blacklistButton = profile.steamButtonContainer.getElementsByClassName(`sidebar__shortcut__blacklist`)[0];
    if (profile.whitelistButton) {
        if (esgst.updateWhitelistBlacklist) {
            profile.whitelistButton.addEventListener(`click`, updateWhitelistBlacklist.bind(null, `whitelisted`, profile));
        }
    }
    if (profile.blacklistButton) {
        if (esgst.updateWhitelistBlacklist) {
            profile.blacklistButton.addEventListener(`click`, updateWhitelistBlacklist.bind(null, `blacklisted`, profile));
        }
    }
    savedUsers = JSON.parse(getValue(`users`));
    for (i = 0, n = esgst.profileFeatures.length; i < n; ++i) {
        esgst.profileFeatures[i](profile, savedUsers.users[profile.steamId]);
    }
}

function updateWhitelistBlacklist(key, profile, event) {
    var user;
    user = {
        steamId: profile.steamId,
        id: profile.id,
        username: profile.username,
        values: {}
    };
    if (event.currentTarget.classList.contains(`is-selected`)) {
        user.values[key] = false;
    } else {
        user.values[key] = true;
        user.values[`${key}Date`] = Date.now();
    }
    saveUser(null, null, user);
}

function triggerSetOnEnter(set, event) {
    if (event.key === `Enter`) {
        set.trigger();
    }
}

/* [UT] User Tags */

function loadUt() {
    esgst.userFeatures.push(getUtTags);
}

function getUtTags(currentUsers) {
    var key, i, n, steamId, user, username;
    for (key in currentUsers) {
        steamId = esgst.sg ? esgst.users.steamIds[key] : key;
        username = esgst.sg ? key : esgst.users.users[key] && esgst.users.users[key].username;
        for (i = 0, n = currentUsers[key].length; i < n; ++i) {
            addUtButton(currentUsers[key][i], key, steamId, username);
        }
        user = esgst.sg ? steamId && esgst.users.users[steamId] : esgst.users.users[key];
        if (user && user.tags) {
            addUtTags(key, user.tags);
        }
    }
}

function addUtButton(context, key, steamId, username) {
    var container;
    container = context.parentElement;
    if (container.classList.contains(`comment__username`)) {
        context = container;
    }
    insertHtml(context, `afterEnd`, `
        <a class="esgst-ut-button esgst-faded" title="Edit user tags">
            <i class="fa fa-tag"></i>
            <span class="esgst-ut-tags"></span>
        </a>
    `).addEventListener(`click`, openUtPopup.bind(null, key, steamId, username));
}

function openUtPopup(key, steamId, username) {
    var popup, set;
    user = {
        steamId: steamId,
        username: username
    };
    popup = new Popup(`fa-tag`, `Edit user tags for <span>${key}</span>:`);
    set = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveUtTags.bind(null, key, popup, user));
    popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Drag the tags to move them.<br/><br/>When editing a tag color, it will also alter the color for all users with that tag (you have to refresh the page for it to take effect).</div>`);
    popup.tags = insertHtml(popup.description, `beforeEnd`, `<div class="esgst-ut-tags"></div>`);
    popup.input = insertHtml(popup.description, `beforeEnd`, `<input type="text"/>`);
    popup.input.addEventListener(`keydown`, triggerSetOnEnter.bind(null, set));
    popup.input.addEventListener(`input`, createUtTags.bind(null, popup));
    popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Use commas to separate tags, for example: Tag1, Tag2, ...</div>`);
    popup.description.appendChild(set.set);
    popup.open(loadUtTags.bind(null, popup, user));
}

function createUtTags(popup) {
    var i, n, tags;
    tags = popup.input.value.replace(/(,\s*)+/g, formatTags).split(`, `);
    popup.tags.innerHTML = ``;
    for (i = 0, n = tags.length; i < n; ++i) {
        createUtTag(popup, tags[i]);
    }
    popup.reposition();
}

function createUtTag(popup, tag) {
    var bgColorInput, colorInput, colors, container, deleteButton, editButton, input, tagBox, tagContainer;
    container = insertHtml(popup.tags, `beforeEnd`, `
        <div class="esgst-ut-preview" draggable="true">
            <div class="esgst-ut-tags">
                <span class="global__image-outer-wrap author_avatar is_icon">${tag}</span>
            </div>
            <input class="esgst-hidden" type="text"/>
            <input title="Set text color for this tag" type="color"/>
            <input title="Set background color for this tag" type="color"/>
            <i class="esgst-clickable fa fa-edit" title="Edit tag"></i>
            <i class="esgst-clickable fa fa-trash" title="Delete tag"></i>
        </div>
    `);
    tagContainer = container.firstElementChild;
    tagBox = tagContainer.firstElementChild;
    input = tagContainer.nextElementSibling;
    colorInput = input.nextElementSibling;
    bgColorInput = colorInput.nextElementSibling;
    editButton = bgColorInput.nextElementSibling;
    deleteButton = editButton.nextElementSibling;
    colors = esgst.ut_colors[tag];
    if (colors) {
        colorInput.value = tagBox.style.color = colors.color;
        bgColorInput.value = tagBox.style.backgroundColor = colors.bgColor;
    }
    container.addEventListener(`dragstart`, startUtDrag.bind(null, container, popup));
    container.addEventListener(`dragenter`, continueUtDrag.bind(null, container, popup));
    container.addEventListener(`dragend`, endUtDrag.bind(null, popup));
    input.addEventListener(`keydown`, editUtTag.bind(null, bgColorInput, colorInput, input, popup, tagBox, tagContainer));
    colorInput.addEventListener(`change`, saveUtColor.bind(null, colorInput, `color`, `color`, tagBox));
    bgColorInput.addEventListener(`change`, saveUtColor.bind(null, bgColorInput, `backgroundColor`, `bgColor`, tagBox));
    editButton.addEventListener(`click`, showUtEdit.bind(null, input, tagBox, tagContainer));
    deleteButton.addEventListener(`click`, deleteUtTag.bind(null, container, popup));
}

function startUtDrag(container, popup) {
    popup.dragged = container;
}

function continueUtDrag(container, popup) {
    var current;
    current = popup.dragged;
    do {
        current = current.previousElementSibling;
        if (current && current === container) {
            popup.tags.insertBefore(popup.dragged, container);
            return;
        }
    } while (current);
    popup.tags.insertBefore(popup.dragged, container.nextElementSibling);
}

function endUtDrag(popup) {
    var children, i, n, tags;
    tags = [];
    children = popup.tags.children;
    for (i = 0, n = children.length; i < n; ++i) {
        tags.push(children[i].firstElementChild.firstElementChild.textContent);
    }
    popup.input.value = tags.join(`, `);
    popup.reposition();
}

function editUtTag(bgColorInput, colorInput, input, popup, tagBox, tagContainer, event) {
    var colors, name, oldName, tag;
    if (event.key === `Enter`) {
        tagContainer.classList.remove(`esgst-hidden`);
        input.classList.add(`esgst-hidden`);
        oldName = tagBox.textContent;
        tag = input.value;
        tagBox.textContent = tag;
        colors = esgst.ut_colors[tag];
        if (colors) {
            colorInput.value = tagBox.style.color = colors.color;
            bgColorInput.value = tagBox.style.backgroundColor = colors.bgColor;
        }
        endUtDrag(popup);
    }
}

function saveUtColor(input, key, saveKey, tagBox) {
    var tag;
    tag = tagBox.textContent;
    if (!esgst.ut_colors[tag]) {
        esgst.ut_colors[tag] = {
            bgColor: ``,
            color: ``
        };
    }
    esgst.ut_colors[tag][saveKey] = tagBox.style[key] = input.value;
}

function showUtEdit(input, tagBox, tagContainer) {
    tagContainer.classList.add(`esgst-hidden`);
    input.classList.remove(`esgst-hidden`);
    input.value = tagBox.textContent;
    input.focus();
    popup.reposition();
}

function deleteUtTag(container, popup) {
    container.remove();
    endUtDrag(popup);
}

function formatTags(fullMatch, match1, offset, string) {
    return (((offset === 0) || (offset === (string.length - fullMatch.length))) ? `` : `, `);
}

function saveUtTags(key, popup, user, callback) {
    var tags;
    tags = popup.input.value.replace(/(,\s*)+/g, formatTags).split(`, `);
    user.values = {
        tags: tags
    };
    saveUser(null, null, user, completeUtSave.bind(null, key, popup, tags, callback));
}

function completeUtSave(key, popup, tags, callback) {
    setSetting(`ut_colors`, esgst.ut_colors);
    addUtTags(key, tags);
    callback();
    popup.close();
}

function loadUtTags(popup, user) {
    var i, n, savedUser, tags;
    savedUser = getUser(null, user);
    popup.input.focus();
    if (savedUser) {
        tags = savedUser.tags;
        if (tags) {
            popup.tags.innerHTML = ``;
            for (i = 0, n = tags.length; i < n; ++i) {
                createUtTag(popup, tags[i]);
            }
            popup.input.value = tags.join(`, `);
            popup.reposition();
        }
    }
}

function addUtTags(key, tags) {
    var button, children, colors, container, context, elements, html, i, n, prefix, suffix, tagsBox, tagsContainer;
    elements = esgst.currentUsers[key];
    prefix = `<span class="global__image-outer-wrap author_avatar is_icon">`;
    suffix = `</span>`;
    html = tags.length && tags[0] ? `${prefix}${tags.join(`${suffix}${prefix}`)}${suffix}` : ``;
    for (i = 0, n = elements.length; i < n; ++i) {
        context = elements[i];
        container = context.parentElement;
        if (container) {
            if (container.classList.contains(`comment__username`)) {
                context = container;
            }
            button = context.parentElement.getElementsByClassName(`esgst-ut-button`)[0];
            if (html) {
                button.classList.remove(`esgst-faded`);
            } else {
                button.classList.add(`esgst-faded`);
            }
            tagsContainer = button.lastElementChild;
            tagsContainer.innerHTML = html;
            children = tagsContainer.children;
            for (j = 0, numTags = children.length; j < numTags; ++j) {
                tagsBox = children[j];
                colors = esgst.ut_colors[tagsBox.textContent];
                if (colors) {
                    tagsBox.style.color = colors.color;
                    tagsBox.style.backgroundColor = colors.bgColor;
                }
            }
        }
    }
}

function startUserFeatures() {
    esgst.endlessFeatures.push(loadUserFeatures);
    loadUserFeatures(document);
}

function loadUserFeatures(context) {
    var currentUsers, element, elements, i, id, match, n, savedUsers;
    elements = context.querySelectorAll(`a[href*='/user/']`);
    currentUsers = {};
    for (i = 0, n = elements.length; i < n; ++i) {
        element = elements[i];
        match = element.getAttribute(`href`).match(/\/user\/(.+)/);
        if (match) {
            id = match[1];
            if (((esgst.sg && element.textContent === id) || (!esgst.sg && element.textContent && !element.children.length)) && !element.closest(`.markdown`)) {
                if (!esgst.currentUsers[id]) {
                    esgst.currentUsers[id] = [];
                }
                if (!currentUsers[id]) {
                    currentUsers[id] = [];
                }
                esgst.currentUsers[id].push(element);
                currentUsers[id].push(element);
            }
        }
    }
    var keys = Object.keys(currentUsers);
    var length = keys.length;
    if (length > 0) {
        if ((length > 1 || (keys[0] !== `cg` && keys[0] !== esgst.username)) && (esgst.wbcButton || esgst.mtUserButton) && context === document) {
            if (esgst.wbcButton) {
                esgst.wbcButton.classList.remove(`esgst-hidden`);
                esgst.wbcButton.parentElement.classList.remove(`esgst-hidden`);
            }
            if (esgst.mtUserButton) {
                esgst.mtUserButton.classList.remove(`esgst-hidden`);
                esgst.mtUserButton.parentElement.classList.remove(`esgst-hidden`);
            }
        }
        for (i = 0, n = esgst.userFeatures.length; i < n; ++i) {
            esgst.userFeatures[i](currentUsers);
        }
    }
}

function startGameFeatures() {
    esgst.endlessFeatures.push(loadGameFeatures);
    loadGameFeatures(document, true);
}

function loadGameFeatures(context, main, source, endless) {
    var found, games, i, id, n;
    games = getGames(context, main);
    if (main) {
        found = false;
        for (id in games.apps) {
            if (!esgst.currentGames.apps[id]) {
                esgst.currentGames.apps[id] = [];
            }
            games.apps[id].forEach(game => {
                found = true;
                esgst.currentGames.apps[id].push(game);
            });
        }
        for (id in games.subs) {
            if (!esgst.currentGames.subs[id]) {
                esgst.currentGames.subs[id] = [];
            }
            games.subs[id].forEach(game => {
                found = true;
                esgst.currentGames.subs[id].push(game);
            });
        }
        if (found && esgst.mtGameButton) {
            esgst.mtGameButton.classList.remove(`esgst-hidden`);
            esgst.mtGameButton.parentElement.classList.remove(`esgst-hidden`);
        }
    }
    for (i = 0, n = esgst.gameFeatures.length; i < n; ++i) {
        esgst.gameFeatures[i](games);
    }
    if (esgst.gc && !esgst.menuPath && !esgst.newGiveawayPath) {
        getGcGames(games, endless);
    }
}

function getGames(context, main) {
    var games, heading, headingName, name, i, id, info, match, matches, n, headingQuery, matchesQuery, table, type;
    games = {
        apps: {},
        subs: {}
    };
    if (esgst.discussionPath && (esgst.gc_t || esgst.gt_t || esgst.egh_t) && main) {
        matchesQuery = `.featured__outer-wrap--giveaway, .giveaway__row-outer-wrap, .table__row-outer-wrap, .markdown table td`;
        headingQuery = `.featured__heading, .giveaway__heading, .table__column__heading, a`;
    } else {
        matchesQuery = `.featured__outer-wrap--giveaway, .giveaway__row-outer-wrap, .table__row-outer-wrap`;
        headingQuery = `.featured__heading, .giveaway__heading, .table__column__heading`;
    }
    matches = context.querySelectorAll(matchesQuery);
    for (i = 0, n = matches.length; i < n; ++i) {
        match = matches[i];
        if (match.closest(`table`)) {
            table = true;
        } else {
            table = false;
        }
        info = getGameInfo(match);
        heading = match.querySelector(headingQuery);
        if (info && heading) {
            headingName = heading.querySelector(`.featured__heading__medium, .giveaway__heading__name`) || heading;
            name = headingName.textContent;
            id = info.id;
            type = info.type;
            if (!games[type][id]) {
                games[type][id] = [];
            }
            games[type][id].push({
                container: match,
                heading: heading,
                headingName: headingName,
                name: name,
                table: table
            });
        }
    }
    return games;
}

function getGameInfo(context, steamLink) {
    var image, info, link, url;
    link = context.querySelector(`[href*="/app/"], [href*="/sub/"]`);
    image = context.querySelector(`[style*="/apps/"], [style*="/subs/"]`);
    if (link || image) {
        url = (link && link.getAttribute(`href`)) || (image && image.getAttribute(`style`));
        if (url) {
            info = url.match(/\/(app|sub)s?\/(\d+)/);
            return {
                type: `${info[1]}s`,
                id: info[2]
            };
        } else {
            return null;
        }
    } else {
        return null;
    }
}

/* [AP] Avatar Popout */

function loadAp() {
    esgst.endlessFeatures.push(getApAvatars);
    getApAvatars(document);
    esgst.userFeatures.push(getInlineApAvatars);
}

function getApAvatars(context) {
    var i, matches, n;
    matches = context.querySelectorAll(`.global__image-outer-wrap--avatar-small, .giveaway_image_avatar, .table_image_avatar, .featured_giveaway_image_avatar`);
    for (i = 0, n = matches.length; i < n; ++i) {
        setApAvatar(matches[i]);
    }
}

function getInlineApAvatars(currentUsers) {
    var i, key, n;
    for (key in currentUsers) {
        for (i = 0, n = currentUsers[key].length; i < n; ++i) {
            setApAvatar(currentUsers[key][i]);
        }
    }
}

function setApAvatar(apAvatar) {
    var exitTimeout, id, match, popout, timeout, type, url;
    url = apAvatar.getAttribute(`href`);
    if (url) {
        match = url.match(/\/(user|group)\/(.+?)(\/.*)?$/);
        if (match) {
            id = match[2];
            type = match[1];
            apAvatar.addEventListener(`mouseenter`, function() {
                timeout = setTimeout(function() {
                    popout = esgst.apPopouts[id];
                    if (popout) {
                        popout.open(apAvatar);
                    } else {
                        esgst.apPopouts[id] = popout = new Popout(`esgst-ap-popout`);
                        popout.popout.innerHTML = `
                            <i class="fa fa-circle-o-notch fa-spin"></i>
                            <span>Loading ${type}...</span>
                        `;
                        popout.open(apAvatar);
                        request(null, null, false, url, function (response) {
                            var avatar, columns, i, link, n, reportButton, responseHtml, table;
                            responseHtml = DOM.parse(response.responseText);
                            popout.popout.innerHTML = ``;
                            popout.popout.appendChild(responseHtml.getElementsByClassName(`featured__outer-wrap`)[0]);
                            avatar = popout.popout.getElementsByClassName(`global__image-outer-wrap--avatar-large`)[0];
                            link = insertHtml(avatar, `afterEnd`, `<a class="esgst-ap-link"></a>`);
                            link.appendChild(avatar);
                            link.setAttribute(`href`, url);
                            table = popout.popout.getElementsByClassName(`featured__table`)[0];
                            responseHtml.getElementsByClassName(`sidebar__shortcut-outer-wrap`)[0].lastElementChild.remove();
                            table.parentElement.insertBefore(responseHtml.getElementsByClassName(`sidebar__shortcut-outer-wrap`)[0], table);
                            reportButton = popout.popout.getElementsByClassName(`js__submit-form-inner`)[0];
                            if (reportButton) {
                                reportButton.addEventListener(`click`, function() {
                                    return reportButton.getElementsByTagName(`form`)[0].submit();
                                });
                            }
                            columns = table.children;
                            for (i = 0, n = columns[1].children.length; i < n; ++i) {
                                columns[0].appendChild(columns[1].firstElementChild);
                            }
                            suspension = responseHtml.getElementsByClassName(`sidebar__suspension`)[0];
                            if (suspension) {
                                columns[0].insertAdjacentHTML(`beforeEnd`, `
                                    <div class="esgst-ap-suspended featured__table__row">
                                        <div class="featured__table__row__left">${suspension.textContent}</div>
                                        <div class="featured__table__row__right">${suspension.nextElementSibling.textContent}</div>
                                    </div>
                                `);
                            }
                            columns[1].remove();
                            if (type === `user`) {
                                loadProfileFeatures(popout.popout);
                            }
                            popout.reposition();
                        });
                    }
                    popout.popout.onmouseenter = function() {
                        if (exitTimeout) {
                            clearTimeout(exitTimeout);
                            exitTimeout = null;
                        }
                    };
                }, 1000);
            });
            apAvatar.addEventListener(`mouseleave`, function(event) {
                if (timeout) {
                    clearTimeout(timeout);
                    timeout = null;
                }
                exitTimeout = setTimeout(function() {
                    if (popout && !popout.popout.contains(event.relatedTarget)) {
                        popout.close();
                    }
                }, 1000);
            });
            apAvatar.addEventListener(`click`, function() {
                if (timeout) {
                    clearTimeout(timeout);
                    timeout = null;
                }
            });
        }
    }
}

/* [ES] Endless Scrolling */

function loadEs(pauseButton, resumeButton, refreshButton, refreshAllButton, scrollButton) {
    var busy, count, currentPage, divisors, ended, i, lastLink, mainContext, n, nextPage, pageIndex, paginations, pageBase, paused, progress, reversePages, reverseScrolling, row, total;
    divisors = ((esgst.es_g_d && esgst.giveawaysPath) || (esgst.es_d_d && esgst.discussionsTicketsPath) || (esgst.es_t_d && esgst.tradesPath) || (esgst.es_c_d && esgst.commentsPath) || (esgst.es_l_d && !esgst.giveawaysPath && !esgst.discussionsTicketsPath && !esgst.tradesPath && !esgst.commentsPath));
    mainContext = esgst.pagination.previousElementSibling;
    rows = mainContext.getElementsByClassName(`table__rows`)[0];
    if (rows) {
        mainContext = rows;
    }
    paginations = [esgst.paginationNavigation ? esgst.paginationNavigation.innerHTML : ``];
    reverseScrolling = esgst.es_r && esgst.discussionPath;
    if (reverseScrolling) {
        if (esgst.currentPage === 1 && esgst.paginationNavigation && document.referrer.match(/\/discussions/)) {
            for (i = 0, n = mainContext.children.length; i < n; ++i) {
                mainContext.children[0].remove();
            }
            esgst.currentComments = [];
            esgst.pagination.firstElementChild.firstElementChild.nextElementSibling.textContent = 0;
            if (esgst.paginationNavigation) {
                lastLink = esgst.paginationNavigation.lastElementChild;
                if (lastLink.classList.contains(`is-selected`) && lastLink.textContent.match(/Last/) && !esgst.lastPageLink) {
                    currentPage = parseInt(lastLink.getAttribute(`data-page-number`));
                } else {
                    currentPage = 999999999;
                }
            } else {
                currentPage = 999999999;
            }
            nextPage = currentPage;
            reversePages = true;
            ended = false;
            activateEndlessScrolling();
        } else {
            currentPage = esgst.currentPage;
            nextPage = currentPage - 1;
            pageBase = currentPage + 1;
            ended = nextPage === 0;
            activateEndlessScrolling();
        }
    } else {
        currentPage = esgst.currentPage;
        nextPage = currentPage + 1;
        pageBase = currentPage - 1;
        ended = (!esgst.paginationNavigation || esgst.paginationNavigation.lastElementChild.classList.contains(esgst.selectedClass));
        activateEndlessScrolling();
    }

    function activateEndlessScrolling() {
        var i, n;
        for (i = 0, n = mainContext.children.length; i < n; ++i) {
            mainContext.children[i].classList.add(`esgst-es-page-${currentPage}`);
        }
        refreshButton.addEventListener(`click`, refreshPage);
        refreshAllButton.addEventListener(`click`, refreshAllPages);
        pauseButton.addEventListener(`click`, pauseEndlessScrolling);
        resumeButton.addEventListener(`click`, resumeEndlessScrolling);
        scrollButton.addEventListener(`click`, animateScroll.bind(null, 0));
        if (esgst.paginationNavigation) {
            lastLink = esgst.paginationNavigation.lastElementChild;
            if (esgst.lastPageLink && esgst.lastPage !== pageIndex && !lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
                esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
            }
            setEsPaginationNavigation();
        }
        busy = false;
        if (getValue(`esPause`, false)) {
            pauseEndlessScrolling();
        } else {
            paused = false;
            document.addEventListener(`scroll`, loadNextPage);
            loadNextPage();
        }
        pageIndex = currentPage;
        document.addEventListener(`scroll`, changePaginationNavigation);
        esgst.checkEndlessScrolling = loadNextPage;
    }

    function loadNextPage() {
        if (!busy && !paused && !ended && scrollY >= document.body.offsetHeight - innerHeight * 2) {
            busy = true;
            document.removeEventListener(`scroll`, loadNextPage);
            progress = insertHtml(esgst.pagination.firstElementChild, `beforeEnd`, `
                <span class="esgst-bold"><i class="fa fa-circle-o-notch fa-spin"></i> Loading next page...</span>
            `);
            request(null, null, false, `${esgst.searchUrl}${nextPage}`, getNextPage.bind(null, false, false));
        }
    }

    function getNextPage(refresh, refreshAll, response) {
        var child, context, element, elements, fragment, i, n, oldN, rows, pagination, paginationNavigation;
        pagination = DOM.parse(response.responseText).getElementsByClassName(`pagination`)[0];
        context = pagination.previousElementSibling;
        rows = context.getElementsByClassName(`table__rows`)[0];
        if (rows) {
            context = rows;
        }
        paginationNavigation = pagination.getElementsByClassName(esgst.paginationNavigationClass)[0];
        if (reversePages) {
            paginations[0] = paginationNavigation.innerHTML;
            esgst.paginationNavigation.innerHTML = paginations[0];
            if (esgst.paginationNavigation) {
                lastLink = esgst.paginationNavigation.lastElementChild;
                if (esgst.lastPageLink && esgst.lastPage !== pageIndex && !lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
                    esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
                }
                setEsPaginationNavigation();
            }
            reversePages = false;
            if (currentPage === 999999999) {
                currentPage = parseInt(paginationNavigation.lastElementChild.getAttribute(`data-page-number`));
                nextPage = currentPage;
                pageBase = currentPage + 1;
                pageIndex = currentPage;
            }
        } else if (refresh) {
            pagination = paginations[(reverseScrolling ? pageBase - (refreshAll || pageIndex) : (refreshAll || pageIndex) - pageBase) - 1];
            if (paginationNavigation && pagination !== paginationNavigation.innerHTML) {
                paginations[(reverseScrolling ? pageBase - (refreshAll || pageIndex) : (refreshAll || pageIndex) - pageBase) - 1] = paginationNavigation.innerHTML;
                ended = false;
            }
        } else {
            paginations.push(paginationNavigation.innerHTML);
        }
        fragment = document.createDocumentFragment();
        if (reverseScrolling) {
            reverseComments(context);
        }
        if (!refreshAll) {
            loadEndlessFeatures(context, true, null, true);
            setESRemoveEntry(context);
        }
        n = context.children.length;
        for (i = 0; i < n; ++i) {
            child = context.children[0];
            child.classList.add(`esgst-es-page-${refresh ? refreshAll || pageIndex : nextPage}`);
            fragment.appendChild(child);
        }
        if (refresh) {
            elements = document.getElementsByClassName(`esgst-es-page-${refreshAll || pageIndex}`);
            oldN = elements.length;
            for (i = 1; i < oldN; ++i) {
                elements[0].remove();
            }
            element = elements[0];
            mainContext.insertBefore(fragment, element);
            element.remove();
            if (!refreshAll) {
                if (esgst.gf && esgst.gf.filteredCount) {
                    updateGfCount(esgst.gf);
                }
                if (esgst.df && esgst.df.filteredCount) {
                    updateDfCount(esgst.df);
                }
                if (esgst.ts && !esgst.us) {
                    sortTsTables();
                }
            }
            esgst.pagination.firstElementChild.firstElementChild.nextElementSibling.textContent = (parseInt(esgst.pagination.firstElementChild.firstElementChild.nextElementSibling.textContent.replace(/,/g, ``)) - oldN + n).toString().replace(/\B(?=(\d{3})+(?!\d))/g, `,`);
            if (refreshAll) {
                count += 1;
            } else {
                refreshButton.addEventListener(`click`, refreshPage);
                refreshButton.innerHTML = `
                    <i class="fa fa-refresh"></i>
                    <i class="fa fa-map-marker"></i>
                `;
            }
        } else {
            if (divisors) {
                mainContext.insertAdjacentHTML(`beforeEnd`, `
                    <div class="esgst-page-heading esgst-es-page-divisor">
                        <div class="page__heading__breadcrumbs page_heading_breadcrumbs">
                            <a href="${esgst.searchUrl}${nextPage}">Page ${nextPage}</a>
                        </div>
                    </div>
                `);
            }
            mainContext.appendChild(fragment);
            if (esgst.ts && !esgst.us) {
                sortTsTables();
            }
            esgst.pagination.firstElementChild.firstElementChild.nextElementSibling.textContent = (parseInt(esgst.pagination.firstElementChild.firstElementChild.nextElementSibling.textContent.replace(/,/g, ``)) + n).toString().replace(/\B(?=(\d{3})+(?!\d))/g, `,`);
            progress.remove();
            if (reverseScrolling) {
                --nextPage;
                busy = false;
                if (nextPage <= 0) {
                    ended = true;
                } else if (!paused) {
                    document.addEventListener(`scroll`, loadNextPage);
                    loadNextPage();
                }
            } else {
                ++nextPage;
                busy = false;
                if (paginationNavigation.lastElementChild.classList.contains(esgst.selectedClass)) {
                    ended = true;
                } else if (!paused) {
                    document.addEventListener(`scroll`, loadNextPage);
                    loadNextPage();
                }
            }
        }
    }

    function changePaginationNavigation() {
        var currentElement, nextElement, pagination;
        if (esgst.paginationNavigation && paginations.length > 0) {
            if (scrollY + innerHeight === document.documentElement.offsetHeight) {
                pageIndex = reverseScrolling ? pageBase - paginations.length : pageBase + paginations.length;
            } else {
                currentElement = document.querySelector(`.esgst-es-page-${pageIndex}:not(.esgst-hidden)`);
                nextElement = document.querySelector(`.esgst-es-page-${reverseScrolling ? pageIndex - 1 : pageIndex + 1}:not(.esgst-hidden)`);
                if (currentElement) {
                    if (scrollY + esgst.commentsTop < currentElement.offsetTop) {
                        if (pageIndex !== currentPage) {
                            pageIndex = reverseScrolling ? pageIndex + 1 : pageIndex - 1;
                        }
                    } else if (nextElement && scrollY + esgst.commentsTop >= nextElement.offsetTop) {
                        pageIndex = reverseScrolling ? pageIndex - 1 : pageIndex + 1;
                    }
                } else if (nextElement && scrollY + esgst.commentsTop >= nextElement.offsetTop) {
                    pageIndex = reverseScrolling ? pageIndex - 1 : pageIndex + 1;
                } else if (pageIndex !== currentPage) {
                    pageIndex = reverseScrolling ? pageIndex + 1 : pageIndex - 1;
                }
            }
            pagination = paginations[(reverseScrolling ? pageBase - pageIndex : pageIndex - pageBase) - 1] || paginations[0];
            if (esgst.paginationNavigation.innerHTML !== pagination) {
                esgst.paginationNavigation.innerHTML = pagination;
                lastLink = esgst.paginationNavigation.lastElementChild;
                if (esgst.lastPageLink && esgst.lastPage !== pageIndex && !lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
                    esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
                }
                setEsPaginationNavigation();
            }
        }
    }

    function pauseEndlessScrolling() {
        if (!ended) {
            document.removeEventListener(`scroll`, loadNextPage);
        }
        pauseButton.classList.add(`esgst-hidden`);
        resumeButton.classList.remove(`esgst-hidden`);
        paused = true;
        setValue(`esPause`, paused);
    }

    function resumeEndlessScrolling() {
        resumeButton.classList.add(`esgst-hidden`);
        pauseButton.classList.remove(`esgst-hidden`);
        paused = false;
        setValue(`esPause`, paused);
        if (!ended) {
            document.addEventListener(`scroll`, loadNextPage);
            loadNextPage();
        }
    }

    function refreshPage() {
        refreshButton.removeEventListener(`click`, refreshPage);
        refreshButton.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
        `;
        request(null, null, false, `${esgst.searchUrl}${pageIndex}`, getNextPage.bind(null, true, false));
    }

    function refreshAllPages() {
        var i, page, pagination;
        refreshAllButton.removeEventListener(`click`, refreshAllPages);
        refreshAllButton.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
        `;
        count = 0;
        total = paginations.length;
        for (i = 0; i < total; ++i) {
            pagination = paginations[i];
            page = reverseScrolling ? pageBase - (i + 1) : pageBase + (i + 1);
            request(null, null, false, `${esgst.searchUrl}${page}`, getNextPage.bind(null, true, page));
        }
        setTimeout(checkRefreshComplete, 250);
    }

    function checkRefreshComplete() {
        if (count >= total) {
            loadEndlessFeatures(mainContext, true);
            setESRemoveEntry(mainContext);
            refreshAllButton.addEventListener(`click`, refreshAllPages);
            refreshAllButton.innerHTML = `
                <i class="fa fa-refresh"></i>
            `;
            if (esgst.gf && esgst.gf.filteredCount) {
                updateGfCount(esgst.gf);
            }
            if (esgst.df && esgst.df.filteredCount) {
                updateDfCount(esgst.df);
            }
            if (esgst.ts && !esgst.us) {
                sortTsTables();
            }
        } else {
            setTimeout(checkRefreshComplete, 250);
        }
    }
}

function animateScroll(y) {
    // From https://stackoverflow.com/a/26808520/8115112

    var currentTime, time;
    currentTime = 0;
    if (y > 0) {
        y -= esgst.commentsTop;
    }
    time = Math.max(0.1, Math.min(Math.abs(scrollY - y) / 2000, 0.8));

    function tick() {
        var p;
        currentTime += 1 / 60;
        p = currentTime / time;
        if (p < 1) {
            requestAnimationFrame(tick);
            scrollTo(0, scrollY + ((y - scrollY) * ((p /= 0.5) < 1 ? 0.5 * Math.pow(p, 5) : 0.5 * (Math.pow((p - 2), 5) + 2))));
        } else {
            scrollTo(0, y);
        }
    }

    tick();
}

function reverseComments(context) {
    var i, n;
    var frag = document.createDocumentFragment();
    for (i = 0, n = context.children.length; i < n; ++i) {
        frag.appendChild(context.lastElementChild);
    }
    context.appendChild(frag);
}

function setEsPaginationNavigation() {
    var matches, i, n;
    matches = esgst.paginationNavigation.children;
    for (i = 0, n = matches.length; i < n; ++i) {
        matches[i].addEventListener(`click`, setEsPaginationNavigationItem);
    }
}

function setEsPaginationNavigationItem(event) {
    var page;
    event.preventDefault();
    page = event.currentTarget.getAttribute(`data-page-number`);
    element = document.querySelector(`.esgst-es-page-${page}:not(.esgst-hidden)`);
    if (element) {
        animateScroll(element.offsetTop);
    } else {
        location.href = event.currentTarget.getAttribute(`href`);
    }
}

function setESRemoveEntry(Context) {
    var Matches, I, N;
    Matches = Context.getElementsByClassName(`table__row-inner-wrap`);
    for (I = 0, N = Matches.length; I < N; ++I) {
        removeESEntry(Matches[I]);
    }
}

function removeESEntry(Context) {
    var Default, Loading, Complete, Data;
    Default = Context.getElementsByClassName(`table__remove-default`)[0];
    if (Default) {
        Loading = Default.nextElementSibling;
        Complete = Loading.nextElementSibling;
        Default.addEventListener(`click`, function () {
            var Values, I, N;
            Default.classList.toggle(`is-hidden`);
            Loading.classList.toggle(`is-hidden`);
            Values = Context.getElementsByTagName(`input`);
            Data = ``;
            for (I = 0, N = Values.length; I < N; ++I) {
                Data += `${Values[I].getAttribute(`name`)}=${Values[I].value}${I < (N - 1) ? `&` : ``}`;
            }
            request(Data, null, false, `/ajax.php`, function (Response) {
                Loading.classList.toggle(`is-hidden`);
                if (JSON.parse(Response.responseText).type === `success`) {
                    Context.classList.add(`is-faded`);
                    Complete.classList.toggle(`is-hidden`);
                } else {
                    Default.classList.toggle(`is-hidden`);
                }
            });
        });
    }
}

function loadEndlessFeatures(Context, main, source, endless) {
    for (var i = 0, n = esgst.endlessFeatures.length; i < n; ++i) {
        esgst.endlessFeatures[i](Context, main, source, endless);
    }
}

/* [STO] Same Tab Opener */

function loadSto() {
    esgst.endlessFeatures.push(setStoLinks);
    setStoLinks(document);
}

function setStoLinks(context) {
    var elements, i, n;
    elements = context.querySelectorAll(`[target="_blank"]`);
    for (i = 0, n = elements.length; i < n; ++i) {
        elements[i].removeAttribute(`target`);
    }
}

/*
    * Helper Functions
    */

function createAlert(message) {
    var popup;
    popup = new Popup(`fa-exclamation`, message, true);
    popup.open();
}

function createConfirmation(message, onYes, onNo) {
    var callback, popup;
    callback = onNo;
    popup = new Popup(`fa-question`, message, true);
    popup.description.appendChild(new ButtonSet(`green`, ``, `fa-check`, ``, `Yes`, ``, function () {
        callback = onYes;
        popup.close();
    }).set);
    popup.description.appendChild(new ButtonSet(`red`, ``, `fa-times`, ``, `No`, ``, function () {
        callback = onNo;
        popup.close();
    }).set);
    popup.onClose = function () {
        if (callback) {
            callback();
        }
    };
    popup.open();
}

function multiChoice(choice1Color, choice1Icon, choice1Title, choice2Color, choice2Icon, choice2Title, title, onChoice1, onChoice2) {
    if (esgst.settings.cfh_img_remember) {
        if (esgst.cfh_img_choice === 1) {
            onChoice1();
        } else {
            onChoice2();
        }
    } else {
        let popup = new Popup(`fa-list`, title, true);
        new ToggleSwitch(popup.description, `cfh_img_remember`, false, `Never ask again.`, false, false, `Remembers which option you choose forever.`, esgst.settings.cfh_img_remember);
        popup.description.appendChild(new ButtonSet(choice1Color, ``, choice1Icon, ``, choice1Title, ``, callback => {
            if (esgst.settings.cfh_img_remember) {
                setValue(`cfh_img_choice`, 1);
                esgst.cfh_img_choice = 1;
            }
            callback();
            popup.close();
            onChoice1();
        }).set);
        popup.description.appendChild(new ButtonSet(choice2Color, ``, choice2Icon, ``, choice2Title, ``, callback => {
            if (esgst.settings.cfh_img_remember) {
                setValue(`cfh_img_choice`, 2);
                esgst.cfh_img_choice = 2;
            }
            callback();
            popup.close();
            onChoice2();
        }).set);
        popup.open();
    }
}

function createFadeMessage(context, message) {
    context.textContent = message;
    setTimeout(function () {
        context.textContent = ``;
    }, 2000);
}

/* Data Management */

function loadDataManagement(openInTab, type) {
    var container, context, i, input, n, option, options, popup, section;
    dm = {
        type: type
    };
    dm[type] = true;
    switch (type) {
        case `import`:
            icon = `fa-arrow-circle-up`;
            onClick = loadImportFile,
            title = `Import`
            break;
        case `export`:
            icon = `fa-arrow-circle-down`;
            onClick = manageData,
            title = `Export`;
            break;
        case `delete`:
            icon = `fa-trash`;
            onClick = confirmDataDeletion,
            title = `Delete`;
            break;
    }
    if (openInTab) {
        document.body.className = `esgst-tab-menu`;
        context = container = document.body;
        context.innerHTML = ``;
    } else {
        popup = new Popup(icon, title, true, true);
        popup.description.classList.add(`esgst-text-left`);
        context = popup.scrollable;
        container = popup.description;
    }
    dm.computerSpace = insertHtml(container, `afterBegin`, `
        <div>Total: <span class="esgst-bold"></span></div>
    `);
    section = insertHtml(context, `beforeEnd`, `
        ${createSMSections(1, [{
            Title: title
        }])}
    `);
    dm.switches = {};
    dm.options = [
        {
            check: true,
            key: `decryptedGiveaways`,
            name: `Decrypted Giveaways`
        },
        {
            check: esgst.sg,
            key: `discussions`,
            name: `Discussions`,
            options: [
                {
                    key: `discussions_ct`,
                    name: `Comment Tracker`
                },
                {
                    key: `discussions_df`,
                    name: `Discussion Filters`
                },
                {
                    key: `discussions_dh`,
                    name: `Discussion Highlighter`
                },
                {
                    key: `discussions_gdttt`,
                    name: `Giveaways/Discussions/Tickets/Trades Tracker`
                }
            ]
        },
        {
            check: true,
            key: `emojis`,
            name: `Emojis`
        },
        {
            check: esgst.sg,
            key: `entries`,
            name: `Entries`
        },
        {
            check: true,
            key: `games`,
            name: `Games`,
            options: [
                {
                    key: `games_egh`,
                    name: `Entered Games Highlighter`
                },
                {
                    key: `games_gt`,
                    name: `Game Tags`
                },
                {
                    key: `games_itadi`,
                    name: `Is There Any Data? Info`
                }
            ]
        },
        {
            check: esgst.sg,
            key: `giveaways`,
            name: `Giveaways`,
            options: [
                {
                    key: `giveaways_ct`,
                    name: `Comment Tracker`
                },
                {
                    key: `giveaways_gdttt`,
                    name: `Giveaways/Discussions/Tickets/Trades Tracker`
                },
                {
                    key: `giveaways_gf`,
                    name: `Giveaway Filters`
                },
                {
                    key: `giveaways_ggl`,
                    name: `Giveaway Groups Loader`
                }
            ]
        },
        {
            check: esgst.sg,
            key: `groups`,
            name: `Groups`,
            options: [
                {
                    key: `groups_sgg`,
                    name: `Stickied Giveaway Groups`
                }
            ]
        },
        {
            check: esgst.sg,
            key: `rerolls`,
            name: `Rerolls`
        },
        {
            check: true,
            key: `savedReplies`,
            name: `Saved Replies`
        },
        {
            check: true,
            key: `settings`,
            name: `Settings`
        },
        {
            check: true,
            key: `sgCommentHistory`,
            name: `SG Comment History`
        },
        {
            check: true,
            key: `stCommentHistory`,
            name: `ST Comment History`
        },
        {
            check: esgst.sg,
            key: `templates`,
            name: `Templates`
        },
        {
            check: esgst.sg,
            key: `tickets`,
            name: `Tickets`,
            options: [
                {
                    key: `tickets_ct`,
                    name: `Comment Tracker`
                },
                {
                    key: `tickets_gdttt`,
                    name: `Giveaways/Discussions/Tickets/Trades Tracker`
                }
            ]
        },
        {
            check: esgst.st,
            key: `trades`,
            name: `Trades`,
            options: [
                {
                    key: `trades_ct`,
                    name: `Comment Tracker`
                },
                {
                    key: `trades_gdttt`,
                    name: `Giveaways/Discussions/Tickets/Trades Tracker`
                }
            ]
        },
        {
            check: true,
            key: `users`,
            name: `Users`,
            options: [
                {
                    key: `users_namwc`,
                    name: `Not Activated/Multiple Wins Checker`
                },
                {
                    key: `users_nrf`,
                    name: `Not Received Finder`
                },
                {
                    key: `users_uf`,
                    name: `User Filters`
                },
                {
                    key: `users_giveaways`,
                    name: `Giveaways Data`
                },
                {
                    key: `users_notes`,
                    name: `User Notes`
                },
                {
                    key: `users_tags`,
                    name: `User Tags`
                },
                {
                    key: `users_wbc`,
                    name: `Whitelist/Blacklist Checker`
                }
            ]
        },
        {
            check: esgst.sg,
            key: `winners`,
            name: `Winners`
        }
    ];
    for (i = 0, n = dm.options.length; i < n; ++i) {
        option = dm.options[i];
        if (option.check) {
            section.lastElementChild.appendChild(getDataMenu(option, dm.switches, type));
        }
    }
    if (type === `import`) {
        dm.input = insertHtml(container, `beforeEnd`, `<input type="file"/>`);
        new ToggleSwitch(container, `importAndMerge`, false, `Merge`, false, false, `Merges the current data with the imported data instead of replacing`, esgst.settings.importAndMerge);
        let select = new ToggleSwitch(container, `exportBackup`, false, `Export backup to <select><option>Computer</option><option>Dropbox</option></select>`, false, false, `Exports the current data as a backup`, esgst.settings.exportBackup).name.firstElementChild;
        select.selectedIndex = esgst.settings.exportBackupIndex;
        select.addEventListener(`change`, () => {
            setSetting(`exportBackupIndex`, select.selectedIndex);
        });
    } else if (type === `delete`) {
        let select = new ToggleSwitch(container, `exportBackup`, false, `Export backup to <select><option>Computer</option><option>Dropbox</option></select>`, false, false, `Exports the current data as a backup`, esgst.settings.exportBackup).name.firstElementChild;
        select.selectedIndex = esgst.settings.exportBackupIndex;
        select.addEventListener(`change`, () => {
            setSetting(`exportBackupIndex`, select.selectedIndex);
        });
    }
    dm.message = insertHtml(container, `beforeEnd`, `<div class="esgst-description"></div>`);
    dm.warning = insertHtml(container, `beforeEnd`, `<div class="esgst-description esgst-warning"></div>`);
    container.appendChild(new ButtonSet(`green`, `grey`, `fa-circle`, `fa-circle-o-notch fa-spin`, `Select All`, ``, selectSwitches.bind(null, dm.switches, `enable`)).set);
    container.appendChild(new ButtonSet(`green`, `grey`, `fa-circle-o`, `fa-circle-o-notch fa-spin`, `Select None`, ``, selectSwitches.bind(null, dm.switches, `disable`)).set);
    container.appendChild(new ButtonSet(`green`, `grey`, `fa-dot-circle-o`, `fa-circle-o-notch fa-spin`, `Select Inverse`, ``, selectSwitches.bind(null, dm.switches, `toggle`)).set);
    container.appendChild(new ButtonSet(`green`, `grey`, icon, `fa-circle-o-notch fa-spin`, title, `${title}ing...`, onClick.bind(null, dm, false, false, false, false)).set);
    if (type !== `delete`) {
        container.appendChild(new ButtonSet(`green`, `grey`, `fa-dropbox`, `fa-circle-o-notch fa-spin`, `${title} (Dropbox)`, `${title}ing...`, onClick.bind(null, dm, true, false, false, false)).set);
    }
    if (!openInTab) {
        popup.open();
    }
    manageData(dm, false, false, false, true);
}

function getDataMenu(option, switches, type) {
    var i, m, menu, n, options, toggleSwitch;
    menu = document.createElement(`div`);
    switches[option.key] = toggleSwitch = new ToggleSwitch(menu, `${type}_${option.key}`, false, option.name, false, false, null, esgst.settings[`${type}_${option.key}`]);
    switches[option.key].size = insertHtml(switches[option.key].name, `beforeEnd`, ` <span class="esgst-bold"></span>`);
    if (option.options) {
        options = insertHtml(menu, `beforeEnd`, `
            <div class="esgst-form-row-indent SMFeatures esgst-hidden"></div>
        `);
        for (i = 0, n = option.options.length; i < n; ++i) {
            m = getDataMenu(option.options[i], switches, type);
            options.appendChild(m);
            toggleSwitch.dependencies.push(m);
        }
        if (esgst.settings[`${type}_${option.key}`]) {
            options.classList.remove(`esgst-hidden`);
        }
    }
    toggleSwitch.onEnabled = function () {
        if (options) {
            options.classList.remove(`esgst-hidden`);
        }
    };
    toggleSwitch.onDisabled = function () {
        if (options) {
            options.classList.add(`esgst-hidden`);
        }
    }
    return menu;
}

function loadImportFile(dm, dropbox, google, outlook, space, callback) {
    var file;
    if (dropbox) {
        if (getValue(`dropboxToken`)) {
            checkDropboxComplete(null, dm, null, callback);
        } else {
            checkDropboxComplete(null, dm, open(`https://www.dropbox.com/oauth2/authorize?redirect_uri=https://${location.hostname}/esgst/dropbox&response_type=token&client_id=nix7kvchwa8wdvj`), callback);
        }
    } else {
        file = dm.input.files[0];
        if (file) {
            if (file.name.match(/esgst_data_.*?\.json/)) {
                dm.reader = new FileReader();
                dm.reader.readAsText(file);
                dm.reader.onload = readImportFile.bind(null, dm, dropbox, google, outlook, space, callback);
            } else {
                createFadeMessage(dm.warning, `Invalid file!`);
                callback();
            }
        } else {
            createFadeMessage(dm.warning, `No file was loaded!`);
            callback();
        }
    }
}

function readImportFile(dm, dropbox, google, outlook, space, callback) {
    try {
        if (dm.reader) {
            dm.data = JSON.parse(dm.reader.result);
        }
        createConfirmation(`Are you sure you want to import the selected data?`, manageData.bind(null, dm, dropbox, google, outlook, space, callback), callback);
    } catch (error) {
        createFadeMessage(dm.warning, `Cannot parse file!`);
        callback();
    }
}

function confirmDataDeletion(dm, dropbox, google, outlook, space, callback) {
    createConfirmation(`Are you sure you want to delete the selected data?`, manageData.bind(null, dm, dropbox, google, outlook, space, callback), callback);
}

function convertBytes(bytes) {
    if (bytes < 1024) {
        return `${bytes} B`;
    } else {
        bytes /= 1024;
        if (bytes < 1024) {
            return `${Math.round(bytes * 100) / 100} KB`;
        } else {
            return `${Math.round(bytes / 1024 * 100) / 100} MB`;
        }
    }
}

function manageData(dm, dropbox, google, outlook, space, callback) {
    var data, dataKey, i, id, j, k, l, mergedData, mergedDataKey, mergedDataValue, newData, newDataKey, newDataValue, numMerged, numNew, numOld, numOptions, numTags, oldData, oldDataKey, oldDataValue, option, optionKey, tag, tags, username, value, valueKey, values;
    data = {};
    let totalGM = 0;
    let size = 0;
    for (i = 0, numOptions = dm.options.length; i < numOptions; ++i) {
        option = dm.options[i];
        if (option.check) {
            optionKey = option.key;
            if (space || esgst.settings[`${dm.type}_${optionKey}`]) {
                values = null;
                switch (optionKey) {
                    case `decryptedGiveaways`:
                    case `settings`:
                        data[optionKey] = JSON.parse(getValue(optionKey, `{}`));
                        if (!space) {
                            if (dm.import) {
                                newData = dm.data[optionKey];
                                if (newData) {
                                    if (esgst.settings.importAndMerge) {
                                        mergedData = data[optionKey];
                                        for (newDataKey in newData) {
                                            mergedData[newDataKey] = newData[newDataKey];
                                        }
                                        setValue(optionKey, JSON.stringify(mergedData));
                                    } else {
                                        setValue(optionKey, JSON.stringify(newData));
                                    }
                                }
                            } else if (dm.delete) {
                                delValue(optionKey);
                            }
                        }
                        size = (new TextEncoder(`utf-8`).encode(getValue(optionKey, ``))).length;
                        totalGM += size;
                        dm.switches[optionKey].size.textContent = convertBytes(size);
                        break;
                    case `discussions`:
                        if (!values) {
                            values = {
                                ct: [`count`, `readComments`],
                                df: [`hidden`],
                                dh: [`highlighted`],
                                gdttt: [`visited`]
                            };
                        }
                    case `giveaways`:
                        if (!values) {
                            values = {
                                ct: [`count`, `readComments`],
                                gdttt: [`visited`],
                                gf: [`hidden`],
                                ggl: [`groups`],
                                main: [`code`, `comments`, `copies`, `creator`, `endTime`, `entries`, `gameId`, `gameName`, `gameSteamId`, `gameType`, `group`, `inviteOnly`, `level`, `points`, `regionRestricted`, `started`, `startTime`, `whitelist`, `winners`]
                            };
                        }
                    case `groups`:
                        if (!values) {
                            values = {
                                main: [`avatar`, `code`, `member`, `name`],
                                sgg: [`stickied`]
                            };
                        }
                    case `tickets`:
                        if (!values) {
                            values = {
                                ct: [`count`, `readComments`],
                                gdttt: [`visited`]
                            };
                        }
                    case `trades`:
                        if (!values) {
                            values = {
                                ct: [`count`, `readComments`],
                                gdttt: [`visited`]
                            };
                        }
                        mergedData = JSON.parse(getValue(optionKey, `{}`));
                        data[optionKey] = {};
                        for (mergedDataKey in mergedData) {
                            newData = {};
                            for (value in values) {
                                if (esgst.settings[`${dm.type}_${optionKey}_${value}`] || (!dm.delete && value === `main`)) {
                                    for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                        valueKey = values[value][j];
                                        mergedDataValue = mergedData[mergedDataKey][valueKey];
                                        if (typeof mergedDataValue !== `undefined`) {
                                            newData[valueKey] = mergedDataValue;
                                            if (!space && dm.delete) {
                                                delete mergedData[mergedDataKey][valueKey];
                                            }
                                        }
                                    }
                                }
                            }
                            if (Object.keys(newData).length > 0) {
                                data[optionKey][mergedDataKey] = newData;
                            }
                            if (!space && dm.delete && Object.keys(mergedData[mergedDataKey]).length <= 0) {
                                delete mergedData[mergedDataKey];
                            }
                        }
                        if (!space) {
                            if (dm.import) {
                                newData = dm.data[optionKey];
                                if (newData) {
                                    for (newDataKey in newData) {
                                        if (!mergedData[newDataKey]) {
                                            mergedData[newDataKey] = {};
                                        }
                                        for (value in values) {
                                            if (esgst.settings[`${dm.type}_${optionKey}_${value}`] || (!dm.delete && value === `main`)) {
                                                if (esgst.settings.importAndMerge) {
                                                    for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                        valueKey = values[value][j];
                                                        if (valueKey === `readComments`) {
                                                            if (mergedData[newDataKey].readComments) {
                                                                for (id in mergedData[newDataKey].readComments) {
                                                                    if (newData[newDataKey].readComments[id] > mergedData[newDataKey].readComments[id]) {
                                                                        mergedData[newDataKey].readComments[id] = newData[newDataKey].readComments[id];
                                                                    }
                                                                }
                                                            } else {
                                                                mergedData[newDataKey].readComments = newData[newDataKey].readComments;
                                                            }
                                                        } else {
                                                            mergedData[newDataKey][valueKey] = newData[newDataKey][valueKey];
                                                        }
                                                    }
                                                } else {
                                                    for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                        valueKey = values[value][j];
                                                        mergedData[newDataKey][valueKey] = newData[newDataKey][valueKey];
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    setValue(optionKey, JSON.stringify(mergedData));
                                }
                            } else if (dm.delete) {
                                setValue(optionKey, JSON.stringify(mergedData));
                            }
                        }
                        size = (new TextEncoder(`utf-8`).encode(getValue(optionKey, ``))).length;
                        totalGM += size;
                        dm.switches[optionKey].size.textContent = convertBytes(size);
                        break;
                    case `emojis`:
                        data.emojis = getValue(`emojis`, ``);
                        if (!space) {
                            if (dm.import) {
                                newData = dm.data.emojis;
                                if (newData) {
                                    if (esgst.settings.importAndMerge) {
                                        mergedData = data.emojis;
                                        newData = DOM.parse(newData).getElementsByTagName(`span`);
                                        for (j = 0, numNew = newData.length; j < numNew; ++j) {
                                            newDataValue = newData[j].outerHTML;
                                            if (!mergedData.match(newDataValue)) {
                                                mergedData = `${mergedData}${newDataValue}`;
                                            }
                                        }
                                        setValue(`emojis`, mergedData);
                                    } else {
                                        setValue(`emojis`, newData);
                                    }
                                }
                            } else if (dm.delete) {
                                delValue(`emojis`);
                            }
                        }
                        size = (new TextEncoder(`utf-8`).encode(getValue(`emojis`, ``))).length;
                        totalGM += size;
                        dm.switches[optionKey].size.textContent = convertBytes(size);
                        break;
                    case `entries`:
                    case `templates`:
                    case `savedReplies`:
                        data[optionKey] = JSON.parse(optionKey === `savedReplies` ? getValue(`savedReplies`, `[]`) : getValue(optionKey, `[]`));
                        if (!space) {
                            if (dm.import) {
                                newData = dm.data[optionKey];
                                if (newData) {
                                    if (esgst.settings.importAndMerge) {
                                        dataKey = optionKey === `entries` ? `timestamp` : `name`;
                                        mergedData = data[optionKey];
                                        for (j = 0, numNew = newData.length; j < numNew; ++j) {
                                            newDataValue = newData[j];
                                            for (k = 0, numMerged = mergedData.length; k < numMerged && mergedData[k][dataKey] !== newDataValue[dataKey]; ++k);
                                            if (k < numMerged) {
                                                mergedData[k] = newDataValue;
                                            } else {
                                                mergedData.push(newDataValue);
                                            }
                                        }
                                        if (optionKey === `savedReplies`) {
                                            setValue(optionKey, JSON.stringify(mergedData));
                                        } else {
                                            if (optionKey === `entries`) {
                                                mergedData = sortArrayByNumberKey(mergedData, `timestamp`);
                                            }
                                            setValue(optionKey, JSON.stringify(mergedData));
                                        }
                                    } else {
                                        if (optionKey === `savedReplies`) {
                                            setValue(`savedReplies`, JSON.stringify(newData));
                                        } else {
                                            setValue(optionKey, JSON.stringify(newData));
                                        }
                                    }
                                }
                            } else if (dm.delete) {
                                if (optionKey === `savedReplies`) {
                                    delValue(`savedReplies`);
                                } else {
                                    delValue(optionKey);
                                }
                            }
                        }
                        size = (new TextEncoder(`utf-8`).encode(getValue(optionKey, ``))).length;
                        totalGM += size;
                        dm.switches[optionKey].size.textContent = convertBytes(size);
                        break;
                    case `games`:
                        values = {
                            gt: [`tags`],
                            egh: [`entered`],
                            itadi: [`itadi`],
                            main: [`reducedCV`, `noCV`, `hidden`, `ignored`, `owned`, `wishlisted`]
                        };
                        data.games = {
                            apps: {},
                            subs: {}
                        };
                        mergedData = JSON.parse(getValue(`games`, `{
                            "apps": {}
                            "subs": {}
                        }`));
                        for (mergedDataKey in mergedData.apps) {
                            mergedDataValue = mergedData.apps[mergedDataKey];
                            newData = {};
                            for (value in values) {
                                if (esgst.settings[`${dm.type}_games_${value}`] || (!dm.delete && value === `main`)) {
                                    for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                        valueKey = values[value][j];
                                        newDataValue = mergedDataValue[valueKey];
                                        if (typeof newDataValue !== `undefined`) {
                                            newData[valueKey] = newDataValue;
                                            if (!space && dm.delete) {
                                                delete mergedDataValue[valueKey];
                                            }
                                        }
                                    }
                                }
                            }
                            if (Object.keys(newData).length > 0) {
                                data.games.apps[mergedDataKey] = newData;
                            }
                            if (!space && dm.delete && Object.keys(mergedDataValue).length <= 0) {
                                delete mergedData.apps[mergedDataKey];
                            }
                        }
                        for (mergedDataKey in mergedData.subs) {
                            mergedDataValue = mergedData.subs[mergedDataKey];
                            newData = {};
                            for (value in values) {
                                if (esgst.settings[`${dm.type}_games_${value}`]) {
                                    for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                        valueKey = values[value][j];
                                        newDataValue = mergedDataValue[valueKey];
                                        if (typeof newDataValue !== `undefined`) {
                                            newData[valueKey] = newDataValue;
                                            if (!space && dm.delete) {
                                                delete mergedDataValue[valueKey];
                                            }
                                        }
                                    }
                                }
                            }
                            if (Object.keys(newData).length > 0) {
                                data.games.subs[mergedDataKey] = newData;
                            }
                            if (!space && dm.delete && Object.keys(mergedDataValue).length <= 0) {
                                delete mergedData.subs[mergedDataKey];
                            }
                        }
                        if (!space) {
                            if (dm.import) {
                                newData = dm.data.games;
                                if (newData) {
                                    for (newDataKey in newData.apps) {
                                        newDataValue = newData.apps[newDataKey];
                                        if (!mergedData.apps[newDataKey]) {
                                            mergedData.apps[newDataKey] = {};
                                        }
                                        mergedDataValue = mergedData.apps[newDataKey];
                                        for (value in values) {
                                            if (esgst.settings[`${dm.type}_games_${value}`]) {
                                                for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                    valueKey = values[value][j];
                                                    if (typeof newDataValue[valueKey] !== `undefined`) {
                                                        if (esgst.settings.importAndMerge) {
                                                            switch (valueKey) {
                                                                case `entered`:
                                                                    mergedDataValue.entered = true;
                                                                    break;
                                                                case `itadi`:
                                                                    if (mergedDataValue.itadi) {
                                                                        if (newDataValue.itadi.lastCheck > mergedDataValue.itadi.lastCheck) {
                                                                            mergedDataValue.itadi = newDataValue.itadi;
                                                                        }
                                                                    } else {
                                                                        mergedDataValue.itadi = newDataValue.itadi;
                                                                    }
                                                                    break;
                                                                case `tags`:
                                                                    if (mergedDataValue.tags) {
                                                                        tags = newDataValue.tags;
                                                                        for (k = 0, numTags = tags.length; k < numTags; ++k) {
                                                                            tag = tags[k];
                                                                            if (mergedDataValue.tags.indexOf(tag) < 0) {
                                                                                mergedDataValue.tags.push(tag);
                                                                            }
                                                                        }
                                                                    } else {
                                                                        mergedDataValue.tags = newDataValue.tags;
                                                                    }
                                                                    break;
                                                                default:
                                                                    if (newDataValue.lastCheck > mergedDataValue.lastCheck) {
                                                                        mergedDataValue[valueKey] = newDataValue[valueKey];
                                                                    }
                                                                    break;
                                                            }
                                                        } else {
                                                            mergedDataValue[valueKey] = newDataValue[valueKey];
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    for (newDataKey in newData.subs) {
                                        newDataValue = newData.subs[newDataKey];
                                        if (!mergedData.subs[newDataKey]) {
                                            mergedData.subs[newDataKey] = {};
                                        }
                                        mergedDataValue = mergedData.subs[newDataKey];
                                        for (value in values) {
                                            if (esgst.settings[`${dm.type}_games_${value}`]) {
                                                for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                    valueKey = values[value][j];
                                                    if (typeof newDataValue[valueKey] !== `undefined`) {
                                                        if (esgst.settings.importAndMerge) {
                                                            switch (valueKey) {
                                                                case `entered`:
                                                                    mergedDataValue.entered = true;
                                                                    break;
                                                                case `itadi`:
                                                                    if (mergedDataValue.itadi) {
                                                                        if (newDataValue.itadi.lastCheck > mergedDataValue.itadi.lastCheck) {
                                                                            mergedDataValue.itadi = newDataValue.itadi;
                                                                        }
                                                                    } else {
                                                                        mergedDataValue.itadi = newDataValue.itadi;
                                                                    }
                                                                    break;
                                                                case `tags`:
                                                                    if (mergedDataValue.tags) {
                                                                        tags = newDataValue.tags;
                                                                        for (k = 0, numTags = tags.length; k < numTags; ++k) {
                                                                            tag = tags[k];
                                                                            if (mergedDataValue.tags.indexOf(tag) < 0) {
                                                                                mergedDataValue.tags.push(tag);
                                                                            }
                                                                        }
                                                                    } else {
                                                                        mergedDataValue.tags = newDataValue.tags;
                                                                    }
                                                                    break;
                                                                default:
                                                                    if (newDataValue.lastCheck > mergedDataValue.lastCheck) {
                                                                        mergedDataValue[valueKey] = newDataValue[valueKey];
                                                                    }
                                                                    break;
                                                            }
                                                        } else {
                                                            mergedDataValue[valueKey] = newDataValue[valueKey];
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    setValue(`games`, JSON.stringify(mergedData));
                                }
                            } else if (dm.delete) {
                                setValue(`games`, JSON.stringify(mergedData));
                            }
                        }
                        size = (new TextEncoder(`utf-8`).encode(getValue(`games`, ``))).length;
                        totalGM += size;
                        dm.switches[optionKey].size.textContent = convertBytes(size);
                        break;
                    case `rerolls`:
                        data.rerolls = JSON.parse(getValue(`rerolls`, `[]`));
                        if (!space) {
                            if (dm.import) {
                                newData = dm.data.rerolls;
                                if (newData) {
                                    if (esgst.settings.importAndMerge) {
                                        mergedData = data.rerolls;
                                        for (j = 0, numNew = newData.length; j < numNew; ++j) {
                                            newDataValue = newData[j];
                                            if (mergedData.indexOf(newDataValue) < 0) {
                                                mergedData.push(newDataValue);
                                            }
                                        }
                                        setValue(`rerolls`, JSON.stringify(mergedData));
                                    } else {
                                        setValue(`rerolls`, JSON.stringify(newData));
                                    }
                                }
                            } else if (dm.delete) {
                                delValue(`rerolls`);
                            }
                        }
                        size = (new TextEncoder(`utf-8`).encode(getValue(`rerolls`, ``))).length;
                        totalGM += size;
                        dm.switches[optionKey].size.textContent = convertBytes(size);
                        break;
                    case `sgCommentHistory`:
                    case `stCommentHistory`:
                        data[optionKey] = JSON.parse(getValue(optionKey, `[]`));
                        if (!space) {
                            if (dm.import) {
                                newData = dm.data[optionKey];
                                if (newData) {
                                    if (esgst.settings.importAndMerge) {
                                        mergedData = [];
                                        oldData = data[optionKey];
                                        j = 0;
                                        k = 0;
                                        numNew = newData.length;
                                        numOld = oldData.length;
                                        while (j < numOld && k < numNew) {
                                            oldDataValue = oldData[j];
                                            newDataValue = newData[k];
                                            if (oldDataValue.timestamp > newDataValue.timestamp) {
                                                mergedData.push(oldDataValue);
                                                ++j;
                                            } else {
                                                for (l = 0; l < numOld && oldData[l].id !== newDataValue.id; ++l);
                                                if (l >= numOld) {
                                                    mergedData.push(newDataValue);
                                                }
                                                ++k;
                                            }
                                        }
                                        while (j < numOld) {
                                            mergedData.push(oldData[j]);
                                            ++j;
                                        }
                                        while (k < numNew) {
                                            newDataValue = newData[k];
                                            for (l = 0; l < numOld && oldData[l].id !== newDataValue.id; ++l);
                                            if (l >= numOld) {
                                                mergedData.push(newDataValue);
                                            }
                                            ++k;
                                        }
                                        setValue(optionKey, JSON.stringify(mergedData));
                                    } else {
                                        setValue(optionKey, JSON.stringify(newData));
                                    }
                                }
                            } else if (dm.delete) {
                                delValue(optionKey);
                            }
                        }
                        size = (new TextEncoder(`utf-8`).encode(getValue(optionKey, ``))).length;
                        totalGM += size;
                        dm.switches[optionKey].size.textContent = convertBytes(size);
                        break;
                    case `users`:
                        values = [`uf`, `notes`, `tags`, `giveaways`, `namwc`, `nrf`, `wbc`];
                        data.users = {
                            steamIds: {},
                            users: {}
                        };
                        mergedData = JSON.parse(getValue(`users`, `{
                            "steamIds": {},
                            "users": {}
                        }`));
                        for (mergedDataKey in mergedData.users) {
                            mergedDataValue = mergedData.users[mergedDataKey];
                            newData = {};
                            for (j = 0, numValues = values.length; j < numValues; ++j) {
                                valueKey = values[j];
                                if (esgst.settings[`${dm.type}_users_${valueKey}`]) {
                                    value = mergedDataValue[valueKey];
                                    if (typeof value !== `undefined`) {
                                        newData[valueKey] = value;
                                        if (!space && dm.delete) {
                                            delete mergedDataValue[valueKey];
                                        }
                                    }
                                }
                            }
                            if (Object.keys(newData).length > 0) {
                                id = mergedDataValue.id;
                                username = mergedDataValue.username;
                                if (id) {
                                    newData.id = id;
                                }
                                if (username) {
                                    newData.username = username;
                                    data.users.steamIds[username] = mergedDataKey;
                                }
                                data.users.users[mergedDataKey] = newData;
                            }
                        }
                        if (!space) {
                            if (dm.import) {
                                newData = dm.data.users;
                                if (newData) {
                                    for (newDataKey in newData.users) {
                                        newDataValue = newData.users[newDataKey];
                                        if (!mergedData.users[newDataKey]) {
                                            mergedData.users[newDataKey] = {
                                                id: newDataValue.id,
                                                username: newDataValue.username
                                            };
                                            mergedData.steamIds[newDataValue.username] = newDataKey;
                                        }
                                        mergedDataValue = mergedData.users[newDataKey];
                                        for (j = 0, numValues = values.length; j < numValues; ++j) {
                                            value = values[j];
                                            if (newDataValue[value] && esgst.settings[`${dm.type}_users_${value}`]) {
                                                if (esgst.settings.importAndMerge) {
                                                    switch (value) {
                                                        case `notes`:
                                                            mergedDataValue.notes = mergedDataValue.notes ? `${mergedDataValue.notes}\n\n${newDataValue.notes}` : newDataValue.notes;
                                                            break;
                                                        case `tags`:
                                                            if (mergedDataValue.tags) {
                                                                tags = newDataValue.tags;
                                                                for (k = 0, numTags = tags.length; k < numTags; ++k) {
                                                                    tag = tags[k];
                                                                    if (mergedDataValue.tags.indexOf(tag) < 0) {
                                                                        mergedDataValue.tags.push(tag);
                                                                    }
                                                                }
                                                            } else {
                                                                mergedDataValue.tags = newDataValue.tags;
                                                            }
                                                            break;
                                                        case `giveaways`:
                                                            if (mergedDataValue.giveaways) {
                                                                if (newDataValue.giveaways.wonTimestamp > mergedDataValue.giveaways.wonTimestamp) {
                                                                    mergedDataValue.giveaways.won = newDataValue.giveaways.won;
                                                                    mergedDataValue.giveaways.wonTimestamp = newDataValue.giveaways.wonTimestamp;
                                                                }
                                                                if (newDataValue.giveaways.sentTimestamp > mergedDataValue.giveaways.sentTimestamp) {
                                                                    mergedDataValue.giveaways.sent = newDataValue.giveaways.sent;
                                                                    mergedDataValue.giveaways.sentTimestamp = newDataValue.giveaways.sentTimestamp;
                                                                }
                                                            } else {
                                                                mergedDataValue.giveaways = newDataValue.giveaways;
                                                            }
                                                            break;
                                                        default:
                                                            if (mergedDataValue[value]) {
                                                                if (newDataValue[value].lastCheck > mergedDataValue[value].lastCheck) {
                                                                    mergedDataValue[value] = newDataValue[value];
                                                                }
                                                            } else {
                                                                mergedDataValue[value] = newDataValue[value];
                                                            }
                                                            break;
                                                    }
                                                } else {
                                                    mergedDataValue[value] = newDataValue[value];
                                                }
                                            }
                                        }
                                    }
                                    setValue(`users`, JSON.stringify(mergedData));
                                }
                            } else if (dm.delete) {
                                setValue(`users`, JSON.stringify(mergedData));
                            }
                        }
                        size = (new TextEncoder(`utf-8`).encode(getValue(`users`, ``))).length;
                        totalGM += size;
                        dm.switches[optionKey].size.textContent = convertBytes(size);
                        break;
                    case `winners`:
                        data.winners = JSON.parse(getValue(`winners`, `{}`));
                        if (!space) {
                            if (dm.import) {
                                newData = dm.data.winners;
                                if (newData) {
                                    if (esgst.settings.importAndMerge) {
                                        mergedData = data.winners;
                                        for (newDataKey in newData) {
                                            if (!mergedData[newDataKey]) {
                                                mergedData[newDataKey] = [];
                                            }
                                            for (j = 0, numNew = newData[newDataKey].length; j < numNew; ++j) {
                                                newDataValue = newData[newDataKey][j];
                                                if (mergedData[newDataKey].indexOf(newDataValue) < 0) {
                                                    mergedData[newDataKey].push(newDataValue);
                                                }
                                            }
                                        }
                                        setValue(`winners`, JSON.stringify(mergedData));
                                    } else {
                                        setValue(`winners`, JSON.stringify(newData));
                                    }
                                }
                            } else if (dm.delete) {
                                delValue(`winners`);
                            }
                        }
                        size = (new TextEncoder(`utf-8`).encode(getValue(`winners`, ``))).length;
                        totalGM += size;
                        dm.switches[optionKey].size.textContent = convertBytes(size);
                        break;
                    default:
                        break;
                }
            }
        }
    }
    if (!space) {
        if (dm.type === `export` || esgst.settings.exportBackup) {
            if (dropbox || (dm.type !== `export` && esgst.settings.exportBackupIndex === 1)) {
                if (getValue(`dropboxToken`)) {
                    checkDropboxComplete(data, dm, null, callback);
                } else {
                    checkDropboxComplete(data, dm, open(`https://www.dropbox.com/oauth2/authorize?redirect_uri=https://${location.hostname}/esgst/dropbox&response_type=token&client_id=nix7kvchwa8wdvj`), callback);
                }
            } else {
                data = new Blob([JSON.stringify(data)]);
                url = URL.createObjectURL(data);
                file = document.createElement(`a`);
                file.download = `esgst_data_${new Date().toISOString()}.json`;
                file.href = url;
                document.body.appendChild(file);
                file.click();
                file.remove();
                URL.revokeObjectURL(url);
                createFadeMessage(dm.message, `Data ${dm.type}ed with success!`);
                callback();
            }
        } else {
            createFadeMessage(dm.message, `Data ${dm.type}ed with success!`);
            callback();
        }
    }
    dm.computerSpace.lastElementChild.textContent = convertBytes(totalGM);
}

function checkDropboxComplete(data, dm, win, callback) {
    if (!win || win.closed) {
        if (dm.type === `export` || (data && esgst.settings.exportBackup)) {
            request(JSON.stringify(data), {authorization: `Bearer ${getValue(`dropboxToken`)}`, [`Dropbox-API-Arg`]: `{"path": "/esgst_data_${new Date().toISOString()}.json"}`, [`Content-Type`]: `application/octet-stream`}, false, `https://content.dropboxapi.com/2/files/upload`, response => {
                createFadeMessage(dm.message, `Data ${dm.type}ed with success!`);
                callback();
            });
        } else {
            request(`{"path": ""}`, {authorization: `Bearer ${getValue(`dropboxToken`)}`, [`Content-Type`]: `application/json`}, false, `https://api.dropboxapi.com/2/files/list_folder`, response => {
                let canceled = true;
                let popup = new Popup(`fa-dropbox`, `Select a file to import:`, true);
                let entries = insertHtml(popup.scrollable, `beforeEnd`, `<div class="popup__keys__list"></div>`);
                JSON.parse(response.responseText).entries.forEach(entry => {
                    if (entry[`.tag`] === `file` && entry.name.match(/esgst_data_.*?\.json/)) {
                        let size = entry.size / 1048576;
                        size = size < 1 ? `${Math.round(entry.size * 100) / 100} KB` : `${Math.round(size * 100) / 100} MB`;
                        let item = insertHtml(entries, `beforeEnd`, `
                            <div class="esgst-clickable">${entry.name} - ${size}</div>
                        `);
                        item.addEventListener(`click`, () => {
                            createConfirmation(`Are you sure you want to import the selected data?`, () => {
                                canceled = false;
                                popup.close();
                                request(null, {authorization: `Bearer ${getValue(`dropboxToken`)}`, [`Dropbox-API-Arg`]: `{"path": "/${entry.name}"}`, [`Content-Type`]: `text/plain`}, false, `https://content.dropboxapi.com/2/files/download`, response => {
                                    dm.data = JSON.parse(response.responseText);
                                    manageData(dm, false, false, false, false, callback);
                                });
                            });
                        });
                    } else {
                        createFadeMessage(dm.warning, `No files found!`);
                        callback();
                    }
                });
                popup.onClose = () => {
                    if (canceled) {
                        callback();
                    }
                };
                popup.open();
            });
        }
    } else {
        setTimeout(checkDropboxComplete, 250, data, dm, win, callback);
    }
}

/* */

function selectSwitches(switches, type, callback) {
    var key;
    for (key in switches) {
        switches[key][type]();
    }
    if (callback) {
        callback();
    }
}

/* Style */

function addStyle() {
    var backgroundColor, color, colors, i, n, style;
    style = ``;
    colors = [
        {
            id: `gc_h`,
            key: `hidden`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_gi`,
            key: `giveawayInfo`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_fcv`,
            key: `fullCV`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_rcv`,
            key: `reducedCV`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_ncv`,
            key: `noCV`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_w`,
            key: `wishlisted`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_o`,
            key: `owned`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_i`,
            key: `ignored`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_rm`,
            key: `removed`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_ea`,
            key: `earlyAccess`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_tc`,
            key: `tradingCards`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_a`,
            key: `achievements`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_mp`,
            key: `multiplayer`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_sc`,
            key: `steamCloud`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_l`,
            key: `linux`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_m`,
            key: `mac`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_dlc`,
            key: `dlc`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_p`,
            key: `package`,
            mainKey: `esgst-gc`
        },
        {
            id: `gc_g`,
            key: `genres`,
            mainKey: `esgst-gc`
        },
        {
            id: `wbh_w`,
            key: `whitelisted`,
            mainKey: `esgst-wbh-highlight`
        },
        {
            id: `wbh_b`,
            key: `blacklisted`,
            mainKey: `esgst-wbh-highlight`
        }
    ];
    for (i = 0, n = colors.length; i < n; ++i) {
        color = esgst[`${colors[i].id}_color`];
        backgroundColor = esgst[`${colors[i].id}_bgColor`];
        style += `
            .${colors[i].mainKey}-${colors[i].key} {
                color: ${color} !important;
                background-color: ${backgroundColor} !important;
            }
        `;
    }
    style += `
        .esgst-bold {
            font-weight: bold;
        }

        .esgst-italic {
            font-style: italic;
        }

        .esgst-mt-checkbox {
            display: inline-block;
            margin-right: 5px;
        }

        .esgst-codb-button {
            cursor: pointer;
            display: inline-block;
            margin: 0 5px 0 0;
        }

        .esgst-gm-popout textarea {
            height: 150px !important;
            overflow-y: auto !important;
        }

        .esgst-es-page-divisor {
            margin: 5px 0;
        }

        .esgst-es-top-button {
            bottom: 59px;
            position: fixed;
        }

        .esgst-es-top-button >* {
            line-height: normal;
            padding: 2px 25px;
        }

        .esgst-gm-popout .esgst-button-set >* {
            line-height: 25px;
            width: calc(100% - 30px);
        }

        .comment__parent .esgst-cerb-reply-button {
            margin-top: 54px;
            position: absolute;
            text-align: center;
            width: 44px;
        }

        .comment_inner .esgst-cerb-reply-button {
            margin-left: 21px;
            margin-top: 34px;
            position: absolute;
            text-align: center;
            width: 24px;
        }

        .esgst-page-heading {
            display: flex;
            align-items: flex-start;
            word-wrap: break-word;
        }

        .esgst-page-heading >* {
            background-image: linear-gradient(#fff 0%, rgba(255,255,255,0.4) 100%);
            display: flex;
            padding: 5px 10px;
            border: 1px solid #d2d6e0;
            border-radius: 4px;
            color: #4B72D4;
            font: 700 14px/22px "Open Sans", sans-serif;
        }

        .esgst-page-heading i {
            line-height: 22px;
        }

        .esgst-page-heading >*:not(.page__heading__breadcrumbs) {
            align-items: center;
        }

        .esgst-page-heading >*:not(:last-child) {
            margin-right: 5px;
        }

        .esgst-tab-menu {
            background-color: #f0f2f5;
            background-image: none;
            display: block;
            padding: 25px;
            font: 12px Arial, sans-serif;
            text-shadow: 1px 1px rgba(255,255,255,0.94);
            color: #465670;
        }

        .esgst-form-row {
            margin-bottom: 20px;
        }

        .esgst-form-row:first-of-type {
            margin-top: 14px;
        }

        .esgst-form-heading {
            align-items: center;
            display: flex;
            margin-bottom: 5px;
        }

        .esgst-form-heading > div:not(:last-child) {
            margin-right: 10px;
        }

        .esgst-form-heading-number {
            font: 300 14px "Open Sans", sans-serif;
            color:#6b7a8c;
        }

        .esgst-form-heading-text {
            font: 700 14px "Open Sans", sans-serif;
            color: #4B72D4;
        }

        .esgst-form-row-indent {
            padding: 3px 0 3px 20px;
            margin-left: 5px;
            border-left: 1px solid #d2d6e0;
            box-shadow: 1px 0 0 rgba(255,255,255,0.3) inset;
        }

        .esgst-form-sync {
            display: flex;
        }

        .esgst-form-sync-data {
            flex: 1;
        }

        .esgst-notification {
            border: 1px solid;
            border-radius: 4px;
            padding: 0 15px;
            font-size: 11px;
            line-height: 32px;
            overflow: hidden;
        }

        .esgst-notification a {
            text-decoration: underline;
        }

        .esgst-notification-success {
            background-image: linear-gradient(#f7fcf2 0%, #e7f6da 100%);
            border-color: #C5E9A5;
            color:#8fa47b;
        }

        .esgst-notification-warning {
            background-image: linear-gradient(#F6F6E6 0px, #F5F5DF 20px);
            border-color: #EDE5B2;
            color: #a59d7c;
        }

        .esgst-user-icon {
            display: inline-block;
            line-height: normal;
            margin: 0 5px 0 0;
        }

        .esgst-user-icon i {
            border: 0;
            line-height: normal;
            margin: 0;
            text-shadow: none !important;
        }

        .esgst-whitelist {
            color: #556da9 !important;
        }

        .esgst-blacklist {
            color: #a95570 !important;
        }

        .esgst-positive {
            color: #96c468 !important;
        }

        .esgst-negative {
            color: #ec8583 !important;
        }

        .esgst-unknown {
            color: #77899a !important;
        }

        .esgst-ugd-table .table__rows .table__row-outer-wrap:hover {
            background-color: rgba(119, 137, 154, 0.1);
        }

        .esgst-ugd-table .table__column--width-small {
            min-width: 0;
            width: 12%;
        }

        .markdown {
            word-break: break-word;
        }

        .esgst-busy >*, .esgst-cfh-alipf {
            opacity: 0.2;
        }

        .comment__actions .esgst-rml-link {
            margin: 0 0 0 10px;
        }

        .esgst-ap-avatar {
            cursor: pointer;
        }

        .esgst-settings-menu .form__sync-default {
            margin: 0 5px;
        }

        .esgst-uh-popup a {
            border-bottom: 1px dotted;
        }

        .esgst-sync-frequency {
            display: block;
            width: 200px;
        }

        .esgst-ap-popout .featured__table__row__left:not(.esgst-uh-title), .esgst-mr-reply, .esgst-mr-edit, .esgst-mr-delete, .esgst-mr-undelete {
            margin: 0 10px 0 0;
        }

        .esgst-ugd-button {
            cursor: pointer;
            display: inline-block;
        }

        .esgst-cfh-popout {
            font: 700 12px "Open Sans", sans-serif;
        }

        .esgst-cfh-panel span >:first-child >* {
            margin: 0 !important;
        }

        .esgst-cfh-popout input {
            width: auto;
        }

        .esgst-namwc-highlight {
            font-weight: bold;
        }

        .esgst-iwh-icon {
            margin: 0 0 0 5px;
        }

        .esgst-ap-suspended >* {
            color: #e9202a;
        }

        .esgst-ap-popout {
            border: none !important;
            border-radius: 5px;
            box-shadow: 0 0 10px 2px hsla(0, 0%, 0%, 0.8);
            min-width: 400px;
            padding: 0 !important;
            text-shadow: none;
        }

        .ui-tooltip {
            z-index: 99999;
        }

        .esgst-ap-popout .featured__outer-wrap:not(.esgst-uh-box) {
            border-radius: 5px;
            padding: 5px;
            width: auto;
            white-space: normal;
        }

        .esgst-ap-popout .featured__inner-wrap {
            align-items: flex-start;
            padding: 0 5px 0 0;
        }

        .esgst-ap-popout .featured__heading {
            margin: 0;
        }

        .esgst-ap-popout .featured__heading__medium {
            font-size: 18px;
        }

        .esgst-ap-link {
            width: 100px;
        }

        .esgst-ap-link .global__image-outer-wrap--avatar-large {
            box-sizing: content-box !important;
            height: 64px !important;
            margin: 5px;
            width: 64px !important;
        }

        .esgst-ap-popout .global__image-outer-wrap--avatar-large:hover {
            background-color: hsla(0, 0%, 25%, 0.2) !important;
        }

        .esgst-ap-link .global__image-inner-wrap {
            background-size: cover !important;
        }

        .esgst-ap-popout .sidebar__shortcut-outer-wrap {
            margin: 10px 0;
        }

        .esgst-ap-popout .sidebar__shortcut-inner-wrap i {
            height: 18px;
            font-size: 12px;
        }

        .esgst-ap-popout .sidebar__shortcut-inner-wrap * {
            line-height: 18px;
            vertical-align: middle;
        }

        .esgst-ap-popout .sidebar__shortcut-inner-wrap img {
            height: 16px;
            vertical-align: baseline !important;
            width: 16px;
        }

        .esgst-ap-popout .featured__table {
            display: inline-block;
            width: 100%;
        }

        .esgst-ap-popout .featured__table__row {
            padding: 2px;
        }

        .esgst-ap-popout .featured__table__row:nth-child(n + 3) {
            margin-left: -95px;
        }

        .esgst-ap-popout .featured__table__row:last-of-type .featured__table__row__right * {
            font-size: 11px;
        }

        .esgst-ct-comment-button {
            cursor: pointer;
        }

        .popup__keys__list .esgst-ggl-member, .esgst-dh-highlighted, .esgst-dh-highlighted.table__row-outer-wrap {
            background-color: rgba(150, 196, 104, 0.2) !important;
            padding: 5px !important;
        }

        .esgst-gb-highlighted.ending {
            background-color: rgba(236, 133, 131, 0.8) !important;
            background-image: none !important;
        }

        .esgst-gb-highlighted.started {
            background-color: rgba(150, 196, 104, 0.8) !important;
            background-image: none !important;
        }

        .esgst-gb-highlighted.ending.started {
            background-color: rgba(193, 165, 118, 0.8) !important;
            background-image: none !important;
        }

        .esgst-ct-comment-read:hover, .esgst-ct-visited:hover {
            background-color: rgba(119, 137, 154, 0.1) !important;
        }

        .esgst-gf-hide-button, .esgst-gf-unhide-button, .esgst-gb-button, .esgst-gdttt-button, .esgst-df-button, .esgst-dh-button {
            cursor: pointer; display: inline-block;
            margin: 0 5px 0 0;
        }

        .comment__actions .esgst-ct-comment-button {
            margin: 0 0 0 10px;
        }

        .comment__actions >:first-child + .esgst-ct-comment-button {
            margin: 0;
        }

        .esgst-ct-comment-button >:not(:last-child) {
            margin: 0 10px 0 0;
        }

        .esgst-cfh-panel {
            margin: 0 0 2px;
            text-align: left;
        }

        .esgst-cfh-panel >* {
            display: inline-block;
            margin: 1px !important;
            padding: 0;
        }

        .esgst-cfh-panel span >:first-child {
            cursor: pointer;
            display: flex;
            padding: 0 5px;
        }

        .esgst-cfh-panel span >:not(:first-child), .esgst-ded-status {
            display: block;
        }

        .esgst-cfh-panel span i {
            line-height: 22px;
        }

        .esgst-cfh-panel .form__saving-button {
            display: inline-block;
            margin: 5px;
            min-width:0;
        }

        .esgst-cfh-panel table {
            display: block;
            max-height: 200px;
            max-width: 375px;
            overflow: auto;
        }

        .esgst-cfh-panel table td:first-child {
            min-width: 25px;
            text-align: center;
        }

        .esgst-cfh-panel table td:not(:first-child) {
            min-width: 75px;
            text-align: center;
        }

        .esgst-cfh-emojis {
            display: block !important;
            font-size: 18px;
            max-height: 200px;
            min-height: 30px;
            overflow: auto;
            text-align: center;
        }

        .esgst-cfh-emojis >* {
            cursor: pointer;
            display: inline-block;
            margin: 2px;
        }

        .esgst-cfh-panel ~ textarea {
            max-height: 475px;
        }

        .esgst-cfh-popout {
            white-space: normal;
            width: 300px;
        }

        .esgst-mpp-visible {
            padding: 0;
        }

        .esgst-mpp-hidden {
            display: none;
            max-height: 75%;
            overflow: auto;
            padding: 15px;
            position: absolute;
            width: 75%;
        }

        .esgst-ueg {
            opacity: 1 !important;
        }

        .esgst-fh {
            height: auto !important;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 999 !important;
        }

        .esgst-ff {
            background-color: inherit;
            bottom: 0;
            padding: 0;
            position: fixed;
            width: 100%;
            z-index: 999;
        }

        .esgst-ff >* {
            padding: 15px 25px;
        }

        .esgst-ff-sibling {
            margin-bottom: 39px;
        }

        .esgst-sgg-sticky-button {
            cursor: pointer;
            margin: 0 5px 0 0;
            opacity: 0.5;
        }

        .esgst-sgg-unsticky-button {
            cursor: pointer;
            margin: 0 5px 0 0;
        }

        .esgst-ct-count {
            color: #e9202a;
            font-weight: bold;
        }

        .esgst-uh-box {
            background-color: rgba(10, 18, 41, 0.5);
            margin: 5px 0 0;
            padding: 15px;
            position: absolute;
            text-align: center;
        }

        .esgst-uh-title {
            color: rgba(255, 255, 255, 0.6);
            font-weight: bold;
            margin: 0 0 15px;
        }

        .esgst-uh-list {
            color: rgba(255, 255, 255, 0.4);
        }

        .esgst-wbc-button, .esgst-namwc-button, .esgst-nrf-button {
            cursor: pointer;
            margin: 0 0 0 5px;
        }

        .esgst-luc-value {
            margin: 0 0 0 5px;
        }

        .esgst-sgpb-container {
            display: flex;
        }

        .esgst-sgpb-container >* {
            flex: 1;
        }

        .esgst-sgpb-button {
            background-image: linear-gradient(rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 100%);
            border-color: #dde2ea #cdd4df #cbd1dc #d6dbe7;
            color: #6e7585;
            text-shadow: 1px 1px 1px #fff;
            transition: opacity 0.5s;
            border-radius: 3px;
            font: 700 13px 'Open Sans', sans-serif;
            margin: 0 0 0 5px;
            padding: 7px 15px;
            display: flex;
            align-items: center;
            border-width: 1px;
            border-style: solid;
            text-decoration: none;
        }

        .esgst-sgpb-button:active {
            background-image: linear-gradient(#e1e7eb 0%, #e6ebf0 50%, #ebeff2 100%) !important;
            box-shadow: 2px 2px 5px #ccd4db inset;
            text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.6);
            margin: 2px 0 0 7px !important;
            border: 0;
        }

        .esgst-sgpb-button:hover {
            background-image: linear-gradient(rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.3) 100%);
        }

        .esgst-sgpb-button i {
            height: 14px;
            margin: 0 10px 0;
            width: 14px;
        }

        .esgst-sgpb-button img {
            height: 14px;
            vertical-align: baseline;
            width: 14px;
        }

        .esgst-stpb-button img {
            vertical-align: top;
        }

        .esgst-gh-highlight, .esgst-green-highlight {
            background-color: rgba(150, 196, 104, 0.2);
        }

        .esgst-pgb-button, .esgst-gf-button {
            border: 1px solid #d2d6e0;
            border-top: none;
            background-color: #e1e6ef;
            background-image: linear-gradient(rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0) 100%);color: #6b7a8c;
            cursor: pointer;
            margin-bottom: 15px;
            padding: 3px;
            text-align: center;
            border-radius: 0 0 4px 4px;
        }

        .esgst-gf-button {
            margin-bottom: 0 !important;
        }

        .esgst-pgb-button:hover, .esgst-gf-button:hover {
            background-image:linear-gradient(rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0) 100%);
        }

        .esgst-gm-giveaway {
            background-color: #fff;
            border: 1px solid;
            border-radius: 4px;
            cursor: pointer;
            display: inline-block;
            margin: 5px 2px;
            padding: 2px 5px;
        }

        .esgst-feature-description {
            background-color: #fff;
            color: #465670;
            padding: 10px;
            width: 420px;
            border-radius: 4px;
        }

        .esgst-feature-description img {
            max-width: 400px;
        }

        .esgst-gm-giveaway.error {
            background-color: rgba(236, 133, 131, 0.5);
        }

        .esgst-gm-giveaway.success {
            background-color: rgba(150, 196, 104, 0.5);
        }

        .esgst-gm-giveaway.connected {
            text-decoration: line-through;
        }

        .esgst-gts-section >*, .esgst-gm-section >* {
            margin: 5px 0;
        }

        .esgst-gm-section .esgst-button-set {
            display: inline-block;
            margin: 5px;
        }

        .sidebar .esgst-button-set >* {
            margin-bottom: 5px;
            width: 304px;
        }

        .esgst-button-set .sidebar__entry-delete, .esgst-button-set .sidebar__error {
            display: inline-block;
        }

        .esgst-ggl-panel {
            color: #6b7a8c;
            font-size: 12px;
            padding: 5px;
        }

        .esgst-ggl-panel >* {
            display: inline-block;
        }

        .esgst-ggl-panel >*:not(:last-child) {
            margin-right: 10px;
        }

        .esgst-ggl-panel a:last-child {
            border-bottom: 1px dotted;
        }

        .esgst-ggl-panel .table_image_avatar {
            cursor: pointer;
            display: inline-block;
            height: 12px;
            width: 12px;
            vertical-align: middle;
        }

        .esgst-ggl-member {
            font-weight: bold;
        }

        .esgst-ggl-button {
            cursor: pointer;
        }

        .esgst-hidden-buttons {
            padding: 2px !important;
        }

        .esgst-popout {
            background-color: #fff;
            border: 1px solid #d2d6e0;
            border-radius: 4px;
            color: #465670;
            padding: 10px;
            position: absolute;
            left: 0;
            top: 0;
            z-index: 99999;
        }

        .esgst-aic-carousel img {
            max-width: 100%;
        }

        .esgst-aic-left-button {
            cursor: pointer;
            left: 60px;
            position: absolute;
            top: 50%;
        }

        .esgst-aic-right-button {
            cursor: pointer;
            right: 50px;
            position: absolute;
            top: 50%;
        }

        .esgst-popup-modal {
            background-color: rgba(60, 66, 77, 0.7);
            bottom: 0;
            cursor: pointer;
            left: 0;
            position: fixed;
            right: 0;
            top: 0;
        }

        .esgst-popup-large {
            width: 75%;
        }

        .esgst-popup {
            background-color: #f0f2f5;
            border-radius: 4px;
            color: #465670;
            max-width: 75%;
            padding: 35px 100px;
            position: fixed;
            text-align: center;
            text-shadow: 1px 1px rgba(255,255,255,0.94);
        }

        .esgst-popup li:before {
            margin-left: 0;
            padding-right: 10px;
            position: static;
            width: auto;
            text-align: left;
        }

        .esgst-popup-description >*, .esgst-popup-scrollable >* {
            margin: 10px 0 0 !important;
        }

        .esgst-popup-scrollable {
            overflow: auto;
        }

        .esgst-popup .popup__actions >* {
            display: inline-block;
        }

        .esgst-popup .popup__keys__list {
            max-height: none;
        }

        .esgst-heading-button {
            display: inline-block;
            cursor: pointer;
        }

        .esgst-popup .popup__actions {
            margin-top: 25px;
        }

        .esgst-popup-icon {
            height: 48px;
            width: 48px;
        }

        .esgst-popup-title span {
            font-weight: bold;
        }

        .esgst-text-left {
            text-align: left;
        }

        .esgst-text-center {
            text-align: center;
        }

        .esgst-hidden {
            display: none !important;
        }

        .esgst-clickable {
            cursor: pointer;
        }

        .fa img {
            height: 14px;
            width: 14px;
            vertical-align: middle;
        }

        .nav__left-container .fa img {
            vertical-align: baseline;
        }

        .esgst-checkbox, .esgst-hb-update, .esgst-hb-changelog, .esgst-dh-view-button {
            cursor: pointer;
        }

        .esgst-sm-small-number {
            font-size: 12px;
            display: inline-block;
        }

        .esgst-toggle-switch-container {
            margin: 2px;
        }

        .esgst-toggle-switch-container.inline {
            display: inline-block;
        }

        .page__heading .esgst-toggle-switch-container.inline, .esgst-page-heading .esgst-toggle-switch-container.inline {
            height: 16px;
            margin: 0 2px;
            line-height: normal;
            vertical-align: middle;
        }

        .esgst-toggle-switch {
            position: relative;
            display: inline-block;
            width: 26px;
            height: 14px;
            vertical-align: top;
        }

        .esgst-toggle-switch input {
            display: none;
        }

        .esgst-toggle-switch-slider {
            border-radius: 20px;
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .esgst-toggle-switch-slider:before {
            border-radius: 50%;
            position: absolute;
            content: "";
            height: 12px;
            width: 12px;
            left: 1px;
            bottom: 1px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .esgst-toggle-switch-slider {
            background-color: #4B72D4;
        }

        input:focus + .esgst-toggle-switch-slider {
            box-shadow: 0 0 1px #4B72D4;
        }

        input:checked + .esgst-toggle-switch-slider:before {
            -webkit-transform: translateX(12px);
            -ms-transform: translateX(12px);
            transform: translateX(12px);
        }

        .esgst-adots, .esgst-rbot {
            margin-bottom: 25px;
        }

        .esgst-float-left {
            float: left;
        }

        .esgst-float-right {
            float: right;
        }

        .esgst-clear {
            clear: both;
        }

        .esgst-rbot .reply_form .btn_cancel {
            display: none;
        }

        .esgst-aas-button, .esgst-es-pause-button, .esgst-es-refresh-button {
            cursor: pointer;
            display: inline-block;
        }

        .esgst-es-page-heading {
            margin-top: 25px;
        }

        .esgst-gc-border {
            display: flex;
            height: 5px;
            margin-left: 5px;
            width: 186px;
        }

        .esgst-gc-border >* {
            flex: 1;
        }

        .esgst-gc-panel {
            text-align: left;
        }

        .esgst-gc-panel a {
            text-decoration: none;
        }

        .esgst-gc-panel-inline {
            display: inline-block;
            margin: 0 0 0 5px;
        }

        .esgst-gc {
            border-radius: 4px;
            display: inline-block;
            font-size: 10px;
            line-height: 10px;
            margin: 5px 0;
            padding: 2px 3px;
            text-shadow: none;
        }

        .esgst-gc-rating i {
            color: #fff !important;
        }

        .esgst-gc-rating-positive {
            color: #fff !important;
            background-color: #66c0f4;
        }

        .esgst-gc-rating-negative {
            color: #fff !important;
            background-color: #a34c25;
        }

        .esgst-gc-rating-mixed {
            color: #fff !important;
            background-color: #b9a074;
        }

        .esgst-gc-genres {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: middle;
            white-space: nowrap;
        }

        .esgst-gf-legend-panel {
            position: absolute;
            right: 0;
            text-align: right;
            top: 0;
        }

        .esgst-gf-preset-panel {
            bottom: 0;
            position: absolute;
            right: 0;
            text-align: right;
        }

        .esgst-gf-override {
            cursor: pointer;
            margin-right: 5px;
        }

        .esgst-gf-container:not(.esgst-popup-scrollable) {
            background-color: #E8EAEF;
            border-radius: 4px;
        }

        .esgst-gf-container.esgst-popup-scrollable {
            min-width: 650px;
        }

        .esgst-gf-container input {
            display: inline-block;
            height: 20px;
            padding: 0 5px;
            width: 100px !important;
        }

        .esgst-gf-filters {
            position: relative;
        }

        .esgst-gf-filters >* {
            display: inline-block;
            margin: 5px;
            vertical-align: top;
        }

        .esgst-gf-basic-filter {
            margin: 10px;
            width: 330px;
        }

        .esgst-gf-basic-filter >* {
            margin: 8px;
        }

        .esgst-gf-type-filter, .esgst-gf-category-filter, .esgst-gf-exception-filter, .esgst-gf-legend, .esgst-gf-preset-panel >* {
            margin: 5px;
        }

        .esgst-gf-button {
            border-top: 1px;
        }

        .esgst-wbh-highlight {
            border: none !important;
            border-radius: 4px;
            padding: 2px 5px;
            text-shadow: none;
        }

        .page__heading__breadcrumbs .esgst-wbh-highlight {
            padding: 0 2px;
        }

        .esgst-sm-colors input {
            display: inline-block;
            padding: 0;
            width: 100px;
        }

        .esgst-sm-colors input[type=color] {
            width: 25px;
        }

        .esgst-sm-colors select {
            display: inline-block;
            padding: 0;
            width: 100px;
        }

        .esgst-sm-colors-default {
            line-height: normal;
            padding: 5px 15px;
        }

        .esgst-ged-icon {
            margin: 0 0 0 10px;
        }

        .esgst-pgb-container {
            border-radius: 0 !important;
            margin: 0! important;
        }

        .esgst-gf-box {
            background-color: #E8EAEF;
            border: 1px solid #d2d6e0;
            border-radius: 0 !important;
            margin: 0! important;
            padding: 0 15px;
        }

        .esgst-gr-button {
            cursor: pointer;
            display: inline-block;
        }

        .esgst-egh-icon {
            cursor: pointer;
        }

        .giveaway__row-outer-wrap .esgst-egh-button, .giveaway__row-outer-wrap .esgst-gr-button, .table__row-outer-wrap .esgst-egh-button, .table__row-outer-wrap .esgst-egh-button, .table__row-outer-wrap .esgst-gr-button {
            margin-right: 5px;
        }

        p.table__column__heading {
            display: inline-block;
        }

        .esgst-giveaway-links {
            float: left;
            margin: 2px;
        }

        .esgst-giveaway-panel.giveaway__columns {
            float: right;
            margin: 2px;
        }

        .esgst-giveaway-panel .esgst-button-set {
            border: 0;
            padding: 0;
        }

        .esgst-giveaway-panel .esgst-button-set >* {
            line-height: inherit;
            margin:0;
        }

        .esgst-giveaway-panel >:first-child {
            margin: 0;
        }

        .esgst-giveaway-panel >*:not(:first-child) {
            margin: 0 0 0 5px;
        }

        .esgst-giveaway-panel .form__submit-button, .esgst-giveaway-panel .form__saving-button {
            margin-bottom: 0;
            min-width: 0;
        }

        .esgst-ged-source {
            font-weight: bold;
            margin: 5px 0;
        }

        .table__column--width-small {
            width: 8%;
        }

        .sidebar .table__row-outer-wrap {
            padding: 5px 0;
        }

        .esgst-adots-tab-heading {
            background-color: #2f3540;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            color: #fff;
            cursor: pointer;
            display: inline-block;
            opacity: 0.5;
            padding: 5px 10px;
            text-shadow: none;
        }

        .esgst-adots-tab-heading.esgst-selected {
            opacity: 1;
        }

        .sidebar .esgst-adots {
            margin: 0;
            max-height: 300px;
            max-width: 336px;
            overflow: auto;
        }

        .sidebar .esgst-adots .esgst-dh-highlighted {
            padding: 0 !important;
            padding-bottom: 5px !important;
        }

        .sidebar .esgst-adots .table__column__heading, .esgst-adots .homepage_table_column_heading {
            display: inline-block;
            max-width: 225px;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: middle;
            white-space: nowrap;
        }

        .sidebar .esgst-adots .table__row-outer-wrap {
            padding: 0 !important;
            padding-bottom: 5px !important;
            border: 0;
            box-shadow: none;
        }

        .sidebar .esgst-adots .table__row-inner-wrap {
            display: block;
        }

        .sidebar .esgst-adots .table__row-inner-wrap >*:not(:last-child) {
            display: inline-block;
        }

        .esgst-faded {
            opacity: 0.5;
        }

        .esgst-red {
            color: #e9202a !important;
        }

        .esgst-warning {
            color: #e9202a !important;
            font-weight: bold;
        }

        .esgst-description {
            color: #6b7a8c;
            font-size: 11px;
            font-style: italic;
            margin-top: 10px;
        }

        .esgst-progress-bar {
            height: 10px;
            overflow: hidden;
            text-align: left;
        }

        .esgst-progress-bar .ui-progressbar-value {
            background-color: #96c468;
            height: 100%;
            margin: -1px;
        }

        .esgst-ib-user {
            background-color: #fff;
            background-position: 5px 5px;
            background-size: 32px;
            border: 1px solid #d2d6e0;
            border-radius: 4px;
            height: 44px;
            padding: 5px;
            width: 44px;
        }

        .esgst-ib-game {
            background-color: #fff;
            background-position: 5px 5px;
            background-size: 184px;
            border: 1px solid #d2d6e0;
            border-radius: 4px;
            height: 81px;
            padding: 5px;
            width: 196px;
        }

        .esgst-oadd >* {
            padding-left: 0 !important;
            margin-left: 0 !important;
            border-left: none !important;
            box-shadow: none !important;
        }

        .esgst-gv-spacing {
            font-weight: bold;
            padding: 10px;
            text-align: center;
            width: 100px;
        }

        .esgst-gv-view {
            font-size: 0;
            padding: 5px 0;
            text-align: center;
        }

        .esgst-gv-view.pinned-giveaways__inner-wrap--minimized .giveaway__row-outer-wrap:nth-child(-n + 10) {
            display: inline-block;
        }

        .esgst-gv-container {
            border: 0 !important;
            box-shadow: none !important;
            display: inline-block;
            font-size: 12px;
            padding: 0;
            text-align: center;
            vertical-align: top;
        }

        .esgst-gv-box {
            display: block;
        }

        .esgst-gv-box >*:not(.giveaway__summary):not(.esgst-gv-icons) {
            margin: 0 !important;
        }

        .esgst-gv-box.is-faded:hover, .esgst-gv-box.esgst-faded:hover {
            opacity: 1;
        }

        .esgst-gv-icons {
            float: right;
            height: 18px;
            margin: -18px 0 0 !important;
        }

        .esgst-gv-time, .esgst-gv-icons .esgst-ged-source {
            background-color: #fff;
            padding: 2px !important;
        }

        .esgst-ged-source {
            font-weight: bold;
        }

        .esgst-gv-time i {
            font-size: 12px;
            vertical-align: baseline;
        }

        .esgst-gv-icons >* {
            line-height: normal;
            margin: 0 !important;
            padding: 1px 3px;
        }

        .esgst-gv-icons .giveaway__column--contributor-level {
            padding: 2px 5px !important;
        }

        .esgst-gv-popout {
            font-size: 11px;
            max-width: 174px;
            position: absolute;
            width: 174px;
            z-index: 1;
        }

        .esgst-gv-popout .giveaway__heading {
            display: block;
            height: auto;
        }

        .esgst-gv-popout .giveaway__heading__name {
            display: inline-block;
            font-size: 12px;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: middle;
        }

        .esgst-gv-popout .giveaway__heading__thin {
            font-size: 11px;
        }

        .esgst-gv-popout .esgst-gc-panel {
            font-size: 11px;
            text-align: center;
        }

        .esgst-gv-popout .esgst-gc-panel i, .esgst-gv-popout .giveaway__links i, .esgst-gv-popout .esgst-gwc i, .esgst-gv-popout .esgst-gwr i, .esgst-gv-popout .esgst-ggl-panel, .esgst-gv-popout .esgst-ggl-panel i {
            font-size: 11px;
        }

        .esgst-gv-popout .esgst-gc-genres {
            margin: 0;
        }

        .esgst-gv-popout .giveaway__columns:not(.esgst-giveaway-panel):not(.esgst-gv-icons) {
            display: block;
            float: left;
            width: calc(100% - 37px);
        }

        .esgst-gv-popout .giveaway__columns:not(.esgst-giveaway-panel):not(.esgst-gv-icons) >* {
            margin: 0;
            text-align: left;
        }

        .esgst-gv-popout .esgst-giveaway-panel {
            display: block;
            font-size: 11px;
        }

        .esgst-gv-popout .esgst-giveaway-panel >* {
            display: inline-block;
            margin: 0;
            width: 67px;
        }

        .esgst-gv-popout .esgst-button-set {
            width: 100%;
        }

        .esgst-gv-popout .esgst-button-set >* {
            padding: 0;
            width: 100%;
        }
        .esgst-gv-popout .giveaway__links a:last-child {
            margin: 0 !important;
        }

        .esgst-gv-popout .giveaway_image_avatar, .esgst-gv-popout .featured_giveaway_image_avatar {
            margin: 5px;
            position: absolute;
            right: 5px;
        }

        .esgst-gv-popout .esgst-giveaway-links, .esgst-gv-popout .esgst-giveaway-panel {
            float: none;
        }

        .esgst-ags-panel {
            margin: 0 0 15px 0;
            max-width: 316px;
            text-align: center;
        }

        .esgst-ags-panel >* {
            display: inline-block;
        }

        .esgst-ags-filter {
            display: block;
            margin: 5px;
        }

        .esgst-ags-filter >* {
            padding: 0 5px !important;
            width: 125px;
        }

        .esgst-ags-checkbox-filter {
            margin: 5px;
        }

        .esgst-ugs-difference {
            display: inline-block;
            padding: 0 !important;
            width: 50px;
        }

        .esgst-gas-popout {
            background-color: #fff;
            border: 1px solid #d2d6e0;
            border-radius: 4px;
            color: #465670;
            padding: 10px;
        }

        .esgst-ds-popout {
            background-color: #fff;
            border: 1px solid #d2d6e0;
            border-radius: 4px;
            color: #465670;
            padding: 10px;
        }

        .esgst-cfh-sr-container {
            max-height: 234px;
            overflow-y: auto;
        }

        .esgst-cfh-sr-box {
            position: relative;
        }

        .esgst-cfh-sr-summary {
            border-radius: 5px;
            cursor: pointer;
            padding: 5px;
            width: 200px;
        }

        .esgst-cfh-sr-box:not(:first-child) {
            border-top: 1px solid #ccc;
        }

        .esgst-cfh-sr-box:last-child) {
            border-bottom: 1px solid #ccc;
        }

        .esgst-cfh-sr-summary:hover {
            background-color: #465670;
            color: #fff;
        }

        .esgst-cfh-sr-name {
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 200px;
            white-space: nowrap;
        }

        .esgst-cfh-sr-description {
            opacity: 0.75;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 200px;
            white-space: nowrap;
        }

        .esgst-cfh-sr-controls {
            position: absolute;
            right: 5px;
            top: 10px;
        }

        .esgst-cfh-sr-controls >* {
            margin: 2px;
        }

        .esgst-gt-preview .esgst-gt-tags {
            display: inline-block;
        }

        .esgst-gt-preview input[type=text] {
            display: inline-block;
            width: 100px;
            height: 15px;
        }

        .esgst-gt-preview input[type=color] {
            box-sizing: unset;
            height: 13px;
            line-height: normal;
            margin: 0;
            padding: 0;
            vertical-align: top;
            width: 15px;
        }

        .esgst-gt-button {
            border: 0! important;
            cursor: pointer;
            display: inline-block;
            line-height: normal;
            text-decoration: none !important;
            transition: opacity 0.2s;
        }

        .esgst-gt-button:hover {
            opacity: 1;
        }

        .esgst-gt-button i {
            margin: 0 !important;
        }

        .giveaway__row-outer-wrap .esgst-gt-button, .table__row-outer-wrap .esgst-gt-button {
            margin-left: 5px;
        }

        .esgst-gt-tags {
            font-size: 10px;
            font-weight: bold;
        }

        .esgst-gt-tags >* {
            display: inline-block !important;
            height: auto;
            margin: 0;
            padding: 2px;
            text-shadow: none;
            width: auto;
        }

        .esgst-gt-tags >:not(:first-child) {
            margin: 0 0 0 5px;
        }

        .esgst-gv-popout .esgst-gt-tags {
            display: none;
        }

        .esgst-ut-preview .esgst-ut-tags {
            display: inline-block;
        }

        .esgst-ut-preview input[type=text] {
            display: inline-block;
            width: 100px;
            height: 15px;
        }

        .esgst-ut-preview input[type=color] {
            box-sizing: unset;
            height: 13px;
            line-height: normal;
            margin: 0;
            padding: 0;
            vertical-align: top;
            width: 15px;
        }

        .esgst-ut-button {
            border: 0! important;
            cursor: pointer;
            display: inline-block;
            line-height: normal;
            margin: 0 0 0 5px;
            text-decoration: none !important;
            transition: opacity 0.2s;
        }

        .esgst-ut-button:hover {
            opacity: 1;
        }

        .author_name + .esgst-ut-button {
            margin: 0 5px 0 0;
        }

        .esgst-ut-button i {
            margin: 0 !important;
        }

        .esgst-ut-tags {
            font-size: 10px;
            font-weight: bold;
        }

        .esgst-ut-tags >* {
            display: inline-block !important;
            height: auto;
            margin: 0;
            padding: 1px 2px;
            text-shadow: none;
            width: auto;
        }

        .esgst-ut-tags >:not(:first-child) {
            margin: 0 0 0 5px;
        }

        .esgst-gv-popout .esgst-ut-tags, .esgst-adots .esgst-ut-tags {
            display: none;
        }
    `;
    if (esgst.sg) {
        style += `
            .esgst-header-menu {
                box-shadow: 1px 1px 1px rgba(255, 255, 255, 0.07) inset, 1px 1px 0 rgba(255, 255, 255, 0.02) inset;
                background-image: linear-gradient(#8a92a1 0px, #757e8f 8px, #4e5666 100%);
                border-radius: 4px;
                display: flex;
                margin-right: 5px;
            }

            .esgst-header-menu-relative-dropdown {
                position: relative;
            }

            .esgst-header-menu-absolute-dropdown {
                top: 34px;
                position: absolute;
                width: 275px;
                border-radius: 4px;
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.02), 2px 2px 5px rgba(0, 0, 0, 0.05), 1px 1px 2px rgba(0, 0, 0, 0.1);
                overflow: hidden;
                z-index: 1;
            }

            .esgst-header-menu-row {
                cursor: pointer;
                background-image: linear-gradient(#fff 0%, #f6f7f9 100%);
                display: flex;
                padding: 12px 15px;
                text-shadow: 1px 1px #fff;
                align-items: center;
            }

            .esgst-header-menu-row:not(:first-child) {
                border-top: 1px dotted #d2d6e0;
            }

            .esgst-header-menu-row:hover, .esgst.header-menu-button:hover + .esgst-header-menu-button {
                border-top-color: transparent;
            }

            .esgst-header-menu-row i{
                font-size: 28px;
                margin-right: 15px;
            }

            .esgst-header-menu-row:hover i {
                color: #fff
            }

            .esgst-header-menu-row:hover{
                background-image: linear-gradient(#63a0f4 0%, #63a0f4 100%);
                text-shadow: none;
            }

            .esgst-header-menu-row i.blue {
                color: #9dd9e1;
            }

            .esgst-header-menu-row i.green {
                color: #96c468;
            }

            .esgst-header-menu-row i.red {
                color: #ec8583;
            }

            .esgst-header-menu-row i.grey{
                color: #77899A;
            }

            .esgst-header-menu-row i.yellow{
                color: #FECC66;
            }

            .esgst-header-menu-name {
                color: #4B72D4;
                font: bold 11px/15px Arial, sans-serif;
            }

            .esgst-header-menu-description {
                color: #6b7a8c;
                font: 11px/13px Arial, sans-serif
            }

            .esgst-header-menu-row:hover .esgst-header-menu-name {
                color: #fff;
            }

            .esgst-header-menu-row:hover .esgst-header-menu-description {
                color: rgba(255, 255, 255, 0.7);
            }

            .esgst-header-menu-button {
                white-space: nowrap;
                color: #21262f;
                font: bold 11px/29px Arial, sans-serif;
                padding: 0 15px;
                cursor: pointer;
                text-shadow: 1px 1px rgba(255, 255, 255, 0.08);
                border-radius: 4px 0 0 4px;
            }

            .esgst-header-menu-button.arrow {
                border-radius: 0 4px 4px 0;
                padding: 0 10px;
            }

            .esgst-header-menu-button:hover {
                background-image: linear-gradient(#9ba2b0 0px, #8c94a3 8px, #596070 100%);
            }

            .esgst-header-menu-button.selected {
                background-image: linear-gradient(#4e525f 0px, #434857 5px, #2b2e3a 100%);
                box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3) inset;
                color: #aec5f3;
                text-shadow: 1px 1px rgba(0, 0, 0, 0.2);
            }

            .esgst-header-menu.selected .esgst-header-menu-button {
                background-image: linear-gradient(#d0d5de 0px, #c9cdd7 5px, #9097a6 100%);
                color: #3c465c;
                text-shadow: 1px 1px rgba(255, 255, 255, 0.2);
            }

            .esgst-header-menu.selected .esgst-header-menu-button:hover:not(.selected) {
                background-image: linear-gradient(#f0f1f5 0px, #d1d4de 100%);
            }
        `;
    } else {
        style += `
            .esgst-header-menu {
                display: flex;
                margin: 0 5px 0 0;
                box-shadow: 0 0 15px rgba(6, 52, 84, 0.07), 2px 2px 5px rgba(6, 52, 84, 0.07), 1px 1px 2px rgba(6, 52, 84, 0.07);
            }

            .esgst-header-menu-relative-dropdown > div {
                overflow: hidden;
                border-radius: 3px;
                background-color: #fff;
                position: absolute;
                margin-top: 39px;
                box-shadow: 0 0 15px rgba(59, 74, 84, 0.07), 2px 2px 5px rgba(59, 74, 84, 0.07), 1px 1px 2px rgba(59, 74, 84, 0.07);
                z-index: 10;
                width: 190px;
            }

            .esgst-header-menu-row {
                padding: 15px 20px;
                color: #557a93;
                display: flex;
                align-items: center;
                font: 700 12px 'Open Sans', sans-serif;
                transition: background-color 0.15s;
                cursor: pointer;
            }

            .esgst-header-menu-row:not(:last-child) {
                border-bottom: 1px solid #e1ebf2;
            }

            .esgst-header-menu-row.disabled {
                cursor: default
            }

            .esgst-header-menu-row > * {
                transition: opacity 0.15s;
            }

            .esgst-header-menu-row i {
                margin-right: 20px;
                font-size: 24px;
                transition: color 0.15s;
            }

            .esgst-header-menu-row:hover {
                background-color: #f0f3f5;
            }

            .esgst-header-menu-relative-dropdown:hover .esgst-header-menu-row:not(:hover) > * {
                opacity: 0.5;
            }

            .esgst-header-menu-relative-dropdown:hover .esgst-header-menu-row:not(:hover) i {
                color: #bdcbd5;
            }

            .esgst-header-menu-row i.blue {
                color: #9dd9e1;
            }

            .esgst-header-menu-row i.green {
                color: #96c468;
            }

            .esgst-header-menu-row i.red {
                color: #ec8583;
            }

            .esgst-header-menu-row i.grey{
                color: #77899a;
            }

            .esgst-header-menu-row i.yellow{
                color: #FECC66;
            }

            .esgst-header-menu-description {
                display: none;
            }

            .esgst-header-menu-button {
                cursor: pointer;
                border-radius: 3px;
                display: flex;
                align-items: center;
                border: 1px solid;
                font: 700 11px 'Open Sans', sans-serif;
                padding: 8px 10px;
                white-space: nowrap;
                background-image: linear-gradient(#fff 0%, #dfe5f0 50%, #a5b2cc 100%);
                border-color: #fff #adb6c7 #909bb0 #cdd3df;
                color: #354a73;
                text-shadow: 1px 1px rgba(255, 255, 255, 0.3);
                transition: opacity 0.1s;
                opacity: 0.8;
                border-radius: 3px 0 0 3px;
                border-right: 0;
            }

            .esgst-header-menu-button:hover:not(.selected) {
                opacity: 1;
            }

            .esgst-header-menu-button.selected {
                opacity: 0.6;
            }

            .esgst-header-menu-button.arrow {
                border-radius: 0 3px 3px 0;
                border-left: 0;
            }

            .esgst-header-menu-button:not(.arrow) > i {
                margin-right: 10px;
            }

            .esgst-un-button, .page_heading .esgst-heading-button {
                background-image: linear-gradient(#fff 0%, rgba(255, 255, 255, 0.4) 100%);
                border: 1px solid #d2d6e0;
                border-radius: 3px;
                color: #4b72d4;
                cursor: pointer;
                display: inline-block;
                font: 700 14px/22px "Open Sans", sans-serif;
                padding: 5px 15px;
            }
        `;
    }
    esgst.style = insertHtml(document.head, `beforeEnd`, `<style id="esgst-style">${style}</style>`);
}

/* Changelog */

function loadChangelog(version) {
    var changelog, current, html, i, index, n, popup;
    changelog = [
        {
            date: `October 8, 2017`,
            version: `7.0.2`,
            changelog: `
                <ul>
                    <li>The extension should now update automatically on Firefox.</li>
                </ul>
            `
        },
        {
            date: `October 8, 2017`,
            version: `7.0.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug in requests for the same domain on the extension.</li>
                </ul>
            `
        },
        {
            date: `October 8, 2017`,
            version: `7.0.0`,
            changelog: `
                <ul>
                    <li>Replaced the Dropbox SDK with the HTTP endpoints, which should fix some bugs.</li>
                    <li>Fixed a bug in Header Refresher that was not updating the enter buttons in the page.</li>
                    <li>When inside a giveaway that you have no points to enter, the "Not Enough Points" button will now be replaced by Enter/Leave Giveaway Button and update accordingly when you get more points without the need to refresh the page.</li>
                </ul>
                <p>
                    <b>ESGST has been ported to an extension (currently only tested with Firefox and Chrome). Head over to the ESGST discussion or GitHub page to learn how to upgrade. The script version of ESGST will continue to be updated normally for now, whenever the extension is updated (I will decide whether or not to discontinue it based on the extension reception). The "Beta" drop in the version name does not mean the script has become stable.</b>
                </p>
            `
        },
        {
            date: `October 8, 2017`,
            version: `6.Beta.39.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Fixed Sidebar that was happening if the window height was too small.</li>
                    <li>Added options to show the number of unread messages, unviewed keys and unentered wishlist giveaways from Header Refresher as browser notifications (closes <a href="https://github.com/revilheart/ESGST/issues/40">#40</a>).</li>
                    <li>Added "Previously Entered" (must have Entered Games Highlighter enabled) and "Previously Won" filters to Giveaway Filters (closes <a href="https://github.com/revilheart/ESGST/issues/17">#17</a> and <a href="https://github.com/revilheart/ESGST/issues/44">#44</a>).</li>
                    <li>Enter/Leave Giveaway Button no longer shows the enter button for previously won giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/17">#17</a>).</li>
                    <li>You can now filter emojis by name when selecting them in Comment Formatting Helper.</li>
                </ul>
                <p>Renamed the following features>:</p>
                <ul>
                    <li>Train Giveaways Extractor -> Giveaways Extractor - Fixed all bugs, as far as I'm aware (closes <a href="https://github.com/revilheart/ESGST/issues/1">#1</a>).</li>
                </ul>
            `
        },
        {
            date: `October 5, 2017`,
            version: `6.Beta.38.6`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was preventing Enter/Leave Giveaway Button from working correctly.</li>
                </ul>
            `
        },
        {
            date: `October 4, 2017`,
            version: `6.Beta.38.5`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was happening if Giveaway Popup was enabled, but Giveaway Winning Chance/Ratio, Enter/Leave Giveaway Button and Created/Entered/Won Giveaway Details were disabled.</li>
                    <li>Extended the option to hide individual giveaways to group pages.</li>
                    <li>Added an option to Enter/Leave Giveaway Button that allows repeated descriptions from the same creator to be cached for 1 hour and only shown once.</li>
                    <li>You can now add your own description filters to Enter/Leave Giveaway Button.</li>
                </ul>
            `
        },
        {
            date: `October 2, 2017`,
            version: `6.Beta.38.4`,
            changelog: `
                <ul>
                    <li>Fixed a few bugs in Giveaway/Discussion Filters.</li>
                    <li>Introducing "Overrides" to Giveaway/Discussion Filters, which allows you to configure some filters to always filter no matter what exceptions are set.</li>
                </ul>
            `
        },
        {
            date: `October 2, 2017`,
            version: `6.Beta.38.3`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Old Active Discussions Design that was preventing the script from loading correctly.</li>
                </ul>
            `
        },
        {
            date: `October 2, 2017`,
            version: `6.Beta.38.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Comment Formatting Helper that broke the heading buttons.</li>
                    <li>Fixed a style issue that had changed the font in the Comment Formatting Helper popouts (closes <a href="https://github.com/revilheart/ESGST/issues/2">#2</a>).</li>
                    <li>Added an option (Games.3.1) to Game Categories that shows the category colors as a bottom border to the giveaways in Grid View (closes <a href="https://github.com/revilheart/ESGST/issues/5">#5</a>).</li>
                </ul>
            `
        },
        {
            date: `October 2, 2017`,
            version: `6.Beta.38.1`,
            changelog: `
                <ul>
                    <li>Added an option that automatically syncs your groups/games when syncing through SG (closes <a href="https://github.com/revilheart/ESGST/issues/10">#10</a>).</li>
                    <li>Fixed a bug that was not handling some option dependencies correctly (closes <a href="https://github.com/revilheart/ESGST/issues/32">#32</a>).</li>
                    <li>Giveaway Filters exceptions are now applied to all filters instead of just to basic filters.</li>
                    <li>Fixed a bug that was preventing Discussion Filters exceptions from working correctly (closes <a href="https://github.com/revilheart/ESGST/issues/31">#31</a>).</li>
                    <li>Enter/Leave Giveaway Button now recognizes identical descriptions from the same creator and shows the description only once so you don't have to keep reading the same description over and over again (the cache is stored for 1 hour).</li>
                    <li>Added an option (2.17.1) to Enter/Leave Giveaway Button that filters out useless descriptions.</li>
                    <li>Fixed a bug in Giveaway Popup that was popping the description once again after entering the giveaway.</li>
                    <li>Added a 2 minutes delay between the creation of identical giveaways to Multiple Giveaways Creator, as SG now blocks the creation of identical giveaways in less than 2 minutes apart from each other.</li>
                </ul>
            `
        },
        {
            date: `October 2, 2017`,
            version: `6.Beta.38.0`,
            changelog: `
                <ul>
                    <li>Made some style changes to the code.</li>
                    <li>Removed obsolete classes and renamed a few classes.</li>
                    <li>Opening the giveaway description is now mandatory in Enter/Leave Giveaway Button.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>2.16 Giveaway Popup</li>
                </ul>
            `
        },
        {
            date: `September 30, 2017`,
            version: `6.Beta.37.3`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not remembering some data (closes <a href="https://github.com/revilheart/ESGST/issues/29">#29</a>).</li>
                    <li>Fixed a bug that was preventing Multiple Giveaways Creator from creating giveaways.</li>
                </ul>
            `
        },
        {
            date: `September 29, 2017`,
            version: `6.Beta.37.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not allowing the user to delete/undelete comments.</li>
                    <li>Fixed a bug in Multiple Giveaways Creator that was not showing the correct name/exporting games with quotes in their title.</li>
                </ul>
            `
        },
        {
            date: `September 29, 2017`,
            version: `6.Beta.37.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Comment Formatting Helper that was not remembering the choice for uploading images.</li>
                </ul>
            `
        },
        {
            date: `September 29, 2017`,
            version: `6.Beta.37.0`,
            changelog: `
                <ul>
                    <li>localStorage data has been moved back to GM storage, due to size limitations and other factors (closes <a href="https://github.com/revilheart/ESGST/issues/27">#27</a>).</li>
                    <li>Fixed a bug in Endless Scrolling that was not showing the correct link for page divisors  (closes <a href="https://github.com/revilheart/ESGST/issues/28">#28</a>).</li>
                    <li>You can now upload images to Comment Formatting Helper through Imgur (closes <a href="https://github.com/revilheart/ESGST/issues/26">#26</a>).</li>
                </ul>
            `
        },
        {
            date: `September 28, 2017`,
            version: `6.Beta.36.5`,
            changelog: `
                <ul>
                    <li>When importing/exporting/deleting data you can now see how much size each type of data is takin g in the storage and how much is being used by computer/browser storage (closes <a href="https://github.com/revilheart/ESGST/issues/21">#21</a>).</li>
                    <li>You can now specify how often you want Header Refresher to refresh.</li>
                    <li>Hitting the Enter key in the input fields on Advanced Giveaway Search now triggers the search (closes <a href="https://github.com/revilheart/ESGST/issues/23">#23</a>).</li>
                </ul>
            `
        },
        {
            date: `September 26, 2017`,
            version: `6.Beta.36.4`,
            changelog: `
                <ul>
                    <li>Revamped all tables that used the class ".UGDData", which does not exist anymore.</li>
                    <li>Added a couple options to User Giveaways Data that allow you to gather stats about the user's playtime/achievements from won giveaways (currently it cannot check playtime/achievements for DLCs/packages).</li>
                </ul>
            `
        },
        {
            date: `September 23, 2017`,
            version: `6.Beta.36.3`,
            changelog: `
                <ul>
                    <li>Fixed image borders for giveaways with missing image.</li>
                    <li>Added the new search parameters to Advanced Giveaway Search.</li>
                </ul>
            `
        },
        {
            date: `September 21, 2017`,
            version: `6.Beta.36.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was happening when commenting in giveaways.</li>
                    <li>Fixed a bug that was preventing Search Magnifying Glass Button from working.</li>
                </ul>
            `
        },
        {
            date: `September 16, 2017`,
            version: `6.Beta.36.1`,
            changelog: `
                <ul>
                    <li>Added the option to import/export using Dropbox.</li>
                </ul>
            `
        },
        {
            date: `September 16, 2017`,
            version: `6.Beta.36.0`,
            changelog: `
                <ul>
                    <li>Fixed a couple bugs.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>3.3 Close/Open Discussion Button</li>
                </ul>
            `
        },
        {
            date: `September 16, 2017`,
            version: `6.Beta.35.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was preventing features from loading in the main page (closes <a href="https://github.com/revilheart/ESGST/issues/13">#13</a>).</li>
                    <li>Fixed a bug in Header Refresher (closes <a href="https://github.com/revilheart/ESGST/issues/12">#12</a>).</li>
                    <li>Fixed a bug in Comment Formatting Helper that was not adding the selected text as title to links/images (closes <a href="https://github.com/revilheart/ESGST/issues/11">#11</a>).</li>
                </ul>
            `
        },
        {
            date: `September 15, 2017`,
            version: `6.Beta.35.3`,
            changelog: `
                <ul>
                    <li>Removed obsolete functions and made minor style changes to the code.</li>
                    <li>Shortcut Keys has been separated into options so that you can decide which shortcuts to enable.</li>
                    <li>Header Refresher should now refresh individually for different accounts (closes <a href="https://github.com/revilheart/ESGST/issues/4">#4</a>).</li>
                </ul>
            `
        },
        {
            date: `September 13, 2017`,
            version: `6.Beta.35.2`,
            changelog: `
                <ul>
                    <li>Added options to Giveaway Winning Chance/Ratio that allow you to customize how the chances/ratios are shown better (by not adding 1 to the calculation and/or showing the advanced chance/ratio along with the basic one).</li>
                    <li>Fixed a bug in Train Giveaways Extractor that kept extracting when clicking on "Cancel".</li>
                </ul>
                <p>Removed the following features:</p>
                <ul>
                    <li>Entries Remover - <a href="https://www.steamgifts.com/discussion/L5URh/">Implemented on SG.</a></li>
                </ul>
            `
        },
        {
            date: `September 8, 2017`,
            version: `6.Beta.35.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Endless Scrolling that was not loading One-Click Hide Giveaway Button for pages 2+.</li>
                    <li>Fixed a bug in Train Giveaways Extractor that was getting the extraction stuck in an endless loop (closes <a href="https://github.com/revilheart/ESGST/issues/407">#407</a>).</li>
                </ul>
            `
        },
        {
            date: `September 8, 2017`,
            version: `6.Beta.35.0`,
            changelog: `
                <ul>
                    <li>Fixed the script for the recent <a href="https://www.steamgifts.com/discussion/0X36E/">SG changes</a> (closes <a href="https://github.com/revilheart/ESGST/issues/408">#408</a>).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>2.22 Stickied Giveaway Countries</li>
                </ul>
            `
        },
        {
            date: `September 6, 2017`,
            version: `6.Beta.34.21`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not positioning popouts correctly inside of popups.</li>
                    <li>Train Giveaways Extractor now detects badly formed links such as "https://www.steamgifts.com/giveaway/abcde" and corrects them to "https://www.steamgifts.com/giveaway/abcde/" (closes <a href="https://github.com/revilheart/ESGST/issues/406">#406</a>).</li>
                </ul>
            `
        },
        {
            date: `September 6, 2017`,
            version: `6.Beta.34.20`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was happening when closing some popups.</li>
                </ul>
            `
        },
        {
            date: `September 6, 2017`,
            version: `6.Beta.34.19`,
            changelog: `
                <ul>
                    <li>Fixed various bugs.</li>
                    <li>Experimenting with Javascript Classes.</li>
                    <li>Added options (Other.6-Other.7) that allow you disable the popup message about new ESGST updates (closes <a href="https://github.com/revilheart/ESGST/issues/403">#403</a>).</li>
                </ul>
            `
        },
        {
            date: `September 4, 2017`,
            version: `6.Beta.34.18`,
            changelog: `
                <ul>
                    <li>Removed obsolete functions/classes, replaced all checkboxes in checkers with toggle switches, and renamed various classess.</li>
                    <li>Fixed a bug in Tables Sorter that was not sorting numbers in the format XX.XX correctly (closes <a href="https://github.com/revilheart/ESGST/issues/402">#402</a>)</li>
                    <li>Fixed a bug in Discussion Filters that was still enabling the option to hide discussions automatically.</li>
                </ul>
            `
        },
        {
            date: `September 4, 2017`,
            version: `6.Beta.34.17`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Level Progress Visualizer that was still not showing the bar correctly for cases when the user will move to the next level.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>2.33 Delete Keys Confirmation (closes <a href="https://github.com/revilheart/ESGST/issues/399">#399</a>)</li>
                </ul>
            `
        },
        {
            date: `September 4, 2017`,
            version: `6.Beta.34.16`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Level Progress Visualizer that was not showing the bar and title correctly for cases when the user will move to the next level.</li>
                </ul>
            `
        },
        {
            date: `September 4, 2017`,
            version: `6.Beta.34.15`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was always showing the new update message for users with the option to show changelog disabled.</li>
                    <li>Fixed a bug in Discussion Filters that was enabling the option to hide discussions automatically.</li>
                    <li>Fixed a bug in Discussion Filters that was not scrolling the bar with the page.</li>
                </ul>
            `
        },
        {
            date: `September 4, 2017`,
            version: `6.Beta.34.14`,
            changelog: `
                <ul>
                    <li>All required files are now located inside of the script.</li>
                    <li>Removed all uses of GM_info.</li>
                    <li>All uses of GM_setValue/GM_getValue/GM_deleteValue and localStorage are now handled in a single place, which makes future modifications to the storage methods easier and standardizes data management.</li>
                </ul>
            `
        },
        {
            date: `September 3, 2017`,
            version: `6.Beta.34.13`,
            changelog: `
                <ul>
                    <li>All same-origin requests in the script are now made using Javascript's Fetch API instead of GM_xmlhttpRequest (it's still used for cross-origin requests though).</li>
                    <li>Fixed more Endless Scrolling bugs.</li>
                    <li>Discussion Filters has been extended and now has advanced filters just like Giveaway Filters.</li>
                </ul>
            `
        },
        {
            date: `September 3, 2017`,
            version: `6.Beta.34.12`,
            changelog: `
                <ul>
                    <li>The script now also checks if you are on the latest version if you visit the main discussions page and the ESGST discussion is in the current page.</li>
                    <li>Fixed a bug in Multi-Reply that didn't allow you to write a second reply to a comment after submitting another reply.</li>
                </ul>
            `
        },
        {
            date: `September 3, 2017`,
            version: `6.Beta.34.11`,
            changelog: `
                <ul>
                    <li>Page divisors in Endless Scrolling are now removed when sorting tables by ascending/descending and added back when sorting them by default.</li>
                    <li>Added an option (3.5.1) to Discussions Highlighter that brings all highlighted discussions in the current page to the top of the page.</li>
                    <li>Tables Sorter now supports Endless Scrolling (closes <a href="https://github.com/revilheart/ESGST/issues/391">#391</a>).</li>
                </ul>
            `
        },
        {
            date: `September 2, 2017`,
            version: `6.Beta.34.10`,
            changelog: `
                <ul>
                    <li>The icons in Tables Sorter now correspond to the current state of the table, not the state that it will be when clicked.</li>
                    <li>Fixed more Endless Scrolling bugs (closes <a href="https://github.com/revilheart/ESGST/issues/387">#387</a> and <a href="https://github.com/revilheart/ESGST/issues/390">#390</a>).</li>
                    <li>Added an option to show only the link to the Steam Client or the link to the browser or both to Steam Activation Links.</li>
                </ul>
            `
        },
        {
            date: `August 31, 2017`,
            version: `6.Beta.34.9`,
            changelog: `
                <ul>
                    <li>Fixed an undefined variable that was causing a bug to Firefox users with Visible Attached Images enabled.</li>
                    <li>Fixed a couple bugs in Endless Scrolling that were being caused by Game Categories and Collapse/Expand Replies Button.</li>
                </ul>
            `
        },
        {
            date: `August 30, 2017`,
            version: `6.Beta.34.8`,
            changelog: `
                <ul>
                    <li>The script's icon is now stored inside of the script.</li>
                    <li>Added an option (1.14.2) to disable Visible Attached Images in the inbox page.</li>
                    <li>Steam Activation Links now has an additional button to activate the game through the <a href="https://store.steampowered.com/account/registerkey">browser</a> (closes <a href="https://github.com/revilheart/ESGST/issues/388">#388</a>).</li>
                </ul>
            `
        },
        {
            date: `August 29, 2017`,
            version: `6.Beta.34.7`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was showing the left/right buttons from option 8.6 (SG)/9.6 (ST) even when no buttons were hidden.</li>
                    <li>Added an option to reset the sorted contents to their default positions to Giveaways Sorter, Discussions Sorter and Tables Sorter.</li>
                </ul>
            `
        },
        {
            date: `August 29, 2017`,
            version: `6.Beta.34.6`,
            changelog: `
                <ul>
                    <li>Removed obsolete functions.</li>
                    <li>The option to enable new features and functionalities by default will have some exceptions from now on. Options that disable/hide/remove stuff will no longer be enabled by default, because they could give the user the feeling that something stopped working.</li>
                    <li>Fixed a bug that was not importing user data.</li>
                    <li>Fixed a bug that was happening when syncing from "/esgst/sync" (closes <a href="https://github.com/revilheart/ESGST/issues/385">#385</a>).</li>
                    <li>Added an option (8.6 - SG/9.6 - ST) to the settings menu that allows you to hide certain buttons at the left/right sides of the main page heading to reduce the used space.</li>
                    <li>Fixed more bugs in Endless Scrolling.</li>
                    <li>Fixed a bug in Endless Scrolling that was not loading discussion features for page 2+.</li>
                    <li>Fixed a bug in Giveaway Filters that was not showing the correct number of filtered giveaways in the pagination counter.</li>
                    <li>Hidden Games Enter Button Disabler is now responsible for removing the enter button in giveaways for hidden games on the main page (this was previously a default behavior).</li>
                </ul>
            `
        },
        {
            date: `August 28, 2017`,
            version: `6.Beta.34.5`,
            changelog: `
                <ul>
                    <li>Reduced the size of the color inputs and added a line break in the "Alt Account" lines in the settings menu (closes <a href="https://github.com/revilheart/ESGST/issues/384">#384</a>).</li>
                </ul>
            `
        },
        {
            date: `August 28, 2017`,
            version: `6.Beta.34.4`,
            changelog: `
                <ul>
                    <li>Fixed more Endless Scrolling bugs.</li>
                    <li>Added options to Endless Scrolling that brings back page divisors and can be enabled for different types of pages separately.</li>
                    <li>Removed the character limits for User/Game Tags (they were going to be a pain in the ass for Multi-Tag :P).</li>
                    <li>Multi-Tag and the option to manage tags through the settings menu are back (closes <a href="https://github.com/revilheart/ESGST/issues/269">#269</a>).</li>
                </ul>
            `
        },
        {
            date: `August 27, 2017`,
            version: `6.Beta.34.3`,
            changelog: `
                <ul>
                    <li>Fixed more Endless Scrolling bugs.</li>
                </ul>
            `
        },
        {
            date: `August 27, 2017`,
            version: `6.Beta.34.2`,
            changelog: `
                <ul>
                    <li>Fixed a few bugs in Endless Scrolling.</li>
                    <li>Fixed a bug in Giveaway Filters that was not filtering giveaways after page 1 with Endless Scrolling.</li>
                </ul>
                <p>Removed the following features:</p>
                <ul>
                    <li>Removed Game Redirecter - I've made a separate script for this: <a href="https://www.steamgifts.com/discussion/YpiUk/">https://www.steamgifts.com/discussion/YpiUk/</a>.</li>
                </ul>
            `
        },
        {
            date: `August 27, 2017`,
            version: `6.Beta.34.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Tables Sorter that was duplicating the button.</li>
                    <li>Fixed a bug in Users Stats that was conflicting with other popups.</li>
                </ul>
            `
        },
        {
            date: `August 27, 2017`,
            version: `6.Beta.34.0`,
            changelog: `
                <ul>
                    <li>Fixed a typo that was not showing the description for Users Stats in the settings menu.</li>
                    <li>Fixed a bug that was happening in browsers that don't support the use of "forEach" in NodeLists.</li>
                    <li>Fixed a bug that was not properly setting default values in the localStorage.</li>
                    <li>The results in Unsent Gifts Sender now link to the winners page of the giveaways.</li>
                </ul>
                <p>Revamped Endless Scrolling:</p>
                <ul>
                    <li>Fixed a bug that would not load the next page if the page was too small in certain cases (closes <a href="https://github.com/revilheart/ESGST/issues/174">#174</a>).</li>
                    <li>The pages are no longer divided - it's now truly endless.</li>
                    <li>The feature no longer enables Fixed Main Page Heading and Pagination Navigation On Top by default.</li>
                    <li>Added a button that allows you to refresh all currently loaded pages at once.</li>
                    <li>Added a button that allows you to scroll back to the top of the page.</li>
                    <li>The scrolling when clicking on a page number in the pagination from a page that has been loaded is now animated.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>1.19 Tables Sorter</li>
                </ul>
            `
        },
        {
            date: `August 26, 2017`,
            version: `6.Beta.33.5`,
            changelog: `
                <ul>
                    <li>Extended Giveaway Filters to the created/entered/won pages with 4 new filters specific to the created page: "Received", "Not Received", "Awaiting Feedback" and "Deleted" (closes <a href="https://github.com/revilheart/ESGST/issues/223">#223</a>).</li>
                </ul>
            `
        },
        {
            date: `August 26, 2017`,
            version: `6.Beta.33.4`,
            changelog: `
                <ul>
                    <li>Implemented a possible solution for <a href="https://github.com/revilheart/ESGST/issues/353">#353</a>. It would be useful if someone could test it if they know they're going to win a giveaway (100% chance) by not opening another tab when the giveaway ends and performing an action in the current tab that makes a request to SG (for example, refreshing a page through Endless Scrolling) to see if the popup appears.</li>
                    <li>Added a more detailed tooltip to the "Add Alt Account" button in the settings menu, with instructions on how to add the alt account.</li>
                    <li>You can now edit individual giveaways in Multiple Giveaways Creator. Instructions on how to do so are below the trash icon (closes <a href="https://github.com/revilheart/ESGST/issues/381">#381</a>).</li>
                </ul>
            `
        },
        {
            date: `August 26, 2017`,
            version: `6.Beta.33.3`,
            changelog: `
                <ul>
                    <li>Popouts are now properly stacked.</li>
                    <li>Fixed a bug in Giveaways Manager that was not properly exporting giveaways to encrypted giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/379">#379</a>).</li>
                    <li>Giveaways Manager now works with Multiple Giveaways Creator results (closes <a href="https://github.com/revilheart/ESGST/issues/276">#276</a>).</li>
                    <li>Multiple Giveaways Creator now saves a cache whenever you add/import giveaways in case you accidentaly close the page or you have a power outrage so that you don't lose your progress. The cache is automatically loaded when you visit the page again and is only deleted if you click "Empty" or if you successully create the giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/327">#327</a>).</li>
                </ul>
            `
        },
        {
            date: `August 26, 2017`,
            version: `6.Beta.33.2`,
            changelog: `
                <ul>
                    <li>Added an option (7.4.3.2 - SG/8.4.3.2 - ST) to enable "Giveaway Info" category in Game Categories only in the created/entered/won pages.</li>
                    <li>Game Categories now tries to retrieve price and rating information for games that have failed immediately when accessing the page again, instead of waiting 1 week.</li>
                    <li>Added support for alt accounts in the "Owned" category in Game Categories (closes <a href="https://github.com/revilheart/ESGST/issues/280">#280</a>).</li>
                    <li>Fixed Users Stats for the Whitelist/Blacklist Sorter popup (closes <a href="https://github.com/revilheart/ESGST/issues/378">#378</a>).</li>
                </ul>
            `
        },
        {
            date: `August 26, 2017`,
            version: `6.Beta.33.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Encrypter/Decrypter where the icon in the header was always green if the encrypted giveaway was a giveaway that the user cannot access.</li>
                    <li>Giveaways that have not started yet now appear normally in Giveaway Encrypter/Decrypter (closes <a href="https://github.com/revilheart/ESGST/issues/375">#375</a>).</li>
                </ul>
            `
        },
        {
            date: `August 26, 2017`,
            version: `6.Beta.33.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was enabling Collapse/Expand Replies Button for popups.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>2.29 Hidden Games Remover (closes <a href="https://github.com/revilheart/ESGST/issues/299">#299</a>)</li>
                    <li>5.15 (SG)/6.16 (ST) Users Stats (closes <a href="https://github.com/revilheart/ESGST/issues/307">#307</a>)</li>
                </ul>
            `
        },
        {
            date: `August 26, 2017`,
            version: `6.Beta.32.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Shortcut Keys that was firing keys when focused on an input or text area (closes <a href="https://github.com/revilheart/ESGST/issues/377">#377</a>).</li>
                    <li>Fixed a bug that was not showing Giveaway Winning Chance/Ratio for active invite only giveaways in popups.</li>
                    <li>When trying to create a train in Multiple Giveaways Creator with no previous/next/bump links format in the description, an alert will now be shown (closes <a href="https://github.com/revilheart/ESGST/issues/376">#376</a>).</li>
                    <li>You can now use only one type of link in Multiple Giveaways Creator. Before the description had to contain both previous and next links, otherwise it wouldn't work. Now you can have only next links in your train, for example.</li>
                    <li>Fixed a bug in Game Categories that was still not showing rating for non-English users.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>1.12 Attached Images Carousel (closes <a href="https://github.com/revilheart/ESGST/issues/364">#364</a>)</li>
                </ul>
            `
        },
        {
            date: `August 25, 2017`,
            version: `6.Beta.31.15`,
            changelog: `
                <ul>
                    <li>If the option "Show blacklist information." is disabled in Whitelist/Blacklist Checker the word "blacklist" is now wiped from everywhere (closes <a href="https://github.com/revilheart/ESGST/issues/374">#374</a>).</li>
                </ul>
            `
        },
        {
            date: `August 25, 2017`,
            version: `6.Beta.31.14`,
            changelog: `
                <ul>
                    <li>Fixed a style issue in the exception popup in Giveaway Filters for users with small-height screens.</li>
                    <li>You can now enable the simplified version for Game Categories individually.</li>
                </ul>
            `
        },
        {
            date: `August 25, 2017`,
            version: `6.Beta.31.13`,
            changelog: `
                <ul>
                    <li>Revamped the exception popup in Giveaway Filters.</li>
                </ul>
            `
        },
        {
            date: `August 25, 2017`,
            version: `6.Beta.31.12`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Grid View that was happening when opening popups from a discussion page.</li>
                    <li>Fixed a typo in the Giveaway Encrypter/Decrypter source links.</li>
                    <li>When you create a discussion with encrypted giveaways, they are now immediately decrypted and the icon in the header no longer turns green.</li>
                    <li>Added an option to Whitelist/Blacklist Checker to only check users who have not whitelisted/blacklisted you (<a href="https://github.com/revilheart/ESGST/issues/315">#315</a>)).</li>
                </ul>
            `
        },
        {
            date: `August 25, 2017`,
            version: `6.Beta.31.11`,
            changelog: `
                <ul>
                    <li>All popups with a "Load more..." button now support Endless Scrolling (they must be enabled through options 1.19.7-1.19.13) (<a href="https://github.com/revilheart/ESGST/issues/244">#244</a>)).</li>
                    <li>If at least one giveaway in the current batch has been filtered in the Giveaway Encrypter/Decrypter and Train Giveaways Extractor popups, the next batch will now be loaded automatically.</li>
                    <li>When you save a comment with encrypted giveaways, they are now immediately decrypted and the icon in the header no longer turns green (<a href="https://github.com/revilheart/ESGST/issues/272">#272</a>)).</li>
                    <li>Fixed a bug in Giveaway Encrypter/Decrypter that was missing the source for encrypted giveaways added to the OP of a discussion.</li>
                </ul>
            `
        },
        {
            date: `August 24, 2017`,
            version: `6.Beta.31.10`,
            changelog: `
                <ul>
                    <li>Fixed a typo in checkers that was showing a first number higher than the second i.e. 10 of 9 (<a href="https://github.com/revilheart/ESGST/issues/320">#320</a>)).</li>
                    <li>You can now choose which filters you want for Giveaway Filters through the settings menu.</li>
                    <li>Added the option to attach discussions to trains to Multiple Giveaways Creator so that bump links are automatically added when creating trains (<a href="https://github.com/revilheart/ESGST/issues/248">#248</a>)).</li>
                    <li>Made some enhancements to the import popup in Multiple Giveaways Creator (<a href="https://github.com/revilheart/ESGST/issues/372">#372</a>)).
                </ul>
            `
        },
        {
            date: `August 24, 2017`,
            version: `6.Beta.31.9`,
            changelog: `
                <ul>
                    <li>The exceptions in Giveaway Filters should now correctly apply only to the basic filters.</li>
                </ul>
            `
        },
        {
            date: `August 24, 2017`,
            version: `6.Beta.31.8`,
            changelog: `
                <ul>
                    <li>Added an option (1.15.1) to Hidden Community Poll that only hides the poll if you already voted (closes <a href="https://github.com/revilheart/ESGST/issues/317">#317</a>).</li>
                </ul>
            `
        },
        {
            date: `August 24, 2017`,
            version: `6.Beta.31.7`,
            changelog: `
                <ul>
                    <li>Changed the icon used to indicate if an option has sub-options in the settings menu to an ellipsis.</li>
                </ul>
            `
        },
        {
            date: `August 24, 2017`,
            version: `6.Beta.31.6`,
            changelog: `
                <ul>
                    <li>The sidebar in Fixed Sidebar now gets fixed if the page is larger than the window (before it would only get fixed if the page was larger than 2 times the window).</li>
                    <li>Fixed a bug in Giveaway Filters that was filtering all ended giveaways.</li>
                </ul>
            `
        },
        {
            date: `August 24, 2017`,
            version: `6.Beta.31.5`,
            changelog: `
                <ul>
                    <li>Improved the tooltip when creating exceptions in Giveaway Filters to clarify that each exception works as an AND conjunction.</li>
                </ul>
            `
        },
        {
            date: `August 24, 2017`,
            version: `6.Beta.31.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Filters that was filtering exceptions higher or lower than, but not equal.</li>
                </ul>
            `
        },
        {
            date: `August 23, 2017`,
            version: `6.Beta.31.3`,
            changelog: `
                <ul>
                    <li>Moved the script's icon to Dropbox.</li>
                    <li>The script's changelog is now stored inside of the script.</li>
                </ul>
            `
        },
        {
            date: `August 23, 2017`,
            version: `6.Beta.31.2`,
            changelog: `
                <ul>
                    <li>Each option in the settings menu that has sub-options now has a plus icon indicating that.</li>
                    <li>Made the backup download when importing/deleting data an option.</li>
                    <li>Added a confirmation popup that was missing when deleting data.</li>
                    <li>Fixed a bug that was duplicating permalink icons because of recent SG changes.</li>
                    <li>Fixed a bug that was not loading Hidden Blacklist Stats on Firefox (closes <a href="https://github.com/revilheart/ESGST/issues/362">#362</a>).</li>
                    <li>Fixed a bug in Train Giveaways Extractor that was not extracting giveaways correctly when the number of giveaways to be extracted was a multiple of 50 (closes <a href="https://github.com/revilheart/ESGST/issues/363">#363</a>).</li>
                    <li>Fixed a bug in Collapse/Expand Replies Button that was not correctly going to permalinks (closes <a href="https://github.com/revilheart/ESGST/issues/358">#358</a>).</li>
                    <li>Fixed a bug in User Giveaways Data that was happening for invite only giveaways when checking other users (closes <a href="https://github.com/revilheart/ESGST/issues/368">#368</a>).</li>
                    <li>Fixed a bug in Game Categories that was not retrieving rating for non-English users.</li>
                </ul>
            `
        },
        {
            date: `August 23, 2017`,
            version: `6.Beta.31.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Filters that was preventing the script from loading correctly in group pages.</li>
                    <li>Giveaway Copies Highlighter no longer highlights pinned giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/370">#370</a>).</li>
                    <li>Added an option to Unsent Gifts Sender that does not send gifts to blacklisted users.</li>
                    <li>Fixed a bug in Game Categories that was not showing "Full CV" category when first loading a page.</li>
                    <li>You can now color genres in Game Categories from 7.4.23 - SG / 8.4.23 - ST (closes <a href="https://github.com/revilheart/ESGST/issues/369">#369</a>).</li>
                    <li>Duplicates between genres and user-defined tags in Game Categories are now removed.</li>
                </ul>
            `
        },
        {
            date: `August 23, 2017`,
            version: `6.Beta.31.0`,
            changelog: `
                <ul>
                    <li>Renamed the class ".rhHidden" to ".esgst-hidden".</li>
                    <li>Removed useless classes.</li>
                    <li>Fixed a typo in the Level Progress Visualizer tooltip (closes <a href="https://github.com/revilheart/ESGST/issues/367">#367</a>).</li>
                    <li>Fixed a bug in Giveaway Filters that was not properly counting the points to enter all unfiltered giveaways.</li>
                    <li>Added "Minutes To End" filter to Giveaway Filters (closes <a href="https://github.com/revilheart/ESGST/issues/322">#322</a>).</li>
                    <li>Giveaway Filters now has an advanced exceptions tool that allows you to set individual exceptions for all filters (closes <a href="https://github.com/revilheart/ESGST/issues/322">#322</a>).</li>
                    <li>Renaming presets in Giveaway Filters is now much easier: you no longer need to apply the preset to rename it, and upon renaming a preset, it also renames in all pages that are using that preset (closes <a href="https://github.com/revilheart/ESGST/issues/313">#313</a>).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>2.11 Giveaway Copies Highlighter (closes <a href="https://github.com/revilheart/ESGST/issues/322">#322</a>)</li>
                </ul>
            `
        },
        {
            date: `August 21, 2017`,
            version: `6.Beta.30.4`,
            changelog: `
                <ul>
                    <li>Added an option to manage Discussion Filters data to the settings menu.</li>
                    <li>Added a description to Entered Games Highlighter in the settings menu.</li>
                    <li>Enter/Leave Giveaway Button no longer adds a button to giveaways for hidden games in popups.</li>
                    <li>Fixed a bug in Unsent Gifts Sender and Whitelist/Blacklist Checker that was not detecting groups correctly. As a result, the way the groups are stored has changed (you must sync your groups immediately after this version).</li>
                    <li>Fixed the first emoji in Comment Formatting Helper (\\_()_/ -> \\\_()_/).</li>
                    <li>Added an option (7.4.8.1 - SG / 8.4.8.1 - ST) to Game Categories that does not show "Reduced CV" if a game has both "Reduced CV" and "No CV".</li>
                </ul>
            `
        },
        {
            date: `August 20, 2017`,
            version: `6.Beta.30.3`,
            changelog: `
                <ul>
                    <li>Fixed a typo in the sync that was showing the same message for syncing hidden and wishlisted/owned/ignored games.</li>
                    <li>Fixed a bug that was happening when storing/syncing giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/365">#365</a>).</li>
                    <li>Fixed a bug in Header Refresher that was not filtering entered giveaways after entering them.</li>
                    <li>Fixed a bug in Main Post Popup that was preventing the script from loading correctly.</li>
                    <li>Fixed a bug in Comment Formatting Helper that was not saving emojis.</li>
                    <li>Fixed a bug in Shared Groups Checker that was not indentifying shared groups with uppercase letters.</li>
                </ul>
            `
        },
        {
            date: `August 19, 2017`,
            version: `6.Beta.30.2`,
            changelog: `
                <ul>
                    <li>Added an option (2.18.1) to Giveaway Recreator to remove the button for giveaways that have been recreated.</li>
                    <li>Giveaway Recreator now runs on the created page, opens in a new tab and is also shown for giveaways with less entries than copies.</li>
                    <li>Deleting presets, templates and saved replies no longer prompts for a confirmation. Instead a "Undo Delete" button will appear so you can restore them if you deleted them by mistake (closes <a href="https://github.com/revilheart/ESGST/issues/206">#206</a>).</li>
                    <li>Fixed a style issue in Giveaway Groups Loader that was not repositioning popups (closes <a href="https://github.com/revilheart/ESGST/issues/232">#232</a>).</li>
                    <li>Fixed a style issue in Giveaway Groups Loader that was adding double underlines to groups (closes <a href="https://github.com/revilheart/ESGST/issues/247">#247</a>).</li>
                    <li>Removed the user icon from Giveaway Groups Loader, since the feature shows avatars again.</li>
                </ul>
            `
        },
        {
            date: `August 19, 2017`,
            version: `6.Beta.30.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not enabling Giveaway Recreator in profile pages other than page 1.</li>
                </ul>
            `
        },
        {
            date: `August 19, 2017`,
            version: `6.Beta.30.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was preventing the script from running in the entered/won pages.</li>
                    <li>Giveaways visited or hidden no longer count for the option in Header Refresher to indicate if there are unentered wishlist giveaways open.</li>
                    <li>Fixed a bug in Endless Scrolling that was not reversing the pages correctly.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>2.18 Giveaway Recreator</li>
                </ul>
            `
        },
        {
            date: `August 19, 2017`,
            version: `6.Beta.29.0`,
            changelog: `
                <ul>
                    <li>Added an option to sync your giveaways from the settings menu, without the need to use User Giveaways Data.</li>
                    <li>Fixed a bug that was not showing the button to manage hidden discussions in the settings menu.</li>
                    <li>If you have Level Progress Visualizer, Created/Entered/Won Giveaway Details, Real CV Calculator or the "Giveaway Info" category in Game Categories enabled, when you create a giveaway you will now get a popup asking you to wait a few seconds until the giveaway is saved in the storage for those features.</li>
                    <li>Level Progress Visualizer now projects what your level will be after your active giveaways end and get marked as received (only works for giveaways created after v6.Beta.29.0) (closes <a href="https://github.com/revilheart/ESGST/issues/181">#181</a>).</li>
                    <li>Real CV Calculator and the "Giveaway Info" category in Game Categories now both take into account active giveaways for calculation (closes <a href="https://github.com/revilheart/ESGST/issues/297">#297</a>).</li>
                    <li>Fixed a bug in Giveaway Filters that was not filtering some filters (closes <a href="https://github.com/revilheart/ESGST/issues/359">#359</a>).</li>
                    <li>Changed how User Giveaways Data is stored.</li>
                    <li>Fixed a bug in Game Categories that was showing the wrong icon/label for the "Multiplayer" category.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>2.25 Giveaways Manager (closes <a href="https://github.com/revilheart/ESGST/issues/197">#197</a>)</li>
                </ul>
            `
        },
        {
            date: `August 17, 2017`,
            version: `6.Beta.28.3`,
            changelog: `
                <ul>
                    <li>Moved all the instructions on Multiple Giveaways Creator to tooltips.</li>
                    <li>Multiple Giveaways Creator now automatically recognizes if the key is before or after the game name when importing (closes <a href="https://github.com/revilheart/ESGST/issues/267">#267</a>).</li>
                    <li>Added the "Portal ABCDE-FGHIJ-KLMNO ABCDE-FGHIJ-PQRST" format to Multiple Giveaways Creator, which allows you to put all keys for a giveaway in front of each other instead of in separate lines.</li>
                    <li>Fixed a bug in Game Categories that was showing the "Full CV" category for no CV games.</li>
                </ul>
            `
        },
        {
            date: `August 17, 2017`,
            version: `6.Beta.28.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was deleting data from the other list when syncing only one of whitelist/blacklist.</li>
                    <li>Fixed a bug that was enabling Giveaway Templates even when disabled.</li>
                    <li>Fixed a bug that was happening in the created/entered/won pages if the popup option was enabled in Giveaway Groups Loader.</li>
                </ul>
            `
        },
        {
            date: `August 16, 2017`,
            version: `6.Beta.28.1`,
            changelog: `
                <ul>
                    <li>Shortcut Keys and the option 1.17.2 are now enabled for SteamTrades (they should have been all along, but I somehow forgot to do it).</li>
                    <li>You can now mark discussions/trades as read in Giveaways/Discussions/Tickets/Trades Tracker from inside of them if option 1.17.2 is disabled.</li>
                    <li>Added support for active giveaways to Sent Keys Searcher. Keys from active giveaways will have a "[UNASSIGNED]" tag next to them.</li>
                    <li>The number of unread comments in Comment Tracker is now also shown inside of giveaways/discussions/tickets/trades and changes as you read/unread comments in the page.</li>
                </ul>
            `
        },
        {
            date: `August 16, 2017`,
            version: `6.Beta.28.0`,
            changelog: `
                <ul>
                    <li>Popups are now properly stacked.</li>
                    <li>Added the hide game buttons to popups (closes <a href="https://github.com/revilheart/ESGST/issues/337">#337</a>).</li>
                    <li>Fixed a bug in Endless Scrolling that was reversing the comments even with the feature disabled.</li>
                    <li>Giveaway Filters now shows how many points are required to enter all unfiltered giveaways.</li>
                    <li>Added an option (2.15.1) to Enter/Leave Giveaway Button that allows you to enable the feature only for popups (closes <a href="https://github.com/revilheart/ESGST/issues/341">#341</a>).</li>
                    <li>Train Giveaways Extractor now shows how many points are required to enter all giveaways in the train (closes <a href="https://github.com/revilheart/ESGST/issues/341">#341</a>).</li>
                    <li>Fixed a bug that was enabling Not Received Finder for users when it shouldn't.</li>
                    <li>Fixed a bug in Game Categories that was showing the "Hidden" icon for "Wishlisted" icons.</li>
                    <li>Moved the icon descriptions in Game Categories to tooltips (closes <a href="https://github.com/revilheart/ESGST/issues/355">#355</a>).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>2.23 Sent Keys Searcher (closes <a href="https://github.com/revilheart/ESGST/issues/331">#331</a>)</li>
                    <li>3.3 Discussion Filters (closes <a href="https://github.com/revilheart/ESGST/issues/336">#336</a>)</li>
                    <li>[4.1 - SG / 5.1 - ST] Collapse/Expand Replies Button (closes <a href="https://github.com/revilheart/ESGST/issues/346">#346</a>)</li>
                </ul>
            `
        },
        {
            date: `August 16, 2017`,
            version: `6.Beta.27.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was happening in Entered Games Highlighter.</li>
                    <li>Fixed a bug in Game Categories that was showing the default label for some categories in the settings menu instead of the custom one.</li>
                    <li>Increased the Game Categories cache from 24 hours to 1 week and separated the cache for each game.</li>
                </ul>
            `
        },
        {
            date: `August 16, 2017`,
            version: `6.Beta.27.3`,
            changelog: `
                <ul>
                    <li>Fixed a returning style issue that was not centering the outdated version popup.</li>
                    <li>Added 3 buttons below the comments in Comment Tracker: "mark this comment as read and go to the next unread comment", "mark all comments from this comment upwards as read" and "mark all comments from this comment upwards as unread".</li>
                    <li>Fixed a bug in Game Categories that was happening when making too many requests to the Steam store in a short amount of time (closes <a href="https://github.com/revilheart/ESGST/issues/352">#352</a>).</li>
                    <li>Fixed a style issue in Game Categories that was breaking polls (closes <a href="https://github.com/revilheart/ESGST/issues/342">#342</a>).</li>
                    <li>Added an option (7.4.2 - SG / 8.4.2 - ST) to Game Categories that allows you to decide whether to show the categories next to the game name or below it.</li>
                    <li>Added an option (7.4.4.1 - SG / 8.4.4.1 - ST) to Game Categories to only show the "Giveaway Info" category in discussion tables (closes <a href="https://github.com/revilheart/ESGST/issues/265">#265</a>).</li>
                </ul>
            `
        },
        {
            date: `August 16, 2017`,
            version: `6.Beta.27.2`,
            changelog: `
                <ul>
                    <li>Fixed some style issues in popups (closes <a href="https://github.com/revilheart/ESGST/issues/347">#347</a> and <a href="https://github.com/revilheart/ESGST/issues/350">#350</a>).</li>
                    <li>You can now use custom icons/labels for Game Categories.</li>
                </ul>
            `
        },
        {
            date: `August 16, 2017`,
            version: `6.Beta.27.1`,
            changelog: `
                <ul>
                    <li>Fixed a style issue that was adding an additional column to created/won pages.</li>
                    <li>Fixed a bug in Giveaway Filters that was not saving started/ended filter settings.</li>
                    <li>Fixed a style issue that was adding a plus sign instead of a minus sign to Enter/Leave Giveaway Button inside of popups.</li>
                    <li>Fixed a bug that was running Giveaway Winners Link inside of giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/351">#351</a>).</li>
                    <li>Fixed a bug that was preventing Giveaway Error Search Links from running.</li>
                </ul>
            `
        },
        {
            date: `August 15, 2017`,
            version: `6.Beta.27.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Templates that was not closing the template popup when applying a template (closes <a href="https://github.com/revilheart/ESGST/issues/349">#349</a>).</li>
                    <li>Giveaway Templates no longer displays "?-?" if a template does not have precise start and end times (closes <a href="https://github.com/revilheart/ESGST/issues/339">#339</a>).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Shortcut Keys (closes <a href="https://github.com/revilheart/ESGST/issues/348">#348</a>)</li>
                </ul>
            `
        },
        {
            date: `August 15, 2017`,
            version: `6.Beta.26.10`,
            changelog: `
                <ul>
                    <li>Fixed a Comment Tracker bug.</li>
                    <li>Separated the default Giveaway Bookmarks behavior of automatically unbookmarking ended giveaways into an option (2.9.2). With this option disabled, ended giveaways will remain in the bookmarked list until manually unbookmarked.</li>
                </ul>
            `
        },
        {
            date: `August 15, 2017`,
            version: `6.Beta.26.9`,
            changelog: `
                <ul>
                    <li>Fixed a typo in the description of Whitelist/Blacklist Highlighter.</li>
                    <li>Separated the default Giveaways/Discussions/Tickets/Trades Tracker behavior of marking the pages as visited when visiting them into an option (1.16.2). With this option disabled, the only way to mark them as visited is manually through the check button.</li>
                    <li>Fixed a bug in Giveaway Winners Link that was not enabling it everywhere.</li>
                    <li>Fixed a bug in Unsent Gifts Sender that was not sending all gifts if a winner was being rerolled.</li>
                </ul>
            `
        },
        {
            date: `August 15, 2017`,
            version: `6.Beta.26.8`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not showing "Rating" category in Game Categories.</li>
                </ul>
            `
        },
        {
            date: `August 15, 2017`,
            version: `6.Beta.26.7`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was happening for new users.</li>
                </ul>
            `
        },
        {
            date: `August 15, 2017`,
            version: `6.Beta.26.6`,
            changelog: `
                <ul>
                    <li>Fixed a style issue that was blurring popups (closes <a href="https://github.com/revilheart/ESGST/issues/347">#347</a>).</li>
                    <li>Rolled Game Categories back to retrieving the categories manually, since Google Sheets was not able to handle the quota, but kept the 24-hour cache.</li>
                </ul>
            `
        },
        {
            date: `August 14, 2017`,
            version: `6.Beta.26.5`,
            changelog: `
                <ul>
                    <li>Popups are now fixed in the center of the page (closes <a href="https://github.com/revilheart/ESGST/issues/238">#238</a>).</li>
                    <li>Added a small 24-hour cache to Game Categories.</li>
                </ul>
            `
        },
        {
            date: `August 14, 2017`,
            version: `6.Beta.26.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not showing some categories or was duplicating some categories in Game Categories (closes <a href="https://github.com/revilheart/ESGST/issues/340">#340</a>).</li>
                </ul>
            `
        },
        {
            date: `August 14, 2017`,
            version: `6.Beta.26.3`,
            changelog: `
                <ul>
                    <li>Added an option to sync "No CV Games" to the settings menu and renamed the option to sync bundles to "Reduced CV Games".</li>
                    <li>Removed the "Bundled" and "Not Bundled" categories from Game Categories and added the "Full CV", "Reduced CV" and "No CV" categories. The "No CV" category is currently updated manually, so it might take some time until a game is added to the list. You must sync "Reduced CV Games" through the settings menu in this update otherwise the old "bundled" data will not appear.</li>
                    <li>The "Giveaway Info" category from Game Categories and Real CV Calculator now both use the "No CV" data to correctly calculate the CV.</li>
                </ul>
            `
        },
        {
            date: `August 14, 2017`,
            version: `6.Beta.26.2`,
            changelog: `
                <ul>
                    <li>Removed Game Categories from the new giveaway page, since SG now shows an asterisk there if the game is bundled.</li>
                    <li>You can now sort the categories in Game Categories from the settings menu (you will find it at the end of the Game Categories section - Games.4).</li>
                    <li>EXPERIMENTAL: Game Categories are now loaded from a Google Sheet instead of being stored locally (closes <a href="https://github.com/revilheart/ESGST/issues/291">#291</a> and <a href="https://github.com/revilheart/ESGST/issues/302">#302</a>). If you're requesting games for the first time, it should take around 15 seconds for the categories to load, but every other time it should be a lot faster, sometimes loading instantly or after around 2 seconds. I believe this is a worth time to wait considering this method doesn't consume any memory. This method is experimental though, since I'm not sure if Google Sheets will be able to handle the request quota, but worst case scenario I can add a manual request method as fallback later.</li>
                    <li>Added Game Categories data to the "Wipe Storage" button in the settings menu, now that this data is no longer stored locally and therefore useless to keep.</li>
                </ul>
            `
        },
        {
            date: `August 13, 2017`,
            version: `6.Beta.26.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was preventing some users from exporting data (closes <a href="https://github.com/revilheart/ESGST/issues/335">#335</a>).</li>
                </ul>
            `
        },
        {
            date: `August 13, 2017`,
            version: `6.Beta.26.0`,
            changelog: `
                <ul>
                    <li>Completely removed support for storages from older versions. Users coming from very old versions will now have to downgrade to v25.5 before upgrading to 26.0 to carry their data on.</li>
                    <li>Added buttons that allow you to select all/none/inverse when importing/exporting/deleting (closes <a href="https://github.com/revilheart/ESGST/issues/251">#251</a>).</li>
                    <li>Fixed a bug that was adding the Comment Formatting Helper panel to the keys text area in the new giveaway page.</li>
                </ul>
                <p>Renamed the settings and sync pages:</p>
                <ul>
                    <li>/esgst-settings -> /esgst/settings</li>
                    <li>/esgst-sync -> /esgst/sync</li>
                </ul>
                <p>Revamped the import/export/delete tools and added specific pages for them:</p>
                <ul>
                    <li>/esgst/import</li>
                    <li>/esgst/export</li>
                    <li>/esgst/delete</li>
                </ul>
                <p>WARNING: Any exported files from versions prior to v26.0 are no longer supported. If you have old exported files that you wish to make compatible with v26.0+, you'll have to downgrade to v25.5, import the file, upgrade to v26.0 and export it.</p>
            `
        },
        {
            date: `August 11, 2017`,
            version: `6.Beta.25.5`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was replacing giveaway data for users who did not previously update to 25.0.</li>
                </ul>
            `
        },
        {
            date: `August 11, 2017`,
            version: `6.Beta.25.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaways/Discussions/Tickets/Trades Tracker that was not fading out visited places.</li>
                </ul>
            `
        },
        {
            date: `August 11, 2017`,
            version: `6.Beta.25.3`,
            changelog: `
                <ul>
                    <li>Fixed a bug with the Comment Tracker localStorage.</li>
                </ul>
            `
        },
        {
            date: `August 11, 2017`,
            version: `6.Beta.25.2`,
            changelog: `
                <ul>
                    <li>Moved Comment Tracker data to localStorage.</li>
                    <li>Removed tooltips from the manage popup in the settings menu, as they were redundant (closes <a href="https://github.com/revilheart/ESGST/issues/196">#196</a>).</li>
                    <li>Removed redundant "data" and period from the manage popup in the settings menu (closes <a href="https://github.com/revilheart/ESGST/issues/253">#253</a>).</li>
                    <li>Fixed a bug that was duplicating the Comment Formatting Helper panel in some places (closes <a href="https://github.com/revilheart/ESGST/issues/330">#330</a>).</li>
                </ul>
            `
        },
        {
            date: `August 10, 2017`,
            version: `6.Beta.25.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug with the rerolls/winners localStorage (possible solution for <a href="https://github.com/revilheart/ESGST/issues/329">#329</a>).</li>
                </ul>
            `
        },
        {
            date: `August 10, 2017`,
            version: `6.Beta.25.0`,
            changelog: `
                <ul>
                    <li>Moved all data that doesn't need to be shared between SG and ST to localStorage, to start getting rid of GM_setValue/GM_getValue and hopefully improve the script's performance. This data includes: entries, giveaways, groups, rerolls, templates and winners. As a result, this data can no longer be managed through SteamTrades, only through SteamGifts. A button has been added to the settings menu to wipe the GM_setValue/GM_getValue data from the storage (make sure to backup through Tampermonkey before doing this).</li>
                    <li>The script's settings page now has the title "ESGST Settings" and the icon of the script as favicon.</li>
                    <li>Fixed a style issue that was making tooltips appear behind popups/popouts (closes <a href="https://github.com/revilheart/ESGST/issues/321">#321</a>).</li>
                    <li>Fixed a style issue with the source link in Giveaways Encrypter/Decrypter that was affecting non-grid view (closes <a href="https://github.com/revilheart/ESGST/issues/326">#326</a>).</li>
                    <li>The currently used preset in Giveaway Filters is now highlighted in the preset list (closes <a href="https://github.com/revilheart/ESGST/issues/312">#312</a>).</li>
                    <li>Chances lower than 0.01 are now rounded up to 0.01 in Giveaway Winning Chance (closes <a href="https://github.com/revilheart/ESGST/issues/324">#324</a>).</li>
                    <li>Added a confirmation dialog to Multiple Giveaways Creator when trying to leave the new giveaway page if giveaways have been added (closes <a href="https://github.com/revilheart/ESGST/issues/328">#328</a>).</li>
                    <li>Fixed a bug in Comment Formatting Helper that was not adding the panel to text areas in the new ticket page (closes <a href="https://github.com/revilheart/ESGST/issues/325">#325</a>).</li>        </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>General.8 Search Maginifying Glass Button (closes <a href="https://github.com/revilheart/ESGST/issues/319">#319</a>)</li>
                </ul>
            `
        },
        {
            date: `August 6, 2017`,
            version: `6.Beta.24.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Header Refresher that was no longer indicating the unread messages in the tab icon.</li>
                    <li>The name of the preset currently being used is now displayed next to the filtered count in Giveaway Filters (closes <a href="https://github.com/revilheart/ESGST/issues/314">#314</a>).</li>
                    <li>Fixed a bug in Active Discussions On Top/Sidebar that was using classes from the sidebar option in the top option.</li>
                    <li>Fixed a bug in Game Categories that was coloring all categories red.</li>
                </ul>
            `
        },
        {
            date: `August 6, 2017`,
            version: `6.Beta.24.1`,
            changelog: `
                <ul>
                    <li>Removed all uses of GM_addStyle and GM_getResourceURL.</li>
                    <li>Improved CSS injection (all CSS is now injected at once).</li>
                    <li>Cloned most SG classes for the settings menu.</li>
                    <li>Added an option (Other.3) to open the settings in a new tab.</li>
                </ul>
            `
        },
        {
            date: `August 6, 2017`,
            version: `6.Beta.24.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Givewaways Encrypter/Decrypter that was duplicating decrypted giveaways when editing a comment (closes <a href="https://github.com/revilheart/ESGST/issues/304">#304</a>).</li>
                    <li>Fixed a bug that was not calculating ratio/chance inside of invite only giveaways.</li>
                    <li>Added "Started" and "Ended" filters to Giveaway Filters.</li>
                    <li>Whitelist/Blacklist Checker now only stores data if the result is either whitelisted or blacklisted. Any other data will be wiped from the storage.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Comments.5 Received Reply Box Popup (closes <a href="https://github.com/revilheart/ESGST/issues/305">#305</a>)</li>
                </ul>
            `
        },
        {
            date: `August 4, 2017`,
            version: `6.Beta.23.7`,
            changelog: `
                <ul>
                    <li>Fixed some bugs caused by cg's latest changes.</li>
                    <li>Removed the option to automatically load the CV when opening users' profiles from Real Won/Sent CV Links, since this has been added by cg.</li>
                    <li>The ratio in Sent/Won Ratio is now more detailed, breaking down the ratio between full value, reduced value and no value, and also showing the dollar ratio (with real value included).</li>
                </ul>
            `
        },
        {
            date: `August 2, 2017`,
            version: `6.Beta.23.6`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Fixed Sidebar that was fixing the sidebar immediately without scrolling the page.</li>
                    <li>When syncing, the script will now show a list of missing/new groups/games (closes <a href="https://github.com/revilheart/ESGST/issues/268">#268</a>).</li>
                    <li>Unsent Gifts Sender no longer shows the sent/unsent items if 0 gifts were sent/unsent (closes <a href="https://github.com/revilheart/ESGST/issues/290">#290</a>).</li>
                    <li>Moved the area where the results appear in Unsent Gifts Sender to below the button.</li>
                    <li>Fixed a bug in Entries Remover that was not going through the pages correctly.</li>
                </ul>
            `
        },
        {
            date: `August 1, 2017`,
            version: `6.Beta.23.5`,
            changelog: `
                <ul>
                    <li>Separated the functionality of fading giveaways in One-Click Hide Giveaway Button into an option (Giveaways.11.1).</li>
                    <li>Fixed a bug that was showing chance/ratio in the review giveaway page (closes <a href="https://github.com/revilheart/ESGST/issues/201">#201</a>).</li>
                    <li>Fixed a bug that was not showing chance/ratio for ended invite only giveaways.</li>
                    <li>Next/Previous Train Hotkeys now uses the browser history to go to the previous wagon if there isn't a previous link (closes <a href="https://github.com/revilheart/ESGST/issues/300">#300</a>).</li>
                </ul>
            `
        },
        {
            date: `July 31, 2017`,
            version: `6.Beta.23.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Filters that was not detecting "Owned", "Wishlisted", "Hidden", "Ignored" and "Bundled" filters in popup filters.</li>
                    <li>Moved Giveaway Filters to the main page heading, so that it scrolls with the page.</li>
                    <li>One-Click Hide Giveaway Button no longer immediately removes the giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/271">#271</a>), but simply fades them, in case of accidental clicks, and also adds a button to unhide the giveaway.</li>
                </ul>
            `
        },
        {
            date: `July 30, 2017`,
            version: `6.Beta.23.3`,
            changelog: `
                <ul>
                    <li>Giveaways Sorter and Discussions Sorted now remember the last selected option and have an option to auto sort the pages when loading them.</li>
                    <li>Extended Giveaways Sorter to user and group pages.</li>
                    <li>Added a button to Giveaway Filters that allows you to enable/disable all filters for the current page (closes <a href="https://github.com/revilheart/ESGST/issues/292">#292</a>).</li>
                    <li>"Owned", "Wishlisted", "Hidden", "Ignored" and "Bundled" filters have been moved from category filters to type filters and now work with Game Categories disabled.</li>
                    <li>Giveaway Filters now works with presets (closes <a href="https://github.com/revilheart/ESGST/issues/192">#192</a>) and no longer saves automatically when altering filters (you have to click "Save" to update the current preset).</li>
                    <li>Fixed a bug in Created/Entered/Won Giveaway Details that was switching headers in the created/won pages.</li>
                    <li>Prevented "Bundled" category in Game Categories from loading in the bundle list page.</li>
                </ul>
            `
        },
        {
            date: `July 29, 2017`,
            version: `6.Beta.23.2`,
            changelog: `
                <ul>
                    <li>Renamed the CSS variables in Level Progress Visualizer to make them unique.</li>
                </ul>
            `
        },
        {
            date: `July 29, 2017`,
            version: `6.Beta.23.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was corrupting the user data when importing without "Merge" enabled.</li>
                </ul>
            `
        },
        {
            date: `July 29, 2017`,
            version: `6.Beta.23.0`,
            changelog: `
                <ul>
                    <li>Bundles are now synced from a Google Sheet database that is updated daily. To get more info about the database, check this thread: https://www.steamgifts.com/discussion/qcvQE/</li>
                    <li>All checkers now show how many pages there are left to check (closes <a href="https://github.com/revilheart/ESGST/issues/53">#53</a>).</li>
                    <li>Added some CSS variables to Level Progress Visualizer so themes are able to customize it.</li>
                    <li>Expanded Discussions Sorter.</li>
                    <li>The created trades page is now refreshed if open when auto bumping from Trades Bumper.</li>
                    <li>Decrypted giveaways added to posts during editing now appear immediately without having to refresh the page (only works with Multi-Reply or Reply From Inbox) (closes <a href="https://github.com/revilheart/ESGST/issues/228">#228</a>).</li>
                    <li>Added an option (Comments.7.1) to Reply From Inbox that keeps the replies in the inbox page when refreshing (closes <a href="https://github.com/revilheart/ESGST/issues/179">#179</a>).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>General.13 Hidden Community Poll</li>
                    <li>Giveaways.4 Giveaways Sorter (closes <a href="https://github.com/revilheart/ESGST/issues/198">#198</a>)</li>
                </ul>
            `
        },
        {
            date: `July 28, 2017`,
            version: `6.Beta.22.3`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Level Progress Visualizer.</li>
                </ul>
            `
        },
        {
            date: `July 28, 2017`,
            version: `6.Beta.22.2`,
            changelog: `
                <ul>
                    <li>Added some tooltips to the color pickers in User/Game Tags.</li>
                </ul>
            `
        },
        {
            date: `July 28, 2017`,
            version: `6.Beta.22.1`,
            changelog: `
                <ul>
                    <li>Fixed a typo in Giveaways.14 (closes <a href="https://github.com/revilheart/ESGST/issues/294">#294</a>).</li>
                    <li>Fixed a style issue in Level Progress Visualizer (closes <a href="https://github.com/revilheart/ESGST/issues/150">#150</a>).</li>
                    <li>Fixed a bug that was enabling Pagination Navigation On Top even if it was disabled.</li>
                    <li>Fixed a bug in Giveaway Filters that was preventing the script from loading correctly for some users.</li>
                    <li>You can now drag and drop templates in Giveaway Templates (closes <a href="https://github.com/revilheart/ESGST/issues/246">#246</a>).</li>
                    <li>Fixed a bug in Giveaway Winning Chance/Ratio that was miscalculation entered giveaways if visiting them (closes <a href="https://github.com/revilheart/ESGST/issues/296">#296</a>).</li>
                    <li>Multiple Giveaways Creator now trims the list of games before importing to make sure there are no empty lines or lines with white space at the beginning/end. (closes <a href="https://github.com/revilheart/ESGST/issues/298">#298</a>).</li>
                    <li>Fixed a bug in Unsent Gifts Sender that was not sending gifts if none of the options were enabled (closes <a href="https://github.com/revilheart/ESGST/issues/301">#301</a>).</li>
                    <li>Added some limits to User/Game Tags: you are now allowed a maximum character count of 64 for user tags and 32 for game tags.</li>
                    <li>User/Game Tags can now be colored individually.</li>
                    <li>The buttons in User/Game Tags are now faded out if there are no tags saved (useful for places where the tags are not displayed, such as inside Active Discussions On Sidebar or Grid View).</li>
                    <li>Fixed a bug in Game Categories that was adding user-defined tags to the list of genres even if the option was disabled (partial solution to <a href="https://github.com/revilheart/ESGST/issues/291">#291</a>).</li>
                </ul>
            `
        },
        {
            date: `July 27, 2017`,
            version: `6.Beta.22.0`,
            changelog: `
                <ul>
                    <li>The heading "Chance / Ratio" in the entered page now changes to "Chance" or "Ratio" if one of the features is disabled.</li>
                    <li>Fixed a bug in Giveaway Winning Chance that was unable to calculate the advanced formula in the entered page due to the lack of the start time information (the advanced formula now only works outside of the entered page).</li>
                    <li>Added the advanced formula and color settings from Giveaway Winning Chance also to Giveaway Winning Ratio.</li>
                    <li>Added an option (Trades.1.1) that auto bumps your trades every hour.</li>
                    <li>Fixed a bug in Comment Tracker that was preventing users from making comments in giveaways.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Giveaways.22 Entries Tracker</li>
                    <li>Comments.2 Comment Searcher</li>
                </ul>
            `
        },
        {
            date: `July 27, 2017`,
            version: `6.Beta.21.5`,
            changelog: `
                <ul>
                    <li>Prevended the advanced formula in Giveaway Winning Chance from loading for ended giveaways.</li>
                    <li>Added an option (Comments.2.20) to Comment Formatting Helper that allows you to save replies for later use (closes <a href="https://github.com/revilheart/ESGST/issues/170">#170</a>).</li>
                    <li>Separated the Comment Tracker change from the last update into a new option (Comments.7.1.1).</li>
                </ul>
                <p>Upgraded the following features to v6:</p>
                <ul>
                    <li>Groups.2 Groups Stats - No major changes, simply removed the request limit.</li>
                </ul>
            `
        },
        {
            date: `July 26, 2017`,
            version: `6.Beta.21.4`,
            changelog: `
                <ul>
                    <li>Added an option (2.12.1) to Giveaway Winning Chance that uses an advanced formula to calculate the chance, involving the start and end times of the giveaway.</li>
                    <li>Added an option (2.12) to Giveaway Winning Chance that allows you to color chances from different ranges.</li>
                    <li>The simplified version of Comment Tracker now counts all comments as read if the discussion hasn't been visited yet.</li>
                </ul>
            `
        },
        {
            date: `July 26, 2017`,
            version: `6.Beta.21.3`,
            changelog: `
                <ul>
                    <li>Added a class to Image Borders elements.</li>
                </ul>
            `
        },
        {
            date: `July 26, 2017`,
            version: `6.Beta.21.2`,
            changelog: `
                <ul>
                    <li>Added an option to import/export/delete Inbox Winners Highlighter data.</li>
                    <li>Removed a gap in Grid View that was being added between the image and the popout.</li>
                    <li>Added an option (Other.2) that automatically updates your whitelist/blacklist when you add/remove a user to/from those lists, without the need of syncing through the settings menu.</li>
                    <li>Fixed a bug in Entries Remover that was not resetting the button (closes <a href="https://github.com/revilheart/ESGST/issues/286">#286</a>).</li>
                    <li>Fixed a bug in Comment Tracker that was not marking replies as read from the inbox page on SteamTrades.</li>
                </ul>
                <p>Upgraded the following features to v6:</p>
                <ul>
                    <li>Giveaways.2.21 Unsent Gifts Sender - Revamped the feature, fixed some bugs and made some improvements (closes <a href="https://github.com/revilheart/ESGST/issues/69">#69</a>, <a href="https://github.com/revilheart/ESGST/issues/163">#163</a>, <a href="https://github.com/revilheart/ESGST/issues/234">#234</a>, <a href="https://github.com/revilheart/ESGST/issues/241">#241</a>, <a href="https://github.com/revilheart/ESGST/issues/264">#264</a> and <a href="https://github.com/revilheart/ESGST/issues/287">#287</a>). Added an option to only send gifts to group members with a certain gift difference.</li>
                </ul>
            `
        },
        {
            date: `July 26, 2017`,
            version: `6.Beta.21.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was preventing the script from running if some features were disabled.</li>
                    <li>Fixed a bug in Fixed Header for SteamTrades.</li>
                    <li>Fixed a bug in Trades Bumper that wasn't bumping the trades.</li>
                    <li>Fixed a bug in Comment Tracker that wasn't loading the feature for the other pages when using Endless Scrolling.</li>
                    <li>Added an option (Comments.7.2) to Comment Tracker to automatically mark all comments in the inbox as read when clicking on the "Mark as Read" button.</li>
                </ul>
            `
        },
        {
            date: `July 25, 2017`,
            version: `6.Beta.21.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was showing the trades section in the settings menu even if the script was disabled for SteamTrades (closes <a href="https://github.com/revilheart/ESGST/issues/288">#288</a>).</li>
                    <li>Renamed "Manage" to "Settings" in popups and removed the manage link from the settings popup (closes <a href="https://github.com/revilheart/ESGST/issues/289">#289</a>).</li>
                    <li>Fixed a bug in Giveaway Filters that was removing the heading of hidden giveaways inside of them.</li>
                    <li>Hidden giveaways are now automatically removed from the list when ended in Giveaway Filters.</li>
                    <li>Added an option (Giveaways.14.2.1) to Enter/Leave Giveaway Button to only pop up a reply box if the giveaway has a description.</li>
                    <li>Optimized Comment Tracker.</li>
                    <li>Added a simplified version of Comment Tracker (Comments.7.1) that simply shows the number of comments added since the last visit.</li>
                    <li>Fixed a bug in Comment Tracker that was going to the wrong comments when using the option to go to the first unread comment.</li>
                    <li>Fixed a bug in Comment Tracker that was not marking all comments as read from the inbox page.</li>
                    <li>Added loading icons to the heading buttons in Comment Tracker, to let you know when the process is finished.</li>
                    <li>If clicking on the button to go to the first unread comment when there isn't an unread comment in the page, a popup will appear saying that no unread comments were found.</li>
                    <li>The option to go to the first unread comment of a discussion from the main discussions page now opens the result in the same tab if Same Tab Opener is enabled.</li>
                    <li>Avatar Popout now shows if the user is suspended/banned.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>General.1 Image Borders</li>
                    <li>Discussions.1 Active Discussions</li>
                </ul>
            `
        },
        {
            date: `July 25, 2017`,
            version: `6.Beta.20.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Header Refresher that was not indicating unviewed keys in the tab.</li>
                    <li>Changed the unviewed keys indicator in Header Refresher from coloring the icon to showing a trophy emoji in the title.</li>
                    <li>Added an option (1.5.2) to indicate if there are unentered wishlist giveaways open to Header Refresher.</li>
                    <li>Added an option (2.5.1) to Giveaway Filters that allows you to hide giveaways in the main page (closes <a href="https://github.com/revilheart/ESGST/issues/224">#224</a>).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>4.1 Trades Bumper</li>
                </ul>
            `
        },
        {
            date: `July 25, 2017`,
            version: `6.Beta.19.19`,
            changelog: `
                <ul>
                    <li>Fixed a small bug in Enter/Leave Giveaway Button.</li>
                </ul>
            `
        },
        {
            date: `July 25, 2017`,
            version: `6.Beta.19.18`,
            changelog: `
                <ul>
                    <li>Enter/Leave Giveaway Button now immediately enters the giveaway and then checks for the description/opens the popup to reply if those options are enabled.</li>
                    <li>Added a "Leave" button to the popup in Enter/Leave Giveaway Button if a description has been found.</li>
                    <li>Fixed a bug in Whitelist/Blacklist Checker that was not checking users correctly if the option to show blacklist information was disabled and the user had not enabled the option to also check for whitelist previously.</li>
                </ul>
            `
        },
        {
            date: `July 24, 2017`,
            version: `6.Beta.19.17`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Train Giveaways Extractor that was happening for trains that have not started yet.</li>
                </ul>
            `
        },
        {
            date: `July 24, 2017`,
            version: `6.Beta.19.16`,
            changelog: `
                <ul>
                    <li>Fixed a style issue in Grid View for popups.</li>
                </ul>
            `
        },
        {
            date: `July 24, 2017`,
            version: `6.Beta.19.15`,
            changelog: `
                <ul>
                    <li>Minor style change.</li>
                </ul>
            `
        },
        {
            date: `July 24, 2017`,
            version: `6.Beta.19.14`,
            changelog: `
                <ul>
                    <li>Fixed a bug in User Filters that was not filtering discussions in the main page and was causing a bug (closes <a href="https://github.com/revilheart/ESGST/issues/284">#284</a> and <a href="https://github.com/revilheart/ESGST/issues/285">#285</a>).</li>
                </ul>
            `
        },
        {
            date: `July 24, 2017`,
            version: `6.Beta.19.13`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was moving the pagination navigation to the top in pages that had Endless Scrolling disabled.</li>
                    <li>Added options (2.4.1-2.4.3) to enable Grid View for Giveaway Bookmarks, Giveaway Encrypter/Decrypter and Train Giveaways Extractor.</li>
                    <li>Fixed a bug in Game Categories.</li>
                </ul>
            `
        },
        {
            date: `July 23, 2017`,
            version: `6.Beta.19.12`,
            changelog: `
                <ul>
                    <li>Fixed some bugs.</li>
                    <li>Changed the way popups behave when scrolling and which elements stay fixed.</li>
                    <li>Added an option to export the list of bundles when syncing and another option to sync them from a file. This allows you to share bundle lists with other users, which can prevent unecessary requests to SG (here's a fresh bundle list synced a few minutes ago: https://www.dropbox.com/s/3gsl9ya04cqwa09/ESGST-Bundles-Sun%2C%2023%20Jul%202017%2021-51-21%20GMT.json?dl=0).</li>
                    <li>The "Extract" button in Train Giveaways Extractor now changes to "Extract More" after the first extraction.</li>
                    <li>Hovering over the Bundled category in Game Categories now shows the date that the game was bundled (requires re-sync).</li>
                </ul>
                <p>Train Giveaways Extractor now has two different behaviors:</p>
                <ul>
                    <li>It loads the giveaways in batches of 50 if at least one of the following categories are enabled: Giveaway Info, Rating, Removed, Early Access, Trading Cards, Achivements, Multiplayer, Steam Cloud, Linux, Mac, DLC, Genres.</li>
                    <li>It loads all giveaways in a single batch if none of the categories mentioned above are enabled.</li>
                </ul>
            `
        },
        {
            date: `July 23, 2017`,
            version: `6.Beta.19.11`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was enabling Discussions Sorter in the new discussion page (closes <a href="https://github.com/revilheart/ESGST/issues/275">#275</a>).</li>
                </ul>
            `
        },
        {
            date: `July 23, 2017`,
            version: `6.Beta.19.10`,
            changelog: `
                <ul>
                    <li>Fixed some bugs.</li>
                    <li>Upgraded all popups to v6.</li>
                    <li>Fixed the "Manage" link in popups (closes <a href="https://github.com/revilheart/ESGST/issues/250">#250</a>).</li>
                    <li>Fixed a bug that was happening when importing data.</li>
                    <li>Fixed a style issue with giveaways loaded in popups (closes <a href="https://github.com/revilheart/ESGST/issues/270">#270</a> and <a href="https://github.com/revilheart/ESGST/issues/278">#278</a>).</li>
                    <li>Fixed a bug in Giveaways/Discussions/Tickets/Trades Tracker that was not fading discussions in the main page (closes <a href="https://github.com/revilheart/ESGST/issues/279">#279</a>).</li>
                    <li>Fixed a bug in Giveaway Filters that was not filtering giveaways with no categories.</li>
                    <li>Fixed a bug in Giveaway Groups Loader that was preventing groups from loading in the popup version (closes <a href="https://github.com/revilheart/ESGST/issues/283">#283</a>).</li>
                    <li>Train Giveaways Extractor now works from discussion pages and now also extracts links to SGTools giveaways.</li>
                    <li>Train Giveaways Extractor now extracts giveaways in batches of 50 to prevent the Steam API from blocking requests if using Game Categories. It's recommended to wait a couple minutes before extracting the next batch.</li>
                </ul>
            `
        },
        {
            date: `July 21, 2017`,
            version: `6.Beta.19.9`,
            changelog: `
                <ul>
                    <li>Fixed a style issue with list items inside popups.</li>
                    <li>Fixed a bug that was not importing settings (closes <a href="https://github.com/revilheart/ESGST/issues/256">#256</a>).</li>
                    <li>Fixed a bug that was enabling Active Discussions On Top/Sidebar even when disabled.</li>
                </ul>
            `
        },
        {
            date: `July 21, 2017`,
            version: `6.Beta.19.8`,
            changelog: `
                <ul>
                    <li>Fixed some bugs.</li>
                    <li>Fixed a bug in Multiple Giveaways Creator that was not importing games with an ampersand in their name (closes <a href="https://github.com/revilheart/ESGST/issues/274">#274</a>).</li>
                    <li>Fixed a bug in Giveaway Encrypter/Decrypter and Train Giveaways Extractor that was not filtering results.</li>
                    <li>Fixed a bug in Entries Remover that was not removing the entries (closes <a href="https://github.com/revilheart/ESGST/issues/255">#255</a>).</li>
                    <li>Adapted Active Discussions On Top/Sidebar to recent SG changes (closes <a href="https://github.com/revilheart/ESGST/issues/273">#273</a>).</li>
                </ul>
            `
        },
        {
            date: `July 18, 2017`,
            version: `6.Beta.19.7`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Encrypter/Decrypter.</li>
                </ul>
            `
        },
        {
            date: `July 18, 2017`,
            version: `6.Beta.19.6`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Encrypter/Decrypter.</li>
                </ul>
            `
        },
        {
            date: `July 18, 2017`,
            version: `6.Beta.19.5`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Encrypter/Decrypter that was not showing any giveaways if opening the popup from a user's profile page.</li>
                </ul>
            `
        },
        {
            date: `July 18, 2017`,
            version: `6.Beta.19.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Filters.</li>
                </ul>
            `
        },
        {
            date: `July 18, 2017`,
            version: `6.Beta.19.3`,
            changelog: `
                <ul>
                    <li>Fixed a class conflict with the pinned giveaways button.</li>
                    <li>Fixed a conflict between normal and popup filters in Giveaway Filters (closes <a href="https://github.com/revilheart/ESGST/issues/262">#262</a>).</li>
                    <li>Giveaway Encrypter/Decrypter now only loads created/hidden/owned/ignored giveaways if those options are enabled in the filter, instead of loading them first and then filtering. This means that if you change one of those options in the filter, it will only take effect when you refresh the page. Also, giveaways decrypted before this version must be fully loaded (keep clicking "Load more...") if you want them to be filtered correctly.</li>
                    <li>Added bump links to Train Giveaways Extractor (closes <a href="https://github.com/revilheart/ESGST/issues/261">#261</a>).</li>
                    <li>Train Giveaways Extractor is now able to extract any amount of trains inside of a train (trainception :P) (closes <a href="https://github.com/revilheart/ESGST/issues/263">#263</a>).</li>
                    <li>Added 7.4.4 "Giveaway Info" category to Game Categories (closes <a href="https://github.com/revilheart/ESGST/issues/254">#254</a>).</li>
                </ul>
            `
        },
        {
            date: `July 18, 2017`,
            version: `6.Beta.19.2`,
            changelog: `
                <ul>
                    <li>Fixed a game sync bug.</li>
                    <li>Fixed a bug in Train Giveaways Extractor that was not properly extracting giveaways from trains with previous links.</li>
                    <li>Fixed a bug in Removed Game Redirecter that was redirecting any Steam page.</li>
                </ul>
            `
        },
        {
            date: `July 18, 2017`,
            version: `6.Beta.19.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Filters that was not filtering giveaways. </li>
                </ul>
            `
        },
        {
            date: `July 18, 2017`,
            version: `6.Beta.19.0`,
            changelog: `
                <ul>
                    <li>Started a process of grouping feature calls together and minimizing interactions with DOM to optimize performance.</li>
                    <li>Fixed a bug that was happening in the automatic sync (closes <a href="https://github.com/revilheart/ESGST/issues/260">#260</a>).</li>
                    <li>Fixed a bug in the sync that was not properly syncing games.</li>
                    <li>Added "Hidden", "Owned", "Wishlisted", "Ignored" and "Removed" filters to Giveaway Filters.</li>
                    <li>Extended Giveaway Filters to popups (works with Giveaway Encrypter/Decrypter and Train Giveaways Extractor) (closes <a href="https://github.com/revilheart/ESGST/issues/252">#252</a>).</li>
                    <li>Improved Train Giveaways Extractor to work regardless of the name of the "Next" link.</li>
                    <li>Added 7.4.3 "Hidden" filter to Game Categories (must be synced through the settings menu).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>2.24 Hidden Games Enter Button Disabler</li>
                </ul>
            `
        },
        {
            date: `July 17, 2017`,
            version: `6.Beta.18.0`,
            changelog: `
                <p>Added the following features:</p>
                <ul>
                    <li>2.26 Train Giveaways Extractor</li>
                </ul>
            `
        },
        {
            date: `July 17, 2017`,
            version: `6.Beta.17.11`,
            changelog: `
                <ul>
                    <li>Added created time to Grid View.</li>
                </ul>
            `
        },
        {
            date: `July 16, 2017`,
            version: `6.Beta.17.10`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was enabling Removed Game Redirecter even if disabled.</li>
                </ul>
            `
        },
        {
            date: `July 15, 2017`,
            version: `6.Beta.17.9`,
            changelog: `
                <ul>
                    <li>Added an option (5.7.1.2) to only highlight users who failed to pass the check to Not Activated/Multiple Wins Checker.</li>
                </ul>
            `
        },
        {
            date: `July 15, 2017`,
            version: `6.Beta.17.8`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Entries Remover while syncing owned games (closes <a href="https://github.com/revilheart/ESGST/issues/249">#249</a>).</li>
                    <li>Added "Removed" and "Early Access" categories to Game Categories.</li>
                </ul>
            `
        },
        {
            date: `July 15, 2017`,
            version: `6.Beta.17.7`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was enabling automatic sync even if disabled.</li>
                </ul>
            `
        },
        {
            date: `July 15, 2017`,
            version: `6.Beta.17.6`,
            changelog: `
                <ul>
                    <li>Fixed a bug that prevented some features from running in giveaways with no descriptions and Next/Previous Train Hotkeys enabled.</li>
                </ul>
            `
        },
        {
            date: `July 15, 2017`,
            version: `6.Beta.17.5`,
            changelog: `
                <ul>
                    <li>Fixed several bugs.</li>
                    <li>Added back Greasemonkey support to the script (Header Refresher now works well on Greasemonkey as well).</li>
                    <li>Fixed a bug in Whitelist/Blacklist Checker that was showing incorrect results for group/whitelist giveaways.</li>
                </ul>
            `
        },
        {
            date: `July 15, 2017`,
            version: `6.Beta.17.4`,
            changelog: `
                <ul>
                    <li>You can now sync from ST.</li>
                    <li>You can now sync groups/whitelist/blacklist/games separately.</li>
                    <li>The automatic sync now opens in a new tab.</li>
                    <li>Multiple Giveaways Creator now automatically corrects the starting time of the giveaways if it has already passed and shows error messages in the their titles if the creation process has failed (closes <a href="https://github.com/revilheart/ESGST/issues/215">#215</a>).</li>
                </ul>
            `
        },
        {
            date: `July 14, 2017`,
            version: `6.Beta.17.3`,
            changelog: `
                <ul>
                    <li>Added an option to the new giveaway page in Multiple Giveaways Creator that allows you to choose whether or not to remove the previous/next links in the first/last wagons of the train (closes <a href="https://github.com/revilheart/ESGST/issues/240">#240</a>).</li>
                </ul>
            `
        },
        {
            date: `July 14, 2017`,
            version: `6.Beta.17.2`,
            changelog: `
                <ul>
                    <li>Fixed a style conflict between the script and SG's jQuery UIs.</li>
                </ul>
            `
        },
        {
            date: `July 14, 2017`,
            version: `6.Beta.17.1`,
            changelog: `
                <ul>
                    <li>Simplified the formatting for descriptions in Multiple Giveaways Creator (make sure you update your templates to the new format, as the old format is no longer supported - pay extra attention because ending tags now have a slash) (closes <a href="https://github.com/revilheart/ESGST/issues/237">#237</a>).</li>
                </ul>
            `
        },
        {
            date: `July 14, 2017`,
            version: `6.Beta.17.0`,
            changelog: `
                <ul>
                    <li>Fixed a formatting error in the second connection style example in Multiple Giveaways Creator.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>2.25 Next/Previous Train Hotkeys (closes <a href="https://github.com/revilheart/ESGST/issues/195">#195</a>)</li>
                </ul>
            `
        },
        {
            date: `July 14, 2017`,
            version: `6.Beta.16.9`,
            changelog: `
                <ul>
                    <li>Improved the progress bar in Multiple Giveaways Creator.</li>
                </ul>
            `
        },
        {
            date: `July 14, 2017`,
            version: `6.Beta.16.8`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Templates that was setting incorrect dates for templates that end in the other month.</li>
                    <li>While importing in Multiple Giveaways Creator, the imported giveaways will now be removed from the text area and a progress bar will be shown.</li>
                </ul>
            `
        },
        {
            date: `July 14, 2017`,
            version: `6.Beta.16.7`,
            changelog: `
                <p>Renamed the following features:</p>
                <ul>
                    <li>Giveaway Maker -> Multiple Giveaways Creator - Fixed a bug that was creating duplicate giveaways if clicking on "Create" again after finishing a creation process (closes <a href="https://github.com/revilheart/ESGST/issues/214">#214</a>). Added an option to add a counter to trains (closes <a href="https://github.com/revilheart/ESGST/issues/209">#209</a>). Added an option to import/export giveaways.</li>
                </ul>
            `
        },
        {
            date: `July 13, 2017`,
            version: `6.Beta.16.6`,
            changelog: `
                <ul>
                    <li>Added an option to Game Categories to show the percentage and number of reviews next to the icon in the rating category (closes <a href="https://github.com/revilheart/ESGST/issues/236">#236</a>).</li>
                </ul>
            `
        },
        {
            date: `July 13, 2017`,
            version: `6.Beta.16.5`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was exporting the old group storage instead of the v6 one.</li>
                    <li>Fixed a bug in Giveaway Filters for the new giveaways page.</li>
                </ul>
            `
        },
        {
            date: `July 13, 2017`,
            version: `6.Beta.16.4`,
            changelog: `
                <ul>
                    <li>Fixed a few bugs.</li>
                    <li>Enhanced Last Page Link to show the accurate last page number (closes <a href="https://github.com/revilheart/ESGST/issues/212">#212</a>).</li>
                    <li>Moved the "Source" link in Giveaways Encrypter/Decrypter (closes <a href="https://github.com/revilheart/ESGST/issues/210">#210</a>).</li>
                    <li>Fixed a bug in Giveaway Filters that was not saving the max value for entries and copies.</li>
                    <li>Fixed a bug in Giveaway Filters that was still showing the "Category Filters" heading even if Game Categories was disabled.</li>
                    <li>Added "Ratings" filter to Giveaway Filters (games that do not have a rating, either because the Steam page doesn't have it or because the script was unable to get it, have a predefined rating of 0) (closes <a href="https://github.com/revilheart/ESGST/issues/191">#191</a>).</li>
                    <li>Added more info about the giveaway to the popup in Enter/Leave Giveaway Button (closes <a href="https://github.com/revilheart/ESGST/issues/226">#226</a>).</li>
                    <li>Fixed a bug that was missing some features in Discussions Highlighter when opening them outside of the main discussions page (closes <a href="https://github.com/revilheart/ESGST/issues/208">#208</a>).</li>
                    <li>Fixed a bug that was showing the Whitelist/Blacklist Checker button in all pages (closes <a href="https://github.com/revilheart/ESGST/issues/227">#227</a>).</li>
                    <li>Added "Package" category to Game Categories (closes <a href="https://github.com/revilheart/ESGST/issues/180">#180</a>).</li>
                </ul>
            `
        },
        {
            date: `July 13, 2017`,
            version: `6.Beta.16.3`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Whitelist/Blacklist Checker that was happening when trying to return whitelists/blacklists.</li>
                </ul>
            `
        },
        {
            date: `July 13, 2017`,
            version: `6.Beta.16.2`,
            changelog: `
                <ul>
                    <li>Fixed some bugs and made more optimizations.</li>
                    <li>Fixed a bug that was not showing the changelog when updating (closes <a href="https://github.com/revilheart/ESGST/issues/233">#233</a>).</li>
                </ul>
            `
        },
        {
            date: `July 12, 2017`,
            version: `6.Beta.16.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not saving color settings.</li>
                    <li>Fixed a bug that was enabling the option to pop up giveaway descriptions even if it was disabled in Enter/Leave Giveaway Button.</li>
                    <li>Fixed a bug that was not marking things as visited in Giveaways/Discussions/Tickets/Trades Tracker if Comment Tracker was disabled (closes <a href="https://github.com/revilheart/ESGST/issues/230">#230</a>).</li>
                </ul>
            `
        },
        {
            date: `July 10, 2017`,
            version: `6.Beta.16.0`,
            changelog: `
                <ul>
                    <li>Moved Giveaway/Discussions/Tickets/Trades Tracker to General.</li>
                    <li>Added an option that allows users to disable the script completely for SteamTrades, which also cleans the settings menu from any ST options.</li>
                    <li>Fixed a bug that was not showing the "Recent Username History" and "Comment History" buttons in the header menu (closes <a href="https://github.com/revilheart/ESGST/issues/231">#231</a>).</li>
                </ul>
                <p>Added a new feature:</p>
                <ul>
                    <li>Removed Game Redirecter</li>
                </ul>
            `
        },
        {
            date: `July 10, 2017`,
            version: `6.Beta.15.3`,
            changelog: `
                <ul>
                    <li>Fixed a sync bug.</li>
                </ul>
            `
        },
        {
            date: `July 10, 2017`,
            version: `6.Beta.15.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug.</li>
                </ul>
            `
        },
        {
            date: `July 9, 2017`,
            version: `6.Beta.15.1`,
            changelog: `
                <ul>
                    <li>Fixed a popup style issue.</li>
                    <li>Improved discussions' loading time if Comment Formatting Helper is enabled.</li>
                </ul>
            `
        },
        {
            date: `July 9, 2017`,
            version: `6.Beta.15.0`,
            changelog: `
                <p>This update has a lot of changes, so I probably forgot to list some of them.</p>
                <ul>
                    <li>Removed the settings menu from the account page. It's now accessible from any page by clicking on the ESGST button.</li>
                    <li>You can now enable features specifically for SG or ST in the settings menu.</li>
                    <li>Revamped the settings menu and enumerated all settings, making it easier to reference them.</li>
                    <li>All feature descriptions will now be accessible from the settings menu, without the need to keep going back and forth between the settings menu and the GitHub page (this is a work in progress, some features are currently missing their description).</li>
                    <li>New features and functionalities will now be marked with a [NEW] tag, so it's easier to locate what's new in the current version from the settings menu.</li>
                    <li>Started a process of cloning SG's classes so the script no longer needs to rely on them, which will prevent any possible conflict from SG's script (solves an issue that wasn't opening the header menu on Firefox, and another issue that was replacing the ESGST button with the profile button on ST).</li>
                    <li>Optimized memory consumption and speed for sync, Game Categories and Created/Entered/Won Giveaway Details (possibly closes <a href="https://github.com/revilheart/ESGST/issues/220">#220</a> and <a href="https://github.com/revilheart/ESGST/issues/222">#222</a>).</li>
                    <li>Brought back avatars to Grid View.</li>
                    <li>Giveaway Groups Loader now shows group avatars again.</li>
                    <li>Improved how the groups are synced in Stickied Giveaway Groups and upgraded the group storage (unfortunately, unlike previous storage upgrades, this upgrade cannot retain your stickied groups, so you will have to sticky your groups again). You must sync through the settings menu (section 9) immediately, otherwise none of the group features will work correctly in this version.</li>
                    <li>Fixed some bugs in Unsent Gifts Sender.</li>
                    <li>Comment Formatting Helper now checks to make sure the user entered the right format for encrypted giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/225">#225</a>).</li>
                    <li>Changed the comment count to red in Comment Tracker.</li>
                    <li>Fixed a bug in User Giveaways Data that was showing "undefined" for sent data (closes <a href="https://github.com/revilheart/ESGST/issues/177">#177</a>).</li>
                    <li>Game Categories now has links for each category (closes <a href="https://github.com/revilheart/ESGST/issues/213">#213</a>) and appears in front of the game title if the simplified mode is enabled.</li>
                    <li>Improved a lot of other things, especially user features.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Giveaways/Discussions/Tickets/Trades Tracker (separated from Comment Tracker)</li>
                    <li>Same Tab Opener</li>
                    <li>Main Post Skipper (closes <a href="https://github.com/revilheart/ESGST/issues/22">#22</a>)</li>
                </ul>
            `
        },
        {
            date: `June 30, 2017`,
            version: `6.Beta.14.11-Cake.Day.Edition`,
            changelog: `
                <p>Check the discussions for more info.</p>
            `
        },
        {
            date: `June 29, 2017`,
            version: `6.Beta.14.10`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Filters that was filtering search results.</li>
                </ul>
            `
        },
        {
            date: `June 29, 2017`,
            version: `6.Beta.14.9`,
            changelog: `
                <ul>
                    <li>Testing a new design for Grid View, feel free to provide feedback.</li>
                    <li>Reduced the max points limit to 100 in Giveaway Filters.</li>
                    <li>Fixed a bug in Giveaway Filters that was causing a conflict between points/chance filters.</li>
                </ul>
            `
        },
        {
            date: `June 28, 2017`,
            version: `6.Beta.14.8`,
            changelog: `
                <ul>
                    <li>Fixed a style issue that wasn't enabling the pointer cursor for checkboxes.</li>
                    <li>Endless Scrolling now remembers if you had paused it and will keep it paused when refreshing or loading a new page.</li>
                    <li>Avanced Giveaway Search now remembers your settings.</li>
                    <li>You can now also click in the search icon in addition to hitting Enter to trigger Advanced Giveaway Search.</li>
                    <li>Added a slider to Grid View that allows you to choose the amount of space between the giveaways.</li>
                    <li>Fixed a bug in Giveaway Filters that was happening when there were 0 giveaways in the page.</li>
                    <li>Giveaway Filters now has sliders. The Entries/Copies filters are infinite, to increase/decrease their max value simply enter the new max value in the input field and it will be increased/decreased.</li>
                </ul>
            `
        },
        {
            date: `June 28, 2017`,
            version: `6.Beta.14.7`,
            changelog: `
                <ul>
                    <li>Fixed various style issues that were brought with cg's latest changes.</li>
                    <li>Fixed a style issue in Fixed Header for SteamTrades.</li>
                    <li>Changed the version alert in ESGST's discussion page to a popup.</li>
                    <li>Added the option not to show the changelog from the current version when updating.</li>
                    <li>Fixed a bug in Giveaway Encrypter/Decrypter that was showing duplicated giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/184">#184</a>).</li>
                    <li>Giveaway Encrypter/Decrypter now appears in any page (closes <a href="https://github.com/revilheart/ESGST/issues/188">#188</a>) and the giveaways are now sorted by end date. If the page you're on has a giveaway that hasn't been decrypted yet, the icon will turn green.</li>
                    <li>Entered giveaways are now shown correctly in Giveaway Encrypter/Decrypter.</li>
                    <li>Added a link to the giveaways in Giveaway Encrypter/Decrypter that links to the source of the giveaway (the comment where the giveaway came from) - only works for giveaways decrypted since this version or if you revisit the page that the decrypted giveaway is from.</li>
                    <li>Added "Points" filter to Advanced Giveaway Search and also a delay for showing the panel if you have Active Discussions on the sidebar (closes <a href="https://github.com/revilheart/ESGST/issues/207">#207</a>).</li>
                </ul>
            `
        },
        {
            date: `June 28, 2017`,
            version: `6.Beta.14.6`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Templates that was adding 24 hours to the end time when using both precise start and end times (closes <a href="https://github.com/revilheart/ESGST/issues/205">#205</a>).</li>
                </ul>
            `
        },
        {
            date: `June 27, 2017`,
            version: `6.Beta.14.5`,
            changelog: `
                <ul>
                    <li>Reverted the previous sidebar/page heading change.</li>
                    <li>Steam Activation Link now works after clicking the "View Key" button.</li>
                </ul>
            `
        },
        {
            date: `June 27, 2017`,
            version: `6.Beta.14.4`,
            changelog: `
                <ul>
                    <li>Changed the sidebar and main page heading positions from fixed to absolute so that they scroll vertically with the page in Fixed Sidebar/Main Page Heading.</li>
                    <li>Fixed a bug that was causing giveaway features not to appear for invite only giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/204">#204</a>).</li>
                </ul>
            `
        },
        {
            date: `June 27, 2017`,
            version: `6.Beta.14.3`,
            changelog: `
                <ul>
                    <li>Fixed a style issue in Fixed Main Page Heading (closes <a href="https://github.com/revilheart/ESGST/issues/203">#203</a>).</li>
                    <li>Fixed a bug in Giveaway Winning Chance/Ratio that was adding 1 entry to created/ended giveaways.</li>
                </ul>
            `
        },
        {
            date: `June 27, 2017`,
            version: `6.Beta.14.2`,
            changelog: `
                <ul>
                    <li>Fixed some bugs.</li>
                    <li>Giveaway Winning Chance and Giveaway Winning Ratio now add 1 entry to the chance/ratio calculation if you haven't entered the giveaway yet, to demonstrate what your exact chance will be when entered (closes <a href="https://github.com/revilheart/ESGST/issues/202">#202</a>).</li>
                    <li>Increased the delay from 0.5 to 1 second in Avatar Popout, added a delay for closing the popout, and prevented the popout from opening if a click was made.</li>
                </ul>
            `
        },
        {
            date: `June 27, 2017`,
            version: `6.Beta.14.1`,
            changelog: `
                <ul>
                    <li>Fixed some bugs.</li>
                    <li>Changed "Everyone" to "Public" in all features that use this notation.</li>
                    <li>Fixed a style issue in Fixed Sidebar/Fixed Main Page Heading for changing-width sidebars/descriptions (closes <a href="https://github.com/revilheart/ESGST/issues/117">#117</a>).</li>
                    <li>Avatar Popout now works also when hovering hover an user's username.</li>
                </ul>
                <p>Renamed the following features:</p>
                <ul>
                    <li>Giveaway Train Maker -> Giveaway Maker - Made the interface less confusing and added a tooltip describing how to use the feature in more details (closes <a href="https://github.com/revilheart/ESGST/issues/200">#200</a>).</li>
                </ul>
            `
        },
        {
            date: `June 26, 2017`,
            version: `6.Beta.14.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Avatar Popout that was happening when quickly hovering hover an avatar.</li>
                </ul>
                <p>Renamed the following features:</p>
                <ul>
                    <li>Active Discussions On Top -> Active Discussions On Top/Sidebar - You can now choose where the active discussions appear. More info about the sidebar choice: if you have Advanced Giveaway Search enabled, it will be hidden and triggered when hovering hover the search field; the username and avatar of the user who last posted will be removed (the button to go to the last comment will remain intact); Accurate Timestamps will not run for any timestamps inside the active discussions; and any user tags you might have saved for users will be hidden inside the active discussions (they will still be visible if you click the tag button to edit them).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Unfaded Entered Giveaways</li>
                </ul>
            `
        },
        {
            date: `June 26, 2017`,
            version: `6.Beta.13.0`,
            changelog: `
                <ul>
                    <li>The script no longer prompts alerts when features fail to load.</li>
                    <li>Header Refresher now changes the SG icon to red when there are unviewed keys for wins based on cg's implementation.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Created/Entered/Won Giveaway Details (closes <a href="https://github.com/revilheart/ESGST/issues/193">#193</a>)</li>
                    <li>Is There Any Deal? Info (closes <a href="https://github.com/revilheart/ESGST/issues/194">#194</a>)</li>
                </ul>
                <p>Removed the following features:</p>
                <ul>
                    <li>Delivered Gifts Notifier - This feature has been implemented by cg.</li>
                </ul>
            `
        },
        {
            date: `June 25, 2017`,
            version: `6.Beta.12.4`,
            changelog: `
                <ul>
                    <li>Avatar Popout now works on hover, with a delay of 0.5 seconds. This should prevent accidental hovers and unnecessary requests, which were my main concerns about this functionality.</li>
                </ul>
            `
        },
        {
            date: `June 25, 2017`,
            version: `6.Beta.12.3`,
            changelog: `
                <ul>
                    <li>The script no longer prompts alerts when errors happen, and should now only run if the page has properly loaded (no error pages) and you're logged in.</li>
                    <li>Fixed more bugs with giveaway features being enabled where they shouldn't.</li>
                    <li>Added a filtered count to each page in Giveaway Filters (closes <a href="https://github.com/revilheart/ESGST/issues/80">#80</a>).</li>
                </ul>
            `
        },
        {
            date: `June 23, 2017`,
            version: `6.Beta.12.2`,
            changelog: `
                <ul>
                    <li>The script no longer runs when you aren't logged in.</li>
                    <li>Game Categories should now retrieve correct categories if you're a non-English user (closes <a href="https://github.com/revilheart/ESGST/issues/189">#189</a>).</li>
                    <li>Header Refresher is back to altering the icon of the tab (must be enabled through the settings menu). You can also choose to show the number of delivered wins in the icon if Delivered Gifts Notifier is enabled (it will be shown as yellow to the left of the unread message count, which remains red).</li>
                    <li>Fixed a bug in Not Activated/Multiple Wins Checker that was linking the wrong page for multiple wins.</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.12.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not enabling Grid View if none of the other giveaway features were enabled.</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.12.0`,
            changelog: `
                <ul>
                    <li>Fixed more bugs with giveaway features being enabled where they shouldn't.</li>
                    <li>Fixed a bug in Endless Scrolling that was not properly reversing discussions with 100+ pages.</li>
                    <li>Fixed a bug in Endless Scrolling that was always reversing discussions, making it impossible to go to page 1 without scrolling down from page 2. Now the reverse scrolling will only kick in if you came to page 1 from the discussions page ("/discussions"). If you came to page 1 from anywhere else, it will not reverse the discussion.</li>
                    <li>Extended Giveaway Filters to work in group pages.</li>
                    <li>Fixed a bug in Comment Tracker that was not properly going to the first unread comment of discussions with 100+ pages (closes <a href="https://github.com/revilheart/ESGST/issues/134">#134</a>).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Last Page Link (closes <a href="https://github.com/revilheart/ESGST/issues/138">#138</a>)</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.11.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was applying Grid View to the list of bookmarked giveaways.</li>
                    <li>Fixed a bug in Enter/Leave Giveaway Button that was not showing the error message on hover when failing to enter a giveaway.</li>
                </ul>
                <p>Upgraded the following features to v6:</p>
                <ul>
                    <li>Grid View - The icons are now displayed inside the image instead of outside, leaving room for more giveaways per row (on 1440x900 resolutions there should now be 5 giveaways per row instead of 4). Changed the position of the avatar to reduce white space. Moved the giveaway panel (Giveaway Winning Chance, Giveaway Winning Ratio and Enter/Leave Giveaway Button) to the left side. Added a minimum width of 400px.</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.11.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not enabling automatic sync.</li>
                    <li>Added an option to display .gifv images to Visible Attached Images.</li>
                    <li>Fixed a bug that was not enabling Giveaway Bookmarks in the bookmarked giveaways list and was not unbookmarking a giveaway when entering it.</li>
                    <li>Changed how Giveaway Winning Chance and Giveaway Winning Ratio are shown in the entered page.</li>
                    <li>Fixed a bug in Enter/Leave Giveaway Button that was not resetting the "Entering..." button when closing the popup without entering.</li>
                    <li>When entering a giveaway that has no description with "Popup reply box when entering / include it in the description popup." enabled, Enter/Leave Giveaway Button will now immediately enter the giveaway and then pop up the reply box if you want to add a comment.</li>
                    <li>Fixed a bug that was not enabling Comment Tracker for page 2+ while using Endless Scrolling.</li>
                    <li>Fixed a bug in Groups Stats while using Endless Scrolling.</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.11.0`,
            changelog: `
                <ul>
                    <li>Fixed a typo in Giveaway Templates.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Giveaway Train Maker</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.10.3`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Bookmarks that was not bookmarking giveaways from the entered page.</li>
                </ul>
                <p>Upgraded the following features to v6:</p>
                <ul>
                    <li>Giveaway Templates - Changed how the data is stored (just like with previous storage upgrades, your data should be transferred without any losses, but let me know about any missing data). Revamped the feature (closes <a href="https://github.com/revilheart/ESGST/issues/52">#52</a>). Added options to use precise start/end time. The "Review Giveaway" button now appears both at the top and at the bottom of the page. Added a new "Create Giveaway" button that creates the giveaway directly without passing through the review step.</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.10.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Bookmarks caused by the last update.</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.10.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not saving the hours for Giveaway Bookmarks correctly from the settings menu.</li>
                    <li>Giveaway Bookmarks now works with giveaways that have not started yet. Here's more info about it: giveaways that have not started yet will not appear in the list of bookmarked giveaways; instead, they will stay in a sort of hidden state until they start; when they start, the header bookmark button will turn green, indicating that you must open the list of bookmarked giveaways so that the started giveaways can be updated with their end times; when giveaways are about to end, the button will continue to turn red as before, but if there are both started and ending giveaways, the button will be colored with a brown-ish color; hovering over the button also gives you more details about how many giveaways have started and/or are ending.</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.10.0`,
            changelog: `
                <ul>
                    <li>Fixed more bugs for giveaway features being enabled in places where they shouldn't (closes <a href="https://github.com/revilheart/ESGST/issues/186">#186</a>).</li>
                    <li>Added a sorting feature to Giveaway Winning Chance (closes <a href="https://github.com/revilheart/ESGST/issues/44">#44</a>).</li>
                    <li>Disabled Giveaway Bookmarks for giveaways that have not started yet because the feature is not configured to work well with them and will always alert that they are ending (I'll figure out a way to make it work later).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Discussions Sorter</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.9.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Comment Tracker that was not correctly going to the first unread comment of a page (closes <a href="https://github.com/revilheart/ESGST/issues/185">#185</a>).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Whitelist/Blacklist Sorter - Must sync through the settings menu for it to work properly (closes <a href="https://github.com/revilheart/ESGST/issues/46">#46</a>).</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.8.3`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was happening in the new giveaway page (closes <a href="https://github.com/revilheart/ESGST/issues/183">#183</a>).</li>
                    <li>Every time you visit the ESGST discussion, the script will now check if you are on the latest version by checking for a hidden element in the OP (no requests required) and will give you an alert if you aren't (closes <a href="https://github.com/revilheart/ESGST/issues/147">#147</a>).</li>
                    <li>Fixed a bug in Giveaway Filters that was filtering giveaways from Giveaway Bookmarks (closes <a href="https://github.com/revilheart/ESGST/issues/169">#169</a>).</li>
                    <li>Fixed a bug in Comment History that was happening when loading the history (closes <a href="https://github.com/revilheart/ESGST/issues/182">#182</a>).</li>
                </ul>
            `
        },
        {
            date: `June 20, 2017`,
            version: `6.Beta.8.2`,
            changelog: `
                <ul>
                    <li>Fixed some issues with where some giveaway features were being enabled.</li>
                    <li>Fixed a bug in Giveaway Filters that was not filtering giveaways by chance.</li>
                    <li>Added a loading icon while marking comments as read/unread in Comment Tracker.</li>
                    <li>All game features are now supported for discussion tables (works well with RaCharts).</li>
                </ul>
            `
        },
        {
            date: `June 19, 2017`,
            version: `6.Beta.8.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Filters that was not filtering giveaways on page load unless Game Categories was enabled.</li>
                    <li>Fixed a bug in Game Categories that was trying to filter giveaways on user pages.</li>
                </ul>
            `
        },
        {
            date: `June 18, 2017`,
            version: `6.Beta.8.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not properly handling username changes (closes <a href="https://github.com/revilheart/ESGST/issues/176">#176</a>).</li>
                    <li>Fixed a bug in Giveaway Filters that was not applying category filters (closes <a href="https://github.com/revilheart/ESGST/issues/173">#173</a>).</li>
                    <li>Game Categories should now load a lot faster, unless "Rating" or "User-Defined Tags" are enabled.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Steam Activation Link (closes <a href="https://github.com/revilheart/ESGST/issues/177">#177</a>)</li>
                </ul>
            `
        },
        {
            date: `June 15, 2017`,
            version: `6.Beta.7.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Unsent Gifts Sender that was happening while sending gifts with the option to only send gifts to users with 0 not activated/multiple wins enabled.</li>
                </ul>
            `
        },
        {
            date: `June 15, 2017`,
            version: `6.Beta.7.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that wasn't applying the popup class for some popups.</li>
                    <li>Fixed a bug in Enter/Leave Giveaway Button.</li>
                    <li>Made some optimizations to Enter/Leave Giveaway Button that should reduce memory usage when entering multiple giveaways in a row.</li>
                </ul>
            `
        },
        {
            date: `June 14, 2017`,
            version: `6.Beta.7.0`,
            changelog: `
                <ul>
                    <li>Moved Shared Groups Checker to the same place as Username History and User Notes.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>User Filters (closes <a href="https://github.com/revilheart/ESGST/issues/51">#51</a>)</li>
                </ul>
            `
        },
        {
            date: `June 14, 2017`,
            version: `6.Beta.6.3`,
            changelog: `
                <ul>
                    <li>Removed periods from all tooltips (closes <a href="https://github.com/revilheart/ESGST/issues/166">#166</a>).</li>
                    <li>Added tooltip to User Notes button (closes <a href="https://github.com/revilheart/ESGST/issues/167">#167</a>).</li>
                    <li>Fixed a bug that was enabling some giveaway features where they shouldn't (closes <a href="https://github.com/revilheart/ESGST/issues/168">#168</a>).</li>
                    <li>Entered giveaways are now automatically unbookmarked in Giveaway Bookmarks.</li>
                    <li>The option to change the background instead of fading out has been removed from Comment Tracker and implemented by default on hover (#closes 143).</li>
                </ul>
            `
        },
        {
            date: `June 14, 2017`,
            version: `6.Beta.6.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was preventing the script from running.</li>
                </ul>
            `
        },
        {
            date: `June 14, 2017`,
            version: `6.Beta.6.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was preventing the script from running.</li>
                </ul>
            `
        },
        {
            date: `June 14, 2017`,
            version: `6.Beta.6.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was happening in the entered page if Giveaway Winning Chance, Giveaway Winning Ratio and Enter/Leave Giveaway Button were disabled.</li>
                    <li>Changed the position of Giveaway Filters to above the pinned giveaways, so that it is fixed when filtering the giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/165">#165</a>).</li>
                    <li>Added back the background highlight to groups that you are a member of to the popup option in Giveaway Groups Loader.</li>
                    <li>Fixed a bug that was not running Comment Tracker in Active Discussions (closes <a href="https://github.com/revilheart/ESGST/issues/162">#162</a>).</li>
                    <li>Fixed a bug in Comment Tracker that was not showing the read/unread button under the OP.</li>
                    <li>Fixed a bug in Comment Tracker that was not unfading a comment when making it as unread.</li>
                    <li>OPs are no longer counted as comments in Comment Tracker (closes <a href="https://github.com/revilheart/ESGST/issues/159">#159</a>).</li>
                    <li>You can now mark discussions as unvisited in Comment Tracker.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Giveaway Bookmarks</li>
                </ul>
            `
        },
        {
            date: `June 14, 2017`,
            version: `6.Beta.5.5`,
            changelog: `
                <ul>
                    <li>Removed the minimum popout size from Grid View.</li>
                </ul>
            `
        },
        {
            date: `June 14, 2017`,
            version: `6.Beta.5.4`,
            changelog: `
                <ul>
                    <li>Another possible fix to the Comment Tracker bug.</li>
                </ul>
            `
        },
        {
            date: `June 14, 2017`,
            version: `6.Beta.5.3`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Grid View that wasn't working well with Giveaway Filters.</li>
                    <li>Set a fixed width to the Grid View popout to 600px to prevent things from inflating the page.</li>
                    <li>Possibly fixed a bug in Comment Tracker that was showing the wrong comment count for discussions (possibly closes <a href="https://github.com/revilheart/ESGST/issues/134">#134</a> and <a href="https://github.com/revilheart/ESGST/issues/160">#160</a>).</li>
                </ul>
            `
        },
        {
            date: `June 13, 2017`,
            version: `6.Beta.5.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Groups Loader that wasn't showing some groups (closes <a href="https://github.com/revilheart/ESGST/issues/158">#158</a>).</li>
                    <li>Added an option to only show groups that you are a member of to Giveaway Groups Loader.</li>
                    <li>Added back the option to use a popup to load giveaway groups to Giveaway Groups Loader.</li>
                    <li>Fixed a bug in Enter/Leave Giveaway Button that was still popping up the description even if it was disabled when leaving a giveaway and entering it again.</li>
                    <li>Fixed a bug that was not enabling Discussions Highlighter in the main discussions page if Comment Tracker was disabled.</li>
                    <li>Added back the option that was missing from Comment Tracker to mark discussions as visited.</li>
                    <li>Fixed a bug in Not Activated/Multiple Wins Checker that was getting stuck at the first user while checking.</li>
                </ul>
            `
        },
        {
            date: `June 13, 2017`,
            version: `6.Beta.5.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was preventing the script from running.</li>
                    <li>Decrypted Giveaways are no longer cached (they are now retrieved in real time for accurate number of entries/comments, etc) (closes <a href="https://github.com/revilheart/ESGST/issues/141">#141</a>).</li>
                    <li>Removed an extra underline that popup links had (closes <a href="https://github.com/revilheart/ESGST/issues/127">#127</a>).</li>
                </ul>
            `
        },
        {
            date: `June 13, 2017`,
            version: `6.Beta.5.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was happening when visiting deleted giveaways.</li>
                    <li>Major user storage upgrade to v6. As with the previous upgrades, your data should be transferred without any losses, but let me know about any missing data (if you do find missing data, do not panic - none of the v5 storage is deleted, so it can be easily recovered). As a result, managing tags from the settings menu has been temporarily disabled until it has been rewritten for v6.</li>
                    <li>Added options to manage user data individually to the settings menu (closes <a href="https://github.com/revilheart/ESGST/issues/139">#139</a>).</li>
                    <li>Fixed an issue that was breaking discussion titles (closes <a href="https://github.com/revilheart/ESGST/issues/153">#153</a>).</li>
                    <li>Disabled the giveaway panel, which makes the icons of the giveaway appear in the entries/comments row, if you don't have Giveaway Winning Chance, Giveaway Winning Ratio and Enter/Leave Giveaway Button, as these make the row too large with the icons in the default row.</li>
                    <li>Corrected created time for the list of highlighted discussions (closes <a href="https://github.com/revilheart/ESGST/issues/155">#155</a>).</li>
                    <li>You can now use the Enter key to save tags.</li>
                    <li>If you hover hover whitelist/blacklist highlights, you will now see when you whitelisted/blacklisted that user (must be synced through the settings menu).</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Giveaway Grops Loader - Replaces Giveaway Groups Popup (can be added back if there is demand for it).</li>
                    <li>One-Click Giveaway Hider (closes <a href="https://github.com/revilheart/ESGST/issues/156">#156</a>)</li>
                </ul>
            `
        },
        {
            date: `June 12, 2017`,
            version: `6.Beta.4.8`,
            changelog: `
                <ul>
                    <li>Fixed an exploit that could be used to check all pages under "/discussions", "/users" and "/archive" in Whitelist/Blacklist Checker.</li>
                </ul>
            `
        },
        {
            date: `June 12, 2017`,
            version: `6.Beta.4.7`,
            changelog: `
                <ul>
                    <li>Fixed some bugs.</li>
                    <li>Added back the option to disable description popups to Enter/Leave Giveaway Button, but made the popups enabled by default.</li>
                    <li>Fixed a bug in Comment Tracker that wasn't resetting the loading icon when using reverse order to find an unread comment.</li>
                    <li>Fixed a typo in Comment Tracker (closes <a href="https://github.com/revilheart/ESGST/issues/154">#154</a>).</li>
                    <li>Enhanced the option to mark all comments as unread in a discussion in Comment Tracker to prevent it from making any requests (closes <a href="https://github.com/revilheart/ESGST/issues/152">#152</a>).</li>
                </ul>
                <p>Upgraded the following features to v6:</p>
                <ul>
                    <li>Avatar Popout - Completely revamped the feature using the styling from SquishedPotatoe's dark theme (it might also be incompatible with the theme for the moment because of class name changing) (closes <a href="https://github.com/revilheart/ESGST/issues/67">#67</a>).</li>
                </ul>
            `
        },
        {
            date: `June 12, 2017`,
            version: `6.Beta.4.6`,
            changelog: `
                <ul>
                    <li>Added additional information to error alerts, so that the users properly report errors when they happen.</li>
                    <li>Reverted Comment History's default behavior to fading out.</li>
                </ul>
            `
        },
        {
            date: `June 11, 2017`,
            version: `6.Beta.4.5`,
            changelog: `
                <ul>
                    <li>Fixed more Comment Tracker bugs.</li>
                    <li>Darkened the highlight in Comment Tracker.</li>
                </ul>
            `
        },
        {
            date: `June 11, 2017`,
            version: `6.Beta.4.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was not updating the sync date after syncing the bundle list (closes <a href="https://github.com/revilheart/ESGST/issues/99">#99</a>).</li>
                    <li>Prevented some buttons from appearing in places where they shouldn't (closes <a href="https://github.com/revilheart/ESGST/issues/103">#103</a>).</li>
                    <li>Added "Created" filter to Giveaway Filters (closes <a href="https://github.com/revilheart/ESGST/issues/137">#137</a>).</li>
                    <li>Fixed some bugs in Comment Tracker.</li>
                    <li>Fixed a bug in Whitelist/Blacklist Checker that was retrieving the wrong pages if the URL had a hash (closes <a href="https://github.com/revilheart/ESGST/issues/57">#57</a>).</li>
                    <li>Re-enabled the full list check option for the main giveaway pages in Whitelist/Blacklist Checker.</li>
                </ul>
            `
        },
        {
            date: `June 11, 2017`,
            version: `6.Beta.4.3`,
            changelog: `
                <ul>
                    <li>Fixed a couple bugs in Header Refresher on SteamTrades.</li>
                </ul>
            `
        },
        {
            date: `June 11, 2017`,
            version: `6.Beta.4.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Grid View.</li>
                    <li>Added "Last Checked" information to the tooltip of Whitelist/Blacklist Checker and Not Activated/Multiple Wins Checker highlights (closes <a href="https://github.com/revilheart/ESGST/issues/142">#142</a>).</li>
                </ul>
                <p>Upgraded the following features to v6:</p>
                <ul>
                    <li>Comment Tracker - Fixed some bugs (possible solution to <a href="https://github.com/revilheart/ESGST/issues/134">#134</a>). Changed how the data is stored (your data should be transferred without any losses, but let me know about any missing data). You can now mark comments as unread (closes <a href="https://github.com/revilheart/ESGST/issues/128">#128</a>). Read comments and visited giveaways/discussions are no longer faded out - their background now changes to grey (possible solution to <a href="https://github.com/revilheart/ESGST/issues/143">#143</a>). The feature now works in the inbox page.</li>
                    <li>Discussion Highlighter - You can now view your highlighted discussions through the Discussions header button (closes <a href="https://github.com/revilheart/ESGST/issues/133">#133</a>).</li>
                </ul>
            `
        },
        {
            date: `June 11, 2017`,
            version: `6.Beta.4.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was erasing game data when syncing owned games.</li>
                </ul>
            `
        },
        {
            date: `June 11, 2017`,
            version: `6.Beta.4.0`,
            changelog: `
                <ul>
                    <li>Revamped Header Refresher to work better with Enter/Leave Giveaway Button and discontinued its support for Greasemonkey (if you are using Greasemonkey and you open multiple tabs, only one tab will refresh the header).</li>
                    <li>Level Progress Visualizer now takes up the entire main button. As a result, the hover effect has been disabled.</li>
                    <li>Giveaway Filters now has a separate setting for each of the giveaway pages (all, recommended, wishlist, group, new).</li>
                    <li>Added some titles and tooltips to Giveaway Filters.</li>
                    <li>Giveaway Filters now works if an advanced search was made, but the basic filters and the region restricted/dlc filters are disabled, as they are part of the advanced search.</li>
                </ul>
                <p>Upgraded the following features to v6:</p>
                <ul>
                    <li>Giveaway Winning Chance - Separated it into Giveaway Winning Chance and Giveaway Winning Ratio.</li>
                    <li>Enter/Leave Giveaway Button - Fixed some bugs (closes <a href="https://github.com/revilheart/ESGST/issues/136">#136</a> and <a href="https://github.com/revilheart/ESGST/issues/146">#146</a>). The feature now automatically detects if you own the game (you must of course sync through the settings menu) or if the giveaway is for a higher level than you and does not show the Enter button in case one of these is true (closes <a href="https://github.com/revilheart/ESGST/issues/132">#132</a>). Entered giveaways are now immediately hidden if the filter is enabled (closes <a href="https://github.com/revilheart/ESGST/issues/129">#129</a>). If an error occurs while entering a giveaway or if you don't have enough points, the button will simply turn red instead of adding an additional button to its side (partial solution to <a href="https://github.com/revilheart/ESGST/issues/89">#89</a>). Brought back the option to add a comment to the giveaway upon entering.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Quick Giveaway Browsing</li>
                </ul>
            `
        },
        {
            date: `June 10, 2017`,
            version: `6.Beta.3.18`,
            changelog: `
                <ul>
                    <li>You can manage Comment History/Game data again through the settings menu.</li>
                    <li>You can now manage Game data individually between Game Tags, Entered Games Highlighter and Game Categories data.</li>
                    <li>Fixed some bugs and improved some things.</li>
                </ul>
            `
        },
        {
            date: `June 9, 2017`,
            version: `6.Beta.3.17`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Level Progress Visualizer.</li>
                    <li>Fixed a bug in Enter/Leave Giveaway Button that was not resetting the button when closing the giveaway description popup.</li>
                </ul>
            `
        },
        {
            date: `June 9, 2017`,
            version: `6.Beta.3.16`,
            changelog: `
                <ul>
                    <li>Changed how the comment history data is stored (your old data should be transferred without any problems, but let me know about any missing data). As a result, the option to import/export comment history data has been temporarily disabled until it is rewritten for the new system.</li>
                    <li>Comment History has been completely revamped and there are now two different data storages (one for SG and one for ST). The new data storages should also take much less memory space.</li>
                    <li>Fixed a bug in Game Categories that wasn't applying the negative class for "Rating" category.</li>
                    <li>Added an option to Enter/Leave Giveaway Button to pop up the giveaway description in the same window instead of opening it in another tab.</li>
                    <li>Fixed a bug in Enter/Leave Giveaway Button that was opening the giveaway description when leaving a giveaway.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Level Progress Visualizer (closes <a href="https://github.com/revilheart/ESGST/issues/144">#144</a>)</li>
                </ul>
            `
        },
        {
            date: `June 9, 2017`,
            version: `6.Beta.3.15`,
            changelog: `
                <ul>
                    <li>Fixed a bug from v6.Beta.3.14.</li>
                </ul>
            `
        },
        {
            date: `June 9, 2017`,
            version: `6.Beta.3.14`,
            changelog: `
                <ul>
                    <li>Fixed some bugs and made some improvements.</li>
                    <li>Changed how the game data is stored (your old data should be transferred without any problems, but let me know about any missing data).</li>
                    <li>Fixed a conflict between games' app/sub ids. As a result, Multi-Tag and the option to import/export game data have been temporarily disabled until they are rewritten for the new system.</li>
                    <li>Reinforced how the gama data is saved to further prevent data from being overwritten. As a result, you might notice that game features now take a bit longer to save.</li>
                    <li>Added "Rating" and "User-Defined Tags" categories to Game Categories (closes <a href="https://github.com/revilheart/ESGST/issues/130">#130</a>).</li>
                    <li>Changed the default colors for Game Categories and added a button to the settings menu that allows you to reset the colors to their default values.</li>
                    <li>Changed the "Wishlisted" and "Ignored" icons in Game Categories.</li>
                    <li>Game Categories now works on any page (closes <a href="https://github.com/revilheart/ESGST/issues/108">#108</a>).</li>
                    <li>Game Categories now retrieves data from the US store (closes <a href="https://github.com/revilheart/ESGST/issues/123">#123</a>).</li>
                </ul>
                <p>Renamed the following features:</p>
                <ul>
                    <li>Games Highlighter -> Entered Games Highlighter - Fixed some bugs and made some improvements. The star icon should now be immediately added upon entering a giveaway.</li>
                </ul>
                <p>Removed the following features:</p>
                <ul>
                    <li>Giveaway Description/Comment Box Popup - Upon clicking the Enter/Leave giveaway button, the script now checks for a description. If it finds one, it opens the giveaway in a new tab so you can read it before entering, otherwise it enters the giveaway automatically.</li>
                </ul>
            `
        },
        {
            date: `June 2, 2017`,
            version: `6.Beta.3.13`,
            changelog: `
                <ul>
                    <li>Added the option to show points in the title to Header Refresher, and the option to show an icon in the title to highlight new messages. The icon chosen was "fire", because you got new messages, so you're "hot". If anyone has a better suggestion, feel free to let me know.</li>
                    <li>Separated the option to notify delivered gifts from Header Refresher back into Delivered Gifts Notifier.</li>
                    <li>Fixed a bug in Endless Scrolling that was happening while refreshing a page.</li>
                    <li>Fixed a bug in Giveaway Encrypter/Decrypter that was happening for giveaways with multiple copies.</li>
                </ul>
            `
        },
        {
            date: `May 29, 2017`,
            version: `6.Beta.3.12`,
            changelog: `
                <ul>
                    <li>Internally tweaked Visible Attached Images, Embedded Videos and Pagination Navigation On Top a little.</li>
                    <li>Added the options to use a 24-hour clock and to show seconds in Accurate Timestamps and shortened the name of the months to the Mmm notation.</li>
                    <li>Fixed a bug in Giveaway Winning Chance that was happening for giveaways that have not started yet (closes <a href="https://github.com/revilheart/ESGST/issues/131">#131</a>).</li>
                </ul>
            `
        },
        {
            date: `May 29, 2017`,
            version: `6.Beta.3.11`,
            changelog: `
                <ul>
                    <li>Header Icons Refresher, Points Refresher and Delivered Gifts Notifier have been merged into a single Header Refresher feature (see more details below).</li>
                    <li>Endless Scrolling no longer alters the title/URL of the page.</li>
                    <li>Added/changed some icons in the simplified version of Game Categories.</li>
                </ul>
                <p>Upgraded the following features to v6:</p>
                <ul>
                    <li>Header Refresher - If multiple tabs are open, only one tab will now make requests to refresh the header and then it will sync the changes with the other tabs (this happens instantly with Tampermonkey). The number of delivered wins will now appear in the title of the tab e.g. (2W). The icon of the tab is no longer changed, the message count will now appear in the title of the tab e.g. (5M). The level on SG and the reputation on ST are now refreshed as well, but they will not appear in the title of the tab. Points are updated instantly and refreshed across all open tabs when using Enter/Leave Giveaway Button with Tampermonkey (with Greasemonkey, it will still update, but only after 60 seconds). An example of all items combined: (2W) (5M) (150P) SteamGifts</li>
                </ul>
            `
        },
        {
            date: `May 26, 2017`,
            version: `6.Beta.3.10`,
            changelog: `
                <ul>
                    <li>Added back the option to sync using the Steam API key, but made it optional. If there is a Steam API key saved, it will sync using both Steam API key and login, otherwise it will sync using only login.</li>
                    <li>Added the option to enable a simplified version of Game Categories that can either show initials of the categories or icons (suggestions for the icons are always welcome, as I wasn't sure which icon to choose for some categories).</li>
                </ul>
            `
        },
        {
            date: `May 26, 2017`,
            version: `6.Beta.3.9`,
            changelog: `
                <ul>
                    <li>Changed the way the sync works (it no longer requires a Steam API key, but you must be logged in on Steam).</li>
                    <li>Category filters are now applied to exceptions in Giveaway Filters (closes <a href="https://github.com/revilheart/ESGST/issues/115">#115</a>).</li>
                    <li>Added "Chance" and "Genres" filters to Giveaway Filters (closes <a href="https://github.com/revilheart/ESGST/issues/101">#101</a>).</li>
                    <li>Added "Ignored" category to Game Categories (must be synced through the settings menu).</li>
                </ul>
            `
        },
        {
            date: `May 26, 2017`,
            version: `6.Beta.3.8`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Encrypter/Decrypter.</li>
                    <li>Added the option to add an icon next to the usernames instead of coloring them to Not Activated/Multiple Wins Checker.</li>
                    <li>Added the option to highlight multiple wins as positive to Not Activated/Multiple Wins Checker, as multiple wins often cannot be fixed.</li>
                    <li>Added the option to color the usernames instead of adding an icon next to them to Whitelist/Blacklist Checker. If this option is enabled, Not Activated/Multiple Wins Checker highlights will automatically appear as icons to avoid conflict.</li>
                </ul>
            `
        },
        {
            date: `May 26, 2017`,
            version: `6.Beta.3.7`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Comment Tracker that was unmarking some comments as read because of the last update.</li>
                </ul>
            `
        },
        {
            date: `May 26, 2017`,
            version: `6.Beta.3.6`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Exclusive Giveaways that was happening for games that the user has hidden (closes <a href="https://github.com/revilheart/ESGST/issues/126">#126</a>).</li>
                    <li>Fixed a bug in Exclusive Giveaways that was duplicating elements when using endless scrolling.</li>
                    <li>Fixed a bug in Embedded Videos that was trying to embed channels/playlists (closes <a href="https://github.com/revilheart/ESGST/issues/112">#112</a>).</li>
                    <li>Your own comments are now automatically marked as read in Comment Tracker.</li>
                </ul>
                <p>Renamed the following features:</p>
                <ul>
                    <li>Exclusive Giveaways -> Giveaways Encrypter/Decrypter - This prevents any confusion about the nature of this feature. The giveaways are not really exclusive (anyone can see them in the source code of the page), this feature simply decrypts them and hands them over to the user (closes <a href="https://github.com/revilheart/ESGST/issues/125">#125</a>).</li>
                </ul>
                <p>Upgraded the following features to v6:</p>
                <ul>
                    <li>Username History</li>
                    <li>User Notes - Fixed a bug that was not loading it on SteamTrades.</li>
                </ul>
            `
        },
        {
            date: `May 25, 2017`,
            version: `6.Beta.3.5`,
            changelog: `
                <ul>
                    <li>New updates of the script will now show a popup with the changelog from the current version (closes <a href="https://github.com/revilheart/ESGST/issues/119">#119</a>).</li>
                    <li>Fixed a bug that was not exporting all settings (closes <a href="https://github.com/revilheart/ESGST/issues/122">#122</a>).</li>
                    <li>Added an option to the settings menu that allows you to merge the imported data with the current data when importing.</li>
                    <li>Added the option to export Exclusive Giveaways data to the settings menu.</li>
                    <li>Improved the update link in the header button: it now checks if there is an update before loading the link (closes <a href="https://github.com/revilheart/ESGST/issues/118">#118</a>).</li>
                    <li>Fixed a bug in Exclusive Giveaways that was happening in the inbox page.</li>
                    <li>Revamped the Exclusive Giveaways popup and improved the feature: the giveaways are now requested to gather information about them (only appears in the popup), new giveaways appear with the tag [NEW] (closes <a href="https://github.com/revilheart/ESGST/issues/121">#121</a>), and ended giveaways no longer appear.</li>
                    <li>Added an option to User Notes that prompts for notes when whitelisting/blacklisting an user.</li>
                    <li>Fixed a typo in the link to the changelog on SteamGifts (closes <a href="https://github.com/revilheart/ESGST/issues/109">#109</a>).</li>
                </ul>
            `
        },
        {
            date: `May 25, 2017`,
            version: `6.Beta.3.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug that was disabling Real CV Calculator every time a giveaway was created (closes <a href="https://github.com/revilheart/ESGST/issues/124">#124</a>).</li>
                </ul>
            `
        },
        {
            date: `May 23, 2017`,
            version: `6.Beta.3.3`,
            changelog: `
                <ul>
                    <li>Reverted the script back to a single file instead of separate ones. This is actually more maintainable than using separate files, and also allows users to customize the script more easily.</li>
                </ul>
            `
        },
        {
            date: `May 23, 2017`,
            version: `6.Beta.3.2`,
            changelog: `
                <ul>
                    <li>Added the icon of the script to the metadata.</li>
                    <li>Fixed a bug that was injecting the script several times in Firefox-based browsers and causing several errors.</li>
                </ul>
            `
        },
        {
            date: `May 23, 2017`,
            version: `6.Beta.3.1`,
            changelog: `
                <ul>
                    <li>Added an exception to Exclusive Giveaways to be enabled by default upon installation.</li>
                    <li>Added a line break to the list of giveaways in Exclusive Giveaways and also a star icon to comments that have hidden giveaways.</li>
                </ul>
            `
        },
        {
            date: `May 23, 2017`,
            version: `6.Beta.3.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Header Icons Refresher that was showing a "+" icon when there were no messages.</li>
                    <li>Fixed a bug in Giveaway Filters that was enabling it for SteamTrades.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Real CV Calculator</li>
                    <li>Exclusive Giveaways</li>
                </ul>
            `
        },
        {
            date: `May 23, 2017`,
            version: `6.Beta.2.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Endless Scrolling that didn't update the filtered count from Giveaway Filters upon refreshing the page.</li>
                    <li>Prevented Giveaway Filters from running if an advanced search has been made.</li>
                    <li>Added "Wishlist" exception to Giveaway Filters.</li>
                    <li>Fixed a bug in Entries Remover that happened when syncing owned games (closes <a href="https://github.com/revilheart/ESGST/issues/110">#110</a>).</li>
                    <li>Added an option to Whitelist/Blacklist Checker that automatically saves notes to users that have been whitelisted/blacklisted in return (closes <a href="https://github.com/revilheart/ESGST/issues/59">#59</a>).</li>
                    <li>Fixed a bug in Whitelist/Blacklist Checker that was returning wrong results for blacklisted users.</li>
                </ul>
            `
        },
        {
            date: `May 23, 2017`,
            version: `6.Beta.2.3`,
            changelog: `
                <ul>
                    <li>The automatic sync is now less intrusive and appears as a button in the header (which you can click to see the current progress), and only works in the main and account pages.</li>
                    <li>Fixed a bug in Giveaway Filters that wasn't running it for page 2+ with Endless Scrolling.</li>
                    <li>Added exceptions to Giveaway Filters (closes <a href="https://github.com/revilheart/ESGST/issues/106">#106</a>).</li>
                    <li>Filters for the wishlist and group pages are now saved separately in Giveaway Filters (closes <a href="https://github.com/revilheart/ESGST/issues/107">#107</a>).</li>
                    <li>Fixed a bug in Game Categories that was preventing Giveaway Description/Reply Box Popup from working in user pages (closes <a href="https://github.com/revilheart/ESGST/issues/105">#105</a>).</li>
                </ul>
            `
        },
        {
            date: `May 23, 2017`,
            version: `6.Beta.2.2`,
            changelog: `
                <ul>
                    <li>Changed the script to disable all features upon the first installation.</li>
                    <li>Updated Giveaway Filters to work with three-state checkboxes: none, only and all.</li>
                    <li>Added "Pinned", "Group" and "Whitelist" filters to Giveaway Filters.</li>
                    <li>Fixed a bug in Giveaway Filters that wasn't filtering out entered giveaways with Grid View enabled (closes <a href="https://github.com/revilheart/ESGST/issues/104">#104</a>).</li>
                    <li>Added "Owned" tag to Game Categories (must sync owned games through the settings menu).</li>
                    <li>Fixed a bug in Game Categories where multiplayer and mac had the same id.</li>
                    <li>Fixed a bug in Game Categories that was not loading tags for certain games.</li>
                </ul>
            `
        },
        {
            date: `May 22, 2017`,
            version: `6.Beta.2.1`,
            changelog: `
                <ul>
                    <li>The links from the header button now open in the same page instead of in a new window (closes <a href="https://github.com/revilheart/ESGST/issues/102">#102</a>).</li>
                    <li>Changed the table creation in Comment Formatting Helper from a popout to a popup (closes <a href="https://github.com/revilheart/ESGST/issues/70">#70</a>).</li>
                    <li>Increased the Game Categories cache to 1 month, as it was previously 24 hours for testing purposes.</li>
                    <li>Prevented the bundle tags in Game Categories to be displayed if the user has not synced yet.</li>
                    <li>Fixed a bug in Game Categories that was displaying "Not Bundled" tags even if the bundled category was disabled (closes <a href="https://github.com/revilheart/ESGST/issues/100">#100</a>).</li>
                    <li>Fixed a bug in Game Categories that was happening while creating a giveaway (closes <a href="https://github.com/revilheart/ESGST/issues/98">#98</a>).</li>
                </ul>
            `
        },
        {
            date: `May 22, 2017`,
            version: `6.Beta.2.0`,
            changelog: `
                <p>Added the following features:</p>
                <ul>
                    <li>Giveaway Filters (replaces Entered Giveaways Filter)</li>
                </ul>
            `
        },
        {
            date: `May 22, 2017`,
            version: `6.Beta.1.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug on SteamTrades that was leaking popups at the end of the page.</li>
                    <li>Fixed a bug in Giveaway Templates that was preventing templates from being applied.</li>
                    <li>Added a "Wishlist" category for Game Categories (must be synced through the settings menu).</li>
                </ul>
            `
        },
        {
            date: `May 22, 2017`,
            version: `6.Beta.1.3`,
            changelog: `
                <ul>
                    <li>Added a "Not Bundled" category for Game Categories and the option to customize the colors.</li>
                    <li>Fixed a bug in Game Categories that was showing incorrect categories for the new giveaway page.</li>
                </ul>
            `
        },
        {
            date: `May 22, 2017`,
            version: `6.Beta.1.2`,
            changelog: `
                <ul>
                    <li>Added more categories to Game Categories and added support for giveaway comment pages.</li>
                </ul>
            `
        },
        {
            date: `May 21, 2017`,
            version: `6.Beta.1.1`,
            changelog: `
                <ul>
                    <li>Fixed a the resource link to the style file.</li>
                </ul>
            `
        },
        {
            date: `May 21, 2017`,
            version: `6.Beta.1.0`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Giveaway Winning Chance that was loading it every time a new page was loaded through Endless Scrolling in the giveaway comment pages.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Game Categories (closes <a href="https://github.com/revilheart/ESGST/issues/93">#93</a>)</li>
                </ul>
            `
        },
        {
            date: `May 21, 2017`,
            version: `6.Beta.0.4`,
            changelog: `
                <ul>
                    <li>Fixed a bug that happened when trying to retrieve the xsrf_token from the page.</li>
                    <li>Fixed a bug that was mixing the script's popups with SteamTrades' popups (closes <a href="https://github.com/revilheart/ESGST/issues/72">#72</a>).</li>
                    <li>The popups are now repositioned upon clicking on them (closes <a href="https://github.com/revilheart/ESGST/issues/83">#83</a>).</li>
                    <li>Changed the max width of popups to 75% (it was previously not set, which was making some popups have a 100% width).</li>
                    <li>Fixed a bug on SteamTrades that happened when going to the permalink of a comment.</li>
                    <li>Fixed a bug in Visible Attached Images and added support for images in the format .gifv.</li>
                    <li>Fixed a bug in Embedded Videos.</li>
                    <li>Added endless scrolling support to Giveaway Description/Reply Box Popup.</li>
                    <li>Added the option to only send gifts to users who are still members of at least one of the groups for group giveaways in Unsent Gifts Sender and added endless scrolling support for it (closes <a href="https://github.com/revilheart/ESGST/issues/90">#90</a>).</li>
                    <li>Fixed a bug on SteamTrades that was enabling Discussion Edit Detector in the user pages.</li>
                    <li>Fixed a bug in Comment Formatting Helper that was not enabling endless scrolling support for it.</li>
                    <li>Fixed a bug in Reply Box On Top for the user pages on SteamTrades.</li>
                </ul>
            `
        },
        {
            date: `May 21, 2017`,
            version: `6.Beta.0.3`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Endless Scrolling that was not stopping at the last page and continuously loading it.</li>
                </ul>
            `
        },
        {
            date: `May 21, 2017`,
            version: `6.Beta.0.2`,
            changelog: `
                <ul>
                    <li>Fixed a bug in Embedded Videos and added more link formats.</li>
                    <li>Fixed a bug in Endless Scrolling that was removing filters from the URL.</li>
                    <li>Added support for the new DLC filter to Advanced Giveaway Search.</li>
                    <li>Fixed a bug in Comment Formatting Helper that was not adding the helper to all text areas of the page.</li>
                    <li>Added endless scrolling support and an option to clear the cache to User Giveaways Data.</li>
                    <li>Fixed some bugs in Whitelist / Blacklist Checker, added support for the Two-Way Blacklists update and an option to clear the caches.</li>
                </ul>
            `
        },
        {
            date: `May 21, 2017`,
            version: `6.Beta.0.1`,
            changelog: `
                <ul>
                    <li>Fixed a bug in User Giveaways Data that was not returning complete results.</li>
                    <li>Fixed a bug that was running Accurate Timestamps even if it was disabled.</li>
                </ul>
            `
        },
        {
            date: `May 20, 2017`,
            version: `6.Beta.0.0`,
            changelog: `
                <ul>
                    <li>Created an icon for the script.</li>
                    <li>Separated all features into different files.</li>
                    <li>Fixed some typos in the README file (closes <a href="https://github.com/revilheart/ESGST/issues/94">#94</a>).</li>
                    <li>Created new icons for Header Icons Refresher and added support for SteamTrades.</li>
                    <li>Fixed a bug in Comment Tracker that was not marking some discussions as visited from the main page (closes <a href="https://github.com/revilheart/ESGST/issues/95">#95</a>).</li>
                    <li>The URL field for link and image in Comment Formatting Helper is now automatically focused upon opening and you can now select a part of the text to use as Title.</li>
                    <li>Fixed a bug in User Giveaways Data that was not updating the data correctly for users with ongoing giveaways (closes <a href="https://github.com/revilheart/ESGST/issues/68">#68</a>).</li>
                </ul>
                <p>Renamed the following features:</p>
                <ul>
                    <li>Blacklist Stats Hider -> Hidden Blacklist Stats</li>
                    <li>Featured Container Hider -> Hidden Featured Container</li>
                    <li>Giveaway Description/Comment Box Popup -> Giveaway Description/Reply Box Popup</li>
                    <li>Main Comment Box Popup -> Reply Box Popup</li>
                    <li>Permanent User Notes -> User Notes</li>
                    <li>Permanent User Tags -> User Tags</li>
                    <li>Entered Games Highlighter -> Games Highlighter</li>
                </ul>
                <p>Upgraded the following features to v6:</p>
                <ul>
                    <li>Fixed Elements - Separated the feature into individual features (Fixed Header, Fixed Sidebar, Fixed Main Page Heading and Fixed Footer). Fixed Main Page Heading works much more smoother, especially in small pages.</li>
                    <li>Visible Attached Images</li>
                    <li>Accurate Timestamps - Changed the timestamp format to match SteamGifts' format.</li>
                    <li>Endless Scrolling - Fixed several bugs (closes <a href="https://github.com/revilheart/ESGST/issues/50">#50</a>) and made several improvements. Reverse scrolling now loads the last page first.</li>
                    <li>Hidden Featured Container</li>
                    <li>Active Discussions On Top - The ad is no longer brought to the top.</li>
                </ul>
                <p>Added the following features:</p>
                <ul>
                    <li>Header Button</li>
                    <li>Embedded Videos - Partial solution to <a href="https://github.com/revilheart/ESGST/issues/89">#89</a>.</li>
                    <li>Pagination Navigation On Top</li>
                    <li>Reply Box On Top</li>
                </ul>
            `
        }
    ];
    if (version) {
        for (i = 0, n = changelog.length; i < n && changelog[i].version !== version; ++i);
        index = i < n ? i - 1 : n - 1;
    } else {
        index = 0;
    }
    html = [];
    while (index >= 0) {
        html.unshift(`
            <p class="esgst-bold">v${changelog[index].version} (${changelog[index].date})</p>
            ${changelog[index].changelog}
        `);
        --index;
    }
    popup = new Popup(`fa-file-text-o`, `Changelog`, true);
    popup.scrollable.insertAdjacentHTML(`afterBegin`, `<div class="esgst-text-left markdown">${html.join(``)}</div>`);
    popup.open();
}