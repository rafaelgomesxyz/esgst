// ==UserScript==
// @name ESGST
// @namespace ESGST
// @description Enhances SteamGifts and SteamTrades by adding some cool features to them.
// @icon https://dl.dropboxusercontent.com/s/lr3t3bxrxfxylqe/esgstIcon.ico?raw=1
// @version 7.12.0
// @author revilheart
// @downloadURL https://github.com/revilheart/ESGST/raw/master/ESGST.user.js
// @updateURL https://github.com/revilheart/ESGST/raw/master/ESGST.meta.js
// @match https://www.steamgifts.com/*
// @match https://www.steamtrades.com/*
// @connect raw.githubusercontent.com
// @connect api.steampowered.com
// @connect store.steampowered.com
// @connect script.google.com
// @connect script.googleusercontent.com
// @connect sgtools.info
// @connect steamcommunity.com
// @connect steamgifts.com
// @connect steamtrades.com
// @connect isthereanydeal.com
// @connect api.dropboxapi.com
// @connect content.dropboxapi.com
// @connect api.imgur.com
// @connect googleapis.com
// @connect graph.microsoft.com
// @grant GM_setValue
// @grant GM_getValue
// @grant GM_deleteValue
// @grant GM_listValues
// @grant GM_xmlhttpRequest
// @grant GM.setValue
// @grant GM.getValue
// @grant GM.deleteValue
// @grant GM.listValues
// @grant GM.xmlHttpRequest
// @noframes
// ==/UserScript==

// jQuery

!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";var c=[],d=a.document,e=Object.getPrototypeOf,f=c.slice,g=c.concat,h=c.push,i=c.indexOf,j={},k=j.toString,l=j.hasOwnProperty,m=l.toString,n=m.call(Object),o={};function p(a,b){b=b||d;var c=b.createElement("script");c.text=a,b.head.appendChild(c).parentNode.removeChild(c)}var q="3.2.1",r=function(a,b){return new r.fn.init(a,b)},s=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,t=/^-ms-/,u=/-([a-z])/g,v=function(a,b){return b.toUpperCase()};r.fn=r.prototype={jquery:q,constructor:r,length:0,toArray:function(){return f.call(this)},get:function(a){return null==a?f.call(this):a<0?this[a+this.length]:this[a]},pushStack:function(a){var b=r.merge(this.constructor(),a);return b.prevObject=this,b},each:function(a){return r.each(this,a)},map:function(a){return this.pushStack(r.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(a<0?b:0);return this.pushStack(c>=0&&c<b?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:h,sort:c.sort,splice:c.splice},r.extend=r.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||r.isFunction(g)||(g={}),h===i&&(g=this,h--);h<i;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(r.isPlainObject(d)||(e=Array.isArray(d)))?(e?(e=!1,f=c&&Array.isArray(c)?c:[]):f=c&&r.isPlainObject(c)?c:{},g[b]=r.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},r.extend({expando:"jQuery"+(q+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===r.type(a)},isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=r.type(a);return("number"===b||"string"===b)&&!isNaN(a-parseFloat(a))},isPlainObject:function(a){var b,c;return!(!a||"[object Object]"!==k.call(a))&&(!(b=e(a))||(c=l.call(b,"constructor")&&b.constructor,"function"==typeof c&&m.call(c)===n))},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?j[k.call(a)]||"object":typeof a},globalEval:function(a){p(a)},camelCase:function(a){return a.replace(t,"ms-").replace(u,v)},each:function(a,b){var c,d=0;if(w(a)){for(c=a.length;d<c;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(s,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(w(Object(a))?r.merge(c,"string"==typeof a?[a]:a):h.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:i.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;d<c;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;f<g;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,f=0,h=[];if(w(a))for(d=a.length;f<d;f++)e=b(a[f],f,c),null!=e&&h.push(e);else for(f in a)e=b(a[f],f,c),null!=e&&h.push(e);return g.apply([],h)},guid:1,proxy:function(a,b){var c,d,e;if("string"==typeof b&&(c=a[b],b=a,a=c),r.isFunction(a))return d=f.call(arguments,2),e=function(){return a.apply(b||this,d.concat(f.call(arguments)))},e.guid=a.guid=a.guid||r.guid++,e},now:Date.now,support:o}),"function"==typeof Symbol&&(r.fn[Symbol.iterator]=c[Symbol.iterator]),r.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){j["[object "+b+"]"]=b.toLowerCase()});function w(a){var b=!!a&&"length"in a&&a.length,c=r.type(a);return"function"!==c&&!r.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a)}var x=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\x20\\t\\r\\n\\f]",L="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",M="\\["+K+"*("+L+")(?:"+K+"*([*^$|!~]?=)"+K+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+L+"))|)"+K+"*\\]",N=":("+L+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+M+")*)|.*)\\)|)",O=new RegExp(K+"+","g"),P=new RegExp("^"+K+"+|((?:^|[^\\\\])(?:\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\]'\"]*?)"+K+"*\\]","g"),T=new RegExp(N),U=new RegExp("^"+L+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L+"|[*])"),ATTR:new RegExp("^"+M),PSEUDO:new RegExp("^"+N),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+K+"*(even|odd|(([+-]|)(\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\d+)|))"+K+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+K+"*((?:-\\d)?\\d*)"+K+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,_=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),aa=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:d<0?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ba=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ca=function(a,b){return b?"\0"===a?"\ufffd":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a},da=function(){m()},ea=ta(function(a){return a.disabled===!0&&("form"in a||"label"in a)},{dir:"parentNode",next:"legend"});try{G.apply(D=H.call(v.childNodes),v.childNodes),D[v.childNodes.length].nodeType}catch(fa){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s=b&&b.ownerDocument,w=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==w&&9!==w&&11!==w)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==w&&(l=Z.exec(a)))if(f=l[1]){if(9===w){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(s&&(j=s.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(l[2])return G.apply(d,b.getElementsByTagName(a)),d;if((f=l[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==w)s=b,r=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(ba,ca):b.setAttribute("id",k=u),o=g(a),h=o.length;while(h--)o[h]="#"+k+" "+sa(o[h]);r=o.join(","),s=$.test(a)&&qa(b.parentNode)||b}if(r)try{return G.apply(d,s.querySelectorAll(r)),d}catch(x){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(P,"$1"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("fieldset");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return function(b){return"form"in b?b.parentNode&&b.disabled===!1?"label"in b?"label"in b.parentNode?b.parentNode.disabled===a:b.disabled===a:b.isDisabled===a||b.isDisabled!==!a&&ea(b)===a:b.disabled===a:"label"in b&&b.disabled===a}}function pa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function qa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),v!==n&&(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(n.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){return a.getAttribute("id")===b}},d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}}):(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}},d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c,d,e,f=b.getElementById(a);if(f){if(c=f.getAttributeNode("id"),c&&c.value===a)return[f];e=b.getElementsByName(a),d=0;while(f=e[d++])if(c=f.getAttributeNode("id"),c&&c.value===a)return[f]}return[]}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){if("undefined"!=typeof b.getElementsByClassName&&p)return b.getElementsByClassName(a)},r=[],q=[],(c.qsa=Y.test(n.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+K+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+K+"*(?:value|"+J+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){a.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+K+"*[*^$|!~]?="),2!==a.querySelectorAll(":enabled").length&&q.push(":enabled",":disabled"),o.appendChild(a).disabled=!0,2!==a.querySelectorAll(":disabled").length&&q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Y.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"*"),s.call(a,"[s!='']:x"),r.push("!=",N)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Y.test(o.compareDocumentPosition),t=b||Y.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?I(k,a)-I(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?I(k,a)-I(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?la(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(S,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.escape=function(a){return(a+"").replace(ba,ca)},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(_,aa),a[3]=(a[3]||a[4]||a[5]||"").replace(_,aa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return V.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&T.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(_,aa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:!b||(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(O," ")+" ").indexOf(c)>-1:"|="===b&&(e===c||e.slice(0,c.length+1)===c+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=I(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(P,"$1"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(_,aa),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return U.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(_,aa).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:oa(!1),disabled:oa(!0),checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:pa(function(){return[0]}),last:pa(function(a,b){return[b-1]}),eq:pa(function(a,b,c){return[c<0?c+b:c]}),even:pa(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:pa(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:pa(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:pa(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function ra(){}ra.prototype=d.filters=d.pseudos,d.setFilters=new ra,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=Q.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function sa(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function ta(a,b,c){var d=b.dir,e=b.next,f=e||d,g=c&&"parentNode"===f,h=x++;return b.first?function(b,c,e){while(b=b[d])if(1===b.nodeType||g)return a(b,c,e);return!1}:function(b,c,i){var j,k,l,m=[w,h];if(i){while(b=b[d])if((1===b.nodeType||g)&&a(b,c,i))return!0}else while(b=b[d])if(1===b.nodeType||g)if(l=b[u]||(b[u]={}),k=l[b.uniqueID]||(l[b.uniqueID]={}),e&&e===b.nodeName.toLowerCase())b=b[d]||b;else{if((j=k[f])&&j[0]===w&&j[1]===h)return m[2]=j[2];if(k[f]=m,m[2]=a(b,c,i))return!0}return!1}}function ua(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function va(a,b,c){for(var d=0,e=b.length;d<e;d++)ga(a,b[d],c);return c}function wa(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function xa(a,b,c,d,e,f){return d&&!d[u]&&(d=xa(d)),e&&!e[u]&&(e=xa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||va(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:wa(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=wa(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?I(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=wa(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ya(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ta(function(a){return a===b},h,!0),l=ta(function(a){return I(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];i<f;i++)if(c=d.relative[a[i].type])m=[ta(ua(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;e<f;e++)if(d.relative[a[e].type])break;return xa(i>1&&ua(m),i>1&&sa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(P,"$1"),c,i<e&&ya(a.slice(i,e)),e<f&&ya(a=a.slice(e)),e<f&&sa(a))}m.push(c)}return ua(m)}function za(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=E.call(i));u=wa(u)}G.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&ga.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=ya(b[c]),f[u]?d.push(f):e.push(f);f=A(a,za(e,d)),f.selector=a}return f},i=ga.select=function(a,b,c,e){var f,i,j,k,l,m="function"==typeof a&&a,n=!e&&g(a=m.selector||a);if(c=c||[],1===n.length){if(i=n[0]=n[0].slice(0),i.length>2&&"ID"===(j=i[0]).type&&9===b.nodeType&&p&&d.relative[i[1].type]){if(b=(d.find.ID(j.matches[0].replace(_,aa),b)||[])[0],!b)return c;m&&(b=b.parentNode),a=a.slice(i.shift().value.length)}f=V.needsContext.test(a)?0:i.length;while(f--){if(j=i[f],d.relative[k=j.type])break;if((l=d.find[k])&&(e=l(j.matches[0].replace(_,aa),$.test(i[0].type)&&qa(b.parentNode)||b))){if(i.splice(f,1),a=e.length&&sa(i),!a)return G.apply(c,e),c;break}}}return(m||h(a,n))(e,b,!p,c,!b||$.test(a)&&qa(b.parentNode)||b),c},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("fieldset"))}),ja(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(J,function(a,b,c){var d;if(!c)return a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);r.find=x,r.expr=x.selectors,r.expr[":"]=r.expr.pseudos,r.uniqueSort=r.unique=x.uniqueSort,r.text=x.getText,r.isXMLDoc=x.isXML,r.contains=x.contains,r.escapeSelector=x.escape;var y=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&r(a).is(c))break;d.push(a)}return d},z=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},A=r.expr.match.needsContext;function B(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()}var C=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,D=/^.[^:#\[\.,]*$/;function E(a,b,c){return r.isFunction(b)?r.grep(a,function(a,d){return!!b.call(a,d,a)!==c}):b.nodeType?r.grep(a,function(a){return a===b!==c}):"string"!=typeof b?r.grep(a,function(a){return i.call(b,a)>-1!==c}):D.test(b)?r.filter(b,a,c):(b=r.filter(b,a),r.grep(a,function(a){return i.call(b,a)>-1!==c&&1===a.nodeType}))}r.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?r.find.matchesSelector(d,a)?[d]:[]:r.find.matches(a,r.grep(b,function(a){return 1===a.nodeType}))},r.fn.extend({find:function(a){var b,c,d=this.length,e=this;if("string"!=typeof a)return this.pushStack(r(a).filter(function(){for(b=0;b<d;b++)if(r.contains(e[b],this))return!0}));for(c=this.pushStack([]),b=0;b<d;b++)r.find(a,e[b],c);return d>1?r.uniqueSort(c):c},filter:function(a){return this.pushStack(E(this,a||[],!1))},not:function(a){return this.pushStack(E(this,a||[],!0))},is:function(a){return!!E(this,"string"==typeof a&&A.test(a)?r(a):a||[],!1).length}});var F,G=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,H=r.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||F,"string"==typeof a){if(e="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:G.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof r?b[0]:b,r.merge(this,r.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),C.test(e[1])&&r.isPlainObject(b))for(e in b)r.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return f=d.getElementById(e[2]),f&&(this[0]=f,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):r.isFunction(a)?void 0!==c.ready?c.ready(a):a(r):r.makeArray(a,this)};H.prototype=r.fn,F=r(d);var I=/^(?:parents|prev(?:Until|All))/,J={children:!0,contents:!0,next:!0,prev:!0};r.fn.extend({has:function(a){var b=r(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(r.contains(this,b[a]))return!0})},closest:function(a,b){var c,d=0,e=this.length,f=[],g="string"!=typeof a&&r(a);if(!A.test(a))for(;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&r.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?r.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?i.call(r(a),this[0]):i.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(r.uniqueSort(r.merge(this.get(),r(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function K(a,b){while((a=a[b])&&1!==a.nodeType);return a}r.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return y(a,"parentNode")},parentsUntil:function(a,b,c){return y(a,"parentNode",c)},next:function(a){return K(a,"nextSibling")},prev:function(a){return K(a,"previousSibling")},nextAll:function(a){return y(a,"nextSibling")},prevAll:function(a){return y(a,"previousSibling")},nextUntil:function(a,b,c){return y(a,"nextSibling",c)},prevUntil:function(a,b,c){return y(a,"previousSibling",c)},siblings:function(a){return z((a.parentNode||{}).firstChild,a)},children:function(a){return z(a.firstChild)},contents:function(a){return B(a,"iframe")?a.contentDocument:(B(a,"template")&&(a=a.content||a),r.merge([],a.childNodes))}},function(a,b){r.fn[a]=function(c,d){var e=r.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=r.filter(d,e)),this.length>1&&(J[a]||r.uniqueSort(e),I.test(a)&&e.reverse()),this.pushStack(e)}});var L=/[^\x20\t\r\n\f]+/g;function M(a){var b={};return r.each(a.match(L)||[],function(a,c){b[c]=!0}),b}r.Callbacks=function(a){a="string"==typeof a?M(a):r.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=e||a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){r.each(b,function(b,c){r.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==r.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return r.each(arguments,function(a,b){var c;while((c=r.inArray(b,f,c))>-1)f.splice(c,1),c<=h&&h--}),this},has:function(a){return a?r.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=g=[],c||b||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j};function N(a){return a}function O(a){throw a}function P(a,b,c,d){var e;try{a&&r.isFunction(e=a.promise)?e.call(a).done(b).fail(c):a&&r.isFunction(e=a.then)?e.call(a,b,c):b.apply(void 0,[a].slice(d))}catch(a){c.apply(void 0,[a])}}r.extend({Deferred:function(b){var c=[["notify","progress",r.Callbacks("memory"),r.Callbacks("memory"),2],["resolve","done",r.Callbacks("once memory"),r.Callbacks("once memory"),0,"resolved"],["reject","fail",r.Callbacks("once memory"),r.Callbacks("once memory"),1,"rejected"]],d="pending",e={state:function(){return d},always:function(){return f.done(arguments).fail(arguments),this},"catch":function(a){return e.then(null,a)},pipe:function(){var a=arguments;return r.Deferred(function(b){r.each(c,function(c,d){var e=r.isFunction(a[d[4]])&&a[d[4]];f[d[1]](function(){var a=e&&e.apply(this,arguments);a&&r.isFunction(a.promise)?a.promise().progress(b.notify).done(b.resolve).fail(b.reject):b[d[0]+"With"](this,e?[a]:arguments)})}),a=null}).promise()},then:function(b,d,e){var f=0;function g(b,c,d,e){return function(){var h=this,i=arguments,j=function(){var a,j;if(!(b<f)){if(a=d.apply(h,i),a===c.promise())throw new TypeError("Thenable self-resolution");j=a&&("object"==typeof a||"function"==typeof a)&&a.then,r.isFunction(j)?e?j.call(a,g(f,c,N,e),g(f,c,O,e)):(f++,j.call(a,g(f,c,N,e),g(f,c,O,e),g(f,c,N,c.notifyWith))):(d!==N&&(h=void 0,i=[a]),(e||c.resolveWith)(h,i))}},k=e?j:function(){try{j()}catch(a){r.Deferred.exceptionHook&&r.Deferred.exceptionHook(a,k.stackTrace),b+1>=f&&(d!==O&&(h=void 0,i=[a]),c.rejectWith(h,i))}};b?k():(r.Deferred.getStackHook&&(k.stackTrace=r.Deferred.getStackHook()),a.setTimeout(k))}}return r.Deferred(function(a){c[0][3].add(g(0,a,r.isFunction(e)?e:N,a.notifyWith)),c[1][3].add(g(0,a,r.isFunction(b)?b:N)),c[2][3].add(g(0,a,r.isFunction(d)?d:O))}).promise()},promise:function(a){return null!=a?r.extend(a,e):e}},f={};return r.each(c,function(a,b){var g=b[2],h=b[5];e[b[1]]=g.add,h&&g.add(function(){d=h},c[3-a][2].disable,c[0][2].lock),g.add(b[3].fire),f[b[0]]=function(){return f[b[0]+"With"](this===f?void 0:this,arguments),this},f[b[0]+"With"]=g.fireWith}),e.promise(f),b&&b.call(f,f),f},when:function(a){var b=arguments.length,c=b,d=Array(c),e=f.call(arguments),g=r.Deferred(),h=function(a){return function(c){d[a]=this,e[a]=arguments.length>1?f.call(arguments):c,--b||g.resolveWith(d,e)}};if(b<=1&&(P(a,g.done(h(c)).resolve,g.reject,!b),"pending"===g.state()||r.isFunction(e[c]&&e[c].then)))return g.then();while(c--)P(e[c],h(c),g.reject);return g.promise()}});var Q=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;r.Deferred.exceptionHook=function(b,c){a.console&&a.console.warn&&b&&Q.test(b.name)&&a.console.warn("jQuery.Deferred exception: "+b.message,b.stack,c)},r.readyException=function(b){a.setTimeout(function(){throw b})};var R=r.Deferred();r.fn.ready=function(a){return R.then(a)["catch"](function(a){r.readyException(a)}),this},r.extend({isReady:!1,readyWait:1,ready:function(a){(a===!0?--r.readyWait:r.isReady)||(r.isReady=!0,a!==!0&&--r.readyWait>0||R.resolveWith(d,[r]))}}),r.ready.then=R.then;function S(){d.removeEventListener("DOMContentLoaded",S),
a.removeEventListener("load",S),r.ready()}"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll?a.setTimeout(r.ready):(d.addEventListener("DOMContentLoaded",S),a.addEventListener("load",S));var T=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===r.type(c)){e=!0;for(h in c)T(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,r.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(r(a),c)})),b))for(;h<i;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},U=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function V(){this.expando=r.expando+V.uid++}V.uid=1,V.prototype={cache:function(a){var b=a[this.expando];return b||(b={},U(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[r.camelCase(b)]=c;else for(d in b)e[r.camelCase(d)]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][r.camelCase(b)]},access:function(a,b,c){return void 0===b||b&&"string"==typeof b&&void 0===c?this.get(a,b):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d=a[this.expando];if(void 0!==d){if(void 0!==b){Array.isArray(b)?b=b.map(r.camelCase):(b=r.camelCase(b),b=b in d?[b]:b.match(L)||[]),c=b.length;while(c--)delete d[b[c]]}(void 0===b||r.isEmptyObject(d))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!r.isEmptyObject(b)}};var W=new V,X=new V,Y=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Z=/[A-Z]/g;function $(a){return"true"===a||"false"!==a&&("null"===a?null:a===+a+""?+a:Y.test(a)?JSON.parse(a):a)}function _(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Z,"-$&").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c=$(c)}catch(e){}X.set(a,b,c)}else c=void 0;return c}r.extend({hasData:function(a){return X.hasData(a)||W.hasData(a)},data:function(a,b,c){return X.access(a,b,c)},removeData:function(a,b){X.remove(a,b)},_data:function(a,b,c){return W.access(a,b,c)},_removeData:function(a,b){W.remove(a,b)}}),r.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=X.get(f),1===f.nodeType&&!W.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=r.camelCase(d.slice(5)),_(f,d,e[d])));W.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){X.set(this,a)}):T(this,function(b){var c;if(f&&void 0===b){if(c=X.get(f,a),void 0!==c)return c;if(c=_(f,a),void 0!==c)return c}else this.each(function(){X.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){X.remove(this,a)})}}),r.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=W.get(a,b),c&&(!d||Array.isArray(c)?d=W.access(a,b,r.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=r.queue(a,b),d=c.length,e=c.shift(),f=r._queueHooks(a,b),g=function(){r.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return W.get(a,c)||W.access(a,c,{empty:r.Callbacks("once memory").add(function(){W.remove(a,[b+"queue",c])})})}}),r.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?r.queue(this[0],a):void 0===b?this:this.each(function(){var c=r.queue(this,a,b);r._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&r.dequeue(this,a)})},dequeue:function(a){return this.each(function(){r.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=r.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=W.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var aa=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ba=new RegExp("^(?:([+-])=|)("+aa+")([a-z%]*)$","i"),ca=["Top","Right","Bottom","Left"],da=function(a,b){return a=b||a,"none"===a.style.display||""===a.style.display&&r.contains(a.ownerDocument,a)&&"none"===r.css(a,"display")},ea=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};function fa(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return r.css(a,b,"")},i=h(),j=c&&c[3]||(r.cssNumber[b]?"":"px"),k=(r.cssNumber[b]||"px"!==j&&+i)&&ba.exec(r.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,r.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var ga={};function ha(a){var b,c=a.ownerDocument,d=a.nodeName,e=ga[d];return e?e:(b=c.body.appendChild(c.createElement(d)),e=r.css(b,"display"),b.parentNode.removeChild(b),"none"===e&&(e="block"),ga[d]=e,e)}function ia(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)d=a[f],d.style&&(c=d.style.display,b?("none"===c&&(e[f]=W.get(d,"display")||null,e[f]||(d.style.display="")),""===d.style.display&&da(d)&&(e[f]=ha(d))):"none"!==c&&(e[f]="none",W.set(d,"display",c)));for(f=0;f<g;f++)null!=e[f]&&(a[f].style.display=e[f]);return a}r.fn.extend({show:function(){return ia(this,!0)},hide:function(){return ia(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){da(this)?r(this).show():r(this).hide()})}});var ja=/^(?:checkbox|radio)$/i,ka=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,la=/^$|\/(?:java|ecma)script/i,ma={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ma.optgroup=ma.option,ma.tbody=ma.tfoot=ma.colgroup=ma.caption=ma.thead,ma.th=ma.td;function na(a,b){var c;return c="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):[],void 0===b||b&&B(a,b)?r.merge([a],c):c}function oa(a,b){for(var c=0,d=a.length;c<d;c++)W.set(a[c],"globalEval",!b||W.get(b[c],"globalEval"))}var pa=/<|&#?\w+;/;function qa(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],n=0,o=a.length;n<o;n++)if(f=a[n],f||0===f)if("object"===r.type(f))r.merge(m,f.nodeType?[f]:f);else if(pa.test(f)){g=g||l.appendChild(b.createElement("div")),h=(ka.exec(f)||["",""])[1].toLowerCase(),i=ma[h]||ma._default,g.innerHTML=i[1]+r.htmlPrefilter(f)+i[2],k=i[0];while(k--)g=g.lastChild;r.merge(m,g.childNodes),g=l.firstChild,g.textContent=""}else m.push(b.createTextNode(f));l.textContent="",n=0;while(f=m[n++])if(d&&r.inArray(f,d)>-1)e&&e.push(f);else if(j=r.contains(f.ownerDocument,f),g=na(l.appendChild(f),"script"),j&&oa(g),c){k=0;while(f=g[k++])la.test(f.type||"")&&c.push(f)}return l}!function(){var a=d.createDocumentFragment(),b=a.appendChild(d.createElement("div")),c=d.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),o.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",o.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var ra=d.documentElement,sa=/^key/,ta=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ua=/^([^.]*)(?:\.(.+)|)/;function va(){return!0}function wa(){return!1}function xa(){try{return d.activeElement}catch(a){}}function ya(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)ya(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=wa;else if(!e)return a;return 1===f&&(g=e,e=function(a){return r().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=r.guid++)),a.each(function(){r.event.add(this,b,e,d,c)})}r.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=W.get(a);if(q){c.handler&&(f=c,c=f.handler,e=f.selector),e&&r.find.matchesSelector(ra,e),c.guid||(c.guid=r.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return"undefined"!=typeof r&&r.event.triggered!==b.type?r.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(L)||[""],j=b.length;while(j--)h=ua.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=r.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=r.event.special[n]||{},k=r.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&r.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),r.event.global[n]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=W.hasData(a)&&W.get(a);if(q&&(i=q.events)){b=(b||"").match(L)||[""],j=b.length;while(j--)if(h=ua.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){l=r.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||r.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)r.event.remove(a,n+b[j],c,d,!0);r.isEmptyObject(i)&&W.remove(a,"handle events")}},dispatch:function(a){var b=r.event.fix(a),c,d,e,f,g,h,i=new Array(arguments.length),j=(W.get(this,"events")||{})[b.type]||[],k=r.event.special[b.type]||{};for(i[0]=b,c=1;c<arguments.length;c++)i[c]=arguments[c];if(b.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,b)!==!1){h=r.event.handlers.call(this,b,j),c=0;while((f=h[c++])&&!b.isPropagationStopped()){b.currentTarget=f.elem,d=0;while((g=f.handlers[d++])&&!b.isImmediatePropagationStopped())b.rnamespace&&!b.rnamespace.test(g.namespace)||(b.handleObj=g,b.data=g.data,e=((r.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(b.result=e)===!1&&(b.preventDefault(),b.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,b),b.result}},handlers:function(a,b){var c,d,e,f,g,h=[],i=b.delegateCount,j=a.target;if(i&&j.nodeType&&!("click"===a.type&&a.button>=1))for(;j!==this;j=j.parentNode||this)if(1===j.nodeType&&("click"!==a.type||j.disabled!==!0)){for(f=[],g={},c=0;c<i;c++)d=b[c],e=d.selector+" ",void 0===g[e]&&(g[e]=d.needsContext?r(e,this).index(j)>-1:r.find(e,this,null,[j]).length),g[e]&&f.push(d);f.length&&h.push({elem:j,handlers:f})}return j=this,i<b.length&&h.push({elem:j,handlers:b.slice(i)}),h},addProp:function(a,b){Object.defineProperty(r.Event.prototype,a,{enumerable:!0,configurable:!0,get:r.isFunction(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},set:function(b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:b})}})},fix:function(a){return a[r.expando]?a:new r.Event(a)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==xa()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===xa()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&B(this,"input"))return this.click(),!1},_default:function(a){return B(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},r.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},r.Event=function(a,b){return this instanceof r.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?va:wa,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,b&&r.extend(this,b),this.timeStamp=a&&a.timeStamp||r.now(),void(this[r.expando]=!0)):new r.Event(a,b)},r.Event.prototype={constructor:r.Event,isDefaultPrevented:wa,isPropagationStopped:wa,isImmediatePropagationStopped:wa,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=va,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=va,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=va,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},r.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(a){var b=a.button;return null==a.which&&sa.test(a.type)?null!=a.charCode?a.charCode:a.keyCode:!a.which&&void 0!==b&&ta.test(a.type)?1&b?1:2&b?3:4&b?2:0:a.which}},r.event.addProp),r.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){r.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||r.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),r.fn.extend({on:function(a,b,c,d){return ya(this,a,b,c,d)},one:function(a,b,c,d){return ya(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,r(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=wa),this.each(function(){r.event.remove(this,a,c,b)})}});var za=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Aa=/<script|<style|<link/i,Ba=/checked\s*(?:[^=]|=\s*.checked.)/i,Ca=/^true\/(.*)/,Da=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ea(a,b){return B(a,"table")&&B(11!==b.nodeType?b:b.firstChild,"tr")?r(">tbody",a)[0]||a:a}function Fa(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function Ga(a){var b=Ca.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ha(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(W.hasData(a)&&(f=W.access(a),g=W.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;c<d;c++)r.event.add(b,e,j[e][c])}X.hasData(a)&&(h=X.access(a),i=r.extend({},h),X.set(b,i))}}function Ia(a,b){var c=b.nodeName.toLowerCase();"input"===c&&ja.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function Ja(a,b,c,d){b=g.apply([],b);var e,f,h,i,j,k,l=0,m=a.length,n=m-1,q=b[0],s=r.isFunction(q);if(s||m>1&&"string"==typeof q&&!o.checkClone&&Ba.test(q))return a.each(function(e){var f=a.eq(e);s&&(b[0]=q.call(this,e,f.html())),Ja(f,b,c,d)});if(m&&(e=qa(b,a[0].ownerDocument,!1,a,d),f=e.firstChild,1===e.childNodes.length&&(e=f),f||d)){for(h=r.map(na(e,"script"),Fa),i=h.length;l<m;l++)j=e,l!==n&&(j=r.clone(j,!0,!0),i&&r.merge(h,na(j,"script"))),c.call(a[l],j,l);if(i)for(k=h[h.length-1].ownerDocument,r.map(h,Ga),l=0;l<i;l++)j=h[l],la.test(j.type||"")&&!W.access(j,"globalEval")&&r.contains(k,j)&&(j.src?r._evalUrl&&r._evalUrl(j.src):p(j.textContent.replace(Da,""),k))}return a}function Ka(a,b,c){for(var d,e=b?r.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||r.cleanData(na(d)),d.parentNode&&(c&&r.contains(d.ownerDocument,d)&&oa(na(d,"script")),d.parentNode.removeChild(d));return a}r.extend({htmlPrefilter:function(a){return a.replace(za,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=r.contains(a.ownerDocument,a);if(!(o.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||r.isXMLDoc(a)))for(g=na(h),f=na(a),d=0,e=f.length;d<e;d++)Ia(f[d],g[d]);if(b)if(c)for(f=f||na(a),g=g||na(h),d=0,e=f.length;d<e;d++)Ha(f[d],g[d]);else Ha(a,h);return g=na(h,"script"),g.length>0&&oa(g,!i&&na(a,"script")),h},cleanData:function(a){for(var b,c,d,e=r.event.special,f=0;void 0!==(c=a[f]);f++)if(U(c)){if(b=c[W.expando]){if(b.events)for(d in b.events)e[d]?r.event.remove(c,d):r.removeEvent(c,d,b.handle);c[W.expando]=void 0}c[X.expando]&&(c[X.expando]=void 0)}}}),r.fn.extend({detach:function(a){return Ka(this,a,!0)},remove:function(a){return Ka(this,a)},text:function(a){return T(this,function(a){return void 0===a?r.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return Ja(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ea(this,a);b.appendChild(a)}})},prepend:function(){return Ja(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ea(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ja(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ja(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(r.cleanData(na(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return r.clone(this,a,b)})},html:function(a){return T(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Aa.test(a)&&!ma[(ka.exec(a)||["",""])[1].toLowerCase()]){a=r.htmlPrefilter(a);try{for(;c<d;c++)b=this[c]||{},1===b.nodeType&&(r.cleanData(na(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ja(this,arguments,function(b){var c=this.parentNode;r.inArray(this,a)<0&&(r.cleanData(na(this)),c&&c.replaceChild(b,this))},a)}}),r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){r.fn[a]=function(a){for(var c,d=[],e=r(a),f=e.length-1,g=0;g<=f;g++)c=g===f?this:this.clone(!0),r(e[g])[b](c),h.apply(d,c.get());return this.pushStack(d)}});var La=/^margin/,Ma=new RegExp("^("+aa+")(?!px)[a-z%]+$","i"),Na=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)};!function(){function b(){if(i){i.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",i.innerHTML="",ra.appendChild(h);var b=a.getComputedStyle(i);c="1%"!==b.top,g="2px"===b.marginLeft,e="4px"===b.width,i.style.marginRight="50%",f="4px"===b.marginRight,ra.removeChild(h),i=null}}var c,e,f,g,h=d.createElement("div"),i=d.createElement("div");i.style&&(i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",o.clearCloneStyle="content-box"===i.style.backgroundClip,h.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",h.appendChild(i),r.extend(o,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return b(),e},pixelMarginRight:function(){return b(),f},reliableMarginLeft:function(){return b(),g}}))}();function Oa(a,b,c){var d,e,f,g,h=a.style;return c=c||Na(a),c&&(g=c.getPropertyValue(b)||c[b],""!==g||r.contains(a.ownerDocument,a)||(g=r.style(a,b)),!o.pixelMarginRight()&&Ma.test(g)&&La.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function Pa(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Qa=/^(none|table(?!-c[ea]).+)/,Ra=/^--/,Sa={position:"absolute",visibility:"hidden",display:"block"},Ta={letterSpacing:"0",fontWeight:"400"},Ua=["Webkit","Moz","ms"],Va=d.createElement("div").style;function Wa(a){if(a in Va)return a;var b=a[0].toUpperCase()+a.slice(1),c=Ua.length;while(c--)if(a=Ua[c]+b,a in Va)return a}function Xa(a){var b=r.cssProps[a];return b||(b=r.cssProps[a]=Wa(a)||a),b}function Ya(a,b,c){var d=ba.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function Za(a,b,c,d,e){var f,g=0;for(f=c===(d?"border":"content")?4:"width"===b?1:0;f<4;f+=2)"margin"===c&&(g+=r.css(a,c+ca[f],!0,e)),d?("content"===c&&(g-=r.css(a,"padding"+ca[f],!0,e)),"margin"!==c&&(g-=r.css(a,"border"+ca[f]+"Width",!0,e))):(g+=r.css(a,"padding"+ca[f],!0,e),"padding"!==c&&(g+=r.css(a,"border"+ca[f]+"Width",!0,e)));return g}function $a(a,b,c){var d,e=Na(a),f=Oa(a,b,e),g="border-box"===r.css(a,"boxSizing",!1,e);return Ma.test(f)?f:(d=g&&(o.boxSizingReliable()||f===a.style[b]),"auto"===f&&(f=a["offset"+b[0].toUpperCase()+b.slice(1)]),f=parseFloat(f)||0,f+Za(a,b,c||(g?"border":"content"),d,e)+"px")}r.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Oa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=r.camelCase(b),i=Ra.test(b),j=a.style;return i||(b=Xa(h)),g=r.cssHooks[b]||r.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:j[b]:(f=typeof c,"string"===f&&(e=ba.exec(c))&&e[1]&&(c=fa(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(r.cssNumber[h]?"":"px")),o.clearCloneStyle||""!==c||0!==b.indexOf("background")||(j[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i?j.setProperty(b,c):j[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=r.camelCase(b),i=Ra.test(b);return i||(b=Xa(h)),g=r.cssHooks[b]||r.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=Oa(a,b,d)),"normal"===e&&b in Ta&&(e=Ta[b]),""===c||c?(f=parseFloat(e),c===!0||isFinite(f)?f||0:e):e}}),r.each(["height","width"],function(a,b){r.cssHooks[b]={get:function(a,c,d){if(c)return!Qa.test(r.css(a,"display"))||a.getClientRects().length&&a.getBoundingClientRect().width?$a(a,b,d):ea(a,Sa,function(){return $a(a,b,d)})},set:function(a,c,d){var e,f=d&&Na(a),g=d&&Za(a,b,d,"border-box"===r.css(a,"boxSizing",!1,f),f);return g&&(e=ba.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=r.css(a,b)),Ya(a,c,g)}}}),r.cssHooks.marginLeft=Pa(o.reliableMarginLeft,function(a,b){if(b)return(parseFloat(Oa(a,"marginLeft"))||a.getBoundingClientRect().left-ea(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"}),r.each({margin:"",padding:"",border:"Width"},function(a,b){r.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];d<4;d++)e[a+ca[d]+b]=f[d]||f[d-2]||f[0];return e}},La.test(a)||(r.cssHooks[a+b].set=Ya)}),r.fn.extend({css:function(a,b){return T(this,function(a,b,c){var d,e,f={},g=0;if(Array.isArray(b)){for(d=Na(a),e=b.length;g<e;g++)f[b[g]]=r.css(a,b[g],!1,d);return f}return void 0!==c?r.style(a,b,c):r.css(a,b)},a,b,arguments.length>1)}});function _a(a,b,c,d,e){return new _a.prototype.init(a,b,c,d,e)}r.Tween=_a,_a.prototype={constructor:_a,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||r.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(r.cssNumber[c]?"":"px")},cur:function(){var a=_a.propHooks[this.prop];return a&&a.get?a.get(this):_a.propHooks._default.get(this)},run:function(a){var b,c=_a.propHooks[this.prop];return this.options.duration?this.pos=b=r.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):_a.propHooks._default.set(this),this}},_a.prototype.init.prototype=_a.prototype,_a.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=r.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){r.fx.step[a.prop]?r.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[r.cssProps[a.prop]]&&!r.cssHooks[a.prop]?a.elem[a.prop]=a.now:r.style(a.elem,a.prop,a.now+a.unit)}}},_a.propHooks.scrollTop=_a.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},r.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},r.fx=_a.prototype.init,r.fx.step={};var ab,bb,cb=/^(?:toggle|show|hide)$/,db=/queueHooks$/;function eb(){bb&&(d.hidden===!1&&a.requestAnimationFrame?a.requestAnimationFrame(eb):a.setTimeout(eb,r.fx.interval),r.fx.tick())}function fb(){return a.setTimeout(function(){ab=void 0}),ab=r.now()}function gb(a,b){var c,d=0,e={height:a};for(b=b?1:0;d<4;d+=2-b)c=ca[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function hb(a,b,c){for(var d,e=(kb.tweeners[b]||[]).concat(kb.tweeners["*"]),f=0,g=e.length;f<g;f++)if(d=e[f].call(c,b,a))return d}function ib(a,b,c){var d,e,f,g,h,i,j,k,l="width"in b||"height"in b,m=this,n={},o=a.style,p=a.nodeType&&da(a),q=W.get(a,"fxshow");c.queue||(g=r._queueHooks(a,"fx"),null==g.unqueued&&(g.unqueued=0,h=g.empty.fire,g.empty.fire=function(){g.unqueued||h()}),g.unqueued++,m.always(function(){m.always(function(){g.unqueued--,r.queue(a,"fx").length||g.empty.fire()})}));for(d in b)if(e=b[d],cb.test(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}n[d]=q&&q[d]||r.style(a,d)}if(i=!r.isEmptyObject(b),i||!r.isEmptyObject(n)){l&&1===a.nodeType&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=q&&q.display,null==j&&(j=W.get(a,"display")),k=r.css(a,"display"),"none"===k&&(j?k=j:(ia([a],!0),j=a.style.display||j,k=r.css(a,"display"),ia([a]))),("inline"===k||"inline-block"===k&&null!=j)&&"none"===r.css(a,"float")&&(i||(m.done(function(){o.display=j}),null==j&&(k=o.display,j="none"===k?"":k)),o.display="inline-block")),c.overflow&&(o.overflow="hidden",m.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]})),i=!1;for(d in n)i||(q?"hidden"in q&&(p=q.hidden):q=W.access(a,"fxshow",{display:j}),f&&(q.hidden=!p),p&&ia([a],!0),m.done(function(){p||ia([a]),W.remove(a,"fxshow");for(d in n)r.style(a,d,n[d])})),i=hb(p?q[d]:0,d,m),d in q||(q[d]=i.start,p&&(i.end=i.start,i.start=0))}}function jb(a,b){var c,d,e,f,g;for(c in a)if(d=r.camelCase(c),e=b[d],f=a[c],Array.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=r.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function kb(a,b,c){var d,e,f=0,g=kb.prefilters.length,h=r.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=ab||fb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;g<i;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),f<1&&i?c:(i||h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:r.extend({},b),opts:r.extend(!0,{specialEasing:{},easing:r.easing._default},c),originalProperties:b,originalOptions:c,startTime:ab||fb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=r.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;c<d;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(jb(k,j.opts.specialEasing);f<g;f++)if(d=kb.prefilters[f].call(j,a,k,j.opts))return r.isFunction(d.stop)&&(r._queueHooks(j.elem,j.opts.queue).stop=r.proxy(d.stop,d)),d;return r.map(k,hb,j),r.isFunction(j.opts.start)&&j.opts.start.call(a,j),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always),r.fx.timer(r.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j}r.Animation=r.extend(kb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return fa(c.elem,a,ba.exec(b),c),c}]},tweener:function(a,b){r.isFunction(a)?(b=a,a=["*"]):a=a.match(L);for(var c,d=0,e=a.length;d<e;d++)c=a[d],kb.tweeners[c]=kb.tweeners[c]||[],kb.tweeners[c].unshift(b)},prefilters:[ib],prefilter:function(a,b){b?kb.prefilters.unshift(a):kb.prefilters.push(a)}}),r.speed=function(a,b,c){var d=a&&"object"==typeof a?r.extend({},a):{complete:c||!c&&b||r.isFunction(a)&&a,duration:a,easing:c&&b||b&&!r.isFunction(b)&&b};return r.fx.off?d.duration=0:"number"!=typeof d.duration&&(d.duration in r.fx.speeds?d.duration=r.fx.speeds[d.duration]:d.duration=r.fx.speeds._default),null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){r.isFunction(d.old)&&d.old.call(this),d.queue&&r.dequeue(this,d.queue)},d},r.fn.extend({fadeTo:function(a,b,c,d){return this.filter(da).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=r.isEmptyObject(a),f=r.speed(b,c,d),g=function(){var b=kb(this,r.extend({},a),f);(e||W.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=r.timers,g=W.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&db.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||r.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=W.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=r.timers,g=d?d.length:0;for(c.finish=!0,r.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<g;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),r.each(["toggle","show","hide"],function(a,b){var c=r.fn[b];r.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(gb(b,!0),a,d,e)}}),r.each({slideDown:gb("show"),slideUp:gb("hide"),slideToggle:gb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){r.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),r.timers=[],r.fx.tick=function(){var a,b=0,c=r.timers;for(ab=r.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||r.fx.stop(),ab=void 0},r.fx.timer=function(a){r.timers.push(a),r.fx.start()},r.fx.interval=13,r.fx.start=function(){bb||(bb=!0,eb())},r.fx.stop=function(){bb=null},r.fx.speeds={slow:600,fast:200,_default:400},r.fn.delay=function(b,c){return b=r.fx?r.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=d.createElement("input"),b=d.createElement("select"),c=b.appendChild(d.createElement("option"));a.type="checkbox",o.checkOn=""!==a.value,o.optSelected=c.selected,a=d.createElement("input"),a.value="t",a.type="radio",o.radioValue="t"===a.value}();var lb,mb=r.expr.attrHandle;r.fn.extend({attr:function(a,b){return T(this,r.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){r.removeAttr(this,a)})}}),r.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?r.prop(a,b,c):(1===f&&r.isXMLDoc(a)||(e=r.attrHooks[b.toLowerCase()]||(r.expr.match.bool.test(b)?lb:void 0)),void 0!==c?null===c?void r.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=r.find.attr(a,b),
null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!o.radioValue&&"radio"===b&&B(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d=0,e=b&&b.match(L);if(e&&1===a.nodeType)while(c=e[d++])a.removeAttribute(c)}}),lb={set:function(a,b,c){return b===!1?r.removeAttr(a,c):a.setAttribute(c,c),c}},r.each(r.expr.match.bool.source.match(/\w+/g),function(a,b){var c=mb[b]||r.find.attr;mb[b]=function(a,b,d){var e,f,g=b.toLowerCase();return d||(f=mb[g],mb[g]=e,e=null!=c(a,b,d)?g:null,mb[g]=f),e}});var nb=/^(?:input|select|textarea|button)$/i,ob=/^(?:a|area)$/i;r.fn.extend({prop:function(a,b){return T(this,r.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[r.propFix[a]||a]})}}),r.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&r.isXMLDoc(a)||(b=r.propFix[b]||b,e=r.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=r.find.attr(a,"tabindex");return b?parseInt(b,10):nb.test(a.nodeName)||ob.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),o.optSelected||(r.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),r.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){r.propFix[this.toLowerCase()]=this});function pb(a){var b=a.match(L)||[];return b.join(" ")}function qb(a){return a.getAttribute&&a.getAttribute("class")||""}r.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).addClass(a.call(this,b,qb(this)))});if("string"==typeof a&&a){b=a.match(L)||[];while(c=this[i++])if(e=qb(c),d=1===c.nodeType&&" "+pb(e)+" "){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=pb(d),e!==h&&c.setAttribute("class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).removeClass(a.call(this,b,qb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(L)||[];while(c=this[i++])if(e=qb(c),d=1===c.nodeType&&" "+pb(e)+" "){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=pb(d),e!==h&&c.setAttribute("class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):r.isFunction(a)?this.each(function(c){r(this).toggleClass(a.call(this,c,qb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=r(this),f=a.match(L)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=qb(this),b&&W.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||a===!1?"":W.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+pb(qb(c))+" ").indexOf(b)>-1)return!0;return!1}});var rb=/\r/g;r.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=r.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,r(this).val()):a,null==e?e="":"number"==typeof e?e+="":Array.isArray(e)&&(e=r.map(e,function(a){return null==a?"":a+""})),b=r.valHooks[this.type]||r.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=r.valHooks[e.type]||r.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(rb,""):null==c?"":c)}}}),r.extend({valHooks:{option:{get:function(a){var b=r.find.attr(a,"value");return null!=b?b:pb(r.text(a))}},select:{get:function(a){var b,c,d,e=a.options,f=a.selectedIndex,g="select-one"===a.type,h=g?null:[],i=g?f+1:e.length;for(d=f<0?i:g?f:0;d<i;d++)if(c=e[d],(c.selected||d===f)&&!c.disabled&&(!c.parentNode.disabled||!B(c.parentNode,"optgroup"))){if(b=r(c).val(),g)return b;h.push(b)}return h},set:function(a,b){var c,d,e=a.options,f=r.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=r.inArray(r.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),r.each(["radio","checkbox"],function(){r.valHooks[this]={set:function(a,b){if(Array.isArray(b))return a.checked=r.inArray(r(a).val(),b)>-1}},o.checkOn||(r.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var sb=/^(?:focusinfocus|focusoutblur)$/;r.extend(r.event,{trigger:function(b,c,e,f){var g,h,i,j,k,m,n,o=[e||d],p=l.call(b,"type")?b.type:b,q=l.call(b,"namespace")?b.namespace.split("."):[];if(h=i=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!sb.test(p+r.event.triggered)&&(p.indexOf(".")>-1&&(q=p.split("."),p=q.shift(),q.sort()),k=p.indexOf(":")<0&&"on"+p,b=b[r.expando]?b:new r.Event(p,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=q.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:r.makeArray(c,[b]),n=r.event.special[p]||{},f||!n.trigger||n.trigger.apply(e,c)!==!1)){if(!f&&!n.noBubble&&!r.isWindow(e)){for(j=n.delegateType||p,sb.test(j+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),i=h;i===(e.ownerDocument||d)&&o.push(i.defaultView||i.parentWindow||a)}g=0;while((h=o[g++])&&!b.isPropagationStopped())b.type=g>1?j:n.bindType||p,m=(W.get(h,"events")||{})[b.type]&&W.get(h,"handle"),m&&m.apply(h,c),m=k&&h[k],m&&m.apply&&U(h)&&(b.result=m.apply(h,c),b.result===!1&&b.preventDefault());return b.type=p,f||b.isDefaultPrevented()||n._default&&n._default.apply(o.pop(),c)!==!1||!U(e)||k&&r.isFunction(e[p])&&!r.isWindow(e)&&(i=e[k],i&&(e[k]=null),r.event.triggered=p,e[p](),r.event.triggered=void 0,i&&(e[k]=i)),b.result}},simulate:function(a,b,c){var d=r.extend(new r.Event,c,{type:a,isSimulated:!0});r.event.trigger(d,null,b)}}),r.fn.extend({trigger:function(a,b){return this.each(function(){r.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return r.event.trigger(a,b,c,!0)}}),r.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,b){r.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),r.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),o.focusin="onfocusin"in a,o.focusin||r.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){r.event.simulate(b,a.target,r.event.fix(a))};r.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=W.access(d,b);e||d.addEventListener(a,c,!0),W.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=W.access(d,b)-1;e?W.access(d,b,e):(d.removeEventListener(a,c,!0),W.remove(d,b))}}});var tb=a.location,ub=r.now(),vb=/\?/;r.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(d){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||r.error("Invalid XML: "+b),c};var wb=/\[\]$/,xb=/\r?\n/g,yb=/^(?:submit|button|image|reset|file)$/i,zb=/^(?:input|select|textarea|keygen)/i;function Ab(a,b,c,d){var e;if(Array.isArray(b))r.each(b,function(b,e){c||wb.test(a)?d(a,e):Ab(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==r.type(b))d(a,b);else for(e in b)Ab(a+"["+e+"]",b[e],c,d)}r.param=function(a,b){var c,d=[],e=function(a,b){var c=r.isFunction(b)?b():b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(null==c?"":c)};if(Array.isArray(a)||a.jquery&&!r.isPlainObject(a))r.each(a,function(){e(this.name,this.value)});else for(c in a)Ab(c,a[c],b,e);return d.join("&")},r.fn.extend({serialize:function(){return r.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=r.prop(this,"elements");return a?r.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!r(this).is(":disabled")&&zb.test(this.nodeName)&&!yb.test(a)&&(this.checked||!ja.test(a))}).map(function(a,b){var c=r(this).val();return null==c?null:Array.isArray(c)?r.map(c,function(a){return{name:b.name,value:a.replace(xb,"\r\n")}}):{name:b.name,value:c.replace(xb,"\r\n")}}).get()}});var Bb=/%20/g,Cb=/#.*$/,Db=/([?&])_=[^&]*/,Eb=/^(.*?):[ \t]*([^\r\n]*)$/gm,Fb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Gb=/^(?:GET|HEAD)$/,Hb=/^\/\//,Ib={},Jb={},Kb="*/".concat("*"),Lb=d.createElement("a");Lb.href=tb.href;function Mb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(L)||[];if(r.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Nb(a,b,c,d){var e={},f=a===Jb;function g(h){var i;return e[h]=!0,r.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Ob(a,b){var c,d,e=r.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&r.extend(!0,a,d),a}function Pb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}if(f)return f!==i[0]&&i.unshift(f),c[f]}function Qb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}r.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:tb.href,type:"GET",isLocal:Fb.test(tb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Kb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":r.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Ob(Ob(a,r.ajaxSettings),b):Ob(r.ajaxSettings,a)},ajaxPrefilter:Mb(Ib),ajaxTransport:Mb(Jb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m,n,o=r.ajaxSetup({},c),p=o.context||o,q=o.context&&(p.nodeType||p.jquery)?r(p):r.event,s=r.Deferred(),t=r.Callbacks("once memory"),u=o.statusCode||{},v={},w={},x="canceled",y={readyState:0,getResponseHeader:function(a){var b;if(k){if(!h){h={};while(b=Eb.exec(g))h[b[1].toLowerCase()]=b[2]}b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return k?g:null},setRequestHeader:function(a,b){return null==k&&(a=w[a.toLowerCase()]=w[a.toLowerCase()]||a,v[a]=b),this},overrideMimeType:function(a){return null==k&&(o.mimeType=a),this},statusCode:function(a){var b;if(a)if(k)y.always(a[y.status]);else for(b in a)u[b]=[u[b],a[b]];return this},abort:function(a){var b=a||x;return e&&e.abort(b),A(0,b),this}};if(s.promise(y),o.url=((b||o.url||tb.href)+"").replace(Hb,tb.protocol+"//"),o.type=c.method||c.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(L)||[""],null==o.crossDomain){j=d.createElement("a");try{j.href=o.url,j.href=j.href,o.crossDomain=Lb.protocol+"//"+Lb.host!=j.protocol+"//"+j.host}catch(z){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=r.param(o.data,o.traditional)),Nb(Ib,o,c,y),k)return y;l=r.event&&o.global,l&&0===r.active++&&r.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!Gb.test(o.type),f=o.url.replace(Cb,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(Bb,"+")):(n=o.url.slice(f.length),o.data&&(f+=(vb.test(f)?"&":"?")+o.data,delete o.data),o.cache===!1&&(f=f.replace(Db,"$1"),n=(vb.test(f)?"&":"?")+"_="+ub++ +n),o.url=f+n),o.ifModified&&(r.lastModified[f]&&y.setRequestHeader("If-Modified-Since",r.lastModified[f]),r.etag[f]&&y.setRequestHeader("If-None-Match",r.etag[f])),(o.data&&o.hasContent&&o.contentType!==!1||c.contentType)&&y.setRequestHeader("Content-Type",o.contentType),y.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"!==o.dataTypes[0]?", "+Kb+"; q=0.01":""):o.accepts["*"]);for(m in o.headers)y.setRequestHeader(m,o.headers[m]);if(o.beforeSend&&(o.beforeSend.call(p,y,o)===!1||k))return y.abort();if(x="abort",t.add(o.complete),y.done(o.success),y.fail(o.error),e=Nb(Jb,o,c,y)){if(y.readyState=1,l&&q.trigger("ajaxSend",[y,o]),k)return y;o.async&&o.timeout>0&&(i=a.setTimeout(function(){y.abort("timeout")},o.timeout));try{k=!1,e.send(v,A)}catch(z){if(k)throw z;A(-1,z)}}else A(-1,"No Transport");function A(b,c,d,h){var j,m,n,v,w,x=c;k||(k=!0,i&&a.clearTimeout(i),e=void 0,g=h||"",y.readyState=b>0?4:0,j=b>=200&&b<300||304===b,d&&(v=Pb(o,y,d)),v=Qb(o,v,y,j),j?(o.ifModified&&(w=y.getResponseHeader("Last-Modified"),w&&(r.lastModified[f]=w),w=y.getResponseHeader("etag"),w&&(r.etag[f]=w)),204===b||"HEAD"===o.type?x="nocontent":304===b?x="notmodified":(x=v.state,m=v.data,n=v.error,j=!n)):(n=x,!b&&x||(x="error",b<0&&(b=0))),y.status=b,y.statusText=(c||x)+"",j?s.resolveWith(p,[m,x,y]):s.rejectWith(p,[y,x,n]),y.statusCode(u),u=void 0,l&&q.trigger(j?"ajaxSuccess":"ajaxError",[y,o,j?m:n]),t.fireWith(p,[y,x]),l&&(q.trigger("ajaxComplete",[y,o]),--r.active||r.event.trigger("ajaxStop")))}return y},getJSON:function(a,b,c){return r.get(a,b,c,"json")},getScript:function(a,b){return r.get(a,void 0,b,"script")}}),r.each(["get","post"],function(a,b){r[b]=function(a,c,d,e){return r.isFunction(c)&&(e=e||d,d=c,c=void 0),r.ajax(r.extend({url:a,type:b,dataType:e,data:c,success:d},r.isPlainObject(a)&&a))}}),r._evalUrl=function(a){return r.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},r.fn.extend({wrapAll:function(a){var b;return this[0]&&(r.isFunction(a)&&(a=a.call(this[0])),b=r(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(a){return r.isFunction(a)?this.each(function(b){r(this).wrapInner(a.call(this,b))}):this.each(function(){var b=r(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=r.isFunction(a);return this.each(function(c){r(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){r(this).replaceWith(this.childNodes)}),this}}),r.expr.pseudos.hidden=function(a){return!r.expr.pseudos.visible(a)},r.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},r.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Rb={0:200,1223:204},Sb=r.ajaxSettings.xhr();o.cors=!!Sb&&"withCredentials"in Sb,o.ajax=Sb=!!Sb,r.ajaxTransport(function(b){var c,d;if(o.cors||Sb&&!b.crossDomain)return{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Rb[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}}),r.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),r.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return r.globalEval(a),a}}}),r.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),r.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(e,f){b=r("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&f("error"===a.type?404:200,a.type)}),d.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Tb=[],Ub=/(=)\?(?=&|$)|\?\?/;r.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Tb.pop()||r.expando+"_"+ub++;return this[a]=!0,a}}),r.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Ub.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ub.test(b.data)&&"data");if(h||"jsonp"===b.dataTypes[0])return e=b.jsonpCallback=r.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Ub,"$1"+e):b.jsonp!==!1&&(b.url+=(vb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||r.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?r(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Tb.push(e)),g&&r.isFunction(f)&&f(g[0]),g=f=void 0}),"script"}),o.createHTMLDocument=function(){var a=d.implementation.createHTMLDocument("").body;return a.innerHTML="<form></form><form></form>",2===a.childNodes.length}(),r.parseHTML=function(a,b,c){if("string"!=typeof a)return[];"boolean"==typeof b&&(c=b,b=!1);var e,f,g;return b||(o.createHTMLDocument?(b=d.implementation.createHTMLDocument(""),e=b.createElement("base"),e.href=d.location.href,b.head.appendChild(e)):b=d),f=C.exec(a),g=!c&&[],f?[b.createElement(f[1])]:(f=qa([a],b,g),g&&g.length&&r(g).remove(),r.merge([],f.childNodes))},r.fn.load=function(a,b,c){var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=pb(a.slice(h)),a=a.slice(0,h)),r.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&r.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?r("<div>").append(r.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},r.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){r.fn[b]=function(a){return this.on(b,a)}}),r.expr.pseudos.animated=function(a){return r.grep(r.timers,function(b){return a===b.elem}).length},r.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=r.css(a,"position"),l=r(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=r.css(a,"top"),i=r.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),r.isFunction(b)&&(b=b.call(a,c,r.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},r.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){r.offset.setOffset(this,a,b)});var b,c,d,e,f=this[0];if(f)return f.getClientRects().length?(d=f.getBoundingClientRect(),b=f.ownerDocument,c=b.documentElement,e=b.defaultView,{top:d.top+e.pageYOffset-c.clientTop,left:d.left+e.pageXOffset-c.clientLeft}):{top:0,left:0}},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===r.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),B(a[0],"html")||(d=a.offset()),d={top:d.top+r.css(a[0],"borderTopWidth",!0),left:d.left+r.css(a[0],"borderLeftWidth",!0)}),{top:b.top-d.top-r.css(c,"marginTop",!0),left:b.left-d.left-r.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&"static"===r.css(a,"position"))a=a.offsetParent;return a||ra})}}),r.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;r.fn[a]=function(d){return T(this,function(a,d,e){var f;return r.isWindow(a)?f=a:9===a.nodeType&&(f=a.defaultView),void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),r.each(["top","left"],function(a,b){r.cssHooks[b]=Pa(o.pixelPosition,function(a,c){if(c)return c=Oa(a,b),Ma.test(c)?r(a).position()[b]+"px":c})}),r.each({Height:"height",Width:"width"},function(a,b){r.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){r.fn[d]=function(e,f){var g=arguments.length&&(c||"boolean"!=typeof e),h=c||(e===!0||f===!0?"margin":"border");return T(this,function(b,c,e){var f;return r.isWindow(b)?0===d.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a]:9===b.nodeType?(f=b.documentElement,Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])):void 0===e?r.css(b,c,h):r.style(b,c,e,h)},b,g?e:void 0,g)}})}),r.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),r.holdReady=function(a){a?r.readyWait++:r.ready(!0)},r.isArray=Array.isArray,r.parseJSON=JSON.parse,r.nodeName=B,"function"==typeof define&&define.amd&&define("jquery",[],function(){return r});var Vb=a.jQuery,Wb=a.$;return r.noConflict=function(b){return a.$===r&&(a.$=Wb),b&&a.jQuery===r&&(a.jQuery=Vb),r},b||(a.jQuery=a.$=r),r});

// jQuery UI

(function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){function e(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}function i(t){for(var e,i;t.length&&t[0]!==document;){if(e=t.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,o)}function o(){t.datepicker._isDisabledDatepicker(m.inline?m.dpDiv.parent()[0]:m.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function a(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}function r(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.ui.version="1.12.1";var h=0,l=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},h=e.split(".")[0];e=e.split(".")[1];var l=h+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][l.toLowerCase()]=function(e){return!!t.data(e,l)},t[h]=t[h]||{},n=t[h][e],o=t[h][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(r[e]=s,void 0)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:h,widgetName:e,widgetFullName:l}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,s,n=l.call(arguments,1),o=0,a=n.length;a>o;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var o="string"==typeof n,a=l.call(arguments,1),r=this;return o?this.length||"instance"!==n?this.each(function(){var i,o=t.data(this,s);return"instance"===n?(r=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,a),i!==o&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; "+"attempted to call method '"+n+"'")}):r=void 0:(a.length&&(n=t.widget.extend.apply(null,[n].concat(a))),this.each(function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))})),r}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=h++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var a,r;for(r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+o.eventNamespace,c=h[2];c?n.on(l,c,r):i.on(l,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,o=Math.max,a=Math.abs,r=/left|center|right/,h=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,o=!s&&!n;return{element:i,isWindow:s,isDocument:n,offset:o?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=s(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):h.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=h.test(i[1])?i[1]:"center",t=l.exec(i[0]),e=l.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,h=t(this),l=h.outerWidth(),c=h.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=l+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),I=e(k.my,h.outerWidth(),h.outerHeight());"right"===n.my[0]?D.left-=l:"center"===n.my[0]&&(D.left-=l/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=I[0],D.top+=I[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:l,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+I[0],u[1]+I[1]],my:n.my,at:n.at,within:b,elem:h})}),n.using&&(r=function(t){var e=g.left-D.left,i=e+p-l,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:h,left:D.left,top:D.top,width:l,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};l>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),h.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,h=n-r,l=r+e.collisionWidth-a-n;e.collisionWidth>a?h>0&&0>=l?(i=t.left+h+e.collisionWidth-a-n,t.left+=h-i):t.left=l>0&&0>=h?n:h>l?n+a-e.collisionWidth:n:h>0?t.left+=h:l>0?t.left-=l:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,h=n-r,l=r+e.collisionHeight-a-n;e.collisionHeight>a?h>0&&0>=l?(i=t.top+h+e.collisionHeight-a-n,t.top+=h-i):t.top=l>0&&0>=h?n:h>l?n+a-e.collisionHeight:n:h>0?t.top+=h:l>0?t.top-=l:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=t.left-e.collisionPosition.marginLeft,c=l-h,u=l+e.collisionWidth-r-h,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-r-o,(0>i||a(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-h,(s>0||u>a(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=t.top-e.collisionPosition.marginTop,c=l-h,u=l+e.collisionHeight-r-h,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-r-o,(0>s||a(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-h,(i>0||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});var c="ui-effects-",u="ui-effects-style",d="ui-effects-animated",p=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(t,o){var a,r=o.re.exec(i),h=r&&o.parse(r),l=o.space||"rgba";return h?(a=s[l](h),s[c[l].cache]=a[c[l].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,a="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=l.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),l.fn=t.extend(l.prototype,{parse:function(n,a,r,h){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var u=this,d=t.type(n),p=this._rgba=[];return a!==e&&(n=[n,a,r,h],d="array"),"string"===d?this.parse(s(n)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof l?f(c,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):f(c,function(e,s){var o=s.cache;f(s.props,function(t,e){if(!u[o]&&s.to){if("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&0>t.inArray(null,u[o].slice(0,3))&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=l(t),s=!0,n=this;return f(c,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=l(t),n=s._space(),o=c[n],a=0===this.alpha()?l("transparent"):this,r=a[o.cache]||o.to(a._rgba),h=r.slice();return s=s[o.cache],f(o.props,function(t,n){var o=n.idx,a=r[o],l=s[o],c=u[n.type]||{};null!==l&&(null===a?h[o]=l:(c.mod&&(l-a>c.mod/2?a+=c.mod:a-l>c.mod/2&&(a-=c.mod)),h[o]=i((l-a)*e+a,n)))}),this[n](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(e)._rgba;return l(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(s,n,o),h=Math.min(s,n,o),l=r-h,c=r+h,u=.5*c;return e=h===r?0:s===r?60*(n-o)/l+360:n===r?60*(o-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=u?l/c:l/(2-c),[Math.round(e)%360,i,u,null==a?1:a]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],a=.5>=s?s*(1+i):s+i-s*i,r=2*s-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},f(c,function(s,n){var o=n.props,a=n.cache,h=n.to,c=n.from;l.fn[s]=function(s){if(h&&!this[a]&&(this[a]=h(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[a].slice();return f(o,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(n=l(c(d)),n[a]=d,n):l(d)},f(o,function(e,i){l.fn[e]||(l.fn[e]=function(n){var o,a=t.type(n),h="alpha"===e?this._hsla?"hsla":"rgba":s,l=this[h](),c=l[i.idx];return"undefined"===a?c:("function"===a&&(n=n.call(this,c),a=t.type(n)),null==n&&i.empty?this:("string"===a&&(o=r.exec(n),o&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=l(o||n),!d.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(h){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},l.hook(a),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(p),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,a={};for(s in i)o=i[s],e[s]!==o&&(n[s]||(t.fx.step[s]||!isNaN(parseFloat(o)))&&(a[s]=o));return a}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(p.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,a,r){var h=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",l=h.children?a.find("*").addBack():a;l=l.map(function(){var i=t(this);return{el:i,start:e(this)}}),o=function(){t.each(s,function(t,e){n[e]&&a[e+"Class"](n[e])})},o(),l=l.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),l=l.map(function(){var e=this,i=t.Deferred(),s=t.extend({},h,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,l.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),h.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}function s(t,e){var i=e.outerWidth(),s=e.outerHeight(),n=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,o=n.exec(t)||["",0,i,s,0];return{top:parseFloat(o[1])||0,right:"auto"===o[2]?i:parseFloat(o[2]),bottom:"auto"===o[3]?s:parseFloat(o[3]),left:parseFloat(o[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(d)||e(i)}}(t.expr.filters.animated)),t.uiBackCompat!==!1&&t.extend(t.effects,{save:function(t,e){for(var i=0,s=e.length;s>i;i++)null!==e[i]&&t.data(c+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,s=0,n=e.length;n>s;s++)null!==e[s]&&(i=t.data(c+e[s]),t.css(e[s],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).trigger("focus"),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,s){return s||(s=i,i="effect"),t.effects.effect[e]=s,t.effects.effect[e].mode=i,s},scaledDimensions:function(t,e,i){if(0===e)return{height:0,width:0,outerHeight:0,outerWidth:0};var s="horizontal"!==i?(e||100)/100:1,n="vertical"!==i?(e||100)/100:1;return{height:t.height()*n,width:t.width()*s,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*s}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var s=t.queue();e>1&&s.splice.apply(s,[1,0].concat(s.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(u,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(u)||"",t.removeData(u)},mode:function(t,e){var i=t.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),(i?"hide"===e:"show"===e)&&(e="none"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createPlaceholder:function(e){var i,s=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(s)&&(s="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),"float":e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(c+"placeholder",i)),e.css({position:s,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=c+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function i(){r.removeData(d),t.effects.cleanUp(r),"hide"===s.mode&&r.hide(),a()}function a(){t.isFunction(h)&&h.call(r[0]),t.isFunction(e)&&e()}var r=t(this);s.mode=c.shift(),t.uiBackCompat===!1||o?"none"===s.mode?(r[l](),a()):n.call(r[0],s,i):(r.is(":hidden")?"hide"===l:"show"===l)?(r[l](),a()):n.call(r[0],s,a)}var s=e.apply(this,arguments),n=t.effects.effect[s.effect],o=n.mode,a=s.queue,r=a||"fx",h=s.complete,l=s.mode,c=[],u=function(e){var i=t(this),s=t.effects.mode(i,l)||o;i.data(d,!0),c.push(s),o&&("show"===s||s===o&&"hide"===s)&&i.show(),o&&"none"===s||t.effects.saveStyle(i),t.isFunction(e)&&e()};return t.fx.off||!n?l?this[l](s.duration,h):this.each(function(){h&&h.call(this)}):a===!1?this.each(u).each(i):this.queue(r,u).queue(r,i)},show:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)
}}(t.fn.show),hide:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if(i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):s(this.css("clip"),this)},transfer:function(e,i){var s=t(this),n=t(e.to),o="fixed"===n.css("position"),a=t("body"),r=o?a.scrollTop():0,h=o?a.scrollLeft():0,l=n.offset(),c={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},u=s.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:u.top-r,left:u.left-h,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=s(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}();var f=t.effects;t.effects.define("blind","hide",function(e,i){var s={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=t(this),o=e.direction||"up",a=n.cssClip(),r={clip:t.extend({},a)},h=t.effects.createPlaceholder(n);r.clip[s[o][0]]=r.clip[s[o][1]],"show"===e.mode&&(n.cssClip(r.clip),h&&h.css(t.effects.clipToBox(r)),r.clip=a),h&&h.animate(t.effects.clipToBox(r),e.duration,e.easing),n.animate(r,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("bounce",function(e,i){var s,n,o,a=t(this),r=e.mode,h="hide"===r,l="show"===r,c=e.direction||"up",u=e.distance,d=e.times||5,p=2*d+(l||h?1:0),f=e.duration/p,g=e.easing,m="up"===c||"down"===c?"top":"left",_="up"===c||"left"===c,v=0,b=a.queue().length;for(t.effects.createPlaceholder(a),o=a.css(m),u||(u=a["top"===m?"outerHeight":"outerWidth"]()/3),l&&(n={opacity:1},n[m]=o,a.css("opacity",0).css(m,_?2*-u:2*u).animate(n,f,g)),h&&(u/=Math.pow(2,d-1)),n={},n[m]=o;d>v;v++)s={},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g).animate(n,f,g),u=h?2*u:u/2;h&&(s={opacity:0},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g)),a.queue(i),t.effects.unshift(a,b,p+1)}),t.effects.define("clip","hide",function(e,i){var s,n={},o=t(this),a=e.direction||"vertical",r="both"===a,h=r||"horizontal"===a,l=r||"vertical"===a;s=o.cssClip(),n.clip={top:l?(s.bottom-s.top)/2:s.top,right:h?(s.right-s.left)/2:s.right,bottom:l?(s.bottom-s.top)/2:s.bottom,left:h?(s.right-s.left)/2:s.left},t.effects.createPlaceholder(o),"show"===e.mode&&(o.cssClip(n.clip),n.clip=s),o.animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("drop","hide",function(e,i){var s,n=t(this),o=e.mode,a="show"===o,r=e.direction||"left",h="up"===r||"down"===r?"top":"left",l="up"===r||"left"===r?"-=":"+=",c="+="===l?"-=":"+=",u={opacity:0};t.effects.createPlaceholder(n),s=e.distance||n["top"===h?"outerHeight":"outerWidth"](!0)/2,u[h]=l+s,a&&(n.css(u),u[h]=c+s,u.opacity=1),n.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("explode","hide",function(e,i){function s(){b.push(this),b.length===u*d&&n()}function n(){p.css({visibility:"visible"}),t(b).remove(),i()}var o,a,r,h,l,c,u=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=u,p=t(this),f=e.mode,g="show"===f,m=p.show().css("visibility","hidden").offset(),_=Math.ceil(p.outerWidth()/d),v=Math.ceil(p.outerHeight()/u),b=[];for(o=0;u>o;o++)for(h=m.top+o*v,c=o-(u-1)/2,a=0;d>a;a++)r=m.left+a*_,l=a-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*_,top:-o*v}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:_,height:v,left:r+(g?l*_:0),top:h+(g?c*v:0),opacity:g?0:1}).animate({left:r+(g?0:l*_),top:h+(g?0:c*v),opacity:g?1:0},e.duration||500,e.easing,s)}),t.effects.define("fade","toggle",function(e,i){var s="show"===e.mode;t(this).css("opacity",s?0:1).animate({opacity:s?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("fold","hide",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=e.size||15,h=/([0-9]+)%/.exec(r),l=!!e.horizFirst,c=l?["right","bottom"]:["bottom","right"],u=e.duration/2,d=t.effects.createPlaceholder(s),p=s.cssClip(),f={clip:t.extend({},p)},g={clip:t.extend({},p)},m=[p[c[0]],p[c[1]]],_=s.queue().length;h&&(r=parseInt(h[1],10)/100*m[a?0:1]),f.clip[c[0]]=r,g.clip[c[0]]=r,g.clip[c[1]]=0,o&&(s.cssClip(g.clip),d&&d.css(t.effects.clipToBox(g)),g.clip=p),s.queue(function(i){d&&d.animate(t.effects.clipToBox(f),u,e.easing).animate(t.effects.clipToBox(g),u,e.easing),i()}).animate(f,u,e.easing).animate(g,u,e.easing).queue(i),t.effects.unshift(s,_,4)}),t.effects.define("highlight","show",function(e,i){var s=t(this),n={backgroundColor:s.css("backgroundColor")};"hide"===e.mode&&(n.opacity=0),t.effects.saveStyle(s),s.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("size",function(e,i){var s,n,o,a=t(this),r=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],c=e.mode,u="effect"!==c,d=e.scale||"both",p=e.origin||["middle","center"],f=a.css("position"),g=a.position(),m=t.effects.scaledDimensions(a),_=e.from||m,v=e.to||t.effects.scaledDimensions(a,0);t.effects.createPlaceholder(a),"show"===c&&(o=_,_=v,v=o),n={from:{y:_.height/m.height,x:_.width/m.width},to:{y:v.height/m.height,x:v.width/m.width}},("box"===d||"both"===d)&&(n.from.y!==n.to.y&&(_=t.effects.setTransition(a,h,n.from.y,_),v=t.effects.setTransition(a,h,n.to.y,v)),n.from.x!==n.to.x&&(_=t.effects.setTransition(a,l,n.from.x,_),v=t.effects.setTransition(a,l,n.to.x,v))),("content"===d||"both"===d)&&n.from.y!==n.to.y&&(_=t.effects.setTransition(a,r,n.from.y,_),v=t.effects.setTransition(a,r,n.to.y,v)),p&&(s=t.effects.getBaseline(p,m),_.top=(m.outerHeight-_.outerHeight)*s.y+g.top,_.left=(m.outerWidth-_.outerWidth)*s.x+g.left,v.top=(m.outerHeight-v.outerHeight)*s.y+g.top,v.left=(m.outerWidth-v.outerWidth)*s.x+g.left),a.css(_),("content"===d||"both"===d)&&(h=h.concat(["marginTop","marginBottom"]).concat(r),l=l.concat(["marginLeft","marginRight"]),a.find("*[width]").each(function(){var i=t(this),s=t.effects.scaledDimensions(i),o={height:s.height*n.from.y,width:s.width*n.from.x,outerHeight:s.outerHeight*n.from.y,outerWidth:s.outerWidth*n.from.x},a={height:s.height*n.to.y,width:s.width*n.to.x,outerHeight:s.height*n.to.y,outerWidth:s.width*n.to.x};n.from.y!==n.to.y&&(o=t.effects.setTransition(i,h,n.from.y,o),a=t.effects.setTransition(i,h,n.to.y,a)),n.from.x!==n.to.x&&(o=t.effects.setTransition(i,l,n.from.x,o),a=t.effects.setTransition(i,l,n.to.x,a)),u&&t.effects.saveStyle(i),i.css(o),i.animate(a,e.duration,e.easing,function(){u&&t.effects.restoreStyle(i)})})),a.animate(v,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=a.offset();0===v.opacity&&a.css("opacity",_.opacity),u||(a.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(a)),i()}})}),t.effects.define("scale",function(e,i){var s=t(this),n=e.mode,o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"effect"!==n?0:100),a=t.extend(!0,{from:t.effects.scaledDimensions(s),to:t.effects.scaledDimensions(s,o,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(a.from.opacity=1,a.to.opacity=0),t.effects.effect.size.call(this,a,i)}),t.effects.define("puff","hide",function(e,i){var s=t.extend(!0,{},e,{fade:!0,percent:parseInt(e.percent,10)||150});t.effects.effect.scale.call(this,s,i)}),t.effects.define("pulsate","show",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=o||a,h=2*(e.times||5)+(r?1:0),l=e.duration/h,c=0,u=1,d=s.queue().length;for((o||!s.is(":visible"))&&(s.css("opacity",0).show(),c=1);h>u;u++)s.animate({opacity:c},l,e.easing),c=1-c;s.animate({opacity:c},l,e.easing),s.queue(i),t.effects.unshift(s,d,h+1)}),t.effects.define("shake",function(e,i){var s=1,n=t(this),o=e.direction||"left",a=e.distance||20,r=e.times||3,h=2*r+1,l=Math.round(e.duration/h),c="up"===o||"down"===o?"top":"left",u="up"===o||"left"===o,d={},p={},f={},g=n.queue().length;for(t.effects.createPlaceholder(n),d[c]=(u?"-=":"+=")+a,p[c]=(u?"+=":"-=")+2*a,f[c]=(u?"-=":"+=")+2*a,n.animate(d,l,e.easing);r>s;s++)n.animate(p,l,e.easing).animate(f,l,e.easing);n.animate(p,l,e.easing).animate(d,l/2,e.easing).queue(i),t.effects.unshift(n,g,h+1)}),t.effects.define("slide","show",function(e,i){var s,n,o=t(this),a={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},r=e.mode,h=e.direction||"left",l="up"===h||"down"===h?"top":"left",c="up"===h||"left"===h,u=e.distance||o["top"===l?"outerHeight":"outerWidth"](!0),d={};t.effects.createPlaceholder(o),s=o.cssClip(),n=o.position()[l],d[l]=(c?-1:1)*u+n,d.clip=o.cssClip(),d.clip[a[h][1]]=d.clip[a[h][0]],"show"===r&&(o.cssClip(d.clip),o.css(l,d[l]),d.clip=s,d[l]=n),o.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:i})});var f;t.uiBackCompat!==!1&&(f=t.effects.define("transfer",function(e,i){t(this).transfer(e,i)})),t.ui.focusable=function(i,s){var n,o,a,r,h,l=i.nodeName.toLowerCase();return"area"===l?(n=i.parentNode,o=n.name,i.href&&o&&"map"===n.nodeName.toLowerCase()?(a=t("img[usemap='#"+o+"']"),a.length>0&&a.is(":visible")):!1):(/^(input|select|textarea|button|object)$/.test(l)?(r=!i.disabled,r&&(h=t(i).closest("fieldset")[0],h&&(r=!h.disabled))):r="a"===l?i.href||s:s,r&&t(i).is(":visible")&&e(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),s=this.attr("id"),s&&(e=this.eq(0).parents().last(),o=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||i>=0)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e,i,s=this.options.icons;s&&(e=t("<span>"),this._addClass(e,"ui-accordion-header-icon","ui-icon "+s.header),e.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,s.header)._addClass(i,null,s.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void 0)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,s=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),t(o).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),s=e.next(),n=s.uniqueId().attr("id");e.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===s&&(e=0,this.headers.next().each(function(){var i=t(this).is(":visible");i||t(this).show(),e=Math.max(e,t(this).css("height","").height()),i||t(this).hide()}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i,s,n=this.options,o=this.active,a=t(e.currentTarget),r=a[0]===o[0],h=r&&n.collapsible,l=h?t():a.next(),c=o.next(),u={oldHeader:o,oldPanel:c,newHeader:h?t():a,newPanel:l};e.preventDefault(),r&&!n.collapsible||this._trigger("beforeActivate",e,u)===!1||(n.active=h?!1:this.headers.index(a),this.active=r?t():a,this._toggle(u),this._removeClass(o,"ui-accordion-header-active","ui-state-active"),n.icons&&(i=o.children(".ui-accordion-header-icon"),this._removeClass(i,null,n.icons.activeHeader)._addClass(i,null,n.icons.header)),r||(this._removeClass(a,"ui-accordion-header-collapsed")._addClass(a,"ui-accordion-header-active","ui-state-active"),n.icons&&(s=a.children(".ui-accordion-header-icon"),this._removeClass(s,null,n.icons.header)._addClass(s,null,n.icons.activeHeader)),this._addClass(a.next(),"ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,s=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,e):(s.hide(),i.show(),this._toggleComplete(e)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var s,n,o,a=this,r=0,h=t.css("box-sizing"),l=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},u=l&&c.down||c,d=function(){a._toggleComplete(i)};return"number"==typeof u&&(o=u),"string"==typeof u&&(n=u),n=n||u.easing||c.easing,o=o||u.duration||c.duration,e.length?t.length?(s=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:n,step:function(t,e){e.now=Math.round(t)}}),t.hide().animate(this.showProps,{duration:o,easing:n,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===h&&(r+=i.now):"content"!==a.options.heightStyle&&(i.now=Math.round(s-e.outerHeight()-r),r=0)}}),void 0):e.animate(this.hideProps,o,n,d):t.animate(this.showProps,o,n,d)},_toggleComplete:function(t){var e=t.oldPanel,i=e.prev();this._removeClass(e,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),s=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),s=t(e.currentTarget);i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,s))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){var i=!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]));i&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var e=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),i=e.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,s,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:a=!1,s=this.previousFilter||"",o=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i,s,n,o,a=this,r=this.options.icons.submenu,h=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),s=h.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),s=t("<span>").data("ui-menu-submenu-caret",!0);a._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(s,"ui-menu","ui-widget ui-widget-content ui-front"),e=h.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);a._isDivider(e)&&a._addClass(e,"ui-menu-divider","ui-widget-content")}),n=i.not(".ui-menu-item, .ui-menu-divider"),o=n.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,s,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children(".ui-menu-item-wrapper"),this._addClass(s,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(e),void 0)},previousPage:function(e){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first())),void 0):(this.next(e),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;
this.isMultiLine=o||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,s=!0,i=!0,void 0;e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(e)return e=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,t.preventDefault(),void 0):(this._searchTimeout(t),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(t),this._change(t),void 0)}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,i){var s=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=s})),!1!==this._trigger("select",e,{item:s})&&this._value(s.value),this.term=this._value(),this.close(e),this.selectedItem=s}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!s)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[t](e),void 0):(this.search(null,e),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var g=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,n){var o,a={};return n?"controlgroupLabel"===s?(o=e.element.find(n),o.each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),i=i.concat(o.get()),void 0):(t.fn[s]&&(a=e["_"+s+"Options"]?e["_"+s+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),o=n[s]("instance"),r=t.widget.extend({},a);if("button"!==s||!n.parent(".ui-spinner").length){o||(o=n[s]()[s]("instance")),o&&(r.classes=e._resolveClassesValues(r.classes,o)),n[s](r);var h=n[s]("widget");t.data(h[0],"ui-controlgroup-data",o?o:n[s]("instance")),i.push(h[0])}})),void 0):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var i=t(this),s=i.data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,e){var i="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",s=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,i),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],s},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:e?"auto":!1,classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var s={};return t.each(e,function(n){var o=i.options.classes[n]||"";o=t.trim(o.replace(g,"")),s[n]=(o+" "+e[n]).replace(/\s+/g," ")}),s},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?(this._callChildMethod(e?"disable":"enable"),void 0):(this.refresh(),void 0)},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,s){var n=e[s]().data("ui-controlgroup-data");if(n&&i["_"+n.widgetName+"Options"]){var o=i["_"+n.widgetName+"Options"](1===e.length?"only":s);o.classes=i._resolveClassesValues(o.classes,n),n.element[n.widgetName](o)}else i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,s=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),e=this.element[0].disabled,null!=e&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e,i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(e=this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length}),e.not(this.element)):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),this.element[0].disabled=e,void 0):(this.refresh(),void 0)):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),t=this.element[0].disabled,null!=t&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var s="iconPosition"!==e,n=s?this.options.iconPosition:i,o="top"===n||"bottom"===n;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(n),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),t.uiBackCompat!==!1&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?(this._super("showLabel",e),void 0):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),this._superApply(arguments),void 0)}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.12.1"}});var m;t.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return a(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,o;s=e.nodeName.toLowerCase(),n="div"===s||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),n),o.settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){var s=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,o,a=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),a&&(i.append=t("<span class='"+this._appendClass+"'>"+a+"</span>"),e[r?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&e.on("focus",this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,s,n,o=new Date(2009,11,20),a=this._get(t,"dateFormat");a.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,n,o){var r,h,l,c,u,d=this._dialogInst;return d||(this.uuid+=1,r="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+r+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),a(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+c,l/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),m===n&&(m=null))},_enableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,s){var n,o,r,h,l=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):l?"all"===i?t.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),r=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),a(l.settings,n),null!==r&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,r)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),n[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]),i=t.datepicker._get(o,"onSelect"),i?(s=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,s,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(e){var i,s=t.datepicker._getInst(e.target);if(s.input.val()!==s.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s)),i&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var s,n,o,r,h,l,c;s=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==s&&(t.datepicker._curInst.dpDiv.stop(!0,!0),s&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(s,"beforeShow"),o=n?n.apply(e,[e,s]):{},o!==!1&&(a(s.settings,o),s.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(s),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),r=!1,t(e).parents().each(function(){return r|="fixed"===t(this).css("position"),!r}),h={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,s.dpDiv.empty(),s.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(s),h=t.datepicker._checkOffset(s,h,r),s.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":r?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),s.inline||(l=t.datepicker._get(s,"showAnim"),c=t.datepicker._get(s,"duration"),s.dpDiv.css("z-index",i(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?s.dpDiv.show(l,t.datepicker._get(s,"showOptions"),c):s.dpDiv[l||"show"](l?c:null),t.datepicker._shouldFocusInput(s)&&s.input.trigger("focus"),t.datepicker._curInst=s))
}},_updateDatepicker:function(e){this.maxRows=4,m=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,s=this._getNumberOfMonths(e),n=s[1],a=17,r=e.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-a:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+o>l&&l>o?Math.abs(o+r):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,o,a=this._curInst;!a||e&&a!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(a,"showAnim"),s=this._get(a,"duration"),n=function(){t.datepicker._tidyDialog(a)},t.effects&&(t.effects.effect[i]||t.effects[i])?a.dpDiv.hide(i,t.datepicker._get(a,"showOptions"),s,n):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,o=this._get(a,"onClose"),o&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,s,n){var o,a=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||(o=this._getInst(a[0]),o.selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),s=this._get(o,"onSelect"),s?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(e){var i,s,n,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(o).val(n))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,s){if(null==e||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,o,a,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),u=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,d=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,_=-1,v=-1,b=!1,y=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},w=function(t){var e=y(t),s="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?s:1,o=RegExp("^\\d{"+n+","+s+"}"),a=i.substring(h).match(o);if(!a)throw"Missing number at position "+h;return h+=a[0].length,parseInt(a[0],10)},k=function(e,s,n){var o=-1,a=t.map(y(e)?n:s,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(a,function(t,e){var s=e[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(o=e[0],h+=s.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+h},x=function(){if(i.charAt(h)!==e.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;e.length>n;n++)if(b)"'"!==e.charAt(n)||y("'")?x():b=!1;else switch(e.charAt(n)){case"d":_=w("d");break;case"D":k("D",u,d);break;case"o":v=w("o");break;case"m":m=w("m");break;case"M":m=k("M",p,f);break;case"y":g=w("y");break;case"@":r=new Date(w("@")),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"!":r=new Date((w("!")-this._ticksTo1970)/1e4),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"'":y("'")?x():b=!0;break;default:x()}if(i.length>h&&(a=i.substr(h),!/^\s+/.test(a)))throw"Extra/unparsed characters found in date: "+a;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c>=g?0:-100)),v>-1)for(m=1,_=v;;){if(o=this._getDaysInMonth(g,m-1),o>=_)break;m++,_-=o}if(r=this._daylightSavingAdjust(new Date(g,m-1,_)),r.getFullYear()!==g||r.getMonth()+1!==m||r.getDate()!==_)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(e){var i=t.length>s+1&&t.charAt(s+1)===e;return i&&s++,i},l=function(t,e,i){var s=""+e;if(h(t))for(;i>s.length;)s="0"+s;return s},c=function(t,e,i,s){return h(t)?s[e]:i[e]},u="",d=!1;if(e)for(s=0;t.length>s;s++)if(d)"'"!==t.charAt(s)||h("'")?u+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":u+=l("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,o);break;case"o":u+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=l("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),a,r);break;case"y":u+=h("y")?e.getFullYear():(10>e.getFullYear()%100?"0":"")+e.getFullYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":h("'")?u+="'":d=!0;break;default:u+=t.charAt(s)}return u},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=t.length>e+1&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;t.length>e;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,a=this._getFormatConfig(t);try{o=this.parseDate(i,s,a)||n}catch(r){s=e?"":s}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=s?o.getDate():0,t.currentMonth=s?o.getMonth():0,t.currentYear=s?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),a=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":a+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}l=h.exec(i)}return new Date(o,a,r)},a=null==i||""===i?s:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return a=a&&"Invalid Date"==""+a?s:a,a&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,o,a,r,h,l,c,u,d,p,f,g,m,_,v,b,y,w,k,x,C,D,I,T,P,M,S,H,z,O,A,N,W,E,F,L,R=new Date,B=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),Y=this._get(t,"isRTL"),j=this._get(t,"showButtonPanel"),q=this._get(t,"hideIfNoPrevNext"),K=this._get(t,"navigationAsDateFormat"),U=this._getNumberOfMonths(t),V=this._get(t,"showCurrentAtPos"),$=this._get(t,"stepMonths"),X=1!==U[0]||1!==U[1],G=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Z=t.drawMonth-V,te=t.drawYear;if(0>Z&&(Z+=12,te--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-U[0]*U[1]+1,J.getDate())),e=Q&&Q>e?Q:e;this._daylightSavingAdjust(new Date(te,Z,1))>e;)Z--,0>Z&&(Z=11,te--);for(t.drawMonth=Z,t.drawYear=te,i=this._get(t,"prevText"),i=K?this.formatDate(i,this._daylightSavingAdjust(new Date(te,Z-$,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,te,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":q?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=K?this.formatDate(n,this._daylightSavingAdjust(new Date(te,Z+$,1)),this._getFormatConfig(t)):n,o=this._canAdjustMonth(t,1,te,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":q?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?G:B,a=K?this.formatDate(a,r,this._getFormatConfig(t)):a,h=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",l=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(Y?"":h)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),_=this._get(t,"showOtherMonths"),v=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),y="",k=0;U[0]>k;k++){for(x="",this.maxRows=4,C=0;U[1]>C;C++){if(D=this._daylightSavingAdjust(new Date(te,Z,t.selectedDay)),I=" ui-corner-all",T="",X){if(T+="<div class='ui-datepicker-group",U[1]>1)switch(C){case 0:T+=" ui-datepicker-group-first",I=" ui-corner-"+(Y?"right":"left");break;case U[1]-1:T+=" ui-datepicker-group-last",I=" ui-corner-"+(Y?"left":"right");break;default:T+=" ui-datepicker-group-middle",I=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===k?Y?o:s:"")+(/all|right/.test(I)&&0===k?Y?s:o:"")+this._generateMonthYearHeader(t,Z,te,Q,J,k>0||C>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",P=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)M=(w+c)%7,P+="<th scope='col'"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+d[M]+"'>"+p[M]+"</span></th>";for(T+=P+"</tr></thead><tbody>",S=this._getDaysInMonth(te,Z),te===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,S)),H=(this._getFirstDayOfMonth(te,Z)-c+7)%7,z=Math.ceil((H+S)/7),O=X?this.maxRows>z?this.maxRows:z:z,this.maxRows=O,A=this._daylightSavingAdjust(new Date(te,Z,1-H)),N=0;O>N;N++){for(T+="<tr>",W=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(A)+"</td>":"",w=0;7>w;w++)E=m?m.apply(t.input?t.input[0]:null,[A]):[!0,""],F=A.getMonth()!==Z,L=F&&!v||!E[0]||Q&&Q>A||J&&A>J,W+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(A.getTime()===D.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===A.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!_?"":" "+E[1]+(A.getTime()===G.getTime()?" "+this._currentClass:"")+(A.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(F&&!_||!E[2]?"":" title='"+E[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+A.getMonth()+"' data-year='"+A.getFullYear()+"'")+">"+(F&&!_?"&#xa0;":L?"<span class='ui-state-default'>"+A.getDate()+"</span>":"<a class='ui-state-default"+(A.getTime()===B.getTime()?" ui-state-highlight":"")+(A.getTime()===G.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+A.getDate()+"</a>")+"</td>",A.setDate(A.getDate()+1),A=this._daylightSavingAdjust(A);T+=W+"</tr>"}Z++,Z>11&&(Z=0,te++),T+="</tbody></table>"+(X?"</div>"+(U[0]>0&&C===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=T}y+=x}return y+=l,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,o,a,r){var h,l,c,u,d,p,f,g,m=this._get(t,"changeMonth"),_=this._get(t,"changeYear"),v=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",y="";if(o||!m)y+="<span class='ui-datepicker-month'>"+a[e]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!h||c>=s.getMonth())&&(!l||n.getMonth()>=c)&&(y+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+r[c]+"</option>");y+="</select>"}if(v||(b+=y+(!o&&m&&_?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!_)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(u[0]),g=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),v&&(b+=(!o&&m&&_?"":"&#xa0;")+y),b+="</div>"},_adjustInstDate:function(t,e,i){var s=t.selectedYear+("Y"===i?e:0),n=t.selectedMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,o)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),a=null,r=null,h=this._get(t,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new s,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.1",t.datepicker,t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var _=!1;t(document).on("mouseup",function(){_=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!_){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),_=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,_=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]),s=t(e.target);s.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}
},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),h=t.pageX,l=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,h=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(h=this.originalPageX),"x"===a.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var n,o,a,r,h,l,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--)h=s.snapElements[d].left-s.margins.left,l=h+s.snapElements[d].width,c=s.snapElements[d].top-s.margins.top,u=c+s.snapElements[d].height,h-g>_||m>l+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(h-_),r=g>=Math.abs(l-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(h-m),r=g>=Math.abs(l-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles();break;default:}},_setupHandles:function(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)e=t.trim(s[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,h=this._change[o];return this._updatePrevProperties(),h?(i=h.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,h,l=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,h=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(a,{top:h,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,h=this.originalPosition.top+this.originalSize.height,l=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&l&&(t.left=r-e.minWidth),s&&l&&(t.left=r-e.maxWidth),a&&c&&(t.top=h-e.minHeight),n&&c&&(t.top=h-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-a},l=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(h,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,n,o,a,r,h=t(this).resizable("instance"),l=h.options,c=h.element,u=l.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(h.containerElement=t(d),/document/.test(u)||u===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=h._num(e.css("padding"+s))}),h.containerOffset=e.offset(),h.containerPosition=e.position(),h.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,o=h.containerSize.width,a=h._hasScroll(d,"left")?d.scrollWidth:o,r=h._hasScroll(d)?d.scrollHeight:n,h.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,h=a.containerOffset,l=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=h),l.left<(a._helper?h.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-h.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?h.left:0),l.top<(a._helper?h.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-h.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?h.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-h.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-h.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),h=a.outerWidth()-e.sizeDiff.width,l=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,c=h[1]||1,u=Math.round((n.width-o.width)/l)*l,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=h,_&&(p+=l),v&&(f+=c),g&&(p-=l),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-l)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-l>0?(i.size.width=p,i.position.left=a.left-u):(p=l-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog
},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&this._trigger("beforeClose",e)!==!1&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]),i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),this.close(e),void 0;if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){s.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?(this._removeClass(this.uiDialog,"ui-dialog-buttons"),void 0):(t.each(i,function(i,s){var n,o;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),n=s.click,o={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel,icons:s.icons,text:s.text},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,delete s.icons,"boolean"==typeof s.text&&delete s.text,t("<button></button>",s).button(o).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){var a=o.offset.left-i.document.scrollLeft(),r=o.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" "+"top"+(r>=0?"+":"")+r,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,n=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){var a=i.uiDialog.offset(),r=a.left-i.document.scrollLeft(),h=a.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var s,n,o=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&(s=o.is(":data(ui-draggable)"),s&&!i&&o.draggable("destroy"),!s&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(n=o.is(":data(ui-resizable)"),n&&!i&&o.resizable("destroy"),n&&"string"==typeof i&&o.resizable("option","handles",i),n||i===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return t(e.target).closest(".ui-dialog").length?!0:!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],void 0):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&v(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var v=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,h=a+e.helperProportions.height,l=i.offset.left,c=i.offset.top,u=l+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return o>=l&&u>=r&&a>=c&&d>=h;case"intersect":return o+e.helperProportions.width/2>l&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>h-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,l,i.proportions().width);case"touch":return(a>=c&&d>=a||h>=c&&d>=h||c>a&&h>d)&&(o>=l&&u>=o||r>=l&&u>=r||l>o&&r>u);default:return!1}}}();t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&v(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,a=v(e,this,this.options.tolerance,i),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n}),o.length&&(s=t(o[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),this._refreshValue(),void 0)},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,h=e.pageY;return o>r&&(i=r,r=o,o=i),a>h&&(i=h,h=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:h-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),l=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?l=!(c.left>r||o>c.right||c.top>h||a>c.bottom):"fit"===n.tolerance&&(l=c.left>o&&r>c.right&&c.top>a&&h>c.bottom),l?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.selectmenu",[t.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=t()},_drawButton:function(){var e,i=this,s=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=t("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(s).appendTo(this.button),this.options.width!==!1&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var s=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&s.index!==e.focusIndex&&(e._trigger("focus",t,{item:s}),e.isOpen||e._select(s,t)),e.focusIndex=s.index,e.button.attr("aria-activedescendant",e.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var t,e=this.element.find("option");this.menu.empty(),this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,e.length&&(t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t)))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var i=t("<span>");return this._setText(i,e.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(e,i){var s=this,n="";t.each(i,function(i,o){var a;o.optgroup!==n&&(a=t("<li>",{text:o.optgroup}),s._addClass(a,"ui-selectmenu-optgroup","ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),a.appendTo(e),n=o.optgroup),s._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var s=t("<li>"),n=t("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(s,null,"ui-state-disabled"),this._setText(n,i.label),s.append(n).appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),n+=":not(.ui-state-disabled)"),s="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](n).eq(-1):i[t+"All"](n).eq(0),s.length&&this.menuInstance.focus(e,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+t.ui.escapeSelector(this.ids.button)).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection(),t.rangeCount&&(this.range=t.getRangeAt(0))):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex).parent("li");e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(t)),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){if("icons"===t){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,e.button)}this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"width"===t&&this._resizeButton()},_setOptionDisabled:function(t){this._super(t),this.menuInstance.option("disabled",t),this.button.attr("aria-disabled",t),this._toggleClass(this.button,null,"ui-state-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;return t===!1?(this.button.css("width",""),void 0):(null===t&&(t=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(t),void 0)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var t=this._super();return t.disabled=this.element.prop("disabled"),t},_parseOptions:function(e){var i=this,s=[];e.each(function(e,n){s.push(i._parseOption(t(n),e))}),this.items=s},_parseOption:function(t,e){var i=t.parent("optgroup");return{element:t,index:e,value:t.val(),label:t.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||t.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1
},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle"),o="<span tabindex='0'></span>",a=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)a.push(o);this.handles=n.add(t(a.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,o,a,r,h,l,c=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-c.values(e));(n>i||n===i&&(e===c._lastChangedValue||c.values(e)===u.min))&&(n=i,o=t(this),a=e)}),r=this._start(e,a),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,this._addClass(o,null,"ui-state-active"),o.trigger("focus"),h=o.offset(),l=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-h.left-o.width()/2,top:e.pageY-h.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_uiHash:function(t,e,i){var s={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==e?e:this.values(t),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var s,n,o=this.value(),a=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),o=this.values(e),2===this.options.values.length&&this.options.range===!0&&(i=0===e?Math.min(n,i):Math.max(n,i)),a[e]=i),i!==o&&(s=this._trigger("slide",t,this._uiHash(e,i,a)),s!==!1&&(this._hasMultipleValues()?this.values(e,i):this.value(i)))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(e,i){var s,n,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),void 0;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(s=this.options.values,n=arguments[0],o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=n-1;s>=0;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,s=Math.round((t-e)/i)*i;t=s+e,t>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,c={};this._hasMultipleValues()?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),c["horizontal"===h.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[l?"animate":"css"](c,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?100*((s-n)/(o-n)):0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:100-i+"%"},r.animate),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:100-i+"%"},r.animate))},_handleEvents:{keydown:function(e){var i,s,n,o,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),i=this._start(e,a),i===!1))return}switch(o=this.options.step,s=n=this._hasMultipleValues()?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-o)}this._slide(e,a,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,h=r+t.height,l=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+l>r&&h>s+l,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&n;return o?(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1)):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],h=[],l=this._connectWith();if(l&&e)for(s=l.length-1;s>=0;s--)for(o=t(l[s],this.document[0]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&h.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,h,l,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,l=r.length;l>s;s++)h=t(r[s]),h.data(this.widgetName+"-item",a),c.push({item:h,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,h,l,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),a=c?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[a],l=!1,e[u]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(e[u]-h)&&(n=Math.abs(e[u]-h),o=this.items[s],this.direction=l?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;
this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);null!=n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",t),void 0)},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var e=this.element[0]===t.ui.safeActiveElement(this.document[0]);e||(this.element.trigger("focus"),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:(this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,s=this.options;return e=null!==s.min?s.min:0,i=t-e,i=Math.round(i/s.step)*s.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&s.min>t?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var i,s,n;return"culture"===t||"numberFormat"===t?(i=this._parse(this.element.val()),this.options[t]=e,this.element.val(this._format(i)),void 0):(("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(s=this.buttons.first().find(".ui-icon"),this._removeClass(s,null,this.options.icons.up),this._addClass(s,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),this._super(t,e),void 0)},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:r(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null===t?!1:t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:r(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:r(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:r(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:r(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?(r(this._value).call(this,t),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.uiBackCompat!==!1&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),t.ui.spinner,t.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,s;i=e.href.replace(t,""),s=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return e.hash.length>1&&i===s}}(),_create:function(){var e=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===e&&(s&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===s?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=this.tabs.length?0:!1)),e!==!1&&(e=this.tabs.index(this.tabs.eq(e)),-1===e&&(e=i?!1:0)),!i&&e===!1&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(t.ui.safeActiveElement(this.document[0])).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:s++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,s--;break;case t.ui.keyCode.END:s=this.anchors.length-1;break;case t.ui.keyCode.HOME:s=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}e.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function s(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(s(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).trigger("focus"),t},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):(this._super(t,e),"collapsible"===t&&(this._toggleClass("ui-tabs-collapsible",null,e),e||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(e),"heightStyle"===t&&this._setupHeightStyle(e),void 0)},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=t(),this.anchors.each(function(i,s){var n,o,a,r=t(s).uniqueId().attr("id"),h=t(s).closest("li"),l=h.attr("aria-controls");e._isLocal(s)?(n=s.hash,a=n.substring(1),o=e.element.find(e._sanitizeSelector(n))):(a=h.attr("aria-controls")||t({}).uniqueId()[0].id,n="#"+a,o=e.element.find(n),o.length||(o=e._createPanel(a),o.insertAfter(e.panels[i-1]||e.tablist)),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":a,"aria-labelledby":r}),o.attr("aria-labelledby",r)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var i,s,n;for(t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),n=0;s=this.tabs[n];n++)i=t(s),e===!0||-1!==t.inArray(n,e)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,e===!0)},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,s=this.element.parent();"fill"===e?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,s=this.active,n=t(e.currentTarget),o=n.closest("li"),a=o[0]===s[0],r=a&&i.collapsible,h=r?t():this._getPanelForTab(o),l=s.length?this._getPanelForTab(s):t(),c={oldTab:s,oldPanel:l,newTab:r?t():o,newPanel:h};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||this._trigger("beforeActivate",e,c)===!1||(i.active=r?!1:this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),l.length||h.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,i){function s(){o.running=!1,o._trigger("activate",e,i)}function n(){o._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,s):(a.show(),s())}var o=this,a=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){o._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),a.length&&r.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,s=this._findActive(e);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+t.ui.escapeSelector(e)+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;i!==!1&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setOptionDisabled(i))},disable:function(e){var i=this.options.disabled;if(i!==!0){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setOptionDisabled(i)}},load:function(e,i){e=this._getIndex(e);var s=this,n=this.tabs.eq(e),o=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),r={tab:n,panel:a},h=function(t,e){"abort"===e&&s.panels.stop(!1,!0),s._removeClass(n,"ui-tabs-loading"),a.removeAttr("aria-busy"),t===s.xhr&&delete s.xhr};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){a.html(t),s._trigger("load",i,r),h(n,e)},1)}).fail(function(t,e){setTimeout(function(){h(t,e)},1)})))},_ajaxSettings:function(e,i,s){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},s))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.uiBackCompat!==!1&&t.widget("ui.tabs",t.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),t.ui.tabs,t.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),s=t.trim(s.join(" ")),s?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=t([])},_setOption:function(e,i){var s=this;this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e.element)})},_setOptionDisabled:function(t){this[t?"_disable":"_enable"]()},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s.element[0],e.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=t(this);return e.is("[title]")?e.data("ui-tooltip-title",e.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=t([])},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(e,s),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s||s.nodeType||s.jquery?this._open(e,t,s):(i=s.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}),i&&this._open(e,t,i),void 0)},_open:function(e,i,s){function n(t){l.of=t,a.is(":hidden")||a.position(l)}var o,a,r,h,l=t.extend({},this.options.position);if(s){if(o=this._find(i))return o.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),a=o.tooltip,this._addDescribedBy(i,a.attr("id")),a.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),h=t("<div>").html(a.find(".ui-tooltip-content").html()),h.removeAttr("name").find("[name]").removeAttr("name"),h.removeAttr("id").find("[id]").removeAttr("id"),h.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):a.position(t.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){a.is(":visible")&&(n(l.of),clearInterval(r))},t.fx.interval)),this._trigger("open",e,{tooltip:a})}},_registerCloseHandlers:function(e,i){var s={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var s=t.Event(e);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(s.mouseleave="close"),e&&"focusin"!==e.type||(s.focusout="close"),this._on(!0,i,s)},close:function(e){var i,s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1)),void 0):(n.removeData("ui-tooltip-open"),void 0)},_tooltip:function(e){var i=t("<div>").attr("role","tooltip"),s=t("<div>").appendTo(i),n=i.uniqueId().attr("id");return this._addClass(s,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(e)),this.tooltips[n]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_appendTo:function(t){var e=t.closest(".ui-front, dialog");return e.length||(e=this.document[0].body),e},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur"),o=s.element;n.target=n.currentTarget=o[0],e.close(n,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),t.uiBackCompat!==!1&&t.widget("ui.tooltip",t.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var t=this._superApply(arguments);return this.options.tooltipClass&&t.tooltip.addClass(this.options.tooltipClass),t}}),t.ui.tooltip});

// Parsedown (Javascript version of https://github.com/erusev/parsedown made specifically for SteamGifts)

Parsedown = (() => {
    // functions taken from http://locutus.io/

    function rtrim(string, charList) {
        charList = !charList ? ` \\s\u00A0` : `${charList}`.replace(/([[\]().?/*{}+$^:])/g, `\\$1`);
        return `${string}`.replace(new RegExp(`[${charList}]+$`, `g`), ``);
    }

    function trim(string, charList) {
        let i, n, whiteSpace;
        string += ``;
        whiteSpace = ` \n\r\t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000`;
        if (charList) {
            whiteSpace = `${charList}`.replace(/([[\]().?/*{}+$^:])/g, `$1`);
        }
        for (i = 0, n = string.length; i < n; ++i) {
            if (whiteSpace.indexOf(string.charAt(i)) === -1) {
                string = string.substring(i);
                break
            }
        }
        for (i = string.length - 1; i > -1; --i) {
            if (whiteSpace.indexOf(string.charAt(i)) === -1) {
                string = string.substring(0, i + 1)
                break
            }
        }
        return whiteSpace.indexOf(string.charAt(0)) === -1 ? string : ``;
    }

    function strlen(string) {
        string = `${string}`;
        getWholeChar = (string, i) => {
            let code, next, prev;
            code = string.charCodeAt(i);
            next = prev = ``;
            if (code >= 0xD800 && code <= 0xDBFF) {
                if (string.length <= i + 1) {
                    throw new Error(`High surrogate without following low surrogate`);
                }
                next = string.charCodeAt(i + 1);
                if (next < 0xDC00 || next > 0xDFFF) {
                    throw new Error(`High surrogate without following low surrogate`);
                }
                return string.charAt(i) + string.charAt(i + 1);
            } else if (code >= 0xDC00 && code <= 0xDFFF) {
                if (i === 0) {
                    throw new Error(`Low surrogate without preceding high surrogate`);
                }
                prev = string.charCodeAt(i - 1);
                if (prev < 0xD800 || prev > 0xDBFF) {
                    throw new Error(`Low surrogate without preceding high surrogate`);
                }
                return false;
            }
            return string.charAt(i);
        };
        let i, length;
        length = 0;
        for (i = 0, n = string.length; i < n; ++i) {
            if ((getWholeChar(string, i)) === false) {
                continue
            }
            length += 1;
        }
        return length;
    }

    function strpbrk(string, charList) {
        let i, n;
        for (i = 0, n = string.length; i < n; ++i) {
            if (charList.indexOf(string.charAt(i)) >= 0) {
                return string.slice(i);
            }
        }
        return false;
    }

    let methods, variables;
    variables = {
        blockTypes: {
            [`#`]: [`Header`],
            [`*`]: [`Rule`, `List`],
            [`+`]: [`List`],
            [`-`]: [`SetextHeader`, `Table`, `Rule`, `List`],
            [`0`]: [`List`],
            [`1`]: [`List`],
            [`2`]: [`List`],
            [`3`]: [`List`],
            [`4`]: [`List`],
            [`5`]: [`List`],
            [`6`]: [`List`],
            [`7`]: [`List`],
            [`8`]: [`List`],
            [`9`]: [`List`],
            [`:`]: [`Table`],
            [`<`]: [`Comment`, `Markup`],
            [`=`]: [`SetextHeader`],
            [`>`]: [`Quote`],
            [`[`]: [`Reference`],
            [`_`]: [`Rule`],
            [`\``]: [`FencedCode`],
            [`|`]: [`Table`],
            [`~`]: [`FencedCode`]
        },
        breaksEnabled: false,
        definitionData: {},
        emRegex: {
            [`*`]: /^[*]((?:\\\\\*|[^*]|[*][*][^*]+?[*][*])+?)[*](?![*])/,
            [`_`]: /^_((?:\\\\_|[^_]|__[^_]*__)+?)_(?!_)\b/u
        },
        inlineMarkerList: `!"*_&[:<>\`~\\`,
        inlineTypes: {
            [`"`]: [`SpecialCharacter`],
            [`!`]: [`Image`],
            [`&`]: [`SpecialCharacter`],
            [`*`]: [`Emphasis`],
            [`:`]: [`Url`],
            [`<`]: [`UrlTag`, `EmailTag`, `Markup`, `SpecialCharacter`],
            [`>`]: [`SpecialCharacter`],
            [`[`]: [`Link`],
            [`_`]: [`Emphasis`],
            [`\``]: [`Code`],
            [`~`]: [`Strikethrough`],
            [`\\`]: [`EscapeSequence`],
        },
        markupEscaped: false,
        regexHtmlAttribute: `[a-zA-Z_:][\w:.-]*(?:\s*=\s*(?:[^"\'=<>\`\s]+|"[^"]*"|\'[^\']*\'))?`,
        specialCharacters: [`\\`, `\``, `*`, `_`, `{`, `}`, `[`, `]`, `(`, `)`, `>`, `#`, `+`, `-`, `.`, `!`, `|`],
        strongRegex: {
            [`*`]: /^[*]{2}((?:\\\\\*|[^*]|[*][^*]*[*])+?)[*]{2}(?![*])/,
            [`_`]: /^__((?:\\\\_|[^_]|_[^_]*_)+?)__(?!_)/u
        },
        textLevelElements: [
            `a`, `br`, `bdo`, `abbr`, `blink`, `nextid`, `acronym`, `basefont`,
            `b`, `em`, `big`, `cite`, `small`, `spacer`, `listing`,
            `i`, `rp`, `del`, `code`,          `strike`, `marquee`,
            `q`, `rt`, `ins`, `font`,          `strong`,
            `s`, `tt`, `kbd`, `mark`,
            `u`, `xm`, `sub`, `nobr`,
                       `sup`, `ruby`,
                       `var`, `span`,
                       `wbr`, `time`
        ],
        unmarkedBlockTypes: [`Code`],
        urlsLinked: true,
        voidElements: [`area`, `base`, `br`, `col`, `command`, `embed`, `hr`, `img`, `input`, `link`, `meta`, `param`, `source`]
    };
    methods = {
        lines: lines => {
            let block, blocks, blockType, blockTypes, currentBlock, i, j, indent, line, marker, markup, n1, n2, parts, text;
            currentBlock = null;
            blocks = [];
            main: for (i = 0, n1 = lines.length; i < n1; ++i) {
                line = lines[i];
                if (rtrim(line) === ``) {
                    if (methods.isSet(currentBlock)) {
                        currentBlock.interrupted = true;
                    }
                    continue;
                }
                if (line.indexOf(`\t`) > -1) {
                    parts = line.split(`\t`);
                    line = parts.shift();
                    parts.forEach(part => {
                        line += `${` `.repeat(4 - line.length % 4)}${part}`; // original method: mb_strlen with UTF-8
                    });
                }
                indent = 0;
                while (methods.isSet(line[indent]) && line[indent] === ` `) {
                    indent += 1;
                }
                text = indent > 0 ? line.slice(indent) : line;
                line = {
                    body: line,
                    indent: indent,
                    text: text
                };
                if (methods.isSet(currentBlock) && methods.isSet(currentBlock.continuable)) {
                    block = methods[`block${currentBlock.type}Continue`](line, currentBlock);
                    if (methods.isSet(block)) {
                        currentBlock = block;
                        continue;
                    } else if (methods.isBlockCompletable(currentBlock.type)) {
                        currentBlock = methods[`block${currentBlock.type}Complete`](currentBlock);
                    }
                }
                marker = text[0];
                blockTypes = variables.unmarkedBlockTypes.slice(0);
                if (methods.isSet(variables.blockTypes[marker])) {
                    variables.blockTypes[marker].forEach(blockType => {
                        blockTypes.push(blockType);
                    });
                }
                for (j = 0, n2 = blockTypes.length; j < n2; ++j) {
                    blockType = blockTypes[j];
                    block = methods[`block${blockType}`](line, currentBlock);
                    if (methods.isSet(block)) {
                        block.type = blockType;
                        if (!methods.isSet(block.identified)) {
                            blocks.push(currentBlock);
                            block.identified = true;
                        }
                        if (methods.isBlockContinuable(blockType)) {
                            block.continuable = true;
                        }
                        currentBlock = block;
                        continue main;
                    }
                }
                if (methods.isSet(currentBlock) && !methods.isSet(currentBlock.type) && !methods.isSet(currentBlock.interrupted)) {
                    currentBlock.element.text += `\n${text}`;
                } else {
                    blocks.push(currentBlock);
                    currentBlock = methods.paragraph(line);
                    currentBlock.identified = true;
                }
            }
            if (methods.isSet(currentBlock) && methods.isSet(currentBlock.continuable) && methods.isBlockCompletable(currentBlock.type)) {
                currentBlock = methods[`block${currentBlock.type}Complete`](currentBlock);
            }
            blocks.push(currentBlock);
            blocks.shift();
            markup = ``;
            for (i = 0, n1 = blocks.length; i < n1; ++i) {
                block = blocks[i];
                if (methods.isSet(block.hidden)) {
                    continue;
                }
                markup += `\n${methods.isSet(block.markup) ? block.markup : methods.element(block.element)}`;
            }
            markup += `\n`;
            return markup;
        },
        isBlockContinuable: type => {
            return typeof methods[`block${type}Continue`] !== `undefined`;
        },
        isBlockCompletable: type => {
            return typeof methods[`block${type}Complete`] !== `undefined`;
        },
        isSet: element => {
            return typeof element !== `undefined` && element !== null;
        },
        blockCode: (line, block = null) => {
            if (methods.isSet(block) && !methods.isSet(block.type) && !methods.isSet(block.interrupted)) {
                return;
            }
            if (line.indent >= 4) {
                return {
                    element: {
                        handler: `element`,
                        name: `pre`,
                        text: {
                            name: `code`,
                            text: line.body.slice(4)
                        }
                    }
                };
            }
        },
        blockCodeContinue: (line, block) => {
            if (line.indent >= 4) {
                if (methods.isSet(block.interrupted)) {
                    block.element.text.text += `\n`;
                    delete block.interrupted;
                }
                block.element.text.text += `\n${line.body.slice(4)}`;
                return block;
            }
        },
        blockCodeComplete: block => {
            block.element.text.text = block.element.text.text.replace(/</g, `&lt;`).replace(/>/g, `&gt;`);
            return block;
        },
        blockComment: line => {
            if (variables.markupEscaped) {
                return;
            }
            if (methods.isSet(line.text[3]) && line.text[3] === `-` && line.text[2] === `-` && line.text[1] === `!`) {
                let block = {
                    markup: line.body
                };
                if (line.text.match(/-->$/)) {
                    block.closed = true;
                }
                return block;
            }
        },
        blockCommentContinue: (line, block) => {
            if (methods.isSet(block.closed)) {
                return;
            }
            block.markup += `\n${line.body}`;
            if (line.text.match(/-->$/)) {
                block.closed = true;
            }
            return block;
        },
        blockFencedCode: line => {
            let matches = line.text.match(new RegExp(`^[${line.text[0]}]{3,}[ ]*([\w-]+)?[ ]*$`));
            if (matches) {
                let element = {
                    name: `code`,
                    text: ``
                };
                if (methods.isSet(matches[1])) {
                    element.attributes = {
                        class: `language-${matches[1]}`
                    };
                }
                return {
                    char: line.text[0],
                    element: {
                        handler: `element`,
                        name: `pre`,
                        text: element
                    }
                };
            }
        },
        blockFencedCodeContinue: (line, block) => {
            if (methods.isSet(block.complete)) {
                return;
            }
            if (methods.isSet(block.interrupted)) {
                block.element.text.text += `\n`;
                delete block.interrupted;
            }
            if (line.text.match(new RegExp(`^${block.char}{3,}[ ]*$`))) {
                block.element.text.text = block.element.text.text.slice(1);
                block.complete = true;
                return block;
            }
            block.element.text.text += `\n${line.body}`;
            return block;
        },
        blockFencedCodeComplete: block => {
            block.element.text.text = block.element.text.text.replace(/</g, `&lt;`).replace(/>/g, `&gt;`);
            return block;
        },
        blockHeader: line => {
            if (methods.isSet(line.text[1])) {
                let level = 1;
                while (methods.isSet(line.text[level]) && line.text[level] === `#`) {
                    level += 1;
                }
                if (level > 6) {
                    return;
                }
                return {
                    element: {
                        handler: `line`,
                        name: `h${Math.min(6, level)}`,
                        text: trim(line.text, `# `)
                    }
                };
            }
        },
        blockList: line => {
            let matches, name, pattern;
            [name, pattern] = line.text[0] <= `-` ? [`ul`, `[*+-]`] : [`ol`, `[0-9]+[.]`];
            matches = line.text.match(new RegExp(`^(${pattern}[ ]+)(.*)`));
            if (matches) {
                let block = {
                    element: {
                        handler: `elements`,
                        name: name
                    },
                    indent: line.indent,
                    pattern: pattern
                };
                if (name === `ol`) {
                    let listStart = matches[0].slice(0, matches[0].indexOf(`.`));
                    if (listStart !== `1`) {
                        block.element.attributes = {
                            start: listStart
                        };
                    }
                }
                block.li = {
                    handler: `li`,
                    name: `li`,
                    text: [matches[2]]
                };
                block.element.text = [block.li]; // original attribution: []= &
                return block;
            }
        },
        blockListContinue: (line, block) => {
            let matches = line.text.match(new RegExp(`^${block.pattern}(?:[ ]+(.*)|$)`));
            if (block.indent === line.indent && matches) {
                if (methods.isSet(block.interrupted)) {
                    block.li.text.push(``);
                    delete block.interrupted;
                }
                delete block.li;
                block.li = {
                    handler: `li`,
                    name: `li`,
                    text: [methods.isSet(matches[1]) ? matches[1] : ``]
                };
                block.element.text.push(block.li);
                return block;
            }
            if (line.text[0] === `[` && methods.blockReference(line)) {
                return block;
            }
            if (!methods.isSet(block.interrupted)) {
                block.li.text.push(line.body.replace(/^[ ]{0,4}/, ``));
                return block;
            }
            if (line.indent > 0) {
                block.li.text.push(``);
                block.li.text.push(line.body.replace(/^[ ]{0,4}/, ``));
                delete block.interrupted;
                return block;
            }
        },
        blockQuote: line => {
            let matches = line.text.match(/^>[ ]?(.*)/);
            if (matches) {
                return {
                    element: {
                        handler: `lines`,
                        name: `blockquote`,
                        text: [matches[1]]
                    }
                };
            }
        },
        blockQuoteContinue: (line, block) => {
            let matches = line.text.match(/^>[ ]?(.*)/);
            if (line.text[0] === `>` && matches) {
                if (methods.isSet(block.interrupted)) {
                    block.element.text.push(``);
                    delete block.interrupted;
                }
                block.element.text.push(matches[1]);
                return block;
            }
            if (!methods.isSet(block.interrupted)) {
                block.element.text.push(line.text);
                return block;
            }
        },
        blockRule: line => {
            if (line.text.match(new RegExp(`^([${line.text[0]}])([ ]*\\1){2,}[ ]*$`))) {
                return {
                    element: {
                        name: `hr`
                    }
                };
            }
        },
        blockSetextHeader: (line, block = null) => {
            if (!methods.isSet(block) || methods.isSet(block.type) || methods.isSet(block.interrupted)) {
                return;
            }
            if (rtrim(line.text, line.text[0]) === ``) {
                block.element.name = line.text[0] === `=` ? `h1` : `h2`;
                return block;
            }
        },
        blockMarkup: line => {
            if (variables.markupEscaped) {
                return;
            }
            let matches = line.text.match(new RegExp(`^<(\w*)(?:[ ]*${variables.regexHtmlAttribute})*[ ]*(\/)?>`));
            if (matches) {
                if (variables.textLevelElements.indexOf(matches[1].toLowerCase()) > -1) {
                    return;
                }
                let block, remainder;
                block = {
                    depth: 0,
                    markup: line.text,
                    name: matches[1]
                };
                remainder = line.text.slice(strlen(matches[0]));
                if (trim(remainder) === ``) {
                    if (methods.isSet(matches[2]) || variables.voidElements.indexOf(matches[1]) > -1) {
                        block.closed = true;
                        block.void = true;
                    }
                } else {
                    if (methods.isSet(matches[2]) || variables.voidElements.indexOf(matches[1]) > -1) {
                        return;
                    }
                    if (remainder.match(new RegExp(`<\/${matches[1]}>[ ]*$`, `i`))) {
                        block.closed = true;
                    }
                }
                return block;
            }
        },
        blockMarkupContinue: (line, block) => {
            if (methods.isSet(block.closed)) {
                return;
            }
            if (line.text.match(new RegExp(`^<${block.name}(?:[ ]*${variables.regexHtmlAttribute})*[ ]*>`, `i`))) {
                block.depth += 1;
            }
            let matches = line.text.match(new RegExp(`(.*?)<\/${block.name}>[ ]*$`, `i`));
            if (matches) {
                if (block.depth > 0) {
                    block.depth -= 1;
                } else {
                    block.closed = true;
                }
            }
            if (methods.isSet(block.interrupted)) {
                block.markup += `\n`;
                delete block.interrupted;
            }
            block.markup += `\n${line.body}`;
            return block;
        },
        blockReference: line=> {
            let matches = line.text.match(/^\[(.+?)\]:[ ]*<?(\S+?)>?(?:[ ]+["\'(](.+)["\')])?[ ]*$/);
            if (matches) {
                let data = {
                    title: null,
                    url: matches[2]
                };
                if (methods.isSet(matches[3])) {
                    data.title = matches[3];
                }
                variables.definitionData.Reference[matches[1].toLowerCase()] = data;
                return {
                    hidden: true
                };
            }
        },
        blockTable: (line, block = null) => {
            if (!methods.isSet(block) || methods.isSet(block.type) || methods.isSet(block.interrupted)) {
                return;
            }
            if (block.element.text.indexOf(`|`) > -1 && rtrim(line.text, ` -:|`) === ``) {
                let alignment, alignments, dividerCell, dividerCells, headerCell, headerCells, headerElement, headerElements, i, n;
                alignments = [];
                dividerCells = trim(trim(line.text), `|`).split(`|`);
                for (i = 0, n = dividerCells.length; i < n; ++i) {
                    dividerCell = trim(dividerCells[i]);
                    if (dividerCell === ``) {
                        continue;
                    }
                    alignment = null;
                    if (dividerCell[0] === `:`) {
                        alignment = `left`;
                    }
                    if (dividerCell.slice(-1) === `:`) {
                        alignment = alignment === `left` ? `center` : `right`;
                    }
                    alignments.push(alignment);
                }
                headerElements = [];
                headerCells = trim(trim(block.element.text), `|`).split(`|`);
                for (i = 0, n = headerCells.length; i < n; ++i) {
                    headerCell = trim(headerCells[i]);
                    headerElement = {
                        handler: `line`,
                        name: `th`,
                        text: headerCell
                    };
                    if (methods.isSet(alignments[i])) {
                        alignment = alignments[i];
                        headerElement.attributes = {
                            style: `text-align: ${alignment};`
                        };
                    }
                    headerElements.push(headerElement);
                }
                block = {
                    alignments: alignments,
                    element: {
                        handler: `elements`,
                        name: `table`,
                        text: []
                    },
                    identified: true
                };
                block.element.text.push({
                    handler: `elements`,
                    name: `thead`,
                    text: []
                });
                block.element.text.push({
                    handler: `elements`,
                    name: `tbody`,
                    text: []
                });
                block.element.text[0].text.push({
                    handler: `elements`,
                    name: `tr`,
                    text: headerElements,
                });
                return block;
            }
        },
        blockTableContinue: (line, block) => {
            if (methods.isSet(block.interrupted)) {
                return;
            }
            if (line.text[0] === `|` || line.text.indexOf(`|`) > -1) {
                let element, elements, i, matches, n;
                elements = [];
                matches = trim(trim(line.text), `|`).match(/(?:(\\\\[|])|[^|`]|`[^`]+`|`)+/g);
                for (i = 0, n = matches.length; i < n; ++i) {
                    element = {
                        handler: `line`,
                        name: `td`,
                        text: trim(matches[i])
                    };
                    if (methods.isSet(block.alignments[i])) {
                        element.attributes = {
                            style: `text-align: ${block.alignments[i]};`
                        };
                    }
                    elements.push(element);
                }
                element = {
                    handler: `elements`,
                    name: `tr`,
                    text: elements,
                };
                block.element.text[1].text.push(element);
                return block;
            }
        },
        paragraph: line => {
            return {
                element: {
                    handler: `line`,
                    name: `p`,
                    text: line.text
                }
            };
        },
        line: text => {
            let excerpt, i, inline, inlineType, marker, markerPosition, markup, n;
            markup = ``;
            main: while (excerpt = strpbrk(text, variables.inlineMarkerList)) {
                marker = excerpt[0];
                markerPosition = text.indexOf(marker);
                excerpt = {
                    context: text,
                    text: excerpt
                };
                for (i = 0, n = variables.inlineTypes[marker].length; i < n; ++i) {
                    inlineType = variables.inlineTypes[marker][i];
                    inline = methods[`inline${inlineType}`](excerpt);
                    if (!methods.isSet(inline)) {
                        continue;
                    }
                    if (methods.isSet(inline.position) && inline.position > markerPosition) {
                        continue;
                    }
                    if (!methods.isSet(inline.position)) {
                        inline.position = markerPosition;
                    }
                    markup += `${methods.unmarkedText(text.slice(0, inline.position))}${methods.isSet(inline.markup) ? inline.markup : methods.element(inline.element)}`;
                    text = text.slice(inline.position + inline.extent);
                    continue main;
                }
                markup += methods.unmarkedText(text.slice(0, markerPosition + 1));
                text = text.slice(markerPosition + 1);
            }
            markup += methods.unmarkedText(text);
            return markup;
        },
        inlineCode: excerpt => {
            let marker, matches;
            marker = excerpt.text[0];
            matches = excerpt.text.match(new RegExp(`^(${marker}+)[ ]*([\\S\\s]+?)[ ]*(${marker})?\\1`)); // original regex: /^('.$marker.'+)[ ]*(.+?)[ ]*(?<!'.$marker.')\1(?!'.$marker.')/s
            if (matches && !matches[3]) {
                return {
                    element: {
                        name: `code`,
                        text: matches[2].replace(/</g, `&lt;`).replace(/>/g, `&gt;`).replace(/[ ]*\n/, ``)
                    },
                    extent: strlen(matches[0])
                };
            }
        },
        inlineEmailTag: excerpt => {
            let matches = excerpt.text.match(/^<((mailto:)?\S+?@\S+?)>/i);
            if (excerpt.text.indexOf(`>`) > -1 && matches) {
                let url = matches[1];
                if (!methods.isSet(matches[2])) {
                    url = `mailto:${url}`;
                }
                return {
                    element: {
                        name: `a`,
                        text: matches[1],
                        attributes: {
                            href: url
                        }
                    },
                    extent: strlen(matches[0])
                };
            }
        },
        inlineEmphasis: excerpt => {
            if (!methods.isSet(excerpt.text[1])) {
                return;
            }
            let emphasis, marker, matches;
            marker = excerpt.text[0];
            if (excerpt.text[1] === marker && (matches = excerpt.text.match(variables.strongRegex[marker]))) {
                emphasis = `strong`;
            } else if (matches = excerpt.text.match(variables.emRegex[marker])) {
                emphasis = `em`;
            } else {
                return;
            }
            return {
                element: {
                    handler: `line`,
                    name: emphasis,
                    text: matches[1]
                },
                extent: strlen(matches[0])
            };
        },
        inlineEscapeSequence: excerpt => {
            if (methods.isSet(excerpt.text[1]) && variables.specialCharacters.indexOf(excerpt.text[1]) > -1) {
                return {
                    extent: 2,
                    markup: excerpt.text[1]
                };
            }
        },
        inlineImage: excerpt => {
            if (!methods.isSet(excerpt.text[1]) || excerpt.text[1] !== `[`) {
                return;
            }
            excerpt.text = excerpt.text.slice(1);
            let inline, link;
            link = methods.inlineLink(excerpt);
            if (!methods.isSet(link)) {
                return;
            }
            inline = {
                element: {
                    attributes: {
                        src: link.element.attributes.href,
                        alt: link.element.text,
                        title: link.element.text
                    },
                    name: `img`
                },
                extent: link.extent + 1
            };
            let key;
            for (key in link.element.attributes) {
                if (link.element.attributes[key]) {
                    inline.element.attributes[key] = link.element.attributes[key];
                }
            }
            delete inline.element.attributes.href;
            return inline;
        },
        inlineLink: excerpt => {
            let element, extent, matches, remainder;
            element = {
                attributes: {
                    href: null,
                    title: null
                },
                handler: `line`,
                name: `a`,
                text: null
            };
            extent = 0;
            remainder = excerpt.text;
            matches = remainder.match(/\[(.*?)\]/);
            if (matches) {
                matches = matches[0].match(/\[(?:(.*\[)*)(.*?)\]/); // original regex: /\[((?:[^][]++|(?R))*+)\]/
                if (matches) {
                    element.text = matches[2];
                    extent += strlen(matches[2]) + 2;
                    remainder = remainder.slice(extent);
                } else {
                    return;
                }
            } else {
                return;
            }
            matches = remainder.match(/^\(\s*([^\s]+?)\s*\)/); // original regex: /^[(]\s*+((?:[^ ()]++|[(][^ )]+[)])++)(?:[ ]+("[^"]*"|\'[^\']*\'))?\s*[)]/
            if (matches) {
                element.attributes.href = matches[1];
                if (methods.isSet(matches[2])) {
                    element.attributes.title = matches[2].slice(1, - 1);
                }
                extent += strlen(matches[0]);
            } else {
                matches = remainder.match(/^\s*\[(.*?)\]/);
                let definition;
                if (matches) {
                    definition = (strlen(matches[1]) ? matches[1] : element.text).toLowerCase();
                    extent += strlen(matches[0]);
                } else {
                    definition = element.text.toLowerCase();
                }
                if (!methods.isSet(variables.definitionData.Reference[definition])) {
                    return;
                }
                definition = variables.definitionData.Reference[definition];
                element.attributes.href = definition.url;
                element.attributes.title = definition.title;
            }
            element.attributes.href = element.attributes.href.replace(/&/g, `&amp;`).replace(/</g, `&lt;`);
            return {
                element: element,
                extent: extent
            };
        },
        inlineMarkup: excerpt => {
            if (variables.markupEscaped || excerpt.text.indexOf(`>`) < 0) {
                return;
            }
            let matches = excerpt.text.match(/^<\/\w*[ ]*>/);
            if (excerpt.text[1] === `/` && matches) {
                return {
                    extent: strlen(matches[0]),
                    markup: matches[0],
                };
            }
            matches = excerpt.text.match(/^<!---?[^>-](?:-?[^-])*-->/);
            if (excerpt.text[1] === `!` && matches) {
                return {
                    extent: strlen(matches[0]),
                    markup: matches[0],
                };
            }
            matches = excerpt.text.match(new RegExp(`^<\w*(?:[ ]*${variables.regexHtmlAttribute})*[ ]*\/?>`));
            if (excerpt.text[1] !== ` ` && matches) {
                return {
                    extent: strlen(matches[0]),
                    markup: matches[0],
                };
            }
        },
        inlineSpecialCharacter: excerpt => {
            if (excerpt.text[0] === `&` && !excerpt.text.match(/^&#?\w+;/)) {
                return {
                    extent: 1,
                    markup: `&amp;`
                };
            }
            let specialCharacter = {
                [`>`]: `gt`,
                [`<`]: `lt`,
                [`"`]: `quot`
            };
            if (methods.isSet(specialCharacter[excerpt.text[0]])) {
                return {
                    extent: 1,
                    markup: `&${specialCharacter[excerpt.text[0]]};`
                };
            }
        },
        inlineStrikethrough: excerpt => {
            if (!methods.isSet(excerpt.text[1])) {
                return;
            }
            let matches, name, text;
            if ((matches = excerpt.text.match(/^~([^~]+?)(~+)/)) && matches[2].length === 1) {
                name = `span`;
                text = matches[1];
            } else if ((matches = excerpt.text.match(/^~~([^~]+?)(~+)/)) && matches[2].length === 2) {
                name = `del`,
                text = matches[1];
            } else if (matches = excerpt.text.match(/^~~~([^~]+?)(~+)/)) {
                switch (matches[2].length) {
                    case 3:
                        name = `span`;
                        text = `~~${matches[1]}~~`;
                        break;
                    case 4:
                        name = `del`;
                        text = `~${matches[1]}~~`;
                        break;
                    default:
                        break;
                }
            }
            if (name) {
                switch (name) {
                    case `del`:
                        return {
                            element: {
                                handler: `line`,
                                name: `del`,
                                text: text
                            },
                            extent: strlen(matches[0])
                        };
                    case `span`:
                        return {
                            element: {
                                attributes: {
                                    class: `spoiler`
                                },
                                handler: `line`,
                                name: `span`,
                                text: text
                            },
                            extent: strlen(matches[0])
                        };
                }
            } else {
                return;
            }
        },
        inlineUrl: excerpt => {
            if (variables.urlsLinked !== true || ! methods.isSet(excerpt.text[2]) || excerpt.text[2] !== `/`) {
                return;
            }
            let match = /\bhttps?:[\/]{2}[^\s<]+\b\/*/ui.exec(excerpt.context);
            if (match) {
                return {
                    element: {
                        attributes: {
                            href: match[0]
                        },
                        name: `a`,
                        text: match[0]
                    },
                    extent: strlen(match[0]),
                    position: match.index
                };
            }
        },
        inlineUrlTag: excerpt => {
            let matches = excerpt.text.match(/^<(\w+:\/{2}[^ >]+)>/i);
            if (excerpt.text.indexOf(`>`) > -1 && matches) {
                let url = matches[1].replace(/&/g, `&amp;`).replace(/</g, `&lt;`);
                return {
                    element: {
                        name: `a`,
                        text: url,
                        attributes: {
                            href: url
                        }
                    },
                    extent: strlen(matches[0])
                };
            }
        },
        unmarkedText: text => {
            if (!text) {
                return ``;
            }
            if (variables.breaksEnabled) {
                return text.replace(/[ ]*\n/g, `<br />\n`);
            } else {
                return text.replace(/(?:[ ][ ]+|[ ]*\\\\)\n/g, `<br />\n`).replace(/\s\n/g, `\n`);
            }
        },
        element: element => {
            let markup = `<${element.name}`;
            if (methods.isSet(element.attributes)) {
                let key, value;
                for (key in element.attributes) {
                    value = element.attributes[key];
                    if (value === null) {
                        continue;
                    }
                    markup += ` ${key}="${value}"`;
                }
            }
            if (methods.isSet(element.text)) {
                markup += `>`;
                if (methods.isSet(element.handler)) {
                    markup += methods[element.handler](element.text);
                } else {
                    markup += element.text;
                }
                markup += `</${element.name}>`;
            } else {
                markup += ` />`;
            }
            return markup;
        },
        elements: elements => {
            let markup = ``;
            elements.forEach(element => {
                markup += `\n${methods.element(element)}`;
            });
            markup += `\n`;
            return markup;
        },
        li: lines => {
            let markup, trimmedMarkup;
            markup = methods.lines(lines);
            trimmedMarkup = trim(markup);
            if (lines.indexOf(``) < 0 && trimmedMarkup.slice(0, 3) === `<p>`) {
                markup = trimmedMarkup.slice(3);
                i = markup.indexOf(`</p>`);
                markup = `${markup.slice(0, i)}${markup.slice(i + 4)}`;
            }
            return markup;
        }
    };

    class Parsedown {
        text(text) {
            variables.definitionData = {
                Reference: {}
            };
            let markup = methods.lines(trim(text.replace(/\r\n|\r/g, `\n`), `\n`).split(`\n`));
            markup = trim(markup, `\n`);
            return markup;
        }
        setBreaksEnabled(breaksEnabled) {
            variables.breaksEnabled = breaksEnabled;
            return this;
        }
        setMarkupEscaped(markupEscaped) {
            variables.markupEscaped = markupEscaped;
            return this;
        }
        setUrlsLinked(urlsLinked) {
            variables.urlsLinked = urlsLinked;
            return this;
        }
    }

    return Parsedown;
})();

// ESGST

(() => {
    class ButtonSet {
        constructor(color1, color2, icon1, icon2, title1, title2, callback1, callback2) {
            this.busy = false;
            this.dependencies = [];
            const classes = {
                green: `form__submit-button`,
                grey: `form__saving-button`,
                red: `sidebar__error`,
                yellow: `sidebar__entry-delete`
            };
            this.set = document.createElement(`div`);
            this.set.className = `esgst-button-set`;
            this.set.innerHTML = `
                <div class="${classes[color1]} btn_action ${color1}">
                    <i class="fa ${icon1}"></i>
                    <span>${title1}</span>
                </div>
                <div class="${classes[color2]} btn_action ${color2} is-disabled is_disabled esgst-hidden">
                    <i class="fa ${icon2}"></i>
                    <span>${title2}</span>
                </div>
            `;
            this.button1 = this.set.firstElementChild;
            this.button2 = this.set.lastElementChild;
            this.callback1 = callback1;
            this.callback2 = callback2;
            this.button1.addEventListener(`click`, () => this.toggle(this.callback1));
            if (this.callback2) {
                this.button2.classList.remove(`is-disabled`, `is_disabled`);
                this.button2.addEventListener(`click`, () => this.toggle(this.callback2));
            }
        }
        toggle(callback) {
            this.dependencies.forEach(dependency => dependency.classList.toggle(`esgst-hidden`));
            this.busy = !this.busy;
            this.button1.classList.toggle(`esgst-hidden`);
            this.button2.classList.toggle(`esgst-hidden`);
            if (callback) {
                callback(this.toggle.bind(this));
            }
        }
        trigger() {
            this.toggle(this.callback1);
        }
    }

    class Checkbox {
        constructor (context, defaultValue, threeState) {
            this.value = defaultValue;
            this.isThreeState = threeState;
            this.checkbox = insertHtml(context, `afterBegin`, `
                <span class="esgst-checkbox">
                    <input class="esgst-hidden" type="checkbox">
                    <i class="fa fa-circle-o"></i>
                    <i class="fa fa-circle"></i>
                    <i class="fa fa-check-circle"></i>
                </span>
            `);
            this.input = this.checkbox.firstElementChild;
            this.disabled = this.input.nextElementSibling;
            this.none = this.disabled.nextElementSibling;
            this.enabled = this.none.nextElementSibling;
            if (this.isThreeState) {
                if (this.value === `disabled`) {
                    this.none.classList.add(`esgst-hidden`);
                    this.enabled.classList.add(`esgst-hidden`);
                } else if (this.value === `none`) {
                    this.disabled.classList.add(`esgst-hidden`);
                    this.enabled.classList.add(`esgst-hidden`);
                } else {
                    this.disabled.classList.add(`esgst-hidden`);
                    this.none.classList.add(`esgst-hidden`);
                }
                this.checkbox.addEventListener(`click`, () => this.change());
            } else {
                this.input.checked = this.value;
                if (this.value) {
                    this.disabled.classList.add(`esgst-hidden`);
                    this.none.classList.add(`esgst-hidden`);
                } else {
                    this.none.classList.add(`esgst-hidden`);
                    this.disabled.classList.add(`esgst-hidden`);
                }
                this.checkbox.addEventListener(`click`, event => this.change(true, null, null, event));
                this.checkbox.addEventListener(`mouseenter`, () => this.showNone());
                this.checkbox.addEventListener(`mouseleave`, () => this.hideNone());
                this.change();
            }
        }
        change(toggle, value, callback, event) {
            if (this.isThreeState) {
                if ((this.value === `disabled` && !value) || (value === `none`)) {
                    this.enabled.classList.add(`esgst-hidden`);
                    this.disabled.classList.add(`esgst-hidden`);
                    this.none.classList.remove(`esgst-hidden`);
                    this.value = `none`;
                } else if ((this.value === `none` && !value) || (value === `enabled`)) {
                    this.none.classList.add(`esgst-hidden`);
                    this.disabled.classList.add(`esgst-hidden`);
                    this.enabled.classList.remove(`esgst-hidden`);
                    this.value = `enabled`;
                } else if (!value || value === `disabled`) {
                    this.enabled.classList.add(`esgst-hidden`);
                    this.none.classList.add(`esgst-hidden`);
                    this.disabled.classList.remove(`esgst-hidden`);
                    this.value = `disabled`;
                }
            } else {
                if (toggle) {
                    this.value = this.input.checked = !this.input.checked;
                }
                if (this.value) {
                    this.disabled.classList.add(`esgst-hidden`);
                    this.none.classList.add(`esgst-hidden`);
                    this.enabled.classList.remove(`esgst-hidden`);
                    if (this.onEnabled) {
                        this.onEnabled(event);
                    }
                } else {
                    this.enabled.classList.add(`esgst-hidden`);
                    this.none.classList.add(`esgst-hidden`);
                    this.disabled.classList.remove(`esgst-hidden`);
                    if (this.onDisabled) {
                        this.onDisabled(event);
                    }
                }
            }
        }
        showNone() {
            if (!this.value) {
                this.disabled.classList.add(`esgst-hidden`);
                this.none.classList.remove(`esgst-hidden`);
            }
        }
        hideNone() {
            if (!this.value) {
                this.disabled.classList.remove(`esgst-hidden`);
                this.none.classList.add(`esgst-hidden`);
            }
        }
        check(callback) {
            this.value = this.input.checked = true;
            this.change(false, null, callback);
        }
        uncheck(callback) {
            this.value = this.input.checked = false;
            this.change(false, null, callback);
        }
        toggle(callback) {
            this.change(true, null, callback);
        }
    }

    class CompletionCheck {
        constructor(total, callback, onCheck) {
            this.callback = callback;
            this.onCheck = onCheck;
            this.counter = {
                count: 0,
                total: total
            };
            setTimeout(() => this.check(), 500);
            return this.counter;
        }
        check() {
            if (this.onCheck) {
                this.onCheck();
            }
            if (this.counter.count < this.counter.total) {
                setTimeout(() => this.check(), 500);
            } else {
                this.callback();
            }
        }
    }

    class Popout {
        constructor(className = ``, context = null, hoverSpeed = 1000, onClick = false, popout = null, onOpen = null) {
            this.onOpen = onOpen;
            this.context = context;
            this.popout = popout || insertHtml(document.body, `beforeEnd`, `<div class="${className}"></div>`);
            this.popout.classList.add(`esgst-popout`, `esgst-hidden`);
            this.popup = this.popout.closest(`.esgst-popup`);
            this.hoverSpeed = hoverSpeed;
            if (!onClick) {
                if (this.context) {
                    let timeout = null;
                    this.context.addEventListener(`mouseenter`, () => {
                        timeout = setTimeout(() => {
                            this.open();
                        }, this.hoverSpeed);
                    });
                    this.context.addEventListener(`mouseleave`, event => {
                        if (timeout) {
                            clearTimeout(timeout);
                            timeout = null;
                        }
                        if (!this.popout.contains(event.relatedTarget)) {
                            this.close();
                        }
                    });
                }
                let timeout = null;
                this.popout.addEventListener(`mouseenter`, () => {
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout = null;
                    }
                });
                this.popout.addEventListener(`mouseleave`, event => {
                    timeout = setTimeout(() => {
                        if (event.relatedTarget && !this.context.contains(event.relatedTarget)) {
                            this.context.classList.remove(`esgst-qgs-container-expanded`);
                            this.close();
                        }
                    }, this.hoverSpeed);
                });
            } else {
                if (this.context) {
                    this.context.addEventListener(`click`, () => {
                        if (this.isOpen) {
                            this.close();
                        } else {
                            this.open();
                        }
                    });
                }
                document.addEventListener(`click`, event => {
                    if (this.context && !this.context.contains(event.target) && !this.popout.contains(event.target)) {
                        this.close();
                    }
                });
            }
            this.isOpen = false;
        }
        open(context = null, isFixed = false) {
            this.context = context || this.context;
            this.isFixed = isFixed;
            this.popout.classList.remove(`esgst-hidden`);
            this.popout.style.zIndex = 10000 + document.querySelectorAll(`.esgst-popup:not(.esgst-hidden), .esgst-popout:not(.esgst-hidden)`).length;
            if (this.isFixed) {
                this.popout.classList.add(`esgst-fixed`);
            }
            this.reposition();
            this.isOpen = true;
            if (this.onOpen) {
                this.onOpen(this.popout);
            }
        }
        close() {
            this.popout.classList.add(`esgst-hidden`);
            this.isOpen = false;
        }
        reposition(context = null) {
            let contextLeft, contextRect, contextTop, popoutHeight, popoutWidth, popupRect;
            this.popout.style.left = `0`;
            this.popout.style.top = `0`;
            this.context = context || this.context;
            contextRect = this.context.getBoundingClientRect();
            contextLeft = contextRect.left;
            contextTop = contextRect.top;
            if (contextTop > (window.innerHeight - (contextTop + contextRect.height))) {
                this.popout.style.maxHeight = `${contextTop - 10}px`;
            } else {
                this.popout.style.maxHeight = `${window.innerHeight - (contextTop + contextRect.height) - 10}px`;
            }
            popoutHeight = this.popout.offsetHeight;
            popoutWidth = this.popout.offsetWidth;
            popupRect = this.popup && this.popup.getBoundingClientRect();
            if (contextLeft + popoutWidth > document.documentElement.clientWidth) {
                this.popout.style.left = `${(contextLeft - popoutWidth + contextRect.width) - (this.popup ? popupRect.left : 0)}px`;
            } else {
                this.popout.style.left = `${contextLeft - (this.popup ? popupRect.left : 0)}px`;
            }
            if (contextTop + popoutHeight > document.documentElement.clientHeight) {
                this.popout.style.top = `${(contextTop - popoutHeight + (this.isFixed || this.popup ? 0 : scrollY)) - (this.popup ? popupRect.top : 0)}px`;
            } else {
                this.popout.style.top = `${(contextTop + contextRect.height + (this.isFixed || this.popup ? 0 : scrollY)) - (this.popup ? popupRect.top : 0)}px`;
            }
        }
    }

    class Popup {
        constructor(icon, title, temp, settings, popup = null) {
            this.isCreated = popup ? false : true;
            this.temp = temp;
            this.popup = popup || insertHtml(document.body, `beforeEnd`, `
                <div class="esgst-hidden esgst-popup">
                    <div class="esgst-popup-heading">
                        <i class="fa ${icon} esgst-popup-icon${icon ? `` : ` esgst-hidden`}"></i>
                        <div class="esgst-popup-title${title ? `` : ` esgst-hidden`}">${title}</div>
                    </div>
                    <div class="esgst-popup-description">
                        <div class="esgst-popup-scrollable"></div>
                    </div>
                    <div class="esgst-popup-actions">
                        <span class="esgst-hidden">Settings</span>
                        <span class="esgst-popup-close">Close</span>
                    </div>
                </div>
            `);
            if (this.isCreated) {
                this.icon = this.popup.firstElementChild.firstElementChild;
                this.title = this.icon.nextElementSibling;
                this.description = this.popup.firstElementChild.nextElementSibling;
                this.scrollable = this.description.firstElementChild;
                this.actions = this.description.nextElementSibling;
                if (!settings) {
                    settings = this.actions.firstElementChild;
                    settings.classList.remove(`esgst-hidden`);
                    settings.addEventListener(`click`, () => {
                        if (esgst.openSettingsInTab) {
                            open(`/esgst/settings`);
                        } else {
                            loadSMMenu();
                        }
                    });
                }
                this.description.nextElementSibling.lastElementChild.addEventListener(`click`, () => this.close());
            } else {
                const closeButton = this.popup.getElementsByClassName(`b-close`)[0];
                if (closeButton) {
                    closeButton.addEventListener(`click`, () => this.close());
                }
            }
        }
        open(callback) {
            this.isOpen = true;
            esgst.openPopups += 1;
            esgst.popups.push(this);
            this.modal = insertHtml(document.body, `beforeEnd`, `
                <div class="esgst-popup-modal"></div>
            `);
            if (this.isCreated) {
                this.popup.classList.remove(`esgst-hidden`);
            } else {
                this.popup.style.display = `block`;
                this.popup.style.position = `absolute`;
            }
            let n = 9999 + document.querySelectorAll(`.esgst-popup:not(.esgst-hidden), .esgst-popout:not(.esgst-hidden)`).length;
            this.modal.style.zIndex = n;
            this.popup.style.zIndex = n + 1;
            this.modal.addEventListener(`click`, () => this.close());
            this.reposition();
            if (!esgst.isRepositioning && !esgst.staticPopups) {
                setTimeout(repositionPopups, 2000);
            }
            if (callback) {
                callback();
            }
        }
        close() {
            this.modal.remove();
            if (this.isCreated) {
                if (this.temp) {
                    this.popup.remove();
                } else {
                    this.popup.classList.add(`esgst-hidden`);
                }
            } else {
                this.popup.style = ``;
            }
            if (this.onClose) {
                this.onClose();
            }
            esgst.openPopups -= 1;
            esgst.popups.pop();
            this.isOpen = false;
        }
        reposition() {
            if (this.isCreated) {
                this.scrollable.style.maxHeight = `${innerHeight * 0.9 - (this.popup.offsetHeight - this.scrollable.offsetHeight)}px`;
            }
            if (!esgst.staticPopups) {
                let newLeft, newTop;
                newLeft = (innerWidth - this.popup.offsetWidth) / 2;
                newTop = (innerHeight - this.popup.offsetHeight) / 2;
                if (Math.abs(newLeft - this.popup.offsetLeft) > 5 || Math.abs(newTop - this.popup.offsetTop) > 5) {
                    this.popup.style.left = `${newLeft}px`;
                    this.popup.style.top = `${newTop}px`;
                }
            }
        }
    }

    class ToggleSwitch {
        constructor(context, id, inline, name, sg, st, tooltip, value) {
            this.dependencies = [];
            this.exclusions = [];
            this.id = id;
            this.sg = sg;
            this.st = st;
            this.value = value;
            this.container = insertHtml(context, `beforeEnd`, `
                <div class="esgst-toggle-switch-container ${inline ? `inline` : ``}">
                    <label class="esgst-toggle-switch">
                        <input type="checkbox">
                        <div class="esgst-toggle-switch-slider"></div>
                    </label>
                    <span>${name}</span>
                    ${tooltip ? `<i class="fa fa-question-circle" title="${tooltip}"></i>` : ``}
                </div>
            `);
            this.switch = this.container.firstElementChild;
            this.input = this.switch.firstElementChild;
            this.name = this.switch.nextElementSibling;
            this.input.checked = this.value;
            this.input.addEventListener(`change`, () => this.change());
        }
        change() {
            this.value = this.input.checked;
            if (this.id) {
                setSetting(this.id, this.value, this.sg, this.st);
                esgst[this.id] = this.value;
            }
            if (this.value) {
                this.dependencies.forEach(dependency => dependency.classList.remove(`esgst-hidden`));
                this.exclusions.forEach(exclusion => exclusion.classList.add(`esgst-hidden`));
                if (this.onEnabled) {
                    this.onEnabled();
                }
            } else {
                this.dependencies.forEach(dependency => dependency.classList.add(`esgst-hidden`));
                this.exclusions.forEach(exclusion => exclusion.classList.remove(`esgst-hidden`));
                if (this.onDisabled) {
                    this.onDisabled();
                }
            }
        }
        enable() {
            this.input.checked = true;
            this.change();
        }
        disable() {
            this.input.checked = false;
            this.change();
        }
        toggle() {
            this.input.checked = !this.input.checked;
            this.change();
        }
    }

    let esgst;

    // initialize esgst
    init();

    function init() {
        if (document.getElementById(`esgst`)) {
            // esgst is already running
            return;
        }

        // initialize the global variable        
        esgst = {
            defaultValues: {
                enableByDefault_sg: false,
                enableByDefault_st: false,
                checkVersion_sg: true,
                checkVersionMain_sg: true,
                collapseSections_sg: false,
                collapseSections_st: false,
                df_m_sg: true,
                elgb_d_sg: true,
                gb_ue_sg: true,
                gc_g_s_sg: false,
                ge_o_sg: false,                
                gf_m_sg: true,
                gwc_a_b_sg: false,
                gwr_a_b_sg: false,
                hpg_sg: false,
                pm_a: false,
                radb_sg: true,
                showChangelog_sg: true,
                showChangelog_st: true,
                staticPopups_sg: false,
                staticPopups_st: false,
                vai_i_sg: false,
                avatar: ``,
                steamId: ``,
                steamApiKey: ``,
                username: ``,
                adots_index: 0,
                ags_type: ``,
                ags_maxDate: ``,
                ags_minDate: ``,
                ags_maxScore: ``,
                ags_minScore: ``,
                ags_maxLevel: ``,
                ags_minLevel: ``,
                ags_maxEntries: ``,
                ags_minEntries: ``,
                ags_maxCopies: ``,
                ags_minCopies: ``,
                ags_maxPoints: ``,
                ags_minPoints: ``,
                ags_regionRestricted: false,
                ags_dlc: false,
                ags_app: false,
                ags_sub: false,
                ap_index: 0,
                as_searchAppId: false,
                autoBackup_days: 1,
                autoBackup_index: 0,
                autoSyncGroups: 0,
                autoSyncWhitelist: 0,
                autoSyncBlacklist: 0,
                autoSyncHiddenGames: 0,
                autoSyncGames: 0,
                autoSyncWonGames: 0,
                autoSyncReducedCvGames: 0,
                autoSyncNoCvGames: 0,
                autoSyncGiveaways: 0,
                cfh_pasteFormatting: true,
                cfh_img_choice: 1,
                cfh_img_remember: false,
                cleanDiscussions: true,
                cleanEntries: true,
                cleanGiveaways: true,
                cleanSgCommentHistory: true,
                cleanStCommentHistory: true,
                cleanTickets: true,
                cleanTrades: true,
                cleanDiscussions_days: 30,
                cleanEntries_days: 30,
                cleanGiveaways_days: 30,
                cleanSgCommentHistory_days: 30,
                cleanStCommentHistory_days: 30,
                cleanTickets_days: 30,
                cleanTrades_days: 30,
                df_enable: true,
                df_enableCreated: false,
                df_preset: null,
                df_presetCreated: null,
                ds_auto: false,
                ds_option: `sortIndex_asc`,
                elgb_filters: `.|(bestof|(g(ood)?)?)(l(uck)?)?(h(ave)?)?(f(un)?)?|enjoy|(h(umble)?)?(b(undle)?)?(g(ift)?)?(l(ink)?)?`,
                exportBackup: true,
                exportBackupIndex: 0,
                gas_auto: false,
                gas_option: `sortIndex_asc`,
                gas_autoWishlist: false,
                gas_optionWishlist: `sortIndex_asc`,
                gas_autoRecommended: false,
                gas_optionRecommended: `sortIndex_asc`,
                gas_autoGroup: false,
                gas_optionGroup: `sortIndex_asc`,
                gas_autoNew: false,
                gas_optionNew: `sortIndex_asc`,
                gas_autoEntered: false,
                gas_optionEntered: `sortIndex_asc`,
                gas_autoUser: false,
                gas_optionUser: `sortIndex_asc`,
                gas_autoGroups: false,
                gas_optionGroups: `sortIndex_asc`,
                gb_hours: 1,
                gc_categories: [`gc_gi`, `gc_r`, `gc_fcv`, `gc_rcv`, `gc_ncv`, `gc_h`, `gc_i`, `gc_o`, `gc_w`, `gc_a`, `gc_mp`, `gc_sc`, `gc_tc`, `gc_l`, `gc_m`, `gc_ea`, `gc_rm`, `gc_dlc`, `gc_p`, `gc_g`],
                gc_o_altAccounts: [],
                gc_g_colors: [],
                gc_g_filters: ``,
                gc_fcvIcon: `calendar`,
                gc_rcvIcon: `calendar-minus-o`,
                gc_ncvIcon: `calendar-times-o`,
                gc_hIcon: `eye-slash`,
                gc_iIcon: `ban`,
                gc_oIcon: `folder`,
                gc_wIcon: `heart`,
                gc_aIcon: `trophy`,
                gc_mpIcon: `users`,
                gc_scIcon: `cloud`,
                gc_tcIcon: `clone`,
                gc_lIcon: `linux`,
                gc_mIcon: `apple`,
                gc_eaIcon: `unlock`,
                gc_rmIcon: `trash`,
                gc_dlcIcon: `download`,
                gc_pIcon: `suitcase`,
                gc_fcvLabel: `Full CV`,
                gc_rcvLabel: `Reduced CV`,
                gc_ncvLabel: `No CV`,
                gc_hLabel: `Hidden`,
                gc_iLabel: `Ignored`,
                gc_oLabel: `Owned`,
                gc_wLabel: `Wishlisted`,
                gc_aLabel: `Achievements`,
                gc_mpLabel: `Multiplayer`,
                gc_scLabel: `Steam Cloud`,
                gc_tcLabel: `Trading Cards`,
                gc_lLabel: `Linux`,
                gc_mLabel: `Mac`,
                gc_eaLabel: `Early Access`,
                gc_rmLabel: `Removed`,
                gc_dlcLabel: `DLC`,
                gc_pLabel: `Package`,
                gc_h_color: `#ffffff`,
                gc_gi_color: `#ffffff`,
                gc_fcv_color: `#ffffff`,
                gc_rcv_color: `#ffffff`,
                gc_ncv_color: `#ffffff`,
                gc_w_color: `#ffffff`,
                gc_o_color: `#ffffff`,
                gc_i_color: `#ffffff`,
                gc_rm_color: `#ffffff`,
                gc_ea_color: `#ffffff`,
                gc_tc_color: `#ffffff`,
                gc_a_color: `#ffffff`,
                gc_mp_color: `#ffffff`,
                gc_sc_color: `#ffffff`,
                gc_l_color: `#ffffff`,
                gc_m_color: `#ffffff`,
                gc_dlc_color: `#ffffff`,
                gc_p_color: `#ffffff`,
                gc_g_color: `#ffffff`,
                gc_h_bgColor: `#e74c3c`,
                gc_gi_bgColor: `#555555`,
                gc_fcv_bgColor: `#641e16`,
                gc_rcv_bgColor: `#641e16`,
                gc_ncv_bgColor: `#641e16`,
                gc_o_bgColor: `#16a085`,
                gc_w_bgColor: `#3498db`,
                gc_i_bgColor: `#e74c3c`,
                gc_rm_bgColor: `#e74c3c`,
                gc_ea_bgColor: `#3498db`,
                gc_tc_bgColor: `#2ecc71`,
                gc_a_bgColor: `#145a32`,
                gc_mp_bgColor: `#0e6251`,
                gc_sc_bgColor: `#154360`,
                gc_l_bgColor: `#f39c12`,
                gc_m_bgColor: `#d35400`,
                gc_dlc_bgColor: `#8e44ad`,
                gc_p_bgColor: `#8e44ad`,
                gc_g_bgColor: `#7f8c8d`,
                gcl_index: 0,
                ge_b_bgColor: `#ddcccc`,
                ge_g_bgColor: `#ccddcc`,
                ge_p_bgColor: `#ccccdd`,
                ged: true,
                gf_enable: true,
                gf_enableWishlist: true,
                gf_enableRecommended: true,
                gf_enableNew: true,
                gf_enableGroup: true,
                gf_enableCreated: true,
                gf_enableEntered: true,
                gf_enableWon: true,
                gf_enableGroups: true,
                gf_enableUser: true,
                gf_enableGb: true,
                gf_enableGe: true,
                gf_enableGed: true,
                gf_preset: null,
                gf_presetWishlist: null,
                gf_presetRecommended: null,
                gf_presetNew: null,
                gf_presetGroup: null,
                gf_presetCreated: null,
                gf_presetEntered: null,
                gf_presetWon: null,
                gf_presetGroups: null,
                gf_presetUser: null,
                gf_presetGb: null,
                gf_presetGe: null,
                gf_presetGed: null,
                gf_noRating: true,
                ggl_index: 0,
                gm_enable: false,
                gm_useRegExp: false,
                gt_colors: {},
                gts_preciseStart: false,
                gts_preciseEnd: false,
                gts_preciseStartDate: false,
                gts_preciseEndDate: false,
                gv_spacing: 0,
                gwc_colors: [],
                gwr_colors: [],
                hr_minutes: 1,
                hr_w_hours: 24,
                lastBackup: 0,
                lastSyncGroups: 0,
                lastSyncWhitelist: 0,
                lastSyncBlacklist: 0,
                lastSyncHiddenGames: 0,
                lastSyncGames: 0,
                lastSyncWonGames: 0,
                lastSyncReducedCvGames: 0,
                lastSyncNoCvGames: 0,
                lastSyncGiveaways: 0,
                leftButtonIds: [`wbsDesc`, `wbsAsc`, `wbc`, `ugs`, `tb`, `sks`, `rbp`, `namwc`, `mtUsers`, `mtGames`, `mpp`, `hgr`, `gv`, `gts`, `gm`, `gf`, `ge`, `gas`, `ds`, `df`, `ctUnread`, `ctRead`, `ctGo`, `cs`, `as`, `aic`],
                mgc_createTrain: true,
                mgc_bumpLast: true,
                mgc_groupKeys: false,
                mgc_reversePosition: false,
                mgc_removeLinks: true,
                namwc_checkNotActivated: false,
                namwc_checkMultiple: false,
                npth_previousKey: `ArrowLeft`,
                npth_nextKey: `ArrowRight`,
                nrf_searchMultiple: false,
                rightButtonIds: [`esResume`, `esPause`, `esRefresh`, `esRefreshAll`, `stbb`, `sttb`],
                sal_index: 2,
                sk_closePopups: `escape`,
                sk_searchBox: `ctrlKey + q`,
                sk_firstPage: `ctrlKey + arrowup`,
                sk_previousPage: `ctrlKey + arrowleft`,
                sk_nextPage: `ctrlKey + arrowright`,
                sk_lastPage: `ctrlKey + arrowdown`,
                sk_toggleFilters: `altKey + q`,
                sk_hideGame: `altKey + g`,
                sk_hideGiveaway: `altKey + h`,
                sk_giveawayEntry: `ctrlKey + enter`,
                sk_creator: `altKey + c`,
                sk_replyBox: `ctrlKey +  `,
                sk_replyUser: `altKey + u`,
                sk_submitReply: `ctrlKey + enter`,
                sks_exportKeys: false,
                stbb_index: 0,
                sttb_index: 0,
                syncGroups: true,
                syncWhitelist: true,
                syncBlacklist: true,
                syncHiddenGames: true,
                syncGames: true,
                syncWonGames: true,
                syncReducedCvGames: true,
                syncNoCvGames: true,
                syncGiveaways: true,
                ugd_getPlaytime: true,
                ugd_getAchievements: false,
                ugd_clearCache: false,
                ugs_checkRules: false,
                ugs_checkWhitelist: false,
                ugs_checkBlacklist: false,
                ugs_checkMember: false,
                ugs_checkDifference: false,
                ugs_difference: 0,
                ut_colors: {},
                wbc_checkSingle: false,
                wbc_checkWhitelist: true,
                wbc_checkAll: false,
                wbc_returnWhitelists: false,
                wbc_returnBlacklists: false,
                wbc_checkSelected: false,
                wbc_pages: 0,
                wbc_skipUsers: false,
                wbm_clearTags: false,
                wbm_useCache: false,
                wbm_tags: [],
                wbc_checkNew: false,
                wbc_clearCache: false,
                wbh_w_color: `#ffffff`,
                wbh_w_bgColor: `#228b22`,
                wbh_b_color: `#ffffff`,
                wbh_b_bgColor: `#ff4500`
            },
            oldValues: {
                gdttt_vg_sg: `gdttt_v_sg`,
                gdttt_vd_sg: `gdttt_v_sg`,
                gdttt_vt_sg: `gdttt_v_sg`,
                gdttt_vts_st: `gdttt_v_st`
            },
            domParser: new DOMParser(),
            markdownParser: new Parsedown(),
            sg: location.hostname.match(/www.steamgifts.com/),
            st: location.hostname.match(/www.steamtrades.com/),
            currentVersion: `7.12.0`,
            icon: `data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAqv8DCbP/Hgeq+CQIrf8iCK3/Igit/yIIrf8iB6//Iwit9x8Aqv8DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKr0GAa2/c0DvfzfA7f83QO3/N0Dt/zdA7f83QO+/d4Gs/3OAKP1GQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACm/xQFs/n2Bcf//wW///8FwP//BcD//wW///8Fx///BbP69gC2/xUAAAAAAAAAAAAAAAAA/1UDFptOFxSZMxkLpJktAq720QW1+ugEsfvjA7b92wO2/dsEsfvjBbX66Aau/dEoiO4tUlLWGU5k3hdVVf8DEJxKHxWqT8cVrU7uE6VN0guqny0Apv8XAJfQGwBAVywAQFcsAJfQGwCx/xcogugtS2Lk0lBl6u5Qae7ISmPeHxagSSMVr07jF7lV/xOiSu0brgATAAAAAAAAAA8AAAC/AAAAwAAAABAAAAAAYznjEkth4OxWb/3/T2jv40lf4iMXnksiEq1O3RayUv8UpEnkEo0+HQAAABkAAABBAAAA8QAAAPEAAABBAAAAGUBSvxxOYeDjU2v0/05m7d1LYuEiF55LIhKtTt0Ws1L/FahN2gU1FTAAAADAAAAA7AAAAP0AAAD9AAAA7AAAAMAVG0owUGPm2lNr9P9OZu3dS2LhIheeSyISrU7dFrNS/xWoTdoFNRswAAAAvwAAAOsAAAD9AAAA/QAAAOsAAADAFRtKMFBj6NpTa/T/Tmbt3Uti4SIXnksiEq1O3RayUv8UpEnkEo0+HQAAABgAAABAAAAA8QAAAPEAAABBAAAAGT5PuR1OYeDjU2v0/05m7d1LYuEiFqBJIxWuT+QXuVX/E6JL7QC8XhMAAAAAAAAADwAAAL8AAAC/AAAAEAAAAAAOR/8SSWLh7FZv/f9PaO/jSV/iIxCUSh8Vrk7HFqxN7ROlS9JskzMt1XULGK12EhxGLgYsRy8GK612EhzVgAsYgmxxLU1i39JNZ+vtT2fwx0pj1h8AqlUDF65GFgqZUhlsiC0txH0T0s5/EujJgBPkz4QR28+EEdvJgBPkzn8Q6Md+E9KLdHosM1LWGUZo6BZVVf8DAAAAAAAAAAAAAAAA/2YAFMl9EvbgjRb/14gV/9eIFf/XiBX/14gV/9+NFv/KgBD254YAFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL91FRjKgRHN1IgU3s+EEt3PhBLdz4QS3c+EEt3UiBTezYMRzcJ6FBkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACqqgADxIARHr18FiO8eA8ivHgPIrx4DyK8eA8ivXwPI8SAER7/VQADAAAAAAAAAAAAAAAA78cAAPA3AAD4FwAABCAAADGOAAAE+AAAkBEAAJ55AACYOQAAlgEAAER4AAAXaAAATnoAAPgXAAD0JwAA69cAAA==`,
            sgIcon: `data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAQAQAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIUAAAD5AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAPoAAACFAAAAAAAAAAAAAAD8AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA+QAAAAAAAAAAAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAP8AAAD/AAAA/wAAABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAAD/AAAA/wAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAP8AAAD/AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAAD/AAAA/wAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAAAAAAAAAAAP8AAAD/AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAP8AAAD/AAAAAAAAAAAAAAD/AAAA/wAAAP8AAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAP8AAAD/AAAA/wAAAAAAAAAAAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAAAAAAAAAAAAPwAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD5AAAAAAAAAAAAAACFAAAA+QAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD5AAAAhQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AADAAwAAwAMAAMfjAADP8wAAz/MAAM/zAADP8wAAz/MAAM/zAADH4wAAwAMAAMADAAD//wAA//8AAA==`,
            stIcon: `data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAQAQAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABbD6SgWw+ucFsPrkBbD6SgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWw+uYFsPr/BbD6/wWw+ucAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFsPrmBbD6/wWw+v8FsPrmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABbD6SQWw+uYFsPrmBbD6SQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFKRLShSkS+cUpEvkFKRLSgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAExi4EpMYuDnTGLg5Exi4EoAAAAAAAAAABSkS+YUpEv/FKRL/xSkS+cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMYuDmTGLg/0xi4P9MYuDnAAAAAAAAAAAUpEvmFKRL/xSkS/8UpEvmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATGLg5kxi4P9MYuD/TGLg5gAAAAAAAAAAFKRLSRSkS+YUpEvmFKRLSQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAExi4ElMYuDmTGLg5kxi4EkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMZ9E0rGfRPnxn0T5MZ9E0oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADGfRPmxn0T/8Z9E//GfRPnAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAxn0T5sZ9E//GfRP/xn0T5gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMZ9E0nGfRPmxn0T5sZ9E0kAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAPw/AAD8PwAA/D8AAPw/AAD//wAAh+EAAIfhAACH4QAAh+EAAP//AAD8PwAA/D8AAPw/AAD8PwAA//8AAA==`,
            endlessFeatures: [],
            giveawayFeatures: [],
            currentGiveaways: [],
            attachedImages: [],
            currentComments: [],
            popupGiveaways: [],
            currentDiscussions: [],
            profileFeatures: [],
            popups: [],
            openPopups: 0,
            ustCheckboxes: {},
            ustTickets: {},
            numUstTickets: 0,
            elgbCache: JSON.parse(getLocalValue(`elgbCache`, `{"descriptions": {}, "timestamp": ${Date.now()}}`)),
            menuPath: location.pathname.match(/^\/esgst\//),
            settingsPath: location.pathname.match(/^\/esgst\/settings/),
            importMenuPath: location.pathname.match(/^\/esgst\/import/),
            exportMenuPath: location.pathname.match(/^\/esgst\/export/),
            deleteMenuPath: location.pathname.match(/^\/esgst\/delete/),
            gbPath: location.pathname.match(/^\/esgst\/bookmarked-giveaways/),
            gedPath: location.pathname.match(/^\/esgst\/decrypted-giveaways/),
            gePath: location.pathname.match(/^\/esgst\/extracted-giveaways/),
            glwcPath: location.pathname.match(/^\/esgst\/glwc/),
            userPath: location.pathname.match(/^\/user\//),
            groupPath: location.pathname.match(/^\/group\//),
            regionsPath: location.pathname.match(/^\/regions\//),
            groupWishlistPath: location.pathname.match(/^\/group\/(.*?)\/wishlist/),
            mainPath: location.pathname.match(/^\/$/),
            winnersPath: location.pathname.match(/^\/giveaway\/.+\/winners/),
            giveawaysPath: location.href.match(/steamgifts.com($|\/$|\/giveaways(?!.*\/(new|wishlist|created|entered|won)))/),
            giveawayCommentsPath: location.pathname.match(/^\/giveaway\/(?!.+\/(entries|winners|groups))/),
            discussionsTicketsPath: location.pathname.match(/^\/(discussions|support\/tickets)/),
            ticketsPath: location.pathname.match(/^\/support\/tickets/),
            tradesPath: location.href.match(/steamtrades.com($|\/$|\/trades)/),
            discussionsTicketsTradesPath: location.href.match(/steamtrades.com($|\/$)/) || location.pathname.match(/^\/(discussions|support\/tickets|trades)/),
            originalHash: location.hash,
            discussionTicketTradeCommentsPath: location.pathname.match(/^\/(discussion|support\/ticket|trade)\//),
            archivePath: location.pathname.match(/^\/archive/),
            profilePath: location.pathname.match(/^\/account\/settings\/profile/),
            giveawayPath: location.pathname.match(/^\/giveaway\//),
            discussionPath: location.pathname.match(/^\/discussion\//),
            ticketPath: location.pathname.match(/^\/support\/ticket\//),
            tradePath: location.pathname.match(/^\/trade\//),
            discussionsPath: location.pathname.match(/^\/discussions(?!\/new)/),
            newDiscussionPath: location.pathname.match(/^\/discussions\/new/),
            editDiscussionPath: location.pathname.match(/^\/discussions\/edit/),
            createdDiscussionsPath: location.pathname.match(/^\/discussions\/created/),
            newGiveawayPath: location.pathname.match(/^\/giveaways\/new/),
            newTicketPath: location.pathname.match(/^\/support\/tickets\/new/),
            wishlistPath: location.pathname.match(/^\/giveaways\/wishlist/),
            createdPath: location.pathname.match(/^\/giveaways\/created/),
            wonPath: location.pathname.match(/^\/giveaways\/won/),
            enteredPath: location.pathname.match(/^\/giveaways\/entered/),
            commentsPath: location.pathname.match(/^\/(giveaway\/(?!.*\/(entries|winners|groups))|discussion\/|support\/ticket\/|trade\/)/),
            accountPath: location.pathname.match(/^\/account/),
            aboutPath: location.pathname.match(/^\/(about|legal)/),
            whitelistPath: location.pathname.match(/^\/account\/manage\/whitelist/),
            blacklistPath: location.pathname.match(/^\/account\/manage\/blacklist/),
            inboxPath: location.pathname.match(/^\/messages/),
            groupsPath: location.pathname.match(/^\/account\/steam\/groups/),
            pageTop: 25,
            commentsTop: 0,
            apPopouts: {},
            tsTables: [],
            currentUsers: {},
            currentGames: {
                apps: {},
                subs: {}
            },
            features: {
                general: {
                    features: {
                        aic: {
                            description: `
                                <ul>
                                    <li>Allows you to navigate through all attached images of a page.</li>
                                    <li>Open the carousel by clicking either an attached image or the button in the main page heading, depending on your preferred settings.</li>
                                </ul>
                                <img src="https://i.imgur.com/gnXYNE6.png">
                                <img src="https://i.imgur.com/Csegj00.png">
                            `,
                            features: {
                                aic_b: {
                                    name: `Only trigger the carousel when clicking on the button in the main page heading.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Attached Images Carousel`,
                            sg: true,
                            st: true
                        },
                        ail: {
                            conflicts: [
                                {id: `vai`, name: `Visible Attached Images`}
                            ],
                            description: `
                                <ul>
                                    <li>Allows you to load attached images on demand, when you click on "View attached image".</li>
                                    <li>Speeds up page loads if you have a slow Internet connection.</li>
                                </ul>
                            `,
                            name: `Attached Images Loader`,
                            sg: true,
                            st: true
                        },
                        ap: {
                            description: `
                                <ul>
                                    <li>Allows you to view information about a user/group by hovering over/clicking their avatar/link, depending on your preferred settings.</li>
                                </ul>
                                <img src="https://i.imgur.com/SsG4VuQ.png">
                                <img src="https://i.imgur.com/0JPC9qD.png">
                            `,
                            name: `Avatar Popout`,
                            options: {
                                title: `Open on:`,
                                values: [`Hover`, `Click`]
                            },
                            sg: true
                        },
                        at: {
                            description: `
                                <ul>
                                    <li>Shows accurate timestamps, for example, "Jan 1, 2017, 0:00:00 - 2 hours ago" instead of just "2 hours ago".</li>
                                    <li>You can choose whether to enable it for giveaways in the main page or not, whether to show seconds or not and whether to use a 12-hour clock or a 24-hour one.</li>
                                </ul>
                            `,
                            features: {
                                at_g: {
                                    name: `Enable for giveaways in the main page.`,
                                    sg: true
                                },
                                at_s: {
                                    name: `Show seconds.`,
                                    sg: true,
                                    st: true
                                },
                                at_24: {
                                    name: `Use a 24-hour clock.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Accurate Timestamps`,
                            sg: true,
                            st: true
                        },
                        es: {
                            description: `
                                <ul>
                                    <li>Loads the next page when you scroll down to the end of the page, allowing you to endlessly scroll through pages.</li>
                                    <li>You can choose for which types of pages to enable it (comments, discussions/tickets, giveaways, lists and trades) and whether to show page divisors in each of them or not.</li>
                                    <li>Has a reverse scrolling option for discussions that loads pages in descending order and loads the last page instead of the first one when visiting discussions from the main pages.</li>
                                    <li>Use the buttons in the main page heading to pause/resume it, load the next page, continuously load pages, refresh the current page and refresh all pages.</li>
                                    <li>If you use the pagination navigation to try to go to a page that is currently loaded, it will scroll to where the page begins instead of opening it.</li>
                                </ul>
                                <img src="https://i.imgur.com/xLD7YZN.png">
                            `,
                            features: {
                                es_rd: {
                                    name: `Refresh active discussions/deals when refreshing the main page.`,
                                    sg: true
                                },
                                es_c: {
                                    features: {
                                        es_c_d: {
                                            name: `Enable page divisors.`,
                                            sg: true,
                                            st: true
                                        }
                                    },
                                    name: `Enable for comments.`,
                                    sg: true,
                                    st: true
                                },
                                es_d: {
                                    features: {
                                        es_d_d: {
                                            name: `Enable page divisors.`,
                                            sg: true
                                        }
                                    },
                                    name: `Enable for discussions/tickets.`,
                                    sg: true
                                },
                                es_g: {
                                    features: {
                                        es_g_d: {
                                            name: `Enable page divisors.`,
                                            sg: true
                                        }
                                    },
                                    name: `Enable for giveaways in the main page.`,
                                    sg: true
                                },
                                es_l: {
                                    features: {
                                        es_l_d: {
                                            name: `Enable page divisors.`,
                                            sg: true,
                                            st: true
                                        }
                                    },
                                    name: `Enable for lists.`,
                                    sg: true,
                                    st: true
                                },
                                es_t: {
                                    features: {
                                        es_t_d: {
                                            name: `Enable page divisors.`,
                                            st: true
                                        }
                                    },
                                    name: `Enable for trades`,
                                    st: true
                                },
                                es_r: {
                                    description: `
                                        <ul>
                                            <li>Loads pages in descending order.</li>
                                            <li>When visiting a discussion from the main discussions page, the last page will automatically be loaded and shown.</li>
                                        </ul>
                                    `,
                                    name: `Enable reverse scrolling.`,
                                    sg: true
                                },
                                es_ch: {
                                    name: `Enable for Comment History.`,
                                    sg: true
                                },
                                es_df: {
                                    name: `Enable for Discussion Filters.`,
                                    sg: true
                                },
                                es_dh: {
                                    name: `Enable for Discussions Highlighter.`,
                                    sg: true
                                },
                                es_gb: {
                                    name: `Enable for Giveaway Bookmarks.`,
                                    sg: true
                                },
                                es_ged: {
                                    name: `Enable for Giveaway Encrypter/Decrypter.`,
                                    sg: true
                                },
                                es_ge: {
                                    name: `Enable for Giveaways Extractor.`,
                                    sg: true
                                },
                                es_gf: {
                                    name: `Enable for Giveaway Filters.`,
                                    sg: true
                                }
                            },
                            name: `Endless Scrolling`,
                            sg: true,
                            st: true
                        },
                        ev: {
                            description: `
                                <ul>
                                    <li>Embeds YouTube and Vimeo videos into the page.</li>
                                    <li>Videos are only embedded if their links are in the [URL](URL) format and are the only content in a line, for example, "[https://youtu.be/ihd9dKek2gc](https://youtu.be/ihd9dKek2gc)" gets embedded, while "[Watch this!](https://youtu.be/ihd9dKek2gc)" and "Watch this: [https://youtu.be/ihd9dKek2gc](https://youtu.be/ihd9dKek2gc)" do not.</li>
                                </ul>
                                <img src="https://i.imgur.com/jE2Xmna.png">
                            `,
                            name: `Embedded Videos`,
                            sg: true,
                            st: true
                        },
                        ff: {
                            description: `
                                <ul>
                                    <li>Fixes the footer so that it stays at the bottom of the window while you scroll down the page.</li>
                                </ul>
                                <img src="https://i.imgur.com/XLE0Wpm.png">
                            `,
                            name: `Fixed Footer`,
                            sg: true,
                            st: true
                        },
                        fh: {
                            description: `
                                <ul>
                                    <li>Fixes the header so that it stays at the top of the window while you scroll down the page.</li>
                                </ul>
                                <img src="https://i.imgur.com/RvvzGj1.png">
                            `,
                            name: `Fixed Header`,
                            sg: true,
                            st: true
                        },
                        fmph: {
                            description: `
                                <ul>
                                    <li>Fixes the main page heading so that it stays at the top of the window while you scroll down the page.</li>
                                </ul>
                                <img src="https://i.imgur.com/Bl7YWNk.png">
                            `,
                            name: `Fixed Main Page Heading`,
                            sg: true,
                            st: true
                        },
                        fs: {
                            description: `
                                <ul>
                                    <li>Fixes the sidebar so that it stays at the left side of the window while you scroll down the page.</li>
                                </ul>
                                <img src="https://i.imgur.com/lD6noac.png">
                            `,
                            name: `Fixed Sidebar`,
                            sg: true,
                        },
                        gdttt: {
                            description: `
                                <ul>
                                    <li>Keeps track of your visited giveaways/discussions/tickets/trades and fades them.</li>
                                </ul>
                            `,
                            features: {
                                gdttt_g: {
                                    name: `Fade visited giveaways.`,
                                    sg: true
                                },
                                gdttt_vg: {
                                    name: `Mark giveaways as visited when visiting them.`,
                                    sg: true
                                },
                                gdttt_vd: {
                                    name: `Mark discussions as visited when visiting them.`,
                                    sg: true
                                },
                                gdttt_vt: {
                                    name: `Mark tickets as visited when visiting them.`,
                                    sg: true
                                },
                                gdttt_vts: {
                                    name: `Mark trades as visited when visiting them.`,
                                    st: true
                                }
                            },
                            name: `Giveaways/Discussions/Tickets/Trades Tracker`,
                            sg: true,
                            st: true
                        },
                        hbs: {
                            description: `
                                <ul>
                                    <li>Hides blacklist stats in the stats page.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/96accb906d4bb1554a2f9ddfaeb0abce1b54b808/687474703a2f2f692e696d6775722e636f6d2f794233705153492e706e67"/>
                            `,
                            name: `Hidden Blacklist Stats`,
                            sg: true
                        },
                        hcp: {
                            description: `
                                <ul>
                                    <li>Hides the community poll.</li>
                                </ul>
                            `,
                            features: {
                                hcp_v: {
                                    name: `Only hide the poll if you already voted.`,
                                    sg: true
                                }
                            },
                            name: `Hidden Community Poll`,
                            sg: true
                        },
                        hr: {
                            description: `
                                <ul>
                                    <li>Refreshes the header icons (created/won/messages for SG and messages for ST) and the points on SG every specified number of minutes.</li>
                                </ul>
                            `,
                            features: {
                                hr_w: {
                                    description: `
                                        <ul>
                                            <li>A heart icon will appear in the title.</li>
                                        </ul>
                                    `,
                                    features: {
                                        hr_w_n: {
                                            name: `Also show as a browser notification.`,
                                            sg: true
                                        },
                                        hr_w_h: {
                                            name: `Only indicate for giveaways ending in X hours.`,
                                            input: true,
                                            sg: true
                                        }
                                    },
                                    name: `Indicate if there are unentered wishlist giveaways open.`,
                                    sg: true
                                },
                                hr_g: {
                                    description: `
                                        <ul>
                                            <li>A trophy icon will appear in the title.</li>
                                        </ul>
                                    `,
                                    features: {
                                        hr_g_n: {
                                            name: `Also show as a browser notification.`,
                                            sg: true
                                        }
                                    },
                                    name: `Indicate if there are unviewed keys for won gifts in the tab title.`,
                                    sg: true
                                },
                                hr_b: {
                                    name: `Keep refreshing in the background when you go to another tab or minimize the browser.`,
                                    sg: true,
                                    st: true
                                },
                                hr_fp: {
                                    name: `Show browser notification if there are 400P or more.`,
                                    sg: true
                                },
                                hr_p: {
                                    name: `Show the number of points in the tab title.`,
                                    sg: true
                                },
                                hr_m: {
                                    features: {
                                        hr_m_n: {
                                            name: `Also show as a browser notification.`,
                                            sg: true,
                                            st: true
                                        }
                                    },
                                    name: `Show the number of unread messages in the tab icon.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            input: true,
                            name: `Header Refresher`,
                            sg: true,
                            st: true
                        },
                        ib: {
                            description: `
                                <ul>
                                    <li>Brings back image borders to SG.</li>
                                </ul>
                            `,
                            name: `Image Borders`,
                            sg: true
                        },
                        lpl: {
                            description: `
                                <ul>
                                    <li>Adds a "Last Page" link to some places that are missing it, for example: discussion pages with 100+ pages, user pages, group pages with 100+ pages.</li>
                                </ul>
                            `,
                            name: `Last Page Link`,
                            sg: true
                        },
                        lpv: {
                            description: `
                                <ul>
                                    <li>Shows your level progress in the main button of the page.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/5226f7a5e2012c40d201d9d2a44f19dd9df8ab18/687474703a2f2f696d6775722e636f6d2f524a6d436e70522e706e67"/>
                            `,
                            name: `Level Progress Visualizer`,
                            sg: true,
                            sync: `Giveaways`
                        },
                        mt: {
                            description: `
                                <ul>
                                    <li>Allows you to tag multiple users/games at the same time.</li>
                                </ul>
                            `,
                            name: `Multi-Tag`,
                            sg: true,
                            st: true
                        },
                        pnot: {
                            description: `
                                <ul>
                                    <li>Moves the pagination navigation to the top of the page.</li>
                                </ul>
                            `,
                            name: `Pagination Navigation On Top`,
                            sg: true,
                            st: true
                        },
                        sto: {
                            description: `
                                <ul>
                                    <li>Opens all links in the same tab.</li>
                                </ul>
                            `,
                            name: `Same Tab Opener`,
                            sg: true,
                            st: true
                        },
                        stbb: {
                            name: `Scroll To Bottom Button`,
                            options: {
                                title: `Show in:`,
                                values: [`Bottom Right Corner`, `Main Page Heading`, `Footer`]
                            },
                            sg: true,
                            st: true
                        },
                        sttb: {
                            name: `Scroll To Top Button`,
                            options: {
                                title: `Show in:`,
                                values: [`Bottom Right Corner`, `Main Page Heading`, `Footer`]
                            },
                            sg: true,
                            st: true
                        },
                        smgb: {
                            description: `
                                <ul>
                                    <li>Transforms every magnifying glass in search fields into buttons.</li>
                                </ul>
                            `,
                            name: `Search Magnifying Glass Button`,
                            sg: true
                        },
                        sk: {
                            description: `
                                <ul>
                                    <li>Performs specific tasks when certain keys are pressed.</li>
                                </ul>
                            `,
                            features: {
                                sk_cp: {
                                    input: `sk_closePopups`,
                                    name: `Close all currently opened popups.`,
                                    sg: true,
                                    st: true
                                },
                                sk_sb: {
                                    input: `sk_searchBox`,
                                    name: `Focus on the search box.`,
                                    sg: true,
                                    st: true
                                },
                                sk_fp: {
                                    input: `sk_firstPage`,
                                    name: `Go to the first page.`,
                                    sg: true,
                                    st: true
                                },
                                sk_pp: {
                                    input: `sk_previousPage`,
                                    name: `Go to the previous page.`,
                                    sg: true,
                                    st: true
                                },
                                sk_np: {
                                    input: `sk_nextPage`,
                                    name: `Go to the next page.`,
                                    sg: true,
                                    st: true
                                },
                                sk_lp: {
                                    input: `sk_lastPage`,
                                    name: `Go to the last page.`,
                                    sg: true,
                                    st: true
                                },
                                sk_tf: {
                                    input: `sk_toggleFilters`,
                                    name: `Toggle the giveaway filters.`,
                                    sg: true
                                },
                                sk_hg: {
                                    input: `sk_hideGame`,
                                    name: `Hide the game when inside of a giveaway.`,
                                    sg: true
                                },
                                sk_hga: {
                                    input: `sk_hideGiveaway`,
                                    name: `Hide the giveaway when inside of a giveaway.`,
                                    sg: true
                                },
                                sk_ge: {
                                    input: `sk_giveawayEntry`,
                                    name: `Enter/leave the giveaway when inside of a giveaway.`,
                                    sg: true
                                },
                                sk_c: {
                                    input: `sk_creator`,
                                    name: `Insert the username of the creator of the giveaway/discussion/trade to the current reply box.`,
                                    sg: true,
                                    st: true
                                },
                                sk_rb: {
                                    input: `sk_replyBox`,
                                    name: `Focus on the reply box.`,
                                    sg: true,
                                    st: true
                                },
                                sk_ru: {
                                    input: `sk_replyUser`,
                                    name: `Insert the username of the user to whom you are replying to the current reply box.`,
                                    sg: true,
                                    st: true
                                },
                                sk_sr: {
                                    input: `sk_submitReply`,
                                    name: `Submit the current reply.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Shortcut Keys`,
                            sg: true,
                            st: true
                        },
                        ttpcc: {
                            description: `
                                <ul>
                                    <li>Shows how much time you have until you hit the point cap when you hover over the points in the header.</li>
                                </ul>
                            `,
                            name: `Time To Point Cap Calculator`,
                            sg: true
                        },
                        ts: {
                            description: `
                                <ul>
                                    <li>Allows you to sort tables.</li>
                                </ul>
                                <img src="http://i.imgur.com/hmWWriM.png"/>
                            `,
                            name: `Tables Sorter`,
                            sg: true,
                            st: true
                        },
                        vai: {
                            conflicts: [
                                {id: `ail`, name: `Attached Images Loader`}
                            ],
                            description: `
                                <ul>
                                    <li>Shows all attached images by default.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/e12760aaef77b2d9f6832190291ca43fab1d0622/687474703a2f2f692e696d6775722e636f6d2f496f5a374a684b2e706e67"/>
                            `,
                            features: {
                                vai_gifv: {
                                    name: `Rename .gifv images to .gif, so they are properly attached.`,
                                    sg: true,
                                    st: true
                                },
                                vai_i: {
                                    name: `Disable for the inbox page.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Visible Attached Images`,
                            sg: true,
                            st: true
                        }
                    }
                },
                giveaways: {
                    features: {
                        ags: {
                            description: `
                                <ul>
                                    <li>Allows you to easily search giveaways using SG's <a href="https://www.steamgifts.com/discussion/8SzdT/">search parameters</a>.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/bf5009c96f65689933567f1a34718682533b7836/687474703a2f2f692e696d6775722e636f6d2f5248596d4147732e706e67"/>
                            `,
                            name: `Advanced Giveaway Search`,
                            sg: true
                        },
                        as: {
                            description: `
                                <ul>
                                    <li>Allows you to search the archive by exact title/app id.</li>
                                </ul>
                            `,
                            name: `Archive Searcher`,
                            sg: true
                        },
                        bgl: {
                            description: `
                                <p>
                                    You will find the feature in the following URLs:
                                    <br/>
                                    <br/>
                                    <code>steamgifts.com/giveaway/*</code>
                                </p>
                                <ul>
                                    <li>Loads giveaways that you cannot access because of blacklist issues as if you were not logged in, allowing you to view them without having to actually log out or open them in an incognito window.</li>
                                </ul>
                            `,
                            name: `Blacklist Giveaway Loader`,
                            sg: true
                        },
                        cec: {
                            description: `
                                <p>
                                    You will find the feature in the following URLs:
                                    <br/>
                                    <br/>
                                    <code>steamgifts.com/giveaway/*</code>
                                </p>
                                <ul>
                                    <li>Checks how many users commented without entering, how many users entered without commenting, and how many users commented & entered in a giveaway.</li>
                                    <li>If the giveaway has a bump link it will also check for comments in the discussion.</li>
                                </ul>
                            `,
                            name: `Comments/Entries Checker`,
                            sg: true
                        },
                        cewgd: {
                            description: `
                                <ul>
                                    <li>Adds more details to the created/entered/won pages, such as the number of points, the link to the Steam store page of the game, the name of the creator, the type of the giveaway and the level. It also loads the giveaway groups below the giveaway if Giveaway Groups Loader is enabled.</li>
                                </ul>
                            `,
                            name: `Created/Entered/Won Giveaway Details`,
                            sg: true
                        },
                        cwsl: {
                            description: `
                                <ul>
                                    <li>Adds links to the community wishlist that allows you to search for all active giveaways of a game that are visible to you.</li>
                                </ul>
                            `,
                            name:  `Community Wishlist Search Links`,
                            new: true,
                            sg: true
                        },
                        dkc: {
                            description: `
                                <ul>
                                    <li>Shows a confirmation window when trying to delete keys on the giveaway winners page.</li>
                                </ul>
                            `,
                            name: `Delete Keys Confirmation`,
                            sg: true
                        },
                        elgb: {
                            description: `
                                <ul>
                                    <li>Allows you to quickly enter giveaways from any page.</li>
                                </ul>
                            `,
                            features: {
                                elgb_d: {
                                    name: `Pop up the giveaway description when entering, if it has any.`,
                                    sg: true
                                },
                                elgb_c: {
                                    name: `Cache repeated descriptions from the same creator for 1 hour and only show them once.`,
                                    sg: true
                                },
                                elgb_f: {
                                    input: true,
                                    name: `Filter out useless descriptions.`,
                                    sg: true
                                },
                                elgb_p: {
                                    description: `
                                        <ul>
                                            <li>Only shows the enter button in popups (Giveaway Encrypter/Decrypter, Giveaways Extractor, etc...), basically any giveaway that is loaded dynamically by the script.</li>
                                        </ul>
                                    `,
                                    name: `Only enable for popups.`,
                                    sg: true
                                },
                                elgb_r: {
                                    features: {
                                        elgb_r_d: {
                                            name: `Only pop up if the giveaway has a description.`,
                                            sg: true
                                        }
                                    },
                                    name: `Pop up a box to reply to the giveaway when entering.`,
                                    sg: true
                                }
                            },
                            name: `Enter/Leave Giveaway Button`,
                            sg: true
                        },
                        et: {
                            description: `
                                <ul>
                                    <li>Tracks your entries and allows you to see your average/history.</li>
                                </ul>
                                <img src="http://i.imgur.com/HfLPZTd.png"/>
                                <img src="http://i.imgur.com/d9YgvBp.png"/>
                            `,
                            name: `Entries Tracker`,
                            sg: true
                        },
                        gb: {
                            description: `
                                <ul>
                                    <li>Allows you to bookmark giveaways to enter later.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/a774e048e349d066cdc7b8122e3a9a58da58adc2/687474703a2f2f692e696d6775722e636f6d2f36653855794c332e706e67"/>
                            `,
                            features: {
                                gb_h: {
                                    description: `
                                        <ul>
                                            <li>Giveaways that have not started yet will not appear in the list of bookmarked giveaways. Instead, they will stay in a sort of hidden state until they start. When they start, the header bookmark button will turn green, indicating that you must open the list of bookmarked giveaways so that the started giveaways can be updated with their end times.</li>
                                            <li>When giveaways are about to end, the button will red.</li>
                                            <li>If there are both started and ending giveaways, the button will be colored with a brown-ish color.</li>
                                            <li>Hovering over the button also gives you more details about how many giveaways have started and/or are ending.</li>
                                        </ul>
                                        <img src="https://camo.githubusercontent.com/b049009beacaba74aa340d8c6760c39c200b8366/687474703a2f2f692e696d6775722e636f6d2f6b4e7845445a562e706e67"/>
                                        <img src="https://camo.githubusercontent.com/6366d5af053ed27538ddc352a2dffb0f75da1756/687474703a2f2f692e696d6775722e636f6d2f374f41595861392e706e67"/>
                                    `,
                                    input: true,
                                    name: `Highlight the button when giveaways have started and/or are about to end.`,
                                    sg: true
                                },
                                gb_se: {
                                    name: `Show the button for entered giveaways.`,
                                    sg: true
                                },
                                gb_ue: {
                                    name: `Automatically unbookmark entered giveaways.`,
                                    sg: true
                                },
                                gb_u: {
                                    description: `
                                        <ul>
                                            <li>If disabled, ended giveaways will remain in the bookmarked list until manually unbookmarked.</li>
                                        </ul>
                                    `,
                                    name: `Automatically unbookmark ended giveaways.`,
                                    sg: true
                                },
                                gb_t: {
                                    name: `Open in a new tab.`,
                                    sg: true
                                }
                            },
                            name: `Giveaway Bookmarks`,
                            sg: true
                        },
                        gch: {
                            description: `
                                <ul>
                                    <li>Highlights the number of copies in giveaways with bold and red.</li>
                                </ul>
                                <img src="http://i.imgur.com/IF32HZ5.png"/>
                            `,
                            name: `Giveaway Copies Highlighter`,
                            sg: true
                        },
                        gcl: {
                            description: `
                                <ul>
                                    <li>Allows you to easily see the list of countries for a region restricted giveaway by hovering over the region restricted icon.</li>
                                </ul>
                            `,
                            name: `Giveaway Countries Loader`,
                            options: {
                                title: `Load as:`,
                                values: [`Popout (On Hover)`, `Popout (On Click)`, `Popup (On Click)`]
                            },
                            sg: true
                        },
                        ged: {
                            features: {
                                ged_t: {
                                    name: `Open in a new tab.`,
                                    sg: true
                                }
                            },
                            name: `Giveaway Encrypter/Decrypter`,
                            sg: true
                        },
                        gesl: {
                            // by Royalgamer06
                            description: `
                                <ul>
                                    <li>Provides search links for the game when you cannot access a giveaway.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/030a1474fdbb0b0bbc12b5e0e07937934de227eb/687474703a2f2f692e696d6775722e636f6d2f474d36625833732e706e67"/>
                            `,
                            name: `Giveaway Error Search Links`,
                            sg: true
                        },
                        gf: {
                            description: `
                                <ul>
                                    <li>Allows you to filter giveaways.</li>
                                    <li>Supports Game Categories.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/d302b8f1a79edae54fd32c943201f452e6378802/687474703a2f2f692e696d6775722e636f6d2f457a344e794d6d2e706e67"/>
                            `,
                            features: {
                                gf_s: {
                                    description: `
                                        <ul>
                                            <li>Allows you to hide individual giveaways.</li>
                                            <li>Hidden giveaways can only be unhidden through the settings menu.</li>
                                        </ul>
                                    `,
                                    name: `Single Filters`,
                                    sg: true
                                },
                                gf_m: {
                                    description: `
                                        <ul>
                                            <li>Allows you to filter giveaways.</li>
                                        </ul>
                                    `,
                                    features: {
                                        gf_level: {
                                            name: `Level`,
                                            sg: true
                                        },
                                        gf_entries: {
                                            name: `Entries`,
                                            sg: true
                                        },
                                        gf_copies: {
                                            name: `Copies`,
                                            sg: true
                                        },
                                        gf_points: {
                                            name: `Points`,
                                            sg: true
                                        },
                                        gf_minutesToEnd: {
                                            name: `Minutes To End`,
                                            sg: true
                                        },
                                        gf_chance: {
                                            name: `Chance`,
                                            sg: true
                                        },
                                        gf_ratio: {
                                            name: `Ratio`,
                                            sg: true
                                        },
                                        gf_rating: {
                                            name: `Rating`,
                                            sg: true
                                        },
                                        gf_pinned: {
                                            name: `Pinned`,
                                            sg: true
                                        },
                                        gf_group: {
                                            name: `Group`,
                                            sg: true
                                        },
                                        gf_whitelist: {
                                            name: `Whitelist`,
                                            sg: true
                                        },
                                        gf_regionRestricted: {
                                            name: `Region Restricted`,
                                            sg: true
                                        },
                                        gf_created: {
                                            name: `Created`,
                                            sg: true
                                        },
                                        gf_received: {
                                            name: `Received`,
                                            sg: true
                                        },
                                        gf_notReceived: {
                                            name: `Not Received`,
                                            sg: true
                                        },
                                        gf_awaitingFeedback: {
                                            name: `Awaiting Feedback`,
                                            sg: true
                                        },
                                        gf_entered: {
                                            name: `Entered`,
                                            sg: true
                                        },
                                        gf_started: {
                                            name: `Started`,
                                            sg: true
                                        },
                                        gf_ended: {
                                            name: `Ended`,
                                            sg: true
                                        },
                                        gf_deleted: {
                                            name: `Deleted`,
                                            sg: true
                                        },
                                        gf_owned: {
                                            name: `Owned`,
                                            sg: true
                                        },
                                        gf_wishlisted: {
                                            name: `Wishlisted`,
                                            sg: true
                                        },
                                        gf_hidden: {
                                            name: `Hidden`,
                                            sg: true
                                        },
                                        gf_ignored: {
                                            name: `Ignored`,
                                            sg: true
                                        },
                                        gf_previouslyEntered: {
                                            name: `Previously Entered`,
                                            sg: true
                                        },
                                        gf_previouslyWon: {
                                            name: `Previously Won`,
                                            sg: true
                                        },
                                        gf_fullCV: {
                                            name: `Full CV`,
                                            sg: true
                                        },
                                        gf_reducedCV: {
                                            name: `Reduced CV`,
                                            sg: true
                                        },
                                        gf_noCV: {
                                            name: `No CV`,
                                            sg: true
                                        },
                                        gf_removed: {
                                            name: `Removed`,
                                            sg: true
                                        },
                                        gf_tradingCards: {
                                            name: `Trading Cards`,
                                            sg: true
                                        },
                                        gf_achievements: {
                                            name: `Achievements`,
                                            sg: true
                                        },
                                        gf_multiplayer: {
                                            name: `Multiplayer`,
                                            sg: true
                                        },
                                        gf_steamCloud: {
                                            name: `Steam Cloud`,
                                            sg: true
                                        },
                                        gf_linux: {
                                            name: `Linux`,
                                            sg: true
                                        },
                                        gf_mac: {
                                            name: `Mac`,
                                            sg: true
                                        },
                                        gf_dlc: {
                                            name: `DLC`,
                                            sg: true
                                        },
                                        gf_dlcFree: {
                                            name: `DLC (Free Base)`,
                                            sg: true
                                        },
                                        gf_dlcNonFree: {
                                            name: `DLC (Non-Free Base)`,
                                            sg: true
                                        },
                                        gf_package: {
                                            name: `Package`,
                                            sg: true
                                        },
                                        gf_genres: {
                                            name: `Genres`,
                                            sg: true
                                        }
                                    },
                                    name: `Multiple Filters`,
                                    sg: true
                                }
                            },
                            name: `Giveaway Filters`,
                            sg: true,
                            sync: `Hidden Games, Owned/Wishlisted/Ignored Games, Won Games, Reduced CV Games, No CV Games and Giveaways`
                        },
                        ggl: {
                            description: `
                                <ul>
                                    <li>Allows you to easily see the list of groups for a giveaway.</li>
                                    <li>Groups that you are a member of are highlighted.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/47417953189500c9f18a5d30bf528e1b8ce30342/687474703a2f2f692e696d6775722e636f6d2f504e37337068762e706e67"/>
                            `,
                            features: {
                                ggl_m: {
                                    name: `Only show groups that you're a member of.`,
                                    sg: true
                                }
                            },
                            name: `Giveaway Groups Loader`,
                            options: {
                                title: `Load as:`,
                                values: [`Panel (On Page Load)`, `Popout (On Hover)`, `Popout (On Click)`, `Popup (On Click)`]
                            },
                            sg: true,
                            sync: `Steam Groups`
                        },
                        gr: {
                            description: `
                                <ul>
                                    <li>Adds an icon to ended giveaways with 0 entries in your profile or inside of the giveaways that allows you to recreate those giveaways.</li>
                                </ul>
                                <img src="http://i.imgur.com/DReWyEi.png"/>
                            `,
                            features: {
                                gr_r: {
                                    name: `Remove the button for giveaways that have been recreated.`,
                                    sg: true
                                }
                            },
                            name: `Giveaway Recreator`,
                            sg: true
                        },
                        gp: {
                            description: `
                                <ul>
                                    <li>Same popup from Enter/Leave Giveaway Button, except it doesn't enter the giveaway before opening the popup, which allows you to see the giveaway description or add a comment to the giveaway without entering it.</li>
                                </ul>
                                <img src="https://i.imgur.com/HV3SfSx.png"/>
                            `,
                            name: `Giveaway Popup`,
                            sg: true
                        },
                        gts: {
                            description: `
                                <ul>
                                    <li>Allows you to save giveaway templates for later use.</li>
                                </ul>
                            `,
                            name: `Giveaway Templates`,
                            sg: true
                        },
                        gwl: {
                            description: `
                                <ul>
                                    <li>Adds a link to the winners page of ended giveaways.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/c7253c39157cbde30b3337b90267260de33e4cab/687474703a2f2f692e696d6775722e636f6d2f67326b614644392e706e67"/>
                            `,
                            name: `Giveaway Winners Link`,
                            sg: true
                        },
                        gwc: {
                            description: `
                                <ul>
                                    <li>Calculates your winning chance for a giveaway.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/3f161b5a39d4723ac361a93e74b7beedc3cd5cd5/687474703a2f2f692e696d6775722e636f6d2f50696235546f6d2e706e67"/>
                            `,
                            features: {
                                gwc_e: {
                                    name: `Show what the chance will be when you enter the giveaway instead of the current chance.`,
                                    sg: true
                                },
                                gwc_a: {
                                    description: `
                                        <ul>
                                            <li>Uses an advanced formula to calculate the chance based on how long ago the giveaway was created, how many entries it currently has, and how long it is until the giveaway ends.</li>
                                        </ul>
                                    `,
                                    features: {
                                        gwc_a_b: {
                                            name: `Show the basic chance along with the advanced one (the advanced chance will appear in a parenthesis: "Basic% (Advanced%)").`,
                                            sg: true
                                        }
                                    },
                                    name: `Use advanced formula.`,
                                    sg: true
                                }
                            },
                            name: `Giveaway Winning Chance`,
                            sg: true
                        },
                        gwr: {
                            description: `
                                <ul>
                                    <li>Calculates your winning ratio for a giveaway.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/3f161b5a39d4723ac361a93e74b7beedc3cd5cd5/687474703a2f2f692e696d6775722e636f6d2f50696235546f6d2e706e67"/>
                            `,
                            features: {
                                gwr_e: {
                                    name: `Show what the ratio will be when you enter the giveaway instead of the current ratio.`,
                                    sg: true
                                },
                                gwr_a: {
                                    description: `
                                        <ul>
                                            <li>Uses an advanced formula to calculate the chance based on how long ago the giveaway was created, how many entries it currently has, and how long it is until the giveaway ends.</li>
                                        </ul>
                                    `,
                                    features: {
                                        gwr_a_b: {
                                            name: `Show the basic ratio along with the advanced one (the advanced ratio will appear in a parenthesis: "Basic% (Advanced%)").`,
                                            sg: true
                                        }
                                    },
                                    name: `Use advanced formula.`,
                                    sg: true
                                }
                            },
                            name: `Giveaway Winning Ratio`,
                            sg: true
                        },
                        ge: {
                            description: `
                                <ul>
                                    <li>Extracts all giveaways linked from a discussion/giveaway.</li>
                                    <li>You will find the button in discussions/giveaways that have a giveaway link.</li>
                                </ul>
                            `,
                            features: {
                                ge_p: {
                                    background: true,
                                    name: `Highlight public giveaways.`,
                                    sg: true
                                },
                                ge_g: {
                                    background: true,
                                    name: `Highlight group giveaways.`,
                                    sg: true
                                },
                                ge_b: {
                                    background: true,
                                    name: `Highlight giveaways that cannot be entered because of blacklist issues.`,
                                    sg: true
                                },
                                ge_o: {
                                    description: `
                                        <ul>
                                            <li>The default behavior of the extractor is to extract all giveaways. So, for example, if you enter a train in the 8th cart, the extractor will go back all the way to the 1st cart before continuing to the 9th cart. Enable this option to make the extractor ignore the 1st-7th carts in this example.</li>
                                            <li>This method is not 100% accurate. If the link to the next giveaway does not contain a "next" variation or a counter, the extraction will stop.</li>
                                        </ul>
                                    `,
                                    name: `Only extract from the current giveaway onwards.`,
                                    sg: true
                                },
                                ge_t: {
                                    name: `Open in a new tab.`,
                                    sg: true
                                }
                            },
                            name: `Giveaways Extractor`,
                            sg: true
                        },
                        gm: {
                            description: `
                                <ul>
                                    <li>Allows you to manage your created giveaways by exporting them to specific formats and searching & replacing something in their description.</li>
                                </ul>
                                <img src="http://i.imgur.com/fSBKj9Z.png"/>
                            `,
                            name: `Giveaways Manager`,
                            sg: true
                        },
                        gas: {
                            description: `
                                <ul>
                                    <li>Allows you to sort giveaways.</li>
                                </ul>
                            `,
                            name: `Giveaways Sorter`,
                            sg: true
                        },
                        gv: {
                            description: `
                                <ul>
                                    <li>Shows giveaways as a grid.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/daaefaee73d0f1f51fb7f830064cdd97d0455998/687474703a2f2f692e696d6775722e636f6d2f6a6864316d34412e706e67"/>
                            `,
                            features: {
                                gv_gb: {
                                    name: `Extend to Giveaway Bookmarks.`,
                                    sg: true
                                },
                                gv_ged: {
                                    name: `Extend to Giveaway Encrypter / Decrypter.`,
                                    sg: true
                                },
                                gv_ge: {
                                    name: `Extend to Giveaways Extractor.`,
                                    sg: true
                                }
                            },
                            name: `Grid View`,
                            sg: true
                        },
                        hfc: {
                            description: `
                                <ul>
                                    <li>Hides the featured container in the main pages.</li>
                                </ul>
                            `,
                            name: `Hidden Featured Container`,
                            sg: true
                        },
                        hgebd: {
                            description: `
                                <ul>
                                    <li>Disables the enter button for giveaways for games that you have hidden.</li>
                                </ul>
                            `,
                            name: `Hidden Games Enter Button Disabler`,
                            sg: true,
                            sync: `Hidden Games`
                        },
                        hgr: {
                            description: `
                                <ul>
                                    <li>Allows you to remove owned games from the <a href="https://www.steamgifts.com/account/settings/giveaways/filters">hidden list</a>.</li>
                                </ul>
                                <img src="http://i.imgur.com/a653YCb.png"/>
                            `,
                            name: `Hidden Games Remover`,
                            sg: true
                        },
                        hpg: {
                            description: `
                                <ul>
                                    <li>Hides the pinned giveaways in the main pages.</li>
                                </ul>
                            `,
                            name: `Hidden Pinned Giveaways`,
                            sg: true
                        },
                        itadi: {
                            description: `
                                <ul>
                                    <li>Adds Is There Any Deal? info to giveaway pages, including the best current deal, the historical lowest price (optional) and the list of bundles that the game has been in, with a cache that can be updated after 24 hours since the last check.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/0d413190b988c4d78ca53abd89f4101b60693491/687474703a2f2f692e696d6775722e636f6d2f65704632616d332e706e67"/>
                            `,
                            features: {
                                itadi_h: {
                                    name: `Also load the historical lowest price of the game (takes longer).`,
                                    sg: true
                                }
                            },
                            name: `Is There Any Deal? Info`,
                            sg: true
                        },
                        mgc: {
                            description: `
                                <ul>
                                    <li>Allows you to create multiple giveaways or a train of giveaways (multiple giveaways that are linked to one another).</li>
                                    <li>You can view detailed information about a giveaway by hovering over it.</li>
                                    <li>You can re-order/remove the giveaways by dragging and dropping them in the correspondent areas.</li>
                                    <li>All giveaways will be created without reviewing or validating, so make sure all fields are filled correctly, or the giveaway creation will fail (if a train is being created, the failed giveaway will be disconnected and the previous giveaway will be connected to the next instead).</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/1b21ba088a8cdeefbc8787636e7084eddb1c5b84/687474703a2f2f692e696d6775722e636f6d2f5066396a37674e2e706e67"/>
                            `,
                            name: `Multiple Giveaways Creator`,
                            sg: true
                        },
                        npth: {
                            description: `
                                <ul>
                                    <li>Allows you to move across trains using hotkeys (use Ctrl with the hotkeys to open the giveaways in new tabs). Does not work if you are typing in an input/text area.</li>
                                </ul>
                            `,
                            name: `Next/Previous Train Hotkeys`,
                            input: true,
                            sg: true
                        },
                        ochgb: {
                            description: `
                                <ul>
                                    <li>Allows you to hide giveaways with one click.</li>
                                </ul>
                            `,
                            features: {
                                ochgb_f: {
                                    name: `Fade hidden giveaways instead of removing them.`,
                                    sg: true
                                }
                            },
                            name: `One-Click Hide Giveaway Button`,
                            sg: true
                        },
                        pgb: {
                            description: `
                                <ul>
                                    <li>Allows you to collapse the pinned giveaways container after expanding it.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/50049f73629b0d6dc17a41fcd52e2184d69b2035/687474703a2f2f692e696d6775722e636f6d2f6f6958644c78332e706e67"/>
                            `,
                            name: `Pinned Giveaways Button`,
                            sg: true
                        },
                        qgb: {
                            description: `
                                <ul>
                                    <li>Allows you to quickly go to wishlist/recommended/group/new giveaways from any page.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/e831648032c40835a77ba90a0cad0a38be1ca9e2/687474703a2f2f696d6775722e636f6d2f4e4467717a466a2e706e67"/>
                            `,
                            name: `Quick Giveaway Browsing`,
                            sg: true
                        },
                        qgs: {
                            description: `
                                <ul>
                                    <li>Allows you to quickly search giveaways from any page.</li>
                                </ul>
                                <img src="https://i.imgur.com/JRT6tv6.png">
                            `,
                            features: {
                                qgs_h: {
                                    name: `Hide the native search when on the main giveaway pages.`,
                                    sg: true
                                }
                            },
                            name: `Quick Giveaway Search`,
                            sg: true
                        },
                        rcvc: {
                            decription: `
                                <ul>
                                    <li>Calculates how much real CV you should get for a giveaway.</li>
                                    <li>It's only accurate if you have synced the reduced CV/no CV lists from the settings menu and also scanned your sent giveaways using User Giveaways Data. But even then, it's only 100% accurate if the user has 0 not received giveaways, since User Giveaways Data doesn't currently know if the giveaways have been received or not.</li>
                                </ul>
                                <p>In the example below, as I had previously given away 3 copies of Max Payne 3, the sixth copy is worth 10% less (18P). So the 3 new copies would equal 58P:</p>
                                <img src="https://camo.githubusercontent.com/7b57fc903dddbf988ec3b700412fbfcd16bfed3a/687474703a2f2f692e696d6775722e636f6d2f6f4347537455712e706e67"/>
                            `,
                            name: `Real CV Calculator`,
                            sg: true,
                            sync: `Giveaways`
                        },
                        sks: {
                            description: `
                                <ul>
                                    <li>Allows you to search all your sent giveaways for certain keys to check if you have already made giveaways with those keys.</li>
                                    <li>Allows you to export all keys you ever sent to a text file.</li>
                                </ul>
                            `,
                            name: `Sent Keys Searcher`,
                            sg: true
                        },
                        sal: {
                            description: `
                                <ul>
                                    <li>Allows you to easily activate won games.</li>
                                    <li>The key is automatically copied when clicking the button.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/e16ae91d578df91e788ec62ea9623984b71247b9/687474703a2f2f692e696d6775722e636f6d2f30686e593079442e706e67"/>
                            `,
                            name: `Steam Activation Links`,
                            options: {
                                title: `Show links to:`,
                                values: [`Steam Client`, `Browser`, `Both`]
                            },
                            sg: true
                        },
                        sgac: {
                            description: `
                                <ul>
                                    <li>Allows you to sticky countries so that they appear at the top of the country list while creating a giveaway.</li>
                                </ul>
                            `,
                            name: `Stickied Giveaway Countries`,
                            sg: true
                        },
                        sgg: {
                            description: `
                                <ul>
                                    <li>Allows you to sticky groups so that they appear at the top of the group list while creating a giveaway.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/171d8b4db67798b71e9d758ae1e25e5314c5dd4b/687474703a2f2f692e696d6775722e636f6d2f3551654b4f37652e706e67"/>
                            `,
                            name: `Stickied Giveaway Groups`,
                            sg: true
                        },
                        ttec: {
                            description: `
                                <ul>
                                    <li>Calculates how much time you have to wait until you have enough points to enter a giveaway.</li>
                                </ul>
                                <img src="https://i.imgur.com/3z6t263.png">
                            `,
                            name: `Time To Enter Calculator`,
                            sg: true
                        },
                        ueg: {
                            description: `
                                <ul>
                                    <li>Removes SG's default fade for entered giveaways.</li>
                                </ul>
                            `,
                            name: `Unfaded Entered Giveaways`,
                            sg: true
                        },
                        ugb: {
                            description: `
                                <ul>
                                    <li>Allows you to unhide giveaways directly from the main/giveaway pages.</li>
                                </ul>
                            `,
                            name: `Unhide Giveaway Button`,
                            sg: true
                        },
                        ugs: {
                            description: `
                                <ul>
                                    <li>Allows you to send all your unsent gifts directly from your created page.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/2c54c2015bc7bd8c3aa5f79afa3a4065e4d6e94a/687474703a2f2f692e696d6775722e636f6d2f363977626b55502e706e67"/>
                            `,
                            name: `Unsent Gifts Sender`,
                            sg: true
                        }
                    },
                    newBelow: true

                },
                discussions: {
                    features: {
                        adots: {
                            description: `
                                <ul>
                                    <li>Moves the active discussions to the top/sidebar of the page.</li>
                                </ul>
                                <p>More about the sidebar option:</p>
                                <ul>
                                    <li>If you have Advanced Giveaway Search enabled, it will be hidden and triggered when hovering hover the search field.</li>
                                    <li>The username and avatar of the user who last posted will be removed (the button to go to the last comment will remain intact).</li>
                                    <li>Accurate Timestamps will not run for any timestamps inside the active discussions.</li>
                                    <li>Any user tags you might have saved for users will be hidden inside the active discussions (they will still be visible if you click the tag button to edit them).</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/9f0ebf4ffbf3489529819653853c6cc725cc0047/687474703a2f2f692e696d6775722e636f6d2f584565726f566e2e706e67"/>
                            `,
                            name: `Active Discussions On Top/Sidebar`,
                            options: {
                                title: `Move to:`,
                                values: [`Top`, `Sidebar`]
                            },
                            sg: true
                        },
                        codb: {
                            description: `
                                <ul>
                                    <li>Allows you to close/open discussions without having to enter them.</li>
                                </ul>
                            `,
                            name: `Close/Open Discussion Button`,
                            sg: true
                        },
                        ded: {
                            description: `
                                <ul>
                                    <li>Detects if the discussion you're posting a comment to has been edited since the time you opened it and saves your comment correctly.</li>
                                    <li>This fixes a bug on SteamGifts that does not save your comment to a discussion if you submit it after the discussion has been edited.</li>
                                    <li>The feature also replaces every single native "Submit" button with its own "Submit" button, to gather info about comments when posting, which is required for some comment features, like Comment History.</li>
                                </ul>
                            `,
                            name: `Discussion Edits Detector`,
                            sg: true,
                            st: true
                        },
                        df: {
                            description: `
                                <ul>
                                    <li>Allows you to filter discussions.</li>
                                </ul>
                            `,
                            features: {
                                df_s: {
                                    description: `
                                        <ul>
                                            <li>Allows you to hide individual discussions.</li>
                                            <li>Hidden discussions can only be unhidden through the settings menu.</li>
                                        </ul>
                                    `,
                                    name: `Single Filters`,
                                    sg: true
                                },
                                df_m: {
                                    description: `
                                        <ul>
                                            <li>Allows you to filter discussions.</li>
                                        </ul>
                                    `,
                                    features: {
                                        df_comments: {
                                            name: `Comments`,
                                            sg: true
                                        },
                                        df_announcements: {
                                            name: `Announcements`,
                                            sg: true
                                        },
                                        df_bugsSuggestions: {
                                            name: `Bugs / Suggestions`,
                                            sg: true
                                        },
                                        df_deals: {
                                            name: `Deals`,
                                            sg: true
                                        },
                                        df_general: {
                                            name: `General`,
                                            sg: true
                                        },
                                        df_groupRecruitment: {
                                            name: `Group Recruitment`,
                                            sg: true
                                        },
                                        df_letsPlayTogether: {
                                            name: `Let's Play Together`,
                                            sg: true
                                        },
                                        df_offTopic: {
                                            name: `Off-Topic`,
                                            sg: true
                                        },
                                        df_puzzles: {
                                            name: `Puzzles`,
                                            sg: true
                                        },
                                        df_uncategorized: {
                                            name: `Uncategorized`,
                                            sg: true
                                        },
                                        df_created: {
                                            name: `Created`,
                                            sg: true
                                        },
                                        df_poll: {
                                            name: `Poll`,
                                            sg: true
                                        },
                                        df_highlighted: {
                                            name: `Highlighted`,
                                            sg: true
                                        },
                                        df_visited: {
                                            name: `Visited`,
                                            sg: true
                                        },
                                        df_unread: {
                                            name: `Unread`,
                                            sg: true
                                        }
                                    },
                                    name: `Multiple Filters`,
                                    sg: true
                                }
                            },
                            name: `Discussion Filters`,
                            sg: true
                        },
                        dh: {
                            description: `
                                <ul>
                                    <li>Allows you to highlight discussions.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/62f0877abb79ad392f24d92bc096c947398f9344/687474703a2f2f692e696d6775722e636f6d2f41326f313479772e706e67"/>
                            `,
                            features: {
                                dh_t: {
                                    name: `Bring the highlighted discussions to the top of the page if there are any in the current page.`,
                                    sg: true
                                }
                            },
                            name: `Discussions Highlighter`,
                            sg: true
                        },
                        ds: {
                            description: `
                                <ul>
                                    <li>Allows you to sort discussions by creation date (from newest to oldest).</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/9fd9d276d5c6fc9377b2b9f36fe69c8d4d39562d/687474703a2f2f692e696d6775722e636f6d2f704d416f5671392e706e67"/>
                            `,
                            name: `Discussions Sorter`,
                            sg: true
                        },
                        mpp: {
                            description: `
                                <ul>
                                    <li>Hides the main post of discussions and adds a button that pops it up.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/8bc51996cbe378add7adecf071cdc747a711e384/687474703a2f2f692e696d6775722e636f6d2f6c4139514e4c4d2e706e67"/>
                            `,
                            features: {
                                mpp_r: {
                                    name: `Only hide the main post if it has been marked as read (requires Comment Tracker).`,
                                    sg: true
                                }
                            },
                            name: `Main Post Popup`,
                            sg: true
                        },
                        mps: {
                            description: `
                                <ul>
                                    <li>Skips to the comments of a discussion if you've used pagination navigation. For example, you enter a discussion and go to page 2, on page 2 the feature will skip the main post and take you directly to the comments.</li>
                                </ul>
                            `,
                            name: `Main Post Skipper`,
                            sg: true
                        },
                        oadd: {
                            description: `
                                <ul>
                                    <li>Brings back SG's old active discussions design, while keeping the new Deals section.</li>
                                </ul>
                            `,
                            features: {
                                oadd_d: {
                                    description: `
                                        <ul>
                                            <li>By default, deals are excluded from the discussions section, since they can be accessed by clicking the top left button in the active discussions container.</li>
                                        </ul>
                                    `,
                                    name: `Show deals in the discussions section.`,
                                    sg: true
                                }
                            },
                            name: `Old Active Discussions Design`,
                            sg: true
                        },
                        pm: {
                            description: `
                                <ul>
                                    <li>Allows you to mark discussions categorized as puzzles as unsolved/in progress/solved.</li>
                                </ul>
                            `,
                            features: {
                                pm_a: {
                                    name: `Show the marker for all discussions, regardless of their category.`,
                                    sg: true
                                }
                            },
                            name: `Puzzle Marker`,
                            sg: true,
                        },
                        qdb: {
                            description: `
                                <ul>
                                    <li>Allows you to quickly go to each discussion category from any page.</li>
                                </ul>
                                <img src="https://i.imgur.com/OuIgfok.png">
                            `,
                            name: `Quick Discussion Browsing`,
                            new: true,
                            sg: true
                        },
                        radb: {
                            description: `
                                <ul>
                                    <li>Allows you to refresh the active discussions without having to refresh the entire page.</li>
                                </ul>
                            `,
                            name: `Refresh Active Discussions Button`,
                            sg: true
                        }
                    },
                    newBelow: true
                },
                trades: {
                    features: {
                        tb: {
                            description: `
                                <ul>
                                    <li>Allows you to bump all your current trades with a single click.</li>
                                    <li>You will find the button in you created trades page.</li>
                                </ul>
                            `,
                            features: {
                                tb_a: {
                                    description: `
                                        <ul>
                                            <li>Auto bumps all your trades every hour.</li>
                                            <li>Requires you to leave SG or ST open.</li>
                                        </ul>
                                    `,
                                    name: `Auto bump every hour.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Trades Bumper`,
                            sg: true,
                            st: true
                        }
                    }
                },
                comments: {
                    features: {
                        cerb: {
                            description: `
                                <ul>
                                    <li>Allows you to collapse/expand all replies (level 2+ comments) in a page.</li>
                                </ul>
                            `,
                            features: {
                                cerb_a: {
                                    name: `Automatically collapse all replies when visiting a page.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Collapse/Expand Replies Button`,
                            sg: true,
                            st: true
                        },
                        cfh: {
                            description: `
                                <ul>
                                    <li>Adds a panel that helps you with comment formatting.</li>
                                    <li>Has an option that automatically formats pasted links/images.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/b542cdc0dfcc08a52936603e1da2dcc855ebd33a/687474703a2f2f692e696d6775722e636f6d2f673943336530672e706e67"/>
                            `,
                            features: {
                                cfh_i: {
                                    name: `Italic`,
                                    sg: true,
                                    st: true
                                },
                                cfh_b: {
                                    name: `Bold`,
                                    sg: true,
                                    st: true
                                },
                                cfh_s: {
                                    name: `Spoiler`,
                                    sg: true,
                                    st: true
                                },
                                cfh_st: {
                                    name: `Strikethrough`,
                                    sg: true,
                                    st: true
                                },
                                cfh_h1: {
                                    name: `Heading 1`,
                                    sg: true,
                                    st: true
                                },
                                cfh_h2: {
                                    name: `Heading 2`,
                                    sg: true,
                                    st: true
                                },
                                cfh_h3: {
                                    name: `Heading 3`,
                                    sg: true,
                                    st: true
                                },
                                cfh_bq: {
                                    name: `Blockquote`,
                                    sg: true,
                                    st: true
                                },
                                cfh_lb: {
                                    name: `Line Break`,
                                    sg: true,
                                    st: true
                                },
                                cfh_ol: {
                                    name: `Ordered List`,
                                    sg: true,
                                    st: true
                                },
                                cfh_ul: {
                                    name: `Unordered List`,
                                    sg: true,
                                    st: true
                                },
                                cfh_ic: {
                                    name: `Inline Code`,
                                    sg: true,
                                    st: true
                                },
                                cfh_lc: {
                                    name: `Line Code`,
                                    sg: true,
                                    st: true
                                },
                                cfh_pc: {
                                    name: `Paragraph Code`,
                                    sg: true,
                                    st: true
                                },
                                cfh_l: {
                                    name: `Link`,
                                    sg: true,
                                    st: true
                                },
                                cfh_img: {
                                    name: `Image`,
                                    sg: true,
                                    st: true
                                },
                                cfh_t: {
                                    name: `Table`,
                                    sg: true,
                                    st: true
                                },
                                cfh_e: {
                                    name: `Emojis`,
                                    sg: true,
                                    st: true
                                },
                                cfh_g: {
                                    name: `Giveaway Encrypter`,
                                    sg: true,
                                    st: true
                                },
                                cfh_sr: {
                                    description: `
                                        <ul>
                                            <li>Allows you to save replies that you constantly use to quickly post them later.</li>
                                            <img src="http://i.imgur.com/lJJDNah.png"/>
                                        </ul>
                                    `,
                                    name: `Saved Replies`,
                                    sg: true,
                                    st: true
                                },
                                cfh_cf: {
                                    name: `Comment Formatting`,
                                    sg: true,
                                    st: true
                                },
                                cfh_p: {
                                    features: {
                                        cfh_p_a: {
                                            name: `Automatically preview while typing.`,
                                            sg: true,
                                            st: true
                                        }
                                    },
                                    name: `Preview`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Comment Formatting Helper`,
                            sg: true,
                            st: true
                        },
                        ch: {
                            description: `
                                <ul>
                                    <li>Keeps track of the comments you make (they can be seen from header menu).</li>
                                    <li>This feature <span class="esgst-bold">only</span> works with Main Comment Box Popup, Discussion Edit Detector and Multi-Reply / Reply From Inbox. If you submit a comment though SG's native comment box, the comment will not be tracked.</li>
                                </ul>
                            `,
                            name: `Comment History`,
                            sg: true,
                            st: true
                        },
                        cs: {
                            description: `
                                <ul>
                                    <li>Allows you to search a giveaway/discussion/ticket/trade for comments from specific users.</li>
                                </ul>
                                <img src="http://i.imgur.com/KpcVxXk.png"/>
                                <img src="http://i.imgur.com/y0QykIf.png"/>
                            `,
                            name: `Comment Searcher`,
                            sg: true,
                            st: true
                        },
                        ct: {
                            description: `
                                <ul>
                                    <li>Fades giveaways / discussions / support tickets / trades you have already visited. Note that this does not mean every comment inside the page has been read, it simply means you have visited it.</li>
                                    <li>Keeps track of comments / editions.</li>
                                    <li>To mark a comment as read/unread, click on the eye icon below it.</li>
                                    <li>Keeps track of discussion comments and shows how many comments are unread on the discussions page.</li>
                                    <li>Allows you to go to the first unread comment of a discussion or mark all its comments as read directly from the discussions page.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/2688dcd381fc20a68c3f7d8e5c3aa4b7366efa99/687474703a2f2f692e696d6775722e636f6d2f366e414c6838792e706e67"/>
                                <img src="https://camo.githubusercontent.com/3f0bbfef8a301dcfc91bec0d62e9d20c0b6c45e9/687474703a2f2f692e696d6775722e636f6d2f554362353576692e706e67"/>
                                <img src="https://camo.githubusercontent.com/94672a1b6ebb4adeaad8c311c184ddded32f6afc/687474703a2f2f692e696d6775722e636f6d2f3866504d776a472e706e67"/>
                            `,
                            features: {
                                ct_s: {
                                    description: `
                                        <ul>
                                            <li>Simply shows the number of comments since the last visit.</li>
                                            <li>Marking a discussion as visited with Giveaways/Discussions/Tickets/Trades Tracker will update the count without having to enter the discussion.</li>
                                            <li>Marking a discussion as unvisited will reset the count to 0.</li>
                                        </ul>
                                    `,
                                    features: {
                                        ct_s_h: {
                                            name: `Hide count if you haven't visited the discussion yet.`,
                                            sg: true,
                                            st: true
                                        }
                                    },
                                    name: `Enable simplified version.`,
                                    sg: true,
                                    st: true
                                },
                                ct_a: {
                                    name: `Automatically mark comments as read in the inbox when clicking on the "Mark as Read" button.`,
                                    sg: true,
                                    st: true
                                },
                                ct_r: {
                                    description: `
                                        <ul>
                                            <li>Scans the page from the bottom to top if reverse scrolling is disabled, or from the top to bottom if it's enabled.</li>
                                        </ul>
                                    `,
                                    name: `Search for the first unread comment in reverse order.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Comment Tracker`,
                            sg: true,
                            st: true
                        },
                        cr: {
                            description: `
                                <ul>
                                    <li>Reverses the comments in a page so that they are ordered from newest to oldest.</li>
                                </ul>
                            `,
                            name: `Comments Reverser`,
                            sg: true,
                            st: true
                        },
                        mr: {
                            description: `
                                <ul>
                                    <li>Allows you to reply to multiple comments at the same time, since each comment has their own comment box and the page isn't reloaded after submitting it.</li>
                                    <li>Has Discussion Edit Detector built-in.</li>
                                </ul>
                            `,
                            name: `Multi-Reply`,
                            sg: true,
                            st: true
                        },
                        rrbp: {
                            description: `
                                <ul>
                                    <li>Pops up a reply box when marking a giveaway as received.</li>
                                </ul>
                            `,
                            name: `Received Reply Box Popup`,
                            sg: true
                        },
                        rbot: {
                            description: `
                                <ul>
                                    <li>Moves the reply box to the top of the page.</li>
                                </ul>
                            `,
                            name: `Reply Box On Top`,
                            sg: true,
                            st: true
                        },
                        rbp: {
                            description: `
                                <ul>
                                    <li>Adds a button that pops up a box which allows you to add comments to the page.</li>
                                    <li>Has Discussion Edit Detector built-in.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/7227b3cad4190a531ee5d109303fec7fe747b65d/687474703a2f2f692e696d6775722e636f6d2f436c477a424e532e706e67"/>
                            `,
                            name: `Reply Box Popup`,
                            sg: true,
                            st: true
                        },
                        rfi: {
                            description: `
                                <ul>
                                    <li>Allows you to reply to your messages directly from your inbox.</li>
                                    <li>Has Multi-Reply built-in.</li>
                                </ul>
                            `,
                            features: {
                                rfi_s: {
                                    description: `
                                        <ul>
                                            <li>Saves replies made from the inbox so that they are still there when you refresh the page.</li>
                                            <li>Replies are deleted from the cache after 1 week.</li>
                                            <li>Editing/deleting/undeleting a saved reply also updates its cache and makes it last 1 week longer.</li>
                                        </ul>
                                    `,
                                    name: `Save replies.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Reply From Inbox`,
                            sg: true,
                            st: true
                        },
                        rml: {
                            description: `
                                <ul>
                                    <li>Adds a mention link to the comment replied to.</li>
                                </ul>
                                <img src="https://camo.githubusercontent.com/696ce80a48aa3b78f15dc9deb856fa321a88fd68/687474703a2f2f692e696d6775722e636f6d2f5367457a6a58432e706e67"/>
                            `,
                            name: `Reply Mention Link`,
                            sg: true,
                            st: true
                        }
                    }
                },
                users: {
                    features: {
                        iwh: {
                            name: `Inbox Winners Highlighter`,
                            sg: true
                        },
                        luc: {
                            description: ``,
                            name: `Level Up Calculator`,
                            sg: true
                        },
                        namwc: {
                            description: `
                                <ul>
                                    <li>Allows you to check if a user has any not activated/multiple wins.</li>
                                </ul>
                            `,
                            features: {
                                namwc_h: {
                                    description: ``,
                                    features: {
                                        namwc_h_i: {
                                            description: ``,
                                            name: `Use icons instead of colors.`,
                                            sg: true,
                                            st: true
                                        },
                                        namwc_h_f: {
                                            name: `Only highlight users who failed to pass the check.`,
                                            sg: true,
                                            st: true
                                        },
                                        namwc_h_m: {
                                            name: `Highlight multiple wins as positive.`,
                                            sg: true,
                                            st: true
                                        }
                                    },
                                    name: `Highlight checked users.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Not Activated/Multiple Wins Checker`,
                            sg: true
                        },
                        nrf: {
                            description: ``,
                            name: `Not Received Finder`,
                            sg: true
                        },
                        rwscvl: {
                            description: `
                                <ul>
                                    <li>Allows you to view the real won/sent CV of users directly from their profile.</li>
                                </ul>
                            `,
                            features: {
                                rwscvl_r: {
                                    name: `Link SGTool's reverse page (from newest to oldest).`,
                                    sg: true
                                }
                            },
                            name: `Real Won/Sent CV Links`,
                            sg: true
                        },
                        swr: {
                            description: ``,
                            name: `Sent/Won Ratio`,
                            sg: true
                        },
                        sgc: {
                            description: `
                                <ul>
                                    <li>Allows you to see which groups you have in common with a user.</li>
                                </ul>
                            `,
                            name: `Shared Groups Checker`,
                            sg: true
                        },
                        sgpb: {
                            description: `
                                <ul>
                                    <li>Allows you to easily go to a user's SteamGifts profile from SteamTrades.</li>
                                </ul>
                            `,
                            name: `SteamGifts Profile Button`,
                            st: true
                        },
                        stpb: {
                            description: `
                                <ul>
                                    <li>Allows you to easily go to a user's SteamTrades profile from SteamGifts.</li>
                                </ul>
                            `,
                            name: `SteamTrades Profile Button`,
                            sg: true
                        },
                        uf: {
                            description: `
                                <ul>
                                    <li>Allows you to filter users' giveaways, discussions and posts.</li>
                                </ul>
                            `,
                            features: {
                                uf_g: {
                                    name: `Automatically hide giveaways from blacklisted users.`,
                                    sg: true
                                },
                                uf_d: {
                                    name: `Automatically hide discussions from blacklisted users.`,
                                    sg: true
                                },
                                uf_p: {
                                    name: `Automatically hide posts from blacklisted users.`,
                                    sg: true
                                }
                            },
                            name: `User Filters`,
                            sg: true
                        },
                        ugd: {
                            description: `
                                <ul>
                                    <li>Shows data about a user's giveaways.</li>
                                </ul>
                            `,
                            name: `User Giveaways Data`,
                            sg: true
                        },
                        un: {
                            description: `
                                <ul>
                                    <li>Allows you to add notes to users.</li>
                                    <li>The notes are tied to the user's Steam id, so they do not vanish when a user changes their username.</li>
                                    <li>If a user has notes saved, the icon will be full. Otherwise it will be empty.</li>
                                </ul>
                            `,
                            features: {
                                un_p: {
                                    name: `Pop up when whitelisting/blacklisting a user.`,
                                    sg: true
                                }
                            },
                            name: `User Notes`,
                            sg: true,
                            st: true
                        },
                        ust: {
                            description: `
                                <ul>
                                    <li>Allows you to find out if a user has already served suspension for not activated/multiple wins so you do not need to open a ticket about it (this information is only available when you use Not Activated/Multiple Wins Checker to check the user).</li>
                                    <li>The database for the feature is contributed by the users of ESGST and therefore is not complete.</li>
                                    <li>To contribute yourself, you can either: go to the main tickets page, select the tickets you want to send and then click on the button with the airplane icon in the heading (there are shortcuts to help you select tickets: clicking an unchecked ticket with the Ctrl key pressed will check all tickets in the page, clicking a checked ticket with the Ctrl key pressed will uncheck all tickets in the page, and clicking on any ticket with the Alt key pressed will toggle the state of all tickets in the page - if a ticket is checked it will be changed to unchecked, and vice-versa); or go to an individual ticket and send it through the button with the airplane icon in the top right corner, next to the button you use to edit/close it.</li>
                                    <li>The button to send tickets only appears for tickets that are in the following categories: Request New Winner -> Did Not Activate Previous Wins This Month, Other; User Report -> Multiple Wins for the Same Game, Not Activating Won Gift</li>
                                    <li>When you send a ticket, the HTML of the entire section shown in the screenshot is sent so it can be fully analyzed (this also means any comments made by staff), and there is no way to tamper with the HTML, as the script requests the ticket to confirm that it exists before sending it.</li>
                                </ul>
                                <img src="https://i.imgur.com/6O9pd2W.png">
                            `,
                            name: `User Suspension Tracker`,
                            new: true,
                            sg: true,
                            st: true
                        },
                        ut: {
                            description: ``,
                            name: `User Tags`,
                            sg: true,
                            st: true
                        },
                        uh: {
                            description: `
                                <ul>
                                    <li>Keeps track of users from the database and detects username changes every month and every time someone loads the username history of a user.</li>
                                    <li>Users that are not already in the database are added when a user loads their username history.</li>
                                </ul>
                            `,
                            name: `Username History`,
                            sg: true
                        },
                        us: {
                            description: `
                                <ul>
                                    <li>Adds users status to the whitelist/blacklist pages, such as last online, gifts sent, gifts won, ratio and contributor value.</li>
                                </ul>
                                <img src="http://i.imgur.com/SnWasiw.png"/>
                            `,
                            name: `Users Stats`,
                            sg: true
                        },
                        wbc: {
                            description: ``,
                            features: {
                                wbc_b: {
                                    name: `Show blacklist information.`,
                                    sg: true
                                },
                                wbc_h: {
                                    name: `Highlight users who have whitelisted/blacklisted you.`,
                                    sg: true,
                                    st: true
                                },
                                wbc_n: {
                                    name: `Save automatic notes to users that you returned whitelist/blacklist for.`,
                                    sg: true
                                }
                            },
                            name: `Whitelist/Blacklist Checker`,
                            sg: true
                        },
                        wbh: {
                            features: {
                                wbh_w: {
                                    colors: true,
                                    name: `Color whitelisted users instead of adding a heart icon next to their username.`,
                                    sg: true,
                                    st: true
                                },
                                wbh_b: {
                                    colors: true,
                                    name: `Color blacklisted users instead of adding a ban icon next to their username.`,
                                    sg: true,
                                    st: true
                                }
                            },
                            name: `Whitelist/Blacklist Highlighter`,
                            sg: true,
                            st: true,
                            sync: `Whitelist and Blacklist`
                        },
                        wbm: {
                            description: `
                                <p>
                                    You will find the feature in the following URLs:
                                    <br/>
                                    <br/>
                                    <code>steamgifts.com/account/manage/whitelist*</code>
                                    <br/>
                                    <code>steamgifts.com/account/manage/blacklist*</code>
                                </p>
                                <img src="https://i.imgur.com/8npwILS.png"/>
                                <ul>
                                    <li>Allows you to import/export/clear your whitelist/blacklist.</li>
                                </ul>
                            `,
                            name: `Whitelist/Blacklist Manager`,
                            sg: true
                        },
                        wbs: {
                            name: `Whitelist/Blacklist Sorter`,
                            sg: true,
                            sync: `Whitelist and Blacklist`
                        }
                    },
                    newBelow: true
                },
                groups: {
                    features: {
                        glwc: {
                            description: `
                                <p>
                                    You will find the feature in the following URLs:
                                    <br/>
                                    <br/>
                                    <code>steamgifts.com/account/manage/whitelist*</code>
                                    <br/>
                                    <code>steamgifts.com/account/manage/blacklist*</code>
                                    <br/>
                                    <code>steamgifts.com/group/*</code>
                                </p>
                                <img src="https://i.imgur.com/cvUbsKK.png"/>
                                <ul>
                                    <li>Allows you to check the libraries and wishlists of groups (including your whitelist/blacklist).</li>
                                    <li>The first 100 results are shown, but you can use the search function to find games that are outside of the top 100.</li>
                                    <li>Hovering over the number of libraries/wishlists gives you the name of the users.</li>
                                    <li>Requires a Steam API Key for libraries data. If a key is not set, it will only retrieve wishlists data. You can set a key in the last section of this menu.</li>
                                    <li>Some games show their app id instead of their name - these are the games retrieved from the libraries data that were not found in the wishlists data, as getting that extra information for them would generate more requests. This means it's more accurate to search by app id instead of by game name if you're searching in the libraries results.</li>
                                </ul>
                                <img src="https://i.imgur.com/cCcYiR5.png"/>
                            `,
                            name: `Group Library/Wishlist Checker`,
                            sg: true
                        },
                        gs: {
                            name: `Group Stats`,
                            sg: true
                        },
                        gh: {
                            description: `
                                <ul>
                                    <li>Highlights groups that you are a member of.</li>
                                </ul>
                            `,
                            name: `Groups Highlighter`,
                            sg: true,
                            sync: `Steam Groups`
                        }
                    }
                },
                games: {
                    features: {
                        egh: {
                            description: `
                                <ul>
                                    <li>Highlights games that you have already entered giveaways for.</li>
                                </ul>
                            `,
                            features: {
                                egh_t: {
                                    name: `Enable for discussion tables.`,
                                    sg: true
                                }
                            },
                            name: `Entered Games Highlighter`,
                            sg: true
                        },
                        gc: {
                            description: `
                                <ul>
                                    <li>Shows information about games.</li>
                                </ul>
                            `,
                            features: {
                                gc_lp: {
                                    description: `
                                        <ul>
                                            <li>Achievements links to the <a href="http://steamcommunity.com/stats">http://steamcommunity.com/stats</a> page of the game.</li>
                                            <li>Full CV, Reduced CV and No CV link to the <a href="https://www.steamgifts.com/bundle-games">https://www.steamgifts.com/bundle-games</a> page of the game.</li>
                                            <li>Giveaway Info links to your profile page.</li>
                                            <li>Hidden links to the <a href="https://www.steamgifts.com/account/settings/giveaways/filters">https://www.steamgifts.com/account/settings/giveaways/filters</a> page of the game.</li>
                                            <li>Owned links to the <a href="https://www.steamgifts.com/account/steam/games">https://www.steamgifts.com/account/steam/games</a> page of the game.</li>
                                            <li>Removed links to the <a href="http://steamdb.info">http://steamdb.info</a> page of the game.</li>
                                            <li>Trading Cards links to the <a href="http://www.steamcardexchange.net/index.php">http://www.steamcardexchange.net/index.php</a> page of the game.</li>
                                            <li>Wishlist links to the <a href="https://www.steamgifts.com/account/steam/wishlist">https://www.steamgifts.com/account/steam/wishlist</a> page of the game.</li>
                                            <li>Every other category links to the <a href="http://store.steampowered.com">http://store.steampowered.com</a> page of the game.</li>
                                        </ul>
                                    `,
                                    features: {
                                        gc_lp_gv: {
                                            name: `Enable for Grid View.`,
                                            sg: true
                                        }
                                    },
                                    name: `Link each category to its related page.`,
                                    sg: true
                                },
                                gc_b: {
                                    name: `Show the category colors as a bottom border to the giveaways in Grid View.`,
                                    sg: true
                                },
                                gc_t: {
                                    name: `Enable for discussion tables.`,
                                    sg: true
                                },
                                gc_il: {
                                    name: `Show the panel inline (next to the game name instead of below it).`,
                                    sg: true
                                },
                                gc_gi: {
                                    colors: true,
                                    description: `
                                        <ul>
                                            <li>Shows how many giveaways you have already made for a game and how much CV you should get for a new giveaway.</li>
                                            <li>In order for the feature to work properly, you must scan your profile with User Giveaways Data (currently this must be done every time your giveaways end, if you want to keep it updated).</li>
                                            <li>The information is not 100% accurate because it cannot know if all the copies were sent when it comes to giveaways with multiple copies, at the moment.</li>
                                        </ul>
                                    `,
                                    features: {
                                        gc_gi_t: {
                                            name: `Only show in discussion tables.`,
                                            sg: true
                                        },
                                        gc_gi_cew: {
                                            name: `Only show in the created/entered/won pages.`,
                                            sg: true
                                        }
                                    },
                                    name: `Giveaway Info`,
                                    sg: true
                                },
                                gc_r: {
                                    features: {
                                        gc_r_s: {
                                            name: `Show the percentage and number of reviews next to the icon.`,
                                            sg: true
                                        }
                                    },
                                    name: `Rating`,
                                    sg: true
                                },
                                gc_fcv: {
                                    colors: true,
                                    features: {
                                        gc_fcv_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_fcv_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Full CV`,
                                    sg: true
                                },
                                gc_rcv: {
                                    colors: true,
                                    features: {
                                        gc_rcv_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_rcv_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Reduced CV`,
                                    sg: true
                                },
                                gc_ncv: {
                                    colors: true,
                                    features: {
                                        gc_ncv_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_ncv_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        },
                                        gc_ncv_o: {
                                            name: `Only display "No CV" if game also has "Reduced CV".`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `No CV`,
                                    sg: true
                                },
                                gc_h: {
                                    colors: true,
                                    features: {
                                        gc_h_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_h_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Hidden`,
                                    sg: true
                                },
                                gc_i: {
                                    colors: true,
                                    features: {
                                        gc_i_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_i_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Ignored`,
                                    sg: true
                                },
                                gc_o: {
                                    colors: true,
                                    features: {
                                        gc_o_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_o_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        },
                                        gc_o_t: {
                                            name: `Only show if games are owned by alt accounts in discussion tables.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Owned`,
                                    sg: true
                                },
                                gc_w: {
                                    colors: true,
                                    features: {
                                        gc_w_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_w_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Wishlisted`,
                                    sg: true
                                },
                                gc_a: {
                                    colors: true,
                                    features: {
                                        gc_a_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_a_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Achievements`,
                                    sg: true
                                },
                                gc_mp: {
                                    colors: true,
                                    features: {
                                        gc_mp_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_mp_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Multiplayer`,
                                    sg: true
                                },
                                gc_sc: {
                                    colors: true,
                                    features: {
                                        gc_sc_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_sc_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Steam Cloud`,
                                    sg: true
                                },
                                gc_tc: {
                                    colors: true,
                                    features: {
                                        gc_tc_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_tc_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Trading Cards`,
                                    sg: true
                                },
                                gc_l: {
                                    colors: true,
                                    features: {
                                        gc_l_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_l_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Linux`,
                                    sg: true
                                },
                                gc_m: {
                                    colors: true,
                                    features: {
                                        gc_m_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_m_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Mac`,
                                    sg: true
                                },
                                gc_ea: {
                                    colors: true,
                                    features: {
                                        gc_ea_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_ea_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Early Access`,
                                    sg: true
                                },
                                gc_rm: {
                                    colors: true,
                                    features: {
                                        gc_rm_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_rm_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Removed`,
                                    sg: true
                                },
                                gc_dlc: {
                                    colors: true,
                                    features: {
                                        gc_dlc_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_dlc_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        },
                                        gc_dlc_b: {
                                            description: `
                                                <ul>
                                                    <li>A certificate icon will be added if the base is free, a money icon will be added if it's not, and no icon will be added if the information is unavailable.</li>
                                                </ul>
                                            `,
                                            name: `Indicate if the base game of the DLC is free.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `DLC`,
                                    sg: true
                                },
                                gc_p: {
                                    colors: true,
                                    features: {
                                        gc_p_s: {
                                            description: `
                                                <ul>
                                                    <li>Shows the category initials instead of its full name.</li>
                                                    <li>Not compatible with custom labels.</li>
                                                </ul>
                                            `,
                                            features: {
                                                gc_p_s_i: {
                                                    name: `Use icons instead of initials.`,
                                                    sg: true
                                                }
                                            },
                                            name: `Enable the simplified version.`,
                                            sg: true
                                        }
                                    },
                                    input: true,
                                    name: `Package`,
                                    sg: true
                                },
                                gc_g: {
                                    colors: true,
                                    features: {
                                        gc_g_udt: {
                                            name: `User-Defined Tags`,
                                            sg: true
                                        },
                                        gc_g_s: {
                                            description: `
                                                <ul>
                                                    <li>If disabled, the genres/tags will be listed together, separated by commas.</li>
                                                    <li>Custom background colors for genres/tags only work if this option is enabled.</li>
                                                </ul>
                                                <p>With this option enabled:</p>
                                                <img src="https://i.imgur.com/VQ4O6B3.png">
                                                <p>With this option enabled and custom colors:</p>
                                                <img src="https://i.imgur.com/RSWjJhx.png">
                                                <p>With this option disabled:</p>
                                                <img src="https://i.imgur.com/MIKUYCj.png">
                                            `,
                                            name: `Show each genre/tag as a separate category.`,
                                            new: true,
                                            sg: true
                                        }
                                    },
                                    name: `Genres`,
                                    newBelow: true,
                                    sg: true
                                }
                            },
                            name: `Game Categories`,
                            newBelow: true,
                            sg: true,
                            sync: `Hidden Games, Owned/Wishlisted/Ignored Games, Reduced CV Games, No CV Games and Giveaways`
                        },
                        gt: {
                            features: {
                                gt_t: {
                                    name: `Enable for discussion tables.`,
                                    sg: true
                                }
                            },
                            name: `Game Tags`,
                            sg: true
                        }
                    },
                    newBelow: true
                },
                others: {
                    features: {
                        esgst: {
                            name: `Enable ESGST for SteamTrades.`,
                            st: true
                        },
                        autoBackup: {
                            input: true,
                            name: `Automatically backup your data every X days.`,
                            options: {
                                title: `Backup to:`,
                                values: [`Computer`, `Dropbox`, `Google Drive`, `OneDrive`]
                            },
                            sg: true,
                            st: true
                        },
                        autoSync: {
                            name: `Automatically sync games/groups when syncing through SG.`,
                            sg: true
                        },
                        updateWhitelistBlacklist: {
                            description: `
                                <ul>
                                    <li>With this enabled, you no longer have to sync your whitelist/blacklist every time you add/remove a user to/from those lists.</li>
                                </ul>
                            `,
                            name: `Automatically update whitelist/blacklist when adding/removing a user to/from those lists.`,
                            sg: true
                        },
                        collapseSections: {
                            name: `Collapse sections in the settings menu by default.`,
                            sg: true,
                            st: true
                        },
                        staticPopups: {
                            name: `Make popups static (they are fixed at the top left corner of the page instead of being automatically centered).`,
                            sg: true,
                            st: true
                        },
                        openSettingsInTab: {
                            name: `Open settings menu in a separate tab.`,
                            sg: true,
                            st: true
                        },
                        openSyncInTab: {
                            name: `Open the automatic sync in a new tab.`,
                            sg: true,
                            st: true
                        },
                        enableByDefault: {
                            name: `Enable new features and functionalities by default.`,
                            sg: true,
                            st: true
                        },
                        showChangelog: {
                            name: `Show changelog from the new version when updating.`,
                            sg: true,
                            st: true
                        },
                        checkVersionMain: {
                            name: `Check whether or not you are on the current version when visiting the main discussions page if the ESGST discussion is in the current page.`,
                            sg: true
                        },
                        checkVersion: {
                            name: `Check whether or not you are on the current version when visiting the ESGST discussion.`,
                            sg: true
                        },
                        hideButtons: {
                            description: `
                                <p>Before:</p>
                                <img src="http://i.imgur.com/5QVoZGO.png"/>
                                <p>After:</p>
                                <img src="http://i.imgur.com/gkwzYuS.png"/>
                            `,
                            features: {
                                hideButtons_as: {
                                    name: `Archive Searcher Button`,
                                    sg: true
                                },
                                hideButtons_aic: {
                                    name: `Attached Images Carousel Button`,
                                    sg: true
                                },
                                hideButtons_cec: {
                                    name: `Comments/Entries Checker Button`,
                                    sg: true
                                },
                                hideButtons_cs: {
                                    name: `Comment Searcher`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_ctGo: {
                                    name: `Comment Tracker Button - Go to first unread.`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_ctRead: {
                                    name: `Comment Tracker Button - Read all.`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_ctUnread: {
                                    name: `Comment Tracker Button - Unread all.`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_df: {
                                    name: `Discussion Filters Button`,
                                    sg: true
                                },
                                hideButtons_ds: {
                                    name: `Discussions Sorter Button`,
                                    sg: true
                                },
                                hideButtons_esContinuous: {
                                    name: `Endless Scrolling Button - Continuously Load`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_esNext: {
                                    name: `Endless Scrolling Button - Load Next Page`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_esPause: {
                                    name: `Endless Scrolling Button - Pause/Resume`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_esRefresh: {
                                    name: `Endless Scrolling Button - Refresh`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_esRefreshAll: {
                                    name: `Endless Scrolling Button - Refresh All`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_gas: {
                                    name: `Giveaways Sorter Button`,
                                    sg: true
                                },
                                hideButtons_gf: {
                                    name: `Giveaway Filters Button`,
                                    sg: true
                                },
                                hideButtons_glwc: {
                                    name: `Group Library/Wishlist Checker Button`,
                                    sg: true,
                                },
                                hideButtons_gm: {
                                    name: `Giveaways Manager Button`,
                                    sg: true
                                },
                                hideButtons_gts: {
                                    name: `Giveaway Templates Button`,
                                    sg: true
                                },
                                hideButtons_gv: {
                                    name: `Grid View Button`,
                                    sg: true
                                },
                                hideButtons_hgr: {
                                    name: `Hidden Games Remover Button`,
                                    sg: true
                                },
                                hideButtons_mpp: {
                                    name: `Main Post Popup Button`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_mtGames: {
                                    name: `Multi-Tag Button - Games`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_mtUsers: {
                                    name: `Multi-Tag Button - Users`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_namwc: {
                                    name: `Not Activated/Multiple Wins Checker Button`,
                                    sg: true
                                },
                                hideButtons_rbp: {
                                    name: `Reply Box Popup Button`,
                                    sg: true,
                                    st: true
                                },
                                hideButtons_sks: {
                                    name: `Sent Keys Searcher Button`,
                                    sg: true
                                },
                                hideButtons_stbb: {
                                    name: `Scroll To Bottom  Button`,
                                    sg: true
                                },
                                hideButtons_sttb: {
                                    name: `Scroll To Top Button`,
                                    sg: true
                                },
                                hideButtons_tb: {
                                    name: `Trades Bumper Button`,
                                    st: true
                                },
                                hideButtons_ge: {
                                    name: `Giveaways Extractor Button`,
                                    sg: true
                                },
                                hideButtons_ugs: {
                                    name: `Unsent Gifts Sender Button`,
                                    sg: true
                                },
                                hideButtons_wbc: {
                                    name: `Whitelist/Blacklist Checker Button`,
                                    sg: true
                                },
                                hideButtons_wbm: {
                                    name: `Whitelist/Blacklist Manager Button`,
                                    sg: true
                                },
                                hideButtons_wbsAsc: {
                                    name: `Whitelist/Blacklist Sorter Button - Ascending`,
                                    sg: true
                                },
                                hideButtons_wbsDesc: {
                                    name: `Whitelist/Blacklist Sorter Button - Descending`,
                                    sg: true
                                }
                            },
                            name: `Hide buttons at the left/right sides of the main page heading to reduce used space.`,
                            sg: true,
                            st: true
                        }
                    }
                }
            }
        };
        esgst.markdownParser.setBreaksEnabled(true);
        esgst.markdownParser.setMarkupEscaped(true);
        esgst.name = esgst.sg ? `sg` : `st`;

        if (typeof GM === `undefined` && typeof GM_setValue === `undefined`) {
            // esgst is running as an extension
            setValue = (key, value) => {
                return setValues({[key]: value});
            };
            setValues = values => {
                return new Promise((resolve, reject) => {
                    chrome.storage.local.set(values, resolve);
                });
            };
            getValue = (key, value) => {
                return new Promise((resolve, reject) => {
                    resolve(isSet(esgst.storage[key]) ? esgst.storage[key] : value);
                });
            };
            getValues = values => {
                return new Promise((resolve, reject) => {
                    let output = {};
                    for (let key in values) {
                        output[key] = isSet(esgst.storage[key]) ? esgst.storage[key] : values[key];
                    }
                    resolve(output);
                });
            };
            delValue = key => {
                return delValues([key]);
            };
            delValues = keys => {
                return new Promise((resolve, reject) => {
                    chrome.storage.local.remove(keys, () => {
                        keys.forEach(key => {
                            delete esgst.storage[key];
                        });
                        resolve();
                    });
                });
            };
            getStorage = () => {
                return new Promise((resolve, reject) => {
                    chrome.storage.local.get(null, storage => {
                        resolve(storage);
                    });
                });
            };
            notifyNewVersion = version => {
                let message, popup;
                if (esgst.discussionPath) {
                    message = `You are not using the latest ESGST version. Please update before reporting bugs and make sure the bugs still exist in the latest version.`;
                } else {
                    message = `A new ESGST version is available.`;
                }
                popup = new Popup(`fa-exclamation`, message, true);
                if (typeof browser === `undefined`) {
                    popup.description.appendChild(new ButtonSet(`green`, ``, `fa-download`, ``, `Download .zip`, ``, callback => {
                        callback();
                        open(`https://github.com/revilheart/ESGST/releases/download/${version}/extension.zip`);
                    }).set);
                }
                popup.onClose = () => {
                    setValue(`dismissedVersion`, version);
                };
                popup.open();
            };
            continueRequest = (data, headers, method, url, callback, anon, closeLock) => {
                chrome.runtime.sendMessage({
                    action: `fetch`,
                    parameters: JSON.stringify({
                        body: data,
                        credentials: anon ? `omit` : `include`,
                        headers: headers,
                        method: method,
                        redirect: `follow`
                    }),
                    url: url.replace(/^\//, `https://${location.hostname}/`).replace(/^https?:/, location.href.match(/^http:/) ? `http:` : `https:`)
                }, response => {
                    if (closeLock) {
                        closeLock();
                    }
                    response = JSON.parse(response);
                    if (response.finalUrl.match(/www.steamgifts.com/)) {
                        lookForPopups(response);
                    }
                    if (callback) {
                        callback(response);
                    }
                });
            };
            addHeaderMenu = () => {
                var arrow, button, className, context, dropdown, menu, position;
                if (esgst.sg) {
                    className = `nav__left-container`;
                    position = `beforeEnd`;
                } else {
                    className = `nav_logo`;
                    position = `afterEnd`;
                }
                context = document.getElementsByClassName(className)[0];
                menu = insertHtml(context, position, `
                    <div class="esgst-header-menu" id="esgst">
                        <div class="esgst-header-menu-relative-dropdown esgst-hidden">
                            <div class="esgst-header-menu-absolute-dropdown">
                                <a class="esgst-header-menu-row" href="https://github.com/revilheart/ESGST">
                                    <i class="fa fa-fw fa-github grey"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">GitHub</p>
                                        <p class="esgst-header-menu-description">Visit the GitHub page.</p>
                                    </div>
                                </a>
                                <a class="esgst-header-menu-row" href="https://github.com/revilheart/ESGST/issues">
                                    <i class="fa fa-fw fa-bug red"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Bugs/Suggestions</p>
                                        <p class="esgst-header-menu-description">Report bugs and/or make suggestions.</p>
                                    </div>
                                </a>
                                <a class="esgst-header-menu-row" href="https://github.com/revilheart/ESGST/milestones">
                                    <i class="fa fa-fw fa-map-signs blue"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Milestones</p>
                                        <p class="esgst-header-menu-description">Check out what's coming in the next version.</p>
                                    </div>
                                </a>
                                <a class="esgst-header-menu-row" href="https://www.steamgifts.com/discussion/TDyzv/">
                                    <i class="fa fa-fw fa-commenting green"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Discussion</p>
                                        <p class="esgst-header-menu-description">Visit the discussion page.</p>
                                    </div>
                                </a>
                                <a class="esgst-header-menu-row" href="http://steamcommunity.com/groups/esgst">
                                    <i class="fa fa-fw fa-steam green"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Steam Group</p>
                                        <p class="esgst-header-menu-description">Visit/join the Steam group.</p>
                                    </div>
                                </a>
                                <div class="esgst-header-menu-row">
                                    <i class="fa fa-fw fa-file-text-o yellow"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Changelog</p>
                                        <p class="esgst-header-menu-description">Check out the changelog.</p>
                                    </div>
                                </div>
                                <a class="esgst-header-menu-row" href="https://pledgie.com/campaigns/35345">
                                    <i class="fa fa-fw fa-dollar grey"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Donate</p>
                                        <p class="esgst-header-menu-description">Thank you for the support!</p>
                                    </div>
                                </a>
                                <div class="esgst-header-menu-row">
                                    <div>
                                        <p class="esgst-header-menu-description">Current Version: ${esgst.currentVersion}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="esgst-header-menu-button">
                            <i class="fa">
                                <img src="${esgst.icon}"/>
                            </i>
                            <span>ESGST</span>
                        </div>
                        <div class="esgst-header-menu-button arrow">
                            <i class="fa fa-angle-down"></i>
                        </div>
                    </div>
                `);
                dropdown = menu.firstElementChild;
                button = dropdown.nextElementSibling;
                arrow = button.nextElementSibling;
                button.addEventListener(`click`, function () {
                    if (esgst.openSettingsInTab) {
                        open(`/esgst/settings`);
                    } else {
                        loadSMMenu();
                    }
                });
                arrow.addEventListener(`click`, toggleHeaderMenu.bind(null, arrow, dropdown));
                document.addEventListener(`click`, closeHeaderMenu.bind(null, arrow, dropdown, menu), true);
                dropdown.firstElementChild.lastElementChild.previousElementSibling.previousElementSibling.addEventListener(`click`, loadChangelog);
            };
            chrome.storage.onChanged.addListener((changes, namespace) => {
                if (namespace === `local`) {
                    for (let key in changes) {
                        esgst.storage[key] = changes[key].newValue;
                    }
                }
            });
        } else {
            // esgst is running as a script
            if (typeof GM === `undefined`) {
                // polyfill for userscript managers that do not support the gm-dot api
                GM = {
                    setValue: GM_setValue,
                    getValue: GM_getValue,
                    deleteValue: GM_deleteValue,
                    listValues: GM_listValues,
                    xmlHttpRequest: GM_xmlhttpRequest
                };
                for (let key in GM) {
                    let old = GM[key];
                    GM[key] = function(...args) {
                        return new Promise((resolve, reject) => {
                            try {
                                resolve(old.apply(this, args));
                            } catch (e) {
                                reject(e);
                            }
                        });
                    };
                }
            }
            setValue = GM.setValue;
            setValues = values => {
                return new Promise((resolve, reject) => {
                    let check = new CompletionCheck(Object.keys(values).length, resolve);
                    for (let key in values) {
                        GM.setValue(key, values[key]).then(() => {
                            check.count += 1;
                        });
                    }
                });
            };
            getValue = GM.getValue;
            getValues = values => {
                return new Promise((resolve, reject) => {
                    let check, output;
                    output = {};
                    check = new CompletionCheck(Object.keys(values).length, resolve.bind(null, output));
                    for (let key in values) {
                        GM.getValue(key, values[key]).then(value => {
                            output[key] = value;
                            check.count += 1;
                        });
                    }
                });
            };
            delValue = GM.deleteValue;
            delValues = keys => {
                return new Promise((resolve, reject) => {
                    let check = new CompletionCheck(keys.length, resolve);
                    keys.forEach(key => {
                        GM.deleteValue(key).then(() => {
                            check.count += 1;
                        });
                    });
                });
            };
            getStorage = () => {
                return new Promise((resolve, reject) => {
                    GM.listValues().then(keys => {
                        let check, storage;
                        storage = {};
                        check = new CompletionCheck(keys.length, resolve.bind(null, storage));
                        keys.forEach(key => {
                            GM.getValue(key).then(value => {
                                storage[key] = value;
                                check.count += 1;
                            });
                        });
                    });
                });
            };
            notifyNewVersion = version => {
                let message, popup;
                if (esgst.discussionPath) {
                    message = `You are not using the latest ESGST version. Please update before reporting bugs and make sure the bugs still exist in the latest version.`;
                } else {
                    message = `A new ESGST version is available.`;
                }
                popup = new Popup(`fa-exclamation`, message, true);
                insertHtml(popup.actions, `afterBegin`, `<span>Update</span>`).addEventListener(`click`, checkUpdate);
                popup.onClose = () => {
                    setValue(`dismissedVersion`, version);
                };
                popup.open();
            };
            continueRequest = (data, headers, method, url, callback, anon, closeLock) => {
                if (url.match(/^\//) || url.match(new RegExp(location.hostname))) {
                    url = url.replace(/^https?:/, location.href.match(/^http:/) ? `http:` : `https:`);
                    fetch(url, {
                        body: data,
                        credentials: anon ? `omit` : `include`,
                        headers: headers,
                        method: method,
                        redirect: `follow`
                    }).then(response => {
                        response.text().then(responseText => {
                            if (closeLock) {
                                closeLock();
                            }
                            response = {
                                finalUrl: response.url,
                                redirected: response.redirected,
                                responseText: responseText
                            };
                            if (callback) {
                                callback(response);
                            }
                            if (response.finalUrl.match(/www.steamgifts.com/)) {
                                lookForPopups(response);
                            }
                        });
                    });
                } else {
                    GM.xmlHttpRequest({
                        data: data,
                        headers: headers,
                        method: method,
                        url: url,
                        onload: response => {
                            if (closeLock) {
                                closeLock();
                            }
                            if (callback) {
                                callback(response);
                            }
                            if (response.finalUrl.match(/www.steamgifts.com/)) {
                                lookForPopups(response);
                            }
                        }
                    });
                }
            };
            addHeaderMenu = () => {
                var arrow, button, changelogRow, className, context, dropdown, html, menu, position;
                if (esgst.sg) {
                    className = `nav__left-container`;
                    position = `beforeEnd`;
                } else {
                    className = `nav_logo`;
                    position = `afterEnd`;
                }
                context = document.getElementsByClassName(className)[0];
                menu = insertHtml(context, position, `
                    <div class="esgst-header-menu" id="esgst">
                        <div class="esgst-header-menu-relative-dropdown esgst-hidden">
                            <div class="esgst-header-menu-absolute-dropdown">
                                <div class="esgst-header-menu-row">
                                    <i class="fa fa-fw fa-refresh blue"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Update</p>
                                        <p class="esgst-header-menu-description">Check for updates.</p>
                                    </div>
                                </div>
                                <a class="esgst-header-menu-row" href="https://github.com/revilheart/ESGST">
                                    <i class="fa fa-fw fa-github grey"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">GitHub</p>
                                        <p class="esgst-header-menu-description">Visit the GitHub page.</p>
                                    </div>
                                </a>
                                <a class="esgst-header-menu-row" href="https://github.com/revilheart/ESGST/issues">
                                    <i class="fa fa-fw fa-bug red"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Bugs/Suggestions</p>
                                        <p class="esgst-header-menu-description">Report bugs and/or make suggestions.</p>
                                    </div>
                                </a>
                                <a class="esgst-header-menu-row" href="https://github.com/revilheart/ESGST/milestones">
                                    <i class="fa fa-fw fa-map-signs blue"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Milestones</p>
                                        <p class="esgst-header-menu-description">Check out what's coming in the next version.</p>
                                    </div>
                                </a>
                                <a class="esgst-header-menu-row" href="https://www.steamgifts.com/discussion/TDyzv/">
                                    <i class="fa fa-fw fa-commenting green"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Discussion</p>
                                        <p class="esgst-header-menu-description">Visit the discussion page.</p>
                                    </div>
                                </a>
                                <a class="esgst-header-menu-row" href="http://steamcommunity.com/groups/esgst">
                                    <i class="fa fa-fw fa-steam green"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Steam Group</p>
                                        <p class="esgst-header-menu-description">Visit/join the Steam group.</p>
                                    </div>
                                </a>
                                <div class="esgst-header-menu-row">
                                    <i class="fa fa-fw fa-file-text-o yellow"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Changelog</p>
                                        <p class="esgst-header-menu-description">Check out the changelog.</p>
                                    </div>
                                </div>
                                <a class="esgst-header-menu-row" href="https://pledgie.com/campaigns/35345">
                                    <i class="fa fa-fw fa-dollar grey"></i>
                                    <div>
                                        <p class="esgst-header-menu-name">Donate</p>
                                        <p class="esgst-header-menu-description">Thank you for the support!</p>
                                    </div>
                                </a>
                                <div class="esgst-header-menu-row">
                                    <div>
                                        <p class="esgst-header-menu-description">Current Version: ${esgst.currentVersion}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="esgst-header-menu-button">
                            <i class="fa">
                                <img src="${esgst.icon}"/>
                            </i>
                            <span>ESGST</span>
                        </div>
                        <div class="esgst-header-menu-button arrow">
                            <i class="fa fa-angle-down"></i>
                        </div>
                    </div>
                `);
                dropdown = menu.firstElementChild;
                button = dropdown.nextElementSibling;
                arrow = button.nextElementSibling;
                button.addEventListener(`click`, function () {
                    if (esgst.openSettingsInTab) {
                        open(`/esgst/settings`);
                    } else {
                        loadSMMenu();
                    }
                });
                arrow.addEventListener(`click`, toggleHeaderMenu.bind(null, arrow, dropdown));
                document.addEventListener(`click`, closeHeaderMenu.bind(null, arrow, dropdown, menu), true);
                dropdown.firstElementChild.firstElementChild.addEventListener(`click`, checkUpdate);
                dropdown.firstElementChild.lastElementChild.previousElementSibling.previousElementSibling.addEventListener(`click`, loadChangelog);
            };
        }

        let toDelete, toSet;
        getStorage().then(storage => {
            // set default values or correct values
            toDelete = [];
            toSet = {};
            esgst.storage = storage;
            if (isSet(esgst.storage.users)) {
                esgst.users = JSON.parse(esgst.storage.users);
                let changed = false;
                for (let key in esgst.users.users) {
                    let wbc = esgst.users.users[key].wbc;
                    if (wbc && wbc.result && wbc.result !== `whitelisted` && wbc.result !== `blacklisted`) {
                        delete esgst.users.users[key].wbc;
                        changed = true;
                    }
                }
                if (changed) {
                    toSet.users = JSON.stringify(esgst.users);
                }
            } else {
                esgst.users = {
                    steamIds: {},
                    users: {}
                };
                toSet.users = JSON.stringify(esgst.users);
            }
            if (!isSet(esgst.storage[`${esgst.name}RfiCache`])) {
                toSet[`${esgst.name}RfiCache`] = getLocalValue(`replies`, `{}`);
                delLocalValue(`replies`);
            }
            if (!isSet(esgst.storage.emojis)) {
                toSet.emojis = isSet(esgst.storage.Emojis) ? esgst.storage.Emojis : ``;
                toDelete.push(`Emojis`);
            }
            if (esgst.sg) {
                if (!isSet(esgst.storage.dfPresets)) {
                    toSet.dfPresets = getLocalValue(`dfPresets`, `[]`);
                    delLocalValue(`dfPresets`);
                }
                if (!isSet(esgst.storage.templates)) {
                    toSet.templates = getLocalValue(`templates`, `[]`);
                    delLocalValue(`templates`);
                }
                if (!isSet(esgst.storage.stickiedCountries)) {
                    toSet.stickiedCountries = getLocalValue(`stickiedCountries`, `[]`);
                    delLocalValue(`stickiedCountries`);
                }
                if (isSet(esgst.storage.giveaways)) {
                    esgst.giveaways = JSON.parse(esgst.storage.giveaways);
                } else {
                    toSet.giveaways = getLocalValue(`giveaways`, `{}`);
                    esgst.giveaways = JSON.parse(toSet.giveaways);
                    delLocalValue(`giveaways`);
                }
                if (!isSet(esgst.storage.discussions)) {
                    toSet.discussions = getLocalValue(`discussions`, `{}`);
                    delLocalValue(`discussions`);
                }
                if (!isSet(esgst.storage.tickets)) {
                    toSet.tickets = getLocalValue(`tickets`, `{}`);
                    delLocalValue(`tickets`);
                }
                delLocalValue(`gFix`);
                delLocalValue(`dFix`);
                delLocalValue(`tFix`);
                if (isSet(esgst.storage.groups)) {
                    esgst.groups = JSON.parse(esgst.storage.groups);
                } else {
                    toSet.groups = getLocalValue(`groups`, `[]`);
                    esgst.groups = JSON.parse(toSet.groups);
                    delLocalValue(`groups`);
                }
                if (!isSet(esgst.storage.entries)) {
                    toSet.entries = getLocalValue(`entries`, `[]`);
                    delLocalValue(`entries`);
                }
                if (isSet(esgst.storage.rerolls)) {
                    esgst.rerolls = JSON.parse(esgst.storage.rerolls);
                } else {
                    toSet.rerolls = getLocalValue(`rerolls`, `[]`);
                    esgst.rerolls = JSON.parse(toSet.rerolls);
                    delLocalValue(`rerolls`);
                }
                if (isSet(esgst.storage.winners)) {
                    esgst.winners = JSON.parse(esgst.storage.winners);
                } else {
                    toSet.winners = getLocalValue(`winners`, `{}`);
                    esgst.winners = JSON.parse(toSet.winners);
                    delLocalValue(`winners`);
                }
            } else {
                if (!isSet(esgst.storage.trades)) {
                    toSet.trades = getLocalValue(`trades`, `{}`);
                    delLocalValue(`trades`);
                }
                delLocalValue(`tFix`);
            }
            if (isSet(esgst.storage.games)) {
                esgst.games = JSON.parse(esgst.storage.games);
            } else {
                esgst.games = {
                    apps: {},
                    subs: {}
                };
                toSet.games = JSON.stringify(esgst.games);
            }
            if (isSet(esgst.storage.settings)) {
                esgst.settings = JSON.parse(esgst.storage.settings);
            } else {
                esgst.settings = {};
            }
            esgst.version = esgst.storage.version;
            for (let key in esgst.oldValues) {
                esgst[key] = getSetting(key);
            }
            for (let key in esgst.defaultValues) {
                esgst[key] = getSetting(key);
            }
            for (let type in esgst.features) {
                for (let id in esgst.features[type].features) {
                    getFeatureSetting(esgst.features[type].features[id], id);
                }
            }
            for (let key in esgst.settings) {
                let match;
                if (match = key.match(new RegExp(`(.+?)_${esgst.name}$`))) {
                    esgst[match[1]] = esgst.settings[key];
                }
            }
            [
                {id: `cec`, side: `left`},
                {id: `esContinuous`, side: `right`},
                {id: `esNext`, side: `right`},
                {id: `glwc`, side: `left`},
                {id: `stbb`, side: `right`},
                {id: `sttb`, side: `right`},
                {id: `ust`, side: `left`},
                {id: `wbm`, side: `left`}
            ].forEach(item => {
                if (esgst.leftButtonIds.indexOf(item.id) < 0 && esgst.rightButtonIds.indexOf(item.id) < 0) {
                    esgst[`${item.side}ButtonIds`].push(item.id);
                    esgst.settings.leftButtonIds = esgst.leftButtonIds;
                    esgst.settings.rightButtonIds = esgst.rightButtonIds;
                }
            });
            delete esgst.settings.users;
            delete esgst.settings.comments;
            delete esgst.settings.giveaways;
            delete esgst.settings.groups;
            if (esgst.settings.gc_categories.length !== 20) {
                esgst.settings.gc_categories = esgst.defaultValues.gc_categories;
                esgst.gc_categories = esgst.settings.gc_categories;
            }
            toSet.settings = JSON.stringify(esgst.settings);
            return setValues(toSet);
        }).then(() => {
            return delValues(toDelete);
        }).then(() => {
            // now that all values are set esgst can begin to load
            if (location.pathname.match(/esgst-settings/)) {
                location.href = `/esgst/settings`;
            } else if (location.pathname.match(/esgst-sync/)) {
                location.href = `/esgst/sync`;
            } else if (location.pathname.match(/esgst\/sync/)) {
                setSync();
            } else if (location.pathname.match(/^\/esgst\/dropbox/)) {
                setValue(`dropboxToken`, location.hash.match(/access_token=(.+?)\&/)[1]).then(() => close());
            } else if (location.pathname.match(/^\/esgst\/google-drive/)) {
                setValue(`googleDriveToken`, location.hash.match(/access_token=(.+?)\&/)[1]).then(() => close());
            } else if (location.pathname.match(/^\/esgst\/onedrive/)) {
                setValue(`oneDriveToken`, location.hash.match(/access_token=(.+?)\&/)[1]).then(() => close());
            } else if (location.pathname.match(/^\/esgst\/imgur/)) {
                setValue(`imgurToken`, location.hash.match(/access_token=(.+?)\&/)[1]).then(() => close());
            } else {
                let logoutButton = document.querySelector(`.js__logout, .js_logout`);
                if (!logoutButton && !esgst.menuPath) {
                    // user is not logged in
                    return;
                }
                if (esgst.st && !esgst.settings.esgst_st) {
                    // esgst is not enabled for steamtrades
                    return;
                }
                esgst.lastPage = getLastPage(document, true);
                if (esgst.menuPath) {
                    document.head.insertAdjacentHTML(`beforeEnd`, `<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.steamgifts.com/css/minified_v30.css">`);
                }
                addStyle();
                getElements(logoutButton);
                if (esgst.sg && !esgst.menuPath) {
                    checkSync();
                }
                if (esgst.autoBackup) {
                    checkBackup();
                }
                if (esgst.profilePath && esgst.autoSync) {
                    document.getElementsByClassName(`form__sync-default`)[0].addEventListener(`click`, setSync.bind(null, true, null, null));
                }
                if (esgst.menuPath) {
                    esgst.favicon.href = esgst.icon;
                    if (esgst.settingsPath) {
                        document.title = `ESGST - Settings`;
                        loadSMMenu(true);
                    } else if (esgst.importMenuPath) {
                        document.title = `ESGST - Import`;
                        loadDataManagement(true, `import`);
                    } else if (esgst.exportMenuPath) {
                        document.title = `ESGST - Export`;
                        loadDataManagement(true, `export`);
                    } else if (esgst.deleteMenuPath) {
                        document.title = `ESGST - Delete`;
                        loadDataManagement(true, `delete`);
                    } else {
                        request(null, null, `GET`, false, `/`, response => {
                            responseHtml = parseHtml(response.responseText);
                            document.body.className = `esgst-tab-menu esgst-tab-menu-header`;
                            document.body.innerHTML = `
                                ${responseHtml.getElementsByTagName(`header`)[0].outerHTML}
                                <div class="page__outer-wrap">
                                    <div class="page__inner-wrap"></div>
                                </div>
                                ${responseHtml.getElementsByClassName(`footer__outer-wrap`)[0].outerHTML}
                            `;
                            esgst.header = document.body.firstElementChild;
                            esgst.footer = document.body.lastElementChild;
                            esgst.headerNavigationLeft = document.getElementsByClassName(`nav__left-container`)[0];
                            esgst.pageOuterWrap = esgst.header.nextElementSibling;
                            esgst.mainContext = esgst.pageOuterWrap.lastElementChild;
                            let logoutButton = responseHtml.getElementsByClassName(esgst.sg ? `js__logout` : `js_logout`)[0];
                            if (logoutButton) {
                                esgst.xsrfToken = logoutButton.getAttribute(`data-form`).match(/xsrf_token=(.+)/)[1];
                            }
                            refreshHeaderElements(document);
                            addHeaderMenu();
                            loadFeatures();
                            if (esgst.gbPath) {
                                document.title = `ESGST - Giveaway Bookmarks`;
                                esgst.originalTitle = `ESGST - Giveaway Bookmarks`;
                            } else if (esgst.gedPath) {
                                document.title = `ESGST - Decrypted Giveaways`;
                                esgst.originalTitle = `ESGST - Decrypted Giveaways`;
                            } else if (esgst.gePath) {
                                document.title = `ESGST - Extracted Giveaways`;
                                esgst.originalTitle = `ESGST - Extracted Giveaways`;
                            } else if (esgst.glwcPath) {
                                document.title = `ESGST - Group Library/Wishlist Checker`;
                                esgst.originalTitle = `ESGST - Group Library/Wishlist Checker`;
                            }

                            // make the header dropdown menus work
                            $("nav .nav__button--is-dropdown-arrow").click(function(e){var t=$(this).hasClass("is-selected");$("nav .nav__button").removeClass("is-selected"),$("nav .nav__relative-dropdown").addClass("is-hidden"),t||$(this).addClass("is-selected").siblings(".nav__relative-dropdown").removeClass("is-hidden"),e.stopPropagation()});
                            $("html").click(function(){$("nav .nav__button, .page__heading__button--is-dropdown").removeClass("is-selected"),$("nav .nav__relative-dropdown").addClass("is-hidden")});
                        });
                    }
                } else {
                    addHeaderMenu();
                    checkNewVersion();
                    if (esgst.giveawaysPath && esgst.activeDiscussions) {
                        if (esgst.oadd) {
                            loadOadd();
                        } else {
                            checkMissingDiscussions();
                        }
                    } else if (esgst.bgl && esgst.giveawayPath) {
                        let backup, summary;
                        backup = esgst.pageOuterWrap.innerHTML;
                        summary = document.getElementsByClassName(`table--summary`)[0];
                        summary = summary && summary.lastElementChild.firstElementChild.lastElementChild;
                        if (summary) {
                            let match = summary.textContent.match(/you\s(have\s(been\s)?|previously\s)blacklisted/);
                            if (match) {
                                esgst.pageOuterWrap.innerHTML = `
                                    <i class="fa fa-circle-o-notch fa-spin"></i>
                                    <span>Loading giveaway...</span>
                                `;
                                request(null, null, `GET`, false, location.pathname, response => {
                                    let responseHtml = parseHtml(response.responseText);
                                    if (responseHtml.getElementsByClassName(`table--summary`)[0]) {
                                        esgst.pageOuterWrap.innerHTML = backup;
                                        esgst.pageOuterWrap.getElementsByClassName(`table--summary`)[0].lastElementChild.firstElementChild.lastElementChild.insertAdjacentHTML(`beforeEnd`, `<br><br><span class="esgst-red">This is a group/whitelist giveaway and therefore cannot be loaded by Blacklist Giveaway Loader.</span>`);
                                        loadFeatures();
                                    } else {
                                        esgst.featuredContainer = insertHtml(esgst.pageOuterWrap, `beforeBegin`, `<div class="featured__container"></div>`);
                                        esgst.featuredContainer.innerHTML = responseHtml.getElementsByClassName(`featured__container`)[0].innerHTML;
                                        esgst.pageOuterWrap.innerHTML = responseHtml.getElementsByClassName(`page__outer-wrap`)[0].innerHTML;
                                        getElements(logoutButton);
                                        esgst.sidebar.insertAdjacentHTML(`afterBegin`, `
                                            <div class="sidebar__error is-disabled">
                                                <i class="fa fa-exclamation-circle"></i> ${match[1] ? (match[1] === `previously ` ? `Off Your Blacklist<br>(${summary.firstElementChild.outerHTML})` : `You Are Blacklisted`) : `On Your Blacklist`}
                                            </div>
                                        `);
                                        loadFeatures();
                                    }
                                }, true);
                            } else {
                                loadFeatures();
                            }
                        } else {
                            loadFeatures();
                        }
                    } else {
                        loadFeatures();
                    }
                }
            }
        });
    }
    
    function setLocalValue(key, value) {
        localStorage.setItem(`esgst_${key}`, value);
    }

    function getLocalValue(key, value = undefined) {
        return localStorage.getItem(`esgst_${key}`) || value;
    }

    function delLocalValue(key) {
        localStorage.removeItem(key);
    }

    function isSet(variable) {
        return typeof variable !== `undefined` && variable !== null;
    }
    
    function parseHtml(string) {
        return esgst.domParser.parseFromString(string, `text/html`);
    }

    function parseMarkdown(string) {
        return esgst.markdownParser.text(string);
    }

    function getElements(logoutButton) {
        if (esgst.sg) {
            esgst.pageOuterWrapClass = `page__outer-wrap`;
            esgst.pageHeadingClass = `page__heading`;
            esgst.pageHeadingBreadcrumbsClass = `page__heading__breadcrumbs`;
            esgst.footer = document.getElementsByClassName(`footer__outer-wrap`)[0];
            esgst.replyBox = document.getElementsByClassName(`comment--submit`)[0];
            esgst.cancelButtonClass = `comment__cancel-button`;
            esgst.paginationNavigationClass = `pagination__navigation`;
            esgst.hiddenClass = `is-hidden`;
            esgst.selectedClass = `is-selected`;
        } else {
            esgst.pageOuterWrapClass = `page_outer_wrap`;
            esgst.pageHeadingClass = `page_heading`;
            esgst.pageHeadingBreadcrumbsClass = `page_heading_breadcrumbs`;
            esgst.footer = document.getElementsByTagName(`footer`)[0];
            esgst.replyBox = document.getElementsByClassName(`reply_form`)[0];
            esgst.cancelButtonClass = `btn_cancel`;
            esgst.paginationNavigationClass = `pagination_navigation`;
            esgst.hiddenClass = `is_hidden`;
            esgst.selectedClass = `is_selected`;
        }
        esgst.currentPage = location.href.match(/page=(\d+)/);
        if (esgst.currentPage) {
            esgst.currentPage = parseInt(esgst.currentPage[1]);
        } else {
            esgst.currentPage = 1;
        }
        var url = location.href.replace(location.search, ``).replace(location.hash, ``).replace(`/search`, ``);
        esgst.originalUrl = url;
        esgst.favicon = document.querySelector(`[rel="shortcut icon"]`);
        esgst.originalTitle = document.title;
        if (esgst.mainPath) {
            url += esgst.sg ? `giveaways` : `trades`;
        }
        url += `/search?`;
        var parameters = location.search.replace(/^\?/, ``).split(/&/);
        for (var i = 0, n = parameters.length; i < n; ++i) {
            if (parameters[i] && !parameters[i].match(/page/)) {
                url += parameters[i] + `&`;
            }
        }
        if (location.search) {
            esgst.originalUrl = url.replace(/&$/, ``);
            if (esgst.currentPage > 1) {
                esgst.originalUrl += `&page=${esgst.currentPage}`;
            }
        }
        url += `page=`;
        esgst.searchUrl = url;
        if (!esgst.menuPath) {
            refreshHeaderElements(document);
        }
        esgst.header = document.getElementsByTagName(`header`)[0];
        esgst.headerNavigationLeft = document.getElementsByClassName(`nav__left-container`)[0];
        esgst.pagination = document.getElementsByClassName(`pagination`)[0];
        esgst.featuredContainer = document.getElementsByClassName(`featured__container`)[0];
        esgst.pageOuterWrap = document.getElementsByClassName(esgst.pageOuterWrapClass)[0];
        esgst.paginationNavigation = document.getElementsByClassName(esgst.paginationNavigationClass)[0];
        esgst.sidebar = document.getElementsByClassName(`sidebar`)[0];
        if (esgst.sidebar) {
            esgst.enterGiveawayButton = esgst.sidebar.getElementsByClassName(`sidebar__entry-insert`)[0];
            esgst.leaveGiveawayButton = esgst.sidebar.getElementsByClassName(`sidebar__entry-delete`)[0];
        }
        esgst.activeDiscussions = document.querySelector(`.widget-container--margin-top:last-of-type`);
        esgst.pinnedGiveaways = document.getElementsByClassName(`pinned-giveaways__outer-wrap`)[0];
        var mainPageHeadingIndex;
        if (esgst.commentsPath) {
            mainPageHeadingIndex = 1;
        } else {
            mainPageHeadingIndex = 0;
        }
        esgst.mainPageHeading = document.getElementsByClassName(esgst.pageHeadingClass)[mainPageHeadingIndex];
        if (!esgst.mainPageHeading && mainPageHeadingIndex === 1) {
            esgst.mainPageHeading = document.getElementsByClassName(esgst.pageHeadingClass)[0];
        }
        if (logoutButton) {
            esgst.xsrfToken = logoutButton.getAttribute(`data-form`).match(/xsrf_token=(.+)/)[1];
        }
    }

    function addGiveawayToStorage() {
        let giveaway, ggiveaways, i, key, n, popup, ugd, user;
        popup = new Popup(`fa-circle-o-notch fa-spin`, `Please wait... ESGST is adding this giveaway to the storage...`, true);
        popup.open();
        getGiveaways(document, true, location.href).then(giveaways => {
            if (giveaways.length) {
                giveaway = giveaways[0];
                ggiveaways = {};
                ggiveaways[giveaway.code] = giveaway;
                user = {
                    steamId: esgst.steamId,
                    username: esgst.username
                };
                getUser(null, user).then(savedUser => {
                    giveaways = null;
                    if (savedUser) {
                        giveaways = savedUser.giveaways;
                    }
                    if (!giveaways) {
                        giveaways = {
                            sent: {
                                apps: {},
                                subs: {}
                            },
                            won: {
                                apps: {},
                                subs: {}
                            },
                            sentTimestamp: 0,
                            wonTimestamp: 0
                        };
                        if (savedUser) {
                            ugd = savedUser.ugd;
                            if (ugd) {
                                if (ugd.sent) {
                                    for (key in ugd.sent.apps) {
                                        giveaways.sent.apps[key] = [];
                                        for (i = 0, n = ugd.sent.apps[key].length; i < n; ++i) {
                                            ggiveaways[ugd.sent.apps[key][i].code] = ugd.sent.apps[key][i];
                                            giveaways.sent.apps[key].push(ugd.sent.apps[key][i].code);
                                        }
                                    }
                                    for (key in ugd.sent.subs) {
                                        giveaways.sent.subs[key] = [];
                                        for (i = 0, n = ugd.sent.subs[key].length; i < n; ++i) {
                                            ggiveaways[ugd.sent.subs[key][i].code] = ugd.sent.subs[key][i];
                                            giveaways.sent.subs[key].push(ugd.sent.subs[key][i].code);
                                        }
                                    }
                                    giveaways.sentTimestamp = ugd.sentTimestamp;
                                }
                                if (ugd.won) {
                                    for (key in ugd.won.apps) {
                                        giveaways.won.apps[key] = [];
                                        for (i = 0, n = ugd.won.apps[key].length; i < n; ++i) {
                                            ggiveaways[ugd.won.apps[key][i].code] = ugd.won.apps[key][i];
                                            giveaways.won.apps[key].push(ugd.won.apps[key][i].code);
                                        }
                                    }
                                    for (key in ugd.won.subs) {
                                        giveaways.won.subs[key] = [];
                                        for (i = 0, n = ugd.won.subs[key].length; i < n; ++i) {
                                            ggiveaways[ugd.won.subs[key][i].code] = ugd.won.subs[key][i];
                                            giveaways.won.subs[key].push(ugd.won.subs[key][i].code);
                                        }
                                    }
                                    giveaways.wonTimestamp = ugd.wonTimestamp;
                                }
                            }
                        }
                    }
                    if (!giveaways.sent[giveaway.gameType][giveaway.gameSteamId]) {
                        giveaways.sent[giveaway.gameType][giveaway.gameSteamId] = [];
                    }
                    if (giveaways.sent[giveaway.gameType][giveaway.gameSteamId].indexOf(giveaway.code) < 0) {
                        giveaways.sent[giveaway.gameType][giveaway.gameSteamId].push(giveaway.code);
                    }
                    user.values = {
                        giveaways: giveaways
                    };
                    lockAndSaveGiveaways(ggiveaways, saveUser.bind(null, null, null, user, () => popup.close()));
                });
            }
        });
    }

    function loadFeatures() {
        let hiddenButtonsBefore, hiddenButtonsAfter;
        if (esgst.hideButtons) {
            hiddenButtonsBefore = document.createElement(`div`);
            hiddenButtonsBefore.className = `esgst-heading-button`;
            hiddenButtonsBefore.innerHTML = `
                <i class="fa fa-ellipsis-v"></i>
            `;
            esgst.leftButtons = insertHtml(new Popout(`esgst-hidden-buttons`, hiddenButtonsBefore, 0, true).popout, `beforeEnd`, `
                <div class="esgst-page-heading"></div>
            `);
            hiddenButtonsAfter = document.createElement(`div`);
            hiddenButtonsAfter.className = `esgst-heading-button`;
            hiddenButtonsAfter.innerHTML = `
                <i class="fa fa-ellipsis-v"></i>
            `;
            esgst.rightButtons = insertHtml(new Popout(`esgst-hidden-buttons`, hiddenButtonsAfter, 0, true).popout, `beforeEnd`, `
                <div class="esgst-page-heading"></div>
            `);
        }

        if (esgst.ch || (esgst.et && esgst.sg)) {
            let context = esgst.sg ? esgst.mainButton.parentElement.getElementsByClassName(`nav__absolute-dropdown`)[0].lastElementChild : esgst.mainButton.parentElement.getElementsByClassName(`dropdown`)[0].firstElementChild.lastElementChild;
            if (esgst.ch) {
                setSMCommentHistory(insertHtml(context, `beforeBegin`, `
                    <div class="esgst-header-menu-row">
                        <i class="fa fa-fw fa-comments yellow"></i>
                        <div>
                            <p class="esgst-header-menu-name">My Comment History</p>
                            <p class="esgst-header-menu-description">View your comment history.</p>
                        </div>
                    </div>
                `));
            }
            if (esgst.et && esgst.sg) {
                setSMManageEntriesTracker(insertHtml(context, `beforeBegin`, `
                    <div class="esgst-header-menu-row">
                        <i class="fa fa-fw fa-ticket red"></i>
                        <div>
                            <p class="esgst-header-menu-name">My Entry History</p>
                            <p class="esgst-header-menu-description">View your entry history.</p>
                        </div>
                    </div>
                `));
            }
        }

        /* [FH] Fixed Header */

        if (esgst.fh) {
            let height;
            esgst.header.classList.add(`esgst-fh`);
            if (esgst.featuredContainer && (!esgst.hfc || !esgst.giveawaysPath)) {
                esgst.featuredContainer.classList.add(`esgst-fh-sibling`);
            } else {
                esgst.pageOuterWrap.classList.add(`esgst-fh-sibling`);
            }
            height = esgst.header.offsetHeight;
            esgst.pageTop += height;
            esgst.commentsTop += height;
            esgst.style.insertAdjacentText(`beforeEnd`, `
                .esgst-fh-sibling {
                    margin-top: ${height}px;
                }
            `);
        }

        /* [FS] Fixed Sidebar */

        if (esgst.fs && esgst.sidebar) {
            esgst.sidebarAd = esgst.sidebar.getElementsByClassName(`sidebar__mpu`)[0];
            esgst.sidebarSibling = esgst.sidebar.nextElementSibling;
            document.addEventListener(`scroll`, fixFsSidebar);
            fixFsSidebar();
            esgst.style.insertAdjacentText(`beforeEnd`, `
                .esgst-fs {
                    position: fixed;
                    top: ${esgst.pageTop}px;
                }
            `);
        }

        /* [FMPH] Fixed Main Page Heading */

        if (esgst.fmph && esgst.mainPageHeading) {
            let height;
            esgst.mainPageHeading.insertAdjacentHTML(`afterEnd`, `
                <div class="esgst-fmph-placeholder esgst-hidden"></div>
                <div class="esgst-fmph-background ${esgst.pageOuterWrapClass} esgst-hidden"></div>
            `);
            esgst.mainPageHeadingPlaceholder = esgst.mainPageHeading.nextElementSibling;
            esgst.mainPageHeadingBackground = esgst.mainPageHeadingPlaceholder.nextElementSibling;
            document.addEventListener(`scroll`, fixFmphHeading);
            fixFmphHeading();
            height = esgst.mainPageHeading.offsetHeight;
            newHeight = (esgst.gf && esgst.gf_m && (esgst.giveawaysPath || esgst.groupsPath || esgst.createdPath || esgst.enteredPath || esgst.wonPath)) || (esgst.df && esgst.df_m && esgst.discussionsPath) ? height + 23 : height;
            esgst.style.insertAdjacentText(`beforeEnd`, `
                .esgst-fmph {
                    position: fixed;
                    top: ${esgst.pageTop}px;
                    z-index: 998;
                }
                .esgst-fmph-placeholder {
                    height: ${newHeight}px;
                }
                .esgst-fmph-background {
                    height: ${esgst.pageTop + newHeight + 5}px;
                    padding: 0;
                    position: fixed;
                    top: 0;
                    z-index: 997;
                }
                .esgst-gf-container-fixed {
                    position: fixed;
                    top: ${esgst.pageTop + 34}px;
                    z-index: 998;
                }
            `);
            esgst.commentsTop += height + 30;
        }

        /* [FF] Fixed Footer */

        if (esgst.ff && esgst.footer) {
            esgst.footer.classList.add(`esgst-ff`);
            esgst.pageOuterWrap.classList.add(`esgst-ff-sibling`);
        }

        /* [QGS] Quick Giveaway Search */

        if (esgst.qgs) {
            let container, input;
            container = insertHtml(document.getElementsByClassName(`nav__left-container`)[0], `afterBegin`, `
                <div class="esgst-qgs-container">
                    <input class="esgst-qgs-input" placeholder="Search..." type="text">
                    <i class="fa fa-search"></i>
                </div>
            `);
            input = container.firstElementChild;
            container.addEventListener(`mouseenter`, event => {
                container.classList.add(`esgst-qgs-container-expanded`);
            });
            container.addEventListener(`mouseleave`, event => {
                if (!event.relatedTarget.closest(`.esgst-popout`)) {
                    container.classList.remove(`esgst-qgs-container-expanded`);
                }
            });
            input.addEventListener(`keypress`, event => {
                if (event.key === `Enter`) {
                    event.preventDefault();
                    location.href = `/giveaways/search?q=${encodeURIComponent(input.value)}`;
                }
            });
            addAgsPanel(container, true);
            if (esgst.qgs_h && esgst.giveawaysPath) {
                document.getElementsByClassName(`sidebar__search-container`)[0].remove();
            }
        }

        /* [QGB] Quick Giveaway Browsing */

        if (esgst.qgb) {
            let html = ``;
            [
                {name: `Browse Wishlist Giveaways`, url: `/giveaways/search?type=wishlist`},
                {name: `Browse Recommended Giveaways`, url: `/giveaways/search?type=recommended`},
                {name: `Browse Group Giveaways`, url: `/giveaways/search?type=group`},
                {name: `Browse New Giveaways`, url: `/giveaways/search?type=new`}

            ].forEach(details => {
                html += generateHeaderMenuItem(details);
            });
            document.getElementsByClassName(`nav__absolute-dropdown`)[0].insertAdjacentHTML(`beforeEnd`, html);
        }

        /* [HR] Header Refresher */

        if (esgst.hr) {
            let hr = {
                wishlist: 0,
                messages: 0,
                points: esgst.points,
                wins: 0
            };
            notifyHrChange(hr, 0);
            setLocalValue(`hrCache`, JSON.stringify(getHrCache()));
            startHeaderRefresher(hr);
            if (!esgst.hr_b) {
                addEventListener(`focus`, startHeaderRefresher.bind(null, hr));
                addEventListener(`blur`, () => clearTimeout(hr.refresher));
            }
        } else if (esgst.lpv) {
            setLpvStyle();
        }
        if ((esgst.lpv || esgst.cewgd || (esgst.gc && esgst.gc_gi)) && esgst.giveawayPath && document.referrer === `https://www.steamgifts.com/giveaways/new`) {
            addGiveawayToStorage();
        }

        /* [HFC] Hidden Featured Container */

        if (esgst.hfc && esgst.giveawaysPath && esgst.featuredContainer) {
            esgst.featuredContainer.classList.add(`esgst-hidden`);
        }

        /* [HPG] Hidden Pinned Giveaways */

        if (esgst.hpg && esgst.giveawaysPath && esgst.pinnedGiveaways) {
            esgst.pinnedGiveaways.classList.add(`esgst-hidden`);
        }

        /* [HCP] Hidden Community Poll */

        if (esgst.hcp && esgst.giveawaysPath && esgst.activeDiscussions) {
            let poll = esgst.activeDiscussions.previousElementSibling;
            if (poll && poll.classList.contains(`widget-container`)) {
                if (!esgst.hcp_v || poll.querySelector(`.table__row-outer-wrap.is-selected`)) {
                    poll.classList.add(`esgst-hidden`);
                }
            }
        }

        /* [PNOT] Pagination Navigation On Top */

        if (esgst.pnot && esgst.paginationNavigation && esgst.mainPageHeading) {
            esgst.paginationNavigation.classList.add(`page_heading_btn`);
            esgst.mainPageHeading.appendChild(esgst.paginationNavigation);
        }

        if (esgst.lpl && esgst.paginationNavigation) {
            if (esgst.discussionPath) {
                addLplDiscussionLink();
            } else if (esgst.userPath) {
                addLplUserLink();
            } else if (esgst.groupPath) {
                addLplGroupLink();
            }
        }

        /* [IB] Image Borders */

        if (esgst.ib) {
            esgst.endlessFeatures.push(addIbBorders);
            addIbBorders(document);
        }

        /* [CFH] Comment Formatting Helper */

        if (esgst.cfh) {
            esgst.cfh = {
                backup: [],
                history: [],
                panel: document.createElement(`div`),
                preview: document.createElement(`div`)
            };
            esgst.cfh.panel.className = `esgst-cfh-panel`;
            [
                {
                    id: `cfh_i`,
                    icons: [`fa-italic`],
                    name: `Italic`,
                    prefix: `*`,
                    suffix: `*`
                },
                {
                    id: `cfh_b`,
                    icons: [`fa-bold`],
                    name: `Bold`,
                    prefix: `**`,
                    suffix: `**`
                },
                {
                    id: `cfh_s`,
                    icons: [`fa-eye-slash`],
                    name: `Spoiler`,
                    prefix: `~`,
                    suffix: `~`
                },
                {
                    id: `cfh_st`,
                    icons: [`fa-strikethrough`],
                    name: `Strikethrough`,
                    prefix: `~~`,
                    suffix: `~~`
                },
                {
                    id: `cfh_h1`,
                    icons: [`fa-header`],
                    name: `Heading 1`,
                    prefix: `# `,
                    text: `1`
                },
                {
                    id: `cfh_h2`,
                    icons: [`fa-header`],
                    name: `Heading 2`,
                    prefix: `## `,
                    text: `2`
                },
                {
                    id: `cfh_h3`,
                    icons: [`fa-header`],
                    name: `Heading 3`,
                    prefix: `### `,
                    text: `3`
                },
                {
                    id: `cfh_bq`,
                    icons: [`fa-quote-left`],
                    name: `Blockquote`,
                    prefix: `> `
                },
                {
                    id: `cfh_lb`,
                    icons: [`fa-minus`],
                    name: `Line Break`,
                    prefix: `---`
                },
                {
                    id: `cfh_ol`,
                    icons: [`fa-list-ol`],
                    multiline: true,
                    name: `Ordered List`,
                    prefix: `[n]. `
                },
                {
                    id: `cfh_ul`,
                    icons: [`fa-list-ul`],
                    multiline: true,
                    name: `Unordered List`,
                    prefix: `* `
                },
                {
                    id: `cfh_ic`,
                    icons: [`fa-code`],
                    name: `Inline Code`,
                    prefix: `\``,
                    suffix: `\``
                },
                {
                    id: `cfh_lc`,
                    icons: [`fa-code`, `fa-indent`],
                    name: `Line Code`,
                    prefix: `    `
                },
                {
                    id: `cfh_pc`,
                    icons: [`fa-code`, `fa-paragraph`],
                    name: `Paragraph Code`,
                    prefix: `\`\`\`\n`,
                    suffix: `\n\`\`\``
                },
                {
                    id: `cfh_l`,
                    icons: [`fa-globe`],
                    name: `Link`,
                    setPopout: popout => {
                        let title, url;
                        popout.popout.innerHTML = `
                            <div>URL: <input placeholder="http://www.example.com" type="text"/></div>
                            <div>Title: <input placeholder="Cat" type="text"/></div>
                            <div class="form__saving-button btn_action white">Add</div>
                        `;
                        url = popout.popout.firstElementChild.firstElementChild;
                        title = popout.popout.firstElementChild.nextElementSibling.firstElementChild;
                        popout.popout.lastElementChild.addEventListener(`click`, () => {
                            formatCfhLink(title.value, url.value);
                            url.value = ``;
                            title.value = ``;
                            popout.close();
                        });
                    },
                    callback: popout => {
                        let title = popout.firstElementChild.nextElementSibling.firstElementChild;
                        title.value = esgst.cfh.textArea.value.slice(esgst.cfh.textArea.selectionStart, esgst.cfh.textArea.selectionEnd);
                        title.focus();
                    }
                },
                {
                    id: `cfh_img`,
                    icons: [`fa-image`],
                    name: `Image`,
                    setPopout: popout => {
                        let title, url;
                        popout.popout.innerHTML = `
                            <div>URL: <input placeholder="http://www.example.com/image.jpg" type="text"/> <i class="fa fa-upload esgst-clickable" title="Upload image to Imgur and use it"></i></div>
                            <div>Title: <input placeholder="Cat" type="text"/></div>
                            <div class="form__saving-button btn_action white">Add</div>
                        `;
                        url = popout.popout.firstElementChild.firstElementChild;
                        imgur = url.nextElementSibling;
                        title = popout.popout.firstElementChild.nextElementSibling.firstElementChild;
                        imgur.addEventListener(`click`, () => {
                            multiChoice(`grey`, `fa-user-secret`, `Anonymously`, `grey`, `fa-user`, `Through Account`, `How would you like to upload?`, uploadImgurImage.bind(null, `Client-ID e25283ef48ab9aa`, popout, url), () => {
                                delValue(`imgurToken`).then(() => {
                                    openSmallWindow(`https://api.imgur.com/oauth2/authorize?client_id=e25283ef48ab9aa&response_type=token`);
                                    checkImgurComplete(popout, url);
                                });
                            });
                        });
                        popout.popout.lastElementChild.addEventListener(`click`, () => {
                            formatCfhLink(title.value, url.value, true);
                            url.value = ``;
                            title.value = ``;
                            popout.close();
                        });
                    },
                    callback: popout => {
                        let title, url;
                        url = popout.firstElementChild.firstElementChild;
                        title = popout.firstElementChild.nextElementSibling.firstElementChild;
                        title.value = esgst.cfh.textArea.value.slice(esgst.cfh.textArea.selectionStart, esgst.cfh.textArea.selectionEnd);
                        if (url.value && title.value) {
                            popout.lastElementChild.click();
                        } else if (url.value) {
                            title.focus();
                        } else {
                            url.focus();
                        }
                    }
                },
                {
                    id: `cfh_t`,
                    icons: [`fa-table`],
                    name: `Table`,
                    setPopup: popup => {
                        let context, insertColumn, insertRow, table;
                        context = popup.scrollable;
                        context.innerHTML = `
                            <table></table>
                            <div class="form__saving-button btn_action white">Insert Row</div>
                            <div class="form__saving-button btn_action white">Insert Column</div>
                            <div class="form__saving-button btn_action white">Add</div>
                        `;
                        table = context.firstElementChild;
                        insertRow = table.nextElementSibling;
                        insertColumn = insertRow.nextElementSibling;
                        insertCfhTableRows(4, table);
                        insertCfhTableColumns(2, table);
                        insertRow.addEventListener(`click`, () => {
                            insertCfhTableRows(1, table);
                        });
                        insertColumn.addEventListener(`click`, () => {
                            insertCfhTableColumns(1, table);
                        });
                        insertColumn.nextElementSibling.addEventListener(`click`, () => {
                            let end, i, j, numColumns, numRows, rows, start, value;
                            rows = table.rows;
                            for (i = 1, numRows = rows.length; i < numRows; ++i) {
                                for (j = 1, numColumns = rows[0].cells.length; j < numColumns; ++j) {
                                    if (!rows[i].cells[j].firstElementChild.value) {
                                        i = numRows + 1;
                                        j = numColumns + 1;
                                    }
                                }
                            }
                            if (i <= numRows || (i > numRows && confirm(`Some cells are empty. This might lead to unexpected results. Are you sure you want to continue?`))) {
                                value = ``;
                                for (i = 1; i < numRows; ++i) {
                                    value += `\n`;
                                    for (j = 1; j < numColumns; ++j) {
                                        value += `${rows[i].cells[j].firstElementChild.value}${j < numColumns - 1 ? ` | ` : ``}`;
                                    }
                                }
                                value = value.replace(/^\n/, ``);
                                start = esgst.cfh.textArea.selectionStart;
                                end = esgst.cfh.textArea.selectionEnd;
                                esgst.cfh.textArea.value = `${esgst.cfh.textArea.value.slice(0, start)}${value}${esgst.cfh.textArea.value.slice(end)}`;
                                esgst.cfh.textArea.setSelectionRange(end + value.length, end + value.length);
                                esgst.cfh.textArea.focus();
                                popup.close();
                            }
                        });
                    }
                },
                {
                    id: `cfh_e`,
                    icons: [`fa-smile-o`],
                    name: `Emojis`,
                    setPopout: popout => {
                        let emojis, popup;
                        getValue(`emojis`, ``).then(value => {
                            popout.popout.innerHTML = `
                                <div class="esgst-cfh-emojis">${value}</div>
                                <div class="form__saving-button btn_action white">Select Emojis</div>
                            `;
                            emojis = popout.popout.firstElementChild;
                            setCfhEmojis(emojis);
                            emojis.nextElementSibling.addEventListener(`click`, () => {
                                if (popup) {
                                    popup.open(() => {
                                        popout.popout.classList.add(`esgst-hidden`);
                                    });
                                } else {
                                    let emoji, emojis, filter, i;
                                    getValue(`emojis`, ``).then(value => {
                                        popup = new Popup(`fa-smile-o`, `Select emojis:`);
                                        popup.scrollable.insertAdjacentHTML(`afterBegin`, `
                                            <input placeholder="Filter emojis..." type="text"/>
                                            <div class="esgst-cfh-emojis"></div>
                                            <div class="esgst-description">Drag the emojis you want to use and drop them in the box below. Click on an emoji to remove it.</div>
                                            <div class="global__image-outer-wrap page_heading_btn esgst-cfh-emojis">${value}</div>
                                        `);
                                        filter = popup.scrollable.firstElementChild;
                                        emojis = filter.nextElementSibling;
                                        [
                                            {emoji: `&#xAF;&#92;&#92;&#92;&#95;&#40;&#x30C4;&#41;&#95;&#47;&#xAF;`, name: ``},
                                            {emoji: `&#40; &#x361;&#xB0; &#x35C;&#x296; &#x361;&#xB0;&#41;`, name: ``},
                                            {emoji: `&#40; &#x361;&#x2299; &#x35C;&#x296; &#x361;&#x2299;&#41;`, name: ``},
                                            {emoji: `&#40;&#x30CE;&#xCA0;&#x76CA;&#xCA0;&#41;&#x30CE;`, name: ``},
                                            {emoji: `&#40;&#x256F;&#xB0;&#x25A1;&#xB0;&#xFF09;&#x256F;&#xFE35; &#x253B;&#x2501;&#x253B;`, name: ``},
                                            {emoji: `&#x252C;&#x2500;&#x252C;&#x30CE;&#40; &#xBA; &#95; &#xBA;&#x30CE;&#41;`, name: ``},
                                            {emoji: `&#x10DA;&#40;&#xCA0;&#x76CA;&#xCA0;&#x10DA;&#41;`, name: ``},
                                            {emoji: `&#40;&#x25D5;&#x203F;-&#41;&#x270C;`, name: ``},
                                            {emoji: `&#40;&#xFF61;&#x25D5;&#x203F;&#x25D5;&#xFF61;&#41;`, name: ``},
                                            {emoji: `&#40;&#x25D1;&#x203F;&#x25D0;&#41;`, name: ``},
                                            {emoji: `&#x25D4;&#95;&#x25D4;`, name: ``},
                                            {emoji: `&#40;&#x2022;&#x203F;&#x2022;&#41;`, name: ``},
                                            {emoji: `&#40;&#xCA0;&#95;&#xCA0;&#41;`, name: ``},
                                            {emoji: `&#40;&#xAC;&#xFF64;&#xAC;&#41;`, name: ``},
                                            {emoji: `&#40;&#x2500;&#x203F;&#x203F;&#x2500;&#41;`, name: ``},
                                            {emoji: `&#40;&#xCA5;&#xFE4F;&#xCA5;&#41;`, name: ``},
                                            {emoji: `&#40;&#xCA5;&#x2038;&#xCA5;&#41;`, name: ``},
                                            {emoji: `&#40;&#x2310;&#x25A0;&#95;&#x25A0;&#41;`, name: ``},
                                            {emoji: `&#40;&#x25B0;&#x2D8;&#x25E1;&#x2D8;&#x25B0;&#41;`, name: ``},
                                            {emoji: `&#x4E41;&#40; &#x25D4; &#xC6A;&#x25D4;&#41;&#x310F;`, name: ``},
                                            {emoji: `&#40;&#xE07; &#x360;&#xB0; &#x35F;&#x296; &#x361;&#xB0;&#41;&#xE07;`, name: ``},
                                            {emoji: `&#x3B6;&#xF3C;&#x19F;&#x346;&#x644;&#x35C;&#x19F;&#x346;&#xF3D;&#x1D98;`, name: ``},
                                            {emoji: `&#x295;&#x2022;&#x1D25;&#x2022;&#x294;`, name: ``},
                                            {emoji: `&#40; &#x35D;&#xB0; &#x35C;&#x296;&#x361;&#xB0;&#41;`, name: ``},
                                            {emoji: `&#40;&#47;&#xFF9F;&#x414;&#xFF9F;&#41;&#47;`, name: ``},
                                            {emoji: `&#xB67;&#xF3C;&#xCA0;&#x76CA;&#xCA0;&#xF3D;&#xB68;`, name: ``},
                                            {emoji: `&#40;&#xE07; &#x2022;&#x300;&#95;&#x2022;&#x301;&#41;&#xE07;`, name: ``},
                                            {emoji: `&#x1F600`, name: `Grinning Face`},
                                            {emoji: `&#x1F601`, name: `Grinning Face With Smiling Eyes`},
                                            {emoji: `&#x1F602`, name: `Face With Tears Of Joy`},
                                            {emoji: `&#x1F923`, name: `Rolling On The Floor Laughing`},
                                            {emoji: `&#x1F603`, name: `Smiling Face With Open Mouth`},
                                            {emoji: `&#x1F604`, name: `Smiling Face With Open Mouth & Smiling Eyes`},
                                            {emoji: `&#x1F605`, name: `Smiling Face With Open Mouth & Cold Sweat`},
                                            {emoji: `&#x1F606`, name: `Smiling Face With Open Mouth & Closed Eyes`},
                                            {emoji: `&#x1F609`, name: `Winking Face`},
                                            {emoji: `&#x1F60A`, name: `Smiling Face With Smiling Eyes`},
                                            {emoji: `&#x1F60B`, name: `Face Savouring Delicious Food`},
                                            {emoji: `&#x1F60E`, name: `Smiling Face With Sunglasses`},
                                            {emoji: `&#x1F60D`, name: `Smiling Face With Heart-Eyes`},
                                            {emoji: `&#x1F618`, name: `Face Blowing A Kiss`},
                                            {emoji: `&#x1F617`, name: `Kissing Face`},
                                            {emoji: `&#x1F619`, name: `Kissing Face With Smiling Eyes`},
                                            {emoji: `&#x1F61A`, name: `Kissing Face With Closed Eyes`},
                                            {emoji: `&#x263A`, name: `Smiling Face`},
                                            {emoji: `&#x1F642`, name: `Slightly Smiling Face`},
                                            {emoji: `&#x1F917`, name: `Hugging Face`},
                                            {emoji: `&#x1F914`, name: `Thinking Face`},
                                            {emoji: `&#x1F610`, name: `Neutral Face`},
                                            {emoji: `&#x1F611`, name: `Expressionless Face`},
                                            {emoji: `&#x1F636`, name: `Face Without Mouth`},
                                            {emoji: `&#x1F644`, name: `Face With Rolling Eyes`},
                                            {emoji: `&#x1F60F`, name: `Smirking Face`},
                                            {emoji: `&#x1F623`, name: `Persevering Face`},
                                            {emoji: `&#x1F625`, name: `Disappointed But Relieved Face`},
                                            {emoji: `&#x1F62E`, name: `Face With Open Mouth`},
                                            {emoji: `&#x1F910`, name: `Zipper-Mouth Face`},
                                            {emoji: `&#x1F62F`, name: `Hushed Face`},
                                            {emoji: `&#x1F62A`, name: `Sleepy Face`},
                                            {emoji: `&#x1F62B`, name: `Tired Face`},
                                            {emoji: `&#x1F634`, name: `Sleeping Face`},
                                            {emoji: `&#x1F60C`, name: `Relieved Face`},
                                            {emoji: `&#x1F913`, name: `Nerd Face`},
                                            {emoji: `&#x1F61B`, name: `Face With Stuck-Out Tongue`},
                                            {emoji: `&#x1F61C`, name: `Face With Stuck-Out Tongue & Winking Eye`},
                                            {emoji: `&#x1F61D`, name: `Face With Stuck-Out Tongue & Closed Eyes`},
                                            {emoji: `&#x1F924`, name: `Drooling Face`},
                                            {emoji: `&#x1F612`, name: `Unamused Face`},
                                            {emoji: `&#x1F613`, name: `Face With Cold Sweat`},
                                            {emoji: `&#x1F614`, name: `Pensive Face`},
                                            {emoji: `&#x1F615`, name: `Confused Face`},
                                            {emoji: `&#x1F643`, name: `Upside-Down Face`},
                                            {emoji: `&#x1F911`, name: `Money-Mouth Face`},
                                            {emoji: `&#x1F632`, name: `Astonished Face`},
                                            {emoji: `&#x2639`, name: `Frowning Face`},
                                            {emoji: `&#x1F641`, name: `Slightly Frowning Face`},
                                            {emoji: `&#x1F616`, name: `Confounded Face`},
                                            {emoji: `&#x1F61E`, name: `Disappointed Face`},
                                            {emoji: `&#x1F61F`, name: `Worried Face`},
                                            {emoji: `&#x1F624`, name: `Face With Steam From Nose`},
                                            {emoji: `&#x1F622`, name: `Crying Face`},
                                            {emoji: `&#x1F62D`, name: `Loudly Crying Face`},
                                            {emoji: `&#x1F626`, name: `Frowning Face With Open Mouth`},
                                            {emoji: `&#x1F627`, name: `Anguished Face`},
                                            {emoji: `&#x1F628`, name: `Fearful Face`},
                                            {emoji: `&#x1F629`, name: `Weary Face`},
                                            {emoji: `&#x1F62C`, name: `Grimacing Face`},
                                            {emoji: `&#x1F630`, name: `Face With Open Mouth & Cold Sweat`},
                                            {emoji: `&#x1F631`, name: `Face Screaming In Fear`},
                                            {emoji: `&#x1F633`, name: `Flushed Face`},
                                            {emoji: `&#x1F635`, name: `Dizzy Face`},
                                            {emoji: `&#x1F621`, name: `Pouting Face`},
                                            {emoji: `&#x1F620`, name: `Angry Face`},
                                            {emoji: `&#x1F607`, name: `Smiling Face With Halo`},
                                            {emoji: `&#x1F920`, name: `Cowboy Hat Face`},
                                            {emoji: `&#x1F921`, name: `Clown Face`},
                                            {emoji: `&#x1F925`, name: `Lying Face`},
                                            {emoji: `&#x1F637`, name: `Face With Medical Mask`},
                                            {emoji: `&#x1F912`, name: `Face With Thermometer`},
                                            {emoji: `&#x1F915`, name: `Face With Head-Bandage`},
                                            {emoji: `&#x1F922`, name: `Nauseated Face`},
                                            {emoji: `&#x1F927`, name: `Sneezing Face`},
                                            {emoji: `&#x1F608`, name: `Smiling Face With Horns`},
                                            {emoji: `&#x1F47F`, name: `Angry Face With Horns`},
                                            {emoji: `&#x1F479`, name: `Ogre`},
                                            {emoji: `&#x1F47A`, name: `Goblin`},
                                            {emoji: `&#x1F480`, name: `Skull`},
                                            {emoji: `&#x2620`, name: `Skull And Crossbones`},
                                            {emoji: `&#x1F47B`, name: `Ghost`},
                                            {emoji: `&#x1F47D`, name: `Alien`},
                                            {emoji: `&#x1F47E`, name: `Alien Monster`},
                                            {emoji: `&#x1F916`, name: `Robot Face`},
                                            {emoji: `&#x1F4A9`, name: `Pile Of Poo`},
                                            {emoji: `&#x1F63A`, name: `Smiling Cat Face With Open Mouth`},
                                            {emoji: `&#x1F638`, name: `Grinning Cat Face With Smiling Eyes`},
                                            {emoji: `&#x1F639`, name: `Cat Face With Tears Of Joy`},
                                            {emoji: `&#x1F63B`, name: `Smiling Cat Face With Heart-Eyes`},
                                            {emoji: `&#x1F63C`, name: `Cat Face With Wry Smile`},
                                            {emoji: `&#x1F63D`, name: `Kissing Cat Face With Closed Eyes`},
                                            {emoji: `&#x1F640`, name: `Weary Cat Face`},
                                            {emoji: `&#x1F63F`, name: `Crying Cat Face`},
                                            {emoji: `&#x1F63E`, name: `Pouting Cat Face`},
                                            {emoji: `&#x1F648`, name: `See-No-Evil Monkey`},
                                            {emoji: `&#x1F649`, name: `Hear-No-Evil Monkey`},
                                            {emoji: `&#x1F64A`, name: `Speak-No-Evil Monkey`},
                                            {emoji: `&#x1F466`, name: `Boy`},
                                            {emoji: `&#x1F466&#x1F3FB`, name: `Boy: Light Skin Tone`},
                                            {emoji: `&#x1F466&#x1F3FC`, name: `Boy: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F466&#x1F3FD`, name: `Boy: Medium Skin Tone`},
                                            {emoji: `&#x1F466&#x1F3FE`, name: `Boy: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F466&#x1F3FF`, name: `Boy: Dark Skin Tone`},
                                            {emoji: `&#x1F467`, name: `Girl`},
                                            {emoji: `&#x1F467&#x1F3FB`, name: `Girl: Light Skin Tone`},
                                            {emoji: `&#x1F467&#x1F3FC`, name: `Girl: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F467&#x1F3FD`, name: `Girl: Medium Skin Tone`},
                                            {emoji: `&#x1F467&#x1F3FE`, name: `Girl: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F467&#x1F3FF`, name: `Girl: Dark Skin Tone`},
                                            {emoji: `&#x1F468`, name: `Man`},
                                            {emoji: `&#x1F468&#x1F3FB`, name: `Man: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC`, name: `Man: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD`, name: `Man: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE`, name: `Man: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF`, name: `Man: Dark Skin Tone`},
                                            {emoji: `&#x1F469`, name: `Woman`},
                                            {emoji: `&#x1F469&#x1F3FB`, name: `Woman: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC`, name: `Woman: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD`, name: `Woman: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE`, name: `Woman: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF`, name: `Woman: Dark Skin Tone`},
                                            {emoji: `&#x1F474`, name: `Old Man`},
                                            {emoji: `&#x1F474&#x1F3FB`, name: `Old Man: Light Skin Tone`},
                                            {emoji: `&#x1F474&#x1F3FC`, name: `Old Man: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F474&#x1F3FD`, name: `Old Man: Medium Skin Tone`},
                                            {emoji: `&#x1F474&#x1F3FE`, name: `Old Man: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F474&#x1F3FF`, name: `Old Man: Dark Skin Tone`},
                                            {emoji: `&#x1F475`, name: `Old Woman`},
                                            {emoji: `&#x1F475&#x1F3FB`, name: `Old Woman: Light Skin Tone`},
                                            {emoji: `&#x1F475&#x1F3FC`, name: `Old Woman: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F475&#x1F3FD`, name: `Old Woman: Medium Skin Tone`},
                                            {emoji: `&#x1F475&#x1F3FE`, name: `Old Woman: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F475&#x1F3FF`, name: `Old Woman: Dark Skin Tone`},
                                            {emoji: `&#x1F476`, name: `Baby`},
                                            {emoji: `&#x1F476&#x1F3FB`, name: `Baby: Light Skin Tone`},
                                            {emoji: `&#x1F476&#x1F3FC`, name: `Baby: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F476&#x1F3FD`, name: `Baby: Medium Skin Tone`},
                                            {emoji: `&#x1F476&#x1F3FE`, name: `Baby: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F476&#x1F3FF`, name: `Baby: Dark Skin Tone`},
                                            {emoji: `&#x1F47C`, name: `Baby Angel`},
                                            {emoji: `&#x1F47C&#x1F3FB`, name: `Baby Angel: Light Skin Tone`},
                                            {emoji: `&#x1F47C&#x1F3FC`, name: `Baby Angel: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F47C&#x1F3FD`, name: `Baby Angel: Medium Skin Tone`},
                                            {emoji: `&#x1F47C&#x1F3FE`, name: `Baby Angel: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F47C&#x1F3FF`, name: `Baby Angel: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x2695&#xFE0F`, name: `Man Health Worker`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x2695&#xFE0F`, name: `Man Health Worker: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x2695&#xFE0F`, name: `Man Health Worker: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x2695&#xFE0F`, name: `Man Health Worker: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x2695&#xFE0F`, name: `Man Health Worker: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x2695&#xFE0F`, name: `Man Health Worker: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x2695&#xFE0F`, name: `Woman Health Worker`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x2695&#xFE0F`, name: `Woman Health Worker: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x2695&#xFE0F`, name: `Woman Health Worker: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x2695&#xFE0F`, name: `Woman Health Worker: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x2695&#xFE0F`, name: `Woman Health Worker: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x2695&#xFE0F`, name: `Woman Health Worker: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F393`, name: `Man Student`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F393`, name: `Man Student: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F393`, name: `Man Student: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F393`, name: `Man Student: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F393`, name: `Man Student: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F393`, name: `Man Student: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F393`, name: `Woman Student`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F393`, name: `Woman Student: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F393`, name: `Woman Student: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F393`, name: `Woman Student: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F393`, name: `Woman Student: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F393`, name: `Woman Student: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F3EB`, name: `Man Teacher`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F3EB`, name: `Man Teacher: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F3EB`, name: `Man Teacher: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F3EB`, name: `Man Teacher: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F3EB`, name: `Man Teacher: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F3EB`, name: `Man Teacher: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F3EB`, name: `Woman Teacher`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F3EB`, name: `Woman Teacher: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F3EB`, name: `Woman Teacher: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F3EB`, name: `Woman Teacher: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F3EB`, name: `Woman Teacher: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F3EB`, name: `Woman Teacher: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x2696&#xFE0F`, name: `Man Judge`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x2696&#xFE0F`, name: `Man Judge: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x2696&#xFE0F`, name: `Man Judge: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x2696&#xFE0F`, name: `Man Judge: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x2696&#xFE0F`, name: `Man Judge: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x2696&#xFE0F`, name: `Man Judge: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x2696&#xFE0F`, name: `Woman Judge`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x2696&#xFE0F`, name: `Woman Judge: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x2696&#xFE0F`, name: `Woman Judge: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x2696&#xFE0F`, name: `Woman Judge: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x2696&#xFE0F`, name: `Woman Judge: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x2696&#xFE0F`, name: `Woman Judge: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F33E`, name: `Man Farmer`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F33E`, name: `Man Farmer: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F33E`, name: `Man Farmer: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F33E`, name: `Man Farmer: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F33E`, name: `Man Farmer: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F33E`, name: `Man Farmer: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F33E`, name: `Woman Farmer`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F33E`, name: `Woman Farmer: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F33E`, name: `Woman Farmer: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F33E`, name: `Woman Farmer: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F33E`, name: `Woman Farmer: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F33E`, name: `Woman Farmer: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F373`, name: `Man Cook`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F373`, name: `Man Cook: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F373`, name: `Man Cook: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F373`, name: `Man Cook: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F373`, name: `Man Cook: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F373`, name: `Man Cook: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F373`, name: `Woman Cook`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F373`, name: `Woman Cook: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F373`, name: `Woman Cook: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F373`, name: `Woman Cook: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F373`, name: `Woman Cook: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F373`, name: `Woman Cook: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F527`, name: `Man Mechanic`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F527`, name: `Man Mechanic: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F527`, name: `Man Mechanic: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F527`, name: `Man Mechanic: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F527`, name: `Man Mechanic: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F527`, name: `Man Mechanic: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F527`, name: `Woman Mechanic`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F527`, name: `Woman Mechanic: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F527`, name: `Woman Mechanic: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F527`, name: `Woman Mechanic: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F527`, name: `Woman Mechanic: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F527`, name: `Woman Mechanic: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F3ED`, name: `Man Factory Worker`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F3ED`, name: `Man Factory Worker: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F3ED`, name: `Man Factory Worker: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F3ED`, name: `Man Factory Worker: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F3ED`, name: `Man Factory Worker: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F3ED`, name: `Man Factory Worker: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F3ED`, name: `Woman Factory Worker`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F3ED`, name: `Woman Factory Worker: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F3ED`, name: `Woman Factory Worker: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F3ED`, name: `Woman Factory Worker: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F3ED`, name: `Woman Factory Worker: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F3ED`, name: `Woman Factory Worker: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F4BC`, name: `Man Office Worker`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F4BC`, name: `Man Office Worker: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F4BC`, name: `Man Office Worker: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F4BC`, name: `Man Office Worker: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F4BC`, name: `Man Office Worker: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F4BC`, name: `Man Office Worker: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F4BC`, name: `Woman Office Worker`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F4BC`, name: `Woman Office Worker: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F4BC`, name: `Woman Office Worker: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F4BC`, name: `Woman Office Worker: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F4BC`, name: `Woman Office Worker: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F4BC`, name: `Woman Office Worker: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F52C`, name: `Man Scientist`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F52C`, name: `Man Scientist: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F52C`, name: `Man Scientist: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F52C`, name: `Man Scientist: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F52C`, name: `Man Scientist: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F52C`, name: `Man Scientist: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F52C`, name: `Woman Scientist`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F52C`, name: `Woman Scientist: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F52C`, name: `Woman Scientist: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F52C`, name: `Woman Scientist: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F52C`, name: `Woman Scientist: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F52C`, name: `Woman Scientist: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F4BB`, name: `Man Technologist`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F4BB`, name: `Man Technologist: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F4BB`, name: `Man Technologist: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F4BB`, name: `Man Technologist: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F4BB`, name: `Man Technologist: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F4BB`, name: `Man Technologist: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F4BB`, name: `Woman Technologist`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F4BB`, name: `Woman Technologist: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F4BB`, name: `Woman Technologist: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F4BB`, name: `Woman Technologist: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F4BB`, name: `Woman Technologist: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F4BB`, name: `Woman Technologist: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F3A4`, name: `Man Singer`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F3A4`, name: `Man Singer: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F3A4`, name: `Man Singer: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F3A4`, name: `Man Singer: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F3A4`, name: `Man Singer: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F3A4`, name: `Man Singer: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F3A4`, name: `Woman Singer`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F3A4`, name: `Woman Singer: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F3A4`, name: `Woman Singer: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F3A4`, name: `Woman Singer: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F3A4`, name: `Woman Singer: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F3A4`, name: `Woman Singer: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F3A8`, name: `Man Artist`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F3A8`, name: `Man Artist: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F3A8`, name: `Man Artist: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F3A8`, name: `Man Artist: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F3A8`, name: `Man Artist: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F3A8`, name: `Man Artist: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F3A8`, name: `Woman Artist`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F3A8`, name: `Woman Artist: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F3A8`, name: `Woman Artist: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F3A8`, name: `Woman Artist: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F3A8`, name: `Woman Artist: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F3A8`, name: `Woman Artist: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x2708&#xFE0F`, name: `Man Pilot`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x2708&#xFE0F`, name: `Man Pilot: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x2708&#xFE0F`, name: `Man Pilot: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x2708&#xFE0F`, name: `Man Pilot: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x2708&#xFE0F`, name: `Man Pilot: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x2708&#xFE0F`, name: `Man Pilot: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x2708&#xFE0F`, name: `Woman Pilot`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x2708&#xFE0F`, name: `Woman Pilot: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x2708&#xFE0F`, name: `Woman Pilot: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x2708&#xFE0F`, name: `Woman Pilot: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x2708&#xFE0F`, name: `Woman Pilot: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x2708&#xFE0F`, name: `Woman Pilot: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F680`, name: `Man Astronaut`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F680`, name: `Man Astronaut: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F680`, name: `Man Astronaut: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F680`, name: `Man Astronaut: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F680`, name: `Man Astronaut: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F680`, name: `Man Astronaut: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F680`, name: `Woman Astronaut`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F680`, name: `Woman Astronaut: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F680`, name: `Woman Astronaut: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F680`, name: `Woman Astronaut: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F680`, name: `Woman Astronaut: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F680`, name: `Woman Astronaut: Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x200D&#x1F692`, name: `Man Firefighter`},
                                            {emoji: `&#x1F468&#x1F3FB&#x200D&#x1F692`, name: `Man Firefighter: Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FC&#x200D&#x1F692`, name: `Man Firefighter: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FD&#x200D&#x1F692`, name: `Man Firefighter: Medium Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FE&#x200D&#x1F692`, name: `Man Firefighter: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F468&#x1F3FF&#x200D&#x1F692`, name: `Man Firefighter: Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x200D&#x1F692`, name: `Woman Firefighter`},
                                            {emoji: `&#x1F469&#x1F3FB&#x200D&#x1F692`, name: `Woman Firefighter: Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FC&#x200D&#x1F692`, name: `Woman Firefighter: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FD&#x200D&#x1F692`, name: `Woman Firefighter: Medium Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FE&#x200D&#x1F692`, name: `Woman Firefighter: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F469&#x1F3FF&#x200D&#x1F692`, name: `Woman Firefighter: Dark Skin Tone`},
                                            {emoji: `&#x1F46E`, name: `Police Officer`},
                                            {emoji: `&#x1F46E&#x1F3FB`, name: `Police Officer: Light Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FC`, name: `Police Officer: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FD`, name: `Police Officer: Medium Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FE`, name: `Police Officer: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FF`, name: `Police Officer: Dark Skin Tone`},
                                            {emoji: `&#x1F46E&#x200D&#x2642&#xFE0F`, name: `Man Police Officer`},
                                            {emoji: `&#x1F46E&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Police Officer: Light Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Police Officer: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Police Officer: Medium Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Police Officer: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Police Officer: Dark Skin Tone`},
                                            {emoji: `&#x1F46E&#x200D&#x2640&#xFE0F`, name: `Woman Police Officer`},
                                            {emoji: `&#x1F46E&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Police Officer: Light Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Police Officer: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Police Officer: Medium Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Police Officer: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F46E&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Police Officer: Dark Skin Tone`},
                                            {emoji: `&#x1F575`, name: `Detective`},
                                            {emoji: `&#x1F575&#x1F3FB`, name: `Detective: Light Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FC`, name: `Detective: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FD`, name: `Detective: Medium Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FE`, name: `Detective: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FF`, name: `Detective: Dark Skin Tone`},
                                            {emoji: `&#x1F575&#xFE0F&#x200D&#x2642&#xFE0F`, name: `Man Detective`},
                                            {emoji: `&#x1F575&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Detective: Light Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Detective: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Detective: Medium Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Detective: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Detective: Dark Skin Tone`},
                                            {emoji: `&#x1F575&#xFE0F&#x200D&#x2640&#xFE0F`, name: `Woman Detective`},
                                            {emoji: `&#x1F575&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Detective: Light Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Detective: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Detective: Medium Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Detective: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F575&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Detective: Dark Skin Tone`},
                                            {emoji: `&#x1F482`, name: `Guard`},
                                            {emoji: `&#x1F482&#x1F3FB`, name: `Guard: Light Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FC`, name: `Guard: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FD`, name: `Guard: Medium Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FE`, name: `Guard: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FF`, name: `Guard: Dark Skin Tone`},
                                            {emoji: `&#x1F482&#x200D&#x2642&#xFE0F`, name: `Man Guard`},
                                            {emoji: `&#x1F482&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Guard: Light Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Guard: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Guard: Medium Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Guard: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Guard: Dark Skin Tone`},
                                            {emoji: `&#x1F482&#x200D&#x2640&#xFE0F`, name: `Woman Guard`},
                                            {emoji: `&#x1F482&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Guard: Light Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Guard: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Guard: Medium Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Guard: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F482&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Guard: Dark Skin Tone`},
                                            {emoji: `&#x1F477`, name: `Construction Worker`},
                                            {emoji: `&#x1F477&#x1F3FB`, name: `Construction Worker: Light Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FC`, name: `Construction Worker: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FD`, name: `Construction Worker: Medium Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FE`, name: `Construction Worker: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FF`, name: `Construction Worker: Dark Skin Tone`},
                                            {emoji: `&#x1F477&#x200D&#x2642&#xFE0F`, name: `Man Construction Worker`},
                                            {emoji: `&#x1F477&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Construction Worker: Light Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Construction Worker: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Construction Worker: Medium Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Construction Worker: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Construction Worker: Dark Skin Tone`},
                                            {emoji: `&#x1F477&#x200D&#x2640&#xFE0F`, name: `Woman Construction Worker`},
                                            {emoji: `&#x1F477&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Construction Worker: Light Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Construction Worker: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Construction Worker: Medium Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Construction Worker: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F477&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Construction Worker: Dark Skin Tone`},
                                            {emoji: `&#x1F473`, name: `Person Wearing Turban`},
                                            {emoji: `&#x1F473&#x1F3FB`, name: `Person Wearing Turban: Light Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FC`, name: `Person Wearing Turban: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FD`, name: `Person Wearing Turban: Medium Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FE`, name: `Person Wearing Turban: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FF`, name: `Person Wearing Turban: Dark Skin Tone`},
                                            {emoji: `&#x1F473&#x200D&#x2642&#xFE0F`, name: `Man Wearing Turban`},
                                            {emoji: `&#x1F473&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Wearing Turban: Light Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Wearing Turban: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Wearing Turban: Medium Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Wearing Turban: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Wearing Turban: Dark Skin Tone`},
                                            {emoji: `&#x1F473&#x200D&#x2640&#xFE0F`, name: `Woman Wearing Turban`},
                                            {emoji: `&#x1F473&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Wearing Turban: Light Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Wearing Turban: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Wearing Turban: Medium Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Wearing Turban: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F473&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Wearing Turban: Dark Skin Tone`},
                                            {emoji: `&#x1F471`, name: `Blond-Haired Person`},
                                            {emoji: `&#x1F471&#x1F3FB`, name: `Blond-Haired Person: Light Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FC`, name: `Blond-Haired Person: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FD`, name: `Blond-Haired Person: Medium Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FE`, name: `Blond-Haired Person: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FF`, name: `Blond-Haired Person: Dark Skin Tone`},
                                            {emoji: `&#x1F471&#x200D&#x2642&#xFE0F`, name: `Blond-Haired Man`},
                                            {emoji: `&#x1F471&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Blond-Haired Man: Light Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Blond-Haired Man: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Blond-Haired Man: Medium Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Blond-Haired Man: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Blond-Haired Man: Dark Skin Tone`},
                                            {emoji: `&#x1F471&#x200D&#x2640&#xFE0F`, name: `Blond-Haired Woman`},
                                            {emoji: `&#x1F471&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Blond-Haired Woman: Light Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Blond-Haired Woman: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Blond-Haired Woman: Medium Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Blond-Haired Woman: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F471&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Blond-Haired Woman: Dark Skin Tone`},
                                            {emoji: `&#x1F385`, name: `Santa Claus`},
                                            {emoji: `&#x1F385&#x1F3FB`, name: `Santa Claus: Light Skin Tone`},
                                            {emoji: `&#x1F385&#x1F3FC`, name: `Santa Claus: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F385&#x1F3FD`, name: `Santa Claus: Medium Skin Tone`},
                                            {emoji: `&#x1F385&#x1F3FE`, name: `Santa Claus: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F385&#x1F3FF`, name: `Santa Claus: Dark Skin Tone`},
                                            {emoji: `&#x1F936`, name: `Mrs. Claus`},
                                            {emoji: `&#x1F936&#x1F3FB`, name: `Mrs. Claus: Light Skin Tone`},
                                            {emoji: `&#x1F936&#x1F3FC`, name: `Mrs. Claus: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F936&#x1F3FD`, name: `Mrs. Claus: Medium Skin Tone`},
                                            {emoji: `&#x1F936&#x1F3FE`, name: `Mrs. Claus: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F936&#x1F3FF`, name: `Mrs. Claus: Dark Skin Tone`},
                                            {emoji: `&#x1F478`, name: `Princess`},
                                            {emoji: `&#x1F478&#x1F3FB`, name: `Princess: Light Skin Tone`},
                                            {emoji: `&#x1F478&#x1F3FC`, name: `Princess: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F478&#x1F3FD`, name: `Princess: Medium Skin Tone`},
                                            {emoji: `&#x1F478&#x1F3FE`, name: `Princess: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F478&#x1F3FF`, name: `Princess: Dark Skin Tone`},
                                            {emoji: `&#x1F934`, name: `Prince`},
                                            {emoji: `&#x1F934&#x1F3FB`, name: `Prince: Light Skin Tone`},
                                            {emoji: `&#x1F934&#x1F3FC`, name: `Prince: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F934&#x1F3FD`, name: `Prince: Medium Skin Tone`},
                                            {emoji: `&#x1F934&#x1F3FE`, name: `Prince: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F934&#x1F3FF`, name: `Prince: Dark Skin Tone`},
                                            {emoji: `&#x1F470`, name: `Bride With Veil`},
                                            {emoji: `&#x1F470&#x1F3FB`, name: `Bride With Veil: Light Skin Tone`},
                                            {emoji: `&#x1F470&#x1F3FC`, name: `Bride With Veil: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F470&#x1F3FD`, name: `Bride With Veil: Medium Skin Tone`},
                                            {emoji: `&#x1F470&#x1F3FE`, name: `Bride With Veil: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F470&#x1F3FF`, name: `Bride With Veil: Dark Skin Tone`},
                                            {emoji: `&#x1F935`, name: `Man In Tuxedo`},
                                            {emoji: `&#x1F935&#x1F3FB`, name: `Man In Tuxedo: Light Skin Tone`},
                                            {emoji: `&#x1F935&#x1F3FC`, name: `Man In Tuxedo: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F935&#x1F3FD`, name: `Man In Tuxedo: Medium Skin Tone`},
                                            {emoji: `&#x1F935&#x1F3FE`, name: `Man In Tuxedo: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F935&#x1F3FF`, name: `Man In Tuxedo: Dark Skin Tone`},
                                            {emoji: `&#x1F930`, name: `Pregnant Woman`},
                                            {emoji: `&#x1F930&#x1F3FB`, name: `Pregnant Woman: Light Skin Tone`},
                                            {emoji: `&#x1F930&#x1F3FC`, name: `Pregnant Woman: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F930&#x1F3FD`, name: `Pregnant Woman: Medium Skin Tone`},
                                            {emoji: `&#x1F930&#x1F3FE`, name: `Pregnant Woman: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F930&#x1F3FF`, name: `Pregnant Woman: Dark Skin Tone`},
                                            {emoji: `&#x1F472`, name: `Man With Chinese Cap`},
                                            {emoji: `&#x1F472&#x1F3FB`, name: `Man With Chinese Cap: Light Skin Tone`},
                                            {emoji: `&#x1F472&#x1F3FC`, name: `Man With Chinese Cap: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F472&#x1F3FD`, name: `Man With Chinese Cap: Medium Skin Tone`},
                                            {emoji: `&#x1F472&#x1F3FE`, name: `Man With Chinese Cap: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F472&#x1F3FF`, name: `Man With Chinese Cap: Dark Skin Tone`},
                                            {emoji: `&#x1F64D`, name: `Person Frowning`},
                                            {emoji: `&#x1F64D&#x1F3FB`, name: `Person Frowning: Light Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FC`, name: `Person Frowning: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FD`, name: `Person Frowning: Medium Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FE`, name: `Person Frowning: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FF`, name: `Person Frowning: Dark Skin Tone`},
                                            {emoji: `&#x1F64D&#x200D&#x2642&#xFE0F`, name: `Man Frowning`},
                                            {emoji: `&#x1F64D&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Frowning: Light Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Frowning: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Frowning: Medium Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Frowning: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Frowning: Dark Skin Tone`},
                                            {emoji: `&#x1F64D&#x200D&#x2640&#xFE0F`, name: `Woman Frowning`},
                                            {emoji: `&#x1F64D&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Frowning: Light Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Frowning: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Frowning: Medium Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Frowning: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64D&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Frowning: Dark Skin Tone`},
                                            {emoji: `&#x1F64E`, name: `Person Pouting`},
                                            {emoji: `&#x1F64E&#x1F3FB`, name: `Person Pouting: Light Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FC`, name: `Person Pouting: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FD`, name: `Person Pouting: Medium Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FE`, name: `Person Pouting: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FF`, name: `Person Pouting: Dark Skin Tone`},
                                            {emoji: `&#x1F64E&#x200D&#x2642&#xFE0F`, name: `Man Pouting`},
                                            {emoji: `&#x1F64E&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Pouting: Light Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Pouting: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Pouting: Medium Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Pouting: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Pouting: Dark Skin Tone`},
                                            {emoji: `&#x1F64E&#x200D&#x2640&#xFE0F`, name: `Woman Pouting`},
                                            {emoji: `&#x1F64E&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Pouting: Light Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Pouting: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Pouting: Medium Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Pouting: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64E&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Pouting: Dark Skin Tone`},
                                            {emoji: `&#x1F645`, name: `Person Gesturing NO`},
                                            {emoji: `&#x1F645&#x1F3FB`, name: `Person Gesturing NO: Light Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FC`, name: `Person Gesturing NO: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FD`, name: `Person Gesturing NO: Medium Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FE`, name: `Person Gesturing NO: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FF`, name: `Person Gesturing NO: Dark Skin Tone`},
                                            {emoji: `&#x1F645&#x200D&#x2642&#xFE0F`, name: `Man Gesturing NO`},
                                            {emoji: `&#x1F645&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Gesturing NO: Light Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Gesturing NO: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Gesturing NO: Medium Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Gesturing NO: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Gesturing NO: Dark Skin Tone`},
                                            {emoji: `&#x1F645&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing NO`},
                                            {emoji: `&#x1F645&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing NO: Light Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing NO: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing NO: Medium Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing NO: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F645&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing NO: Dark Skin Tone`},
                                            {emoji: `&#x1F646`, name: `Person Gesturing OK`},
                                            {emoji: `&#x1F646&#x1F3FB`, name: `Person Gesturing OK: Light Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FC`, name: `Person Gesturing OK: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FD`, name: `Person Gesturing OK: Medium Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FE`, name: `Person Gesturing OK: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FF`, name: `Person Gesturing OK: Dark Skin Tone`},
                                            {emoji: `&#x1F646&#x200D&#x2642&#xFE0F`, name: `Man Gesturing OK`},
                                            {emoji: `&#x1F646&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Gesturing OK: Light Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Gesturing OK: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Gesturing OK: Medium Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Gesturing OK: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Gesturing OK: Dark Skin Tone`},
                                            {emoji: `&#x1F646&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing OK`},
                                            {emoji: `&#x1F646&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing OK: Light Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing OK: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing OK: Medium Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing OK: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F646&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Gesturing OK: Dark Skin Tone`},
                                            {emoji: `&#x1F481`, name: `Person Tipping Hand`},
                                            {emoji: `&#x1F481&#x1F3FB`, name: `Person Tipping Hand: Light Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FC`, name: `Person Tipping Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FD`, name: `Person Tipping Hand: Medium Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FE`, name: `Person Tipping Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FF`, name: `Person Tipping Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F481&#x200D&#x2642&#xFE0F`, name: `Man Tipping Hand`},
                                            {emoji: `&#x1F481&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Tipping Hand: Light Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Tipping Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Tipping Hand: Medium Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Tipping Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Tipping Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F481&#x200D&#x2640&#xFE0F`, name: `Woman Tipping Hand`},
                                            {emoji: `&#x1F481&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Tipping Hand: Light Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Tipping Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Tipping Hand: Medium Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Tipping Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F481&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Tipping Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F64B`, name: `Person Raising Hand`},
                                            {emoji: `&#x1F64B&#x1F3FB`, name: `Person Raising Hand: Light Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FC`, name: `Person Raising Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FD`, name: `Person Raising Hand: Medium Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FE`, name: `Person Raising Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FF`, name: `Person Raising Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F64B&#x200D&#x2642&#xFE0F`, name: `Man Raising Hand`},
                                            {emoji: `&#x1F64B&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Raising Hand: Light Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Raising Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Raising Hand: Medium Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Raising Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Raising Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F64B&#x200D&#x2640&#xFE0F`, name: `Woman Raising Hand`},
                                            {emoji: `&#x1F64B&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Raising Hand: Light Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Raising Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Raising Hand: Medium Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Raising Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64B&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Raising Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F647`, name: `Person Bowing`},
                                            {emoji: `&#x1F647&#x1F3FB`, name: `Person Bowing: Light Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FC`, name: `Person Bowing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FD`, name: `Person Bowing: Medium Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FE`, name: `Person Bowing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FF`, name: `Person Bowing: Dark Skin Tone`},
                                            {emoji: `&#x1F647&#x200D&#x2642&#xFE0F`, name: `Man Bowing`},
                                            {emoji: `&#x1F647&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Bowing: Light Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Bowing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Bowing: Medium Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Bowing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Bowing: Dark Skin Tone`},
                                            {emoji: `&#x1F647&#x200D&#x2640&#xFE0F`, name: `Woman Bowing`},
                                            {emoji: `&#x1F647&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Bowing: Light Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Bowing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Bowing: Medium Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Bowing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F647&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Bowing: Dark Skin Tone`},
                                            {emoji: `&#x1F926`, name: `Person Facepalming`},
                                            {emoji: `&#x1F926&#x1F3FB`, name: `Person Facepalming: Light Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FC`, name: `Person Facepalming: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FD`, name: `Person Facepalming: Medium Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FE`, name: `Person Facepalming: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FF`, name: `Person Facepalming: Dark Skin Tone`},
                                            {emoji: `&#x1F926&#x200D&#x2642&#xFE0F`, name: `Man Facepalming`},
                                            {emoji: `&#x1F926&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Facepalming: Light Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Facepalming: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Facepalming: Medium Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Facepalming: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Facepalming: Dark Skin Tone`},
                                            {emoji: `&#x1F926&#x200D&#x2640&#xFE0F`, name: `Woman Facepalming`},
                                            {emoji: `&#x1F926&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Facepalming: Light Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Facepalming: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Facepalming: Medium Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Facepalming: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F926&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Facepalming: Dark Skin Tone`},
                                            {emoji: `&#x1F937`, name: `Person Shrugging`},
                                            {emoji: `&#x1F937&#x1F3FB`, name: `Person Shrugging: Light Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FC`, name: `Person Shrugging: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FD`, name: `Person Shrugging: Medium Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FE`, name: `Person Shrugging: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FF`, name: `Person Shrugging: Dark Skin Tone`},
                                            {emoji: `&#x1F937&#x200D&#x2642&#xFE0F`, name: `Man Shrugging`},
                                            {emoji: `&#x1F937&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Shrugging: Light Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Shrugging: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Shrugging: Medium Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Shrugging: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Shrugging: Dark Skin Tone`},
                                            {emoji: `&#x1F937&#x200D&#x2640&#xFE0F`, name: `Woman Shrugging`},
                                            {emoji: `&#x1F937&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Shrugging: Light Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Shrugging: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Shrugging: Medium Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Shrugging: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F937&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Shrugging: Dark Skin Tone`},
                                            {emoji: `&#x1F486`, name: `Person Getting Massage`},
                                            {emoji: `&#x1F486&#x1F3FB`, name: `Person Getting Massage: Light Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FC`, name: `Person Getting Massage: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FD`, name: `Person Getting Massage: Medium Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FE`, name: `Person Getting Massage: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FF`, name: `Person Getting Massage: Dark Skin Tone`},
                                            {emoji: `&#x1F486&#x200D&#x2642&#xFE0F`, name: `Man Getting Massage`},
                                            {emoji: `&#x1F486&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Getting Massage: Light Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Getting Massage: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Getting Massage: Medium Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Getting Massage: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Getting Massage: Dark Skin Tone`},
                                            {emoji: `&#x1F486&#x200D&#x2640&#xFE0F`, name: `Woman Getting Massage`},
                                            {emoji: `&#x1F486&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Getting Massage: Light Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Getting Massage: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Getting Massage: Medium Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Getting Massage: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F486&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Getting Massage: Dark Skin Tone`},
                                            {emoji: `&#x1F487`, name: `Person Getting Haircut`},
                                            {emoji: `&#x1F487&#x1F3FB`, name: `Person Getting Haircut: Light Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FC`, name: `Person Getting Haircut: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FD`, name: `Person Getting Haircut: Medium Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FE`, name: `Person Getting Haircut: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FF`, name: `Person Getting Haircut: Dark Skin Tone`},
                                            {emoji: `&#x1F487&#x200D&#x2642&#xFE0F`, name: `Man Getting Haircut`},
                                            {emoji: `&#x1F487&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Getting Haircut: Light Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Getting Haircut: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Getting Haircut: Medium Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Getting Haircut: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Getting Haircut: Dark Skin Tone`},
                                            {emoji: `&#x1F487&#x200D&#x2640&#xFE0F`, name: `Woman Getting Haircut`},
                                            {emoji: `&#x1F487&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Getting Haircut: Light Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Getting Haircut: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Getting Haircut: Medium Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Getting Haircut: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F487&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Getting Haircut: Dark Skin Tone`},
                                            {emoji: `&#x1F6B6`, name: `Person Walking`},
                                            {emoji: `&#x1F6B6&#x1F3FB`, name: `Person Walking: Light Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FC`, name: `Person Walking: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FD`, name: `Person Walking: Medium Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FE`, name: `Person Walking: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FF`, name: `Person Walking: Dark Skin Tone`},
                                            {emoji: `&#x1F6B6&#x200D&#x2642&#xFE0F`, name: `Man Walking`},
                                            {emoji: `&#x1F6B6&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Walking: Light Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Walking: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Walking: Medium Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Walking: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Walking: Dark Skin Tone`},
                                            {emoji: `&#x1F6B6&#x200D&#x2640&#xFE0F`, name: `Woman Walking`},
                                            {emoji: `&#x1F6B6&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Walking: Light Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Walking: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Walking: Medium Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Walking: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6B6&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Walking: Dark Skin Tone`},
                                            {emoji: `&#x1F3C3`, name: `Person Running`},
                                            {emoji: `&#x1F3C3&#x1F3FB`, name: `Person Running: Light Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FC`, name: `Person Running: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FD`, name: `Person Running: Medium Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FE`, name: `Person Running: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FF`, name: `Person Running: Dark Skin Tone`},
                                            {emoji: `&#x1F3C3&#x200D&#x2642&#xFE0F`, name: `Man Running`},
                                            {emoji: `&#x1F3C3&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Running: Light Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Running: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Running: Medium Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Running: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Running: Dark Skin Tone`},
                                            {emoji: `&#x1F3C3&#x200D&#x2640&#xFE0F`, name: `Woman Running`},
                                            {emoji: `&#x1F3C3&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Running: Light Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Running: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Running: Medium Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Running: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3C3&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Running: Dark Skin Tone`},
                                            {emoji: `&#x1F483`, name: `Woman Dancing`},
                                            {emoji: `&#x1F483&#x1F3FB`, name: `Woman Dancing: Light Skin Tone`},
                                            {emoji: `&#x1F483&#x1F3FC`, name: `Woman Dancing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F483&#x1F3FD`, name: `Woman Dancing: Medium Skin Tone`},
                                            {emoji: `&#x1F483&#x1F3FE`, name: `Woman Dancing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F483&#x1F3FF`, name: `Woman Dancing: Dark Skin Tone`},
                                            {emoji: `&#x1F57A`, name: `Man Dancing`},
                                            {emoji: `&#x1F57A&#x1F3FB`, name: `Man Dancing: Light Skin Tone`},
                                            {emoji: `&#x1F57A&#x1F3FC`, name: `Man Dancing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F57A&#x1F3FD`, name: `Man Dancing: Medium Skin Tone`},
                                            {emoji: `&#x1F57A&#x1F3FE`, name: `Man Dancing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F57A&#x1F3FF`, name: `Man Dancing: Dark Skin Tone`},
                                            {emoji: `&#x1F46F`, name: `People With Bunny Ears Partying`},
                                            {emoji: `&#x1F46F&#x200D&#x2642&#xFE0F`, name: `Men With Bunny Ears Partying`},
                                            {emoji: `&#x1F46F&#x200D&#x2640&#xFE0F`, name: `Women With Bunny Ears Partying`},
                                            {emoji: `&#x1F574`, name: `Man In Business Suit Levitating`},
                                            {emoji: `&#x1F574&#x1F3FB`, name: `Man In Business Suit Levitating: Light Skin Tone`},
                                            {emoji: `&#x1F574&#x1F3FC`, name: `Man In Business Suit Levitating: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F574&#x1F3FD`, name: `Man In Business Suit Levitating: Medium Skin Tone`},
                                            {emoji: `&#x1F574&#x1F3FE`, name: `Man In Business Suit Levitating: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F574&#x1F3FF`, name: `Man In Business Suit Levitating: Dark Skin Tone`},
                                            {emoji: `&#x1F5E3`, name: `Speaking Head`},
                                            {emoji: `&#x1F464`, name: `Bust In Silhouette`},
                                            {emoji: `&#x1F465`, name: `Busts In Silhouette`},
                                            {emoji: `&#x1F93A`, name: `Person Fencing`},
                                            {emoji: `&#x1F3C7`, name: `Horse Racing`},
                                            {emoji: `&#x1F3C7&#x1F3FB`, name: `Horse Racing: Light Skin Tone`},
                                            {emoji: `&#x1F3C7&#x1F3FC`, name: `Horse Racing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3C7&#x1F3FD`, name: `Horse Racing: Medium Skin Tone`},
                                            {emoji: `&#x1F3C7&#x1F3FE`, name: `Horse Racing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3C7&#x1F3FF`, name: `Horse Racing: Dark Skin Tone`},
                                            {emoji: `&#x26F7`, name: `Skier`},
                                            {emoji: `&#x1F3C2`, name: `Snowboarder`},
                                            {emoji: `&#x1F3C2&#x1F3FB`, name: `Snowboarder: Light Skin Tone`},
                                            {emoji: `&#x1F3C2&#x1F3FC`, name: `Snowboarder: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3C2&#x1F3FD`, name: `Snowboarder: Medium Skin Tone`},
                                            {emoji: `&#x1F3C2&#x1F3FE`, name: `Snowboarder: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3C2&#x1F3FF`, name: `Snowboarder: Dark Skin Tone`},
                                            {emoji: `&#x1F3CC`, name: `Person Golfing`},
                                            {emoji: `&#x1F3CC&#x1F3FB`, name: `Person Golfing: Light Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FC`, name: `Person Golfing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FD`, name: `Person Golfing: Medium Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FE`, name: `Person Golfing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FF`, name: `Person Golfing: Dark Skin Tone`},
                                            {emoji: `&#x1F3CC&#xFE0F&#x200D&#x2642&#xFE0F`, name: `Man Golfing`},
                                            {emoji: `&#x1F3CC&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Golfing: Light Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Golfing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Golfing: Medium Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Golfing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Golfing: Dark Skin Tone`},
                                            {emoji: `&#x1F3CC&#xFE0F&#x200D&#x2640&#xFE0F`, name: `Woman Golfing`},
                                            {emoji: `&#x1F3CC&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Golfing: Light Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Golfing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Golfing: Medium Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Golfing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3CC&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Golfing: Dark Skin Tone`},
                                            {emoji: `&#x1F3C4`, name: `Person Surfing`},
                                            {emoji: `&#x1F3C4&#x1F3FB`, name: `Person Surfing: Light Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FC`, name: `Person Surfing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FD`, name: `Person Surfing: Medium Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FE`, name: `Person Surfing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FF`, name: `Person Surfing: Dark Skin Tone`},
                                            {emoji: `&#x1F3C4&#x200D&#x2642&#xFE0F`, name: `Man Surfing`},
                                            {emoji: `&#x1F3C4&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Surfing: Light Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Surfing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Surfing: Medium Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Surfing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Surfing: Dark Skin Tone`},
                                            {emoji: `&#x1F3C4&#x200D&#x2640&#xFE0F`, name: `Woman Surfing`},
                                            {emoji: `&#x1F3C4&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Surfing: Light Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Surfing: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Surfing: Medium Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Surfing: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3C4&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Surfing: Dark Skin Tone`},
                                            {emoji: `&#x1F6A3`, name: `Person Rowing Boat`},
                                            {emoji: `&#x1F6A3&#x1F3FB`, name: `Person Rowing Boat: Light Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FC`, name: `Person Rowing Boat: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FD`, name: `Person Rowing Boat: Medium Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FE`, name: `Person Rowing Boat: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FF`, name: `Person Rowing Boat: Dark Skin Tone`},
                                            {emoji: `&#x1F6A3&#x200D&#x2642&#xFE0F`, name: `Man Rowing Boat`},
                                            {emoji: `&#x1F6A3&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Rowing Boat: Light Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Rowing Boat: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Rowing Boat: Medium Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Rowing Boat: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Rowing Boat: Dark Skin Tone`},
                                            {emoji: `&#x1F6A3&#x200D&#x2640&#xFE0F`, name: `Woman Rowing Boat`},
                                            {emoji: `&#x1F6A3&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Rowing Boat: Light Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Rowing Boat: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Rowing Boat: Medium Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Rowing Boat: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6A3&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Rowing Boat: Dark Skin Tone`},
                                            {emoji: `&#x1F3CA`, name: `Person Swimming`},
                                            {emoji: `&#x1F3CA&#x1F3FB`, name: `Person Swimming: Light Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FC`, name: `Person Swimming: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FD`, name: `Person Swimming: Medium Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FE`, name: `Person Swimming: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FF`, name: `Person Swimming: Dark Skin Tone`},
                                            {emoji: `&#x1F3CA&#x200D&#x2642&#xFE0F`, name: `Man Swimming`},
                                            {emoji: `&#x1F3CA&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Swimming: Light Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Swimming: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Swimming: Medium Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Swimming: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Swimming: Dark Skin Tone`},
                                            {emoji: `&#x1F3CA&#x200D&#x2640&#xFE0F`, name: `Woman Swimming`},
                                            {emoji: `&#x1F3CA&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Swimming: Light Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Swimming: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Swimming: Medium Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Swimming: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3CA&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Swimming: Dark Skin Tone`},
                                            {emoji: `&#x26F9`, name: `Person Bouncing Ball`},
                                            {emoji: `&#x26F9&#x1F3FB`, name: `Person Bouncing Ball: Light Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FC`, name: `Person Bouncing Ball: Medium-Light Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FD`, name: `Person Bouncing Ball: Medium Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FE`, name: `Person Bouncing Ball: Medium-Dark Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FF`, name: `Person Bouncing Ball: Dark Skin Tone`},
                                            {emoji: `&#x26F9&#xFE0F&#x200D&#x2642&#xFE0F`, name: `Man Bouncing Ball`},
                                            {emoji: `&#x26F9&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Bouncing Ball: Light Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Bouncing Ball: Medium-Light Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Bouncing Ball: Medium Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Bouncing Ball: Medium-Dark Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Bouncing Ball: Dark Skin Tone`},
                                            {emoji: `&#x26F9&#xFE0F&#x200D&#x2640&#xFE0F`, name: `Woman Bouncing Ball`},
                                            {emoji: `&#x26F9&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Bouncing Ball: Light Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Bouncing Ball: Medium-Light Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Bouncing Ball: Medium Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Bouncing Ball: Medium-Dark Skin Tone`},
                                            {emoji: `&#x26F9&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Bouncing Ball: Dark Skin Tone`},
                                            {emoji: `&#x1F3CB`, name: `Person Lifting Weights`},
                                            {emoji: `&#x1F3CB&#x1F3FB`, name: `Person Lifting Weights: Light Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FC`, name: `Person Lifting Weights: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FD`, name: `Person Lifting Weights: Medium Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FE`, name: `Person Lifting Weights: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FF`, name: `Person Lifting Weights: Dark Skin Tone`},
                                            {emoji: `&#x1F3CB&#xFE0F&#x200D&#x2642&#xFE0F`, name: `Man Lifting Weights`},
                                            {emoji: `&#x1F3CB&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Lifting Weights: Light Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Lifting Weights: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Lifting Weights: Medium Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Lifting Weights: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Lifting Weights: Dark Skin Tone`},
                                            {emoji: `&#x1F3CB&#xFE0F&#x200D&#x2640&#xFE0F`, name: `Woman Lifting Weights`},
                                            {emoji: `&#x1F3CB&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Lifting Weights: Light Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Lifting Weights: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Lifting Weights: Medium Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Lifting Weights: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3CB&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Lifting Weights: Dark Skin Tone`},
                                            {emoji: `&#x1F6B4`, name: `Person Biking`},
                                            {emoji: `&#x1F6B4&#x1F3FB`, name: `Person Biking: Light Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FC`, name: `Person Biking: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FD`, name: `Person Biking: Medium Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FE`, name: `Person Biking: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FF`, name: `Person Biking: Dark Skin Tone`},
                                            {emoji: `&#x1F6B4&#x200D&#x2642&#xFE0F`, name: `Man Biking`},
                                            {emoji: `&#x1F6B4&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Biking: Light Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Biking: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Biking: Medium Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Biking: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Biking: Dark Skin Tone`},
                                            {emoji: `&#x1F6B4&#x200D&#x2640&#xFE0F`, name: `Woman Biking`},
                                            {emoji: `&#x1F6B4&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Biking: Light Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Biking: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Biking: Medium Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Biking: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6B4&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Biking: Dark Skin Tone`},
                                            {emoji: `&#x1F6B5`, name: `Person Mountain Biking`},
                                            {emoji: `&#x1F6B5&#x1F3FB`, name: `Person Mountain Biking: Light Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FC`, name: `Person Mountain Biking: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FD`, name: `Person Mountain Biking: Medium Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FE`, name: `Person Mountain Biking: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FF`, name: `Person Mountain Biking: Dark Skin Tone`},
                                            {emoji: `&#x1F6B5&#x200D&#x2642&#xFE0F`, name: `Man Mountain Biking`},
                                            {emoji: `&#x1F6B5&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Mountain Biking: Light Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Mountain Biking: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Mountain Biking: Medium Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Mountain Biking: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Mountain Biking: Dark Skin Tone`},
                                            {emoji: `&#x1F6B5&#x200D&#x2640&#xFE0F`, name: `Woman Mountain Biking`},
                                            {emoji: `&#x1F6B5&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Mountain Biking: Light Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Mountain Biking: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Mountain Biking: Medium Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Mountain Biking: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6B5&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Mountain Biking: Dark Skin Tone`},
                                            {emoji: `&#x1F3CE`, name: `Racing Car`},
                                            {emoji: `&#x1F3CD`, name: `Motorcycle`},
                                            {emoji: `&#x1F938`, name: `Person Cartwheeling`},
                                            {emoji: `&#x1F938&#x1F3FB`, name: `Person Cartwheeling: Light Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FC`, name: `Person Cartwheeling: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FD`, name: `Person Cartwheeling: Medium Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FE`, name: `Person Cartwheeling: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FF`, name: `Person Cartwheeling: Dark Skin Tone`},
                                            {emoji: `&#x1F938&#x200D&#x2642&#xFE0F`, name: `Man Cartwheeling`},
                                            {emoji: `&#x1F938&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Cartwheeling: Light Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Cartwheeling: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Cartwheeling: Medium Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Cartwheeling: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Cartwheeling: Dark Skin Tone`},
                                            {emoji: `&#x1F938&#x200D&#x2640&#xFE0F`, name: `Woman Cartwheeling`},
                                            {emoji: `&#x1F938&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Cartwheeling: Light Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Cartwheeling: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Cartwheeling: Medium Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Cartwheeling: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F938&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Cartwheeling: Dark Skin Tone`},
                                            {emoji: `&#x1F93C`, name: `People Wrestling`},
                                            {emoji: `&#x1F93C&#x200D&#x2642&#xFE0F`, name: `Men Wrestling`},
                                            {emoji: `&#x1F93C&#x200D&#x2640&#xFE0F`, name: `Women Wrestling`},
                                            {emoji: `&#x1F93D`, name: `Person Playing Water Polo`},
                                            {emoji: `&#x1F93D&#x1F3FB`, name: `Person Playing Water Polo: Light Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FC`, name: `Person Playing Water Polo: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FD`, name: `Person Playing Water Polo: Medium Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FE`, name: `Person Playing Water Polo: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FF`, name: `Person Playing Water Polo: Dark Skin Tone`},
                                            {emoji: `&#x1F93D&#x200D&#x2642&#xFE0F`, name: `Man Playing Water Polo`},
                                            {emoji: `&#x1F93D&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Playing Water Polo: Light Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Playing Water Polo: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Playing Water Polo: Medium Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Playing Water Polo: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Playing Water Polo: Dark Skin Tone`},
                                            {emoji: `&#x1F93D&#x200D&#x2640&#xFE0F`, name: `Woman Playing Water Polo`},
                                            {emoji: `&#x1F93D&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Playing Water Polo: Light Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Playing Water Polo: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Playing Water Polo: Medium Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Playing Water Polo: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F93D&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Playing Water Polo: Dark Skin Tone`},
                                            {emoji: `&#x1F93E`, name: `Person Playing Handball`},
                                            {emoji: `&#x1F93E&#x1F3FB`, name: `Person Playing Handball: Light Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FC`, name: `Person Playing Handball: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FD`, name: `Person Playing Handball: Medium Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FE`, name: `Person Playing Handball: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FF`, name: `Person Playing Handball: Dark Skin Tone`},
                                            {emoji: `&#x1F93E&#x200D&#x2642&#xFE0F`, name: `Man Playing Handball`},
                                            {emoji: `&#x1F93E&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Playing Handball: Light Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Playing Handball: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Playing Handball: Medium Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Playing Handball: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Playing Handball: Dark Skin Tone`},
                                            {emoji: `&#x1F93E&#x200D&#x2640&#xFE0F`, name: `Woman Playing Handball`},
                                            {emoji: `&#x1F93E&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Playing Handball: Light Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Playing Handball: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Playing Handball: Medium Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Playing Handball: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F93E&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Playing Handball: Dark Skin Tone`},
                                            {emoji: `&#x1F939`, name: `Person Juggling`},
                                            {emoji: `&#x1F939&#x1F3FB`, name: `Person Juggling: Light Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FC`, name: `Person Juggling: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FD`, name: `Person Juggling: Medium Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FE`, name: `Person Juggling: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FF`, name: `Person Juggling: Dark Skin Tone`},
                                            {emoji: `&#x1F939&#x200D&#x2642&#xFE0F`, name: `Man Juggling`},
                                            {emoji: `&#x1F939&#x1F3FB&#x200D&#x2642&#xFE0F`, name: `Man Juggling: Light Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FC&#x200D&#x2642&#xFE0F`, name: `Man Juggling: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FD&#x200D&#x2642&#xFE0F`, name: `Man Juggling: Medium Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FE&#x200D&#x2642&#xFE0F`, name: `Man Juggling: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FF&#x200D&#x2642&#xFE0F`, name: `Man Juggling: Dark Skin Tone`},
                                            {emoji: `&#x1F939&#x200D&#x2640&#xFE0F`, name: `Woman Juggling`},
                                            {emoji: `&#x1F939&#x1F3FB&#x200D&#x2640&#xFE0F`, name: `Woman Juggling: Light Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FC&#x200D&#x2640&#xFE0F`, name: `Woman Juggling: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FD&#x200D&#x2640&#xFE0F`, name: `Woman Juggling: Medium Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FE&#x200D&#x2640&#xFE0F`, name: `Woman Juggling: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F939&#x1F3FF&#x200D&#x2640&#xFE0F`, name: `Woman Juggling: Dark Skin Tone`},
                                            {emoji: `&#x1F46B`, name: `Man And Woman Holding Hands`},
                                            {emoji: `&#x1F46C`, name: `Two Men Holding Hands`},
                                            {emoji: `&#x1F46D`, name: `Two Women Holding Hands`},
                                            {emoji: `&#x1F48F`, name: `Kiss`},
                                            {emoji: `&#x1F469&#x200D&#x2764&#xFE0F&#x200D&#x1F48B&#x200D&#x1F468`, name: `Kiss: Woman, Man`},
                                            {emoji: `&#x1F468&#x200D&#x2764&#xFE0F&#x200D&#x1F48B&#x200D&#x1F468`, name: `Kiss: Man, Man`},
                                            {emoji: `&#x1F469&#x200D&#x2764&#xFE0F&#x200D&#x1F48B&#x200D&#x1F469`, name: `Kiss: Woman, Woman`},
                                            {emoji: `&#x1F491`, name: `Couple With Heart`},
                                            {emoji: `&#x1F469&#x200D&#x2764&#xFE0F&#x200D&#x1F468`, name: `Couple With Heart: Woman, Man`},
                                            {emoji: `&#x1F468&#x200D&#x2764&#xFE0F&#x200D&#x1F468`, name: `Couple With Heart: Man, Man`},
                                            {emoji: `&#x1F469&#x200D&#x2764&#xFE0F&#x200D&#x1F469`, name: `Couple With Heart: Woman, Woman`},
                                            {emoji: `&#x1F46A`, name: `Family`},
                                            {emoji: `&#x1F468&#x200D&#x1F469&#x200D&#x1F466`, name: `Family: Man, Woman, Boy`},
                                            {emoji: `&#x1F468&#x200D&#x1F469&#x200D&#x1F467`, name: `Family: Man, Woman, Girl`},
                                            {emoji: `&#x1F468&#x200D&#x1F469&#x200D&#x1F467&#x200D&#x1F466`, name: `Family: Man, Woman, Girl, Boy`},
                                            {emoji: `&#x1F468&#x200D&#x1F469&#x200D&#x1F466&#x200D&#x1F466`, name: `Family: Man, Woman, Boy, Boy`},
                                            {emoji: `&#x1F468&#x200D&#x1F469&#x200D&#x1F467&#x200D&#x1F467`, name: `Family: Man, Woman, Girl, Girl`},
                                            {emoji: `&#x1F468&#x200D&#x1F468&#x200D&#x1F466`, name: `Family: Man, Man, Boy`},
                                            {emoji: `&#x1F468&#x200D&#x1F468&#x200D&#x1F467`, name: `Family: Man, Man, Girl`},
                                            {emoji: `&#x1F468&#x200D&#x1F468&#x200D&#x1F467&#x200D&#x1F466`, name: `Family: Man, Man, Girl, Boy`},
                                            {emoji: `&#x1F468&#x200D&#x1F468&#x200D&#x1F466&#x200D&#x1F466`, name: `Family: Man, Man, Boy, Boy`},
                                            {emoji: `&#x1F468&#x200D&#x1F468&#x200D&#x1F467&#x200D&#x1F467`, name: `Family: Man, Man, Girl, Girl`},
                                            {emoji: `&#x1F469&#x200D&#x1F469&#x200D&#x1F466`, name: `Family: Woman, Woman, Boy`},
                                            {emoji: `&#x1F469&#x200D&#x1F469&#x200D&#x1F467`, name: `Family: Woman, Woman, Girl`},
                                            {emoji: `&#x1F469&#x200D&#x1F469&#x200D&#x1F467&#x200D&#x1F466`, name: `Family: Woman, Woman, Girl, Boy`},
                                            {emoji: `&#x1F469&#x200D&#x1F469&#x200D&#x1F466&#x200D&#x1F466`, name: `Family: Woman, Woman, Boy, Boy`},
                                            {emoji: `&#x1F469&#x200D&#x1F469&#x200D&#x1F467&#x200D&#x1F467`, name: `Family: Woman, Woman, Girl, Girl`},
                                            {emoji: `&#x1F468&#x200D&#x1F466`, name: `Family: Man, Boy`},
                                            {emoji: `&#x1F468&#x200D&#x1F466&#x200D&#x1F466`, name: `Family: Man, Boy, Boy`},
                                            {emoji: `&#x1F468&#x200D&#x1F467`, name: `Family: Man, Girl`},
                                            {emoji: `&#x1F468&#x200D&#x1F467&#x200D&#x1F466`, name: `Family: Man, Girl, Boy`},
                                            {emoji: `&#x1F468&#x200D&#x1F467&#x200D&#x1F467`, name: `Family: Man, Girl, Girl`},
                                            {emoji: `&#x1F469&#x200D&#x1F466`, name: `Family: Woman, Boy`},
                                            {emoji: `&#x1F469&#x200D&#x1F466&#x200D&#x1F466`, name: `Family: Woman, Boy, Boy`},
                                            {emoji: `&#x1F469&#x200D&#x1F467`, name: `Family: Woman, Girl`},
                                            {emoji: `&#x1F469&#x200D&#x1F467&#x200D&#x1F466`, name: `Family: Woman, Girl, Boy`},
                                            {emoji: `&#x1F469&#x200D&#x1F467&#x200D&#x1F467`, name: `Family: Woman, Girl, Girl`},
                                            {emoji: `&#x1F3FB`, name: `Light Skin Tone`},
                                            {emoji: `&#x1F3FC`, name: `Medium-Light Skin Tone`},
                                            {emoji: `&#x1F3FD`, name: `Medium Skin Tone`},
                                            {emoji: `&#x1F3FE`, name: `Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F3FF`, name: `Dark Skin Tone`},
                                            {emoji: `&#x1F4AA`, name: `Flexed Biceps`},
                                            {emoji: `&#x1F4AA&#x1F3FB`, name: `Flexed Biceps: Light Skin Tone`},
                                            {emoji: `&#x1F4AA&#x1F3FC`, name: `Flexed Biceps: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F4AA&#x1F3FD`, name: `Flexed Biceps: Medium Skin Tone`},
                                            {emoji: `&#x1F4AA&#x1F3FE`, name: `Flexed Biceps: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F4AA&#x1F3FF`, name: `Flexed Biceps: Dark Skin Tone`},
                                            {emoji: `&#x1F933`, name: `Selfie`},
                                            {emoji: `&#x1F933&#x1F3FB`, name: `Selfie: Light Skin Tone`},
                                            {emoji: `&#x1F933&#x1F3FC`, name: `Selfie: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F933&#x1F3FD`, name: `Selfie: Medium Skin Tone`},
                                            {emoji: `&#x1F933&#x1F3FE`, name: `Selfie: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F933&#x1F3FF`, name: `Selfie: Dark Skin Tone`},
                                            {emoji: `&#x1F448`, name: `Backhand Index Pointing Left`},
                                            {emoji: `&#x1F448&#x1F3FB`, name: `Backhand Index Pointing Left: Light Skin Tone`},
                                            {emoji: `&#x1F448&#x1F3FC`, name: `Backhand Index Pointing Left: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F448&#x1F3FD`, name: `Backhand Index Pointing Left: Medium Skin Tone`},
                                            {emoji: `&#x1F448&#x1F3FE`, name: `Backhand Index Pointing Left: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F448&#x1F3FF`, name: `Backhand Index Pointing Left: Dark Skin Tone`},
                                            {emoji: `&#x1F449`, name: `Backhand Index Pointing Right`},
                                            {emoji: `&#x1F449&#x1F3FB`, name: `Backhand Index Pointing Right: Light Skin Tone`},
                                            {emoji: `&#x1F449&#x1F3FC`, name: `Backhand Index Pointing Right: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F449&#x1F3FD`, name: `Backhand Index Pointing Right: Medium Skin Tone`},
                                            {emoji: `&#x1F449&#x1F3FE`, name: `Backhand Index Pointing Right: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F449&#x1F3FF`, name: `Backhand Index Pointing Right: Dark Skin Tone`},
                                            {emoji: `&#x261D`, name: `Index Pointing Up`},
                                            {emoji: `&#x261D&#x1F3FB`, name: `Index Pointing Up: Light Skin Tone`},
                                            {emoji: `&#x261D&#x1F3FC`, name: `Index Pointing Up: Medium-Light Skin Tone`},
                                            {emoji: `&#x261D&#x1F3FD`, name: `Index Pointing Up: Medium Skin Tone`},
                                            {emoji: `&#x261D&#x1F3FE`, name: `Index Pointing Up: Medium-Dark Skin Tone`},
                                            {emoji: `&#x261D&#x1F3FF`, name: `Index Pointing Up: Dark Skin Tone`},
                                            {emoji: `&#x1F446`, name: `Backhand Index Pointing Up`},
                                            {emoji: `&#x1F446&#x1F3FB`, name: `Backhand Index Pointing Up: Light Skin Tone`},
                                            {emoji: `&#x1F446&#x1F3FC`, name: `Backhand Index Pointing Up: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F446&#x1F3FD`, name: `Backhand Index Pointing Up: Medium Skin Tone`},
                                            {emoji: `&#x1F446&#x1F3FE`, name: `Backhand Index Pointing Up: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F446&#x1F3FF`, name: `Backhand Index Pointing Up: Dark Skin Tone`},
                                            {emoji: `&#x1F595`, name: `Middle Finger`},
                                            {emoji: `&#x1F595&#x1F3FB`, name: `Middle Finger: Light Skin Tone`},
                                            {emoji: `&#x1F595&#x1F3FC`, name: `Middle Finger: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F595&#x1F3FD`, name: `Middle Finger: Medium Skin Tone`},
                                            {emoji: `&#x1F595&#x1F3FE`, name: `Middle Finger: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F595&#x1F3FF`, name: `Middle Finger: Dark Skin Tone`},
                                            {emoji: `&#x1F447`, name: `Backhand Index Pointing Down`},
                                            {emoji: `&#x1F447&#x1F3FB`, name: `Backhand Index Pointing Down: Light Skin Tone`},
                                            {emoji: `&#x1F447&#x1F3FC`, name: `Backhand Index Pointing Down: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F447&#x1F3FD`, name: `Backhand Index Pointing Down: Medium Skin Tone`},
                                            {emoji: `&#x1F447&#x1F3FE`, name: `Backhand Index Pointing Down: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F447&#x1F3FF`, name: `Backhand Index Pointing Down: Dark Skin Tone`},
                                            {emoji: `&#x270C`, name: `Victory Hand`},
                                            {emoji: `&#x270C&#x1F3FB`, name: `Victory Hand: Light Skin Tone`},
                                            {emoji: `&#x270C&#x1F3FC`, name: `Victory Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x270C&#x1F3FD`, name: `Victory Hand: Medium Skin Tone`},
                                            {emoji: `&#x270C&#x1F3FE`, name: `Victory Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x270C&#x1F3FF`, name: `Victory Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F91E`, name: `Crossed Fingers`},
                                            {emoji: `&#x1F91E&#x1F3FB`, name: `Crossed Fingers: Light Skin Tone`},
                                            {emoji: `&#x1F91E&#x1F3FC`, name: `Crossed Fingers: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F91E&#x1F3FD`, name: `Crossed Fingers: Medium Skin Tone`},
                                            {emoji: `&#x1F91E&#x1F3FE`, name: `Crossed Fingers: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F91E&#x1F3FF`, name: `Crossed Fingers: Dark Skin Tone`},
                                            {emoji: `&#x1F596`, name: `Vulcan Salute`},
                                            {emoji: `&#x1F596&#x1F3FB`, name: `Vulcan Salute: Light Skin Tone`},
                                            {emoji: `&#x1F596&#x1F3FC`, name: `Vulcan Salute: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F596&#x1F3FD`, name: `Vulcan Salute: Medium Skin Tone`},
                                            {emoji: `&#x1F596&#x1F3FE`, name: `Vulcan Salute: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F596&#x1F3FF`, name: `Vulcan Salute: Dark Skin Tone`},
                                            {emoji: `&#x1F918`, name: `Sign Of The Horns`},
                                            {emoji: `&#x1F918&#x1F3FB`, name: `Sign Of The Horns: Light Skin Tone`},
                                            {emoji: `&#x1F918&#x1F3FC`, name: `Sign Of The Horns: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F918&#x1F3FD`, name: `Sign Of The Horns: Medium Skin Tone`},
                                            {emoji: `&#x1F918&#x1F3FE`, name: `Sign Of The Horns: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F918&#x1F3FF`, name: `Sign Of The Horns: Dark Skin Tone`},
                                            {emoji: `&#x1F919`, name: `Call Me Hand`},
                                            {emoji: `&#x1F919&#x1F3FB`, name: `Call Me Hand: Light Skin Tone`},
                                            {emoji: `&#x1F919&#x1F3FC`, name: `Call Me Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F919&#x1F3FD`, name: `Call Me Hand: Medium Skin Tone`},
                                            {emoji: `&#x1F919&#x1F3FE`, name: `Call Me Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F919&#x1F3FF`, name: `Call Me Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F590`, name: `Raised Hand With Fingers Splayed`},
                                            {emoji: `&#x1F590&#x1F3FB`, name: `Raised Hand With Fingers Splayed: Light Skin Tone`},
                                            {emoji: `&#x1F590&#x1F3FC`, name: `Raised Hand With Fingers Splayed: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F590&#x1F3FD`, name: `Raised Hand With Fingers Splayed: Medium Skin Tone`},
                                            {emoji: `&#x1F590&#x1F3FE`, name: `Raised Hand With Fingers Splayed: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F590&#x1F3FF`, name: `Raised Hand With Fingers Splayed: Dark Skin Tone`},
                                            {emoji: `&#x270B`, name: `Raised Hand`},
                                            {emoji: `&#x270B&#x1F3FB`, name: `Raised Hand: Light Skin Tone`},
                                            {emoji: `&#x270B&#x1F3FC`, name: `Raised Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x270B&#x1F3FD`, name: `Raised Hand: Medium Skin Tone`},
                                            {emoji: `&#x270B&#x1F3FE`, name: `Raised Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x270B&#x1F3FF`, name: `Raised Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F44C`, name: `OK Hand`},
                                            {emoji: `&#x1F44C&#x1F3FB`, name: `OK Hand: Light Skin Tone`},
                                            {emoji: `&#x1F44C&#x1F3FC`, name: `OK Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F44C&#x1F3FD`, name: `OK Hand: Medium Skin Tone`},
                                            {emoji: `&#x1F44C&#x1F3FE`, name: `OK Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F44C&#x1F3FF`, name: `OK Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F44D`, name: `Thumbs Up`},
                                            {emoji: `&#x1F44D&#x1F3FB`, name: `Thumbs Up: Light Skin Tone`},
                                            {emoji: `&#x1F44D&#x1F3FC`, name: `Thumbs Up: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F44D&#x1F3FD`, name: `Thumbs Up: Medium Skin Tone`},
                                            {emoji: `&#x1F44D&#x1F3FE`, name: `Thumbs Up: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F44D&#x1F3FF`, name: `Thumbs Up: Dark Skin Tone`},
                                            {emoji: `&#x1F44E`, name: `Thumbs Down`},
                                            {emoji: `&#x1F44E&#x1F3FB`, name: `Thumbs Down: Light Skin Tone`},
                                            {emoji: `&#x1F44E&#x1F3FC`, name: `Thumbs Down: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F44E&#x1F3FD`, name: `Thumbs Down: Medium Skin Tone`},
                                            {emoji: `&#x1F44E&#x1F3FE`, name: `Thumbs Down: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F44E&#x1F3FF`, name: `Thumbs Down: Dark Skin Tone`},
                                            {emoji: `&#x270A`, name: `Raised Fist`},
                                            {emoji: `&#x270A&#x1F3FB`, name: `Raised Fist: Light Skin Tone`},
                                            {emoji: `&#x270A&#x1F3FC`, name: `Raised Fist: Medium-Light Skin Tone`},
                                            {emoji: `&#x270A&#x1F3FD`, name: `Raised Fist: Medium Skin Tone`},
                                            {emoji: `&#x270A&#x1F3FE`, name: `Raised Fist: Medium-Dark Skin Tone`},
                                            {emoji: `&#x270A&#x1F3FF`, name: `Raised Fist: Dark Skin Tone`},
                                            {emoji: `&#x1F44A`, name: `Oncoming Fist`},
                                            {emoji: `&#x1F44A&#x1F3FB`, name: `Oncoming Fist: Light Skin Tone`},
                                            {emoji: `&#x1F44A&#x1F3FC`, name: `Oncoming Fist: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F44A&#x1F3FD`, name: `Oncoming Fist: Medium Skin Tone`},
                                            {emoji: `&#x1F44A&#x1F3FE`, name: `Oncoming Fist: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F44A&#x1F3FF`, name: `Oncoming Fist: Dark Skin Tone`},
                                            {emoji: `&#x1F91B`, name: `Left-Facing Fist`},
                                            {emoji: `&#x1F91B&#x1F3FB`, name: `Left-Facing Fist: Light Skin Tone`},
                                            {emoji: `&#x1F91B&#x1F3FC`, name: `Left-Facing Fist: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F91B&#x1F3FD`, name: `Left-Facing Fist: Medium Skin Tone`},
                                            {emoji: `&#x1F91B&#x1F3FE`, name: `Left-Facing Fist: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F91B&#x1F3FF`, name: `Left-Facing Fist: Dark Skin Tone`},
                                            {emoji: `&#x1F91C`, name: `Right-Facing Fist`},
                                            {emoji: `&#x1F91C&#x1F3FB`, name: `Right-Facing Fist: Light Skin Tone`},
                                            {emoji: `&#x1F91C&#x1F3FC`, name: `Right-Facing Fist: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F91C&#x1F3FD`, name: `Right-Facing Fist: Medium Skin Tone`},
                                            {emoji: `&#x1F91C&#x1F3FE`, name: `Right-Facing Fist: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F91C&#x1F3FF`, name: `Right-Facing Fist: Dark Skin Tone`},
                                            {emoji: `&#x1F91A`, name: `Raised Back Of Hand`},
                                            {emoji: `&#x1F91A&#x1F3FB`, name: `Raised Back Of Hand: Light Skin Tone`},
                                            {emoji: `&#x1F91A&#x1F3FC`, name: `Raised Back Of Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F91A&#x1F3FD`, name: `Raised Back Of Hand: Medium Skin Tone`},
                                            {emoji: `&#x1F91A&#x1F3FE`, name: `Raised Back Of Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F91A&#x1F3FF`, name: `Raised Back Of Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F44B`, name: `Waving Hand`},
                                            {emoji: `&#x1F44B&#x1F3FB`, name: `Waving Hand: Light Skin Tone`},
                                            {emoji: `&#x1F44B&#x1F3FC`, name: `Waving Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F44B&#x1F3FD`, name: `Waving Hand: Medium Skin Tone`},
                                            {emoji: `&#x1F44B&#x1F3FE`, name: `Waving Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F44B&#x1F3FF`, name: `Waving Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F44F`, name: `Clapping Hands`},
                                            {emoji: `&#x1F44F&#x1F3FB`, name: `Clapping Hands: Light Skin Tone`},
                                            {emoji: `&#x1F44F&#x1F3FC`, name: `Clapping Hands: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F44F&#x1F3FD`, name: `Clapping Hands: Medium Skin Tone`},
                                            {emoji: `&#x1F44F&#x1F3FE`, name: `Clapping Hands: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F44F&#x1F3FF`, name: `Clapping Hands: Dark Skin Tone`},
                                            {emoji: `&#x270D`, name: `Writing Hand`},
                                            {emoji: `&#x270D&#x1F3FB`, name: `Writing Hand: Light Skin Tone`},
                                            {emoji: `&#x270D&#x1F3FC`, name: `Writing Hand: Medium-Light Skin Tone`},
                                            {emoji: `&#x270D&#x1F3FD`, name: `Writing Hand: Medium Skin Tone`},
                                            {emoji: `&#x270D&#x1F3FE`, name: `Writing Hand: Medium-Dark Skin Tone`},
                                            {emoji: `&#x270D&#x1F3FF`, name: `Writing Hand: Dark Skin Tone`},
                                            {emoji: `&#x1F450`, name: `Open Hands`},
                                            {emoji: `&#x1F450&#x1F3FB`, name: `Open Hands: Light Skin Tone`},
                                            {emoji: `&#x1F450&#x1F3FC`, name: `Open Hands: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F450&#x1F3FD`, name: `Open Hands: Medium Skin Tone`},
                                            {emoji: `&#x1F450&#x1F3FE`, name: `Open Hands: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F450&#x1F3FF`, name: `Open Hands: Dark Skin Tone`},
                                            {emoji: `&#x1F64C`, name: `Raising Hands`},
                                            {emoji: `&#x1F64C&#x1F3FB`, name: `Raising Hands: Light Skin Tone`},
                                            {emoji: `&#x1F64C&#x1F3FC`, name: `Raising Hands: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64C&#x1F3FD`, name: `Raising Hands: Medium Skin Tone`},
                                            {emoji: `&#x1F64C&#x1F3FE`, name: `Raising Hands: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64C&#x1F3FF`, name: `Raising Hands: Dark Skin Tone`},
                                            {emoji: `&#x1F64F`, name: `Folded Hands`},
                                            {emoji: `&#x1F64F&#x1F3FB`, name: `Folded Hands: Light Skin Tone`},
                                            {emoji: `&#x1F64F&#x1F3FC`, name: `Folded Hands: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F64F&#x1F3FD`, name: `Folded Hands: Medium Skin Tone`},
                                            {emoji: `&#x1F64F&#x1F3FE`, name: `Folded Hands: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F64F&#x1F3FF`, name: `Folded Hands: Dark Skin Tone`},
                                            {emoji: `&#x1F91D`, name: `Handshake`},
                                            {emoji: `&#x1F485`, name: `Nail Polish`},
                                            {emoji: `&#x1F485&#x1F3FB`, name: `Nail Polish: Light Skin Tone`},
                                            {emoji: `&#x1F485&#x1F3FC`, name: `Nail Polish: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F485&#x1F3FD`, name: `Nail Polish: Medium Skin Tone`},
                                            {emoji: `&#x1F485&#x1F3FE`, name: `Nail Polish: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F485&#x1F3FF`, name: `Nail Polish: Dark Skin Tone`},
                                            {emoji: `&#x1F442`, name: `Ear`},
                                            {emoji: `&#x1F442&#x1F3FB`, name: `Ear: Light Skin Tone`},
                                            {emoji: `&#x1F442&#x1F3FC`, name: `Ear: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F442&#x1F3FD`, name: `Ear: Medium Skin Tone`},
                                            {emoji: `&#x1F442&#x1F3FE`, name: `Ear: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F442&#x1F3FF`, name: `Ear: Dark Skin Tone`},
                                            {emoji: `&#x1F443`, name: `Nose`},
                                            {emoji: `&#x1F443&#x1F3FB`, name: `Nose: Light Skin Tone`},
                                            {emoji: `&#x1F443&#x1F3FC`, name: `Nose: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F443&#x1F3FD`, name: `Nose: Medium Skin Tone`},
                                            {emoji: `&#x1F443&#x1F3FE`, name: `Nose: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F443&#x1F3FF`, name: `Nose: Dark Skin Tone`},
                                            {emoji: `&#x1F463`, name: `Footprints`},
                                            {emoji: `&#x1F440`, name: `Eyes`},
                                            {emoji: `&#x1F441`, name: `Eye`},
                                            {emoji: `&#x1F441&#xFE0F&#x200D&#x1F5E8&#xFE0F`, name: `Eye In Speech Bubble`},
                                            {emoji: `&#x1F445`, name: `Tongue`},
                                            {emoji: `&#x1F444`, name: `Mouth`},
                                            {emoji: `&#x1F48B`, name: `Kiss Mark`},
                                            {emoji: `&#x1F498`, name: `Heart With Arrow`},
                                            {emoji: `&#x2764`, name: `Red Heart`},
                                            {emoji: `&#x1F493`, name: `Beating Heart`},
                                            {emoji: `&#x1F494`, name: `Broken Heart`},
                                            {emoji: `&#x1F495`, name: `Two Hearts`},
                                            {emoji: `&#x1F496`, name: `Sparkling Heart`},
                                            {emoji: `&#x1F497`, name: `Growing Heart`},
                                            {emoji: `&#x1F499`, name: `Blue Heart`},
                                            {emoji: `&#x1F49A`, name: `Green Heart`},
                                            {emoji: `&#x1F49B`, name: `Yellow Heart`},
                                            {emoji: `&#x1F49C`, name: `Purple Heart`},
                                            {emoji: `&#x1F5A4`, name: `Black Heart`},
                                            {emoji: `&#x1F49D`, name: `Heart With Ribbon`},
                                            {emoji: `&#x1F49E`, name: `Revolving Hearts`},
                                            {emoji: `&#x1F49F`, name: `Heart Decoration`},
                                            {emoji: `&#x2763`, name: `Heavy Heart Exclamation`},
                                            {emoji: `&#x1F48C`, name: `Love Letter`},
                                            {emoji: `&#x1F4A4`, name: `Zzz`},
                                            {emoji: `&#x1F4A2`, name: `Anger Symbol`},
                                            {emoji: `&#x1F4A3`, name: `Bomb`},
                                            {emoji: `&#x1F4A5`, name: `Collision`},
                                            {emoji: `&#x1F4A6`, name: `Sweat Droplets`},
                                            {emoji: `&#x1F4A8`, name: `Dashing Away`},
                                            {emoji: `&#x1F4AB`, name: `Dizzy`},
                                            {emoji: `&#x1F4AC`, name: `Speech Balloon`},
                                            {emoji: `&#x1F5E8`, name: `Left Speech Bubble`},
                                            {emoji: `&#x1F5EF`, name: `Right Anger Bubble`},
                                            {emoji: `&#x1F4AD`, name: `Thought Balloon`},
                                            {emoji: `&#x1F573`, name: `Hole`},
                                            {emoji: `&#x1F453`, name: `Glasses`},
                                            {emoji: `&#x1F576`, name: `Sunglasses`},
                                            {emoji: `&#x1F454`, name: `Necktie`},
                                            {emoji: `&#x1F455`, name: `T-Shirt`},
                                            {emoji: `&#x1F456`, name: `Jeans`},
                                            {emoji: `&#x1F457`, name: `Dress`},
                                            {emoji: `&#x1F458`, name: `Kimono`},
                                            {emoji: `&#x1F459`, name: `Bikini`},
                                            {emoji: `&#x1F45A`, name: `Womans Clothes`},
                                            {emoji: `&#x1F45B`, name: `Purse`},
                                            {emoji: `&#x1F45C`, name: `Handbag`},
                                            {emoji: `&#x1F45D`, name: `Clutch Bag`},
                                            {emoji: `&#x1F6CD`, name: `Shopping Bags`},
                                            {emoji: `&#x1F392`, name: `School Backpack`},
                                            {emoji: `&#x1F45E`, name: `Mans Shoe`},
                                            {emoji: `&#x1F45F`, name: `Running Shoe`},
                                            {emoji: `&#x1F460`, name: `High-Heeled Shoe`},
                                            {emoji: `&#x1F461`, name: `Womans Sandal`},
                                            {emoji: `&#x1F462`, name: `Womans Boot`},
                                            {emoji: `&#x1F451`, name: `Crown`},
                                            {emoji: `&#x1F452`, name: `Womans Hat`},
                                            {emoji: `&#x1F3A9`, name: `Top Hat`},
                                            {emoji: `&#x1F393`, name: `Graduation Cap`},
                                            {emoji: `&#x26D1`, name: `Rescue Workers Helmet`},
                                            {emoji: `&#x1F4FF`, name: `Prayer Beads`},
                                            {emoji: `&#x1F484`, name: `Lipstick`},
                                            {emoji: `&#x1F48D`, name: `Ring`},
                                            {emoji: `&#x1F48E`, name: `Gem Stone`},
                                            {emoji: `&#x1F435`, name: `Monkey Face`},
                                            {emoji: `&#x1F412`, name: `Monkey`},
                                            {emoji: `&#x1F98D`, name: `Gorilla`},
                                            {emoji: `&#x1F436`, name: `Dog Face`},
                                            {emoji: `&#x1F415`, name: `Dog`},
                                            {emoji: `&#x1F429`, name: `Poodle`},
                                            {emoji: `&#x1F43A`, name: `Wolf Face`},
                                            {emoji: `&#x1F98A`, name: `Fox Face`},
                                            {emoji: `&#x1F431`, name: `Cat Face`},
                                            {emoji: `&#x1F408`, name: `Cat`},
                                            {emoji: `&#x1F981`, name: `Lion Face`},
                                            {emoji: `&#x1F42F`, name: `Tiger Face`},
                                            {emoji: `&#x1F405`, name: `Tiger`},
                                            {emoji: `&#x1F406`, name: `Leopard`},
                                            {emoji: `&#x1F434`, name: `Horse Face`},
                                            {emoji: `&#x1F40E`, name: `Horse`},
                                            {emoji: `&#x1F98C`, name: `Deer`},
                                            {emoji: `&#x1F984`, name: `Unicorn Face`},
                                            {emoji: `&#x1F42E`, name: `Cow Face`},
                                            {emoji: `&#x1F402`, name: `Ox`},
                                            {emoji: `&#x1F403`, name: `Water Buffalo`},
                                            {emoji: `&#x1F404`, name: `Cow`},
                                            {emoji: `&#x1F437`, name: `Pig Face`},
                                            {emoji: `&#x1F416`, name: `Pig`},
                                            {emoji: `&#x1F417`, name: `Boar`},
                                            {emoji: `&#x1F43D`, name: `Pig Nose`},
                                            {emoji: `&#x1F40F`, name: `Ram`},
                                            {emoji: `&#x1F411`, name: `Sheep`},
                                            {emoji: `&#x1F410`, name: `Goat`},
                                            {emoji: `&#x1F42A`, name: `Camel`},
                                            {emoji: `&#x1F42B`, name: `Two-Hump Camel`},
                                            {emoji: `&#x1F418`, name: `Elephant`},
                                            {emoji: `&#x1F98F`, name: `Rhinoceros`},
                                            {emoji: `&#x1F42D`, name: `Mouse Face`},
                                            {emoji: `&#x1F401`, name: `Mouse`},
                                            {emoji: `&#x1F400`, name: `Rat`},
                                            {emoji: `&#x1F439`, name: `Hamster Face`},
                                            {emoji: `&#x1F430`, name: `Rabbit Face`},
                                            {emoji: `&#x1F407`, name: `Rabbit`},
                                            {emoji: `&#x1F43F`, name: `Chipmunk`},
                                            {emoji: `&#x1F987`, name: `Bat`},
                                            {emoji: `&#x1F43B`, name: `Bear Face`},
                                            {emoji: `&#x1F428`, name: `Koala`},
                                            {emoji: `&#x1F43C`, name: `Panda Face`},
                                            {emoji: `&#x1F43E`, name: `Paw Prints`},
                                            {emoji: `&#x1F983`, name: `Turkey`},
                                            {emoji: `&#x1F414`, name: `Chicken`},
                                            {emoji: `&#x1F413`, name: `Rooster`},
                                            {emoji: `&#x1F423`, name: `Hatching Chick`},
                                            {emoji: `&#x1F424`, name: `Baby Chick`},
                                            {emoji: `&#x1F425`, name: `Front-Facing Baby Chick`},
                                            {emoji: `&#x1F426`, name: `Bird`},
                                            {emoji: `&#x1F427`, name: `Penguin`},
                                            {emoji: `&#x1F54A`, name: `Dove`},
                                            {emoji: `&#x1F985`, name: `Eagle`},
                                            {emoji: `&#x1F986`, name: `Duck`},
                                            {emoji: `&#x1F989`, name: `Owl`},
                                            {emoji: `&#x1F438`, name: `Frog Face`},
                                            {emoji: `&#x1F40A`, name: `Crocodile`},
                                            {emoji: `&#x1F422`, name: `Turtle`},
                                            {emoji: `&#x1F98E`, name: `Lizard`},
                                            {emoji: `&#x1F40D`, name: `Snake`},
                                            {emoji: `&#x1F432`, name: `Dragon Face`},
                                            {emoji: `&#x1F409`, name: `Dragon`},
                                            {emoji: `&#x1F433`, name: `Spouting Whale`},
                                            {emoji: `&#x1F40B`, name: `Whale`},
                                            {emoji: `&#x1F42C`, name: `Dolphin`},
                                            {emoji: `&#x1F41F`, name: `Fish`},
                                            {emoji: `&#x1F420`, name: `Tropical Fish`},
                                            {emoji: `&#x1F421`, name: `Blowfish`},
                                            {emoji: `&#x1F988`, name: `Shark`},
                                            {emoji: `&#x1F419`, name: `Octopus`},
                                            {emoji: `&#x1F41A`, name: `Spiral Shell`},
                                            {emoji: `&#x1F980`, name: `Crab`},
                                            {emoji: `&#x1F990`, name: `Shrimp`},
                                            {emoji: `&#x1F991`, name: `Squid`},
                                            {emoji: `&#x1F98B`, name: `Butterfly`},
                                            {emoji: `&#x1F40C`, name: `Snail`},
                                            {emoji: `&#x1F41B`, name: `Bug`},
                                            {emoji: `&#x1F41C`, name: `Ant`},
                                            {emoji: `&#x1F41D`, name: `Honeybee`},
                                            {emoji: `&#x1F41E`, name: `Lady Beetle`},
                                            {emoji: `&#x1F577`, name: `Spider`},
                                            {emoji: `&#x1F578`, name: `Spider Web`},
                                            {emoji: `&#x1F982`, name: `Scorpion`},
                                            {emoji: `&#x1F490`, name: `Bouquet`},
                                            {emoji: `&#x1F338`, name: `Cherry Blossom`},
                                            {emoji: `&#x1F4AE`, name: `White Flower`},
                                            {emoji: `&#x1F3F5`, name: `Rosette`},
                                            {emoji: `&#x1F339`, name: `Rose`},
                                            {emoji: `&#x1F940`, name: `Wilted Flower`},
                                            {emoji: `&#x1F33A`, name: `Hibiscus`},
                                            {emoji: `&#x1F33B`, name: `Sunflower`},
                                            {emoji: `&#x1F33C`, name: `Blossom`},
                                            {emoji: `&#x1F337`, name: `Tulip`},
                                            {emoji: `&#x1F331`, name: `Seedling`},
                                            {emoji: `&#x1F332`, name: `Evergreen Tree`},
                                            {emoji: `&#x1F333`, name: `Deciduous Tree`},
                                            {emoji: `&#x1F334`, name: `Palm Tree`},
                                            {emoji: `&#x1F335`, name: `Cactus`},
                                            {emoji: `&#x1F33E`, name: `Sheaf Of Rice`},
                                            {emoji: `&#x1F33F`, name: `Herb`},
                                            {emoji: `&#x2618`, name: `Shamrock`},
                                            {emoji: `&#x1F340`, name: `Four Leaf Clover`},
                                            {emoji: `&#x1F341`, name: `Maple Leaf`},
                                            {emoji: `&#x1F342`, name: `Fallen Leaf`},
                                            {emoji: `&#x1F343`, name: `Leaf Fluttering In Wind`},
                                            {emoji: `&#x1F347`, name: `Grapes`},
                                            {emoji: `&#x1F348`, name: `Melon`},
                                            {emoji: `&#x1F349`, name: `Watermelon`},
                                            {emoji: `&#x1F34A`, name: `Tangerine`},
                                            {emoji: `&#x1F34B`, name: `Lemon`},
                                            {emoji: `&#x1F34C`, name: `Banana`},
                                            {emoji: `&#x1F34D`, name: `Pineapple`},
                                            {emoji: `&#x1F34E`, name: `Red Apple`},
                                            {emoji: `&#x1F34F`, name: `Green Apple`},
                                            {emoji: `&#x1F350`, name: `Pear`},
                                            {emoji: `&#x1F351`, name: `Peach`},
                                            {emoji: `&#x1F352`, name: `Cherries`},
                                            {emoji: `&#x1F353`, name: `Strawberry`},
                                            {emoji: `&#x1F95D`, name: `Kiwi Fruit`},
                                            {emoji: `&#x1F345`, name: `Tomato`},
                                            {emoji: `&#x1F951`, name: `Avocado`},
                                            {emoji: `&#x1F346`, name: `Eggplant`},
                                            {emoji: `&#x1F954`, name: `Potato`},
                                            {emoji: `&#x1F955`, name: `Carrot`},
                                            {emoji: `&#x1F33D`, name: `Ear Of Corn`},
                                            {emoji: `&#x1F336`, name: `Hot Pepper`},
                                            {emoji: `&#x1F952`, name: `Cucumber`},
                                            {emoji: `&#x1F344`, name: `Mushroom`},
                                            {emoji: `&#x1F95C`, name: `Peanuts`},
                                            {emoji: `&#x1F330`, name: `Chestnut`},
                                            {emoji: `&#x1F35E`, name: `Bread`},
                                            {emoji: `&#x1F950`, name: `Croissant`},
                                            {emoji: `&#x1F956`, name: `Baguette Bread`},
                                            {emoji: `&#x1F95E`, name: `Pancakes`},
                                            {emoji: `&#x1F9C0`, name: `Cheese Wedge`},
                                            {emoji: `&#x1F356`, name: `Meat On Bone`},
                                            {emoji: `&#x1F357`, name: `Poultry Leg`},
                                            {emoji: `&#x1F953`, name: `Bacon`},
                                            {emoji: `&#x1F354`, name: `Hamburger`},
                                            {emoji: `&#x1F35F`, name: `French Fries`},
                                            {emoji: `&#x1F355`, name: `Pizza`},
                                            {emoji: `&#x1F32D`, name: `Hot Dog`},
                                            {emoji: `&#x1F32E`, name: `Taco`},
                                            {emoji: `&#x1F32F`, name: `Burrito`},
                                            {emoji: `&#x1F959`, name: `Stuffed Flatbread`},
                                            {emoji: `&#x1F95A`, name: `Egg`},
                                            {emoji: `&#x1F373`, name: `Cooking`},
                                            {emoji: `&#x1F958`, name: `Shallow Pan Of Food`},
                                            {emoji: `&#x1F372`, name: `Pot Of Food`},
                                            {emoji: `&#x1F957`, name: `Green Salad`},
                                            {emoji: `&#x1F37F`, name: `Popcorn`},
                                            {emoji: `&#x1F371`, name: `Bento Box`},
                                            {emoji: `&#x1F358`, name: `Rice Cracker`},
                                            {emoji: `&#x1F359`, name: `Rice Ball`},
                                            {emoji: `&#x1F35A`, name: `Cooked Rice`},
                                            {emoji: `&#x1F35B`, name: `Curry Rice`},
                                            {emoji: `&#x1F35C`, name: `Steaming Bowl`},
                                            {emoji: `&#x1F35D`, name: `Spaghetti`},
                                            {emoji: `&#x1F360`, name: `Roasted Sweet Potato`},
                                            {emoji: `&#x1F362`, name: `Oden`},
                                            {emoji: `&#x1F363`, name: `Sushi`},
                                            {emoji: `&#x1F364`, name: `Fried Shrimp`},
                                            {emoji: `&#x1F365`, name: `Fish Cake With Swirl`},
                                            {emoji: `&#x1F361`, name: `Dango`},
                                            {emoji: `&#x1F366`, name: `Soft Ice Cream`},
                                            {emoji: `&#x1F367`, name: `Shaved Ice`},
                                            {emoji: `&#x1F368`, name: `Ice Cream`},
                                            {emoji: `&#x1F369`, name: `Doughnut`},
                                            {emoji: `&#x1F36A`, name: `Cookie`},
                                            {emoji: `&#x1F382`, name: `Birthday Cake`},
                                            {emoji: `&#x1F370`, name: `Shortcake`},
                                            {emoji: `&#x1F36B`, name: `Chocolate Bar`},
                                            {emoji: `&#x1F36C`, name: `Candy`},
                                            {emoji: `&#x1F36D`, name: `Lollipop`},
                                            {emoji: `&#x1F36E`, name: `Custard`},
                                            {emoji: `&#x1F36F`, name: `Honey Pot`},
                                            {emoji: `&#x1F37C`, name: `Baby Bottle`},
                                            {emoji: `&#x1F95B`, name: `Glass Of Milk`},
                                            {emoji: `&#x2615`, name: `Hot Beverage`},
                                            {emoji: `&#x1F375`, name: `Teacup Without Handle`},
                                            {emoji: `&#x1F376`, name: `Sake`},
                                            {emoji: `&#x1F37E`, name: `Bottle With Popping Cork`},
                                            {emoji: `&#x1F377`, name: `Wine Glass`},
                                            {emoji: `&#x1F378`, name: `Cocktail Glass`},
                                            {emoji: `&#x1F379`, name: `Tropical Drink`},
                                            {emoji: `&#x1F37A`, name: `Beer Mug`},
                                            {emoji: `&#x1F37B`, name: `Clinking Beer Mugs`},
                                            {emoji: `&#x1F942`, name: `Clinking Glasses`},
                                            {emoji: `&#x1F943`, name: `Tumbler Glass`},
                                            {emoji: `&#x1F37D`, name: `Fork And Knife With Plate`},
                                            {emoji: `&#x1F374`, name: `Fork And Knife`},
                                            {emoji: `&#x1F944`, name: `Spoon`},
                                            {emoji: `&#x1F52A`, name: `Kitchen Knife`},
                                            {emoji: `&#x1F3FA`, name: `Amphora`},
                                            {emoji: `&#x1F30D`, name: `Globe Showing Europe-Africa`},
                                            {emoji: `&#x1F30E`, name: `Globe Showing Americas`},
                                            {emoji: `&#x1F30F`, name: `Globe Showing Asia-Australia`},
                                            {emoji: `&#x1F310`, name: `Globe With Meridians`},
                                            {emoji: `&#x1F5FA`, name: `World Map`},
                                            {emoji: `&#x1F5FE`, name: `Map Of Japan`},
                                            {emoji: `&#x1F3D4`, name: `Snow-Capped Mountain`},
                                            {emoji: `&#x26F0`, name: `Mountain`},
                                            {emoji: `&#x1F30B`, name: `Volcano`},
                                            {emoji: `&#x1F5FB`, name: `Mount Fuji`},
                                            {emoji: `&#x1F3D5`, name: `Camping`},
                                            {emoji: `&#x1F3D6`, name: `Beach With Umbrella`},
                                            {emoji: `&#x1F3DC`, name: `Desert`},
                                            {emoji: `&#x1F3DD`, name: `Desert Island`},
                                            {emoji: `&#x1F3DE`, name: `National Park`},
                                            {emoji: `&#x1F3DF`, name: `Stadium`},
                                            {emoji: `&#x1F3DB`, name: `Classical Building`},
                                            {emoji: `&#x1F3D7`, name: `Building Construction`},
                                            {emoji: `&#x1F3D8`, name: `House`},
                                            {emoji: `&#x1F3D9`, name: `Cityscape`},
                                            {emoji: `&#x1F3DA`, name: `Derelict House`},
                                            {emoji: `&#x1F3E0`, name: `House`},
                                            {emoji: `&#x1F3E1`, name: `House With Garden`},
                                            {emoji: `&#x1F3E2`, name: `Office Building`},
                                            {emoji: `&#x1F3E3`, name: `Japanese Post Office`},
                                            {emoji: `&#x1F3E4`, name: `Post Office`},
                                            {emoji: `&#x1F3E5`, name: `Hospital`},
                                            {emoji: `&#x1F3E6`, name: `Bank`},
                                            {emoji: `&#x1F3E8`, name: `Hotel`},
                                            {emoji: `&#x1F3E9`, name: `Love Hotel`},
                                            {emoji: `&#x1F3EA`, name: `Convenience Store`},
                                            {emoji: `&#x1F3EB`, name: `School`},
                                            {emoji: `&#x1F3EC`, name: `Department Store`},
                                            {emoji: `&#x1F3ED`, name: `Factory`},
                                            {emoji: `&#x1F3EF`, name: `Japanese Castle`},
                                            {emoji: `&#x1F3F0`, name: `Castle`},
                                            {emoji: `&#x1F492`, name: `Wedding`},
                                            {emoji: `&#x1F5FC`, name: `Tokyo Tower`},
                                            {emoji: `&#x1F5FD`, name: `Statue Of Liberty`},
                                            {emoji: `&#x26EA`, name: `Church`},
                                            {emoji: `&#x1F54C`, name: `Mosque`},
                                            {emoji: `&#x1F54D`, name: `Synagogue`},
                                            {emoji: `&#x26E9`, name: `Shinto Shrine`},
                                            {emoji: `&#x1F54B`, name: `Kaaba`},
                                            {emoji: `&#x26F2`, name: `Fountain`},
                                            {emoji: `&#x26FA`, name: `Tent`},
                                            {emoji: `&#x1F301`, name: `Foggy`},
                                            {emoji: `&#x1F303`, name: `Night With Stars`},
                                            {emoji: `&#x1F304`, name: `Sunrise Over Mountains`},
                                            {emoji: `&#x1F305`, name: `Sunrise`},
                                            {emoji: `&#x1F306`, name: `Cityscape At Dusk`},
                                            {emoji: `&#x1F307`, name: `Sunset`},
                                            {emoji: `&#x1F309`, name: `Bridge At Night`},
                                            {emoji: `&#x2668`, name: `Hot Springs`},
                                            {emoji: `&#x1F30C`, name: `Milky Way`},
                                            {emoji: `&#x1F3A0`, name: `Carousel Horse`},
                                            {emoji: `&#x1F3A1`, name: `Ferris Wheel`},
                                            {emoji: `&#x1F3A2`, name: `Roller Coaster`},
                                            {emoji: `&#x1F488`, name: `Barber Pole`},
                                            {emoji: `&#x1F3AA`, name: `Circus Tent`},
                                            {emoji: `&#x1F3AD`, name: `Performing Arts`},
                                            {emoji: `&#x1F5BC`, name: `Framed Picture`},
                                            {emoji: `&#x1F3A8`, name: `Artist Palette`},
                                            {emoji: `&#x1F3B0`, name: `Slot Machine`},
                                            {emoji: `&#x1F682`, name: `Locomotive`},
                                            {emoji: `&#x1F683`, name: `Railway Car`},
                                            {emoji: `&#x1F684`, name: `High-Speed Train`},
                                            {emoji: `&#x1F685`, name: `High-Speed Train With Bullet Nose`},
                                            {emoji: `&#x1F686`, name: `Train`},
                                            {emoji: `&#x1F687`, name: `Metro`},
                                            {emoji: `&#x1F688`, name: `Light Rail`},
                                            {emoji: `&#x1F689`, name: `Station`},
                                            {emoji: `&#x1F68A`, name: `Tram`},
                                            {emoji: `&#x1F69D`, name: `Monorail`},
                                            {emoji: `&#x1F69E`, name: `Mountain Railway`},
                                            {emoji: `&#x1F68B`, name: `Tram Car`},
                                            {emoji: `&#x1F68C`, name: `Bus`},
                                            {emoji: `&#x1F68D`, name: `Oncoming Bus`},
                                            {emoji: `&#x1F68E`, name: `Trolleybus`},
                                            {emoji: `&#x1F690`, name: `Minibus`},
                                            {emoji: `&#x1F691`, name: `Ambulance`},
                                            {emoji: `&#x1F692`, name: `Fire Engine`},
                                            {emoji: `&#x1F693`, name: `Police Car`},
                                            {emoji: `&#x1F694`, name: `Oncoming Police Car`},
                                            {emoji: `&#x1F695`, name: `Taxi`},
                                            {emoji: `&#x1F696`, name: `Oncoming Taxi`},
                                            {emoji: `&#x1F697`, name: `Automobile`},
                                            {emoji: `&#x1F698`, name: `Oncoming Automobile`},
                                            {emoji: `&#x1F699`, name: `Sport Utility Vehicle`},
                                            {emoji: `&#x1F69A`, name: `Delivery Truck`},
                                            {emoji: `&#x1F69B`, name: `Articulated Lorry`},
                                            {emoji: `&#x1F69C`, name: `Tractor`},
                                            {emoji: `&#x1F6B2`, name: `Bicycle`},
                                            {emoji: `&#x1F6F4`, name: `Kick Scooter`},
                                            {emoji: `&#x1F6F5`, name: `Motor Scooter`},
                                            {emoji: `&#x1F68F`, name: `Bus Stop`},
                                            {emoji: `&#x1F6E3`, name: `Motorway`},
                                            {emoji: `&#x1F6E4`, name: `Railway Track`},
                                            {emoji: `&#x26FD`, name: `Fuel Pump`},
                                            {emoji: `&#x1F6A8`, name: `Police Car Light`},
                                            {emoji: `&#x1F6A5`, name: `Horizontal Traffic Light`},
                                            {emoji: `&#x1F6A6`, name: `Vertical Traffic Light`},
                                            {emoji: `&#x1F6A7`, name: `Construction`},
                                            {emoji: `&#x1F6D1`, name: `Stop Sign`},
                                            {emoji: `&#x2693`, name: `Anchor`},
                                            {emoji: `&#x26F5`, name: `Sailboat`},
                                            {emoji: `&#x1F6F6`, name: `Canoe`},
                                            {emoji: `&#x1F6A4`, name: `Speedboat`},
                                            {emoji: `&#x1F6F3`, name: `Passenger Ship`},
                                            {emoji: `&#x26F4`, name: `Ferry`},
                                            {emoji: `&#x1F6E5`, name: `Motor Boat`},
                                            {emoji: `&#x1F6A2`, name: `Ship`},
                                            {emoji: `&#x2708`, name: `Airplane`},
                                            {emoji: `&#x1F6E9`, name: `Small Airplane`},
                                            {emoji: `&#x1F6EB`, name: `Airplane Departure`},
                                            {emoji: `&#x1F6EC`, name: `Airplane Arrival`},
                                            {emoji: `&#x1F4BA`, name: `Seat`},
                                            {emoji: `&#x1F681`, name: `Helicopter`},
                                            {emoji: `&#x1F69F`, name: `Suspension Railway`},
                                            {emoji: `&#x1F6A0`, name: `Mountain Cableway`},
                                            {emoji: `&#x1F6A1`, name: `Aerial Tramway`},
                                            {emoji: `&#x1F680`, name: `Rocket`},
                                            {emoji: `&#x1F6F0`, name: `Satellite`},
                                            {emoji: `&#x1F6CE`, name: `Bellhop Bell`},
                                            {emoji: `&#x1F6AA`, name: `Door`},
                                            {emoji: `&#x1F6CC`, name: `Person In Bed`},
                                            {emoji: `&#x1F6CC&#x1F3FB`, name: `Person In Bed: Light Skin Tone`},
                                            {emoji: `&#x1F6CC&#x1F3FC`, name: `Person In Bed: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6CC&#x1F3FD`, name: `Person In Bed: Medium Skin Tone`},
                                            {emoji: `&#x1F6CC&#x1F3FE`, name: `Person In Bed: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6CC&#x1F3FF`, name: `Person In Bed: Dark Skin Tone`},
                                            {emoji: `&#x1F6CF`, name: `Bed`},
                                            {emoji: `&#x1F6CB`, name: `Couch And Lamp`},
                                            {emoji: `&#x1F6BD`, name: `Toilet`},
                                            {emoji: `&#x1F6BF`, name: `Shower`},
                                            {emoji: `&#x1F6C0`, name: `Person Taking Bath`},
                                            {emoji: `&#x1F6C0&#x1F3FB`, name: `Person Taking Bath: Light Skin Tone`},
                                            {emoji: `&#x1F6C0&#x1F3FC`, name: `Person Taking Bath: Medium-Light Skin Tone`},
                                            {emoji: `&#x1F6C0&#x1F3FD`, name: `Person Taking Bath: Medium Skin Tone`},
                                            {emoji: `&#x1F6C0&#x1F3FE`, name: `Person Taking Bath: Medium-Dark Skin Tone`},
                                            {emoji: `&#x1F6C0&#x1F3FF`, name: `Person Taking Bath: Dark Skin Tone`},
                                            {emoji: `&#x1F6C1`, name: `Bathtub`},
                                            {emoji: `&#x231B`, name: `Hourglass`},
                                            {emoji: `&#x23F3`, name: `Hourglass With Flowing Sand`},
                                            {emoji: `&#x231A`, name: `Watch`},
                                            {emoji: `&#x23F0`, name: `Alarm Clock`},
                                            {emoji: `&#x23F1`, name: `Stopwatch`},
                                            {emoji: `&#x23F2`, name: `Timer Clock`},
                                            {emoji: `&#x1F570`, name: `Mantelpiece Clock`},
                                            {emoji: `&#x1F55B`, name: `Twelve Oclock`},
                                            {emoji: `&#x1F567`, name: `Twelve-Thirty`},
                                            {emoji: `&#x1F550`, name: `One Oclock`},
                                            {emoji: `&#x1F55C`, name: `One-Thirty`},
                                            {emoji: `&#x1F551`, name: `Two Oclock`},
                                            {emoji: `&#x1F55D`, name: `Two-Thirty`},
                                            {emoji: `&#x1F552`, name: `Three Oclock`},
                                            {emoji: `&#x1F55E`, name: `Three-Thirty`},
                                            {emoji: `&#x1F553`, name: `Four Oclock`},
                                            {emoji: `&#x1F55F`, name: `Four-Thirty`},
                                            {emoji: `&#x1F554`, name: `Five Oclock`},
                                            {emoji: `&#x1F560`, name: `Five-Thirty`},
                                            {emoji: `&#x1F555`, name: `Six Oclock`},
                                            {emoji: `&#x1F561`, name: `Six-Thirty`},
                                            {emoji: `&#x1F556`, name: `Seven Oclock`},
                                            {emoji: `&#x1F562`, name: `Seven-Thirty`},
                                            {emoji: `&#x1F557`, name: `Eight Oclock`},
                                            {emoji: `&#x1F563`, name: `Eight-Thirty`},
                                            {emoji: `&#x1F558`, name: `Nine Oclock`},
                                            {emoji: `&#x1F564`, name: `Nine-Thirty`},
                                            {emoji: `&#x1F559`, name: `Ten Oclock`},
                                            {emoji: `&#x1F565`, name: `Ten-Thirty`},
                                            {emoji: `&#x1F55A`, name: `Eleven Oclock`},
                                            {emoji: `&#x1F566`, name: `Eleven-Thirty`},
                                            {emoji: `&#x1F311`, name: `New Moon`},
                                            {emoji: `&#x1F312`, name: `Waxing Crescent Moon`},
                                            {emoji: `&#x1F313`, name: `First Quarter Moon`},
                                            {emoji: `&#x1F314`, name: `Waxing Gibbous Moon`},
                                            {emoji: `&#x1F315`, name: `Full Moon`},
                                            {emoji: `&#x1F316`, name: `Waning Gibbous Moon`},
                                            {emoji: `&#x1F317`, name: `Last Quarter Moon`},
                                            {emoji: `&#x1F318`, name: `Waning Crescent Moon`},
                                            {emoji: `&#x1F319`, name: `Crescent Moon`},
                                            {emoji: `&#x1F31A`, name: `New Moon Face`},
                                            {emoji: `&#x1F31B`, name: `First Quarter Moon With Face`},
                                            {emoji: `&#x1F31C`, name: `Last Quarter Moon With Face`},
                                            {emoji: `&#x1F321`, name: `Thermometer`},
                                            {emoji: `&#x2600`, name: `Sun`},
                                            {emoji: `&#x1F31D`, name: `Full Moon With Face`},
                                            {emoji: `&#x1F31E`, name: `Sun With Face`},
                                            {emoji: `&#x2B50`, name: `White Medium Star`},
                                            {emoji: `&#x1F31F`, name: `Glowing Star`},
                                            {emoji: `&#x1F320`, name: `Shooting Star`},
                                            {emoji: `&#x2601`, name: `Cloud`},
                                            {emoji: `&#x26C5`, name: `Sun Behind Cloud`},
                                            {emoji: `&#x26C8`, name: `Cloud With Lightning And Rain`},
                                            {emoji: `&#x1F324`, name: `Sun Behind Small Cloud`},
                                            {emoji: `&#x1F325`, name: `Sun Behind Large Cloud`},
                                            {emoji: `&#x1F326`, name: `Sun Behind Rain Cloud`},
                                            {emoji: `&#x1F327`, name: `Cloud With Rain`},
                                            {emoji: `&#x1F328`, name: `Cloud With Snow`},
                                            {emoji: `&#x1F329`, name: `Cloud With Lightning`},
                                            {emoji: `&#x1F32A`, name: `Tornado`},
                                            {emoji: `&#x1F32B`, name: `Fog`},
                                            {emoji: `&#x1F32C`, name: `Wind Face`},
                                            {emoji: `&#x1F300`, name: `Cyclone`},
                                            {emoji: `&#x1F308`, name: `Rainbow`},
                                            {emoji: `&#x1F302`, name: `Closed Umbrella`},
                                            {emoji: `&#x2602`, name: `Umbrella`},
                                            {emoji: `&#x2614`, name: `Umbrella With Rain Drops`},
                                            {emoji: `&#x26F1`, name: `Umbrella On Ground`},
                                            {emoji: `&#x26A1`, name: `High Voltage`},
                                            {emoji: `&#x2744`, name: `Snowflake`},
                                            {emoji: `&#x2603`, name: `Snowman`},
                                            {emoji: `&#x26C4`, name: `Snowman Without Snow`},
                                            {emoji: `&#x2604`, name: `Comet`},
                                            {emoji: `&#x1F525`, name: `Fire`},
                                            {emoji: `&#x1F4A7`, name: `Droplet`},
                                            {emoji: `&#x1F30A`, name: `Water Wave`},
                                            {emoji: `&#x1F383`, name: `Jack-O-Lantern`},
                                            {emoji: `&#x1F384`, name: `Christmas Tree`},
                                            {emoji: `&#x1F386`, name: `Fireworks`},
                                            {emoji: `&#x1F387`, name: `Sparkler`},
                                            {emoji: `&#x2728`, name: `Sparkles`},
                                            {emoji: `&#x1F388`, name: `Balloon`},
                                            {emoji: `&#x1F389`, name: `Party Popper`},
                                            {emoji: `&#x1F38A`, name: `Confetti Ball`},
                                            {emoji: `&#x1F38B`, name: `Tanabata Tree`},
                                            {emoji: `&#x1F38D`, name: `Pine Decoration`},
                                            {emoji: `&#x1F38E`, name: `Japanese Dolls`},
                                            {emoji: `&#x1F38F`, name: `Carp Streamer`},
                                            {emoji: `&#x1F390`, name: `Wind Chime`},
                                            {emoji: `&#x1F391`, name: `Moon Viewing Ceremony`},
                                            {emoji: `&#x1F380`, name: `Ribbon`},
                                            {emoji: `&#x1F381`, name: `Wrapped Gift`},
                                            {emoji: `&#x1F397`, name: `Reminder Ribbon`},
                                            {emoji: `&#x1F39F`, name: `Admission Tickets`},
                                            {emoji: `&#x1F3AB`, name: `Ticket`},
                                            {emoji: `&#x1F396`, name: `Military Medal`},
                                            {emoji: `&#x1F3C6`, name: `Trophy`},
                                            {emoji: `&#x1F3C5`, name: `Sports Medal`},
                                            {emoji: `&#x1F947`, name: `1st Place Medal`},
                                            {emoji: `&#x1F948`, name: `2nd Place Medal`},
                                            {emoji: `&#x1F949`, name: `3rd Place Medal`},
                                            {emoji: `&#x26BD`, name: `Soccer Ball`},
                                            {emoji: `&#x26BE`, name: `Baseball`},
                                            {emoji: `&#x1F3C0`, name: `Basketball`},
                                            {emoji: `&#x1F3D0`, name: `Volleyball`},
                                            {emoji: `&#x1F3C8`, name: `American Football`},
                                            {emoji: `&#x1F3C9`, name: `Rugby Football`},
                                            {emoji: `&#x1F3BE`, name: `Tennis`},
                                            {emoji: `&#x1F3B1`, name: `Pool 8 Ball`},
                                            {emoji: `&#x1F3B3`, name: `Bowling`},
                                            {emoji: `&#x1F3CF`, name: `Cricket`},
                                            {emoji: `&#x1F3D1`, name: `Field Hockey`},
                                            {emoji: `&#x1F3D2`, name: `Ice Hockey`},
                                            {emoji: `&#x1F3D3`, name: `Ping Pong`},
                                            {emoji: `&#x1F3F8`, name: `Badminton`},
                                            {emoji: `&#x1F94A`, name: `Boxing Glove`},
                                            {emoji: `&#x1F94B`, name: `Martial Arts Uniform`},
                                            {emoji: `&#x1F945`, name: `Goal Net`},
                                            {emoji: `&#x1F3AF`, name: `Direct Hit`},
                                            {emoji: `&#x26F3`, name: `Flag In Hole`},
                                            {emoji: `&#x26F8`, name: `Ice Skate`},
                                            {emoji: `&#x1F3A3`, name: `Fishing Pole`},
                                            {emoji: `&#x1F3BD`, name: `Running Shirt`},
                                            {emoji: `&#x1F3BF`, name: `Skis`},
                                            {emoji: `&#x1F3AE`, name: `Video Game`},
                                            {emoji: `&#x1F579`, name: `Joystick`},
                                            {emoji: `&#x1F3B2`, name: `Game Die`},
                                            {emoji: `&#x2660`, name: `Spade Suit`},
                                            {emoji: `&#x2665`, name: `Heart Suit`},
                                            {emoji: `&#x2666`, name: `Diamond Suit`},
                                            {emoji: `&#x2663`, name: `Club Suit`},
                                            {emoji: `&#x1F0CF`, name: `Joker`},
                                            {emoji: `&#x1F004`, name: `Mahjong Red Dragon`},
                                            {emoji: `&#x1F3B4`, name: `Flower Playing Cards`},
                                            {emoji: `&#x1F507`, name: `Muted Speaker`},
                                            {emoji: `&#x1F508`, name: `Speaker Low Volume`},
                                            {emoji: `&#x1F509`, name: `Speaker Medium Volume`},
                                            {emoji: `&#x1F50A`, name: `Speaker High Volume`},
                                            {emoji: `&#x1F4E2`, name: `Loudspeaker`},
                                            {emoji: `&#x1F4E3`, name: `Megaphone`},
                                            {emoji: `&#x1F4EF`, name: `Postal Horn`},
                                            {emoji: `&#x1F514`, name: `Bell`},
                                            {emoji: `&#x1F515`, name: `Bell With Slash`},
                                            {emoji: `&#x1F3BC`, name: `Musical Score`},
                                            {emoji: `&#x1F3B5`, name: `Musical Note`},
                                            {emoji: `&#x1F3B6`, name: `Musical Notes`},
                                            {emoji: `&#x1F399`, name: `Studio Microphone`},
                                            {emoji: `&#x1F39A`, name: `Level Slider`},
                                            {emoji: `&#x1F39B`, name: `Control Knobs`},
                                            {emoji: `&#x1F3A4`, name: `Microphone`},
                                            {emoji: `&#x1F3A7`, name: `Headphone`},
                                            {emoji: `&#x1F4FB`, name: `Radio`},
                                            {emoji: `&#x1F3B7`, name: `Saxophone`},
                                            {emoji: `&#x1F3B8`, name: `Guitar`},
                                            {emoji: `&#x1F3B9`, name: `Musical Keyboard`},
                                            {emoji: `&#x1F3BA`, name: `Trumpet`},
                                            {emoji: `&#x1F3BB`, name: `Violin`},
                                            {emoji: `&#x1F941`, name: `Drum`},
                                            {emoji: `&#x1F4F1`, name: `Mobile Phone`},
                                            {emoji: `&#x1F4F2`, name: `Mobile Phone With Arrow`},
                                            {emoji: `&#x260E`, name: `Telephone`},
                                            {emoji: `&#x1F4DE`, name: `Telephone Receiver`},
                                            {emoji: `&#x1F4DF`, name: `Pager`},
                                            {emoji: `&#x1F4E0`, name: `Fax Machine`},
                                            {emoji: `&#x1F50B`, name: `Battery`},
                                            {emoji: `&#x1F50C`, name: `Electric Plug`},
                                            {emoji: `&#x1F4BB`, name: `Laptop Computer`},
                                            {emoji: `&#x1F5A5`, name: `Desktop Computer`},
                                            {emoji: `&#x1F5A8`, name: `Printer`},
                                            {emoji: `&#x2328`, name: `Keyboard`},
                                            {emoji: `&#x1F5B1`, name: `Computer Mouse`},
                                            {emoji: `&#x1F5B2`, name: `Trackball`},
                                            {emoji: `&#x1F4BD`, name: `Computer Disk`},
                                            {emoji: `&#x1F4BE`, name: `Floppy Disk`},
                                            {emoji: `&#x1F4BF`, name: `Optical Disk`},
                                            {emoji: `&#x1F4C0`, name: `Dvd`},
                                            {emoji: `&#x1F3A5`, name: `Movie Camera`},
                                            {emoji: `&#x1F39E`, name: `Film Frames`},
                                            {emoji: `&#x1F4FD`, name: `Film Projector`},
                                            {emoji: `&#x1F3AC`, name: `Clapper Board`},
                                            {emoji: `&#x1F4FA`, name: `Television`},
                                            {emoji: `&#x1F4F7`, name: `Camera`},
                                            {emoji: `&#x1F4F8`, name: `Camera With Flash`},
                                            {emoji: `&#x1F4F9`, name: `Video Camera`},
                                            {emoji: `&#x1F4FC`, name: `Videocassette`},
                                            {emoji: `&#x1F50D`, name: `Left-Pointing Magnifying Glass`},
                                            {emoji: `&#x1F50E`, name: `Right-Pointing Magnifying Glass`},
                                            {emoji: `&#x1F52C`, name: `Microscope`},
                                            {emoji: `&#x1F52D`, name: `Telescope`},
                                            {emoji: `&#x1F4E1`, name: `Satellite Antenna`},
                                            {emoji: `&#x1F56F`, name: `Candle`},
                                            {emoji: `&#x1F4A1`, name: `Light Bulb`},
                                            {emoji: `&#x1F526`, name: `Flashlight`},
                                            {emoji: `&#x1F3EE`, name: `Red Paper Lantern`},
                                            {emoji: `&#x1F4D4`, name: `Notebook With Decorative Cover`},
                                            {emoji: `&#x1F4D5`, name: `Closed Book`},
                                            {emoji: `&#x1F4D6`, name: `Open Book`},
                                            {emoji: `&#x1F4D7`, name: `Green Book`},
                                            {emoji: `&#x1F4D8`, name: `Blue Book`},
                                            {emoji: `&#x1F4D9`, name: `Orange Book`},
                                            {emoji: `&#x1F4DA`, name: `Books`},
                                            {emoji: `&#x1F4D3`, name: `Notebook`},
                                            {emoji: `&#x1F4D2`, name: `Ledger`},
                                            {emoji: `&#x1F4C3`, name: `Page With Curl`},
                                            {emoji: `&#x1F4DC`, name: `Scroll`},
                                            {emoji: `&#x1F4C4`, name: `Page Facing Up`},
                                            {emoji: `&#x1F4F0`, name: `Newspaper`},
                                            {emoji: `&#x1F5DE`, name: `Rolled-Up Newspaper`},
                                            {emoji: `&#x1F4D1`, name: `Bookmark Tabs`},
                                            {emoji: `&#x1F516`, name: `Bookmark`},
                                            {emoji: `&#x1F3F7`, name: `Label`},
                                            {emoji: `&#x1F4B0`, name: `Money Bag`},
                                            {emoji: `&#x1F4B4`, name: `Yen Banknote`},
                                            {emoji: `&#x1F4B5`, name: `Dollar Banknote`},
                                            {emoji: `&#x1F4B6`, name: `Euro Banknote`},
                                            {emoji: `&#x1F4B7`, name: `Pound Banknote`},
                                            {emoji: `&#x1F4B8`, name: `Money With Wings`},
                                            {emoji: `&#x1F4B3`, name: `Credit Card`},
                                            {emoji: `&#x1F4B9`, name: `Chart Increasing With Yen`},
                                            {emoji: `&#x1F4B1`, name: `Currency Exchange`},
                                            {emoji: `&#x1F4B2`, name: `Heavy Dollar Sign`},
                                            {emoji: `&#x2709`, name: `Envelope`},
                                            {emoji: `&#x1F4E7`, name: `E-Mail`},
                                            {emoji: `&#x1F4E8`, name: `Incoming Envelope`},
                                            {emoji: `&#x1F4E9`, name: `Envelope With Arrow`},
                                            {emoji: `&#x1F4E4`, name: `Outbox Tray`},
                                            {emoji: `&#x1F4E5`, name: `Inbox Tray`},
                                            {emoji: `&#x1F4E6`, name: `Package`},
                                            {emoji: `&#x1F4EB`, name: `Closed Mailbox With Raised Flag`},
                                            {emoji: `&#x1F4EA`, name: `Closed Mailbox With Lowered Flag`},
                                            {emoji: `&#x1F4EC`, name: `Open Mailbox With Raised Flag`},
                                            {emoji: `&#x1F4ED`, name: `Open Mailbox With Lowered Flag`},
                                            {emoji: `&#x1F4EE`, name: `Postbox`},
                                            {emoji: `&#x1F5F3`, name: `Ballot Box With Ballot`},
                                            {emoji: `&#x270F`, name: `Pencil`},
                                            {emoji: `&#x2712`, name: `Black Nib`},
                                            {emoji: `&#x1F58B`, name: `Fountain Pen`},
                                            {emoji: `&#x1F58A`, name: `Pen`},
                                            {emoji: `&#x1F58C`, name: `Paintbrush`},
                                            {emoji: `&#x1F58D`, name: `Crayon`},
                                            {emoji: `&#x1F4DD`, name: `Memo`},
                                            {emoji: `&#x1F4BC`, name: `Briefcase`},
                                            {emoji: `&#x1F4C1`, name: `File Folder`},
                                            {emoji: `&#x1F4C2`, name: `Open File Folder`},
                                            {emoji: `&#x1F5C2`, name: `Card Index Dividers`},
                                            {emoji: `&#x1F4C5`, name: `Calendar`},
                                            {emoji: `&#x1F4C6`, name: `Tear-Off Calendar`},
                                            {emoji: `&#x1F5D2`, name: `Spiral Notepad`},
                                            {emoji: `&#x1F5D3`, name: `Spiral Calendar`},
                                            {emoji: `&#x1F4C7`, name: `Card Index`},
                                            {emoji: `&#x1F4C8`, name: `Chart Increasing`},
                                            {emoji: `&#x1F4C9`, name: `Chart Decreasing`},
                                            {emoji: `&#x1F4CA`, name: `Bar Chart`},
                                            {emoji: `&#x1F4CB`, name: `Clipboard`},
                                            {emoji: `&#x1F4CC`, name: `Pushpin`},
                                            {emoji: `&#x1F4CD`, name: `Round Pushpin`},
                                            {emoji: `&#x1F4CE`, name: `Paperclip`},
                                            {emoji: `&#x1F587`, name: `Linked Paperclips`},
                                            {emoji: `&#x1F4CF`, name: `Straight Ruler`},
                                            {emoji: `&#x1F4D0`, name: `Triangular Ruler`},
                                            {emoji: `&#x2702`, name: `Scissors`},
                                            {emoji: `&#x1F5C3`, name: `Card File Box`},
                                            {emoji: `&#x1F5C4`, name: `File Cabinet`},
                                            {emoji: `&#x1F5D1`, name: `Wastebasket`},
                                            {emoji: `&#x1F512`, name: `Locked`},
                                            {emoji: `&#x1F513`, name: `Unlocked`},
                                            {emoji: `&#x1F50F`, name: `Locked With Pen`},
                                            {emoji: `&#x1F510`, name: `Locked With Key`},
                                            {emoji: `&#x1F511`, name: `Key`},
                                            {emoji: `&#x1F5DD`, name: `Old Key`},
                                            {emoji: `&#x1F528`, name: `Hammer`},
                                            {emoji: `&#x26CF`, name: `Pick`},
                                            {emoji: `&#x2692`, name: `Hammer And Pick`},
                                            {emoji: `&#x1F6E0`, name: `Hammer And Wrench`},
                                            {emoji: `&#x1F5E1`, name: `Dagger`},
                                            {emoji: `&#x2694`, name: `Crossed Swords`},
                                            {emoji: `&#x1F52B`, name: `Pistol`},
                                            {emoji: `&#x1F3F9`, name: `Bow And Arrow`},
                                            {emoji: `&#x1F6E1`, name: `Shield`},
                                            {emoji: `&#x1F527`, name: `Wrench`},
                                            {emoji: `&#x1F529`, name: `Nut And Bolt`},
                                            {emoji: `&#x2699`, name: `Gear`},
                                            {emoji: `&#x1F5DC`, name: `Clamp`},
                                            {emoji: `&#x2697`, name: `Alembic`},
                                            {emoji: `&#x2696`, name: `Balance Scale`},
                                            {emoji: `&#x1F517`, name: `Link`},
                                            {emoji: `&#x26D3`, name: `Chains`},
                                            {emoji: `&#x1F489`, name: `Syringe`},
                                            {emoji: `&#x1F48A`, name: `Pill`},
                                            {emoji: `&#x1F6AC`, name: `Cigarette`},
                                            {emoji: `&#x26B0`, name: `Coffin`},
                                            {emoji: `&#x26B1`, name: `Funeral Urn`},
                                            {emoji: `&#x1F5FF`, name: `Moai`},
                                            {emoji: `&#x1F6E2`, name: `Oil Drum`},
                                            {emoji: `&#x1F52E`, name: `Crystal Ball`},
                                            {emoji: `&#x1F6D2`, name: `Shopping Cart`},
                                            {emoji: `&#x1F3E7`, name: `ATM Sign`},
                                            {emoji: `&#x1F6AE`, name: `Litter In Bin Sign`},
                                            {emoji: `&#x1F6B0`, name: `Potable Water`},
                                            {emoji: `&#x267F`, name: `Wheelchair Symbol`},
                                            {emoji: `&#x1F6B9`, name: `Mens Room`},
                                            {emoji: `&#x1F6BA`, name: `Womens Room`},
                                            {emoji: `&#x1F6BB`, name: `Restroom`},
                                            {emoji: `&#x1F6BC`, name: `Baby Symbol`},
                                            {emoji: `&#x1F6BE`, name: `Water Closet`},
                                            {emoji: `&#x1F6C2`, name: `Passport Control`},
                                            {emoji: `&#x1F6C3`, name: `Customs`},
                                            {emoji: `&#x1F6C4`, name: `Baggage Claim`},
                                            {emoji: `&#x1F6C5`, name: `Left Luggage`},
                                            {emoji: `&#x26A0`, name: `Warning`},
                                            {emoji: `&#x1F6B8`, name: `Children Crossing`},
                                            {emoji: `&#x26D4`, name: `No Entry`},
                                            {emoji: `&#x1F6AB`, name: `Prohibited`},
                                            {emoji: `&#x1F6B3`, name: `No Bicycles`},
                                            {emoji: `&#x1F6AD`, name: `No Smoking`},
                                            {emoji: `&#x1F6AF`, name: `No Littering`},
                                            {emoji: `&#x1F6B1`, name: `Non-Potable Water`},
                                            {emoji: `&#x1F6B7`, name: `No Pedestrians`},
                                            {emoji: `&#x1F4F5`, name: `No Mobile Phones`},
                                            {emoji: `&#x1F51E`, name: `No One Under Eighteen`},
                                            {emoji: `&#x2622`, name: `Radioactive`},
                                            {emoji: `&#x2623`, name: `Biohazard`},
                                            {emoji: `&#x2B06`, name: `Up Arrow`},
                                            {emoji: `&#x2197`, name: `Up-Right Arrow`},
                                            {emoji: `&#x27A1`, name: `Right Arrow`},
                                            {emoji: `&#x2198`, name: `Down-Right Arrow`},
                                            {emoji: `&#x2B07`, name: `Down Arrow`},
                                            {emoji: `&#x2199`, name: `Down-Left Arrow`},
                                            {emoji: `&#x2B05`, name: `Left Arrow`},
                                            {emoji: `&#x2196`, name: `Up-Left Arrow`},
                                            {emoji: `&#x2195`, name: `Up-Down Arrow`},
                                            {emoji: `&#x2194`, name: `Left-Right Arrow`},
                                            {emoji: `&#x21A9`, name: `Right Arrow Curving Left`},
                                            {emoji: `&#x21AA`, name: `Left Arrow Curving Right`},
                                            {emoji: `&#x2934`, name: `Right Arrow Curving Up`},
                                            {emoji: `&#x2935`, name: `Right Arrow Curving Down`},
                                            {emoji: `&#x1F503`, name: `Clockwise Vertical Arrows`},
                                            {emoji: `&#x1F504`, name: `Anticlockwise Arrows Button`},
                                            {emoji: `&#x1F519`, name: `BACK Arrow`},
                                            {emoji: `&#x1F51A`, name: `END Arrow`},
                                            {emoji: `&#x1F51B`, name: `ON! Arrow`},
                                            {emoji: `&#x1F51C`, name: `SOON Arrow`},
                                            {emoji: `&#x1F51D`, name: `TOP Arrow`},
                                            {emoji: `&#x1F6D0`, name: `Place Of Worship`},
                                            {emoji: `&#x269B`, name: `Atom Symbol`},
                                            {emoji: `&#x1F549`, name: `Om`},
                                            {emoji: `&#x2721`, name: `Star Of David`},
                                            {emoji: `&#x2638`, name: `Wheel Of Dharma`},
                                            {emoji: `&#x262F`, name: `Yin Yang`},
                                            {emoji: `&#x271D`, name: `Latin Cross`},
                                            {emoji: `&#x2626`, name: `Orthodox Cross`},
                                            {emoji: `&#x262A`, name: `Star And Crescent`},
                                            {emoji: `&#x262E`, name: `Peace Symbol`},
                                            {emoji: `&#x1F54E`, name: `Menorah`},
                                            {emoji: `&#x1F52F`, name: `Dotted Six-Pointed Star`},
                                            {emoji: `&#x2648`, name: `Aries`},
                                            {emoji: `&#x2649`, name: `Taurus`},
                                            {emoji: `&#x264A`, name: `Gemini`},
                                            {emoji: `&#x264B`, name: `Cancer`},
                                            {emoji: `&#x264C`, name: `Leo`},
                                            {emoji: `&#x264D`, name: `Virgo`},
                                            {emoji: `&#x264E`, name: `Libra`},
                                            {emoji: `&#x264F`, name: `Scorpius`},
                                            {emoji: `&#x2650`, name: `Sagittarius`},
                                            {emoji: `&#x2651`, name: `Capricorn`},
                                            {emoji: `&#x2652`, name: `Aquarius`},
                                            {emoji: `&#x2653`, name: `Pisces`},
                                            {emoji: `&#x26CE`, name: `Ophiuchus`},
                                            {emoji: `&#x1F500`, name: `Shuffle Tracks Button`},
                                            {emoji: `&#x1F501`, name: `Repeat Button`},
                                            {emoji: `&#x1F502`, name: `Repeat Single Button`},
                                            {emoji: `&#x25B6`, name: `Play Button`},
                                            {emoji: `&#x23E9`, name: `Fast-Forward Button`},
                                            {emoji: `&#x23ED`, name: `Next Track Button`},
                                            {emoji: `&#x23EF`, name: `Play Or Pause Button`},
                                            {emoji: `&#x25C0`, name: `Reverse Button`},
                                            {emoji: `&#x23EA`, name: `Fast Reverse Button`},
                                            {emoji: `&#x23EE`, name: `Last Track Button`},
                                            {emoji: `&#x1F53C`, name: `Up Button`},
                                            {emoji: `&#x23EB`, name: `Fast Up Button`},
                                            {emoji: `&#x1F53D`, name: `Down Button`},
                                            {emoji: `&#x23EC`, name: `Fast Down Button`},
                                            {emoji: `&#x23F8`, name: `Pause Button`},
                                            {emoji: `&#x23F9`, name: `Stop Button`},
                                            {emoji: `&#x23FA`, name: `Record Button`},
                                            {emoji: `&#x23CF`, name: `Eject Button`},
                                            {emoji: `&#x1F3A6`, name: `Cinema`},
                                            {emoji: `&#x1F505`, name: `Dim Button`},
                                            {emoji: `&#x1F506`, name: `Bright Button`},
                                            {emoji: `&#x1F4F6`, name: `Antenna Bars`},
                                            {emoji: `&#x1F4F3`, name: `Vibration Mode`},
                                            {emoji: `&#x1F4F4`, name: `Mobile Phone Off`},
                                            {emoji: `&#x267B`, name: `Recycling Symbol`},
                                            {emoji: `&#x1F4DB`, name: `Name Badge`},
                                            {emoji: `&#x269C`, name: `Fleur-De-Lis`},
                                            {emoji: `&#x1F530`, name: `Japanese Symbol For Beginner`},
                                            {emoji: `&#x1F531`, name: `Trident Emblem`},
                                            {emoji: `&#x2B55`, name: `Heavy Large Circle`},
                                            {emoji: `&#x2705`, name: `White Heavy Check Mark`},
                                            {emoji: `&#x2611`, name: `Ballot Box With Check`},
                                            {emoji: `&#x2714`, name: `Heavy Check Mark`},
                                            {emoji: `&#x2716`, name: `Heavy Multiplication X`},
                                            {emoji: `&#x274C`, name: `Cross Mark`},
                                            {emoji: `&#x274E`, name: `Cross Mark Button`},
                                            {emoji: `&#x2795`, name: `Heavy Plus Sign`},
                                            {emoji: `&#x2640`, name: `Female Sign`},
                                            {emoji: `&#x2642`, name: `Male Sign`},
                                            {emoji: `&#x2695`, name: `Medical Symbol`},
                                            {emoji: `&#x2796`, name: `Heavy Minus Sign`},
                                            {emoji: `&#x2797`, name: `Heavy Division Sign`},
                                            {emoji: `&#x27B0`, name: `Curly Loop`},
                                            {emoji: `&#x27BF`, name: `Double Curly Loop`},
                                            {emoji: `&#x303D`, name: `Part Alternation Mark`},
                                            {emoji: `&#x2733`, name: `Eight-Spoked Asterisk`},
                                            {emoji: `&#x2734`, name: `Eight-Pointed Star`},
                                            {emoji: `&#x2747`, name: `Sparkle`},
                                            {emoji: `&#x203C`, name: `Double Exclamation Mark`},
                                            {emoji: `&#x2049`, name: `Exclamation Question Mark`},
                                            {emoji: `&#x2753`, name: `Question Mark`},
                                            {emoji: `&#x2754`, name: `White Question Mark`},
                                            {emoji: `&#x2755`, name: `White Exclamation Mark`},
                                            {emoji: `&#x2757`, name: `Exclamation Mark`},
                                            {emoji: `&#x3030`, name: `Wavy Dash`},
                                            {emoji: `&#x00A9`, name: `Copyright`},
                                            {emoji: `&#x00AE`, name: `Registered`},
                                            {emoji: `&#x2122`, name: `Trade Mark`},
                                            {emoji: `&#x0023&#xFE0F&#x20E3`, name: `Keycap: #`},
                                            {emoji: `&#x002A&#xFE0F&#x20E3`, name: `Keycap: *`},
                                            {emoji: `&#x0030&#xFE0F&#x20E3`, name: `Keycap: 0`},
                                            {emoji: `&#x0031&#xFE0F&#x20E3`, name: `Keycap: 1`},
                                            {emoji: `&#x0032&#xFE0F&#x20E3`, name: `Keycap: 2`},
                                            {emoji: `&#x0033&#xFE0F&#x20E3`, name: `Keycap: 3`},
                                            {emoji: `&#x0034&#xFE0F&#x20E3`, name: `Keycap: 4`},
                                            {emoji: `&#x0035&#xFE0F&#x20E3`, name: `Keycap: 5`},
                                            {emoji: `&#x0036&#xFE0F&#x20E3`, name: `Keycap: 6`},
                                            {emoji: `&#x0037&#xFE0F&#x20E3`, name: `Keycap: 7`},
                                            {emoji: `&#x0038&#xFE0F&#x20E3`, name: `Keycap: 8`},
                                            {emoji: `&#x0039&#xFE0F&#x20E3`, name: `Keycap: 9`},
                                            {emoji: `&#x1F51F`, name: `Keycap 10`},
                                            {emoji: `&#x1F4AF`, name: `Hundred Points`},
                                            {emoji: `&#x1F520`, name: `Input Latin Uppercase`},
                                            {emoji: `&#x1F521`, name: `Input Latin Lowercase`},
                                            {emoji: `&#x1F522`, name: `Input Numbers`},
                                            {emoji: `&#x1F523`, name: `Input Symbols`},
                                            {emoji: `&#x1F524`, name: `Input Latin Letters`},
                                            {emoji: `&#x1F170`, name: `A Button (blood Type)`},
                                            {emoji: `&#x1F18E`, name: `AB Button (blood Type)`},
                                            {emoji: `&#x1F171`, name: `B Button (blood Type)`},
                                            {emoji: `&#x1F191`, name: `CL Button`},
                                            {emoji: `&#x1F192`, name: `COOL Button`},
                                            {emoji: `&#x1F193`, name: `FREE Button`},
                                            {emoji: `&#x2139`, name: `Information`},
                                            {emoji: `&#x1F194`, name: `ID Button`},
                                            {emoji: `&#x24C2`, name: `Circled M`},
                                            {emoji: `&#x1F195`, name: `NEW Button`},
                                            {emoji: `&#x1F196`, name: `NG Button`},
                                            {emoji: `&#x1F17E`, name: `O Button (blood Type)`},
                                            {emoji: `&#x1F197`, name: `OK Button`},
                                            {emoji: `&#x1F17F`, name: `P Button`},
                                            {emoji: `&#x1F198`, name: `SOS Button`},
                                            {emoji: `&#x1F199`, name: `UP! Button`},
                                            {emoji: `&#x1F19A`, name: `VS Button`},
                                            {emoji: `&#x1F201`, name: `Japanese here Button`},
                                            {emoji: `&#x1F202`, name: `Japanese service Charge Button`},
                                            {emoji: `&#x1F237`, name: `Japanese monthly Amount Button`},
                                            {emoji: `&#x1F236`, name: `Japanese not Free Of Charge Button`},
                                            {emoji: `&#x1F22F`, name: `Japanese reserved Button`},
                                            {emoji: `&#x1F250`, name: `Japanese bargain Button`},
                                            {emoji: `&#x1F239`, name: `Japanese discount Button`},
                                            {emoji: `&#x1F21A`, name: `Japanese free Of Charge Button`},
                                            {emoji: `&#x1F232`, name: `Japanese prohibited Button`},
                                            {emoji: `&#x1F251`, name: `Japanese acceptable Button`},
                                            {emoji: `&#x1F238`, name: `Japanese application Button`},
                                            {emoji: `&#x1F234`, name: `Japanese passing Grade Button`},
                                            {emoji: `&#x1F233`, name: `Japanese vacancy Button`},
                                            {emoji: `&#x3297`, name: `Japanese congratulations Button`},
                                            {emoji: `&#x3299`, name: `Japanese secret Button`},
                                            {emoji: `&#x1F23A`, name: `Japanese open For Business Button`},
                                            {emoji: `&#x1F235`, name: `Japanese no Vacancy Button`},
                                            {emoji: `&#x25AA`, name: `Black Small Square`},
                                            {emoji: `&#x25AB`, name: `White Small Square`},
                                            {emoji: `&#x25FB`, name: `White Medium Square`},
                                            {emoji: `&#x25FC`, name: `Black Medium Square`},
                                            {emoji: `&#x25FD`, name: `White Medium-Small Square`},
                                            {emoji: `&#x25FE`, name: `Black Medium-Small Square`},
                                            {emoji: `&#x2B1B`, name: `Black Large Square`},
                                            {emoji: `&#x2B1C`, name: `White Large Square`},
                                            {emoji: `&#x1F536`, name: `Large Orange Diamond`},
                                            {emoji: `&#x1F537`, name: `Large Blue Diamond`},
                                            {emoji: `&#x1F538`, name: `Small Orange Diamond`},
                                            {emoji: `&#x1F539`, name: `Small Blue Diamond`},
                                            {emoji: `&#x1F53A`, name: `Red Triangle Pointed Up`},
                                            {emoji: `&#x1F53B`, name: `Red Triangle Pointed Down`},
                                            {emoji: `&#x1F4A0`, name: `Diamond With A Dot`},
                                            {emoji: `&#x1F518`, name: `Radio Button`},
                                            {emoji: `&#x1F532`, name: `Black Square Button`},
                                            {emoji: `&#x1F533`, name: `White Square Button`},
                                            {emoji: `&#x26AA`, name: `White Circle`},
                                            {emoji: `&#x26AB`, name: `Black Circle`},
                                            {emoji: `&#x1F534`, name: `Red Circle`},
                                            {emoji: `&#x1F535`, name: `Blue Circle`},
                                            {emoji: `&#x1F3C1`, name: `Chequered Flag`},
                                            {emoji: `&#x1F6A9`, name: `Triangular Flag`},
                                            {emoji: `&#x1F38C`, name: `Crossed Flags`},
                                            {emoji: `&#x1F3F4`, name: `Black Flag`},
                                            {emoji: `&#x1F3F3`, name: `White Flag`},
                                            {emoji: `&#x1F3F3&#xFE0F&#x200D&#x1F308`, name: `Rainbow Flag`},
                                            {emoji: `&#x1F1E6&#x1F1E8`, name: `Ascension Island`},
                                            {emoji: `&#x1F1E6&#x1F1E9`, name: `Andorra`},
                                            {emoji: `&#x1F1E6&#x1F1EA`, name: `United Arab Emirates`},
                                            {emoji: `&#x1F1E6&#x1F1EB`, name: `Afghanistan`},
                                            {emoji: `&#x1F1E6&#x1F1EC`, name: `Antigua & Barbuda`},
                                            {emoji: `&#x1F1E6&#x1F1EE`, name: `Anguilla`},
                                            {emoji: `&#x1F1E6&#x1F1F1`, name: `Albania`},
                                            {emoji: `&#x1F1E6&#x1F1F2`, name: `Armenia`},
                                            {emoji: `&#x1F1E6&#x1F1F4`, name: `Angola`},
                                            {emoji: `&#x1F1E6&#x1F1F6`, name: `Antarctica`},
                                            {emoji: `&#x1F1E6&#x1F1F7`, name: `Argentina`},
                                            {emoji: `&#x1F1E6&#x1F1F8`, name: `American Samoa`},
                                            {emoji: `&#x1F1E6&#x1F1F9`, name: `Austria`},
                                            {emoji: `&#x1F1E6&#x1F1FA`, name: `Australia`},
                                            {emoji: `&#x1F1E6&#x1F1FC`, name: `Aruba`},
                                            {emoji: `&#x1F1E6&#x1F1FD`, name: `land Islands`},
                                            {emoji: `&#x1F1E6&#x1F1FF`, name: `Azerbaijan`},
                                            {emoji: `&#x1F1E7&#x1F1E6`, name: `Bosnia & Herzegovina`},
                                            {emoji: `&#x1F1E7&#x1F1E7`, name: `Barbados`},
                                            {emoji: `&#x1F1E7&#x1F1E9`, name: `Bangladesh`},
                                            {emoji: `&#x1F1E7&#x1F1EA`, name: `Belgium`},
                                            {emoji: `&#x1F1E7&#x1F1EB`, name: `Burkina Faso`},
                                            {emoji: `&#x1F1E7&#x1F1EC`, name: `Bulgaria`},
                                            {emoji: `&#x1F1E7&#x1F1ED`, name: `Bahrain`},
                                            {emoji: `&#x1F1E7&#x1F1EE`, name: `Burundi`},
                                            {emoji: `&#x1F1E7&#x1F1EF`, name: `Benin`},
                                            {emoji: `&#x1F1E7&#x1F1F1`, name: `St. Barthlemy`},
                                            {emoji: `&#x1F1E7&#x1F1F2`, name: `Bermuda`},
                                            {emoji: `&#x1F1E7&#x1F1F3`, name: `Brunei`},
                                            {emoji: `&#x1F1E7&#x1F1F4`, name: `Bolivia`},
                                            {emoji: `&#x1F1E7&#x1F1F6`, name: `Caribbean Netherlands`},
                                            {emoji: `&#x1F1E7&#x1F1F7`, name: `Brazil`},
                                            {emoji: `&#x1F1E7&#x1F1F8`, name: `Bahamas`},
                                            {emoji: `&#x1F1E7&#x1F1F9`, name: `Bhutan`},
                                            {emoji: `&#x1F1E7&#x1F1FB`, name: `Bouvet Island`},
                                            {emoji: `&#x1F1E7&#x1F1FC`, name: `Botswana`},
                                            {emoji: `&#x1F1E7&#x1F1FE`, name: `Belarus`},
                                            {emoji: `&#x1F1E7&#x1F1FF`, name: `Belize`},
                                            {emoji: `&#x1F1E8&#x1F1E6`, name: `Canada`},
                                            {emoji: `&#x1F1E8&#x1F1E8`, name: `Cocos (Keeling) Islands`},
                                            {emoji: `&#x1F1E8&#x1F1E9`, name: `Congo - Kinshasa`},
                                            {emoji: `&#x1F1E8&#x1F1EB`, name: `Central African Republic`},
                                            {emoji: `&#x1F1E8&#x1F1EC`, name: `Congo - Brazzaville`},
                                            {emoji: `&#x1F1E8&#x1F1ED`, name: `Switzerland`},
                                            {emoji: `&#x1F1E8&#x1F1EE`, name: `Cte DIvoire`},
                                            {emoji: `&#x1F1E8&#x1F1F0`, name: `Cook Islands`},
                                            {emoji: `&#x1F1E8&#x1F1F1`, name: `Chile`},
                                            {emoji: `&#x1F1E8&#x1F1F2`, name: `Cameroon`},
                                            {emoji: `&#x1F1E8&#x1F1F3`, name: `China`},
                                            {emoji: `&#x1F1E8&#x1F1F4`, name: `Colombia`},
                                            {emoji: `&#x1F1E8&#x1F1F5`, name: `Clipperton Island`},
                                            {emoji: `&#x1F1E8&#x1F1F7`, name: `Costa Rica`},
                                            {emoji: `&#x1F1E8&#x1F1FA`, name: `Cuba`},
                                            {emoji: `&#x1F1E8&#x1F1FB`, name: `Cape Verde`},
                                            {emoji: `&#x1F1E8&#x1F1FC`, name: `Curaao`},
                                            {emoji: `&#x1F1E8&#x1F1FD`, name: `Christmas Island`},
                                            {emoji: `&#x1F1E8&#x1F1FE`, name: `Cyprus`},
                                            {emoji: `&#x1F1E8&#x1F1FF`, name: `Czech Republic`},
                                            {emoji: `&#x1F1E9&#x1F1EA`, name: `Germany`},
                                            {emoji: `&#x1F1E9&#x1F1EC`, name: `Diego Garcia`},
                                            {emoji: `&#x1F1E9&#x1F1EF`, name: `Djibouti`},
                                            {emoji: `&#x1F1E9&#x1F1F0`, name: `Denmark`},
                                            {emoji: `&#x1F1E9&#x1F1F2`, name: `Dominica`},
                                            {emoji: `&#x1F1E9&#x1F1F4`, name: `Dominican Republic`},
                                            {emoji: `&#x1F1E9&#x1F1FF`, name: `Algeria`},
                                            {emoji: `&#x1F1EA&#x1F1E6`, name: `Ceuta & Melilla`},
                                            {emoji: `&#x1F1EA&#x1F1E8`, name: `Ecuador`},
                                            {emoji: `&#x1F1EA&#x1F1EA`, name: `Estonia`},
                                            {emoji: `&#x1F1EA&#x1F1EC`, name: `Egypt`},
                                            {emoji: `&#x1F1EA&#x1F1ED`, name: `Western Sahara`},
                                            {emoji: `&#x1F1EA&#x1F1F7`, name: `Eritrea`},
                                            {emoji: `&#x1F1EA&#x1F1F8`, name: `Spain`},
                                            {emoji: `&#x1F1EA&#x1F1F9`, name: `Ethiopia`},
                                            {emoji: `&#x1F1EA&#x1F1FA`, name: `European Union`},
                                            {emoji: `&#x1F1EB&#x1F1EE`, name: `Finland`},
                                            {emoji: `&#x1F1EB&#x1F1EF`, name: `Fiji`},
                                            {emoji: `&#x1F1EB&#x1F1F0`, name: `Falkland Islands`},
                                            {emoji: `&#x1F1EB&#x1F1F2`, name: `Micronesia`},
                                            {emoji: `&#x1F1EB&#x1F1F4`, name: `Faroe Islands`},
                                            {emoji: `&#x1F1EB&#x1F1F7`, name: `France`},
                                            {emoji: `&#x1F1EC&#x1F1E6`, name: `Gabon`},
                                            {emoji: `&#x1F1EC&#x1F1E7`, name: `United Kingdom`},
                                            {emoji: `&#x1F1EC&#x1F1E9`, name: `Grenada`},
                                            {emoji: `&#x1F1EC&#x1F1EA`, name: `Georgia`},
                                            {emoji: `&#x1F1EC&#x1F1EB`, name: `French Guiana`},
                                            {emoji: `&#x1F1EC&#x1F1EC`, name: `Guernsey`},
                                            {emoji: `&#x1F1EC&#x1F1ED`, name: `Ghana`},
                                            {emoji: `&#x1F1EC&#x1F1EE`, name: `Gibraltar`},
                                            {emoji: `&#x1F1EC&#x1F1F1`, name: `Greenland`},
                                            {emoji: `&#x1F1EC&#x1F1F2`, name: `Gambia`},
                                            {emoji: `&#x1F1EC&#x1F1F3`, name: `Guinea`},
                                            {emoji: `&#x1F1EC&#x1F1F5`, name: `Guadeloupe`},
                                            {emoji: `&#x1F1EC&#x1F1F6`, name: `Equatorial Guinea`},
                                            {emoji: `&#x1F1EC&#x1F1F7`, name: `Greece`},
                                            {emoji: `&#x1F1EC&#x1F1F8`, name: `South Georgia & South Sandwich Islands`},
                                            {emoji: `&#x1F1EC&#x1F1F9`, name: `Guatemala`},
                                            {emoji: `&#x1F1EC&#x1F1FA`, name: `Guam`},
                                            {emoji: `&#x1F1EC&#x1F1FC`, name: `Guinea-Bissau`},
                                            {emoji: `&#x1F1EC&#x1F1FE`, name: `Guyana`},
                                            {emoji: `&#x1F1ED&#x1F1F0`, name: `Hong Kong SAR China`},
                                            {emoji: `&#x1F1ED&#x1F1F2`, name: `Heard & McDonald Islands`},
                                            {emoji: `&#x1F1ED&#x1F1F3`, name: `Honduras`},
                                            {emoji: `&#x1F1ED&#x1F1F7`, name: `Croatia`},
                                            {emoji: `&#x1F1ED&#x1F1F9`, name: `Haiti`},
                                            {emoji: `&#x1F1ED&#x1F1FA`, name: `Hungary`},
                                            {emoji: `&#x1F1EE&#x1F1E8`, name: `Canary Islands`},
                                            {emoji: `&#x1F1EE&#x1F1E9`, name: `Indonesia`},
                                            {emoji: `&#x1F1EE&#x1F1EA`, name: `Ireland`},
                                            {emoji: `&#x1F1EE&#x1F1F1`, name: `Israel`},
                                            {emoji: `&#x1F1EE&#x1F1F2`, name: `Isle Of Man`},
                                            {emoji: `&#x1F1EE&#x1F1F3`, name: `India`},
                                            {emoji: `&#x1F1EE&#x1F1F4`, name: `British Indian Ocean Territory`},
                                            {emoji: `&#x1F1EE&#x1F1F6`, name: `Iraq`},
                                            {emoji: `&#x1F1EE&#x1F1F7`, name: `Iran`},
                                            {emoji: `&#x1F1EE&#x1F1F8`, name: `Iceland`},
                                            {emoji: `&#x1F1EE&#x1F1F9`, name: `Italy`},
                                            {emoji: `&#x1F1EF&#x1F1EA`, name: `Jersey`},
                                            {emoji: `&#x1F1EF&#x1F1F2`, name: `Jamaica`},
                                            {emoji: `&#x1F1EF&#x1F1F4`, name: `Jordan`},
                                            {emoji: `&#x1F1EF&#x1F1F5`, name: `Japan`},
                                            {emoji: `&#x1F1F0&#x1F1EA`, name: `Kenya`},
                                            {emoji: `&#x1F1F0&#x1F1EC`, name: `Kyrgyzstan`},
                                            {emoji: `&#x1F1F0&#x1F1ED`, name: `Cambodia`},
                                            {emoji: `&#x1F1F0&#x1F1EE`, name: `Kiribati`},
                                            {emoji: `&#x1F1F0&#x1F1F2`, name: `Comoros`},
                                            {emoji: `&#x1F1F0&#x1F1F3`, name: `St. Kitts & Nevis`},
                                            {emoji: `&#x1F1F0&#x1F1F5`, name: `North Korea`},
                                            {emoji: `&#x1F1F0&#x1F1F7`, name: `South Korea`},
                                            {emoji: `&#x1F1F0&#x1F1FC`, name: `Kuwait`},
                                            {emoji: `&#x1F1F0&#x1F1FE`, name: `Cayman Islands`},
                                            {emoji: `&#x1F1F0&#x1F1FF`, name: `Kazakhstan`},
                                            {emoji: `&#x1F1F1&#x1F1E6`, name: `Laos`},
                                            {emoji: `&#x1F1F1&#x1F1E7`, name: `Lebanon`},
                                            {emoji: `&#x1F1F1&#x1F1E8`, name: `St. Lucia`},
                                            {emoji: `&#x1F1F1&#x1F1EE`, name: `Liechtenstein`},
                                            {emoji: `&#x1F1F1&#x1F1F0`, name: `Sri Lanka`},
                                            {emoji: `&#x1F1F1&#x1F1F7`, name: `Liberia`},
                                            {emoji: `&#x1F1F1&#x1F1F8`, name: `Lesotho`},
                                            {emoji: `&#x1F1F1&#x1F1F9`, name: `Lithuania`},
                                            {emoji: `&#x1F1F1&#x1F1FA`, name: `Luxembourg`},
                                            {emoji: `&#x1F1F1&#x1F1FB`, name: `Latvia`},
                                            {emoji: `&#x1F1F1&#x1F1FE`, name: `Libya`},
                                            {emoji: `&#x1F1F2&#x1F1E6`, name: `Morocco`},
                                            {emoji: `&#x1F1F2&#x1F1E8`, name: `Monaco`},
                                            {emoji: `&#x1F1F2&#x1F1E9`, name: `Moldova`},
                                            {emoji: `&#x1F1F2&#x1F1EA`, name: `Montenegro`},
                                            {emoji: `&#x1F1F2&#x1F1EB`, name: `St. Martin`},
                                            {emoji: `&#x1F1F2&#x1F1EC`, name: `Madagascar`},
                                            {emoji: `&#x1F1F2&#x1F1ED`, name: `Marshall Islands`},
                                            {emoji: `&#x1F1F2&#x1F1F0`, name: `Macedonia`},
                                            {emoji: `&#x1F1F2&#x1F1F1`, name: `Mali`},
                                            {emoji: `&#x1F1F2&#x1F1F2`, name: `Myanmar (Burma)`},
                                            {emoji: `&#x1F1F2&#x1F1F3`, name: `Mongolia`},
                                            {emoji: `&#x1F1F2&#x1F1F4`, name: `Macau SAR China`},
                                            {emoji: `&#x1F1F2&#x1F1F5`, name: `Northern Mariana Islands`},
                                            {emoji: `&#x1F1F2&#x1F1F6`, name: `Martinique`},
                                            {emoji: `&#x1F1F2&#x1F1F7`, name: `Mauritania`},
                                            {emoji: `&#x1F1F2&#x1F1F8`, name: `Montserrat`},
                                            {emoji: `&#x1F1F2&#x1F1F9`, name: `Malta`},
                                            {emoji: `&#x1F1F2&#x1F1FA`, name: `Mauritius`},
                                            {emoji: `&#x1F1F2&#x1F1FB`, name: `Maldives`},
                                            {emoji: `&#x1F1F2&#x1F1FC`, name: `Malawi`},
                                            {emoji: `&#x1F1F2&#x1F1FD`, name: `Mexico`},
                                            {emoji: `&#x1F1F2&#x1F1FE`, name: `Malaysia`},
                                            {emoji: `&#x1F1F2&#x1F1FF`, name: `Mozambique`},
                                            {emoji: `&#x1F1F3&#x1F1E6`, name: `Namibia`},
                                            {emoji: `&#x1F1F3&#x1F1E8`, name: `New Caledonia`},
                                            {emoji: `&#x1F1F3&#x1F1EA`, name: `Niger`},
                                            {emoji: `&#x1F1F3&#x1F1EB`, name: `Norfolk Island`},
                                            {emoji: `&#x1F1F3&#x1F1EC`, name: `Nigeria`},
                                            {emoji: `&#x1F1F3&#x1F1EE`, name: `Nicaragua`},
                                            {emoji: `&#x1F1F3&#x1F1F1`, name: `Netherlands`},
                                            {emoji: `&#x1F1F3&#x1F1F4`, name: `Norway`},
                                            {emoji: `&#x1F1F3&#x1F1F5`, name: `Nepal`},
                                            {emoji: `&#x1F1F3&#x1F1F7`, name: `Nauru`},
                                            {emoji: `&#x1F1F3&#x1F1FA`, name: `Niue`},
                                            {emoji: `&#x1F1F3&#x1F1FF`, name: `New Zealand`},
                                            {emoji: `&#x1F1F4&#x1F1F2`, name: `Oman`},
                                            {emoji: `&#x1F1F5&#x1F1E6`, name: `Panama`},
                                            {emoji: `&#x1F1F5&#x1F1EA`, name: `Peru`},
                                            {emoji: `&#x1F1F5&#x1F1EB`, name: `French Polynesia`},
                                            {emoji: `&#x1F1F5&#x1F1EC`, name: `Papua New Guinea`},
                                            {emoji: `&#x1F1F5&#x1F1ED`, name: `Philippines`},
                                            {emoji: `&#x1F1F5&#x1F1F0`, name: `Pakistan`},
                                            {emoji: `&#x1F1F5&#x1F1F1`, name: `Poland`},
                                            {emoji: `&#x1F1F5&#x1F1F2`, name: `St. Pierre & Miquelon`},
                                            {emoji: `&#x1F1F5&#x1F1F3`, name: `Pitcairn Islands`},
                                            {emoji: `&#x1F1F5&#x1F1F7`, name: `Puerto Rico`},
                                            {emoji: `&#x1F1F5&#x1F1F8`, name: `Palestinian Territories`},
                                            {emoji: `&#x1F1F5&#x1F1F9`, name: `Portugal`},
                                            {emoji: `&#x1F1F5&#x1F1FC`, name: `Palau`},
                                            {emoji: `&#x1F1F5&#x1F1FE`, name: `Paraguay`},
                                            {emoji: `&#x1F1F6&#x1F1E6`, name: `Qatar`},
                                            {emoji: `&#x1F1F7&#x1F1EA`, name: `Runion`},
                                            {emoji: `&#x1F1F7&#x1F1F4`, name: `Romania`},
                                            {emoji: `&#x1F1F7&#x1F1F8`, name: `Serbia`},
                                            {emoji: `&#x1F1F7&#x1F1FA`, name: `Russia`},
                                            {emoji: `&#x1F1F7&#x1F1FC`, name: `Rwanda`},
                                            {emoji: `&#x1F1F8&#x1F1E6`, name: `Saudi Arabia`},
                                            {emoji: `&#x1F1F8&#x1F1E7`, name: `Solomon Islands`},
                                            {emoji: `&#x1F1F8&#x1F1E8`, name: `Seychelles`},
                                            {emoji: `&#x1F1F8&#x1F1E9`, name: `Sudan`},
                                            {emoji: `&#x1F1F8&#x1F1EA`, name: `Sweden`},
                                            {emoji: `&#x1F1F8&#x1F1EC`, name: `Singapore`},
                                            {emoji: `&#x1F1F8&#x1F1ED`, name: `St. Helena`},
                                            {emoji: `&#x1F1F8&#x1F1EE`, name: `Slovenia`},
                                            {emoji: `&#x1F1F8&#x1F1EF`, name: `Svalbard & Jan Mayen`},
                                            {emoji: `&#x1F1F8&#x1F1F0`, name: `Slovakia`},
                                            {emoji: `&#x1F1F8&#x1F1F1`, name: `Sierra Leone`},
                                            {emoji: `&#x1F1F8&#x1F1F2`, name: `San Marino`},
                                            {emoji: `&#x1F1F8&#x1F1F3`, name: `Senegal`},
                                            {emoji: `&#x1F1F8&#x1F1F4`, name: `Somalia`},
                                            {emoji: `&#x1F1F8&#x1F1F7`, name: `Suriname`},
                                            {emoji: `&#x1F1F8&#x1F1F8`, name: `South Sudan`},
                                            {emoji: `&#x1F1F8&#x1F1F9`, name: `So Tom & Prncipe`},
                                            {emoji: `&#x1F1F8&#x1F1FB`, name: `El Salvador`},
                                            {emoji: `&#x1F1F8&#x1F1FD`, name: `Sint Maarten`},
                                            {emoji: `&#x1F1F8&#x1F1FE`, name: `Syria`},
                                            {emoji: `&#x1F1F8&#x1F1FF`, name: `Swaziland`},
                                            {emoji: `&#x1F1F9&#x1F1E6`, name: `Tristan Da Cunha`},
                                            {emoji: `&#x1F1F9&#x1F1E8`, name: `Turks & Caicos Islands`},
                                            {emoji: `&#x1F1F9&#x1F1E9`, name: `Chad`},
                                            {emoji: `&#x1F1F9&#x1F1EB`, name: `French Southern Territories`},
                                            {emoji: `&#x1F1F9&#x1F1EC`, name: `Togo`},
                                            {emoji: `&#x1F1F9&#x1F1ED`, name: `Thailand`},
                                            {emoji: `&#x1F1F9&#x1F1EF`, name: `Tajikistan`},
                                            {emoji: `&#x1F1F9&#x1F1F0`, name: `Tokelau`},
                                            {emoji: `&#x1F1F9&#x1F1F1`, name: `Timor-Leste`},
                                            {emoji: `&#x1F1F9&#x1F1F2`, name: `Turkmenistan`},
                                            {emoji: `&#x1F1F9&#x1F1F3`, name: `Tunisia`},
                                            {emoji: `&#x1F1F9&#x1F1F4`, name: `Tonga`},
                                            {emoji: `&#x1F1F9&#x1F1F7`, name: `Turkey`},
                                            {emoji: `&#x1F1F9&#x1F1F9`, name: `Trinidad & Tobago`},
                                            {emoji: `&#x1F1F9&#x1F1FB`, name: `Tuvalu`},
                                            {emoji: `&#x1F1F9&#x1F1FC`, name: `Taiwan`},
                                            {emoji: `&#x1F1F9&#x1F1FF`, name: `Tanzania`},
                                            {emoji: `&#x1F1FA&#x1F1E6`, name: `Ukraine`},
                                            {emoji: `&#x1F1FA&#x1F1EC`, name: `Uganda`},
                                            {emoji: `&#x1F1FA&#x1F1F2`, name: `U.S. Outlying Islands`},
                                            {emoji: `&#x1F1FA&#x1F1F3`, name: `United Nations`},
                                            {emoji: `&#x1F1FA&#x1F1F8`, name: `United States`},
                                            {emoji: `&#x1F1FA&#x1F1FE`, name: `Uruguay`},
                                            {emoji: `&#x1F1FA&#x1F1FF`, name: `Uzbekistan`},
                                            {emoji: `&#x1F1FB&#x1F1E6`, name: `Vatican City`},
                                            {emoji: `&#x1F1FB&#x1F1E8`, name: `St. Vincent & Grenadines`},
                                            {emoji: `&#x1F1FB&#x1F1EA`, name: `Venezuela`},
                                            {emoji: `&#x1F1FB&#x1F1EC`, name: `British Virgin Islands`},
                                            {emoji: `&#x1F1FB&#x1F1EE`, name: `U.S. Virgin Islands`},
                                            {emoji: `&#x1F1FB&#x1F1F3`, name: `Vietnam`},
                                            {emoji: `&#x1F1FB&#x1F1FA`, name: `Vanuatu`},
                                            {emoji: `&#x1F1FC&#x1F1EB`, name: `Wallis & Futuna`},
                                            {emoji: `&#x1F1FC&#x1F1F8`, name: `Samoa`},
                                            {emoji: `&#x1F1FD&#x1F1F0`, name: `Kosovo`},
                                            {emoji: `&#x1F1FE&#x1F1EA`, name: `Yemen`},
                                            {emoji: `&#x1F1FE&#x1F1F9`, name: `Mayotte`},
                                            {emoji: `&#x1F1FF&#x1F1E6`, name: `South Africa`},
                                            {emoji: `&#x1F1FF&#x1F1F2`, name: `Zambia`}
                                        ].forEach(emoji => {
                                            emojis.insertAdjacentHTML(`beforeEnd`, `<span data-id="${emoji.emoji}" draggable="true" title="${emoji.name}">${emoji.emoji}</span>`);
                                            emojis.lastElementChild.addEventListener(`dragstart`, event => {
                                                event.dataTransfer.setData(`text`, event.currentTarget.getAttribute(`data-id`));
                                            });
                                        });
                                        filter.addEventListener(`input`, () => {
                                            if (filter.value) {
                                                for (i = emojis.children.length - 1; i > -1; --i) {
                                                    emoji = emojis.children[i];
                                                    if (emoji.getAttribute(`title`).toLowerCase().match(filter.value)) {
                                                        emoji.classList.remove(`esgst-hidden`);
                                                    } else {
                                                        emoji.classList.add(`esgst-hidden`);
                                                    }
                                                }
                                            } else {
                                                for (i = emojis.children.length - 1; i > -1; --i) {
                                                    emojis.children[i].classList.remove(`esgst-hidden`);
                                                }
                                            }
                                        });
                                        savedEmojis = emojis.nextElementSibling.nextElementSibling;
                                        for (i = savedEmojis.children.length - 1; i > -1; --i) {
                                            savedEmojis.children[i].addEventListener(`click`, event => {
                                                event.currentTarget.remove();
                                                setValue(`emojis`, savedEmojis.innerHTML);
                                            });
                                        }
                                        savedEmojis.addEventListener(`dragover`, event => {
                                            event.preventDefault();
                                        });
                                        savedEmojis.addEventListener(`drop`, event => {
                                            event.preventDefault();
                                            let id = event.dataTransfer.getData(`text`).replace(/\\/g, `\\\\`);
                                            if (!savedEmojis.querySelector(`[data-id="${id}"]`)) {
                                                savedEmojis.appendChild(document.querySelector(`[data-id="${id}"]`).cloneNode(true));
                                                setValue(`emojis`, savedEmojis.innerHTML);
                                                savedEmojis.lastElementChild.addEventListener(`click`, event => {
                                                    event.currentTarget.remove();
                                                    setValue(`emojis`, savedEmojis.innerHTML);
                                                });
                                            }
                                        });
                                        popup.open(() => {
                                            popout.popout.classList.add(`esgst-hidden`);
                                        });
                                    });
                                }
                            });
                        });
                    },
                    callback: popout => {
                        let emojis = popout.firstElementChild;
                        getValue(`emojis`, ``).then(value => {
                            emojis.innerHTML = value;
                            setCfhEmojis(emojis);
                        });
                    }
                },
                {
                    id: `cfh_g`,
                    icons: [`fa-star`],
                    name: `Giveaway Encrypter`,
                    setPopout: popout => {
                        popout.popout.innerHTML = `
                            Giveaway Code: <input placeholder="XXXXX" type="text"/>
                            <div class="form__saving-button btn_action white">Add</div>
                        `;
                        let code = popout.popout.firstElementChild;
                        code.nextElementSibling.addEventListener(`click`, () => {
                            if (code.value.match(/^[\d\w]{5}$/)) {
                                let encodedCode = encryptGedCode(code.value);
                                formatCfhLink(``, `ESGST-${encodedCode}`);
                                code.value = ``;
                                popout.close();
                            } else {
                                alert(`Wrong format. The right format is XXXXX.`);
                            }
                        });
                    },
                    callback: popout => {
                        let code = popout.firstElementChild;
                        code.value = esgst.cfh.textArea.value.slice(esgst.cfh.textArea.selectionStart, esgst.cfh.textArea.selectionEnd);
                        code.focus();
                    }
                },
                {
                    id: `cfh_sr`,
                    icons: [`fa-floppy-o`],
                    name: `Saved Replies`,
                    setPopout: function (popout) {
                        let addBUtton, filter, i, n, replies, savedReplies;
                        esgst.cfh.deletedReplies = [];
                        getValue(`savedReplies`, `[]`).then(value => {
                            savedReplies = JSON.parse(value);
                            popout.popout.innerHTML = `
                                <div>
                                    <input placeholder="Filter replies..." type="text"/>
                                </div>
                                <div class="esgst-cfh-sr-container"></div>
                                <div class="form__saving-button btn_action white">Add New Reply</div>
                                <div class="esgst-clickable esgst-hidden">
                                    <i class="fa fa-rotate-left"></i>
                                    <span>Undo Delete</span>
                                </div>
                            `;
                            filter = popout.popout.firstElementChild.firstElementChild;
                            esgst.cfh.undoDelete = popout.popout.lastElementChild;
                            addButton = esgst.cfh.undoDelete.previousElementSibling;
                            replies = addButton.previousElementSibling;
                            for (i = 0, n = savedReplies.length; i < n; ++i) {
                                setCfhReply(replies, savedReplies[i]);
                            }
                            filter.addEventListener(`input`, filterCfhReplies.bind(null, replies));
                            esgst.cfh.undoDelete.addEventListener(`click`, undoCfhDelete);
                            addButton.addEventListener(`click`, openCfhReplyPopup.bind(null, null, null, replies, null));
                        });
                    },
                    callback: popout => {
                        popout.firstElementChild.firstElementChild.focus();
                    }
                }, {
                    icons: [`fa-paste`],
                    name: `Automatic Links / Images Paste Formatting: OFF`,
                    callback: context => {
                        esgst.cfh.alipf = context.firstElementChild;
                        setCfhAlipf(esgst.cfh_pasteFormatting);
                    },
                    onClick: setCfhAlipf
                }, {
                    icons: [`fa-rotate-left`],
                    name: `Undo Formatting`,
                    callback: context => {
                        esgst.cfh.undo = context.firstElementChild;
                        esgst.cfh.undo.classList.add(`esgst-faded`);
                    },
                    onClick: () => {
                        let end, value;
                        if (esgst.cfh.history.length) {
                            redoCfhFormatting(esgst.cfh.textArea, esgst.cfh.textArea.value);
                            value = esgst.cfh.history.pop();
                            end = esgst.cfh.textArea.selectionEnd - (esgst.cfh.textArea.value.length - value.length);
                            esgst.cfh.textArea.value = value;
                            esgst.cfh.textArea.setSelectionRange(end, end);
                            if (!esgst.cfh.history.length) {
                                esgst.cfh.undo.classList.add(`esgst-faded`);
                            }
                            esgst.cfh.textArea.focus();
                        }
                    }
                }, {
                    icons: [`fa-rotate-right`],
                    name: `Redo Formatting`,
                    callback: context => {
                        esgst.cfh.redo = context.firstElementChild;
                        esgst.cfh.redo.classList.add(`esgst-faded`);
                    },
                    onClick: () => {
                        let end, value;
                        if (esgst.cfh.backup.length) {
                            undoCfhFormatting(esgst.cfh.textArea, esgst.cfh.textArea.value);
                            value = esgst.cfh.backup.pop();
                            end = esgst.cfh.textArea.selectionEnd + (value.length - esgst.cfh.textArea.value.length);
                            esgst.cfh.textArea.value = value;
                            esgst.cfh.textArea.setSelectionRange(end, end);
                            if (!esgst.cfh.backup.length) {
                                esgst.cfh.redo.classList.add(`esgst-faded`);
                            }
                            esgst.cfh.textArea.focus();
                        }
                    }
                }
            ].forEach(item => {
                if (!item.id || esgst[item.id]) {
                    let button = insertHtml(esgst.cfh.panel, `beforeEnd`, `<div title="${item.name}"></div>`);
                    item.icons.forEach(icon => {
                        button.insertAdjacentHTML(`beforeEnd`, `<i class="fa ${icon}"></i>`);
                    });
                    if (item.text) {
                        button.insertAdjacentText(`beforeEnd`, item.text);
                    }
                    if (item.setPopout) {
                        item.setPopout(new Popout(`esgst-cfh-popout`, button, 0, true, null, item.callback));
                    } else if (item.setPopup) {
                        let popup;
                        button.addEventListener(`click`, () => {
                            if (popup) {
                                popup.open();
                            } else {
                                popup = new Popup(`fa-table`, `Add a table:`);
                                item.setPopup(popup);
                                popup.open();
                            }
                        })
                    } else {
                        if (item.callback) {
                            item.callback(button);
                        }
                        button.addEventListener(`click`, () => {
                            if (item.onClick) {
                                item.onClick();
                            } else {
                                formatCfhItem(item.prefix, item.suffix, item.multiline);
                            }
                        });
                    }
                }
            });
            if (esgst.cfh_cf) {
                esgst.cfh.panel.insertAdjacentHTML(`beforeEnd`, `
                    <a href="/about/comment-formatting" title="Comment Formatting">
                        <i class="fa fa-question-circle"></i>
                    </a>
                `);
            }
            if (esgst.cfh_p && !esgst.cfh_p_a) {
                insertHtml(esgst.cfh.panel, `beforeEnd`, `
                    <div title="Preview">
                        <i class="fa fa-eye"></i>
                    </div>
                `).addEventListener(`click`, () => {
                    esgst.cfh.preview.innerHTML = parseMarkdown(esgst.cfh.textArea.value);
                    formatCfhImages(esgst.cfh.preview);
                });
            }
            esgst.cfh.preview.className = `esgst-cfh-preview markdown`;
            esgst.endlessFeatures.push(setCfhTextAreas);
            setCfhTextAreas(document);
        }

        if (esgst.df) {
            if (esgst.df_m && esgst.discussionsPath && !esgst.editDiscussionPath) {
                if (esgst.hideButtons && esgst.hideButtons_df) {
                    if (esgst.leftButtonIds.indexOf(`df`) > -1) {
                        esgst.leftButtons.insertBefore(addDfContainer(esgst.mainPageHeading), esgst.leftButtons.firstElementChild);
                    } else {
                        esgst.rightButtons.appendChild(addDfContainer(esgst.mainPageHeading));
                    }
                } else {
                    esgst.mainPageHeading.insertBefore(addDfContainer(esgst.mainPageHeading), esgst.mainPageHeading.firstElementChild);
                }
            }
        }

        new Promise((resolve, reject) => {
            if (esgst.giveawaysPath || esgst.discussionsPath) {
                if (esgst.giveawaysPath) {
                    if (esgst.ags && (!esgst.qgs || !esgst.qgs_h)) {
                        addAgsPanel(document.getElementsByClassName(`sidebar__search-container`)[0]);
                    }
                }

                // needs to run before Avatar Popout
                esgst.endlessFeatures.push(loadDiscussionFeatures);
                loadDiscussionFeatures(document, true).then(resolve);
            } else {
                resolve();
            }
        }).then(() => {
            if (esgst.whitelistPath || esgst.blacklistPath) {
                if (esgst.wbs) {
                    let button2, button1, dateKey, saveKey;
                    let key, position;
                    if (esgst.leftButtonIds.indexOf(`wbsDesc`) > -1) {
                        key = `leftButtons`;
                        position = `afterBegin`;
                    } else {
                        key = `rightButtons`;
                        position = `beforeEnd`;
                    }
                    button2 = insertHtml(esgst.hideButtons && esgst.hideButtons_wbsDesc ? esgst[key] : esgst.mainPageHeading, position, `
                        <div class="esgst-heading-button" id="esgst-wbsDesc" title="Sort by added date from newest to oldest">
                            <i class="fa fa-sort-amount-desc"></i>
                        </div>
                    `);
                    if (esgst.leftButtonIds.indexOf(`wbsAsc`) > -1) {
                        key = `leftButtons`;
                        position = `afterBegin`;
                    } else {
                        key = `rightButtons`;
                        position = `beforeEnd`;
                    }
                    button1 = insertHtml(esgst.hideButtons && esgst.hideButtons_wbsAsc ? esgst[key] : esgst.mainPageHeading, position, `
                        <div class="esgst-heading-button" id="esgst-wbsAsc" title="Sort by added date from oldest to newest">
                            <i class="fa fa-sort-amount-asc"></i>
                        </div>
                    `);
                    if (esgst.whitelistPath) {
                        dateKey = `whitelistedDate`;
                        key = `whitelist`;
                        saveKey = `whitelisted`;
                    } else {
                        dateKey = `blacklistedDate`;
                        key = `blacklist`;
                        saveKey = `blacklisted`;
                    }
                    addWbsButton(dateKey, key, saveKey, button1, button2);
                }
                if (esgst.wbm) {
                    let wbm = {};
                    if (esgst.whitelistPath) {
                        wbm.key = `whitelist`;
                        wbm.name = `Whitelist`;
                    } else {
                        wbm.key = `blacklist`;
                        wbm.name = `Blacklist`;
                    }
                    let key, position;
                    if (esgst.leftButtonIds.indexOf(`wbm`) > -1) {
                        key = `leftButtons`;
                        position = `afterBegin`;
                    } else {
                        key = `rightButtons`;
                        position = `beforeEnd`;
                    }
                    wbm.button = insertHtml(esgst.hideButtons && esgst.hideButtons_wbm ? esgst[key] : esgst.mainPageHeading, position, `
                        <div class="esgst-heading-button" id="esgst-wbm" title="Manage ${wbm.key}">
                            <i class="fa fa-arrow-up"></i>
                            <i class="fa fa-arrow-down"></i>
                            <i class="fa fa-trash"></i>
                        </div>
                    `);
                    wbm.button.addEventListener(`click`, openWbmPopup.bind(null, wbm));
                }
                if (esgst.us) {
                    esgst.endlessFeatures.push(getUsUsers);
                    getUsUsers(document, true);
                }
            }

            if (esgst.ttec) {
                esgst.giveawayFeatures.push(calculateTtecTime);
            }

            if (esgst.giveawayPath && esgst.mainPageHeading) {
                if (esgst.cec) {
                    let key, position;
                    if (esgst.leftButtonIds.indexOf(`cec`) > -1) {
                        key = `leftButtons`;
                        position = `afterBegin`;
                    } else {
                        key = `rightButtons`;
                        position = `beforeEnd`;
                    }
                    button = insertHtml(esgst.hideButtons && esgst.hideButtons_cec ? esgst[key] : esgst.mainPageHeading, position, `
                        <div class="esgst-heading-button" id="esgst-cec" title="Check comments/entries">
                            <i class="fa fa-comments"></i>
                            <i class="fa fa-ticket"></i>
                            <i class="fa fa-question-circle"></i>
                        </div>
                    `);
                    button.addEventListener(`click`, openCecPopup.bind(null, {button}));
                }
            }

            if (esgst.sk) {
                loadSk();
            }

            if (esgst.smgb) {
                loadSmgb();
            }

            if (esgst.ail || esgst.vai || esgst.aic) {
                esgst.endlessFeatures.push(getAttachedImages);
                getAttachedImages(document);
                if (esgst.aic) {
                    document.addEventListener(`keydown`, event => {
                        if (event.key === `ArrowLeft` && esgst.aicPrevious) {
                            esgst.aicPrevious.click();
                        }
                        if (event.key === `ArrowRight` && esgst.aicNext) {
                            esgst.aicNext.click();
                        }
                    });
                }
            }

            if (esgst.ev) {
                esgst.endlessFeatures.push(getEvVideos);
                getEvVideos(document);
            }

            if (esgst.at && (!esgst.giveawaysPath || esgst.at_g)) {
                esgst.endlessFeatures.push(getTimestamps);
                getTimestamps(document);
            }

            if (esgst.hbs) {
                loadHbs();
            }

            if (esgst.gdttt) {
                loadGdttt();
            }

            if (esgst.gas) {
                loadGas();
            }

            if (esgst.gv) {
                loadGv();
            }

            if (esgst.gf) {
                if (esgst.gf_s) {
                    esgst.giveawayFeatures.push(getGfGiveaways);
                }
                if (esgst.gf_m && (esgst.giveawaysPath || esgst.createdPath || esgst.enteredPath || esgst.wonPath || esgst.groupPath || esgst.userPath)) {
                    if (esgst.hideButtons && esgst.hideButtons_gf) {
                        if (esgst.leftButtonIds.indexOf(`gf`) > -1) {
                            esgst.leftButtons.insertBefore(addGfContainer(esgst.mainPageHeading), esgst.leftButtons.firstElementChild);
                        } else {
                            esgst.rightButtons.appendChild(addGfContainer(esgst.mainPageHeading));
                        }
                    } else {
                        esgst.mainPageHeading.insertBefore(addGfContainer(esgst.mainPageHeading), esgst.mainPageHeading.firstElementChild);
                    }
                }
            }

            if (esgst.pgb) {
                loadPgb();
            }

            if (esgst.ueg) {
                esgst.endlessFeatures.push(removeUegFade);
                removeUegFade(document);
            }

            if (esgst.gb) {
                esgst.giveawayFeatures.push(getGbGiveaways);
                addGbButton();
            }

            if (esgst.sg && esgst.ged) {
                loadGed();
            }

            if (esgst.ugb) {
                esgst.giveawayFeatures.push(addUgbButtons);
            }

            if (esgst.ochgb) {
                esgst.giveawayFeatures.push(setOchgbButtons);
            }

            if (esgst.gwc || esgst.gwr) {
                if (esgst.gwc) {
                    esgst.giveawayFeatures.push(addGwcChances);
                }
                if (esgst.gwr) {
                    esgst.giveawayFeatures.push(addGwrRatios);
                }
                if (esgst.enteredPath) {
                    esgst.endlessFeatures.push(addGwcrHeading);
                    addGwcrHeading(document, true);
                }
            }

            if (esgst.cewgd && (esgst.createdPath || esgst.enteredPath || esgst.wonPath)) {
                esgst.giveawayFeatures.push(getCewgdDetails);
                esgst.endlessFeatures.push(addCewgdHeading);
                addCewgdHeading(document, true);
            }

            if (esgst.gp) {
                esgst.giveawayFeatures.push(addGpButtons);
            }

            if (esgst.elgb) {
                esgst.giveawayFeatures.push(addElgbButtons);
            }

            if (esgst.ggl) {
                if (esgst.ggl_index === 0) {
                    esgst.giveawayFeatures.push(getGglGiveaways);
                } else {
                    esgst.giveawayFeatures.push(setGglButtons);
                }
            }

            if (esgst.gcl) {
                esgst.giveawayFeatures.push(setGclButtons);
            }

            if (esgst.newGiveawayPath) {
                if (esgst.gr) {
                    loadGrGiveaway();
                }
                let rows = document.getElementsByClassName(`form__rows`)[0];
                if (rows) {
                    if (esgst.gc) {
                        let ipt = document.getElementsByClassName(`js__autocomplete-name`)[0];
                        let tb = ipt.nextElementSibling;
                        ipt.addEventListener(`input`, () => {
                            if (!esgst.isCheckingGc) {
                                esgst.isCheckingGc = true;
                                checkGcNewGiveaway(tb);
                            }
                        });
                    }
                    if (esgst.gts) {
                        let key, position;
                        if (esgst.leftButtonIds.indexOf(`gts`) > -1) {
                            key = `leftButtons`;
                            position = `afterBegin`;
                        } else {
                            key = `rightButtons`;
                            position = `beforeEnd`;
                        }
                        addGtsButtonSection(insertHtml(esgst.hideButtons && esgst.hideButtons_gts ? esgst[key] : esgst.mainPageHeading, position, `
                            <div class="esgst-gts-button esgst-heading-button" id="esgst-gts" title="View/apply templates">
                                <i class="fa fa-file"></i>
                            </div>
                        `), rows);
                    }
                    if (esgst.sgac) {
                        let container, context, elements, i, id, n, separator, stickiedCountries;
                        getValue(`stickiedCountries`, `[]`).then(value => {
                            stickiedCountries = JSON.parse(value);
                            container = document.querySelector(`.form_list[data-input="country_item_string"]`);
                            separator = container.firstElementChild;
                            elements = container.children;
                            for (i = 0, n = elements.length; i < n; ++i) {
                                context = elements[i];
                                id = context.getAttribute(`data-item-id`);
                                if (stickiedCountries.indexOf(id) >= 0) {
                                    if (context === separator) {
                                        separator = separator.nextElementSibling;
                                    }
                                    container.insertBefore(context, separator);
                                    addSgacUnstickyButton(container, context, id, separator);
                                } else {
                                    addSgacStickyButton(container, context, id, separator);
                                }
                            }
                        });
                    }
                }
            }

            if (esgst.mgc) {
                loadMgc();
            }

            if (esgst.sgg) {
                if (esgst.newGiveawayPath && !document.getElementsByClassName(`table--summary`)[0]) {
                    setSggGiveawayGroups();
                } else if (esgst.groupsPath) {
                    esgst.endlessFeatures.push(setSggGroups);
                    setSggGroups(document);
                }
            }

            if (esgst.rcvc) {
                loadRcvc();
            }

            if (esgst.sks && esgst.createdPath) {
                let key, position;
                if (esgst.leftButtonIds.indexOf(`sks`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                let button = insertHtml(esgst.hideButtons && esgst.hideButtons_sks ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button" id="esgst-sks" title="Search keys">
                        <i class="fa fa-key"></i>
                        <i class="fa fa-search"></i>
                    </div>
                `);
                button.addEventListener(`click`, openSksPopup.bind(null, {button}));
            }

            if (esgst.ugs) {
                if (esgst.createdPath) {
                    let button;
                    let key, position;
                    if (esgst.leftButtonIds.indexOf(`ugs`) > -1) {
                        key = `leftButtons`;
                        position = `afterBegin`;
                    } else {
                        key = `rightButtons`;
                        position = `beforeEnd`;
                    }
                    button = insertHtml(esgst.hideButtons && esgst.hideButtons_ugs ? esgst[key] : esgst.mainPageHeading, position, `
                        <div class="esgst-heading-button" id="esgst-ugs" title="Send unsent gifts">
                            <i class="fa fa-gift"></i>
                            <i class="fa fa-send"></i>
                        </div>
                    `);
                    button.addEventListener(`click`, openUgsPopup.bind(null, {button}));
                } else if (esgst.newTicketPath) {
                    document.getElementsByClassName(`form__submit-button`)[0].addEventListener(`click`, saveUgsReroll.bind(null, document.querySelector(`[name="category_id"]`), document.querySelector(`[name="reroll_winner_id"]`)));
                }
            }

            if (esgst.gm) {
                loadGm();
            }

            if (esgst.et) {
                if (esgst.enteredPath) {
                    esgst.endlessFeatures.push(getEtEntries);
                    getEtEntries(document);
                } else if (esgst.giveawayPath && !document.getElementsByClassName(`table--summary`)[0] && esgst.enterGiveawayButton) {
                    let code, name;
                    code = location.pathname.match(/^\/giveaway\/(.+?)\//)[1];
                    name = document.getElementsByClassName(`featured__heading__medium`)[0].textContent;
                    esgst.enterGiveawayButton.addEventListener(`click`, setEtEntry.bind(null, code, true, name));
                    esgst.leaveGiveawayButton.addEventListener(`click`, setEtEntry.bind(null, code, false, name));
                }
            }

            if (esgst.hgr && location.pathname.match(/^\/account\/settings\/giveaways\/filters/)) {
                let key, position;
                if (esgst.leftButtonIds.indexOf(`hgr`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                let button = insertHtml(esgst.hideButtons && esgst.hideButtons_hgr ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button" id="esgst-hgr" title="Remove owned games from the list">
                        <i class="fa fa-eye-slash"></i>
                        <i class="fa fa-times-circle"></i>
                    </div>
                `);
                button.addEventListener(`click`, openHgrPopup.bind(null, {button}));
            }

            if (esgst.sal && esgst.wonPath) {
                esgst.endlessFeatures.push(addSalLinks);
                addSalLinks(document);
                esgst.endlessFeatures.push(addSalObservers);
                addSalObservers(document);
            }

            if (esgst.hgebd && esgst.giveawayPath && !document.getElementsByClassName(`table--summary`)[0]) {
                let hideButton;
                hideButton = document.getElementsByClassName(`featured__giveaway__hide`)[0];
                if (esgst.enterGiveawayButton && !hideButton) {
                    let parent = esgst.enterGiveawayButton.parentElement;
                    if (esgst.enterGiveawayButton) {
                        esgst.enterGiveawayButton.remove();
                    }
                    parent.insertAdjacentHTML(`afterBegin`, `
                        <div class="sidebar__error is-disabled">
                            <i class="fa fa-exclamation-circle"></i> Hidden Game
                        </div>
                    `);
                }
            }

            if (esgst.giveawayPath) {
                if (esgst.itadi) {
                    esgst.giveawayFeatures.push(getItadiInfo);
                }
                if (esgst.dkc) {
                    esgst.endlessFeatures.push(getDkcLinks);
                    getDkcLinks(document);
                }
            }

            if (esgst.npth) {
                loadNpth();
            }

            if (esgst.ge) {
                loadGe();
            }

            if (esgst.gesl) {
                loadGesl();
            }

            if (esgst.as) {
                loadAs();
            }

            if (esgst.ds && esgst.discussionsPath) {
                let ds = {};
                let key, position;
                if (esgst.leftButtonIds.indexOf(`ds`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                ds.button = insertHtml(esgst.hideButtons && esgst.hideButtons_ds ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button" id="esgst-ds" title="Sort discussions">
                        <i class="fa fa-sort"></i>
                    </div>
                `);
                ds.button.addEventListener(`click`, openDsPopout.bind(null, ds));
            }

            if (esgst.dh) {
                loadDh();
            }       
            
            /* [QGB] Quick Discussion Browsing */

            if (esgst.qgb) {
                let html = ``;
                [
                    {description: `Help the community by categorizing uncategorized discussions.`, icon: `fa-question-circle grey`, name: `Help Categorize`, url: `/tools/categorize-discussions`},
                    {name: `Browse Announcements`, url: `/discussions/announcements`},
                    {name: `Browse Bugs / Suggestions`, url: `/discussions/bugs-suggestions`},
                    {name: `Browse Deals`, url: `/discussions/deals`},
                    {name: `Browse General`, url: `/discussions/general`},
                    {name: `Browse Group Recruitment`, url: `/discussions/group-recruitment`},
                    {name: `Browse Let's Play Together`, url: `/discussions/lets-play-together`},
                    {name: `Browse Off-Topic`, url: `/discussions/off-topic`},
                    {name: `Browse Puzzles`, url: `/discussions/puzzles`},
                    {name: `Browse Uncategorized`, url: `/discussions/uncategorized`}

                ].forEach(details => {
                    html += generateHeaderMenuItem(details);
                });
                document.getElementsByClassName(`nav__absolute-dropdown`)[1].insertAdjacentHTML(`beforeEnd`, html);
            }

            if (esgst.discussionPath) {
                let discussion, savedDiscussions;
                discussion = {
                    code: location.pathname.match(/^\/discussion\/(.+?)\//)[1],
                    heading: document.getElementsByClassName(`page__heading__breadcrumbs`)[0],
                    headingContainer: document.getElementsByClassName(`page__heading`)[0]
                };
                getValue(`discussions`).then(value => {
                    savedDiscussions = JSON.parse(value);
                    if (savedDiscussions[discussion.code]) {
                        if (esgst.df && esgst.df_s) {
                            if (savedDiscussions[discussion.code].hidden) {
                                addDfUnhideButton(discussion, true);
                            } else {
                                addDfHideButton(discussion, true);
                            }
                        }
                        if (esgst.dh) {
                            if (savedDiscussions[discussion.code].highlighted) {
                                highlightDhDiscussion(discussion.code, discussion.heading);
                                addDhUnhighlightButton(discussion.code, discussion.heading, discussion.headingContainer);
                            } else {
                                addDhHighlightButton(discussion.code, discussion.heading, discussion.headingContainer);
                            }
                        }
                        if (esgst.pm && (esgst.pm_a || discussion.heading.firstElementChild.nextElementSibling.nextElementSibling.textContent === `Puzzles`)) {
                            addPmButton(discussion.code, discussion.headingContainer, savedDiscussions[discussion.code].status || `off`);
                        }
                    } else {
                        if (esgst.df && esgst.df_s) {
                            addDfHideButton(discussion, true);
                        }
                        if (esgst.dh) {
                            addDhHighlightButton(discussion.code, discussion.heading, discussion.headingContainer);
                        }
                        if (esgst.pm && (esgst.pm_a || discussion.heading.firstElementChild.nextElementSibling.nextElementSibling.textContent === `Puzzles`)) {
                            addPmButton(discussion.code, discussion.headingContainer, `off`);
                        }
                    }
                });
            }

            if (esgst.mps && esgst.discussionPath && esgst.paginationNavigation && document.referrer.match(new RegExp(`/discussion/${[location.pathname.match(/^\/discussion\/(.+?)\//)[1]]}/`))) {
                goToComment(``, esgst.pagination.previousElementSibling.firstElementChild.firstElementChild);
            }

            if (esgst.mpp) {
                loadMpp();
            }

            if (esgst.ded && esgst.replyBox && !esgst.userPath) {
                addDEDButton(esgst.replyBox);
            }

            if (esgst.tb) {
                if (location.href.match(new RegExp(`\\/trades\\/search\\?user=${esgst.steamId}`))) {
                    let key, position;
                    if (esgst.leftButtonIds.indexOf(`tb`) > -1) {
                        key = `leftButtons`;
                        position = `afterBegin`;
                    } else {
                        key = `rightButtons`;
                        position = `beforeEnd`;
                    }
                    let button = insertHtml(esgst.hideButtons && esgst.hideButtons_tb ? esgst[key] : esgst.mainPageHeading, position, `
                        <div class="esgst-heading-button" id="esgst-tb" title="Bump trades">
                            <i class="fa fa-chevron-circle-up"></i>
                        </div>
                    `);
                    button.addEventListener(`click`, getTbTrades.bind(null, button, document));
                    if (esgst.tb_a) {
                        setTbAutoBump(button);
                    }
                } else if (esgst.tb_a) {
                    setTbAutoBump();
                }
            }

            if (esgst.cerb && esgst.commentsPath) {
                let button, collapse, comments, expand, id;
                comments = document.getElementsByClassName(`comments`)[0];
                if (comments && comments.children.length) {
                    esgst.cerbButtons = [];
                    button = insertHtml(esgst.mainPageHeadingBackground || esgst.mainPageHeading, `afterEnd`, `
                        <div class="esgst-cerb-button esgst-clickable">
                            <span>
                                <i class="fa fa-minus-square"></i> Collapse all replies
                            </span>
                            <span class="esgst-hidden">
                                <i class="fa fa-plus-square"></i> Expand all replies
                            </span>
                        </div>
                    `);
                    collapse = button.firstElementChild;
                    expand = collapse.nextElementSibling;
                    collapse.addEventListener(`click`, collapseAllCerbReplies.bind(null, collapse, expand));
                    expand.addEventListener(`click`, expandAllCerbReplies.bind(null, collapse, expand));
                    esgst.endlessFeatures.push(getCerbReplies.bind(null, collapse, expand, null));
                    id = location.hash.replace(/#/, ``);
                    getCerbReplies(collapse, expand, id ? document.getElementById(id) : null, document);
                }
            }

            if (esgst.rml) {
                esgst.endlessFeatures.push(addRmlLinks);
                addRmlLinks(document);
            }

            if (esgst.cs && esgst.commentsPath && (!esgst.giveawayPath || !document.getElementsByClassName(`table--summary`)[0])) {
                let key, position;
                if (esgst.leftButtonIds.indexOf(`cs`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                let button = insertHtml(esgst.hideButtons && esgst.hideButtons_cs ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button" id="esgst-cs" title="Search comments from specific users">
                        <i class="fa fa-comments"></i>
                        <i class="fa fa-search"></i>
                    </div>
                `);
                button.addEventListener(`click`, openCsPopup.bind(null, {button}));
            }

            if (esgst.rbot) {
                loadRbot();
            }

            if (esgst.rbp) {
                loadRbp();
            }

            if ((esgst.mr && !esgst.inboxPath) || (esgst.rfi && esgst.inboxPath)) {
                esgst.endlessFeatures.push(getMrRfiButtons);
                getMrRfiButtons(document);
            }

            if (esgst.ct) {
                loadCt();
            }

            if (esgst.commentsPath || esgst.inboxPath) {
                if (esgst.cr && esgst.discussionPath && esgst.pagination) {
                    reverseComments(esgst.pagination.previousElementSibling);
                }
                esgst.endlessFeatures.push(loadCommentFeatures);
                loadCommentFeatures(document, true);
            }

            if (esgst.ust) {
                if (esgst.ticketsPath) {
                    let key, position;
                    if (esgst.leftButtonIds.indexOf(`ust`) > -1) {
                        key = `leftButtons`;
                        position = `afterBegin`;
                    } else {
                        key = `rightButtons`;
                        position = `beforeEnd`;
                    }
                    esgst.ustButton = insertHtml(esgst.hideButtons && esgst.hideButtons_ust ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button" title="Send selected tickets to the User Suspension Tracker database">
                            <i class="fa fa-paper-plane"></i>
                        </div>
                    `);
                    esgst.ustButton.addEventListener(`click`, sendUstTickets);
                } else if (esgst.ticketPath && document.getElementsByClassName(`table__column--width-fill`)[1].textContent.trim().match(/Did\sNot\sActivate\sPrevious\sWins\sThis\sMonth|Other|Multiple\sWins\sfor\sthe\sSame\sGame|Not\sActivating\sWon\sGift/)) {
                    let code, tickets;
                    code = location.pathname.match(/\/ticket\/(.+?)\//)[1];
                    tickets = JSON.parse(esgst.storage.tickets);
                    if (!tickets[code] || !tickets[code].sent) {
                        esgst.ustButton = insertHtml(document.getElementsByClassName(`page__heading`)[0].lastElementChild, `beforeBegin`, `
                            <div class="esgst-heading-button" title="Send ticket to the User Suspension Tracker database">
                                <i class="fa fa-paper-plane"></i>
                            </div>
                        `);
                        esgst.ustButton.addEventListener(`click`, sendUstTicket);
                    }
                }
            }

            if (esgst.userPath || esgst.ap) {
                if (esgst.uh) {
                    esgst.profileFeatures.push(addUhContainer);
                }
                if (esgst.un) {
                    esgst.profileFeatures.push(addUnButton);
                }
                if (esgst.uf) {
                    esgst.profileFeatures.push(addUfButton);
                }
                if (esgst.sgc) {
                    esgst.profileFeatures.push(addSgcButton);
                }
                if (esgst.rwscvl) {
                    esgst.profileFeatures.push(addRwscvlLinks);
                }
                if (esgst.ugd) {
                    esgst.profileFeatures.push(addUgdButtons);
                }
                if (esgst.namwc) {
                    esgst.profileFeatures.push(addNamwcProfileButton);
                }
                if (esgst.nrf) {
                    esgst.profileFeatures.push(addNrfButton);
                }
                if (esgst.swr) {
                    esgst.profileFeatures.push(addSwrRatio);
                }
                if (esgst.luc) {
                    esgst.profileFeatures.push(calculateLuvValue);
                }
                if (esgst.sgpb && esgst.userPath) {
                    esgst.profileFeatures.push(addSgpbButton);
                }
                if (esgst.stpb) {
                    esgst.profileFeatures.push(addStpbButton);
                }
            }

            if (esgst.namwc) {
                if (esgst.winnersPath) {
                    let key, position;
                    if (esgst.leftButtonIds.indexOf(`namwc`) > -1) {
                        key = `leftButtons`;
                        position = `afterBegin`;
                    } else {
                        key = `rightButtons`;
                        position = `beforeEnd`;
                    }
                    setNAMWCPopup(insertHtml(esgst.hideButtons && esgst.hideButtons_namwc ? esgst[key] : esgst.mainPageHeading, position, `
                        <div class="esgst-heading-button" id="esgst-namwc" title="Check for not activated/multiple wins">
                            <i class="fa fa-trophy"></i>
                            <i class="fa fa-question-circle"></i>
                        </div>
                    `));
                }
            }

            if (esgst.wbc) {
                if (esgst.mainPageHeading) {
                    let html, title;
                    if (esgst.wbc_b) {
                        title = `Check for whitelists/blacklists`;
                        html = `
                            <i class="fa fa-heart"></i>
                            <i class="fa fa-ban"></i>
                            <i class="fa fa-question-circle"></i>
                        `;
                    } else {
                        title = `Check for whitelists`;
                        html = `
                            <i class="fa fa-heart"></i>
                            <i class="fa fa-question-circle"></i>
                        `;
                    }
                    let key, position;
                    if (esgst.leftButtonIds.indexOf(`wbc`) > -1) {
                        key = `leftButtons`;
                        position = `afterBegin`;
                    } else {
                        key = `rightButtons`;
                        position = `beforeEnd`;
                    }
                    esgst.wbcButton = insertHtml(esgst.hideButtons && esgst.hideButtons_wbc ? esgst[key] : esgst.mainPageHeading, position, `
                        <div class="esgst-heading-button esgst-hidden" id="esgst-wbc" title="${title}">${html}</div>
                    `);
                    addWBCButton(true, esgst.wbcButton);
                }
            }

            if (esgst.mt) {
                loadMt();
            }

            if (esgst.iwh && (esgst.winnersPath || esgst.inboxPath)) {
                esgst.endlessFeatures.push(getIwhUsers);
                getIwhUsers(document);
            }

            if (esgst.groupsPath) {
                if (esgst.gs) {
                    esgst.endlessFeatures.push(getGsGroups);
                    addGSHeading();
                    getGsGroups(document);
                }
            } else if (esgst.gh) {
                esgst.endlessFeatures.push(highlightGhGroups);
                highlightGhGroups(document);
            }

            if (esgst.glwc) {
                loadGlwc();
            }

            if (esgst.ap) {
                esgst.endlessFeatures.push(getApAvatars);
                getApAvatars(document);
            }

            if (esgst.stbb) {
                loadStbb();
            }

            if (esgst.sttb) {
                loadSttb();
            }

            if (esgst.userPath) {
                loadProfileFeatures(document);
            }
            esgst.endlessFeatures.push(loadGiveawayFeatures);
            return loadGiveawayFeatures(document, true);
        }).then(() => {
            esgst.endlessFeatures.push(loadGameFeatures);
            return loadGameFeatures(document, true);
        }).then(() => {
            esgst.endlessFeatures.push(loadUserFeatures);
            loadUserFeatures(document);

            if (esgst.ts) {
                esgst.endlessFeatures.push(getTsTables);
                getTsTables(document);
            }

            if (esgst.es) {
                loadEs();
            }

            if (esgst.sto) {
                esgst.endlessFeatures.push(setStoLinks);
                setStoLinks(document);
            }

            if (esgst.hideButtons && esgst.mainPageHeading) {
                if (!esgst.leftButtons.querySelector(`.esgst-heading-button:not(.esgst-hidden)`)) {
                    hiddenButtonsBefore.classList.add(`esgst-hidden`);
                }
                if (!esgst.rightButtons.querySelector(`.esgst-heading-button:not(.esgst-hidden)`)) {
                    hiddenButtonsAfter.classList.add(`esgst-hidden`);
                }
                esgst.mainPageHeading.insertBefore(hiddenButtonsBefore, esgst.mainPageHeading.firstElementChild);
                esgst.mainPageHeading.appendChild(hiddenButtonsAfter);
            }
            reorderButtons(hiddenButtonsBefore, esgst.leftButtons, hiddenButtonsAfter, esgst.rightButtons);
            goToComment(esgst.originalHash);
            addEventListener(`beforeunload`, function (event) {
                if (document.getElementsByClassName(`esgst-busy`)[0] || esgst.busy) {
                    event.returnValue = true;
                    return true;
                }
            });
            addEventListener(`hashchange`, function () {
                goToComment();
            });
            if (location.pathname.match(/^\/discussion\/TDyzv\//) && esgst.checkVersion) {
                let version = document.querySelector(`[href*="ESGST-currentVersion"]`).getAttribute(`href`).match(/currentVersion-(.+)/)[1];
                getValue(`dismissedVersion`).then(value => {
                    if (version !== esgst.version && version !== value)  {
                        notifyNewVersion(version);
                    }
                });
            }
            setTimeout(repositionPopups, 2000);
        });
    }

    function generateHeaderMenuItem(details) {
        if (details.icon) {
            if (details.url) {
                return `
                    <a class="esgst-header-menu-row" href="${details.url}">
                        <i class="fa fa-fw ${details.icon}"></i>
                        <div>
                            <p class="esgst-header-menu-name">${details.name}</p>
                            <p class="esgst-header-menu-description">${details.description}</p>
                        </div>
                    </a>      
                `;
            }
            return `
                <div class="esgst-header-menu-row">
                    <i class="fa fa-fw ${details.icon}"></i>
                    <div>
                        <p class="esgst-header-menu-name">${details.name}</p>
                        <p class="esgst-header-menu-description">${details.description}</p>
                    </div>
                </div>

            `;
        }
        return `
            <a class="nav__row" href="${details.url}">
                <div class="nav__row__summary">
                    <p class="nav__row__summary__name">${details.name}</p>
                </div>
            </a>
        `;
    }

    function sendUstTickets(event) {
        let check, data, numError, n;
        esgst.ustButton.removeEventListener(`click`, sendUstTickets);
        esgst.ustButton.innerHTML =  `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        data = ``
        n = Object.keys(esgst.ustCheckboxes).length;
        numError = 0;
        check = new CompletionCheck(n, () => {
            request(data.slice(0, -1), null, `POST`, false, `https://script.google.com/macros/s/AKfycbwdKNormCJs-hEKV0GVwawgWj1a26oVtPylgmxOOvNk1Gf17A/exec`, response => {
                let error = JSON.parse(response.responseText).error;
                getValue(`tickets`).then(value => {
                    let tickets = JSON.parse(value);
                    for (code in esgst.ustCheckboxes) {
                        if (error.indexOf(code) < 0) {
                            if (!tickets[code]) {
                                tickets[code] = {
                                    readComments: {}
                                };
                            }
                            tickets[code].sent = 1;
                            esgst.numUstTickets -= 1;
                            esgst.ustCheckboxes[code].remove();
                            delete esgst.ustCheckboxes[code];
                        } else {
                            numError += 1;
                        }
                    }
                    return setValue(`tickets`, JSON.stringify(tickets));
                }).then(() => {
                    if (n === esgst.numUstTickets) {
                        esgst.ustButton.remove();
                    } else {
                        esgst.ustButton.innerHTML = `<i class="fa fa-paper-plane"></i>`;
                        esgst.ustButton.addEventListener(`click`, sendUstTickets);
                    }
                    esgst.ustCheckboxes = [];
                    new Popup(``, `${n - numError} out of ${n} tickets sent! They will be analyzed and, if accepted, added to the database in 48 hours at most.${numError > 0 ? ` Try sending the tickets that failed again later.` : ``}`, true).open();
                });
            });
        });
        for (let code in esgst.ustCheckboxes) {
            let ticket = esgst.ustCheckboxes[code];            
            request(null, null, `GET`, false, `/support/ticket/${code}/`, response => {
                let responseHtml = parseHtml(response.responseText);
                if (responseHtml.getElementsByClassName(`table__column--width-fill`)[1].textContent.trim().match(/Did\sNot\sActivate\sPrevious\sWins\sThis\sMonth|Other|Multiple\sWins\sfor\sthe\sSame\sGame|Not\sActivating\sWon\sGift/)) {
                    data += `${code}=${encodeURIComponent(responseHtml.getElementsByClassName(`sidebar`)[0].nextElementSibling.innerHTML.replace(/\n|\r|\r\n|\s{2,}/g, ``).trim())}&`;
                }
                check.count += 1;
            });
        }
    }

    function sendUstTicket(event) {
        let code = location.href.match(/\/ticket\/(.+?)\//)[1];
        esgst.ustButton.removeEventListener(`click`, sendUstTicket);
        esgst.ustButton.innerHTML =  `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        request(null, null, `GET`, false, location.href, response => {
            request(`${code}=${encodeURIComponent(parseHtml(response.responseText).getElementsByClassName(`sidebar`)[0].nextElementSibling.innerHTML.replace(/\n|\r|\r\n|\s{2,}/g, ``).trim())}`, null, `POST`, false, `https://script.google.com/macros/s/AKfycbwdKNormCJs-hEKV0GVwawgWj1a26oVtPylgmxOOvNk1Gf17A/exec`, response => {
                let error = JSON.parse(response.responseText).error;
                if (error.length === 0) {
                    getValue(`tickets`).then(value => {
                        let tickets = JSON.parse(value);
                        if (!tickets[code]) {
                            tickets[code] = {
                                readComments: {}
                            };
                        }
                        tickets[code].sent = 1;
                        return setValue(`tickets`, JSON.stringify(tickets));
                    }).then(() => {
                        esgst.ustButton.remove();
                        new Popup(``, `Ticket sent! It will be analyzed and, if accepted, added to the database in 48 hours at most.`, true).open();
                    });
                } else {
                    esgst.ustButton.innerHTML = `<i class="fa fa-paper-plane"></i>`;
                    esgst.ustButton.addEventListener(`click`, sendUstTicket);
                    new Popup(``, `An error ocurred. Please try again later.`, true).open();
                }
            });
        });
    }

    function reorderButtons(leftButton, leftButtons, rightButton, rightButtons) {
        let leftHidden, rightHidden, source;
        leftHidden = leftButton && leftButton.classList.contains(`esgst-hidden`);
        rightHidden = rightButton && rightButton.classList.contains(`esgst-hidden`);
        esgst.leftButtonIds.forEach(id => {
            let button = document.getElementById(`esgst-${id}`);
            if (button) {
                let key = id === `esResume` ? `hideButtons_esPause` : `hideButtons_${id}`;
                button.parentElement.insertBefore(button, leftHidden || !esgst.hideButtons || esgst[key] ? button.parentElement.firstElementChild : button.parentElement.firstElementChild.nextElementSibling);
                button.setAttribute(`draggable`, true);
                button.addEventListener(`dragstart`, event => {
                    event.dataTransfer.setData(`text/plain`, ``);
                    source = button;
                });
                button.addEventListener(`dragenter`, () => {
                    let current, i;
                    current = source;
                    i = 0;
                    do {
                        current = current.previousElementSibling;
                        if (current && current === button) {
                            current.parentElement.insertBefore(source, current);
                            return;
                        }
                        ++i;
                    } while (current);
                    button.parentElement.insertBefore(source, button.nextElementSibling);
                });
                button.addEventListener(`dragend`, () => {
                    let i, nextSiblingId, previousSiblingId, siblingId;
                    if (esgst.hideButtons) {
                        if (leftButtons.contains(button) || rightButtons.contains(button)) {
                            if (!esgst[key]) {
                                setSetting(key, true, esgst.sg, esgst.st);
                            }
                        } else if (esgst[key]) {
                            setSetting(key, false, esgst.sg, esgst.st);
                        }
                    }
                    previousSiblingId = button.previousElementSibling && !button.previousElementSibling.classList.contains(`esgst-hidden`) && button.previousElementSibling.id;
                    nextSiblingId = button.nextElementSibling && !button.nextElementSibling.classList.contains(`esgst-hidden`) && button.nextElementSibling.id;
                    siblingId = previousSiblingId || nextSiblingId;
                    if (siblingId) {
                        i = esgst.rightButtonIds.indexOf(siblingId.split(`esgst-`)[1]);
                        esgst.leftButtonIds.splice(esgst.leftButtonIds.indexOf(id), 1);
                        if (i > -1) {
                            esgst.rightButtonIds.splice(i, 0, id);
                        } else if (previousSiblingId) {
                            esgst.leftButtonIds.splice(esgst.leftButtonIds.indexOf(previousSiblingId.split(`esgst-`)[1]), 0, id);
                        } else {
                            esgst.leftButtonIds.splice(esgst.leftButtonIds.indexOf(nextSiblingId.split(`esgst-`)[1]) + 1, 0, id);
                        }
                        setSetting(`leftButtonIds`, esgst.leftButtonIds);
                        setSetting(`rightButtonIds`, esgst.rightButtonIds);
                    }
                });
            }
        });
        esgst.rightButtonIds.forEach(id => {
            let button = document.getElementById(`esgst-${id}`);
            if (button) {
                let key = id === `esResume` ? `hideButtons_esPause` : `hideButtons_${id}`;
                if (rightHidden || !esgst.hideButtons || esgst[key]) {
                    button.parentElement.appendChild(button);
                } else {
                    button.parentElement.insertBefore(button, button.parentElement.lastElementChild);
                }
                button.setAttribute(`draggable`, true);
                button.addEventListener(`dragstart`, event => {
                    event.dataTransfer.setData(`text/plain`, ``);
                    source = button;
                });
                button.addEventListener(`dragenter`, () => {
                    let current, i;
                    current = source;
                    i = 0;
                    do {
                        current = current.previousElementSibling;
                        if (current && current === button) {
                            current.parentElement.insertBefore(source, current);
                            return;
                        }
                        ++i;
                    } while (current);
                    button.parentElement.insertBefore(source, button.nextElementSibling);
                });
                button.addEventListener(`dragend`, () => {
                    let i, nextSiblingId, previousSiblingId, siblingId;
                    if (esgst.hideButtons) {
                        if (leftButtons.contains(button) || rightButtons.contains(button)) {
                            if (!esgst[key]) {
                                setSetting(key, true, esgst.sg, esgst.st);
                            }
                        } else if (esgst[key]) {
                            setSetting(key, false, esgst.sg, esgst.st);
                        }
                    }
                    previousSiblingId = button.previousElementSibling && !button.previousElementSibling.classList.contains(`esgst-hidden`) && button.previousElementSibling.id;
                    nextSiblingId = button.nextElementSibling && !button.nextElementSibling.classList.contains(`esgst-hidden`) && button.nextElementSibling.id;
                    siblingId = previousSiblingId || nextSiblingId;
                    if (siblingId) {
                        i = esgst.leftButtonIds.indexOf(siblingId.split(`esgst-`)[1]);
                        esgst.rightButtonIds.splice(esgst.rightButtonIds.indexOf(id), 1);
                        if (i > -1) {
                            esgst.leftButtonIds.splice(i, 0, id);
                        } else if (previousSiblingId) {
                            esgst.rightButtonIds.splice(esgst.rightButtonIds.indexOf(previousSiblingId.split(`esgst-`)[1]) + 1, 0, id);
                        } else {
                            esgst.rightButtonIds.splice(esgst.rightButtonIds.indexOf(nextSiblingId.split(`esgst-`)[1]), 0, id);
                        }
                        setSetting(`leftButtonIds`, esgst.leftButtonIds);
                        setSetting(`rightButtonIds`, esgst.rightButtonIds);
                    }
                });
            }
        });
    }

    function repositionPopups() {
        if (esgst.openPopups > 0) {
            esgst.popups.forEach(popup => popup.reposition());
            esgst.isRepositioning = true;
            setTimeout(repositionPopups, 2000);
        } else {
            esgst.isRepositioning = false;
        }
    }

    function fixFsSidebar() {
        if (esgst.sidebar.offsetTop >= esgst.pageTop) {
            esgst.sidebarTop = esgst.sidebar.offsetTop - esgst.pageTop;
        } else {
            esgst.sidebarTop = esgst.sidebar.offsetTop;
        }
        if (scrollY > esgst.sidebarTop && document.documentElement.offsetHeight > innerHeight * 2) {
            document.removeEventListener(`scroll`, fixFsSidebar);
            esgst.sidebar.classList.add(`esgst-fs`);
            if (esgst.sidebarAd) {
                esgst.sidebarAd.classList.add(`esgst-hidden`);
            }
            esgst.sidebarSibling.style.marginLeft = `${esgst.sidebar.offsetWidth + 25}px`;
            document.addEventListener(`scroll`, unfixFsSidebar);
        }
    }

    function unfixFsSidebar() {
        if (scrollY <= esgst.sidebarTop) {
            document.removeEventListener(`scroll`, unfixFsSidebar);
            esgst.sidebar.classList.remove(`esgst-fs`);
            if (esgst.sidebarAd) {
                esgst.sidebarAd.classList.remove(`esgst-hidden`);
            }
            esgst.sidebarSibling.style.marginLeft = `25px`;
            document.addEventListener(`scroll`, fixFsSidebar);
        }
    }

    function fixFmphHeading() {
        if (scrollY > (esgst.mainPageHeading.offsetTop - esgst.pageTop)) {
            document.removeEventListener(`scroll`, fixFmphHeading);
            esgst.mainPageHeading.classList.add(`esgst-fmph`);
            esgst.mainPageHeadingPlaceholder.classList.remove(`esgst-hidden`);
            esgst.mainPageHeadingBackground.classList.remove(`esgst-hidden`);
            width = `${getComputedStyle(esgst.mainPageHeading.parentElement).getPropertyValue(`width`)}`;
            esgst.mainPageHeading.style.width = width;
            esgst.mainPageHeadingBackground.style.width = width;
            if (esgst.gf && esgst.gf.container) {
                esgst.gf.container.classList.add(`esgst-gf-container-fixed`);
                esgst.gf.container.style.width = width;
            }
            if (esgst.df && esgst.df.container) {
                esgst.df.container.classList.add(`esgst-gf-container-fixed`);
                esgst.df.container.style.width = width;
            }
            document.addEventListener(`scroll`, unfixFmphHeading);
        }
    }

    function unfixFmphHeading() {
        if (scrollY <= (esgst.mainPageHeadingPlaceholder.offsetTop - esgst.pageTop)) {
            document.removeEventListener(`scroll`, unfixFmphHeading);
            esgst.mainPageHeading.classList.remove(`esgst-fmph`);
            esgst.mainPageHeadingPlaceholder.classList.add(`esgst-hidden`);
            esgst.mainPageHeadingBackground.classList.add(`esgst-hidden`);
            width = ``;
            esgst.mainPageHeading.style.width = width;
            esgst.mainPageHeadingBackground.style.width = width;
            if (esgst.gf && esgst.gf.container) {
                esgst.gf.container.classList.remove(`esgst-gf-container-fixed`);
            }
            if (esgst.df && esgst.df.container) {
                esgst.df.container.classList.remove(`esgst-gf-container-fixed`);
            }
            document.addEventListener(`scroll`, fixFmphHeading);
        }
    }

    function setSetting(id, value, sg, st) {
        return new Promise((resolve, reject) => {
            getValue(`settings`, `{}`).then(val => {
                let localId, settings;
                settings = JSON.parse(val);
                if (sg) {
                    id = `${id}_sg`;
                } else if (st) {
                    id = `${id}_st`;
                }
                settings[id] = value;
                return setValue(`settings`, JSON.stringify(settings));
            }).then(() =>{
                esgst.settings[id] = value;
                resolve();
            });
        });
    }

    function getSetting(key) {
        var defaultValue, oldKey;
        if (typeof esgst.settings[key] === `undefined`) {
            defaultValue = esgst.defaultValues[key];
            if (typeof defaultValue === `undefined`) {
                defaultValue = esgst[`enableByDefault_${esgst.name}`] || false;
            }
            oldKey = esgst.oldValues[key];
            if (typeof oldKey !== `undefined`) {
                esgst.settings[key] = esgst.settings[oldKey];
            }
            if (typeof esgst.settings[key] === `undefined`) {
                esgst.settings[key] = defaultValue;
            }
        }
        return esgst.settings[key];
    }

    function getFeatureSetting(feature, id) {
        if (feature.sg && esgst.sg) {
            esgst[id] = getSetting(`${id}_sg`);
        } else if (feature.st && esgst.st) {
            esgst[id] = getSetting(`${id}_st`);
        }
        if (feature.features) {
            for (id in feature.features) {
                getFeatureSetting(feature.features[id], id);
            }
        }
    }

    function toggleHeaderMenu(arrow, dropdown) {
        if (esgst.sg) {
            $(`nav .nav__button`).removeClass(`is-selected`);
            $(`nav .nav__relative-dropdown`).addClass(`is-hidden`);
        } else {
            $(`.nav_btn_dropdown`).removeClass(`is_selected`);
            $(`.page_heading_btn_dropdown`).removeClass(`is_selected`);
            $(`.dropdown`).addClass(`is_hidden`);
        }
        arrow.classList.toggle(`selected`);
        dropdown.classList.toggle(`esgst-hidden`);
    }

    function closeHeaderMenu(arrow, dropdown, menu, event) {
        if (!menu.contains(event.target) && arrow.classList.contains(`selected`)) {
            arrow.classList.remove(`selected`);
            dropdown.classList.add(`esgst-hidden`);
        }
    }

    function getTimestamp(unixTimestamp, clock24, showSeconds) {
        var months, date, month, day, year, hours, period, minutes, seconds;
        months = [`Jan`, `Feb`, `Mar`, `Apr`, `May`, `Jun`, `Jul`, `Aug`, `Sep`, `Oct`, `Nov`, `Dec`];
        date = new Date(unixTimestamp * 1e3);
        month = date.getMonth();
        day = date.getDate();
        year = date.getFullYear();
        hours = date.getHours();
        if (clock24) {
            period = ``;
        } else {
            if (hours < 12) {
                period = `am`;
            } else {
                period = `pm`;
            }
            hours %= 12;
            if (hours === 0) {
                hours = 12;
            }
        }
        minutes = `0${date.getMinutes()}`.slice(-2);
        if (showSeconds) {
            seconds = `0${date.getSeconds()}`.slice(-2);
            seconds = `:${seconds}`;
        } else {
            seconds = ``;
        }
        return `${months[month]} ${day}, ${year}, ${hours}:${minutes}${seconds}${period}`;
    }

    function insertHtml(context, position, html) {
        context.insertAdjacentHTML(position, html);
        var positions = {
            beforeBegin: `previousElementSibling`,
            afterBegin: `firstElementChild`,
            beforeEnd: `lastElementChild`,
            afterEnd: `nextElementSibling`
        };
        return context[positions[position]];
    }

    /* User Saving System */

    function getUser(savedUsers, user) {
        if (savedUsers) {
            return getUser_step2(savedUsers, user);
        } else {
            return new Promise((resolve, reject) => {
                getValue(`users`).then(value => {
                    savedUsers = JSON.parse(value);
                    resolve(getUser_step2(savedUsers, user));
                });
            });
        }
    }

    function getUser_step2(savedUsers, user) {
        var savedUser, steamId;
        if (user.steamId) {
            savedUser = savedUsers.users[user.steamId];
            if (savedUser) {
                if (!user.id) {
                    user.id = savedUser.id;
                }
                if (!user.username) {
                    user.username = savedUser.username;
                }
                return savedUser;
            } else {
                return null;
            }
        } else if (user.username) {
            steamId = savedUsers.steamIds[user.username];
            if (steamId) {
                user.steamId = steamId;
                return savedUsers.users[steamId];
            } else {
                return null;
            }
        } else {
            return null;
        }
    }

    function saveUser(list, savedUsers, user, callback) {
        if (savedUsers) {
            saveUser_step2(list, savedUsers, user, callback);
        } else {
            getValue(`users`).then(value => {
                savedUsers = JSON.parse(value);
                saveUser_step2(list, savedUsers, user, callback);
            });
        }
    }

    function saveUser_step2(list, savedUsers, user, callback) {
        var savedUser = getUser(savedUsers, user);
        if (savedUser) {
            if (list) {
                if (!user.steamId) {
                    user.steamId = savedUsers.steamIds[user.username];
                }
                list.existing.push(user);
                list.count += 1;
            } else {
                continueSavingUser(user, callback);
            }
        } else {
            if (user.steamId && user.username) {
                if (list) {
                    list.new.push(user);
                    list.count += 1;
                } else {
                    addUser(user, callback);
                }
            } else if (user.steamId) {
                getUsername(list, true, user, callback);
            } else {
                getSteamId(list, true, null, user, callback);
            }
        }
    }

    function continueSavingUser(user, callback) {
        createLock(`userLock`, 300, lockAndSaveUser.bind(null, user, callback));
    }

    function lockAndSaveUser(user, callback, deleteLock) {
        var key, savedUsers;
        getValue(`users`).then(value => {
            savedUsers = JSON.parse(value);
            checkUsernameChange(savedUsers, user);
            for (key in user.values) {
                if (key !== `tags`) {
                    if (user.values[key] === null) {
                        delete savedUsers.users[user.steamId][key];
                    } else {
                        savedUsers.users[user.steamId][key] = user.values[key];
                    }
                }
            }
            return setValue(`users`, JSON.stringify(savedUsers));
        }).then(() => {
            deleteLock();
            if (callback) {
                callback();
            }
        });
    }

    function checkUsernameChange(savedUsers, user) {
        var i, n;
        if (typeof savedUsers.users[user.steamId].username !== `undefined` && savedUsers.users[user.steamId].username !== user.username) {
            delete savedUsers.steamIds[savedUsers.users[user.steamId].username];
            savedUsers.users[user.steamId].username = user.username;
            savedUsers.steamIds[user.username] = user.steamId;
            if (user.values.tags) {
                if (!savedUsers.users[user.steamId].tags) {
                    savedUsers.users[user.steamId].tags = [];
                }
                for (i = 0, n = user.values.tags.length; i < n; ++i) {
                    if (savedUsers.users[user.steamId].tags.indexOf(user.values.tags[i]) < 0) {
                        savedUsers.users[user.steamId].tags.push(user.values.tags[i]);
                    }
                }
            }
        } else if (typeof user.values.tags !== `undefined`) {
            savedUsers.users[user.steamId].tags = user.values.tags;
        }
        if (!savedUsers.users[user.steamId].tags) {
            delete savedUsers.users[user.steamId].tags;
        }
    }

    function addUser(user, callback) {
        createLock(`userLock`, 300, addAndSaveUser.bind(null, user, callback));
    }

    function addAndSaveUser(user, callback, deleteLock) {
        var key, savedUser, savedUsers;
        getValue(`users`).then(value => {
            savedUsers = JSON.parse(value);
            savedUser = getUser(savedUsers, user);
            if (!savedUser) {
                savedUsers.users[user.steamId] = {};
            }
            if (user.id) {
                savedUsers.users[user.steamId].id = user.id;
            }
            checkUsernameChange(savedUsers, user);
            if (user.username) {
                savedUsers.users[user.steamId].username = user.username;
                savedUsers.steamIds[user.username] = user.steamId;
            }
            for (key in user.values) {
                if (key !== `tags`) {
                    if (user.values[key] === null) {
                        delete savedUsers.users[user.steamId][key];
                    } else {
                        savedUsers.users[user.steamId][key] = user.values[key];
                    }
                }
            }
            return setValue(`users`, JSON.stringify(savedUsers));
        }).then(() => {
            deleteLock();
            if (callback) {
                callback();
            }
        });
    }

    function getUsername(list, save, user, callback) {
        request(null, null, `GET`, false, `https://www.steamgifts.com/go/user/${user.steamId}`, lockAndGetUsername.bind(null, list, save, user, callback));
    }

    function lockAndGetUsername(list, save, user, callback, response) {
        var input, match, responseHtml;
        match = response.finalUrl.match(/\/user\/(.+)/);
        responseHtml = parseHtml(response.responseText);
        if (match) {
            user.username = match[1];
            input = responseHtml.querySelector(`[name="child_user_id"]`);
            if (input) {
                user.id = input.value;
            }
        }
        if (save) {
            if (list) {
                list.new.push(user);
                list.count += 1;
            } else {
                addUser(user, callback);
            }
        } else {
            callback();
        }
    }

    function getSteamId(list, save, savedUsers, user, callback) {
        var savedUsers, steamId;
        if (save) {
            request(null, null, `GET`, false, `https://www.steamgifts.com/user/${user.username}`, lockAndGetSteamId.bind(null, list, save, user, callback));
        } else {
            if (savedUsers) {
                steamId = savedUsers.steamIds[user.username];
                if (steamId) {
                    user.steamId = steamId;
                    callback();
                } else {
                    request(null, null, `GET`, false, `https://www.steamgifts.com/user/${user.username}`, lockAndGetSteamId.bind(null, list, save, user, callback));
                }
            } else {
                getValue(`users`).then(value => {
                    savedUsers = JSON.parse(value);
                    steamId = savedUsers.steamIds[user.username];
                    if (steamId) {
                        user.steamId = steamId;
                        callback();
                    } else {
                        request(null, null, `GET`, false, `https://www.steamgifts.com/user/${user.username}`, lockAndGetSteamId.bind(null, list, save, user, callback));
                    }
                });
            }
        }
    }

    function lockAndGetSteamId(list, save, user, callback, response) {
        var input, responseHtml;
        responseHtml = parseHtml(response.responseText);
        user.steamId = responseHtml.querySelector(`[href*="/profiles/"]`).getAttribute(`href`).match(/\d+/)[0];
        input = responseHtml.querySelector(`[name="child_user_id"]`);
        if (input) {
            user.id = input.value;
        }
        if (save) {
            if (list) {
                list.new.push(user);
                list.count += 1;
            } else {
                addUser(user, callback);
            }
        } else {
            callback();
        }
    }

    function saveUsers(users, callback) {
        let i, list, n, savedUsers;
        getValue(`users`).then(value => {
            savedUsers = JSON.parse(value);
            n = users.length;
            list = new CompletionCheck(n, createLock.bind(null, `userLock`, 300, deleteLock => {
                completeUserSaving(list, callback, deleteLock);
            }));
            list.existing = [];
            list.new = [];
            for (i = 0; i < n; ++i) {
                saveUser(list, savedUsers, users[i]);
            }
        });
    }

    function completeUserSaving(list, callback, deleteLock) {
        var i, key, n, savedUser, savedUsers, user;
        getValue(`users`).then(value => {
            savedUsers = JSON.parse(value);
            for (i = 0, n = list.new.length; i < n; ++i) {
                user = list.new[i];
                savedUser = getUser(savedUsers, user);
                if (!savedUser) {
                    savedUsers.users[user.steamId] = {};
                }
                if (user.id) {
                    savedUsers.users[user.steamId].id = user.id;
                }
                checkUsernameChange(savedUsers, user);
                if (user.username) {
                    savedUsers.users[user.steamId].username = user.username;
                    savedUsers.steamIds[user.username] = user.steamId;
                }
                for (key in user.values) {
                    if (key !== `tags`) {
                        if (user.values[key] === null) {
                            delete savedUsers.users[user.steamId][key];
                        } else {
                            savedUsers.users[user.steamId][key] = user.values[key];
                        }
                    }
                }
            }
            for (i = 0, n = list.existing.length; i < n; ++i) {
                user = list.existing[i];
                checkUsernameChange(savedUsers, user);
                for (key in user.values) {
                    if (key !== `tags`) {
                        if (user.values[key] === null) {
                            delete savedUsers.users[user.steamId][key];
                        } else {
                            savedUsers.users[user.steamId][key] = user.values[key];
                        }
                    }
                }
            }
            return setValue(`users`, JSON.stringify(savedUsers));
        }).then(() => {
            deleteLock();
            callback();
        });
    }

    function deleteUserValues(values, callback) {
        createLock(`userLock`, 300, lockAndDeleteValues.bind(null, values, callback));
    }

    function lockAndDeleteValues(values, callback, deleteLock) {
        var i, key, n, savedUsers;
        getValue(`users`).then(value => {
            savedUsers = JSON.parse(value);
            for (key in savedUsers.users) {
                for (i = 0, n = values.length; i < n; ++i) {
                    delete savedUsers.users[key][values[i]];
                }
            }
            return setValue(`users`, JSON.stringify(savedUsers));
        }).then(() => {
            deleteLock();
            callback();
        });
    }

    function getUserId(user, callback) {
        if (user.username) {
            getSteamId(null, false, null, user, callback);
        } else {
            getUsername(null, false, user, callback);
        }
    }

    /* */

    function saveComment(tradeCode, parentId, description, url, status, callback, mainCallback) {
        let data, elements, id;
        data = `xsrf_token=${esgst.xsrfToken}&do=${esgst.sg ? `comment_new` : `comment_insert`}&trade_code=${tradeCode}&parent_id=${parentId}&description=${encodeURIComponent(description)}`;
        request(data, null, `POST`, false, url, response => {
            if (esgst.sg) {
                if (response.redirected && url === response.finalUrl) {
                    callback();
                    if (parentId) {
                        id = parseHtml(response.responseText).querySelector(`[data-comment-id="${parentId}"]`).getElementsByClassName(`comment__children`)[0].lastElementChild.getElementsByClassName(`comment__summary`)[0].id;
                    } else {
                        elements = parseHtml(response.responseText).getElementsByClassName(`comments`);
                        id = elements[elements.length - 1].lastElementChild.getElementsByClassName(`comment__summary`)[0].id;
                    }
                    if (esgst.ch) {
                        saveChComment(id, Date.now());
                    }
                    if (mainCallback) {
                        mainCallback(id, response, status);
                    } else {
                        location.href = `/go/comment/${id}`;
                    }
                } else if (url !== response.finalUrl) {
                    request(data, null, `POST`, false, response.finalUrl, response => {
                        callback();
                        if (parentId) {
                            id = parseHtml(response.responseText).querySelector(`[data-comment-id="${parentId}"]`).getElementsByClassName(`comment__children`)[0].lastElementChild.getElementsByClassName(`comment__summary`)[0].id;
                        } else {
                            elements = parseHtml(response.responseText).getElementsByClassName(`comments`);
                            id = elements[elements.length - 1].lastElementChild.getElementsByClassName(`comment__summary`)[0].id;
                        }
                        if (esgst.ch) {
                            saveChComment(id, Date.now());
                        }
                        if (mainCallback) {
                            mainCallback(id, response, status);
                        } else {
                            location.href = `/go/comment/${id}`;
                        }
                    });
                } else {
                    callback();
                    if (mainCallback) {
                        mainCallback(null, null, status);
                    } else {
                        status.innerHTML = `
                            <i class="fa fa-times-circle"></i>
                            <span>Failed!</span>
                        `;
                    }
                }
            } else {
                responseJson = JSON.parse(response.responseText);
                if (responseJson.success) {
                    callback();
                    id = parseHtml(responseJson.html).getElementsByClassName(`comment_outer`)[0].id;
                    if (esgst.ch) {
                        saveChComment(id, Date.now());
                    }
                    if (mainCallback) {
                        mainCallback(id, response, status);
                    } else {
                        location.href = `/go/comment/${id}`;
                    }
                } else {
                    callback();
                    if (mainCallback) {
                        mainCallback(null, null, status);
                    } else {
                        status.innerHTML = `
                            <i class="fa fa-times-circle"></i>
                            <span>Failed!</span>
                        `;
                    }
                }
            }
        });
    }

    function checkSync(menu, callback) {
        if (menu) {
            if (!esgst.menuPath) {
                if (esgst.sg) {
                    setSetting(`username`, document.getElementsByClassName(`nav__avatar-outer-wrap`)[0].href.match(/\/user\/(.+)/)[1]).then(() => {
                        return setSetting(`avatar`, document.getElementsByClassName(`nav__avatar-inner-wrap`)[0].style.backgroundImage.match(/\("(.+)"\)/)[1]);
                    }).then(setSync.bind(null, false, callback));
                } else {
                    setSetting(`avatar`, document.getElementsByClassName(`nav_avatar`)[0].style.backgroundImage.match(/\("(.+)"\)/)[1]).then(setSync.bind(null, false, callback));
                }
            }
        } else if (!getLocalValue(`isSyncing`)) {
            if (esgst.openSyncInTab) {
                let parameters = ``;
                setLocalValue(`isSyncing`, 1);
                [`Groups`, `Whitelist`, `Blacklist`, `HiddenGames`, `Games`, `WonGames`, `ReducedCvGames`, `NoCvGames`, `Giveaways`].forEach(key => {
                    if (esgst[`autoSync${key}`] && Date.now() - esgst[`lastSync${key}`] > esgst[`autoSync${key}`] * 86400000) {
                        parameters += `${key}=1&`;
                    }
                });
                if (parameters) {
                    if (esgst.sg) {
                        setSetting(`username`, document.getElementsByClassName(`nav__avatar-outer-wrap`)[0].href.match(/\/user\/(.+)/)[1]).then(() => {
                            return setSetting(`avatar`, document.getElementsByClassName(`nav__avatar-inner-wrap`)[0].style.backgroundImage.match(/\("(.+)"\)/)[1]);
                        }).then(open.bind(null, `/esgst/sync?${parameters.replace(/&$/, ``)}`));
                    } else {
                        setSetting(`avatar`, document.getElementsByClassName(`nav_avatar`)[0].style.backgroundImage.match(/\("(.+)"\)/)[1]).then(open.bind(null, `/esgst/sync?${parameters.replace(/&$/, ``)}`));
                    }
                } else {
                    delLocalValue(`isSyncing`);
                }
            } else {
                let parameters = {};
                setLocalValue(`isSyncing`, 1);
                [`Groups`, `Whitelist`, `Blacklist`, `HiddenGames`, `Games`, `WonGames`, `ReducedCvGames`, `NoCvGames`, `Giveaways`].forEach(key => {
                    if (esgst[`autoSync${key}`] && Date.now() - esgst[`lastSync${key}`] > esgst[`autoSync${key}`] * 86400000) {
                        parameters[key] = 1;
                    }
                });
                if (Object.keys(parameters).length > 0) {
                    setSync(false, null, parameters);
                } else {
                    delLocalValue(`isSyncing`);
                }
            }
        }
    }

    function setSync(autoSync, mainCallback, parameters) {
        var popup, syncer;
        syncer = {
            autoSync: autoSync,
            canceled: false
        };
        if (esgst.firstInstall) {
            sync(syncer, mainCallback);
        } else if (syncer.autoSync || mainCallback || parameters) {
           syncer.popup = popup = new Popup(parameters ? `fa-circle-o-notch fa-spin` : `fa-refresh`, parameters ? `ESGST is syncing... Please wait until the sync is complete to close this popup.` : `Sync`);
            if (!syncer.autoSync && !parameters) {
                popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-description">By selecting a number X in the dropdown menu next to each data other than 0, you are enabling automatic sync for that data (which means the data will be synced every X days).</div>`);
                syncer.switches = {
                    syncGroups: new ToggleSwitch(popup.scrollable, `syncGroups`, false, `Steam Groups`, false, false, null, esgst.syncGroups),
                    syncWhitelist: new ToggleSwitch(popup.scrollable, `syncWhitelist`, false, `Whitelist`, false, false, null, esgst.syncWhitelist),
                    syncBlacklist: new ToggleSwitch(popup.scrollable, `syncBlacklist`, false, `Blacklist`, false, false, null, esgst.syncBlacklist),
                    syncHiddenGames: new ToggleSwitch(popup.scrollable, `syncHiddenGames`, false, `Hidden Games`, false, false, null, esgst.syncHiddenGames),
                    syncGames: new ToggleSwitch(popup.scrollable, `syncGames`, false, `Owned/Wishlisted/Ignored Games`, false, false, null, esgst.syncGames),
                    syncWonGames: new ToggleSwitch(popup.scrollable, `syncWonGames`, false, `Won Games`, false, false, null, esgst.syncWonGames),
                    syncReducedCvGames: new ToggleSwitch(popup.scrollable, `syncReducedCvGames`, false, `Reduced CV Games`, false, false, null, esgst.syncReducedCvGames),
                    syncNoCvGames: new ToggleSwitch(popup.scrollable, `syncNoCvGames`, false, `No CV Games`, false, false, null, esgst.syncNoCvGames),
                    syncGiveaways: new ToggleSwitch(popup.scrollable, `syncGiveaways`, false, `Giveaways`, false, false, null, esgst.syncGiveaways)
                };
                let id;
                for (id in syncer.switches) {
                    setAutoSync(id, syncer.switches);
                }
                let group = insertHtml(popup.description, `beforeEnd`, `<div class="esgst-button-group"><span>Select:</span></div>`);
                group.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle`, `fa-circle-o-notch fa-spin`, `All`, ``, selectSwitches.bind(null, syncer.switches, `enable`)).set);
                group.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle-o`, `fa-circle-o-notch fa-spin`, `None`, ``, selectSwitches.bind(null, syncer.switches, `disable`)).set);
                group.appendChild(new ButtonSet(`grey`, `grey`, `fa-dot-circle-o`, `fa-circle-o-notch fa-spin`, `Inverse`, ``, selectSwitches.bind(null, syncer.switches, `toggle`)).set);
            }
            syncer.progress = insertHtml(popup.description, `beforeEnd`, `
                <div class="esgst-hidden esgst-popup-progress"></div>
            `);
            syncer.results = insertHtml(popup.scrollable, `afterBegin`, `<div></div>`);
            if (!parameters) {
                syncer.set = new ButtonSet(`green`, `grey`, `fa-refresh`, `fa-times`, `Sync`, `Cancel`, sync.bind(null, syncer, mainCallback), cancelSync.bind(null, syncer, mainCallback));
                popup.description.appendChild(syncer.set.set);
            }
            if (mainCallback) {
                popup.onClose = mainCallback;
            }
            popup.open();
            if (syncer.autoSync) {
                syncer.set.trigger();
            } else if (parameters) {
                syncer.parameters = parameters;
                sync(syncer)
            }
        } else {
            document.body.innerHTML = ``;
            var description = insertHtml(document.body, `beforeEnd`, `
                <div class="description esgst-hidden esgst-popup-progress">
                    <div></div>
                    <div></div>
                </div>
            `);
            syncer.results = description.firstElementChild;
            syncer.progress = description.lastElementChild;
            syncer.parameters = getParameters();
            sync(syncer);
        }
    }

    function setAutoSync(id, switches) {
        let html, i, key, select, toggleSwitch;
        key = id.replace(/^sync/, ``);
        toggleSwitch = switches[id];
        html = `<select class="esgst-auto-sync">`;
        for (i = 0; i < 31; ++i) {
            html += `<option>${i}</option>`;
        }
        html += `</select>`;
        select = insertHtml(toggleSwitch.name, `beforeEnd`, html);
        select.selectedIndex = esgst[`autoSync${key}`];
        select.addEventListener(`change`, function () {
            setSetting(`autoSync${key}`, select.selectedIndex);
            esgst[`autoSync${key}`] = select.selectedIndex;
        });
        if (esgst[`lastSync${key}`]) {
            toggleSwitch.date = insertHtml(toggleSwitch.name, `beforeEnd`, `<span><i class="fa fa-check-circle"></i> Last synced ${new Date(esgst[`lastSync${key}`]).toLocaleString()}</span>`);
        } else {
            toggleSwitch.date = insertHtml(toggleSwitch.name, `beforeEnd`, `<span><i class="fa fa-times"></i> Never synced.</span>`);
        }
    }

    function cancelSync(syncer, callback) {
        syncer.canceled = true;
        if (callback) {
            callback();
        }
    }

    function sync(syncer, mainCallback, callback) {
        if (!esgst.firstInstall) {
            setSetting(`lastSync`, Date.now());
            syncer.results.innerHTML = ``;
            syncer.progress.classList.remove(`esgst-hidden`);
            syncer.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span></span>
            `;
        }
        if (!syncer.autoSync && !esgst.steamId && esgst.username) {
            if (!esgst.firstInstall) {
                syncer.progress.lastElementChild.textContent = `Syncing your Steam id...`;
            }
            request(null, null, `GET`, false, `https://www.steamgifts.com/user/${esgst.username}`, getSteamIdAndContinueSync.bind(null, syncer, completeSync.bind(null, syncer, mainCallback, callback)));
        } else {
            continueSyncStep1(syncer, completeSync.bind(null, syncer, mainCallback, callback));
        }
    }

    function completeSync(syncer, mainCallback, callback) {
        if (!esgst.firstInstall) {
            let currentDate, currentTime, id, string;
            syncer.progress.innerHTML = `Synced!`;
            currentDate = new Date();
            currentTime = currentDate.getTime();
            string = currentDate.toLocaleString();
            [`Groups`, `Whitelist`, `Blacklist`, `HiddenGames`, `Games`, `WonGames`, `ReducedCvGames`, `NoCvGames`, `Giveaways`].forEach(key => {
                id = `sync${key}`;
                if ((syncer.parameters && syncer.parameters[key]) || (!syncer.parameters && esgst.settings[id])) {
                    setSetting(`lastSync${key}`, currentTime);
                    esgst[`lastSync${key}`] = currentTime;
                    if (syncer.switches && syncer.switches[id]) {
                        syncer.switches[id].date.innerHTML = `<i class="fa fa-check-circle"></i> Last synced ${string}`;
                    }
                }
            });
            delLocalValue(`isSyncing`);
        }
        if (callback) {
            callback();
        }
        if (mainCallback) {
            mainCallback();
        }
        if (syncer.set && syncer.autoSync) {
            syncer.set.set.remove();
        }
        if (syncer.parameters && syncer.popup) {
            syncer.popup.icon.classList.remove(`fa-circle-o-notch`, `fa-spin`);
            syncer.popup.icon.classList.add(`fa-check`);
            syncer.popup.title.textContent = `Done! You can close this now.`;
        }
    }

    function getSteamIdAndContinueSync(syncer, callback, response) {
        setSetting(`steamId`, parseHtml(response.responseText).querySelector(`a[href*="/profiles/"]`).getAttribute(`href`).match(/\d+/)[0]).then(continueSyncStep1.bind(null, syncer, callback));
    }

    function continueSyncStep1(syncer, callback) {
        var i, key, n, newGroups, savedGiveaways, savedGroups;
        if (esgst.firstInstall) {
            callback();
        } else if (esgst.sg && ((syncer.parameters && syncer.parameters.Groups) || (!syncer.parameters && (esgst.settings.syncGroups || syncer.autoSync)))) {
            syncer.progress.lastElementChild.textContent = `Syncing your Steam groups...`;
            syncer.groups = {};
            getValue(`groups`).then(value => {
                savedGroups = JSON.parse(value);
                if (!Array.isArray(savedGroups)) {
                    newGroups = [];
                    for (key in savedGroups) {
                        newGroups.push(savedGroups[key]);
                    }
                    savedGroups = newGroups;
                    return new Promise((resolve, reject) => {
                        setValue(`groups`, JSON.stringify(savedGroups)).then(getValue.bind(null, `giveaways`)).then(value => {
                            savedGiveaways = JSON.parse(value);
                            for (key in savedGiveaways) {
                                delete savedGiveaways[key].groups;
                            }
                            setValue(`giveaways`, JSON.stringify(savedGiveaways)).then(resolve);
                        });
                    });
                } else {
                    return new Promise((resolve, reject) => resolve());
                }
            }).then(() => {
                syncer.currentGroups = {};
                for (i = 0, n = savedGroups.length; i < n; ++i) {
                    if (savedGroups[i] && savedGroups[i].member && savedGroups[i].steamId) {
                        syncer.currentGroups[savedGroups[i].steamId] = savedGroups[i].name;
                    }
                }
                syncer.newGroups = {};
                syncer.savedGroups = savedGroups;
                syncGroups(1, syncer, `https://www.steamgifts.com/account/steam/groups/search?page=`, continueSyncStep2.bind(null, syncer, callback));
            });
        } else {
            continueSyncStep2(syncer, callback);
        }
    }

    function syncGroups(nextPage, syncer, url, callback) {
        if (!syncer.canceled) {
            request(null, null, `GET`, false, `${url}${nextPage}`, getGroupsAndContinueSync.bind(null, nextPage, syncer, url, callback));
        }
    }

    function getGroupsAndContinueSync(nextPage, syncer, url, callback, response) {
        var elements, html, id, pagination, responseHtml, missing, neww;
        responseHtml = parseHtml(response.responseText);
        elements = responseHtml.getElementsByClassName(`table__row-outer-wrap`);
        getGroupIds(elements, 0, elements.length, syncer, function () {
            pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
            if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(syncGroups, 0, ++nextPage, syncer, url, callback);
            } else if (!syncer.canceled) {
                lockAndSaveGroups(syncer.groups, true, function () {
                    missing = [];
                    neww = [];
                    for (id in syncer.currentGroups) {
                        if (!syncer.newGroups[id]) {
                            missing.push(`<a href="http://steamcommunity.com/gid/${id}">${syncer.currentGroups[id]}</a>`);
                        }
                    }
                    for (id in syncer.newGroups) {
                        if (!syncer.currentGroups[id]) {
                            neww.push(`<a href="http://steamcommunity.com/gid/${id}">${syncer.newGroups[id]}</a>`);
                        }
                    }
                    html = ``;
                    if (missing.length) {
                        html += `
                            <div>
                                <span class="esgst-bold">Missing groups:</span> ${missing.join(`, `)}
                            </div>
                        `;
                    }
                    if (neww.length) {
                        html += `
                            <div>
                                <span class="esgst-bold">New groups:</span> ${neww.join(`, `)}
                            </div>
                        `;
                    }
                    syncer.results.insertAdjacentHTML(`afterBegin`, html);
                    callback();
                });
            }
        });
    }

    function getGroupIds(elements, i, n, syncer, callback) {
        var avatar, code, element, heading, j, match, name;
        if (!syncer.canceled) {
            if (i < n) {
                element = elements[i];
                heading = element.getElementsByClassName(`table__column__heading`)[0];
                match = heading.getAttribute(`href`).match(/\/group\/(.+?)\/(.+)/);
                code = match[1];
                name = heading.textContent;
                for (j = syncer.savedGroups.length - 1; j >= 0 && syncer.savedGroups[j].code !== code; --j);
                if (j >= 0 && syncer.savedGroups[j].steamId) {
                    syncer.groups[code] = {
                        member: true
                    };
                    syncer.newGroups[syncer.savedGroups[j].steamId] = name;
                    setTimeout(getGroupIds, 0, elements, ++i, n, syncer, callback);
                } else {
                    avatar = element.getElementsByClassName(`table_image_avatar`)[0].style.backgroundImage.match(/\/avatars\/(.+)_medium/)[1];
                    request(null, null, `GET`, false, `/group/${code}/`, getGroupId.bind(null, avatar, code, elements, i, n, name, syncer, callback));
                };
            } else {
                callback();
            }
        }
    }

    function getGroupId(avatar, code, elements, i, n, name, syncer, callback, response) {
        var steamId;
        steamId = parseHtml(response.responseText).getElementsByClassName(`sidebar__shortcut-inner-wrap`)[0].firstElementChild.getAttribute(`href`).match(/\d+/)[0];
        syncer.groups[code] = {
            avatar: avatar,
            code: code,
            member: true,
            name: name,
            steamId: steamId
        };
        syncer.newGroups[steamId] = name;
        setTimeout(getGroupIds, 0, elements, ++i, n, syncer, callback);
    }

    function continueSyncStep2(syncer, callback) {
        if (!syncer.autoSync && ((syncer.parameters && (syncer.parameters.Whitelist || syncer.parameters.Blacklist)) || (!syncer.parameters && (esgst.settings.syncWhitelist || esgst.settings.syncBlacklist)))) {
            syncWhitelistBlacklist(syncer, continueSyncStep3.bind(null, syncer, callback));
        } else {
            continueSyncStep3(syncer, callback);
        }
    }

    function syncWhitelistBlacklist(syncer, callback) {
        if (!syncer.canceled) {
            if ((syncer.parameters && syncer.parameters.Whitelist && syncer.parameters.Blacklist) || (!syncer.parameters && esgst.settings.syncWhitelist && esgst.settings.syncBlacklist)) {
                deleteUserValues([`whitelisted`, `whitelistedDate`, `blacklisted`, `blacklistedDate`], continueWhitelistBlacklistSync.bind(null, syncer, callback));
            } else if ((syncer.parameters && syncer.parameters.Whitelist) || (!syncer.parameters && esgst.settings.syncWhitelist)) {
                deleteUserValues([`whitelisted`, `whitelistedDate`], continueWhitelistBlacklistSync.bind(null, syncer, callback));
            } else {
                deleteUserValues([`blacklisted`, `blacklistedDate`], continueWhitelistBlacklistSync.bind(null, syncer, callback));
            }
        }
    }

    function continueWhitelistBlacklistSync(syncer, callback) {
        if ((syncer.parameters && syncer.parameters.Whitelist) || (!syncer.parameters && esgst.settings.syncWhitelist)) {
            syncer.progress.lastElementChild.textContent = `Syncing your whitelist...`;
            syncer.users = [];
            getWhitelistBlacklist(`whitelisted`, 1, syncer, `https://www.steamgifts.com/account/manage/whitelist/search?page=`, checkBlacklistSync.bind(null, syncer, callback));
        } else {
            syncer.progress.lastElementChild.textContent = `Syncing your blacklist...`;
            syncer.users = [];
            getWhitelistBlacklist(`blacklisted`, 1, syncer, `https://www.steamgifts.com/account/manage/blacklist/search?page=`, completeWhitelistBlacklistSync.bind(null, syncer, callback));
        }
    }

    function getWhitelistBlacklist(key, nextPage, syncer, url, callback) {
        if (!syncer.canceled) {
            request(null, null, `GET`, false, `${url}${nextPage}`, getWhitelistBlacklistAndContinueSync.bind(null, key, nextPage, syncer, url, callback));
        }
    }

    function getWhitelistBlacklistAndContinueSync(key, nextPage, syncer, url, callback, response) {
        var element, elements, i, n, pagination, responseHtml, user;
        responseHtml = parseHtml(response.responseText);
        elements = responseHtml.getElementsByClassName(`table__row-outer-wrap`);
        for (i = 0, n = elements.length; i < n; ++i) {
            element = elements[i];
            user = {
                id: element.querySelector(`[name="child_user_id"]`).value,
                username: element.getElementsByClassName(`table__column__heading`)[0].textContent,
                values: {}
            };
            user.values[key] = true;
            user.values[`${key}Date`] = parseInt(element.querySelector(`[data-timestamp]`).getAttribute(`data-timestamp`)) * 1e3;
            syncer.users.push(user);
        }
        pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
        if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
            setTimeout(getWhitelistBlacklist, 0, key, ++nextPage, syncer, url, callback);
        } else if (!syncer.canceled) {
            callback();
        }
    }

    function checkBlacklistSync(syncer, callback) {
        if ((syncer.parameters && syncer.parameters.Blacklist) || (!syncer.parameters && esgst.settings.syncBlacklist)) {
            syncer.progress.lastElementChild.textContent = `Syncing your blacklist...`;
            getWhitelistBlacklist(`blacklisted`, 1, syncer, `https://www.steamgifts.com/account/manage/blacklist/search?page=`, completeWhitelistBlacklistSync.bind(null, syncer, callback));
        } else {
            completeWhitelistBlacklistSync(syncer, callback);
        }
    }

    function completeWhitelistBlacklistSync(syncer, callback) {
        if (!syncer.canceled) {
            syncer.progress.lastElementChild.textContent = `Saving your whitelist/blacklist (this may take a while)...`;
            saveUsers(syncer.users, callback);
        }
    }

    function continueSyncStep3(syncer, callback) {
        if (!syncer.autoSync && ((syncer.parameters && syncer.parameters.HiddenGames) || (!syncer.parameters && esgst.settings.syncHiddenGames))) {
            syncer.progress.lastElementChild.textContent = `Syncing your hidden games...`;
            syncer.hiddenGames = {
                apps: [],
                subs: []
            };
            syncHiddenGames(1, syncer, `https://www.steamgifts.com/account/settings/giveaways/filters/search?page=`, continueSyncStep4.bind(null, syncer, callback));
        } else {
            continueSyncStep4(syncer, callback);
        }
    }

    function syncHiddenGames(nextPage, syncer, url, callback) {
        request(null, null, `GET`, false, `${url}${nextPage}`, getHiddenGames.bind(null, nextPage, syncer, url, callback));
    }

    function getHiddenGames(nextPage, syncer, url, callback, response) {
        var elements, i, match, n, pagination, responseHtml;
        responseHtml = parseHtml(response.responseText);
        elements = responseHtml.querySelectorAll(`.table__column__secondary-link[href*="store.steampowered.com"]`);
        for (i = 0, n = elements.length; i < n; ++i) {
            match = elements[i].getAttribute(`href`).match(/(app|sub)\/(\d+)/);
            if (match) {
                syncer.hiddenGames[`${match[1]}s`].push(match[2]);
            }
        }
        pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
        if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
            setTimeout(syncHiddenGames, 0, ++nextPage, syncer, url, callback);
        } else {
            createLock(`gameLock`, 300, saveHiddenGames.bind(null, syncer, callback));
        }
    }

    function saveHiddenGames(syncer, callback, deleteLock) {
        var key, i, n, savedGames;
        getValue(`games`).then(value => {
            savedGames = JSON.parse(value);
            for (key in savedGames.apps) {
                delete savedGames.apps[key].hidden;
            }
            for (key in savedGames.subs) {
                delete savedGames.subs[key].hidden;
            }
            for (i = 0, n = syncer.hiddenGames.apps.length; i < n; ++i) {
                if (!savedGames.apps[syncer.hiddenGames.apps[i]]) {
                    savedGames.apps[syncer.hiddenGames.apps[i]] = {};
                }
                savedGames.apps[syncer.hiddenGames.apps[i]].hidden = true;
            }
            for (i = 0, n = syncer.hiddenGames.subs.length; i < n; ++i) {
                if (!savedGames.subs[syncer.hiddenGames.subs[i]]) {
                    savedGames.subs[syncer.hiddenGames.subs[i]] = {};
                }
                savedGames.subs[syncer.hiddenGames.subs[i]].hidden = true;
            }
            return setValue(`games`, JSON.stringify(savedGames));
        }).then(() => {
            deleteLock();
            callback();
        });
    }

    function continueSyncStep4(syncer, callback) {
        if ((syncer.parameters && syncer.parameters.Games) || (!syncer.parameters && (syncer.autoSync || esgst.settings.syncGames))) {
            syncer.progress.lastElementChild.textContent = `Syncing your wishlisted/owned/ignored games...`;
            syncGames(syncer, syncAltAccounts.bind(null, 0, esgst.settings.gc_o_altAccounts.length, syncer, continueSyncStep5.bind(null, syncer, callback)));
        } else {
            continueSyncStep5(syncer, callback);
        }
    }

    function syncGames(syncer, callback) {
        if (esgst.steamApiKey) {
            request(null, null, `GET`, false, `http://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=${esgst.steamApiKey}&steamid=${esgst.steamId}&format=json`, getApiResponseAndContinueSync.bind(null, syncer, callback));
        } else {
            request(null, null, `GET`, false, `http://store.steampowered.com/dynamicstore/userdata?${Math.random().toString().split(`.`)[1]}`, getStoreResponseAndContinueSync.bind(null, syncer, callback, null));
        }
    }

    function syncAltAccounts(i, n, syncer, callback, games, html) {
        var altAccount;
        if (i < n) {
            altAccount = esgst.settings.gc_o_altAccounts[i];
            request(null, null, `GET`, false, `http://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=${esgst.steamApiKey}&steamid=${altAccount.steamId}&format=json`, continueGameSync.bind(null, altAccount, html, syncer, setTimeout.bind(null, syncAltAccounts, 0, ++i, n, syncer, callback)));
        } else {
            setSetting(`gc_o_altAccounts`, esgst.settings.gc_o_altAccounts).then(callback.bind(null, null, html));
        }
    }

    function getApiResponseAndContinueSync(syncer, callback, response) {
        request(null, null, `GET`, false, `http://store.steampowered.com/dynamicstore/userdata?${Math.random().toString().split(`.`)[1]}`, getStoreResponseAndContinueSync.bind(null, syncer, callback, response));
    }

    function getStoreResponseAndContinueSync(syncer, callback, response1, response2) {
        createLock(`gameLock`, 300, continueGameSync.bind(null, null, null, syncer, callback, response1, response2));
    }

    function continueGameSync(altAccount, html, syncer, callback, apiResponse, storeResponse, deleteLock) {
        let addedOwned, id, key, newOwned, numOwned, oldOwned, removedOwned, result, savedGames, storeJson, type;
        try {
            storeJson = JSON.parse(storeResponse.responseText);
        } catch (e) {}
        if (altAccount || (storeJson && storeJson.rgOwnedApps.length > 0)) {
            getValue(`games`).then(value => {
                savedGames = (altAccount && altAccount.games) || JSON.parse(value);
                oldOwned = {
                    apps: [],
                    subs: []
                };
                newOwned = {
                    apps: [],
                    subs: []
                };
                for (id in savedGames.apps) {
                    if (savedGames.apps[id].owned) {
                        oldOwned.apps.push(id);
                        delete savedGames.apps[id].owned;
                    }
                    delete savedGames.apps[id].wishlisted;
                    delete savedGames.apps[id].ignored;
                    if (Object.keys(savedGames.apps[id]).length === 0) {
                        delete savedGames.apps[id];
                    }
                }
                for (id in savedGames.subs) {
                    if (savedGames.subs[id].owned) {
                        oldOwned.subs.push(id);
                        delete savedGames.subs[id].owned;
                    }
                    delete savedGames.subs[id].wishlisted;
                    delete savedGames.subs[id].ignored;
                    if (Object.keys(savedGames.subs[id]).length === 0) {
                        delete savedGames.subs[id];
                    }
                }
                numOwned = 0;
                try {
                    JSON.parse(apiResponse.responseText).response.games.forEach(game => {
                        id = game.appid;
                        if (!savedGames.apps[id]) {
                            savedGames.apps[id] = {};
                        }
                        savedGames.apps[id].owned = true;
                        newOwned.apps.push(id.toString());
                        numOwned += 1;
                    });
                } catch (e) {}
                if (!altAccount) {
                    [
                        {
                            jsonKey: `rgWishlist`,
                            key: `wishlisted`,
                            type: `apps`
                        },
                        {
                            jsonKey: `rgOwnedApps`,
                            key: `owned`,
                            type: `apps`
                        },
                        {
                            jsonKey: `rgOwnedPackages`,
                            key: `owned`,
                            type: `subs`
                        },
                        {
                            jsonKey: `rgIgnoredApps`,
                            key: `ignored`,
                            type: `apps`
                        },
                        {
                            jsonKey: `rgIgnoredPackages`,
                            key: `ignored`,
                            type: `subs`
                        }
                    ].forEach(item => {
                        key = item.key;
                        type = item.type;
                        storeJson[item.jsonKey].forEach(id => {
                            if (!savedGames[type][id]) {
                                savedGames[type][id] = {};
                            }
                            value = savedGames[type][id][key];
                            savedGames[type][id][key] = true;
                            if (key === `owned` && !value) {
                                newOwned[type].push(id.toString());
                                numOwned += 1;
                            }
                        });
                    });
                    return new Promise((resolve, reject) => {
                        getValue(`ownedGames`, 0).then(value => {
                            if (numOwned !== value) {
                                result = 1;
                                setValue(`ownedGames`, numOwned).then(setValue.bind(null, `games`, JSON.stringify(savedGames))).then(() => {
                                    deleteLock();
                                    resolve();
                                });
                            } else {
                                result = 2;
                                setValue(`games`, JSON.stringify(savedGames)).then(() => {
                                    deleteLock();
                                    resolve();
                                });
                            }                            
                        });
                    });
                } else {
                    return new Promise((resolve, reject) => resolve());
                }
            }).then(() => {
                removedOwned = {
                    apps: [],
                    subs: []
                };
                addedOwned = {
                    apps: [],
                    subs: []
                };
                oldOwned.apps.forEach(id => {
                    if (newOwned.apps.indexOf(id) < 0) {
                        removedOwned.apps.push(`<a href="http://store.steampowered.com/app/${id}">${id}</a>`);
                    }
                });
                oldOwned.subs.forEach(id => {
                    if (newOwned.subs.indexOf(id) < 0) {
                        removedOwned.subs.push(`<a href="http://store.steampowered.com/sub/${id}">${id}</a>`);
                    }
                });
                newOwned.apps.forEach(id => {
                    if (oldOwned.apps.indexOf(id) < 0) {
                        addedOwned.apps.push(`<a href="http://store.steampowered.com/app/${id}">${id}</a>`);
                    }
                });
                newOwned.subs.forEach(id => {
                    if (oldOwned.subs.indexOf(id) < 0) {
                        addedOwned.subs.push(`<a href="http://store.steampowered.com/sub/${id}">${id}</a>`);
                    }
                });
                if (!html) {
                    html = ``;
                }
                if (altAccount && (removedOwned.apps.length > 0 || removedOwned.subs.length > 0 || addedOwned.apps.length > 0 && addedOwned.subs.length > 0)) {
                    html += `
                        <div>Alt Account - ${altAccount.name}</div>
                    `;
                }
                if (removedOwned.apps.length > 0) {
                    html += `
                        <div>
                            <span class="esgst-bold">Removed apps:</span> ${removedOwned.apps.join(`, `)}
                        </div>
                    `;
                }
                if (removedOwned.subs.length > 0) {
                    html += `
                        <div>
                            <span class="esgst-bold">Removed packages:</span> ${removedOwned.subs.join(`, `)}
                        </div>
                    `;
                }
                if (addedOwned.apps.length > 0) {
                    html += `
                        <div>
                            <span class="esgst-bold">Added apps:</span> ${addedOwned.apps.join(`, `)}
                        </div>
                    `;
                }
                if (addedOwned.subs.length > 0) {
                    html += `
                        <div>
                            <span class="esgst-bold">Added packages:</span> ${addedOwned.subs.join(`, `)}
                        </div>
                    `;
                }
                callback(savedGames, html, result);
            });
        } else {
            if (!html) {
                html = ``;
            }
            html += `
                <div>An error ocurred when trying to sync your owned/wishlisted/ignored games, either because you are not logged in on Steam through the browser or the Steam API is currently unavailable (try again later).</div>
            `;
            if (!altAccount) {
                result = 3;
                deleteLock();
            }
            callback(savedGames, html, result);
        }
    }

    function continueSyncStep5(syncer, callback, games, html) {
        if (html) {
            syncer.results.insertAdjacentHTML(`afterBegin`, html);
            getSyncGameNames(syncer.results);
        }
        if (!syncer.autoSync && ((syncer.parameters && syncer.parameters.WonGames) || (!syncer.parameters && esgst.settings.syncWonGames))) {
            syncer.progress.lastElementChild.textContent = `Syncing your won games...`;
            getWonGames(`0`, continueSyncStep6.bind(null, syncer, callback));
        } else {
            continueSyncStep6(syncer, callback);
        }
    }

    function getSyncGameNames(context) {
        let i, links;
        links = context.getElementsByTagName(`a`);
        for (i = links.length - 1; i > -1; --i) {
            let link, match;
            link = links[i];
            match = link.getAttribute(`href`).match(/\/(app|sub)\/(.+)/);
            if (match) {
                let id, type;
                type = match[1];
                id = match[2];
                request(null, null, `GET`, false, `http://store.steampowered.com/api/${type === `app` ? `appdetails?appids` : `packagedetails?packageids`}=${id}&filters=basic`, response => {
                    try {
                        link.textContent = JSON.parse(response.responseText)[id].data.name;
                    } catch (e) {
                        link.classList.add(`esgst-red`);
                        link.title = `Unable to retrieve name for this game`;
                    }
                });
            }
        }
    }

    function continueSyncStep6(syncer, callback) {
        if (!syncer.autoSync && ((syncer.parameters && syncer.parameters.ReducedCvGames) || (!syncer.parameters && esgst.settings.syncReducedCvGames))) {
            syncer.progress.lastElementChild.textContent = `Syncing reduced CV games...`;
            request(null, null, `GET`, false, `https://script.google.com/macros/s/AKfycbwJK-7RBh5ghaKprEsmx4DQ6CyXc_3_9eYiOCu3yhI6W4B3W4YN/exec`, syncCvGames.bind(null, syncer, continueSyncStep7.bind(null, syncer, callback)));
        } else {
            continueSyncStep7(syncer, callback);
        }
    }

    function continueSyncStep7(syncer, callback) {
        if (!syncer.autoSync && ((syncer.parameters && syncer.parameters.NoCvGames) || (!syncer.parameters && esgst.settings.syncNoCvGames))) {
            syncer.progress.lastElementChild.textContent = `Syncing no CV games...`;
            request(null, null, `GET`, false, `https://script.google.com/macros/s/AKfycbym0nzeyr3_b93ViuiZRivkBMl9PBI2dTHQxNC0rtgeQSlCTI-P/exec`, syncCvGames.bind(null, syncer, continueSyncStep8.bind(null, syncer, callback)));
        } else {
            continueSyncStep8(syncer, callback);
        }
    }

    function continueSyncStep8(syncer, callback) {
        if (!syncer.autoSync && ((syncer.parameters && syncer.parameters.Giveaways) || (!syncer.parameters && esgst.settings.syncGiveaways)) && esgst.sg) {
            syncer.progress.lastElementChild.textContent = `Syncing your giveaways...`;
            var user = {
                steamId: esgst.steamId,
                username: esgst.username
            };
            var ugd, giveaways;
            getUser(null, user).then(savedUser => {
                if (savedUser) {
                    giveaways = savedUser.giveaways;
                }
                if (!giveaways) {
                    giveaways = {
                        sent: {
                            apps: {},
                            subs: {}
                        },
                        won: {
                            apps: {},
                            subs: {}
                        },
                        sentTimestamp: 0,
                        wonTimestamp: 0
                    };
                    if (savedUser) {
                        ugd = savedUser.ugd;
                        if (ugd) {
                            var ggiveaways = {};
                            if (ugd.sent) {
                                for (var key in ugd.sent.apps) {
                                    giveaways.sent.apps[key] = [];
                                    for (var i = 0, n = ugd.sent.apps[key].length; i < n; ++i) {
                                        ggiveaways[ugd.sent.apps[key][i].code] = ugd.sent.apps[key][i];
                                        giveaways.sent.apps[key].push(ugd.sent.apps[key][i].code);
                                    }
                                }
                                for (var key in ugd.sent.subs) {
                                    giveaways.sent.subs[key] = [];
                                    for (var i = 0, n = ugd.sent.subs[key].length; i < n; ++i) {
                                        ggiveaways[ugd.sent.subs[key][i].code] = ugd.sent.subs[key][i];
                                        giveaways.sent.subs[key].push(ugd.sent.subs[key][i].code);
                                    }
                                }
                                giveaways.sentTimestamp = ugd.sentTimestamp;
                            }
                            if (ugd.won) {
                                for (var key in ugd.won.apps) {
                                    giveaways.won.apps[key] = [];
                                    for (var i = 0, n = ugd.won.apps[key].length; i < n; ++i) {
                                        ggiveaways[ugd.won.apps[key][i].code] = ugd.won.apps[key][i];
                                        giveaways.won.apps[key].push(ugd.won.apps[key][i].code);
                                    }
                                }
                                for (var key in ugd.won.subs) {
                                    giveaways.won.subs[key] = [];
                                    for (var i = 0, n = ugd.won.subs[key].length; i < n; ++i) {
                                        ggiveaways[ugd.won.subs[key][i].code] = ugd.won.subs[key][i];
                                        giveaways.won.subs[key].push(ugd.won.subs[key][i].code);
                                    }
                                }
                                giveaways.wonTimestamp = ugd.wonTimestamp;
                            }
                            if (Object.keys(ggiveaways).length > 0) {
                                lockAndSaveGiveaways(ggiveaways);
                            }
                        }
                    }
                }
                var UGD = {
                    Key: `sent`
                };
                UGD.giveaways = {};
                if (!giveaways.version) {
                    giveaways.sent = {
                        apps: {},
                        subs: {}
                    };
                    giveaways.sentTimestamp = 0;
                    giveaways.version = `7.11.1`;
                }
                getUGDGiveaways(UGD, giveaways, 1, `/user/${esgst.username}/search?page=`, esgst.username, function (giveaways) {
                    user.values = {
                        giveaways: giveaways,
                        ugd: null
                    };
                    saveUser(null, null, user, callback);
                });
            });
        } else {
            callback();
        }
    }

    function lockAndSaveGiveaways(giveaways, callback) {
        createLock(`giveawayLock`, 300, saveGiveaways.bind(null, giveaways, callback));
    }

    function saveGiveaways(giveaways, callback, deleteLock) {
        var key, savedGiveaways, subKey;
        getValue(`giveaways`, `{}`).then(value => {
            savedGiveaways = JSON.parse(value);
            for (key in giveaways) {
                if (savedGiveaways[key]) {
                    for (subKey in giveaways[key]) {
                        savedGiveaways[key][subKey] = giveaways[key][subKey];
                    }
                } else {
                    savedGiveaways[key] = giveaways[key];
                }
            }
            return setValue(`giveaways`, JSON.stringify(savedGiveaways));
        }).then(() => {
            deleteLock();
            if (callback) {
                callback();
            }
        });
    }

    function lockAndSaveGroups(groups, sync, callback) {
        createLock(`groupLock`, 300, saveGroups.bind(null, groups, sync, callback));
    }

    function saveGroups(groups, sync, callback, deleteLock) {
        var code, i, key, n, savedGroups;
        getValue(`groups`, `[]`).then(value => {
            savedGroups = JSON.parse(value);
            if (!Array.isArray(savedGroups)) {
                let newGroups = [];
                for (key in savedGroups) {
                    newGroups.push(savedGroups[key]);
                }
                savedGroups = newGroups;
            }
            if (sync) {
                for (i = 0, n = savedGroups.length; i < n; ++i) {
                    if (savedGroups[i]) {
                        delete savedGroups[i].member;
                    }
                }
            }
            for (code in groups) {
                for (i = 0, n = savedGroups.length; i < n && savedGroups[i].code !== code; ++i);
                if (i < n) {
                    for (key in groups[code]) {
                        if (savedGroups[i]) {
                            savedGroups[i][key] = groups[code][key];
                        }
                    }
                } else {
                    savedGroups.push(groups[code]);
                }
            }
            return setValue(`groups`, JSON.stringify(savedGroups));
        }).then(() => {
            deleteLock();
            if (callback) {
                callback();
            }
        });
    }

    function sortArray(Array) {
        return Array.sort(function (A, B) {
            return A.localeCompare(B, {
                sensitivity: `base`
            });
        });
    }

    function sortArrayByKey(array, key) {
        return array.sort(function (a, b) {
            return a[key].localeCompare(b[key], {
                sensitivity: `base`
            });
        });
    }

    function sortArrayByNumberKey(array, numberKey, desc) {
        let n = desc ? -1 : 1;
        return array.sort(function (a, b) {
            if (a[numberKey] < b[numberKey]) {
                return -1 * n;
            } else if (a[numberKey] > b[numberKey]) {
                return 1 * n;
            } else {
                return 0;
            }
        });
    }

    function setSiblingsOpacity(element, Opacity) {
        var Siblings, I, N;
        Siblings = element.parentElement.children;
        for (I = 0, N = Siblings.length; I < N; ++I) {
            if (Siblings[I] != element) {
                Siblings[I].style.opacity = Opacity;
            }
        }
    }

    function setHoverOpacity(element, EnterOpacity, LeaveOpacity) {
        element.addEventListener(`mouseenter`, function () {
            element.style.opacity = EnterOpacity;
        });
        element.addEventListener(`mouseleave`, function () {
            element.style.opacity = LeaveOpacity;
        });
    }

    /*
        * Helper Functions
        */

    /* Lock */

    function createUuid(c) {
        var r, v;
        r = Math.random() * 16 | 0;
        v = c === `x` ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    }

    function createLock(key, threshold, callback) {
        var lock;
        lock = {
            callback: callback,
            continue: false,
            key: key,
            threshold: threshold,
            uuid: `xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`.replace(/[xy]/g, createUuid)
        };
        checkLock(lock);
    }

    function checkLock(lock) {
        var locked;
        getValue(lock.key, `{}`).then(value => {
            locked = JSON.parse(value);
            if (!locked || !locked.uuid || locked.timestamp < Date.now() - (lock.threshold + 1000)) {
                setValue(lock.key, JSON.stringify({
                    timestamp: Date.now(),
                    uuid: lock.uuid
                })).then(() => {
                    setTimeout(function () {
                        getValue(lock.key, `{}`).then(value => {
                            locked = JSON.parse(value);
                            if (locked && locked.uuid === lock.uuid) {
                                setTimeout(lock.callback, 0, function () {
                                    setValue(lock.key, `{}`);
                                });
                            } else {
                                setTimeout(checkLock, 0, lock);
                            }
                        });
                    }, lock.threshold / 2);
                });
            } else {
                setTimeout(checkLock, lock.threshold / 3, lock);
            }
        });
    }

    function lookForPopups(response) {
        var popup, responseHtml;
        responseHtml = parseHtml(response.responseText);
        popup = responseHtml.querySelector(`.popup--gift-sent, .popup--gift-received`);
        if (popup) {
            document.body.appendChild(popup);
            new Popup(null, null, true, false, popup).open();
        }
    }

    function createTooltip(context, message) {
        var popout;
        popout = new Popout(`esgst-feature-description markdown`, context, 100);
        popout.popout.style.maxHeight = `300px`;
        popout.popout.style.overflow = `auto`;
        popout.popout.innerHTML = message;
    }

    function createOptions(options) {
        var context, elements, id, switches;
        context = document.createElement(`div`);
        elements = {};
        switches = {};
        options.forEach(option => {
            if (option.check) {
                id = option.id;
                elements[id] = insertHtml(context, `beforeEnd`, `
                    <div></div>
                `);
                switches[id] = new ToggleSwitch(elements[id], id, false, option.description, false, false, option.tooltip, esgst[id]);
            }
        });
        options.forEach(option => {
            let enabled = esgst[option.id];
            if (switches[option.id]) {
                if (option.dependencies) {
                    option.dependencies.forEach(dependency => {
                        if (elements[dependency]) {
                            switches[option.id].dependencies.push(elements[dependency]);
                            if (!enabled) {
                                elements[dependency].classList.add(`esgst-hidden`);
                            }
                        }
                    });
                }
                if (option.exclusions) {
                    option.exclusions.forEach(exclusion => {
                        if (elements[exclusion]) {
                            switches[option.id].exclusions.push(elements[exclusion]);
                            if (enabled) {
                                elements[exclusion].classList.add(`esgst-hidden`);
                            }
                        }
                    });
                }
            }
        });
        return context;
    }

    function createResults(Context, element, Results) {
        var I, N, Key;
        for (I = 0, N = Results.length; I < N; ++I) {
            Context.insertAdjacentHTML(`beforeEnd`, `
                <div class="esgst-hidden">
                    ${Results[I].Icon}
                    <span class="esgst-bold">${Results[I].Description} (<span>0</span>):</span>
                    <span class="esgst-popup-actions"></span>
                </div>
            `);
            Key = Results[I].Key;
            element[Key] = Context.lastElementChild;
            element[`${Key}Count`] = element[Key].firstElementChild.nextElementSibling.firstElementChild;
            element[`${Key}Users`] = element[Key].lastElementChild;
        }
    }

    function goToComment(hash, element) {
        var element, ID, Top, Permalink;
        if (!hash) {
            hash = location.hash;
        }
        ID = hash.replace(/#/, ``);
        if ((ID || element) && !location.pathname.match(/^\/account/)) {
            if (!element && ID) {
                element = document.getElementById(ID);
            }
            if (element) {
                Top = element.offsetTop;
                scrollTo(0, Top);
                scrollBy(0, -esgst.commentsTop);
                Permalink = document.getElementsByClassName(esgst.sg ? `is_permalink` : `author_permalink`)[0];
                if (Permalink) {
                    Permalink.remove();
                }
                element = element.getElementsByClassName(esgst.sg ? `comment__username` : `author_avatar`)[0];
                if (element) {
                    element.insertAdjacentHTML(esgst.sg ? `beforeBegin` : `afterEnd`, `
                        <i class="fa fa-share is_permalink author_permalink"></i>
                    `);
                }
            }
        }
    }

    function syncCvGames(syncer, callback, response) {
        lockAndSaveGames(JSON.parse(response.responseText).success, callback);
    }

        function lockAndSaveGames(games, callback) {
        createLock(`gameLock`, 300, saveGames.bind(null, games, callback));
    }

    function saveGames(games, callback, deleteLock) {
        var key, saved, subKey;
        getValue(`games`).then(value => {
            saved = JSON.parse(value);
            for (key in games.apps) {
                if (saved.apps[key]) {
                    for (subKey in games.apps[key]) {
                        if (games.apps[key][subKey] === null) {
                            delete saved.apps[key][subKey];
                        } else {
                            saved.apps[key][subKey] = games.apps[key][subKey];
                        }
                    }
                } else {
                    saved.apps[key] = games.apps[key];
                }
                if (!saved.apps[key].tags) {
                    delete saved.apps[key].tags;
                }
            }
            for (key in games.subs) {
                if (saved.subs[key]) {
                    for (subKey in games.subs[key]) {
                        if (games.subs[key][subKey] === null) {
                            delete saved.subs[key][subKey];
                        } else {
                            saved.subs[key][subKey] = games.subs[key][subKey];
                        }
                    }
                } else {
                    saved.subs[key] = games.subs[key];
                }
                if (!saved.subs[key].tags) {
                    delete saved.subs[key].tags;
                }
            }
            return setValue(`games`, JSON.stringify(saved));
        }).then(() => {
            deleteLock();
            if (callback) {
                callback();
            }
        });
    }

    function formatDate(EntryDate) {
        var Months, Hours, Minutes, OutputDate, Suffix;
        Months = [`Jan`, `Feb`, `Mar`, `Apr`, `May`, `Jun`, `Jul`, `Aug`, `Sep`, `Oct`, `Nov`, `Dec`];
        Hours = EntryDate.getHours();
        Minutes = EntryDate.getMinutes();
        Minutes = (Minutes > 9) ? Minutes : (`0${Minutes}`);
        OutputDate = `${Months[EntryDate.getMonth()]} ${EntryDate.getDate()}, ${EntryDate.getFullYear()} `;
        if (Hours >= 12) {
            if (Hours > 12) {
                Hours -= 12;
            }
            Suffix = `pm`;
        } else {
            if (Hours === 0) {
                Hours = 12;
            }
            Suffix = `am`;
        }
        OutputDate += `${Hours}:${Minutes} ${Suffix}`;
        return OutputDate;
    }

    /*
        * Features
        */

    /* [SK] Shortcut Keys */

    function loadSk() {
        let methods = {};
        if (esgst.sk_cp) {
            methods[esgst.sk_closePopups] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/)) {
                    let buttons = document.querySelectorAll(`.b-close, .esgst-popup-close`), i;
                    for (i = buttons.length - 1; i > -1; --i) {
                        buttons[i].click();
                    }
                    event.preventDefault();
                }
            };
        }
        if (esgst.sk_sb) {
            methods[esgst.sk_searchBox] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/)) {
                    let search = document.getElementsByClassName(`sidebar__search-input`)[0];
                    if (search) {
                        search.focus();
                        event.preventDefault();
                    }
                }
            };
        }
        if (esgst.sk_fp) {
            methods[esgst.sk_firstPage] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.paginationNavigation && esgst.currentPage > 1) {
                    location.href = `${esgst.searchUrl}1`;
                    event.preventDefault();
                }
            };
        }
        if (esgst.sk_pp) {
            methods[esgst.sk_previousPage] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.paginationNavigation && esgst.currentPage > 1) {
                    location.href = `${esgst.searchUrl}${esgst.currentPage - 1}`;
                    event.preventDefault();
                }
            };
        }
        if (esgst.sk_np) {
            methods[esgst.sk_nextPage] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.paginationNavigation && esgst.currentPage < esgst.lastPage) {
                    location.href = `${esgst.searchUrl}${esgst.currentPage + 1}`;
                    event.preventDefault();
                }
            };
        }
        if (esgst.sk_lp) {
            methods[esgst.sk_lastPage] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.paginationNavigation && esgst.currentPage < esgst.lastPage && esgst.lastPage !== 999999999) {
                    location.href = `${esgst.searchUrl}${esgst.lastPage}`;
                    event.preventDefault();
                }
            };
        }
        if (esgst.sk_tf) {
            methods[esgst.sk_toggleFilters] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/)) {
                    let toggle = document.querySelector(`.esgst-gf-toggle-switch`);
                    if (toggle) {
                        toggle.click();
                        event.preventDefault();
                    }
                }
            };
        }
        if (esgst.sk_hg) {
            methods[esgst.sk_hideGame] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.giveawayPath) {
                    let button = (document.getElementsByClassName(`popup--hide-games`)[0].style.display && document.getElementsByClassName(`popup--hide-games`)[0].style.display !== `none` && document.getElementsByClassName(`js__submit-hide-games`)[0]) || document.querySelector(`.esgst-ochgb, .giveaway__hide, .featured__giveaway__hide`);
                    if (button) {
                        button.click();
                        event.preventDefault();
                    }
                }
            };
        }
        if (esgst.sk_hga) {
            methods[esgst.sk_hideGiveaway] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.giveawayPath) {
                    let button = document.querySelector(`.esgst-gf-hide-button, .esgst-gf-unhide-button`);
                    if (button) {
                        button.firstElementChild.click();
                        event.preventDefault();
                    }
                }
            };
        }
        if (esgst.sk_ge) {
            methods[esgst.sk_giveawayEntry] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.enterGiveawayButton) {
                    if (esgst.enterGiveawayButton.classList.contains(`is-hidden`)) {
                        esgst.leaveGiveawayButton.click();
                    } else {
                        esgst.enterGiveawayButton.click();
                    }
                    event.preventDefault();
                }
            };
        }
        if (esgst.sk_c) {
            methods[esgst.sk_creator] = event => {
                if (event.target.tagName.match(/^(INPUT|TEXTAREA)$/)) {
                    let text = event.target.value;
                    let end = event.target.selectionEnd;
                    let creator = document.querySelector(`.featured__column--width-fill.text-right a, .comment__username, .author_name`);
                    if (creator) {
                        creator = creator.textContent;
                        let range = end + creator.length;
                        event.target.value = `${text.slice(0, event.target.selectionStart)}${creator}${text.slice(end)}`;
                        event.target.setSelectionRange(range, range);
                        event.target.focus();
                        event.preventDefault();
                    }
                }
            };
        }
        if (esgst.sk_rb) {
            methods[esgst.sk_replyBox] = event => {
                if (!event.target.tagName.match(/^(INPUT|TEXTAREA)$/) && esgst.replyBox) {
                    esgst.replyBox.getElementsByTagName(`textarea`)[0].focus();
                    event.preventDefault();
                }
            };
        }
        if (esgst.sk_ru) {
            methods[esgst.sk_replyUser] = event => {
                if (event.target.tagName === `TEXTAREA`) {
                    let text = event.target.value;
                    let end = event.target.selectionEnd;
                    let user = event.target.closest(`.comment__children, .comment_children`);
                    user = (user && user.closest(`.comment, .comment_outer`).querySelector(`.comment__username, .author_name`)) || document.querySelector(`.featured__column--width-fill.text-right a, .comment__username, .author_name`);
                    if (user) {
                        user = user.textContent;
                        let range = end + user.length;
                        event.target.value = `${text.slice(0, event.target.selectionStart)}${user}${text.slice(end)}`;
                        event.target.setSelectionRange(range, range);
                        event.target.focus();
                        event.preventDefault();
                    }
                }
            };
        }
        if (esgst.sk_sr) {
            methods[esgst.sk_submitReply] = event => {
                if (event.target.tagName === `TEXTAREA`) {
                    let reply = event.target.closest(`.comment, .reply_form, .esgst-popup`);
                    if (reply) {
                        let button = reply.querySelector(`.esgst-button-set >:first-child, .js_submit`);
                        if (button) {
                            button.click();
                            event.preventDefault();
                        }
                    }
                }
            };
        }
        if (Object.keys(methods).length > 0) {
            document.addEventListener(`keydown`, event => {
                event.stopPropagation();
                let value = ``;
                if (event.ctrlKey) {
                    value += `ctrlKey + `;
                } else if (event.shiftKey) {
                    value += `shiftKey + `;
                } else if (event.altKey) {
                    value += `altKey + `;
                }
                value += event.key.toLowerCase();
                if (methods[value]) {
                    methods[value](event);
                }
            });
        }
    }

    function addIbBorders(context) {
        var elements, i, n;
        elements = context.querySelectorAll(`.giveaway_image_avatar, .featured_giveaway_image_avatar, :not(.esgst-ggl-panel) .table_image_avatar`);
        for (i = 0, n = elements.length; i < n; ++i) {
            elements[i].classList.add(`esgst-ib-user`);
        }
        elements = context.querySelectorAll(`.giveaway_image_thumbnail, .giveaway_image_thumbnail_missing, .table_image_thumbnail, .table_image_thumbnail_missing`);
        for (i = 0, n = elements.length; i < n; ++i) {
            elements[i].classList.add(`esgst-ib-game`);
        }
    }

    function refreshHeaderElements(context) {
        return new Promise((resolve, reject) => {
            let currentTime, i, navigation;
            navigation = context.querySelector(`.nav__right-container, .header_inner_wrap nav`);
            esgst.mainButton = navigation.querySelector(`.nav__button--is-dropdown, .nav_btn[href^="/user/"]`);
            if (esgst.sg) {
                esgst.pointsContainer = esgst.mainButton.firstElementChild;
                esgst.points = parseInt(esgst.pointsContainer.textContent.match(/\d+/)[0]);
                if (esgst.ttpcc && esgst.points < 400) {
                    let nextRefresh = 60 - new Date().getMinutes();
                    while (nextRefresh > 15) {
                        nextRefresh -= 15;
                    }
                    esgst.pointsContainer.title = `${getTtecTime(Math.round((nextRefresh + (15 * Math.floor((400 - esgst.points) / 6))) * 100) / 100)} to 400P`;
                }
                esgst.levelContainer = esgst.mainButton.lastElementChild;
                esgst.level = parseInt(esgst.levelContainer.textContent.match(/\d+/)[0]);
                esgst.createdButton = navigation.getElementsByClassName(`fa-gift`)[0];
                if (esgst.createdButton) {
                    esgst.createdButton = esgst.createdButton.closest(`.nav__button-container`);
                }
                esgst.wonButton = navigation.getElementsByClassName(`fa-trophy`)[0];
                if (esgst.wonButton) {
                    esgst.wonButton = esgst.wonButton.closest(`.nav__button-container`);
                    let won = esgst.wonButton.getElementsByClassName(`nav__notification`)[0];
                    if (won && won.textContent !== getLocalValue(`wonCount`)) {
                        getWonGames(won.textContent);
                    }
                }
                if (esgst.hr_g && context !== document) {
                    esgst.wishlist = 0;
                    currentTime = Date.now();
                    getGiveaways(context, false, null, true).then(giveaways => {
                        for (i = giveaways.length - 1; i >= -1; --i) {
                            giveaway = giveaways[i];
                            if (giveaway && giveaway.level <= esgst.level && !giveaway.pinned && !giveaway.entered && (!esgst.giveaways[giveaway.code] || (!esgst.giveaways[giveaway.code].visited && !esgst.giveaways[giveaway.code].hidden)) && (!esgst.hr_w_h || giveaway.endTime - currentTime < esgst.hr_w_hours * 3600000)) {
                                esgst.wishlist += 1;
                            }
                        }
                        esgst.inboxButton = navigation.getElementsByClassName(`fa-envelope`)[0];
                        if (esgst.inboxButton) {
                            esgst.inboxButton = esgst.inboxButton.closest(`.nav__button-container, .nav_btn_container`);
                            esgst.messageCountContainer = esgst.inboxButton.querySelector(`.nav__notification, .message_count`);
                        }
                        esgst.messageCount = esgst.messageCountContainer ? esgst.messageCountContainer.textContent : ``;
                        resolve();
                    });
                } else {
                    esgst.wishlist = 0;
                    esgst.inboxButton = navigation.getElementsByClassName(`fa-envelope`)[0];
                    if (esgst.inboxButton) {
                        esgst.inboxButton = esgst.inboxButton.closest(`.nav__button-container, .nav_btn_container`);
                        esgst.messageCountContainer = esgst.inboxButton.querySelector(`.nav__notification, .message_count`);
                    }
                    esgst.messageCount = esgst.messageCountContainer ? esgst.messageCountContainer.textContent : ``;
                    resolve();
                }
            } else {
                esgst.inboxButton = navigation.getElementsByClassName(`fa-envelope`)[0];
                if (esgst.inboxButton) {
                    esgst.inboxButton = esgst.inboxButton.closest(`.nav__button-container, .nav_btn_container`);
                    esgst.messageCountContainer = esgst.inboxButton.querySelector(`.nav__notification, .message_count`);
                }
                esgst.messageCount = esgst.messageCountContainer ? esgst.messageCountContainer.textContent : ``;
                resolve();
            }
        });
    }

    function getWonGames(count, callback) {
        request(null, null, `GET`, false, `/giveaways/won`, response => {
            let element, elements, i, id, info, responseHtml;
            responseHtml = parseHtml(response.responseText);
            getValue(`games`).then(value => {
                savedGames = JSON.parse(value);
                for (id in savedGames.apps) {
                    if (savedGames.apps[id].won) {
                        savedGames.apps[id].won = null;
                    }
                }
                for (id in savedGames.subs) {
                    if (savedGames.subs[id].won) {
                        savedGames.subs[id].won = null;
                    }
                }
                elements = responseHtml.querySelectorAll(`.table__gift-feedback-awaiting-reply[data-feedback="1"]:not(.is-hidden)`);
                for (i = elements.length - 1; i > -1; --i) {
                    element = elements[i].closest(`.table__row-inner-wrap`);
                    if (element.querySelector(`.table__gift-feedback-awaiting-reply[data-feedback="0"]:not(.is-hidden), [data-popup="popup--not-received"]`)) {
                        info = getGameInfo(element);
                        if (!savedGames[info.type][info.id]) {
                            savedGames[info.type][info.id] = {};
                        }
                        savedGames[info.type][info.id].won = 1;
                    }
                }
                lockAndSaveGames(savedGames, () => {
                    setLocalValue(`wonCount`, count);
                    if (callback) {
                        callback();
                    }
                });
            });
        });
    }

    function getHrCache() {
        let cache = {
            mainButton: esgst.mainButton.outerHTML,
            inboxButton: esgst.inboxButton.outerHTML,
            timestamp: Date.now(),
            username: esgst.username
        };
        if (esgst.sg) {
            cache.createdButton = esgst.createdButton.outerHTML;
            cache.wonButton = esgst.wonButton.outerHTML;
            cache.wishlist = esgst.wishlist;
        }
        return cache;
    }

    function startHeaderRefresher(hr) {
        let cache;
        request(null, null, `GET`, false, esgst.sg ? `/giveaways/search?type=wishlist` : `/`, response => {
            refreshHeaderElements(parseHtml(response.responseText)).then(() => {
                cache = getHrCache();
                setLocalValue(`hrCache`, JSON.stringify(cache));
                refreshHeader(cache, hr);
                hr.refresher = setTimeout(continueHeaderRefresher, esgst.hr_minutes * 60000, hr);
            });
        });
    }

    function continueHeaderRefresher(hr) {
        let cache = JSON.parse(getLocalValue(`hrCache`));
        if (cache.username !== esgst.username || Date.now() - cache.timestamp  > esgst.hr_minutes * 60000) {
            cache.timestamp = Date.now();
            setLocalValue(`hrCache`, JSON.stringify(cache));
            request(null, null, `GET`, false, esgst.sg ? `/giveaways/search?type=wishlist` : `/`, response => {
                refreshHeaderElements(parseHtml(response.responseText)).then(() => {
                    cache = getHrCache();
                    setLocalValue(`hrCache`, JSON.stringify(cache));
                    refreshHeader(cache, hr, true);
                    hr.refresher = setTimeout(continueHeaderRefresher, esgst.hr_minutes * 60000, hr);
                });
            });
        } else {
            refreshHeader(cache, hr);
            setTimeout(continueHeaderRefresher, esgst.hr_minutes * 60000, hr);
        }
    }

    function refreshHeader(cache, hr, notify) {
        refreshHeaderElements(document).then(() => {
            esgst.mainButton.outerHTML = cache.mainButton;
            if (esgst.sg) {
                esgst.createdButton.outerHTML = cache.createdButton;
                esgst.wonButton.outerHTML = cache.wonButton;
            }
            esgst.inboxButton.outerHTML = cache.inboxButton;
            return refreshHeaderElements(document);
        }).then(() => {
            if (esgst.hr) {
                notifyHrChange(hr, esgst.wishlist || cache.wishlist, notify);
            }
            if (esgst.lpv) {
                setLpvStyle();
            }
        });
    }

    function notifyHrChange(hr, wishlist, notify) {
        let canvas, context, deliveredNotification, image, messageNotification, messageCount, notification, pointsNotification, title, wishlistNotification;
        messageCount = esgst.messageCount;
        if (messageCount !== hr.messageCount) {
            messageNotification = messageCount - hr.messageCount;
            if (messageNotification < 0) {
                messageNotification = 0;
            }
            hr.messageCount = messageCount;
        } else {
            messageNotification = 0;
        }
        if (messageCount > 0 && esgst.hr_m) {
            canvas = document.createElement(`canvas`);
            image = document.createElement(`img`);
            canvas.width = 16;
            canvas.height = 16;
            context = canvas.getContext(`2d`);
            image.crossOrigin = `esgst`;
            image.onload = () => {
                context.drawImage(image, 0, 0);
                context.fillStyle = `#e9202a`;
                context.fillRect(8, 6, 8, 10);
                context.fillStyle = `#fff`;
                context.font = `bold 10px Arial`;
                context.textAlign = `left`;
                if (messageCount > 9) {
                    messageCount = `+`;
                }
                context.fillText(messageCount, 9, 14);
                esgst.favicon.href = canvas.toDataURL(`image/png`);
            };
            image.src = esgst.menuPath ? esgst.icon : esgst[`${esgst.name}Icon`];
        } else {
            esgst.favicon.href = esgst.menuPath ? esgst.icon : esgst[`${esgst.name}Icon`];
        }
        if (esgst.sg) {
            if (hr.points !== esgst.points) {
                hr.points = esgst.points;
                updateElgbButtons(hr.points);
                if (esgst.points >= 400) {
                    pointsNotification = true;
                }
            }
            title = ``;
            delivered = esgst.wonButton.getElementsByClassName(`fade_infinite`)[0];
            if (delivered) {
                if (!hr.delivered) {
                    deliveredNotification = true;
                    hr.delivered = true;
                } else {
                    deliveredNotification = false;
                }
            } else {
                hr.delivered = deliveredNotification = false;
            }
            if (esgst.hr_g && delivered) {
                title += ` `;
            }
            if (wishlist) {
                if (hr.wishlist !== wishlist) {
                    wishlistNotification = wishlist - hr.wishlist;
                    if (wishlistNotification < 0) {
                        wishlistNotification = 0;
                    }
                    hr.wishlist = wishlist;
                } else {
                    wishlistNotification = 0;
                }
            } else {
                hr.wishlist = wishlistNotification = 0;
            }
            if (esgst.hr_w && wishlist) {
                title += ` `;
            }
            if (esgst.hr_p) {
                title += `(${esgst.points}P) `;
            }
            title += esgst.originalTitle;
            if (document.title !== title) {
                document.title = title;
            }
        }
        if (notify) {
            notification = ``;
            if (pointsNotification && esgst.hr_fp) {
                notification += `You have ${esgst.points}P.\n\n`;
            }
            if (messageNotification && esgst.hr_m && esgst.hr_m_n) {
                notification += `You have ${messageNotification} new messages.\n\n`;
            }
            if (deliveredNotification && esgst.hr_g && esgst.hr_g_n) {
                notification += `You have new gifts delivered.\n\n`;
            }
            if (wishlistNotification && esgst.hr_w && esgst.hr_w_n) {
                if (esgst.hr_w_h) {
                    notification += `You have ${wishlistNotification} new wishlist giveaways ending in ${esgst.hr_w_hours} hours.`;
                } else {
                    notification += `You have ${wishlistNotification} new wishlist giveaways.`;
                }
            }
            if (notification) {
                showNotification(notification);
            }
        }
    }

    function showNotification(notification) {
        Notification.requestPermission().then(result => {
            if (result === `granted`) {
                new Notification(`ESGST Notification`, {
                    body: notification,
                    icon: `https://dl.dropboxusercontent.com/s/lr3t3bxrxfxylqe/esgstIcon.ico?raw=1`,
                    tag: notification
                });
            }
        });
    }

    function setLpvStyle() {
        var active, apps, base, cv, currentTime, dif, firstBar, game, giveaway, giveaways, i, id, level, n, percentage, progress, projectedFirstBar, projectedSecondBar, secondBar, savedUser, sent, style, subs, value, values;
        level = esgst.levelContainer.getAttribute(`title`).match(/(\d+)\.(\d+)/);
        base = parseInt(level[1]);
        percentage = parseInt(level[2]);
        dif = 100 - percentage;
        progress = parseInt(percentage * 1.85);
        firstBar = `${progress}px`;
        secondBar = progress >= 156 ? `${progress - 156 - 0.59}px` : `0`;
        savedUser = esgst.users.users[esgst.steamId];
        cv = 0;
        currentTime = Date.now();
        if (savedUser) {
            giveaways = savedUser.giveaways;
            if (giveaways) {
                apps = giveaways.sent.apps;
                for (id in apps) {
                    active = 0;
                    sent = 0;
                    for (i = 0, n = apps[id].length; i < n; ++i) {
                        giveaway = esgst.giveaways[apps[id][i]];
                        if (giveaway) {
                            value = giveaway.points;
                            if (giveaway.entries >= 5 || (!giveaway.inviteOnly && !giveaway.group && !giveaway.whitelist)) {
                                if (Array.isArray(giveaway.winners)) {
                                    if (giveaway.winners.length > 0) {
                                        giveaway.winners.forEach(winner => {
                                            if (winner.received) {
                                                sent += 1;
                                            }
                                        });
                                    } else if (currentTime < giveaway.endTime) {
                                        active += giveaway.copies;
                                    }
                                } else if (giveaway.winners > 0) {
                                    sent += Math.min(giveaway.entries, giveaway.winners);
                                }
                            } else if (currentTime < giveaway.endTime) {
                                active += giveaway.copies;
                            }
                        }
                    }
                    if (active > 0) {
                        game = esgst.games.apps[id];
                        if (game) {
                            if (game.noCV) {
                                value = 0;
                            } else if (game.reducedCV) {
                                value *= 0.15;
                            }
                        }
                        if (sent > 5 || sent + active > 5) {
                            for (i = 0, n = sent - 5; i < n; ++i) {
                                value *= 0.90;
                            }
                            for (i = 0; i < active; ++i) {
                                value *= 0.90;
                                cv += value;
                            }
                        } else {
                            cv += (value * active);
                        }
                    }
                }
                subs = giveaways.sent.subs;
                for (id in subs) {
                    active = 0;
                    sent = 0;
                    for (i = 0, n = subs[id].length; i < n; ++i) {
                        giveaway = esgst.giveaways[subs[id][i]];
                        if (giveaway) {
                            value = giveaway.points;
                            if (giveaway.entries >= 5 || (!giveaway.inviteOnly && !giveaway.group && !giveaway.whitelist)) {
                                if (Array.isArray(giveaway.winners)) {
                                    if (giveaway.winners.length > 0) {
                                        giveaway.winners.forEach(winner => {
                                            if (winner.received) {
                                                sent += 1;
                                            }
                                        });
                                    } else if (currentTime < giveaway.endTime) {
                                        active += giveaway.copies;
                                    }
                                } else if (giveaway.winners > 0) {
                                    sent += Math.min(giveaway.entries, giveaway.winners);
                                }
                            } else if (currentTime < giveaway.endTime) {
                                active += giveaway.copies;
                            }
                        }
                    }
                    if (active > 0) {
                        game = esgst.games.subs[id];
                        if (game) {
                            if (game.noCV) {
                                value = 0;
                            } else if (game.reducedCV) {
                                value *= 0.15;
                            }
                        }
                        if (sent > 5 || sent + active > 5) {
                            for (i = 0, n = sent - 5; i < n; ++i) {
                                value *= 0.90;
                            }
                            for (i = 0; i < active; ++i) {
                                value *= 0.90;
                                cv += value;
                            }
                        } else {
                            cv += (value * active);
                        }
                    }
                }
            }
        }
        if (cv > 0) {
            cv = Math.round(cv * 100) / 100;
            values = [0, 0.01, 25.01, 50.01, 100.01, 250.01, 500.01, 1000.01, 2000.01, 3000.01, 5000.01];
            percentage = parseInt(Math.round((percentage + (cv / values[parseInt(base)] * 100)) * 100) / 100);
            progress = percentage > dif ? 100 : parseInt(percentage * 1.85);
            projectedFirstBar = `${progress}px`;
            projectedSecondBar = progress >= 156 ? `${progress - 156 - 0.59}px` : `0`;
            esgst.levelContainer.title = `${esgst.levelContainer.getAttribute(`title`)} (${base + parseInt(percentage / 100)}.${`0${percentage}`.slice(-2)})`;
        } else {
            projectedFirstBar = `0`;
            projectedSecondBar = `0`;
        }
        if (!style) {
            document.head.insertAdjacentHTML(`beforeEnd`, `<style id="esgst-lpv-style"></style>`);
        }
        document.getElementById(`esgst-lpv-style`).innerHTML = `
            .esgst-lpv-container {
                background-image: linear-gradient(to right, var(--esgst-lpv-bar, #609f60) ${firstBar}, var(--esgst-lpv-bar-projected, rgba(96, 159, 96, 0.5)) ${firstBar}, var(--esgst-lpv-bar-projected, rgba(96, 159, 96, 0.5)) ${projectedFirstBar}, transparent ${firstBar}), var(--esgst-lpv-button, linear-gradient(#8a92a1 0px, #757e8f 8px, #4e5666 100%)) !important;
            }
            .esgst-lpv-container .nav__button--is-dropdown:hover {
                background-image: linear-gradient(to right, var(--esgst-lpv-bar-hover, #6dac6d) ${firstBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${firstBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${projectedFirstBar}, transparent ${firstBar}), var(--esgst-lpv-button-hover, linear-gradient(#9ba2b0 0px, #8c94a3 8px, #596070 100%)) !important;
            }
            .esgst-lpv-container .nav__button--is-dropdown-arrow:hover {
                background-image: linear-gradient(to right, var(--esgst-lpv-bar-hover, #6dac6d) ${secondBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${secondBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${projectedSecondBar}, transparent ${secondBar}), var(--esgst-lpv-button-hover, linear-gradient(#9ba2b0 0px, #8c94a3 8px, #596070 100%)) !important;
            }
            .esgst-lpv-container .nav__button--is-dropdown-arrow.is-selected {
                background-image: linear-gradient(to right, var(--esgst-lpv-bar, #609f60) ${secondBar}, var(--esgst-lpv-bar-projected, rgba(96, 159, 96, 0.5)) ${secondBar}, var(--esgst-lpv-bar-projected, rgba(96, 159, 96, 0.5)) ${projectedSecondBar}, transparent ${secondBar}), var(--esgst-lpv-arrow, linear-gradient(#4e525f 0px, #434857 5px, #2b2e3a 100%)) !important;
            }
            .esgst-lpv-container.is-selected .nav__button--is-dropdown {
                background-image: linear-gradient(to right, var(--esgst-lpv-bar-hover, #6dac6d) ${firstBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${firstBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${projectedFirstBar}, transparent ${firstBar}), var(--esgst-lpv-button-selected, linear-gradient(#d0d5de 0px, #c9cdd7 5px, #9097a6 100%)) !important;
            }
            .esgst-lpv-container.is-selected .nav__button--is-dropdown-arrow {
                background-image: linear-gradient(to right, var(--esgst-lpv-bar-hover, #6dac6d) ${secondBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${secondBar}, var(--esgst-lpv-bar-hover-projected, rgba(122, 185, 122, 0.5)) ${projectedSecondBar}, transparent ${secondBar}), var(--esgst-lpv-button-selected, linear-gradient(#d0d5de 0px, #c9cdd7 5px, #9097a6 100%)) !important;
            }
            .esgst-lpv-container.is-selected .nav__button--is-dropdown:hover {
                background-image: linear-gradient(to right, var(--esgst-lpv-bar-selected, #7ab97a) ${firstBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${firstBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${projectedFirstBar}, transparent ${firstBar}), var(--esgst-lpv-button-selected-hover, linear-gradient(#f0f1f5 0px, #d1d4de 100%)) !important;
            }
            .esgst-lpv-container.is-selected .nav__button--is-dropdown-arrow:hover:not(.is-selected) {
                background-image: linear-gradient(to right, var(--esgst-lpv-bar-selected, #7ab97a) ${secondBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${secondBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${projectedSecondBar}, transparent ${secondBar}), var(--esgst-lpv-button-selected-hover, linear-gradient(#f0f1f5 0px, #d1d4de 100%)) !important;
            }
            .esgst-lpv-container.is-selected .nav__button--is-dropdown-arrow.is-selected {
                background-image: linear-gradient(to right, var(--esgst-lpv-bar-selected, #7ab97a) ${secondBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${secondBar}, var(--esgst-lpv-bar-selected-projected, rgba(147, 210, 147, 0.5)) ${projectedSecondBar}, transparent ${secondBar}), var(--esgst-lpv-arrow-selected, linear-gradient(#4e525f 0px, #434857 5px, #2b2e3a 100%)) !important;
            }
        `;
        esgst.mainButton.parentElement.classList.add(`esgst-lpv-container`);
    }

    /* [SMGB] Search Magnifying Glass Button */

    function loadSmgb() {
        let buttons, i;
        buttons = document.querySelectorAll(`.sidebar__search-container .fa-search, .esgst-qgs-container .fa-search`);
        for (i = buttons.length - 1; i > -1; --i) {
            let button, input;
            button = buttons[i];
            input = button.previousElementSibling;
            button.classList.add(`esgst-clickable`);
            button.addEventListener(`click`, event => {
                let value = input.value.trim();
                if (value) {
                    location.href = `${esgst.searchUrl.replace(/page=/, ``)}q=${value}`;
                }
            });
        }
    }

    /* [LPL] Last Page Link */

    function getLastPage(context, main, discussion, user, userWon, group, groupUsers, groupWishlist) {
        var element, first, lastPage, pagination, paginationNavigation, paginationResults, second, third;
        pagination = context.getElementsByClassName(`pagination`)[0];
        paginationResults = context.getElementsByClassName(`pagination__results`)[0];
        paginationNavigation = context.getElementsByClassName(`pagination__navigation`)[0];
        if (paginationNavigation) {
            element = paginationNavigation.lastElementChild;
            if (element.textContent.match(/Last/)) {
                lastPage = parseInt(element.getAttribute(`data-page-number`));
            } else if ((main && esgst.discussionPath) || discussion) {
                if (pagination) {
                    lastPage = Math.ceil(parseInt(pagination.firstElementChild.lastElementChild.textContent.replace(/,/g, ``)) / 25);
                } else {
                    lastPage = 999999999;
                }
            } else if ((main && esgst.userPath) || user) {
                if ((main && location.pathname.match(/\/giveaways\/won/)) || userWon) {
                    lastPage = Math.ceil(parseInt(context.querySelector(`.featured__table__row__right a[href*="/giveaways/won"]`).textContent.replace(/,/g, ``)) / 25);
                } else {
                    lastPage = Math.ceil(parseInt(context.getElementsByClassName(`sidebar__navigation__item__count`)[0].textContent.replace(/,/g, ``)) / 25);
                }
            } else if ((main && esgst.groupPath) || group) {
                if ((main && location.pathname.match(/\/users/)) || groupUsers) {
                    lastPage = Math.ceil(parseInt(context.getElementsByClassName(`sidebar__navigation__item__count`)[1].textContent.replace(/,/g, ``)) / 25);
                } else if ((main && esgst.groupWishlistPath) || groupWishlist) {
                    lastPage = 999999999;
                } else {
                    lastPage = Math.ceil(parseInt(context.getElementsByClassName(`sidebar__navigation__item__count`)[0].textContent.replace(/,/g, ``)) / 25);
                }
            } else {
                lastPage = 999999999;
            }
        } else {
            lastPage = 999999999;
        }
        if (lastPage === 999999999 && paginationResults) {
            first = paginationResults.firstElementChild;
            if (first) {
                second = first.nextElementSibling;
                if (second) {
                    third = second.nextElementSibling;
                    if (third) {
                        lastPage = Math.ceil(parseInt(third.textContent.replace(/,/g, ``)) / parseInt(second.textContent.replace(/,/g, ``)));
                    }
                }
            }
        }
        return lastPage;
    }

    function addLplDiscussionLink() {
        var lastLink, url;
        url = `${location.pathname.replace(`/search`, ``)}/search?page=${esgst.lastPage}`;
        esgst.lastPageLink = `
            <a data-page-number="${esgst.lastPage}" href="${url}">
                <span>Last</span>
                <i class="fa fa-angle-double-right"></i>
            </a>
        `;
        lastLink = esgst.paginationNavigation.lastElementChild;
        if (!lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
            esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
        }
    }

    function addLplUserLink() {
        var lastLink, lastPage, url, username;
        username = location.pathname.match(/^\/user\/(.+?)(\/.*?)?$/)[1];
        if (location.pathname.match(/\/giveaways\/won/)) {
            url = `/user/${username}/giveaways/won/search?page=${esgst.lastPage}`;
        } else {
            url = `/user/${username}/search?page=${esgst.lastPage}`;
        }
        esgst.lastPageLink = `
            <a data-page-number="${esgst.lastPage}" href="${url}">
                <span>Last</span>
                <i class="fa fa-angle-double-right"></i>
            </a>
        `;
        lastLink = esgst.paginationNavigation.lastElementChild;
        if (esgst.currentPage !== esgst.lastPage && !lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
            esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
        }
    }

    function addLplGroupLink() {
        var group, lastLink, lastPage, url;
        group = location.pathname.match(/^\/group\/(.+?\/.+?)(\/.*?)?$/)[1];
        if (location.pathname.match(/\/users/)) {
            url = `/group/${group}/users/search?page=${esgst.lastPage}`;
        } else if (esgst.groupWishlistPath) {
            url = `/group/${group}/wishlist/search?page=${esgst.lastPage}`;
        } else {
            url = `/group/${group}/search?page=${esgst.lastPage}`;
        }
        esgst.lastPageLink = `
            <a data-page-number="${esgst.lastPage}" href="${url}">
                <span>Last</span>
                <i class="fa fa-angle-double-right"></i>
            </a>
        `;
        lastLink = esgst.paginationNavigation.lastElementChild;
        if (esgst.currentPage !== esgst.lastPage && !lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
            esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
        }
    }

    /* [AIL] Attached Images Loader / [VAI] Visible Attached Images / [AIC] Attached Images Carousel */

    function getAttachedImages(context) {
        var button, buttons, comment, i, image, n, url;
        buttons = context.querySelectorAll(`.comment__toggle-attached, .view_attached`);
        for (i = 0, n = buttons.length; i < n; ++i) {
            button = buttons[i];
            image = button.nextElementSibling.firstElementChild;
            url = image.getAttribute(`src`);
            if (esgst.vai && (!esgst.inboxPath || !esgst.vai_i)) {
                if (url && esgst.vai_gifv) {
                    url = url.replace(/\.gifv/, `.gif`);
                    image.setAttribute(`src`, url);
                }
                image.classList.remove(`is_hidden`, `is-hidden`);
            }
            if (esgst.aic) {
                i = esgst.attachedImages.length;
                if (!esgst.aic_b) {
                    image.addEventListener(`click`, openAicCarousel.bind(null, i));
                }
                comment = button.closest(`.comment`);
                esgst.attachedImages.push({
                    button: button,
                    image: image,
                    source: comment && comment.querySelector(`.comment__summary`).id,
                    url: url
                });
                if (!esgst.aicButton) {
                    let key, position;
                    if (esgst.leftButtonIds.indexOf(`aic`) > -1) {
                        key = `leftButtons`;
                        position = `afterBegin`;
                    } else {
                        key = `rightButtons`;
                        position = `beforeEnd`;
                    }
                    esgst.aicButton = insertHtml(esgst.hideButtons && esgst.hideButtons_aic ? esgst[key] : esgst.mainPageHeading, position, `
                        <div class="esgst-heading-button" id="esgst-aic" title="View attached images">
                            <i class="fa fa-image"></i>
                        </div>
                    `);
                    esgst.aicButton.addEventListener(`click`, openAicCarousel.bind(null, 0, null));
                }
            }
            if (esgst.ail && !esgst.vai) {
                image.removeAttribute(`src`);
                button.addEventListener(`click`, loadAilImage.bind(null, image, url));
            }
        }
    }

    function loadAilImage(image, url) {
        image.setAttribute(`src`, url);
    }

    function openAicCarousel(i, event) {
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }
        let carousel = insertHtml(document.body, `beforeEnd`, `<div class="esgst-popup-modal esgst-aic-carousel"></div>`);
        carousel.style.zIndex = 9999 + document.querySelectorAll(`.esgst-popup:not(.esgst-hidden), .esgst-popout:not(.esgst-hidden)`).length;
        carousel.addEventListener(`click`, event => {
            if (!event.target.closest(`.esgst-aic-panel`) && !event.target.closest(`img`)) {
                carousel.remove();
            }
        });
        showAicImage(carousel, i);
    }

    function showAicImage(carousel, i) {
        let attachedImage, height, image, n, panel;
        n = esgst.attachedImages.length;
        attachedImage = esgst.attachedImages[i];
        if (esgst.ail) {
            attachedImage.image.setAttribute(`src`, attachedImage.url);
        }
        carousel.innerHTML = `
            <div class="esgst-aic-panel">
                <div class="esgst-aic-left-button">
                    <i class="fa fa-chevron-left"></i>
                </div>
                <div class="esgst-aic-right-button">
                    <i class="fa fa-chevron-right"></i>
                </div>
                <div>
                    ${i + 1}/${n}
                </div>
                ${attachedImage.source ? `
                    <div class="esgst-aic-source">
                        <a href="#${attachedImage.source}">Source</a>
                    </div>
                ` : ``}
            </div>
            <a href="${attachedImage.url}" rel="nofollow noreferrer" target="_blank">
                ${attachedImage.image.outerHTML.replace(/is_hidden|is-hidden/, ``)}
            </a>
        `;
        panel = carousel.firstElementChild;
        image = panel.nextElementSibling;
        height = panel.offsetHeight + 25;
        image.style.maxHeight = `calc(90% - ${height}px)`;
        image.style.marginTop = `${height}px`;
        image.firstElementChild.onload = () => {
            image.firstElementChild.style.maxHeight = `${image.offsetHeight - 10}px`;
            image.firstElementChild.style.maxWidth = `${image.offsetWidth - 10}px`;
        };
        esgst.aicPrevious = panel.firstElementChild;
        esgst.aicNext = esgst.aicPrevious.nextElementSibling;
        if (i > 0) {
            esgst.aicPrevious.addEventListener(`click`, showAicImage.bind(null, carousel, i - 1));
        } else {
            esgst.aicPrevious.classList.add(`esgst-disabled`);
        }
        if (i < n - 1) {
            esgst.aicNext.addEventListener(`click`, showAicImage.bind(null, carousel, i + 1));
        } else {
            esgst.aicNext.classList.add(`esgst-disabled`);
        }
        if (attachedImage.source) {
            panel.lastElementChild.addEventListener(`click`, () => carousel.remove());
        }
    }

    /* [EV] Embedded Videos */

    function getEvVideos(context) {
        var types, i, numTypes, type, videos, j, numVideos, video, previous, next, embedUrl, url, text, title;
        types = [`youtube.com`, `youtu.be`, `vimeo.com`];
        for (i = 0, numTypes = types.length; i < numTypes; ++i) {
            type = types[i];
            videos = context.querySelectorAll(`a[href*="${type}"]`);
            for (j = 0, numVideos = videos.length; j < numVideos; ++j) {
                video = videos[j];
                previous = video.previousSibling;
                next = video.nextSibling;
                if ((!previous || !previous.textContent.trim()) && (!next || !next.textContent.trim())) {
                    // video is the only content in the line
                    url = video.getAttribute(`href`);
                    embedUrl = getVideoEmbedUrl(i, url);
                    if (embedUrl) {
                        text = video.textContent;
                        if (url !== text) {
                            title = `<div>${text}</div>`;
                        } else {
                            title = ``;
                        }
                        video.outerHTML = `
                            <div>
                                ${title}
                                <iframe width="640" height="360" src="${embedUrl}" frameborder="0" allowfullscreen></iframe>
                            </div>
                        `;
                    }
                }
            }
        }
    }

    function getVideoEmbedUrl(i, url) {
        var regExps, regExp, match, baseUrls, baseUrl, code;
        regExps = [
            /youtube.com\/watch\?v=(.+?)(\/.*)?(&.*)?$/,
            /youtu.be\/(.+?)(\/.*)?$/,
            /vimeo.com\/(.+?)(\/.*)?$/
        ];
        regExp = regExps[i];
        match = url.match(regExp);
        if (match) {
            baseUrls = [
                `https://www.youtube.com/embed/`,
                `https://www.youtube.com/embed/`,
                `https://player.vimeo.com/video/`
            ];
            baseUrl = baseUrls[i];
            code = match[1];
            return `${baseUrl}${code}`;
        } else {
            return null;
        }
    }

    /* [AT] Accurate Timestamps */

    function getTimestamps(context) {
        var timestamps, i, n, timestamp, text, edited, seconds, accurateTimestamp;
        timestamps = context.querySelectorAll(`[data-timestamp]`);
        for (i = 0, n = timestamps.length; i < n; ++i) {
            timestamp = timestamps[i];
            if (((esgst.activeDiscussions && ((esgst.activeDiscussions.contains(timestamp) && esgst.adots_index === 0) || !esgst.activeDiscussions.contains(timestamp))) || !esgst.activeDiscussions) && !timestamp.classList.contains(`esgst-at`)) {
                text = timestamp.textContent;
                edited = text.match(/\*/);
                seconds = parseInt(timestamp.getAttribute(`data-timestamp`));
                accurateTimestamp = getTimestamp(seconds, esgst.at_24, esgst.at_s);
                if (edited) {
                    text = ` (Edited ${accurateTimestamp})`;
                } else {
                    text = `${accurateTimestamp} - ${text}`;
                }
                timestamp.classList.add(`esgst-at`);
                timestamp.textContent = text;
            }
        }
    }

    /* [HBS] Hidden Blacklist Stats */

    function loadHbs() {
        var Chart, Match, Points, N, Data, I, CountDate, Year, Month, Day, Count, Context, script;
        if (location.pathname.match(/^\/stats\/personal\/community/)) {
            Chart = document.getElementsByClassName(`chart`)[4];
            Match = Chart.previousElementSibling.textContent.match(/"Whitelists", data: \[(.+)\]},/)[1];
            Points = Match.split(/\],\[/);
            N = Points.length - 1;
            Points[0] = Points[0].replace(/^\[/, ``);
            Points[N] = Points[N].replace(/\/]$/, ``);
            Data = [];
            for (I = 0; I <= N; ++I) {
                Match = Points[I].match(/(.+), (.+)/);
                CountDate = Match[1].match(/\((.+?),(.+?),(.+?)\)/);
                Year = parseInt(CountDate[1]);
                Month = parseInt(CountDate[2]);
                Day = parseInt(CountDate[3]);
                Count = parseInt(Match[2]);
                Data.push([Date.UTC(Year, Month, Day), Count]);
            }
            Context = Chart.firstElementChild;
            Context.lastElementChild.remove();
            Context.lastElementChild.remove();
            Context = Context.nextElementSibling;
            Context.textContent = Context.textContent.replace(/and blacklists\s/, ``);
            Context = Context.nextElementSibling;
            script = document.createElement(`script`);
            script.innerHTML = `
                $(function () {
                    chart_options.graph = {
                        colors: ['#6187d4', '#ec656c'],
                        tooltip: {
                            headerFormat: '<p class="chart__tooltip-header">{point.key}</p>',
                            pointFormat: '<p class="chart__tooltip-point" style="color: {point.color};">{point.y:,.0f} {series.name}</p>'
                        },
                        series: [ { name: "Whitelists", data: ${JSON.stringify(Data)} } ]
                    };
                    $(".chart__personal-community-whitelists-and-blacklists").highcharts(Highcharts.merge(chart_options.default, chart_options.areaspline, chart_options.datetime, chart_options.graph));
                });
            `;
            document.body.appendChild(script);
        }
    }

    /* [GDTTT] Giveaways/Discussions/Tickets/Trades Tracker */

    function loadGdttt() {
        if (((esgst.giveawaysPath || esgst.discussionsPath) && !esgst.ct) || (!esgst.giveawaysPath && !esgst.discussionsPath && esgst.discussionsTicketsTradesPath)) {
            esgst.endlessFeatures.push(addCtDiscussionPanels);
            addCtDiscussionPanels(document);
        }
        if (esgst.commentsPath) {
            var match = location.pathname.match(/(giveaway|discussion|ticket|trade)\/(.+?)\//);
            var type = `${match[1]}s`;
            var code = match[2];
            getValue(type, `{}`).then(value => {
                var savedComments = JSON.parse(value);
                if (esgst[`gdttt_v${{
                    giveaways: `g`,
                    discussions: `d`,
                    tickets: `t`,
                    trades: `ts`
                }[type]}`]) {
                    if (!esgst.ct) {
                        createLock(`commentLock`, 300, function (deleteLock) {
                            if (!savedComments[code]) {
                                savedComments[code] = {
                                    readComments: {}
                                };
                            }
                            savedComments[code].visited = true;
                            savedComments[code].lastUsed = Date.now();
                            setValue(type, JSON.stringify(savedComments)).then(deleteLock);
                        });
                    }
                } else if (esgst.discussionPath || esgst.tradePath) {
                    if (savedComments[code] && savedComments[code].visited) {
                        addGdtttMarkUnvisitedButton(null, code, document.querySelector(`.page__heading, .page_heading`), type);
                    } else {
                        addGdtttMarkVisitedButton(null, code, document.querySelector(`.page__heading, .page_heading`), type);
                    }
                }
            });
        }
        esgst.endlessFeatures.push(checkGdtttVisited);
        checkGdtttVisited(document);
    }

    function checkGdtttVisited(context) {
        var code, comment, container, heading, i, match, matches, n, source, type, url;
        matches = context.querySelectorAll(`.homepage_table_column_heading, .table__column__heading, .giveaway__heading__name, .column_flex h3 a`);
        getValues({
            giveaways: `{}`,
            discussions: `{}`,
            tickets: `{}`,
            trades: `{}`
        }).then(values => {
            for (let key in values) {
                values[key] = JSON.parse(values[key]);
            }
            for (i = 0, n = matches.length; i < n; ++i) {
                match = matches[i];
                url = match.getAttribute(`href`);
                if (url) {
                    source = url.match(/(giveaway|discussion|ticket|trade)\/(.+?)(\/.*)?$/);
                    if (source) {
                        type = `${source[1]}s`;
                        code = source[2];
                        container = match.closest(`.table__row-outer-wrap, .giveaway__row-outer-wrap, .row_outer_wrap`);
                        comment = values[type][code];
                        if (comment && comment.visited && container) {
                            if ((type === `giveaways` && esgst.gdttt_g) || type !== `giveaways`) {
                                container.classList.add(`esgst-ct-visited`);
                                container.style.opacity = `0.5`;
                                setHoverOpacity(container, `1`, `0.5`);
                            }
                        }
                    }
                }
            }
        });
    }

    function addGdtttMarkVisitedButton(button, code, context, type) {
        var comments;
        if (!button) {
            button = insertHtml(context, `afterBegin`, `<div class="esgst-gdttt-button page_heading_btn"><div>`);
        }
        button.innerHTML = `<i class="fa fa-check" title="Mark as visited"></i>`;
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            createLock(`commentLock`, 300, function(deleteLock) {
                getValue(type).then(value => {
                    comments = JSON.parse(value);
                    if (!comments[code]) {
                        comments[code] = {
                            readComments: {}
                        };
                    }
                    if (esgst.ct_s) {
                        comments[code].count = count;
                    }
                    comments[code].visited = true;
                    comments[code].lastUsed = Date.now();
                    return setValue(type, JSON.stringify(comments));
                }).then(() => {
                    deleteLock();
                    addGdtttMarkUnvisitedButton(button, code, context, type);
                });
            });
        });
    }

    function addGdtttMarkUnvisitedButton(button, code, context, type) {
        var comments;
        if (!button) {
            button = insertHtml(context, `afterBegin`, `<div class="esgst-gdttt-button page_heading_btn"><div>`);
        }
        button.innerHTML = `<i class="fa fa-times" title="Mark as unvisited"></i>`;
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            createLock(`commentLock`, 300, function(deleteLock) {
                getValue(type).then(value => {
                    comments = JSON.parse(value);
                    if (esgst.ct_s) {
                        delete comments[code].count;
                    }
                    delete comments[code].visited;
                    comments[code].lastUsed = Date.now();
                    return setValue(type, JSON.stringify(comments));
                }).then(() => {
                    deleteLock();
                    addGdtttMarkVisitedButton(button, code, context, type);
                });
            });
        });
    }

    /* [TS] Tables Sorter */

    function getTsTables(context, main, source, endless) {
        var i, n, tables;
        tables = context.getElementsByClassName(`table`);
        for (i = 0, n = tables.length; i < n; ++i) {
            setTsTable(tables[i]);
        }
        if (!endless && !esgst.us) {
            sortTsTables();
        }
    }

    function sortTsTables() {
        var i, tsTable;
        for (i = esgst.tsTables.length - 1; i > -1; --i) {
            tsTable = esgst.tsTables[i];
            if (tsTable.columnName) {
                sortContent(getTsArray(tsTable.columnName, tsTable.columnIndex, tsTable.table), `${tsTable.key}_${tsTable.name}`);
            }
        }
    }

    function setTsTable(table) {
        var button, columns, columnName, columns, heading, i, tsTable;
        heading = table.querySelector(`.table__heading, .header`);
        if (heading) {
            tsTable = {
                columnName: ``,
                key: `sortIndex`,
                name: `asc`,
                table: table
            };
            esgst.tsTables.push(tsTable);
            columns = heading.querySelectorAll(`.table__column--width-fill, .table__column--width-medium, .table__column--width-small, .column_flex, .column_medium, .column_small`);
            for (i = 0, n = columns.length; i < n; ++i) {
                column = columns[i];
                columnName = column.textContent.trim();
                if (!columnName.match(/^(Keys|Key|Not\sReceived|Remove)$/) && (!esgst.wonPath || !columnName.match(/^Received$/)) && !column.getElementsByClassName(`esgst-ts-button`)[0]) {
                    button = insertHtml(column, `beforeEnd`, `
                        <span class="esgst-ts-button esgst-clickable"></span>
                    `);
                    addTsDescButton(button, columnName, i, table, tsTable);
                }
            }
        }
    }

    function addTsAscButton(button, columnName, i, table, tsTable) {
        button.innerHTML = `
            <i class="fa fa-sort-desc" title="Currently sorted descending. Click to sort ascending."></i>
        `;
        button.firstElementChild.addEventListener(`click`, sortTsTable.bind(null, button, columnName, i, `asc`, table, tsTable));
    }

    function addTsDescButton(button, columnName, i, table, tsTable) {
        button.innerHTML = `
            <i class="fa fa-sort" title="Currently sorted by default. Click to sort descending."></i>
        `;
        button.firstElementChild.addEventListener(`click`, sortTsTable.bind(null, button, columnName, i, `desc`, table, tsTable));
    }

    function addTsDefButton(button, columnName, i, table, tsTable) {
        button.innerHTML = `
            <i class="fa fa-sort-asc" title="Currently sorted ascending. Click to sort by default."></i>
        `;
        button.firstElementChild.addEventListener(`click`, sortTsTable.bind(null, button, columnName, i, `def`, table, tsTable));
    }

    function sortTsTable(button, columnName, i, key, table, tsTable) {
        tsTable.columnName = columnName;
        tsTable.columnIndex = i;
        tsTable.key = key === `def` ? `sortIndex` : `value`;
        tsTable.name = key;
        if (key === `desc`) {
            sortContent(getTsArray(columnName, i, table), `value_${key}`);
            addTsAscButton(button, columnName, i, table, tsTable);
        } else if (key === `asc`) {
            sortContent(getTsArray(columnName, i, table), `value_${key}`);
            addTsDefButton(button, columnName, i, table, tsTable);
        } else {
            sortContent(getTsArray(columnName, i, table), `sortIndex_asc`);
            addTsDescButton(button, columnName, i, table, tsTable);
        }
    }

    function getTsArray(columnName, i, table) {
        var array, column, element, j, match, n, row, rows, value;
        array = [];
        rows = table.querySelectorAll(`.table__row-outer-wrap, .row_outer_wrap`);
        for (j = 0, n = rows.length; j < n; ++j) {
            row = rows[j];
            column = row.querySelectorAll(`.table__column--width-fill, .table__column--width-medium, .table__column--width-small, .column_flex, .column_medium, .column_small`)[i];
            value = column && column.textContent.trim();
            element = {
                outerWrap: row
            };
            if (row.hasAttribute(`data-sort-index`)) {
                element.sortIndex = parseInt(row.getAttribute(`data-sort-index`));
            } else {
                element.sortIndex = j;
                row.setAttribute(`data-sort-index`, j);
            }
            if (value.length > 0 || columnName === `Trending`) {
                if (column.hasAttribute(`data-sort-value`)) {
                    element.value = parseFloat(column.getAttribute(`data-sort-value`));
                } else {
                    switch (columnName) {
                        case `Trending`:
                            element.value = column.getElementsByClassName(`fa-caret-up`).length - column.getElementsByClassName(`fa-caret-down`).length;
                            break;
                        case `Added`:
                        case `Date Entered`:
                        case `Last Online`:
                        case `Last Post`:
                        case `Last Update`:
                            element.value = value.match(/Online\sNow/) ? Date.now() : parseInt(column.querySelector(`[data-timestamp]`).getAttribute(`data-timestamp`)) * 1e3;
                            break;
                        case `Game`:
                        case `Giveaway`:
                        case `Group`:
                        case `Received`:
                        case `Sent`:
                        case `Status`:
                        case `Summary`:
                        case `Type`:
                        case `User`:
                        case `Winner(s)`:
                            element.value = value;
                            break;
                        default:
                            if (value.match(/\d+\.\d+/)) {
                                element.value = parseFloat(value.replace(/\$/g, ``));
                                if (isNaN(element.value)) {
                                    element.value = value;
                                }
                            } else {
                                element.value = parseFloat(value.replace(/,/g, ``).match(/\d+/)[0]);
                            }
                            break;
                    }
                }
            } else {
                element.value = 0;
            }
            array.push(element);
        }
        return array;
    }

    function addAgsPanel(context, qgs) {
        var context, details, element, filter, filterDetails, filters, i, icon, input, match, n, panel, popout, timeout, value;
        context.firstElementChild.remove();
        input = insertHtml(context, `afterBegin`, `
            <input class="${qgs ? `esgst-qgs-input` : `sidebar__search-input`}" placeholder="Search..." type="text">
        `);
        icon = input.nextElementSibling;
        icon.classList.add(`esgst-clickable`);
        icon.title = `Use advanced search`;
        if (!qgs) {
            match = location.search.match(/q=(.*?)(&.*?)?$/);
            if (match) {
                input.value = decodeURIComponent(match[1]);
            }
        }
        if (!qgs && ((esgst.adots && esgst.adots_index === 0) || !esgst.adots)) {
            panel = insertHtml(context, `afterEnd`, `
                <div class="esgst-ags-panel"></div>
            `);
        } else {
            panel = new Popout(`esgst-ags-panel`, context, 100).popout;
        }
        filterDetails = [
            {
                key: `ags_type`,
                parameter: `type`,
                name: `Type`,
                options: [
                    {
                        name: `All`,
                        value: ``
                    },
                    {
                        name: `Wishlist`,
                        value: `wishlist`
                    },
                    {
                        name: `Recommended`,
                        value: `recommended`
                    },
                    {
                        name: `Group`,
                        value: `group`
                    },
                    {
                        name: `New`,
                        value: `new`
                    }
                ],
                type: `select`
            },
            {
                maxKey: `ags_maxDate`,
                minKey: `ags_minDate`,
                maxParameter: `release_date_max`,
                minParameter: `release_date_min`,
                name: `Release Date`,
                type: `input`
            },
            {
                maxKey: `ags_maxScore`,
                minKey: `ags_minScore`,
                maxParameter: `metascore_max`,
                minParameter: `metascore_min`,
                name: `Metascore`,
                type: `input`
            },
            {
                maxKey: `ags_maxLevel`,
                minKey: `ags_minLevel`,
                maxParameter: `level_max`,
                minParameter: `level_min`,
                name: `Level`,
                type: `select`
            },
            {
                maxKey: `ags_maxEntries`,
                minKey: `ags_minEntries`,
                maxParameter: `entry_max`,
                minParameter: `entry_min`,
                name: `Entries`,
                type: `input`
            },
            {
                maxKey: `ags_maxCopies`,
                minKey: `ags_minCopies`,
                maxParameter: `copy_max`,
                minParameter: `copy_min`,
                name: `Copies`,
                type: `input`
            },
            {
                maxKey: `ags_maxPoints`,
                minKey: `ags_minPoints`,
                maxParameter: `point_max`,
                minParameter: `point_min`,
                name: `Points`,
                type: `input`
            },
            {
                key: `ags_regionRestricted`,
                name: `Region Restricted`,
                parameter: `region_restricted`,
                type: `checkbox`
            },
            {
                key: `ags_dlc`,
                name: `DLC`,
                parameter: `dlc`,
                type: `checkbox`
            },
            {
                key: `ags_app`,
                name: `App`,
                parameter: `app`,
                type: `checkbox`
            },
            {
                key: `ags_sub`,
                name: `Sub`,
                parameter: `sub`,
                type: `checkbox`
            }
        ];
        filters = [];
        for (i = 0, n = filterDetails.length; i < n; ++i) {
            createAgsFilter(filterDetails[i]);
        }
        input.addEventListener(`keydown`, function (event) {
            if (event.key === `Enter`) {
                event.preventDefault();
                searchAgsQuery();
            }
        });
        icon.addEventListener(`click`, function () {
            searchAgsQuery();
        });

        function createAgsFilter(details) {
            var element, filter, html, i, maxFilter, minFilter;
            if (details.key === `ags_type` && !qgs) {
                return;
            }
            if (details.type === `checkbox`) {
                element = insertHtml(panel, `beforeEnd`, `
                        <div class="esgst-ags-checkbox-filter">
                            <span>${details.name}</span>
                        </div>
                `);
                filter = new Checkbox(
                    element,
                    esgst[details.key]
                ).input;
                element.addEventListener(`click`, function () {
                    setSetting(details.key, filter.checked);
                    esgst[details.key] = filter.checked;
                });
                filters.push({
                    filter: filter,
                    key: `checked`,
                    parameter: details.parameter
                });
            } else if (details.options) {
                html = `
                    <select>
                `;
                details.options.forEach(option => {
                    html += `
                        <option value="${option.value}">${option.name}</option>
                    `;
                });
                html += `
                    </select>
                `;
                element = insertHtml(panel, `beforeEnd`, `
                    <div style="display: block;">${details.name} <div class="esgst-ags-filter">${html}</div></div>
                `);
                filter = element.firstElementChild.firstElementChild;
                filter.value = esgst[details.key];
                filter.addEventListener(`change`, function () {
                    setSetting(details.key, filter.value);
                    esgst[detauks.key] = filter.value;
                });
                filters.push({
                    filter: filter,
                    key: `value`,
                    parameter: details.parameter
                });
            } else {
                if (details.type === `select`) {
                    html = `
                        <select>
                            <option></option>
                    `;
                    for (i = 0; i <= 10; ++i) {
                        html += `
                            <option>${i}</option>
                        `;
                    }
                    html += `
                        </select>
                    `;
                } else if (details.maxKey === `ags_maxDate`) {
                    html = `
                        <input type="date">
                    `;
                } else {
                    html = `
                        <input type="text">
                    `;
                }
                element = insertHtml(panel, `beforeEnd`, `
                    <div>${details.name} <div class="esgst-ags-filter">${html}</div><div class="esgst-ags-filter">${html}</div></div>
                `);
                maxFilter = element.lastElementChild.lastElementChild;
                maxFilter.value = esgst[details.maxKey];
                maxFilter.addEventListener(`change`, function () {
                    setSetting(details.maxKey, maxFilter.value);
                    esgst[details.maxKey] = maxFilter.value;
                });
                minFilter = element.firstElementChild.lastElementChild;
                minFilter.value = esgst[details.minKey];
                minFilter.addEventListener(`change`, function () {
                    setSetting(details.minKey, minFilter.value);
                    esgst[details.minKey] = minFilter.value;
                });
                if (details.type === `input`) {
                    maxFilter.addEventListener(`keypress`, event => {
                        if (event.key === `Enter`) {
                            searchAgsQuery();
                        }
                    });
                    minFilter.addEventListener(`keypress`, event => {
                        if (event.key === `Enter`) {
                            searchAgsQuery();
                        }
                    });
                }
                filters.push({
                    filter: minFilter,
                    key: `value`,
                    parameter: details.minParameter
                });
                filters.push({
                    filter: maxFilter,
                    key: `value`,
                    parameter: details.maxParameter
                });
            }
        }

        function searchAgsQuery() {
            var i, match, url;
            if (esgst.ags_app || esgst.ags_sub) {
                url = `https://www.steamgifts.com/giveaways/search?q=`;
            } else {
                url = `https://www.steamgifts.com/giveaways/search?q=${encodeURIComponent(input.value)}`;
            }
            if (!qgs) {
                match = location.search.match(/(type=.*?)(&.*?)?$/);
                if (match) {
                    url += `&${match[1]}`;
                }
            }
            for (i = 0, n = filters.length; i < n; ++i) {
                filter = filters[i];
                value = filter.filter[filter.key];
                if (value) {
                    if (filter.parameter === `app`) {
                        url += `&app=${input.value}`;
                    } else if (filter.parameter === `sub`) {
                        url += `&sub=${input.value}`;
                    } else {
                        url += `&${filter.parameter}=${value}`;
                    }
                }
            }
            location.href = url;
        }
    }

    /* [GAS] Giveaways Sorter */

    function loadGas() {
        if (esgst.giveawaysPath || esgst.enteredPath || esgst.groupPath || esgst.userPath) {
            let gas, type;
            gas = {};
            esgst.gas = {};
            type = location.search.match(/type=(wishlist|recommended|group|new)/);
            if (type) {
                type = type[1].replace(/^(.)/, function (m, p1) {
                    return p1.toUpperCase();
                });
            } else if (esgst.enteredPath) {
                type = `Entered`;
            } else if (esgst.userPath) {
                type = `User`;
            } else if (esgst.groupPath) {
                type = `Groups`;
            } else {
                type = ``;
            }
            esgst.gas.autoKey = `gas_auto${type}`;
            esgst.gas.optionKey = `gas_option${type}`;
            gas.button = document.createElement(`div`);
            gas.button.className = `esgst-heading-button`;
            gas.button.id = `esgst-gas`;
            gas.button.title = `Sort giveaways`;
            gas.button.innerHTML = `
                <i class="fa fa-sort"></i>
            `;
            gas.button.addEventListener(`click`, openGasPopout.bind(null, gas));
            if (esgst.hideButtons && esgst.hideButtons_gas) {
                if (esgst.leftButtonIds.indexOf(`gas`) > -1) {
                    esgst.leftButtons.insertBefore(gas.button, esgst.leftButtons.firstElementChild);
                } else {
                    esgst.rightButtons.appendChild(gas.button);
                }
            } else {
                esgst.mainPageHeading.insertBefore(gas.button, esgst.mainPageHeading.firstElementChild);
            }
        }
    }

    function openGasPopout(gas) {
        var optionsHtml, type;
        if (!gas.popout) {
            gas.popout = new Popout(`esgst-gas-popout`, gas.button, 0, true);
            gas.toggle = new ToggleSwitch(gas.popout.popout, esgst.gas.autoKey, false, `Auto Sort`, false, false, `Automatically sorts the giveaways by the selected option when loading the page.`, esgst[esgst.gas.autoKey]);
            optionsHtml = `
                <select>
                    <option value="sortIndex_asc">Default</option>
                    <option value="name_asc">Game Name - Ascending</option>
                    <option value="name_desc">Game Name - Descending</option>
            `;
            if (!esgst.enteredPath) {
                optionsHtml += `
                    <option value="points_asc">Points - Ascending</option>
                    <option value="points_desc">Points - Descending</option>
                `;
            }
            if (esgst.gc && esgst.gc_r && !esgst.enteredPath) {
                optionsHtml += `
                    <option value="rating_asc">Rating - Ascending</option>
                    <option value="rating_desc">Rating - Descending</option>
                `;
            }
            optionsHtml += `
                    <option value="endTime_asc">End Time - Ascending</option>
                    <option value="endTime_desc">End Time - Descending</option>
            `;
            if (!esgst.enteredPath) {
                optionsHtml += `
                    <option value="startTime_asc">Start Time - Ascending</option>
                    <option value="startTime_desc">Start Time - Descending</option>
                    <option value="creator_asc">Creator - Ascending</option>
                    <option value="creator_desc">Creator - Descending</option>
                    <option value="comments_asc">Comments - Ascending</option>
                    <option value="comments_desc">Comments - Descending</option>
                `;
            }
            optionsHtml += `
                    <option value="entries_asc">Entries - Ascending</option>
                    <option value="entries_desc">Entries - Descending</option>
            `;

            if (esgst.gwc) {
                optionsHtml += `
                    <option value="chance_asc">Chance - Ascending</option>
                    <option value="chance_desc">Chance - Descending</option>
                    <option value="chancePerPoint_asc">Chance Per Point - Ascending</option>
                    <option value="chancePerPoint_desc">Chance Per Point - Descending</option>
                `;
            }
            if (esgst.gwr) {
                optionsHtml += `
                    <option value="ratio_asc">Ratio - Ascending</option>
                    <option value="ratio_desc">Ratio - Descending</option>
                `;
            }
            optionsHtml += `
                </select>
            `;
            gas.options = insertHtml(gas.popout.popout, `beforeEnd`, optionsHtml);
            gas.options.value = esgst[esgst.gas.optionKey];
            gas.options.addEventListener(`change`, saveAndSortContent.bind(null, esgst.gas.optionKey, `currentGiveaways`, gas.options, null));
            gas.popout.popout.appendChild(new ButtonSet(`green`, ``, `fa-arrow-circle-right`, ``, `Sort`, ``, saveAndSortContent.bind(null, esgst.gas.optionKey, `currentGiveaways`, gas.options)).set);
        }
    }

    function saveAndSortContent(key, mainKey, options, callback) {
        if (callback) {
            callback();
        }
        sortContent(esgst[mainKey], options.value);
        setSetting(key, options.value);
    }

    function sortContent(array, option) {
        var after, before, divisor, divisors, i, key, n, name;
        name = option.split(/_/);
        key = name[0];
        if (name[1] === `asc`) {
            before = -1;
            after = 1;
        } else {
            before = 1;
            after = -1;
        }
        array.sort(function (a, b) {
            if (typeof a[key] === `string` && typeof b[key] === `string`) {
                return (a[key].toLowerCase().localeCompare(b[key].toLowerCase()) * after);
            } else {
                if (a[key] < b[key]) {
                    return before;
                } else if (a[key] > b[key]) {
                    return after;
                } else {
                    return 0;
                }
            }
        });
        for (i = 0, n = array.length; i < n; ++i) {
            array[i].outerWrap.parentElement.appendChild(array[i].outerWrap);
        }
        if (key === `sortIndex`) {
            divisors = document.getElementsByClassName(`esgst-es-page-divisor`);
            for (i = divisors.length - 1; i > -1; --i) {
                divisor = divisors[i];
                divisor.classList.remove(`esgst-hidden`);
                divisor.parentElement.insertBefore(divisor, document.getElementsByClassName(`esgst-es-page-${i + 2}`)[0]);
            }
        } else {
            divisors = document.querySelectorAll(`.esgst-es-page-divisor:not(.esgst-hidden)`);
            for (i = divisors.length - 1; i > -1; --i) {
                divisors[i].classList.add(`esgst-hidden`);
            }
        }
    }

    /* [GV] Grid View */

    function loadGv() {
        if (esgst.giveawaysPath || esgst.gv_gb || esgst.gv_ged || esgst.gv_ge) {
            esgst.giveawayFeatures.push(setGvContainers);
            esgst.style.insertAdjacentText(`beforeEnd`, `
                .esgst-gv-creator {
                    margin: ${esgst.ib ? 10 : 5}px 5px 5px;
                    width: ${esgst.ib ? 127 : 132}px;
                }

                .esgst-gv-popout .giveaway__links {
                    display: block;
                    height: auto;
                    margin: 5px 5px ${esgst.ib ? 10 : 5}px;
                    text-align: center;
                    width: ${esgst.ib ? 127 : 132}px;
                }
            `);
            if (esgst.giveawaysPath) {
                let button, display, element, elements, i, n, popout, spacing, slider;
                let key, position;
                if (esgst.leftButtonIds.indexOf(`gv`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                button = insertHtml(esgst.hideButtons && esgst.hideButtons_gv ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button" id="esgst-gv" title="Set Grid View spacing">
                        <i class="fa fa-th-large"></i>
                    </div>
                `);
                popout = new Popout(`esgst-gv-spacing`, button, 0, true);
                spacing = esgst.gv_spacing;
                element = insertHtml(popout.popout, `beforeEnd`, `
                    <div>
                        <div></div>
                        <div>${spacing}px</div>
                    </div>
                `);
                slider = element.firstElementChild;
                display = slider.nextElementSibling;
                $(slider).slider({
                    slide: function (event, ui) {
                        spacing = ui.value;
                        elements = document.getElementsByClassName(`esgst-gv-container`);
                        for (i = 0, n = elements.length; i < n; ++i) {
                            elements[i].style.margin = `${spacing}px`;
                        }
                        popout.reposition();
                        display.textContent = `${spacing}px`;
                        setSetting(`gv_spacing`, spacing);
                        esgst.gv_spacing = spacing;
                    },
                    max: 10,
                    value: spacing
                });
            }
        }
    }

    function setGvContainers(giveaways, main, source) {
        var elements, i, n, spacing;
        if ((main && esgst.giveawaysPath) || (!main && ((source === `gb` && esgst.gv_gb) || (source === `ged` && esgst.gv_ged) || (source === `ge` && esgst.gv_ge)))) {
            spacing = esgst.gv_spacing;
            for (i = 0, n = giveaways.length; i < n; ++i) {
                setGvContainer(giveaways[i], spacing);
            }
        }
    }

    function getRemainingTime(time) {
        var d, dif, h, m, s, w;
        dif = time - Date.now();
        if (dif < 0) {
            dif *= -1;
        }
        w = Math.floor(dif / 604800000);
        if (w > 0) {
            return `${w}w`;
        } else {
            d = Math.floor(dif / 86400000);
            if (d > 0) {
                return `${d}d`;
            } else {
                h = Math.floor(dif / 3600000);
                if (h > 0) {
                    return `${h}h`;
                } else {
                    m = Math.floor(dif / 60000);
                    if (m > 0) {
                        return `${m}m`;
                    } else {
                        s = Math.floor(dif / 1000);
                        return `${s}s`;
                    }
                }
            }
        }
    }

    function setGvContainer(giveaway, spacing) {
        var creator, icons;
        giveaway.grid = true;
        popup = giveaway.outerWrap.closest(`.esgst-popup-scrollable`) || esgst.menuPath;
        if (popup) {
            giveaway.outerWrap.parentElement.parentElement.classList.add(`esgst-gv-view`);
            giveaway.outerWrap.parentElement.style.display = `inline-block`;
            giveaway.outerWrap.classList.add(`esgst-gv-container`);
            giveaway.outerWrap.style.margin = `${spacing}px`;
        } else {
            giveaway.outerWrap.parentElement.classList.add(`esgst-gv-view`);
            giveaway.outerWrap.classList.add(`esgst-gv-container`);
            giveaway.outerWrap.style.margin = `${spacing}px`;
        }
        giveaway.innerWrap.classList.add(`esgst-gv-box`);
        icons = insertHtml(giveaway.innerWrap, `afterBegin`, `
            <div class="esgst-gv-icons giveaway__columns">
                <div class="esgst-gv-time">
                        <span title="${giveaway.started ? `Ends` : `Starts`} ${giveaway.endTimeColumn.lastElementChild.textContent}">${getRemainingTime(giveaway.endTime)}</span>
                    <i class="fa fa-clock-o"></i>
                    <span title="Created ${giveaway.startTimeColumn.lastElementChild.previousElementSibling.textContent}">${getRemainingTime(giveaway.startTime)}</span>
                </div>
            </div>
        `);
        if (giveaway.inviteOnly) {
            icons.appendChild(giveaway.inviteOnly);
        }
        if (giveaway.regionRestricted) {
            icons.appendChild(giveaway.regionRestricted);
        }
        if (giveaway.group) {
            icons.appendChild(giveaway.group);
        }
        if (giveaway.whitelist) {
            icons.appendChild(giveaway.whitelist);
        }
        if (giveaway.levelColumn) {
            giveaway.levelColumn.textContent = giveaway.levelColumn.textContent.replace(/Level\s/, ``);
            icons.appendChild(giveaway.levelColumn);
        }
        giveaway.innerWrap.insertBefore(giveaway.image, icons);
        giveaway.summary.classList.add(`esgst-gv-popout`, `global__image-outer-wrap`);
        giveaway.summary.insertBefore(giveaway.avatar, giveaway.links);
        giveaway.avatar.insertAdjacentHTML(`afterEnd`, `
            <div style="clear: both;"></div>
        `);
        giveaway.headingName.insertAdjacentHTML(`afterEnd`, `<br>`);
        giveaway.pointsContainer.insertAdjacentHTML(`afterEnd`, `<br>`);
        giveaway.endTimeColumn.classList.add(`esgst-hidden`);
        giveaway.startTimeColumn.classList.add(`esgst-hidden`);
        giveaway.entriesLink.lastElementChild.textContent = giveaway.entriesLink.textContent.replace(/[^\d,]+/g, ``);
        giveaway.commentsLink.lastElementChild.textContent = giveaway.commentsLink.textContent.replace(/[^\d,]+/g, ``);
        creator = insertHtml(giveaway.links, `beforeBegin`, `
            <div class="esgst-gv-creator">
                <span>by</span>
            </div>
        `);
        creator.appendChild(giveaway.creatorContainer);
        new Popout(``, giveaway.outerWrap, 100, false, giveaway.summary);
    }

    /* [GF] Giveaway Filters */

    function getGfGiveaways(giveaways, main, source) {
        var giveaway, i, n, savedGiveaways;
        getValue(`giveaways`, `{}`).then(value => {
            savedGiveaways = JSON.parse(value);
            for (i = 0, n = giveaways.length; i < n; ++i) {
                giveaway = giveaways[i];
                if (giveaway.creator !== esgst.username && !giveaway.ended && !giveaway.entered && giveaway.url) {
                    if (source === `gf` || esgst.giveawayPath) {
                        if (!giveaway.innerWrap.getElementsByClassName(`esgst-gf-unhide-button`)[0] && savedGiveaways[giveaway.code] && savedGiveaways[giveaway.code].hidden) {
                            addGfUnhideButton(giveaway, main);
                        }
                    }
                    if ((source !== `gc` && (esgst.giveawaysPath || esgst.groupPath)) || esgst.giveawayPath) {
                        if (!giveaway.innerWrap.getElementsByClassName(`esgst-gf-hide-button`)[0] && (!savedGiveaways[giveaway.code] || !savedGiveaways[giveaway.code].hidden || !savedGiveaways[giveaway.code].code)) {
                            addGfHideButton(giveaway, main);
                        }
                    }
                }
            }
        });
    }

    function addGfHideButton(giveaway, main) {
        var button;
        button = insertHtml(giveaway.headingName, `beforeBegin`, `
            <div class="esgst-gf-hide-button" title="Hide giveaway">
                <i class="fa fa-eye-slash"></i>
            </div>
        `);
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            hideGfGiveaway(giveaway, function() {
                button.remove();
                if ((esgst.giveawayPath && !main) || !esgst.giveawayPath) {
                    giveaway.outerWrap.remove();
                }
            });
        });
    }

    function hideGfGiveaway(giveaway, callback) {
        createLock(`giveawayLock`, 300, function(deleteLock) {
            var giveaways;
            getValue(`giveaways`, `{}`).then(value => {
                giveaways = JSON.parse(value);
                if (!giveaways[giveaway.code]) {
                    giveaways[giveaway.code] = {};
                }
                giveaways[giveaway.code].code = giveaway.code;
                giveaways[giveaway.code].endTime = giveaway.endTime;
                giveaways[giveaway.code].hidden = Date.now();
                return setValue(`giveaways`, JSON.stringify(giveaways));
            }).then(() => {
                deleteLock();
                if (callback) {
                    callback();
                }
            });
        });
    }

    function addGfUnhideButton(giveaway, main) {
        var button;
        button = insertHtml(giveaway.headingName, `beforeBegin`, `
            <div class="esgst-gf-unhide-button" title="Unhide giveaway">
                <i class="fa fa-eye"></i>
            </div>
        `);
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            unhideGfGiveaway(giveaway, function() {
                button.remove();
                if ((esgst.giveawayPath && !main) || !esgst.giveawayPath) {
                    giveaway.outerWrap.remove();
                }
            });
        });
    }

    function unhideGfGiveaway(giveaway, callback) {
        createLock(`giveawayLock`, 300, function(deleteLock) {
            var giveaways;
            getValue(`giveaways`, `{}`).then(value => {
                giveaways = JSON.parse(value);
                if (giveaways[giveaway.code]) {
                    delete giveaways[giveaway.code].hidden;
                }
                return setValue(`giveaways`, JSON.stringify(giveaways));
            }).then(() => {
                deleteLock();
                if (callback) {
                    callback();
                }
            });
        });
    }

    function setGfOverride(gf, context, key) {
        let button, override;
        button = insertHtml(context, `afterBegin`, `<span class="esgst-gf-override"></span>`);
        gf.overrideButtons[key] = {
            change: () => {
                if (typeof gf.overrides[key] === `undefined`) {
                    gf.overrides[key] = 0;
                }
                gf.overrideButtons[key].value = gf.overrides[key];
                if (gf.overrideButtons[key].value) {
                    button.innerHTML = `<i class="fa fa-exclamation" title="Click to make this filter overridable"></i>`;
                } else {
                    button.innerHTML = `<i class="fa fa-exclamation esgst-faded" title="Click to make this filter non-overridable"></i>`;
                }
            }
        };
        gf.overrideButtons[key].change();
        button.addEventListener(`click`, () => {
            gf.overrides[key] = gf.overrideButtons[key].value ? 0 : 1;
            gf.overrideButtons[key].change();
            filterGfGiveaways(gf);
        });
    }

    function addGfContainer(heading, popup) {
        var basicFilter, basicFilters, box, button, categoryFilter, categoryFilters, collapseButton, display, exceptionButton, exceptionCount, exceptionPanel, expandButton, filters, genres, gf, headingButton, i, id, infinite, key, maxKey, maxSavedValue, maxValue, minKey, minSavedValue, minValue, name, preset, presetButton, presetDisplay, presetInput, presetMessage, presetPanel, presets, presetWarning, slider, step, toggleSwitch, typeFilter, typeFilters, value;
        gf = {
            advancedSearch: location.search.match(/q=/),
            counters: {},
            popup: popup,
            type: popup || (esgst.groupPath ? `Groups` : (location.search.match(/type/) ? { wishlist: `Wishlist`, recommended: `Recommended`, group: `Group`, new: `New` }[location.search.match(/type=(wishlist|recommended|group|new)/)[1]] : (esgst.createdPath ? `Created` : (esgst.enteredPath ? `Entered` : (esgst.wonPath ? `Won` : (esgst.userPath ? `User` : ``))))))
        };
        if (popup) {
            esgst.gfPopup = gf;
        } else {
            esgst.gf = gf;
        }
        headingButton = document.createElement(`div`);
        headingButton.className = `esgst-heading-button esgst-gf-heading-button`;
        headingButton.id = `esgst-gf`;
        headingButton.innerHTML = `
            <span class="esgst-gf-toggle-switch"></span>
            <i class="fa fa-sliders" title="Manage presets"></i>
        `;
        toggleSwitch = new ToggleSwitch(headingButton.firstElementChild, `gf_enable${gf.type}`, true, ``, false, false, null, esgst[`gf_enable${gf.type}`]);
        toggleSwitch.onEnabled = filterGfGiveaways.bind(null, gf);
        toggleSwitch.onDisabled = filterGfGiveaways.bind(null, gf, true);
        presetButton = headingButton.lastElementChild;
        gf.container = insertHtml(heading, `afterEnd`, `
            <div class="esgst-gf-container">
                <div class="esgst-gf-box">
                    <div class="esgst-gf-filters esgst-hidden">
                        <div class="esgst-gf-basic-filters esgst-hidden">
                            <div>
                                <span class="esgst-bold">Basic Filters:</span>
                                <i class="fa fa-question-circle" title="The entries/copies filters are infinite. To increase/decrease their max value, simply enter the new max value into the input field and it will be changed."></i>
                            </div>
                        </div>
                        <div class="esgst-gf-type-filters">
                            <div>
                                <span class="esgst-bold">Type Filters:</span>
                            </div>
                        </div>
                        <div class="esgst-gf-category-filters esgst-hidden">
                            <div>
                                <span class="esgst-bold">Category Filters:</span>
                            </div>
                        </div>
                        <div class="esgst-gf-right-panel">
                            <div class="esgst-gf-legend-panel">
                                <div>
                                    <span class="esgst-bold">Legend:</span>
                                    <i class="fa fa-question-circle" title="This legend applies to the type/category filters, except where noted"></i>
                                </div>
                                <div class="esgst-gf-legend"><i class="fa fa-circle-o"></i> - Hide all.</div>
                                <div class="esgst-gf-legend"><i class="fa fa-circle"></i> - Show only.</div>
                                <div class="esgst-gf-legend"><i class="fa fa-check-circle"></i> - Show all.</div>
                                <div class="esgst-gf-legend"><i class="fa fa-exclamation esgst-faded"></i> - Overridable <i class="fa fa-question-circle" title="Overridable filters can be overridden by exceptions"></i></div>
                                <div class="esgst-gf-legend"><i class="fa fa-exclamation"></i> - Non-Overridable <i class="fa fa-question-circle" title="Non-Overridable filters cannot be overridden by exceptions"></i></div>
                            </div>
                            <br>
                            <div class="esgst-gf-preset-panel">
                                <div>
                                    <span class="esgst-bold">Preset:</span>
                                </div>
                                <div>
                                    <span></span> exceptions <i class="esgst-clickable fa fa-gear" title="Manage exceptions"></i>
                                </div>
                                <input class="form__input-small" type="text"/>
                                <div class="esgst-description esgst-bold"></div>
                                <div class="form__row__error esgst-hidden">
                                    <i class="fa fa-exclamation-circle"></i> Please enter a name for the preset.
                                </div>
                                <div class="esgst-description">The name of the preset.</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="esgst-gf-button">
                    <span>Expand</span><span class="esgst-hidden">Collapse</span> filters (<span>0</span> filtered - <span>0</span>P required to enter all unfiltered - <span></span>)
                </div>
            </div>
        `);
        box = gf.container.firstElementChild;
        filters = box.firstElementChild;
        basicFilters = filters.firstElementChild;
        typeFilters = basicFilters.nextElementSibling;
        categoryFilters = typeFilters.nextElementSibling;
        presetPanel = categoryFilters.nextElementSibling.lastElementChild;
        exceptionPanel = presetPanel.firstElementChild.nextElementSibling;
        exceptionCount = exceptionPanel.firstElementChild;
        exceptionButton = exceptionCount.nextElementSibling;
        presetInput = exceptionPanel.nextElementSibling;
        presetMessage = presetInput.nextElementSibling;
        presetWarning = presetMessage.nextElementSibling;
        presetPanel.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save Preset`, `Saving...`, saveGfPreset.bind(null, gf, presetInput, presetMessage, presetWarning)).set);
        button = box.nextElementSibling;
        expandButton = button.firstElementChild;
        collapseButton = expandButton.nextElementSibling;
        button.addEventListener(`click`, toggleGfFilters.bind(null, collapseButton, expandButton, filters));
        gf.filteredCount = collapseButton.nextElementSibling;
        gf.pointsCount = gf.filteredCount.nextElementSibling;
        if (!gf.popup && esgst.pagination) {
            gf.paginationFilteredCount = insertHtml(esgst.pagination.firstElementChild, `beforeEnd`, `
                <span>
                    (<span class="esgst-bold">0</span> filtered by Giveaway Filters)
                </span>
            `).firstElementChild;
        }
        presetDisplay = gf.pointsCount.nextElementSibling;
        presetButton.addEventListener(`click`, openGfPresetPopup.bind(null, gf, exceptionCount, presetDisplay, presetInput));
        name = esgst[`gf_preset${gf.type}`];
        if (name) {
            presets = JSON.parse(esgst.storage.filterPresets);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
            if (i >= 0) {
                preset = presets[i];
                presetDisplay.textContent = presetInput.value = name;
            } else {
                preset = null;
            }
        }
        if (!preset) {
            name = `Default${gf.type}`;
            preset = { name };
            [`maxLevel`, `minLevel`, `maxEntries`, `minEntries`, `maxCopies`, `minCopies`, `maxPoints`, `minPoints`, `maxMinutesToEnd`, `minMinutesToEnd`, `maxChance`, `minChance`, `maxRatio`, `minRatio`, `maxRating`, `minRating`, `pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedabck`, `entered`, `started`, `ended`, `deleted`, `hidden`, `fullCV`, `reducedCV`, `noCV`, `owned`, `wishlisted`, `ignored`, `previouslyEntered`, `previouslyWon`, `removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `dlcFree`, `dlcNonFree`, `package`, `genres`, `genreList`].forEach(key => {
                preset[key] = esgst.settings[`gf_${key}${gf.type}`];
            });
            presets = JSON.parse(esgst.storage.filterPresets);
            presets.push(preset);
            setValue(`filterPresets`, JSON.stringify(presets));
            setSetting(`gf_preset${gf.type}`, name);
            presetDisplay.textContent = presetInput.value = name;
        }
        if (preset.exceptions) {
            gf.exceptions = preset.exceptions;
            exceptionCount.textContent = preset.exceptions.length;
        } else {
            exceptionCount.textContent = 0;
        }
        gf.overrides = preset.overrides || {};
        gf.overrideButtons = {};
        exceptionButton.addEventListener(`click`, openGfExceptionPopup.bind(null, exceptionCount, gf, presetInput));
        if (!gf.advancedSearch) {
            basicFilters.classList.remove(`esgst-hidden`);
            [ { check: ((!esgst.createdPath || esgst.cewgd) && (!esgst.enteredPath || esgst.cewgd) && (!esgst.wonPath || esgst.cewgd)) || popup, maxValue: 10, minValue: 0, name: `Level` },
                { check: !esgst.wonPath || popup, infinite: true, maxValue: 99999, minValue: 0, name: `Entries` },
                { check: !esgst.wonPath || popup, infinite: true, maxValue: 99999, minValue: 1, name: `Copies` },
                { check: ((!esgst.createdPath || esgst.cewgd) && (!esgst.enteredPath || esgst.cewgd) && (!esgst.wonPath || esgst.cewgd)) || popup, maxValue: 100, minValue: 0, name: `Points` },
                { check: !esgst.wonPath || popup, maxValue: 43800, minValue: 0, name: `MinutesToEnd` },
                { check: ((!esgst.enteredPath || esgst.cewgd) && !esgst.createdPath && !esgst.wonPath) || popup, maxValue: 100, minValue: 0, name: `Chance`, step: 0.01 },
                { check: ((!esgst.enteredPath || esgst.cewgd) && !esgst.createdPath && !esgst.wonPath) || popup, maxValue: 99999, minValue: 0, name: `Ratio` },
                { check: true, maxValue: 100, minValue: 0, name: `Rating` }
            ].forEach(filter => {
                if (filter.check) {
                    name = filter.name;
                    if (name !== `Rating` || esgst.gc) {
                        maxKey = `max${name}`;
                        maxValue = filter.maxValue;
                        minKey = `min${name}`;
                        minValue = filter.minValue;
                        key = name === `MinutesToEnd` ? `minutesToEnd` : name.toLowerCase();
                        if (esgst[`gf_${key}`]) {
                            infinite = filter.infinite;
                            maxSavedValue = preset[maxKey] || maxValue;
                            minSavedValue = preset[minKey] || minValue;
                            step = filter.step || 1;
                            if (!infinite && maxSavedValue > maxValue) {
                                maxSavedValue = maxValue;
                            }
                            gf[maxKey] = maxSavedValue;
                            gf[minKey] = minSavedValue;
                            basicFilter = insertHtml(basicFilters, `beforeEnd`, `
                                <div class="esgst-gf-basic-filter">
                                    <div>${name === `MinutesToEnd` ? `Minutes To End` : name} <span class="esgst-gf-filter-count" title="Number of giveaways this filter is filtering">0</span> <span class="esgst-float-right"><input type="text" value="${minSavedValue}"> - <input type="text" value="${maxSavedValue}"></span></div>
                                    <div></div>
                                    <div></div>
                                </div>
                            `);
                            display = basicFilter.firstElementChild;
                            setGfOverride(gf, display, key);
                            slider = display.nextElementSibling;
                            if (name === `Rating`) {
                                let toggle = new ToggleSwitch(slider.nextElementSibling, `gf_noRating`, false, `Filter games with no rating.`, false, false, null, esgst.gf_noRating);
                                toggle.onEnabled = filterGfGiveaways.bind(null, gf);
                                toggle.onDisabled = filterGfGiveaways.bind(null, gf);
                            }
                            gf.counters[name.toLowerCase()] = display.firstElementChild.nextElementSibling;
                            gf[`${minKey}Input`] = gf.counters[name.toLowerCase()].nextElementSibling.firstElementChild;
                            gf[`${maxKey}Input`] = gf[`${minKey}Input`].nextElementSibling;
                            gf[`${maxKey}Input`].addEventListener(`change`, changeGfMaxValue.bind(null, infinite, slider, step));
                            gf[`${minKey}Input`].addEventListener(`change`, changeGfMinValue.bind(null, slider, step));
                            if (infinite) {
                                maxValue = maxSavedValue;
                            }
                            $(slider).slider({
                                change: changeGfSlider.bind(null, gf, maxKey, minKey),
                                min: minValue,
                                max: maxValue,
                                range: true,
                                slide: slideGfSlider.bind(null, gf, maxKey, minKey),
                                step: step,
                                values: [minSavedValue, maxSavedValue]
                            });
                        } else {
                            gf[maxKey] = maxValue;
                            gf[minKey] = minValue;
                        }
                    }
                }
            });
        }
        if (basicFilters.children.length === 1) {
            basicFilters.classList.add(`esgst-hidden`);
        }
        [ { check: esgst.giveawaysPath, key: `pinned`, name: `Pinned` },
            { check: ((!esgst.createdPath || esgst.cewgd) && (!esgst.enteredPath || esgst.cewgd) && (!esgst.wonPath || esgst.cewgd)) || popup, key: `group`, name: `Group` },
            { check: ((!esgst.createdPath || esgst.cewgd) && (!esgst.enteredPath || esgst.cewgd) && (!esgst.wonPath || esgst.cewgd)) || popup, key: `whitelist`, name: `Whitelist`},
            { check: ((!esgst.createdPath || esgst.cewgd) && (!esgst.enteredPath || esgst.cewgd) && (!esgst.wonPath || esgst.cewgd)) || popup, key: `regionRestricted`, name: `Region Restricted` },
            { check: (!esgst.createdPath && !esgst.enteredPath && !esgst.wonPath) || popup, key: `created`, name: `Created` },
            { check: esgst.createdPath, key: `received`, name: `Received` },
            { check: esgst.createdPath, key: `notReceived`, name: `Not Received` },
            { check: esgst.createdPath, key: `awaitingFeedback`, name: `Awaiting Feedback` },
            { check: (!esgst.createdPath && !esgst.enteredPah && !esgst.wonPath) || popup, key: `entered`, name: `Entered` },
            { check: (!esgst.enteredPath && !esgst.wonPath) || popup, key: `started`, name: `Started` },
            { check: !esgst.wonPath || popup, key: `ended`, name: `Ended` },
            { check: esgst.createdPath || esgst.enteredPath, key: `deleted`, name: `Deleted` },
            { check: true, key: `owned`, name: `Owned` },
            { check: true, key: `wishlisted`, name: `Wishlisted` },
            { check: true, key: `hidden`, name: `Hidden` },
            { check: true, key: `ignored`, name: `Ignored` },
            { check: true, key: `previouslyEntered`, name: `Previously Entered` },
            { check: true, key: `previouslyWon`, name: `Previously Won` },
            { check: true, key: `fullCV`, name: `Full CV` },
            { check: true, key: `reducedCV`, name: `Reduced CV` },
            { check: true, key: `noCV`, name: `No CV` }
        ].forEach(filter => {
            if (filter.check) {
                key = filter.key;
                if (key !== `regionRestricted` || !gf.advancedSearch) {
                    if (esgst[`gf_${key}`]) {
                        name = filter.name;
                        typeFilter = insertHtml(typeFilters, `beforeEnd`, `
                            <div class="esgst-gf-type-filter">
                                <span>${name}</span>
                                <span class="esgst-gf-filter-count" title="Number of giveaways this filter is filtering">0</span>
                            </div>
                        `);
                        value = preset[key] || `enabled`;
                        gf[key] = value;
                        gf[`${key}Checkbox`] = new Checkbox(typeFilter, value, true);
                        setGfOverride(gf, typeFilter, key);
                        gf[`${key}Checkbox`].checkbox.addEventListener(`click`, changeGfValue.bind(null, gf[`${key}Checkbox`], gf, key));
                        gf.counters[key] = typeFilter.lastElementChild;
                    } else {
                        gf[key] = `enabled`;
                    }
                }
            }
        });
        if (typeFilters.children.length === 1) {
            typeFilters.classList.add(`esgst-hidden`);
        }
        if (esgst.gc) {
            categoryFilters.classList.remove(`esgst-hidden`);
            [ { id: `gc_rm`, key: `removed`, name: `Removed` },
                { id: `gc_tc`, key: `tradingCards`, name: `Trading Cards` },
                { id: `gc_a`, key: `achievements`, name: `Achievements` },
                { id: `gc_mp`, key: `multiplayer`, name: `Multiplayer` },
                { id: `gc_sc`, key: `steamCloud`, name: `Steam Cloud` },
                { id: `gc_l`, key: `linux`, name: `Linux` },
                { id: `gc_m`, key: `mac`, name: `Mac` },
                { id: `gc_dlc`, key: `dlc`, name: `DLC` },
                { id: `gc_dlc_b`, key: `dlcFree`, name: `DLC (Free Base)` },
                { id: `gc_dlc_b`, key: `dlcNonFree`, name: `DLC (Non-Free Base)` },
                { id: `gc_p`, key: `package`, name: `Package` },
                { id: `gc_g`, key: `genres`, name: `Genres` }
            ].forEach(filter => {
                id = filter.id;
                if ((id !== `gc_dlc` || !gf.advancedSearch) && esgst[id]) {
                    key = filter.key;
                    genres = key === `genres`;
                    if (esgst[`gf_${key}`]) {
                        name = filter.name;
                        categoryFilter = insertHtml(categoryFilters, `beforeEnd`, `
                            <div class="esgst-gf-category-filter">
                                <span>${name} ${genres ? `<input placeholder="Genre1, Genre2" type="text">` : ``}</span>
                                <span class="esgst-gf-filter-count" title="Number of giveaways this filter is filtering">0</span>
                            </div>
                        `);
                        value = typeof preset[key] !== `undefined` ? preset[key] : `enabled`;
                        gf[key] = value;
                        gf[`${key}Checkbox`] = new Checkbox(categoryFilter, value, true);
                        setGfOverride(gf, categoryFilter, key);
                        gf[`${key}Checkbox`].checkbox.addEventListener(`click`, changeGfValue.bind(null, gf[`${key}Checkbox`], gf, key));                        
                        gf.counters[key] = categoryFilter.lastElementChild;
                        if (genres) {
                            gf.genreListInput = categoryFilter.firstElementChild.nextElementSibling.nextElementSibling.firstElementChild;
                            value = (preset.genreList && preset.genreList.replace(/,(?!\s)/g, `, `)) || ``;
                            gf.genreList = gf.genreListInput.value = value;
                            gf.genreListInput.addEventListener(`change`, changeGfValue.bind(null, gf.genreListInput, gf, `genreList`));
                        }
                    } else {
                        gf[key] = `enabled`;
                    }
                }
            });
            if (categoryFilters.children.length === 1) {
                categoryFilters.classList.add(`esgst-hidden`);
            }
        }
        return headingButton;
    }

    function toggleGfFilters(collapseButton, expandButton, filters) {
        collapseButton.classList.toggle(`esgst-hidden`);
        expandButton.classList.toggle(`esgst-hidden`);
        filters.classList.toggle(`esgst-hidden`);
    }

    function changeGfMaxValue(infinite, slider, step, event) {
        var max, min, value;
        max = $(slider).slider(`values`, 1);
        min = $(slider).slider(`values`, 0);
        value = step ? parseFloat(event.currentTarget.value) : parseInt(event.currentTarget.value);
        if (value !== max && value >= min) {
            if (infinite) {
                $(slider).slider(`option`, `max`, value);
            }
            $(slider).slider(`values`, [min, value]);
        }
    }

    function changeGfMinValue(slider, step, event) {
        var max, min, value;
        max = $(slider).slider(`values`, 1);
        min = $(slider).slider(`values`, 0);
        value = step ? parseFloat(event.currentTarget.value) : parseInt(event.currentTarget.value);
        if (value !== min && value <= max) {
            $(slider).slider(`values`, [value, max]);
        }
    }

    function changeGfSlider(gf, maxKey, minKey, event, ui) {
        gf[maxKey] = ui.values[1];
        gf[minKey] = ui.values[0];
        filterGfGiveaways(gf);
    }

    function slideGfSlider(gf, maxKey, minKey, event, ui) {
        gf[`${maxKey}Input`].value = ui.values[1];
        gf[`${minKey}Input`].value = ui.values[0];
    }

    function changeGfValue(context, gf, key) {
        if (key === `ended`) {
            esgst.stopEs = false;
        }
        gf[key] = context.value;
        filterGfGiveaways(gf);
    }

    function saveGfPreset(gf, presetInput, presetMessage, presetWarning, callback) {
        var exceptions, name, preset, presets;
        name = presetInput.value;
        if (name) {
            presetWarning.classList.add(`esgst-hidden`);
            preset = { name };
            [`maxLevel`, `minLevel`, `maxEntries`, `minEntries`, `maxCopies`, `minCopies`, `maxPoints`, `minPoints`, `maxMinutesToEnd`, `minMinutesToEnd`, `maxChance`, `minChance`, `maxRatio`, `minRatio`, `maxRating`, `minRating`, `pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedback`, `entered`, `started`, `ended`, `deleted`, `hidden`, `fullCV`, `reducedCV`, `noCV`, `owned`, `wishlisted`, `ignored`, `previouslyEntered`, `previouslyWon`, `removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `dlcFree`, `dlcNonFree`, `package`, `genres`, `genreList`].forEach(key => {
                if (typeof gf[key] !== `undefined`) {
                    preset[key] = gf[key];
                }
            });
            preset.exceptions = gf.exceptions;
            preset.overrides = gf.overrides;
            getValue(`filterPresets`, `[]`).then(value => {
                presets = JSON.parse(value);
                for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
                if (i >= 0) {
                    exceptions = presets[i].exceptions;
                    if (exceptions) {
                        preset.exceptions = exceptions;
                    }
                    presets[i] = preset;
                } else {
                    presets.push(preset);
                }
                return setValue(`filterPresets`, JSON.stringify(presets));
            }).then(() => {
                return setSetting(`gf_preset${gf.type}`, name);
            }).then(() => {
                createFadeMessage(presetMessage, `Saved!`);
                callback();
            });
        } else {
            presetWarning.classList.remove(`esgst-hidden`);
            callback();
        }
    }

    function openGfPresetPopup(gf, exceptionCount, presetDisplay, presetInput) {
        var deleted, details, heading, hideAll, popup, preset, renameButton, renameInput, row, showOnly, table, undoButton;
        popup = new Popup(`fa-sliders`, `Manage presets:`, true);
        popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-description">To edit a preset, apply it and save it with the same name. To rename a preset, click the edit icon, enter the new name and hit "Enter". Drag and drop presets to move them.</div>`);
        deleted = [];
        undoButton = insertHtml(popup.description, `beforeEnd`, `
            <div class="esgst-clickable esgst-hidden">
                <i class="fa fa-rotate-left"></i>
                <span>Undo Delete</span>
            </div>
        `);
        undoButton.addEventListener(`click`, undoGfDeletePreset.bind(null, deleted, undoButton));
        table = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left popup__keys__list"></div>`);
        getValue(`filterPresets`, `[]`).then(value => {
            JSON.parse(value).forEach(preset => {
                details = ``;
                [ { key: `Level`, name: `level` },
                    { key: `Entries`, name: `entries` },
                    { key: `Copies`, name: `copies` },
                    { key: `Points`, name: `points` },
                    { key: `MinutesToEnd`, name: `minutes to end` },
                    { key: `Chance`, name: `chance` },
                    { key: `Ratio`, name: `ratio` },
                    { key: `Rating`, name: `rating` }
                ].forEach(filter => {
                    if (typeof preset[`max${filter.key}`] !== `undefined`) {
                        details += `${preset[`min${filter.key}`]}-${preset[`max${filter.key}`]} ${filter.name}, `;
                    }
                });
                hideAll = [];
                showOnly = [];
                [ { key: `pinned`, name: `pinned` },
                    { key: `group`, name: `group` },
                    { key: `whitelist`, name: `whitelist` },
                    { key: `regionRestricted`, name: `region restricted` },
                    { key: `created`, name: `created` },
                    { key: `received`, name: `received` },
                    { key: `notReceived`, name: `not received` },
                    { key: `awaitingFeedback`, name: `awaiting feedback` },
                    { key: `entered`, name: `entered` },
                    { key: `deleted`, name: `deleted` },
                    { key: `owned`, name: `owned`},
                    { key: `wishlisted`, name: `wishlisted` },
                    { key: `hidden`, name: `hidden` },
                    { key: `ignored`, name: `ignored` },
                    { key: `previouslyEntered`, name: `previously entered`, },
                    { key: `previouslyWon`, name: `previously won`, },
                    { key: `fullCV`, name: `full CV` },
                    { key: `reducedCV`, name: `reduced CV` },
                    { key: `noCV`, name: `no CV`, },
                    { key: `removed`, name: `removed` },
                    { key: `tradingCards`, name: `trading cards` },
                    { key: `achievements`, name: `achievements` },
                    { key: `multiplayer`, name: `multiplayer` },
                    { key: `steamCloud`, name: `steam cloud` },
                    { key: `linux`, name: `linux` },
                    { key: `mac`, name: `mac` },
                    { key: `dlc`, name: `dlc` },
                    { key: `dlcFree`, name: `dlc (free base)` },
                    { key: `dlcNonFree`, name: `dlc (non-free base)` },
                    { key: `package`, name: `package` },
                    { key: `genres`, name: `genres` }
                ].forEach(key => {
                    if (preset[key.key] === `disabled`) {
                        if (key.key === `genres` && preset.genres && preset.genreList) {
                            hideAll.push(`genres (${preset.genreList.toLowerCase()})`);
                        } else {
                            hideAll.push(key.name);
                        }
                    } else if (preset[key.key] === `none`) {
                        if (key.key === `genres` && preset.genres && preset.genreList) {
                            showOnly.push(`genres (${preset.genreList.toLowerCase()})`);
                        } else {
                            showOnly.push(key.name);
                        }
                    }
                });
                if (hideAll.length > 0) {
                    details += `hide: ${hideAll.join(` & `)}, `;
                }
                if (showOnly.length > 0) {
                    details += `only show: ${showOnly.join(` & `)}, `;
                }
                row = insertHtml(table, `beforeEnd`, `
                    <div ${presetInput.value === preset.name ? `class="esgst-green-highlight"` : ``} draggable="true">
                        <div class="esgst-float-left">
                            <input class="esgst-hidden" type="text" value="${preset.name}"/>
                            <strong class="esgst-clickable">${preset.name}</strong>
                        </div>
                        <div class="esgst-clickable esgst-float-right">
                            <i class="fa fa-edit" title="Rename preset"></i>
                            <span title="Delete preset">
                                <i class="fa fa-trash"></i>
                            </span>
                        </div>
                        <div class="esgst-clear"></div>
                        <div class="esgst-description">${details.slice(0, -2)}</div>
                    </div>
                `);
                row.addEventListener(`dragstart`, setGfSource.bind(null, gf, preset, row));
                row.addEventListener(`dragenter`, getGfSource.bind(null, gf, row, table));
                row.addEventListener(`dragend`, saveGfSource.bind(null, gf));
                renameInput = row.firstElementChild.firstElementChild;
                heading = renameInput.nextElementSibling;
                renameInput.addEventListener(`keypress`, renameGfPreset.bind(null, heading, preset, presetDisplay, presetInput));
                heading.addEventListener(`click`, applyGfPreset.bind(null, gf, exceptionCount, popup, preset, presetDisplay, presetInput));
                renameButton = row.firstElementChild.nextElementSibling.firstElementChild;
                renameButton.addEventListener(`click`, showGfRenameInput.bind(null, heading, renameInput));
                renameButton.nextElementSibling.addEventListener(`click`, deleteGfPreset.bind(null, deleted, preset, row, undoButton));
            });
            popup.open();
        });
    }

    function setGfSource(gf, preset, row, event) {
        var i, presets;
        event.dataTransfer.setData(`text/plain`, ``);
        gf.source = row;
        getValue(`filterPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
            gf.sourceIndex = i;
        });
    }

    function getGfSource(gf, row, table) {
        var current, i;
        current = gf.source;
        i = 0;
        do {
            current = current.previousElementSibling;
            if (current && current === row) {
                gf.sourceNewIndex = i;
                table.insertBefore(gf.source, row);
                return;
            }
            ++i;
        } while (current);
        gf.sourceNewIndex = i - 1;
        table.insertBefore(gf.source, row.nextElementSibling);
    }

    function saveGfSource(gf) {
        var presets;
        getValue(`filterPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            presets.splice(gf.sourceNewIndex, 0, presets.splice(gf.sourceIndex, 1)[0]);
            setValue(`filterPresets`, JSON.stringify(presets));
        });
    }

    function applyGfPreset(gf, exceptionCount, popup, preset, presetDisplay, presetInput) {
        var checkbox, input, key;
        [`maxLevel`, `minLevel`, `maxEntries`, `minEntries`, `maxCopies`, `minCopies`, `maxPoints`, `minPoints`, `maxMinutesToEnd`, `minMinutesToEnd`, `maxChance`, `minChance`, `maxRatio`, `minRatio`, `maxRating`, `minRating`, `pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedabck`, `entered`, `started`, `ended`, `deleted`, `hidden`, `fullCV`, `reducedCV`, `noCV`, `owned`, `wishlisted`, `ignored`, `previouslyEntered`, `previouslyWon`, `removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `dlcFree`, `dlcNonFree`, `package`, `genres`, `genreList`].forEach(key => {
            checkbox = gf[`${key}Checkbox`];
            if (checkbox) {
                if (checkbox.isThreeState) {
                    gf[key] = checkbox.value = preset[key];
                    checkbox.change(false, gf[key]);
                } else {
                    if (preset[key]) {
                        gf[key] = true;
                        checkbox.check();
                    } else {
                        gf[key] = false;
                        checkbox.uncheck();
                    }
                }
            } else {
                input = gf[`${key}Input`];
                if (input) {
                    gf[key] = input.value = preset[key];
                    input.dispatchEvent(new Event(`change`));
                }
            }
        });
        presetDisplay.textContent = presetInput.value = preset.name;
        if (preset.exceptions) {
            gf.exceptions = preset.exceptions;
            exceptionCount.textContent = preset.exceptions.length;
        } else {
            exceptionCount.textContent = 0;
        }
        gf.overrides = preset.overrides || {};
        for (key in gf.overrideButtons) {
            gf.overrideButtons[key].change();
        }
        setSetting(`gf_preset${gf.type}`, preset.name).then(() => {
            popup.close();
            filterGfGiveaways(gf);
        });
    }

    function showGfRenameInput(heading, renameInput) {
        var value;
        heading.classList.add(`esgst-hidden`);
        renameInput.classList.remove(`esgst-hidden`);
        value = renameInput.value;
        renameInput.value = ``;
        renameInput.focus();
        renameInput.value = value;
    }

    function renameGfPreset(heading, preset, presetDisplay, presetInput, event) {
        var i, newName, oldName, presets;
        if (event.key === `Enter`) {
            oldName = preset.name;
            newName = event.currentTarget.value;
            getValue(`filterPresets`).then(value => {
                presets = JSON.parse(value);
                for (i = presets.length - 1; i >= 0 && presets[i].name !== oldName; --i);
                preset.name = presets[i].name = newName;
                setValue(`filterPresets`, JSON.stringify(presets));
                heading.textContent = newName;
                if (presetInput.value === oldName) {
                    presetDisplay.textContent = presetInput.value = newName;
                }
                [``, `Wishlist`, `Recommended`, `Group`, `New`, `Created`, `Entered`, `Won`, `Groups`, `User`, `Gb`, `Ge`, `Ged`].forEach(type => {
                    if (esgst[`gf_preset${type}`] === oldName) {
                        setSetting(`gf_preset${type}`, newName);
                    }
                });
                event.currentTarget.classList.add(`esgst-hidden`);
                heading.classList.remove(`esgst-hidden`);
            });
        }
    }

    function deleteGfPreset(deleted, preset, row, undoButton, event) {
        var deleteButton, i, presets;
        deleteButton = event.currentTarget;
        deleteButton.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        getValue(`filterPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
            presets.splice(i, 1);
            setValue(`filterPresets`, JSON.stringify(presets));
            deleteButton.innerHTML = `<i class="fa fa-trash"></i>`;
            row.classList.add(`esgst-hidden`);
            deleted.push({
                details: preset,
                row: row
            });
            undoButton.classList.remove(`esgst-hidden`);
        });
    }

    function undoGfDeletePreset(deleted, undoButton) {
        var preset, presets;
        preset = deleted.pop();
        preset.row.classList.remove(`esgst-hidden`);
        preset.row.parentElement.appendChild(preset.row);
        getValue(`filterPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            presets.push(preset.details);
            setValue(`filterPresets`, JSON.stringify(presets));
            if (deleted.length === 0) {
                undoButton.classList.add(`esgst-hidden`);
            }
        });
    }

    function openGfExceptionPopup(exceptionCount, gf, presetInput) {
        var deleted, details, i, max, min, name, popup, preset, presets, row, table, undoButton;
        popup = new Popup(`fa-gear`, `Manage exceptions: <i class="fa fa-question-circle" title="Exceptions are giveaways that will always appear, no matter which filters are set (they still get filtered by type/category filters). For example, if you have a filter that only shows giveaways with 0.5+ chance, but you have an exception for wishlist, all wishlist giveaways will appear, regardless of their chance.\n\nEach exception works as an AND conjunction, so if you want to make an exception for wishlist giveaways **or** giveaways with multiple copies, you have to create 2 separate exceptions, otherwise the exception will be for giveaways that are both wishlist **and** multiple copies."></i>`, true);
        deleted = [];
        undoButton = insertHtml(popup.description, `beforeEnd`, `
            <div class="esgst-clickable esgst-hidden">
                <i class="fa fa-rotate-left"></i>
                <span>Undo Delete</span>
            </div>
        `);
        table = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left popup__keys__list"></div>`);
        name = presetInput.value;
        getValue(`filterPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
            preset = presets[i];
            undoButton.addEventListener(`click`, undoGfDeleteException.bind(null, deleted, exceptionCount, gf, preset, undoButton));
            if (preset.exceptions) {
                preset.exceptions.forEach(exception => {
                    details = ``;
                    [ { key: `Level`, name: `level` },
                        { key: `Entries`, name: `entries` },
                        { key: `Copies`, name: `copies` },
                        { key: `Points`, name: `points` },
                        { key: `MinutesToEnd`, name: `minutes to end` },
                        { key: `Chance`, name: `chance` },
                        { key: `Ratio`, name: `ratio` },
                        { key: `Rating`, name: `rating` }
                    ].forEach(filter => {
                        max = exception[`max${filter.key}`];
                        min = exception[`min${filter.key}`];
                        if (typeof max !== `undefined` && typeof min !== `undefined`) {
                            details += `${min}-${max} ${filter.name}, `;
                        } else if (typeof max !== `undefined`) {
                            details += `?-${max} ${filter.name}, `;
                        } else if (typeof min !== `undefined`) {
                            details += `${min}-? ${filter.name}, `;
                        }
                    });
                    [ { key: `pinned`, name: `pinned` },
                        { key: `group`, name: `group` },
                        { key: `whitelist`, name: `whitelist` },
                        { key: `regionRestricted`, name: `region restricted` },
                        { key: `created`, name: `created` },
                        { key: `received`, name: `received` },
                        { key: `notReceived`, name: `not received` },
                        { key: `awaitingFeedback`, name: `awaiting feedback` },
                        { key: `entered`, name: `entered` },
                        { key: `deleted`, name: `deleted` },
                        { key: `owned`, name: `owned`},
                        { key: `wishlisted`, name: `wishlisted` },
                        { key: `hidden`, name: `hidden` },
                        { key: `ignored`, name: `ignored` },
                        { key: `previouslyEntered`, name: `previously entered` },
                        { key: `previouslyWon`, name: `previously won` },
                        { key: `fullCV`, name: `full CV` },
                        { key: `reducedCV`, name: `reduced CV` },
                        { key: `noCV`, name: `no CV`, },
                        { key: `removed`, name: `removed` },
                        { key: `tradingCards`, name: `trading cards` },
                        { key: `achievements`, name: `achievements` },
                        { key: `multiplayer`, name: `multiplayer` },
                        { key: `steamCloud`, name: `steam cloud` },
                        { key: `linux`, name: `linux` },
                        { key: `mac`, name: `mac` },
                        { key: `dlc`, name: `dlc` },
                        { key: `dlcFree`, name: `dlc (free base)` },
                        { key: `dlcNonFree`, name: `dlc (non-free base)` },
                        { key: `package`, name: `package` },
                        { key: `genres`, name: `genres` }
                    ].forEach(key => {
                        if (exception[key.key]) {
                            details += (key.key === `genres` ? `genres (${exception.genreList.toLowerCase()}), ` : `${key.name}, `);
                        }
                    });
                    row = insertHtml(table, `beforeEnd`, `
                        <div>
                            <div class="esgst-bold esgst-clickable esgst-float-left">${exception.name}</div>
                            <div class="esgst-clickable esgst-float-right">
                                <i class="fa fa-edit" title="Edit exception"></i>
                                <span title="Delete exception">
                                    <i class="fa fa-trash"></i>
                                </span>
                            </div>
                            <div class="esgst-clear"></div>
                            <div class="esgst-description">${details.slice(0, -2)}</div>
                        </div>
                    `);
                    heading = row.firstElementChild;
                    editButton = heading.nextElementSibling.firstElementChild;
                    editButton.addEventListener(`click`, openGfManageExceptionPopup.bind(null, exception, exceptionCount, gf, preset, () => popup.close()));
                    editButton.nextElementSibling.addEventListener(`click`, deleteGfException.bind(null, deleted, exception, exceptionCount, gf, heading, preset, row, undoButton));
                });
            }
            popup.description.appendChild(new ButtonSet(`green`, ``, `fa-plus`, ``, `Create Exception`, ``, openGfManageExceptionPopup.bind(null, {}, exceptionCount, gf, preset, () => popup.close())).set);
            popup.open();
        });
    }

    function openGfManageExceptionPopup(exception, exceptionCount, gf, preset, callback) {
        var basicFilters, categoryFilters, context, typeFilters;
        if (callback) {
            callback();
        }
        popup = new Popup(`fa-edit`, `Create/edit exception:`, true);
        popup.scrollable.classList.add(`esgst-gf-container`, `esgst-gf-filters`, `esgst-text-left`);
        popup.name = insertHtml(popup.description, `afterBegin`, `Name: <input type="text" value="${exception.name || ``}"/>`);
        basicFilters = insertHtml(popup.scrollable, `beforeEnd`, `
            <div class="esgst-gf-basic-filters">
                <div>
                    <span class="esgst-bold">Basic Filters:</span>
                </div>
            </div>
        `);
        [{ key: `Level`, name: `Level` },
            { key: `Entries`, name: `Entries` },
            { key: `Copies`, name: `Copies` },
            { key: `Points`, name: `Points` },
            { key: `MinutesToEnd`, name: `Minutes To End` },
            { key: `Chance`, name: `Chance` },
            { key: `Ratio`, name: `Ratio` },
            { key: `Rating`, name: `Rating` }
        ].forEach(filter => {
            context = insertHtml(basicFilters, `beforeEnd`, `
                <div class="esgst-gf-basic-filter esgst-text-left">
                    <div>${filter.name} <span class="esgst-float-right"><input type="text" value="${exception[`min${filter.key}`] || ``}"/> - <input type="text" value="${exception[`max${filter.key}`] || ``}"/></span></div>
                </div>
            `).firstElementChild.lastElementChild;
            popup[`min${filter.key}`] = context.firstElementChild;
            popup[`max${filter.key}`] = context.lastElementChild;
        });
        typeFilters = insertHtml(popup.scrollable, `beforeEnd`, `
            <div class="esgst-gf-type-filters">
                <div>
                    <span class="esgst-bold">Type Filters:</span>
                </div>
            </div>
        `);
        [{ key: `pinned`, name: `Pinned` },
            { key: `group`, name: `Group` },
            { key: `whitelist`, name: `Whitelist` },
            { key: `regionRestricted`, name: `Region Restricted` },
            { key: `created`, name: `Created` },
            { key: `received`, name: `Received` },
            { key: `notReceived`, name: `Not Received` },
            { key: `awaitingFeedback`, name: `Awaiting Feedback` },
            { key: `entered`, name: `Entered` },
            { key: `started`, name: `Started` },
            { key: `ended`, name: `Ended` },
            { key: `deleted`, name: `Deleted` },
            { key: `owned`, name: `Owned` },
            { key: `wishlisted`, name: `Wishlisted` },
            { key: `hidden`, name: `Hidden` },
            { key: `ignored`, name: `Ignored` },
            { key: `previouslyEntered`, name: `Previously Entered` },
            { key: `previouslyWon`, name: `Previously Won` },
            { key: `fullCV`, name: `Full CV` },
            { key: `reducedCV`, name: `Reduced CV` },
            { key: `noCV`, name: `No CV` }
        ].forEach(filter => {
            popup[filter.key] = new Checkbox(insertHtml(typeFilters, `beforeEnd`, `<div class="esgst-gf-type-filter"><span></span> ${filter.name}</div>`).firstElementChild, exception[filter.key]);
        });
        categoryFilters = insertHtml(popup.scrollable, `beforeEnd`, `
            <div class="esgst-gf-category-filters">
                <div>
                    <span class="esgst-bold">Category Filters:</span>
                </div>
            </div>
        `);
        [{ key: `removed`, name: `Removed` },
            { key: `tradingCards`, name: `Trading Cards` },
            { key: `achievements`, name: `Achievements` },
            { key: `multiplayer`, name: `Multiplayer` },
            { key: `steamCloud`, name: `Steam Cloud` },
            { key: `linux`, name: `Linux` },
            { key: `mac`, name: `Mac` },
            { key: `dlc`, name: `DLC` },
            { key: `dlcFree`, name: `DLC (Free Base)` },
            { key: `dlcNonFree`, name: `DLC (Non-Free Base)` },
            { key: `package`, name: `Package` },
            { key: `genres`, name: `Genres` }
        ].forEach(filter => {
            context = insertHtml(categoryFilters, `beforeEnd`, `<div class="esgst-gf-category-filter"><span></span> ${filter.name}${filter.key === `genres` ? ` <input type="text" value="${exception.genreList || ``}"/>` : ``}</div>`);
            popup[filter.key] = new Checkbox(context.firstElementChild, exception[filter.key]);
            if (filter.key === `genres`) {
                popup.genreList = context.lastElementChild;
            }
        });
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveGfException.bind(null, exceptionCount, gf, preset, popup)).set);
        popup.open();
    }

    function saveGfException(exceptionCount, gf, preset, popup, callback) {
        var exception, i, presets;
        exception = { name: popup.name.value };
        [`Level`, `Entries`, `Copies`, `Points`, `MinutesToEnd`, `Chance`, `Ratio`, `Rating`].forEach(name => {
            if (popup[`max${name}`].value.length) {
                exception[`max${name}`] = parseFloat(popup[`max${name}`].value);
            }
            if (popup[`min${name}`].value.length) {
                exception[`min${name}`] = parseFloat(popup[`min${name}`].value);
            }
        });
        [`pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedback`, `entered`, `started`, `ended`, `deleted`, `owned`, `wishlisted`, `hidden`, `ignored`, `previouslyEntered`, `previouslyWon`, `fullCV`, `reducedCV`, `noCV`, `removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `dlcFree`, `dlcNonFree`, `package`, `genres`].forEach(name => {
            if (popup[name].input.checked) {
                if (name === `genres`) {
                    if (popup.genreList.value.length) {
                        exception.genres = 1;
                        exception.genreList = popup.genreList.value;
                    }
                } else {
                    exception[name] = 1;
                }
            }
        });
        if (!preset.exceptions) {
            preset.exceptions = [];
        }
        for (i = preset.exceptions.length - 1; i >= 0 && preset.exceptions[i].name !== exception.name; --i);
        if (i >= 0) {
            preset.exceptions[i] = exception;
        } else {
            preset.exceptions.push(exception);
            exceptionCount.textContent = preset.exceptions.length;
        }
        gf.exceptions = preset.exceptions;
        getValue(`filterPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
            presets[i] = preset;
            return setValue(`filterPresets`, JSON.stringify(presets));
        }).then(() => {
            callback();
            popup.close();
            filterGfGiveaways(gf);
        });
    }

    function deleteGfException(deleted, exception, exceptionCount, gf, heading, preset, row, undoButton, event) {
        var deleteButton, exception, i, preset, presets;
        deleteButton = event.currentTarget;
        deleteButton.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        for (i = preset.exceptions.length - 1; i >= 0 && preset.exceptions[i].name !== exception.name; --i);
        preset.exceptions.splice(i, 1);
        gf.exceptions = preset.exceptions;
        exceptionCount.textContent = preset.exceptions.length;
        getValue(`filterPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
            presets[i] = preset;
            setValue(`filterPresets`, JSON.stringify(presets));
            deleteButton.innerHTML = `<i class="fa fa-trash"></i>`;
            row.classList.add(`esgst-hidden`);
            deleted.push({
                details: exception,
                row: row
            });
            undoButton.classList.remove(`esgst-hidden`);
            filterGfGiveaways(gf);
        });
    }

    function undoGfDeleteException(deleted, exceptionCount, gf, preset, undoButton) {
        var exception, i, presets;
        exception = deleted.pop();
        exception.row.classList.remove(`esgst-hidden`);
        exception.row.parentElement.appendChild(exception.row);
        preset.exceptions.push(exception.details);
        gf.exceptions = preset.exceptions;
        exceptionCount.textContent = preset.exceptions.length;
        getValue(`filterPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
            presets[i] = preset;
            setValue(`filterPresets`, JSON.stringify(presets));
            if (deleted.length === 0) {
                undoButton.classList.add(`esgst-hidden`);
            }
        });
    }

    function filterGfGiveaways(gf, unfilter, endless) {
        let giveaways, key;
        for (key in gf.counters) {
            gf.counters[key].textContent = `0`;
        }
        giveaways = gf.popup ? esgst.popupGiveaways : esgst.currentGiveaways;
        giveaways.forEach(giveaway => {
            if (unfilter) {
                if (giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                    giveaway.outerWrap.classList.remove(`esgst-hidden`);
                }
            } else if (filterGfGiveaway(gf, giveaway)) {
                if (!giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                    giveaway.outerWrap.classList.add(`esgst-hidden`);
                }
            } else if (giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                giveaway.outerWrap.classList.remove(`esgst-hidden`);
            }
        });
        updateGfCount(gf, endless);
        if (esgst.gfType !== `Popup` && esgst.checkEndlessScrolling) {
            esgst.checkEndlessScrolling();
        }
    }

    function filterGfException(gf, giveaway) {
        var basicFilters, categoryFilters, filtered, i, j, key, maxKey, minKey, minutes, n, name, typeFilters, value;
        basicFilters = [`Level`, `Entries`, `Copies`, `Points`, `MinutesToEnd`, `Chance`, `Ratio`, `Rating`];
        typeFilters = [`pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedback`, `entered`, `started`, `ended`, `deleted`, `owned`, `wishlisted`, `hidden`, `ignored`, `previouslyEntered`, `previouslyWon`, `fullCV`, `reducedCV`, `noCV`];
        categoryFilters = [`removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `dlcFree`, `dlcNonFree`, `package`, `genres`];
        filtered = false;
        for (i = 0, n = basicFilters.length; !filtered && i < n; ++i) {
            name = basicFilters[i];
            if ((name === `Rating` && esgst.gc && giveaway.gcReady) || name !== `Rating`) {
                key = name.toLowerCase();
                maxKey = `max${name}`;
                minKey = `min${name}`;
                if (name === `MinutesToEnd`) {
                    minutes = (giveaway.endTime - Date.now()) / 60000;
                }
                if (typeof gf[minKey] !== `undefined`) {
                    if (name === `MinutesToEnd`) {
                        filtered = minutes >= gf[minKey] && !giveaway.ended ? false : true;
                    } else {
                        filtered = giveaway[key] >= gf[minKey] ? false : true;
                    }
                }
                if (!filtered) {
                    if (typeof gf[maxKey] !== `undefined`) {
                        if (name === `MinutesToEnd`) {
                            filtered = minutes <= gf[maxKey] && !giveaway.ended ? false : true;
                        } else {
                            filtered = giveaway[key] <= gf[maxKey] ? false : true;
                        }
                    }
                }
            }
        }
        for (i = 0, n = typeFilters.length; !filtered && i < n; ++i) {
            key = typeFilters[i];
            if ((key === `regionRestricted` && !gf.advancedSearch) || key !== `regionRestricted`) {
                if (gf[key]) {
                    filtered = (key === `fullCV` ? !giveaway.reducedCV && !giveaway.noCV : giveaway[key]) ? false : true;
                }
            }
        }
        if (esgst.gc && giveaway.gcReady) {
            for (i = 0, n = categoryFilters.length; !filtered && i < n; ++i) {
                key = categoryFilters[i];
                if (key === `genres`) {
                    if (giveaway.genres && gf.genreList) {
                        genres = gf.genreList.toLowerCase().split(/,\s/);
                        for (j = genres.length - 1; j >= 0 && giveaway.genres.indexOf(genres[j]) < 0; --j);
                        value = j >= 0;
                    } else {
                        value = false;
                    }
                } else {
                    value = giveaway[key];
                }
                if (gf[key]) {
                    filtered = value ? false : true;
                }
            }
        }
        return filtered;
    }

    function filterGfGiveaway(gf, giveaway) {
        var basicFilters, categoryFilters, counterKey, filtered, i, j, key, maxKey, minKey, minutes, n, name, override, typeFilters, value;
        basicFilters = [`Level`, `Entries`, `Copies`, `Points`, `MinutesToEnd`, `Chance`, `Ratio`, `Rating`];
        typeFilters = [`pinned`, `group`, `whitelist`, `regionRestricted`, `created`, `received`, `notReceived`, `awaitingFeedback`, `entered`, `started`, `ended`, `deleted`, `owned`, `wishlisted`, `hidden`, `ignored`, `previouslyEntered`, `previouslyWon`, `fullCV`, `reducedCV`, `noCV`];
        categoryFilters = [`removed`, `tradingCards`, `achievements`, `multiplayer`, `steamCloud`, `linux`, `mac`, `dlc`, `dlcFree`, `dlcNonFree`, `package`, `genres`];
        filtered = false;
        override = 0;
        if (!gf.advancedSearch) {
            for (i = 0, n = basicFilters.length; i < n && (!filtered || !override); ++i) {
                name = basicFilters[i];
                if ((name === `Rating` && esgst.gc && giveaway.gcReady) || name !== `Rating`) {
                    key = name.toLowerCase();
                    maxKey = `max${name}`;
                    minKey = `min${name}`;
                    if (name === `MinutesToEnd`) {
                        if (!giveaway.ended && !giveaway.deleted) {
                            minutes = (giveaway.endTime - Date.now()) / 60000;
                            if (minutes < gf[minKey] || minutes > gf[maxKey]) {
                                filtered = true;
                                override = gf.overrides.minutesToEnd;
                                counterKey = key;
                            }
                        }
                    } else if (giveaway[key] < gf[minKey] || giveaway[key] > gf[maxKey]) {
                        if (name !== `Rating` || giveaway.rating !== 0 || esgst.gf_noRating) {
                            filtered = true;
                            override = gf.overrides[key];
                            counterKey = key;
                        }
                    }
                }
            }
        }
        for (i = 0, n = typeFilters.length; i < n && (!filtered || !override); ++i) {
            key = typeFilters[i];
            if ((key === `regionRestricted` && !gf.advancedSearch) || key !== `regionRestricted`) {
                if ((key === `fullCV` && ((gf.fullCV === `disabled` && !giveaway.reducedCV && !giveaway.noCV) || (gf.fullCV === `none` && (giveaway.reducedCV || giveaway.noCV)))) || (key !== `fullCV` && ((gf[key] === `disabled` && giveaway[key]) || (gf[key] === `none` && !giveaway[key])))) {
                    filtered = true;
                    override = gf.overrides[key];
                    if (!counterKey) {
                        counterKey = key;
                    }
                    if (key === `ended` && gf.ended === `disabled` && (esgst.createdPath || esgst.enteredPath || esgst.wonPath || esgst.userPath)) {
                        esgst.stopEs = true;
                    }
                }
            }
        }
        if (esgst.gc && giveaway.gcReady) {
            for (i = 0, n = categoryFilters.length; i < n && (!filtered || !override); ++i) {
                key = categoryFilters[i];
                if (key !== `dlc` || !gf.advancedSearch) {
                    if (key === `genres`) {
                        if (giveaway.genres && gf.genreList) {
                            genres = gf.genreList.toLowerCase().split(/,\s/);
                            for (j = genres.length - 1; j >= 0 && giveaway.genres.indexOf(genres[j]) < 0; --j);
                            value = j >= 0;
                        } else {
                            value = false;
                        }
                    } else {
                        value = giveaway[key];
                    }
                    if ((gf[key] === `disabled` && value) || (gf[key] === `none` && !value)) {
                        filtered = true;
                        override = gf.overrides[key];
                        if (!counterKey) {
                            counterKey = key;
                        }
                    }
                }
            }
        }
        if (gf.exceptions && !override) {
            for (i = gf.exceptions.length - 1; i >= 0 && filtered; --i) {
                filtered = filterGfException(gf.exceptions[i], giveaway);
            }
        }
        if (filtered) {            
            gf.counters[counterKey].textContent = parseInt(gf.counters[counterKey].textContent) + 1;
        }
        return filtered;
    }

    function updateGfCount(gf, endless) {
        var filtered, giveaway, i, paginationFiltered, points;
        filtered = 0;
        points = 0;
        paginationFiltered = 0;
        key = gf.popup ? `popupGiveaways` : `currentGiveaways`;
        for (i = esgst[key].length - 1; i > -1; --i) {
            giveaway = esgst[key][i];
            if (document.body.contains(giveaway.outerWrap) || endless) {
                if (!giveaway.pinned || !esgst.hpg) {
                    if (giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                        if (!giveaway.pinned) {
                            paginationFiltered += 1;
                        }
                        filtered += 1;
                    } else if (!giveaway.entered) {
                        points += giveaway.points;
                    }
                }
            } else {
                esgst[key].splice(i, 1);
            }
        }
        gf.filteredCount.textContent = filtered;
        gf.pointsCount.textContent = points;
        if (!gf.popup && gf.paginationFilteredCount) {
            gf.paginationFilteredCount.textContent = paginationFiltered;
        }
    }

    /* [PGB] Pinned Giveaways Button */

    function loadPgb() {
        var PGBContainer, HTML, PGBIcon;
        esgst.pinnedGiveawaysButton = document.getElementsByClassName(`pinned-giveaways__button`)[0];
        if (esgst.pinnedGiveawaysButton) {
            PGBContainer = esgst.pinnedGiveawaysButton.previousElementSibling;
            PGBContainer.classList.add(`esgst-pgb-container`);
            esgst.pinnedGiveawaysButton.remove();
            HTML = `
                <div class="esgst-pgb-button">
                    <i class="esgst-pgb-icon fa fa-angle-down"></i>
                </div>
            `;
            PGBContainer.insertAdjacentHTML(`afterEnd`, HTML);
            esgst.pinnedGiveawaysButton = PGBContainer.nextElementSibling;
            PGBIcon = esgst.pinnedGiveawaysButton.firstElementChild;
            esgst.pinnedGiveawaysButton.addEventListener(`click`, togglePGBButton);
        }

        function togglePGBButton() {
            PGBContainer.classList.toggle(`pinned-giveaways__inner-wrap--minimized`);
            PGBIcon.classList.toggle(`fa-angle-down`);
            PGBIcon.classList.toggle(`fa-angle-up`);
        }
    }

    /* [UEG] Unfaded Entered Giveaways */

    function removeUegFade(context) {
        var elements, i, n;
        elements = context.getElementsByClassName(`giveaway__row-inner-wrap is-faded`);
        for (i = 0, n = elements.length; i < n; ++i) {
            elements[i].classList.add(`esgst-ueg`);
        }
    }

    /* [GB] Giveaway Bookmarks */

    function addGbButton() {
        var button, context, i, n, html;
        if (!esgst.gbPath) {
            context = document.getElementsByClassName(`nav__left-container`)[0];
            html = `
                <div class="nav__button-container esgst-hidden" title="View your bookmarked giveaways">
                    <div class="nav__button">
                        <i class="fa fa-bookmark"></i>
                    </div>
                </div>
            `;
            button = insertHtml(context, `beforeEnd`, html);
        }
        var bookmarked = [], endingSoon = 1, started = 0, ending = 0;
        createLock(`giveawayLock`, 300, function(deleteLock) {
            getValue(`giveaways`, `{}`).then(value => {
                var giveaways = JSON.parse(value);
                if (esgst.gb_h && button) {
                    button.classList.add(`esgst-gb-highlighted`);
                }
                for (var key in giveaways) {
                    if (giveaways[key].bookmarked) {
                        if (typeof giveaways[key].started === `undefined`) {
                            giveaways[key].started = true;
                        }
                        if (Date.now() >= giveaways[key].endTime || !giveaways[key].endTime) {
                            if (giveaways[key].started) {
                                if (esgst.gb_u) {
                                    delete giveaways[key].bookmarked;
                                } else {
                                    bookmarked.push(giveaways[key]);
                                }
                            } else {
                                bookmarked.push(giveaways[key]);
                                ++started;
                                if (esgst.gb_h && button) {
                                    button.classList.add(`started`);
                                }
                            }
                        } else {
                            if (giveaways[key].started) {
                                bookmarked.push(giveaways[key]);
                                endingSoon = giveaways[key].endTime - Date.now() - (esgst.gb_hours * 3600000);
                                if (endingSoon <= 0) {
                                    ++ending;
                                }
                            }
                        }
                    }
                }
                var title;
                if (started || ending) {
                    if (started) {
                        if (ending) {
                            title = `(${started} started - click to update them, ${ending} ending)`;
                        } else {
                            title = `(${started} started - click to update them)`;
                        }
                    } else {
                        title = `(${ending} ending)`;
                    }
                } else {
                    title = ``;
                }
                if (button) {
                    button.title = `${button.title} ${title}`;
                }
                if (bookmarked.length) {
                    bookmarked.sort(function(a, b) {
                        if (a.endTime > b.endTime) {
                            return 1;
                        } else if (a.endTime < b.endTime) {
                            return -1;
                        } else {
                            return 0;
                        }
                    });
                    for (i = 0, n = bookmarked.length; i < n; ++i) {
                        if (Date.now() > bookmarked[i].endTime) {
                            bookmarked.push(bookmarked.splice(i, 1)[0]);
                            i -= 1;
                            n -= 1;
                        }
                    }
                    if (button) {
                        button.classList.remove(`esgst-hidden`);
                        if (esgst.gb_h && ending > 0) {
                            button.classList.add(`ending`);
                        }
                    }
                }
                return setValue(`giveaways`, JSON.stringify(giveaways));
            }).then(() => {
                deleteLock();
                if (esgst.gbPath) {
                    loadGbGibs(bookmarked, esgst.mainContext, esgst.mainContext);
                }
            });
        });
        if (!esgst.gbPath) {
            button.addEventListener(`click`, function() {
                if (esgst.gb_t) {
                    open(`/esgst/bookmarked-giveaways`);
                } else {
                    let popup = new Popup(`fa-bookmark`, `Bookmarked Giveaways`, true);
                    loadGbGibs(bookmarked, popup.description, popup.scrollable, popup);
                }
            });
        }
    }

    function loadGbGibs(bookmarked, container, context, popup) {
        let info;
        var i = 0;
        var n = bookmarked.length;
        var gbGiveaways = insertHtml(context, `beforeEnd`, `<div class="esgst-text-left"></div>`);
        if ((esgst.gf && esgst.gf_m) || esgst.gm) {
            let heading = insertHtml(context, `afterBegin`, `
                <div class="page__heading"></div>
            `);
            if (esgst.gf && esgst.gf_m) {
                heading.appendChild(addGfContainer(heading, `Gb`));
            }
            if (esgst.gm) {
                loadGm(heading);
            }
        }
        var set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load more...`, `Loading more...`, function (callback) {
            loadGbGiveaways(i, i + 5, bookmarked, gbGiveaways, info, popup, function (value) {
                i = value;
                if (i > n) {
                    set.set.remove();
                } else if (esgst.es_gb && context.scrollHeight <= context.offsetHeight) {
                    set.trigger();
                }
                callback();
            });
        });
        container.appendChild(set.set);
        if (popup) {
            popup.open();
        }
        info = insertHtml(container, `beforeEnd`, `
            <div>
                <span>0</span>P required to enter all <span>0</span> giveaways.
            </div>
        `);
        set.trigger();
        if (esgst.es_gb) {
            context.addEventListener(`scroll`, function () {
                if ((context.scrollTop + context.offsetHeight) >= context.scrollHeight && !set.busy) {
                    set.trigger();
                }
            });
        }
    }

    function loadGbGiveaways(i, n, bookmarked, gbGiveaways, info, popup, callback) {
        if (i < n) {
            if (bookmarked[i]) {
                request(null, null, `GET`, true, `/giveaway/${bookmarked[i].code}/`, function (response) {
                    var endTime;
                    var responseHtml = parseHtml(response.responseText);
                    var container = responseHtml.getElementsByClassName(`featured__outer-wrap--giveaway`)[0];
                    if (container) {
                        var heading = responseHtml.getElementsByClassName(`featured__heading`)[0];
                        var columns = heading.nextElementSibling;
                        var remaining = columns.firstElementChild;
                        endTime = 0;
                        if (!bookmarked[i].started && !remaining.textContent.match(/Begins/)) {
                            endTime = parseInt(remaining.lastElementChild.getAttribute(`data-timestamp`)) * 1e3;
                        }
                        var url = response.finalUrl;
                        var gameId = container.getAttribute(`data-game-id`);
                        var anchors = heading.getElementsByTagName(`a`);
                        var j, numA, numT;
                        for (j = 0, numA = anchors.length; j < numA; ++j) {
                            anchors[j].classList.add(`giveaway__icon`);
                        }
                        var headingName = heading.firstElementChild;
                        headingName.outerHTML = `<a class="giveaway__heading__name" href="${url}">${headingName.innerHTML}</a>`;
                        var thinHeadings = heading.getElementsByClassName(`featured__heading__small`);
                        numT = thinHeadings.length
                        info.firstElementChild.textContent = parseInt(info.firstElementChild.textContent) + parseInt(thinHeadings[numT - 1].textContent.match(/\d+/)[0]);
                        info.lastElementChild.textContent = parseInt(info.lastElementChild.textContent) + 1;
                        for (j = 0; j < numT; ++j) {
                            thinHeadings[0].outerHTML = `<span class="giveaway__heading__thin">${thinHeadings[0].innerHTML}</span>`;
                        }
                        remaining.classList.remove(`featured__column`);
                        var created = remaining.nextElementSibling;
                        created.classList.remove(`featured__column`, `featured__column--width-fill`);
                        created.classList.add(`giveaway__column--width-fill`);
                        created.lastElementChild.classList.add(`giveaway__username`);
                        var avatar = columns.lastElementChild;
                        avatar.remove();
                        var element = created.nextElementSibling;
                        while (element) {
                            element.classList.remove(`featured__column`);
                            element.className = element.className.replace(/featured/g, `giveaway`);
                            element = element.nextElementSibling;
                        }
                        var counts = responseHtml.getElementsByClassName(`sidebar__navigation__item__count`);
                        var image = responseHtml.getElementsByClassName(`global__image-outer-wrap--game-large`)[0].firstElementChild.getAttribute(`src`);
                        let entered = responseHtml.getElementsByClassName(`sidebar__entry-delete`)[0];
                        if (entered) {
                            entered = !entered.classList.contains(`is-hidden`);
                        }
                        var popupHtml = `${Date.now() > bookmarked[i].endTime && !gbGiveaways.getElementsByClassName(`row-spacer`)[0] ? `<div class="row-spacer"></div>` : ``}
                            <div>
                                <div class="giveaway__row-outer-wrap" ${entered ? `data-entered="true"` : ``}data-game-id="${gameId}">
                                    <div class="giveaway__row-inner-wrap">
                                        <div class="giveaway__summary">
                                            <h2 class="giveaway__heading">${heading.innerHTML}</h2>
                                            <div class="giveaway__columns">${columns.innerHTML}</div>
                                            <div class="giveaway__links">
                                                <a href="${url}/entries">
                                                    <i class="fa fa-tag"></i>
                                                    <span>${(counts[1] && counts[1].textContent) || 0} entries</span>
                                                </a>
                                                <a href="${url}/comments">
                                                    <i class="fa fa-comment"></i>
                                                    <span>${counts[0].textContent} comments</span>
                                                </a>
                                            </div>
                                        </div>
                                        ${avatar.outerHTML}
                                        <a class="giveaway_image_thumbnail" href="${url}" style="background-image: url(${image})"></a>
                                    </div>
                                </div>
                            </div>
                        `;
                        gbGiveaways.insertAdjacentHTML(`beforeEnd`, popupHtml);
                        loadEndlessFeatures(gbGiveaways.lastElementChild, false, `gb`).then(() => {
                            if (endTime > 0) {
                                createLock(`giveawayLock`, 300, function (deleteLock) {
                                    getValue(`giveaways`).then(value => {
                                        var giveaways = JSON.parse(value);
                                        giveaways[bookmarked[i].code].started = true;
                                        giveaways[bookmarked[i].code].endTime = endTime;
                                        return setValue(`giveaways`, JSON.stringify(giveaways));
                                    }).then(() => {
                                        deleteLock();
                                        setTimeout(loadGbGiveaways, 0, ++i, n, bookmarked, gbGiveaways, info, popup, callback);
                                    });
                                });
                            } else {
                                setTimeout(loadGbGiveaways, 0, ++i, n, bookmarked, gbGiveaways, info, popup, callback);
                            }
                        });
                    } else {
                        setTimeout(loadGbGiveaways, 0, ++i, n, bookmarked, gbGiveaways, info, popup, callback);
                    }
                });
            } else {
                callback(i + 1);
            }
        } else {
            callback(i);
        }
    }

    function getGbGiveaways(giveaways, main) {
        if ((esgst.wonPath && !main) || (!esgst.wonPath)) {
            getValue(`giveaways`, `{}`).then(value => {
                var savedGiveaways = JSON.parse(value);
                for (var i = 0, n = giveaways.length; i < n; ++i) {
                    var giveaway = giveaways[i];
                    if (((esgst.archivePath && !main) || !esgst.archivePath) && giveaway.creator !== esgst.username && (!giveaway.entered || (esgst.enteredPath && main) || esgst.gb_se) && giveaway.url && !giveaway.innerWrap.getElementsByClassName(`esgst-gb-button`)[0]) {
                        if (savedGiveaways[giveaway.code] && savedGiveaways[giveaway.code].bookmarked) {
                            addGbUnbookmarkButton(giveaway, main);
                        } else if (!giveaway.ended) {
                            addGbBookmarkButton(giveaway, main);
                        }
                    }
                }
            });
        }
    }

    function addGbBookmarkButton(giveaway, main) {
        var button;
        button = insertHtml(giveaway.headingName, `beforeBegin`, `
            <div class="esgst-gb-button" title="Bookmark giveaway">
                <i class="fa fa-bookmark-o"></i>
            </div>
        `);
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            bookmarkGbGiveaway(giveaway, function() {
                button.remove();
                addGbUnbookmarkButton(giveaway, main);
            });
        });
    }

    function bookmarkGbGiveaway(giveaway, callback) {
        createLock(`giveawayLock`, 300, function(deleteLock) {
            var giveaways;
            getValue(`giveaways`, `{}`).then(value => {
                giveaways = JSON.parse(value);
                if (!giveaways[giveaway.code]) {
                    giveaways[giveaway.code] = {};
                }
                giveaways[giveaway.code].code = giveaway.code;
                giveaways[giveaway.code].endTime = giveaway.endTime;
                giveaways[giveaway.code].started = giveaway.started;
                giveaways[giveaway.code].bookmarked = true;
                return setValue(`giveaways`, JSON.stringify(giveaways));
            }).then(() => {
                deleteLock();
                if (callback) {
                    callback();
                }
            });
        });
    }

    function addGbUnbookmarkButton(giveaway, main) {
        var button;
        button = insertHtml(giveaway.headingName, `beforeBegin`, `
            <div class="esgst-gb-button" title="Unbookmark giveaway">
                <i class="fa fa-bookmark"></i>
            </div>
        `);
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            unbookmarkGbGiveaway(giveaway, function() {
                button.remove();
                addGbBookmarkButton(giveaway, main);
            });
        });
        if (esgst.gb_ue && main && esgst.enterGiveawayButton) {
            esgst.enterGiveawayButton.onclick = function() {
                let button = giveaway.outerWrap.getElementsByClassName(`esgst-gb-button`)[0];
                if (button && button.firstElementChild.classList.contains(`fa-bookmark`)) {
                    button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
                    unbookmarkGbGiveaway(giveaway, function() {
                        button.remove();
                        if (esgst.gb_se) {
                            addGbBookmarkButton(giveaway, main);
                        }
                    });
                }
            };
        }
    }

    function unbookmarkGbGiveaway(giveaway, callback) {
        createLock(`giveawayLock`, 300, function(deleteLock) {
            var giveaways;
            getValue(`giveaways`, `{}`).then(value => {
                giveaways = JSON.parse(value);
                if (giveaways[giveaway.code]) {
                    delete giveaways[giveaway.code].bookmarked;
                }
                return setValue(`giveaways`, JSON.stringify(giveaways));
            }).then(() => {
                deleteLock();
                if (callback) {
                    callback();
                }
            });
        });
    }

    /* [GED] Giveaway Encrypter/Decrypter */

    function loadGed() {
        var builtGiveaways, giveaway, button, code, currentDate, filtered, game, giveaways, i, keys, n, newGiveaways, numNew, popup, progress, results, savedGiveaways, set, timestamp;
        if (esgst.discussionPath && document.getElementsByClassName(`comment__username`)[0].textContent === esgst.username) {
            var codes = [];
            var elements = document.getElementsByClassName(`comment__description`)[0].querySelectorAll(`[href^="ESGST-"]`);
            for (var i = 0, n = elements.length; i < n; ++i) {
                var element = elements[i];
                var encryptedCode = element.getAttribute(`href`).match(/ESGST-(.+)/)[1];
                if (!encryptedCode.match(/currentVersion/)) {
                    codes.push(decryptGedCode(encryptedCode));
                }
            }
            saveGedGiveaways(codes, location.href);
        }
        newGiveaways = {};
        if (!esgst.gedPath) {
            button = insertHtml(esgst.headerNavigationLeft, `beforeEnd`, `
                <div class="nav__button-container esgst-hidden" title="View your decrypted giveaways">
                    <div class="nav__button">
                        <i class="fa fa-star"></i>
                    </div>
                </div>
            `);
        }
        createLock(`gedLock`, 300, function (deleteLock) {
            getValue(`exclusiveGiveaways`, {}).then(value => {
                return getValue(`decryptedGiveaways`, value);
            }).then(value => {
                savedGiveaways = value;
                if (typeof savedGiveaways === `string`) {
                    savedGiveaways = JSON.parse(savedGiveaways);
                }
                currentDate = Date.now();
                giveaways = [];
                for (code in savedGiveaways) {
                    if (savedGiveaways[code].html) {
                        delete savedGiveaways[code].html;
                    }
                    timestamp = savedGiveaways[code].timestamp;
                    giveaway = esgst.giveaways[code];
                    if (timestamp > currentDate) {
                        filtered = false;
                        if (giveaway) {
                            game = null;
                            if (giveaway.gameType && giveaway.gameSteamId) {
                                game = esgst.games[giveaway.gameType][giveaway.gameSteamId];
                            }
                            if (((giveaway.level < esgst.gf_minLevelPopup) || (giveaway.level > esgst.gf_maxLevelPopup)) || ((giveaway.copies < esgst.gf_minCopiesPopup) || (giveaway.copies > esgst.gf_maxCopiesPopup)) || ((giveaway.points < esgst.gf_minPointsPopup) || (giveaway.points > esgst.gf_maxPointsPopup)) || ((esgst.gf_createdPopup === `disabled` && giveaway.creator === esgst.username) || (esgst.gf_createdPopup === `none` && giveaway.creator !== esgst.username)) || (game && (((esgst.gf_hiddenPopup === `disabled` && game.hidden) || (esgst.gf_hiddenPopup === `none` && !game.hidden)) || ((esgst.gf_ownedPopup === `disabled` && game.owned) || (esgst.gf_ownedPopup === `none` && !game.owned)) || ((esgst.gf_ignoredPopup === `disabled` && game.ignored) || (esgst.gf_ignoredPopup === `none` && !game.ignored))))) {
                                filtered = true;
                            }
                        }
                        if (!filtered) {
                            giveaways.push({
                                code: code,
                                source: savedGiveaways[code].source,
                                timestamp: timestamp
                            });
                        }
                    }
                }
                return setValue(`decryptedGiveaways`, JSON.stringify(savedGiveaways));
            }).then(() => {
                deleteLock();
                n = giveaways.length;
                if (n > 0) {
                    if (button) {
                        button.classList.remove(`esgst-hidden`);
                    }
                    giveaways.sort(function (a, b) {
                        if (a.timestamp < b.timestamp) {
                            return -1;
                        } else if (a.timestamp > b.timestamp) {
                            return 1;
                        } else {
                            return 0;
                        }
                    });
                }
                if (esgst.gedPath) {
                    newGiveaways = JSON.parse(getLocalValue(`gedCache`, `{}`));
                    delLocalValue(`gedCache`);
                    loadGedGiveaways(esgst.mainContext, esgst.mainContext);
                } else {
                    button.addEventListener(`click`, function () {
                        if (esgst.ged_t) {
                            setLocalValue(`gedCache`, JSON.stringify(newGiveaways));
                            open(`/esgst/decrypted-giveaways`);
                        } else {
                            let popup = new Popup(`fa-star`, `Decrypted Giveaways`, true);
                            loadGedGiveaways(popup.description, popup.scrollable, popup);
                        }
                    });
                }
                esgst.checkGedGiveaways = checkGedGiveaways.bind(null, button, newGiveaways);
                esgst.endlessFeatures.push(esgst.checkGedGiveaways);
                checkGedGiveaways(button, newGiveaways, document);
            });
        });

        function loadGedGiveaways(container, context, popup) {
            results = insertHtml(context, `beforeEnd`, `<div class="esgst-text-left"></div>`);
            if ((esgst.gf && esgst.gf_m) || esgst.gm) {
                let heading = insertHtml(context, `afterBegin`, `
                    <div class="page__heading"></div>
                `);
                if (esgst.gf && esgst.gf_m) {
                    heading.appendChild(addGfContainer(heading, `Ged`));
                }
                if (esgst.gm) {
                    loadGm(heading);
                }
            }
            i = 0;
            set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load More`, `Loading more...`, function (callback) {
                getGedGiveaways({}, giveaways, i, null, i + 5, function (value) {
                    i = value;
                    if (i > n) {
                        set.set.remove();
                    } else if ((esgst.es_ged && context.scrollHeight <= context.offsetHeight) || ((results.children.length - ((esgst.gfPopup && parseInt(esgst.gfPopup.filteredCount.textContent)) || 0)) % 5 !== 0)) {
                        set.trigger();
                    }
                    callback();
                });
            });
            keys = Object.keys(newGiveaways);
            numNew = keys.length;
            if (numNew > 0) {
                progress = insertHtml(container, `beforeEnd`, `
                    <div>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        <span>Decrypting new giveaways...</span>
                    </div>
                `);
                getGedGiveaways({}, newGiveaways, 0, keys, numNew, function () {
                    progress.remove();
                    container.appendChild(set.set);
                    set.trigger();
                });
            } else {
                container.appendChild(set.set);
                set.trigger();
            }
            if (popup) {
                popup.open();
            }
            if (esgst.es_ged) {
                context.addEventListener(`scroll`, function () {
                    if ((context.scrollTop + context.offsetHeight) >= context.scrollHeight && !set.busy) {
                        set.trigger();
                    }
                });
            }
        }

        function getGedGiveaways(currentGiveaways, giveaways, i, keys, n, callback) {
            var builtGiveaway, data, giveaway, key, responseHtml;
            if (i < n) {
                if (keys) {
                    key = keys[i];
                    if (key) {
                        giveaway = giveaways[key];
                    }
                } else {
                    giveaway = giveaways[i];
                }
                if (giveaway) {
                    request(null, null, `GET`, false, `/giveaway/${giveaway.code}/`, function (response) {
                        responseHtml = parseHtml(response.responseText);
                        builtGiveaway = buildGiveaway(responseHtml, response.finalUrl);
                        if (builtGiveaway) {
                            results.insertAdjacentHTML(`beforeEnd`, builtGiveaway.html);
                            var giveawayy = getGiveawayInfo(results.lastElementChild.lastElementChild, document, esgst.games, null, null, null, false, null, true);
                            currentGiveaways[giveawayy.data.code] = giveawayy.data;
                            loadEndlessFeatures(results.lastElementChild, false, `ged`).then(() => {
                                if (giveaway.source) {
                                    results.lastElementChild.getElementsByClassName(`giveaway__columns`)[0].insertAdjacentHTML(`afterBegin`, `
                                        <a class="esgst-ged-source" href="${giveaway.source.match(/\/discussion\//) ? giveaway.source : `/go/comment/${giveaway.source}`}">Source</a>
                                    `);
                                }
                                if (keys) {
                                    results.lastElementChild.getElementsByClassName(`giveaway__heading__name`)[0].insertAdjacentText(`afterBegin`, `[NEW] `);
                                    createLock(`gedLock`, 300, function (deleteLock) {
                                        getValue(`exclusiveGiveaways`, {}).then(value => {
                                            return getValue(`decryptedGiveaways`, value);
                                        }).then(value => {
                                            savedGiveaways = value;
                                            if (typeof savedGiveaways === `string`) {
                                                savedGiveaways = JSON.parse(savedGiveaways);
                                            }
                                            savedGiveaways[builtGiveaway.code] = {
                                                source: giveaway.source,
                                                timestamp: builtGiveaway.timestamp
                                            };
                                            return setValue(`decryptedGiveaways`, JSON.stringify(savedGiveaways));
                                        }).then(() => {
                                            deleteLock();
                                            setTimeout(getGedGiveaways, 0, currentGiveaways, giveaways, ++i, keys, n, callback);
                                        });
                                    });
                                } else {
                                    setTimeout(getGedGiveaways, 0, currentGiveaways, giveaways, ++i, keys, n, callback);
                                }
                            });
                        } else {
                            createLock(`gedLock`, 300, function (deleteLock) {
                                getValue(`exclusiveGiveaways`, {}).then(value => {
                                    return getValue(`decryptedGiveaways`, value);
                                }).then(value => {
                                    savedGiveaways = value;
                                    if (typeof savedGiveaways === `string`) {
                                        savedGiveaways = JSON.parse(savedGiveaways);
                                    }
                                    savedGiveaways[giveaway.code] = {
                                        timestamp: 0
                                    };
                                    return setValue(`decryptedGiveaways`, JSON.stringify(savedGiveaways));
                                }).then(() => {
                                    deleteLock();
                                    setTimeout(getGedGiveaways, 0, currentGiveaways, giveaways, ++i, keys, n, callback);
                                });
                            });
                        }
                    });
                } else {
                    lockAndSaveGiveaways(currentGiveaways, callback.bind(null, i + 1));
                }
            } else {
                lockAndSaveGiveaways(currentGiveaways, callback.bind(null, i));
            }
        }
    }

    function checkGedGiveaways(button, newGiveaways, context) {
        var code, comment, element, elements, elementss, encryptedCode, i, n, n2, newGiveaway, savedGiveaways, source;
        elements = context.querySelectorAll(`[href^="ESGST-"]`);
        n = elements.length;
        getValue(`exclusiveGiveaways`, {}).then(value => {
            return getValue(`decryptedGiveaways`, value);
        }).then(value => {
            savedGiveaways = value;
            if (typeof savedGiveaways === `string`) {
                savedGiveaways = JSON.parse(savedGiveaways);
            }
            if (n > 0) {
                newGiveaway = false;
                elementss = context.getElementsByClassName(`esgst-ged-icon`);
                for (i = 0, n2 = elementss.length; i < n2; ++i) {
                    elementss[0].remove();
                }
                for (i = 0; i < n; ++i) {
                    element = elements[i];
                    encryptedCode = element.getAttribute(`href`).match(/ESGST-(.+)/)[1];
                    if (!encryptedCode.match(/currentVersion/)) {
                        code = decryptGedCode(encryptedCode);
                        comment = element.closest(`.comment__summary`);
                        if (comment) {
                            comment.getElementsByClassName(`comment__actions`)[0].insertAdjacentHTML(`beforeEnd`, `
                                <a class="esgst-ged-icon" href="/giveaway/${code}/" title="ESGST Decrypted Giveaway">
                                    <i class="fa fa-star"></i>
                                </a>
                            `);
                            if (comment.querySelector(`.comment__username, .author_name`).textContent !== esgst.username) {
                                source = comment.id || location.href;
                                if (savedGiveaways[code]) {
                                    if (!savedGiveaways[code].source) {
                                        savedGiveaways[code].source = source;
                                    }
                                } else if (!newGiveaways[code]) {
                                    newGiveaway = true;
                                    newGiveaways[code] = {
                                        code: code,
                                        source: source
                                    };
                                }
                            }
                        }
                    }
                }
                if (newGiveaway && button) {
                    button.classList.remove(`esgst-hidden`);
                    button.firstElementChild.firstElementChild.classList.add(`esgst-positive`);
                }
            } else {
                elements = context.getElementsByClassName(`esgst-ged-icon`);
                for (i = 0, n = elements.length; i < n; ++i) {
                    elements[0].remove();
                }
            }
        });
    }

    function hideGame(button, id, name) {
        var elements, i, popup;
        popup = new Popup(`fa-eye-slash`, `Would you like to hide all giveaways for <span class="esgst-bold">${name}</span>?`, true);
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-check-circle`, `fa-refresh fa-spin`, `Yes`, `Please wait...`, callback => {
            request(`xsrf_token=${esgst.xsrfToken}&do=hide_giveaways_by_game_id&game_id=${id}`, null, `POST`, false, `/ajax.php`, () => {
                elements = document.querySelectorAll(`.giveaway__row-outer-wrap[data-game-id="${id}"]`);
                for (i = elements.length - 1; i > -1; --i) {
                    elements[i].remove();
                }
                button.remove();
                callback();
                popup.close();
            });
        }).set);
        popup.actions.firstElementChild.outerHTML = `
            <a href="/account/settings/giveaways/filters">View Hidden Games</a>
        `;
        popup.open();
    }

    function unhideGame(button, id, name) {
        var elements, i, popup;
        popup = new Popup(`fa-eye-slash`, `Would you like to unhide all giveaways for <span class="esgst-bold">${name}</span>?`, true);
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-check-circle`, `fa-refresh fa-spin`, `Yes`, `Please wait...`, callback => {
            request(`xsrf_token=${esgst.xsrfToken}&do=remove_filter&game_id=${id}`, null, `POST`, false, `/ajax.php`, () => {
                button.remove();
                callback();
                popup.close();
            });
        }).set);
        popup.actions.firstElementChild.outerHTML = `
            <a href="/account/settings/giveaways/filters">View Hidden Games</a>
        `;
        popup.open();
    }

    function buildGiveaway(context, url) {
        var avatar, code, column, columns, comments, counts, endTime, endTimeColumn, entered, entries, giveaway, heading, headingName, i, id, icons, image, n, removeEntryButton, started, startTimeColumn, thinHeadings;
        giveaway = context.getElementsByClassName(`featured__outer-wrap--giveaway`)[0];
        if (giveaway) {
            code = url.match(/giveaway\/(.+?)\//)[1];
            id = giveaway.getAttribute(`data-game-id`);
            heading = giveaway.getElementsByClassName(`featured__heading`)[0];
            icons = heading.getElementsByTagName(`a`);
            for (i = 0, n = icons.length; i < n; ++i) {
                icons[i].classList.add(`giveaway__icon`);
            }
            headingName = heading.firstElementChild;
            headingName.outerHTML = `<a class="giveaway__heading__name" href="${url}">${headingName.innerHTML}</a>`;
            thinHeadings = heading.getElementsByClassName(`featured__heading__small`);
            for (i = 0, n = thinHeadings.length; i < n; ++i) {
                thinHeadings[0].outerHTML = `<span class="giveaway__heading__thin">${thinHeadings[0].innerHTML}</span>`;
            }
            columns = heading.nextElementSibling;
            endTimeColumn = columns.firstElementChild;
            endTimeColumn.classList.remove(`featured__column`);
            endTime = parseInt(endTimeColumn.lastElementChild.getAttribute(`data-timestamp`)) * 1000;
            startTimeColumn = endTimeColumn.nextElementSibling;
            startTimeColumn.classList.remove(`featured__column`, `featured__column--width-fill`);
            startTimeColumn.classList.add(`giveaway__column--width-fill`);
            avatar = columns.lastElementChild;
            avatar.remove();
            startTimeColumn.querySelector(`[style]`).removeAttribute(`style`);
            column = startTimeColumn.nextElementSibling;
            while (column) {
                column.classList.remove(`featured__column`);
                column.className = column.className.replace(/featured/g, `giveaway`);
                column = column.nextElementSibling;
            }
            removeEntryButton = context.getElementsByClassName(`sidebar__entry-delete`)[0];
            if (removeEntryButton && !removeEntryButton.classList.contains(`is-hidden`)) {
                entered = `is-faded`;
            } else {
                entered = ``;
            }
            counts = context.getElementsByClassName(`sidebar__navigation__item__count`);
            if (counts.length > 1) {
                entries = counts[1].textContent;
                comments = counts[0].textContent;
                started = true;
            } else {
                entries = 0;
                comments = counts[0].textContent;
                started = false;
            }
            image = giveaway.getElementsByClassName(`global__image-outer-wrap--game-large`)[0].firstElementChild.getAttribute(`src`);
            return {
                code: code,
                html: `
                    <div>
                        <div class="giveaway__row-outer-wrap" data-game-id="${id}">
                            <div class="giveaway__row-inner-wrap ${entered}">
                                <div class="giveaway__summary">
                                    <h2 class="giveaway__heading">${heading.innerHTML}</h2>
                                    <div class="giveaway__columns">${columns.innerHTML}</div>
                                    <div class="giveaway__links">
                                        <a href="${url}/entries">
                                            <i class="fa fa-tag"></i>
                                            <span>${entries} entries</span>
                                        </a>
                                        <a href="${url}/comment">
                                            <i class="fa fa-comment"></i>
                                            <span>${comments} comments</span>
                                        </a>
                                    </div>
                                </div>
                                ${avatar.outerHTML}
                                <a class="giveaway_image_thumbnail" href="${url}" style="background-image: url(${image})"></a>
                            </div>
                        </div>
                    </div>
                `,
                started: started,
                timestamp: endTime
            };
        } else {
            return null;
        }
    }

    function encryptGedCode(code) {
        let alphabet, encrypted, i, n, rotated, rotation;
        alphabet = `NOPQRSTUVWXYZABCDEFGHIJKLM`;
        switch (Math.floor(Math.random() * 4)) {
            case 0:
                rotated = rot(code, 13);
                encrypted = ``;
                for (i = 0, n = rotated.length; i < n; ++i) {
                    encrypted += rotated.charCodeAt(i).toString(16);
                }
                return encrypted;
            case 1:
                rotated = rot(code, 13);
                encrypted = ``;
                for (i = 0, n = rotated.length; i < n; ++i) {
                    encrypted += rotated.charCodeAt(i).toString(16);
                }
                encrypted = encrypted.replace(/\d/g, n => {
                    return alphabet[parseInt(n)];
                });
                return encrypted;
            case 2:
                rotation = Math.ceil(Math.random() * 25);
                rotated = rot(code, rotation);
                encrypted = ``;
                for (i = 0, n = rotated.length; i < n; ++i) {
                    encrypted += rotated.charCodeAt(i).toString(16);
                }
                encrypted += rotation.toString(16);
                return encrypted;
            case 3:
                rotation = Math.ceil(Math.random() * 25);
                rotated = rot(code, rotation);
                encrypted = ``;
                for (i = 0, n = rotated.length; i < n; ++i) {
                    encrypted += rotated.charCodeAt(i).toString(16);
                }
                encrypted += rotation.toString(16);
                encrypted = encrypted.replace(/\d/g, n => {
                    return alphabet[parseInt(n)];
                });
                return encrypted;
        }
    }

    function decryptGedCode(encrypted) {
        let alphabet, code, rotation;
        alphabet = `NOPQRSTUVWXYZABCDEFGHIJKLM`;
        encrypted = encrypted.replace(/-/g, ``).replace(/[A-Z]/g, n => {
            return alphabet.indexOf(n);
        });
        rotation = encrypted.slice(10);
        if (rotation) {
            rotation = parseInt(rotation, 16);
        } else {
            rotation = 13;
        }
        code = ``;
        encrypted.slice(0, 10).match(/../g).forEach(n => {
            code += String.fromCharCode(parseInt(n, 16));
        });
        return rot(code, 26 - rotation);
    }

    function rot(string, n) {
        return string.replace(/[a-zA-Z]/g, function (char) {
            return String.fromCharCode(((char <= `Z`) ? 90 : 122) >= ((char = char.charCodeAt(0) + n)) ? char : (char - 26));
        });
    }

    function saveGedGiveaways(codes, source, callback) {
        let code, ged, giveaway, giveaways;
        if (codes.length > 0) {
            ged = new CompletionCheck(codes.length, () => {
                getValue(`exclusiveGiveaways`, {}).then(value => {
                    return getValue(`decryptedGiveaways`, value);
                }).then(value => {
                    giveaways = value;
                    if (typeof giveaways === `string`) {
                        giveaways = JSON.parse(giveaways);
                    }
                    for (code in ged.decryptedGiveaways) {
                        giveaways[code] = ged.decryptedGiveaways[code];
                    }
                    return setValue(`decryptedGiveaways`, JSON.stringify(giveaways));
                }).then(lockAndSaveGiveaways.bind(null, ged.giveaways, callback));
            });
            ged.decryptedGiveaways = {};
            ged.giveaways = {};
            getValue(`exclusiveGiveaways`, {}).then(value => {
                return getValue(`decryptedGiveaways`, value);
            }).then(value => {
                giveaways = value;
                if (typeof giveaways === `string`) {
                    giveaways = JSON.parse(giveaways);
                }
                codes.forEach(code => {
                    if (giveaways[code]) {
                        ged.count += 1;
                    } else {
                        giveaway = esgst.giveaways[code];
                        if (giveaway && giveaway.endTime) {
                            ged.decryptedGiveaways[code] = {
                                source: source,
                                timestamp: giveaway.endTime
                            };
                            ged.count += 1;
                        } else {
                            request(null, null, `GET`, false, `/giveaway/${code}/`, function (response) {
                                getGiveaways(parseHtml(response.responseText), false, response.finalUrl, false, null, true).then(giveaways => {
                                    giveaway = giveaways[0];
                                    ged.giveaways[code] = giveaway;
                                    ged.decryptedGiveaways[code] = {
                                        source: source,
                                        timestamp: giveaway.endTime
                                    };
                                    ged.count += 1;
                                });
                            });
                        }
                    }
                });
            });
        } else if (callback) {
            callback();
        }
    }

    /* [UGB] Unhide Giveaway Button */

    function addUgbButtons(giveaways, main) {
        giveaways.forEach(giveaway => {
            let hideButton = giveaway.innerWrap.querySelector(`.giveaway__hide, .featured__giveaway__hide`);
            if (!hideButton && (!main || esgst.giveawaysPath || esgst.giveawayPath)) {
                if (esgst.giveawayPath && main) {
                    hideButton = insertHtml(giveaway.headingName.parentElement, `beforeEnd`, `
                        <a>
                            <i class="fa fa-eye giveaway__hide"></i>
                        </a>
                    `);
                } else {
                    hideButton = insertHtml(giveaway.headingName.parentElement, `beforeEnd`, `
                        <i class="fa fa-eye giveaway__hide giveaway__icon"></i>
                    `);
                }
                hideButton.addEventListener(`click`, unhideGame.bind(null, hideButton, giveaway.gameId, giveaway.name));
            }
        });
    }

    /* [OCHGB] One-Click Hide Giveaway Button */

    function setOchgbButtons(giveaways, main) {
        var button, giveaway, i, n, unhide;
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            button = giveaway.innerWrap.querySelector(`.giveaway__hide, .featured__giveaway__hide`);
            if (button) {
                if (button.classList.contains(`fa-eye`)) {
                    unhide = true;
                } else {
                    unhide = false;
                }
                if (esgst.giveawayPath && main) {
                    button = button.parentElement;
                }
                giveaway.ochgbButton = insertHtml(button, `afterEnd`, `<a></a>`);
                button.remove();
                giveaway.fade = fadeOchgbGiveaway.bind(null, giveaway, main);
                giveaway.unfade = unfadeOchgbGiveaway.bind(null, giveaway, main);
                if (unhide) {
                    addOchgbUnhideButton(giveaway, main);
                } else {
                    addOchgbHideButton(giveaway, main);
                }
            }
        }
    }

    function addOchgbHideButton(giveaway, main) {
        var button, i, matches, n, newButton;
        giveaway.ochgbButton.innerHTML = `
            <i class="esgst-ochgb ${esgst.giveawayPath && main ? `` : `giveaway__icon`} fa fa-eye-slash" title="Hide game"></i>
        `;
        giveaway.ochgbButton.firstElementChild.addEventListener(`click`, hideOchgbGiveaway.bind(null, giveaway, main));
    }

    function addOchgbUnhideButton(giveaway, main) {
        var button, i, matches, n, newButton;
        giveaway.ochgbButton.innerHTML = `
            <i class="esgst-ochgb ${esgst.giveawayPath && main ? `` : `giveaway__icon`} fa fa-eye" title="Unhide game"></i>
        `;
        giveaway.ochgbButton.firstElementChild.addEventListener(`click`, unhideOchgbGiveaway.bind(null, giveaway, main));
    }

    function fadeOchgbGiveaway(giveaway, main) {
        if ((esgst.giveawayPath && !main) || !esgst.giveawayPath) {
            giveaway.innerWrap.classList.add(`esgst-faded`);
        }
        addOchgbUnhideButton(giveaway, main);
    }

    function unfadeOchgbGiveaway(giveaway, main) {
        if ((esgst.giveawayPath && !main) || !esgst.giveawayPath) {
            giveaway.innerWrap.classList.remove(`esgst-faded`);
        }
        addOchgbHideButton(giveaway, main);
    }

    function hideOchgbGiveaway(giveaway, main, event) {
        event.currentTarget.className = `giveaway__icon fa fa-circle-o-notch fa-spin`;
        request(`xsrf_token=${esgst.xsrfToken}&do=hide_giveaways_by_game_id&game_id=${giveaway.gameId}`, null, `POST`, false, `/ajax.php`, completeOchgbProcess.bind(null, event.currentTarget, giveaway, `fade`, main));
    }

    function unhideOchgbGiveaway(giveaway, main, event) {
        event.currentTarget.className = `giveaway__icon fa fa-circle-o-notch fa-spin`;
        request(`xsrf_token=${esgst.xsrfToken}&do=remove_filter&game_id=${giveaway.gameId}`, null, `POST`, false, `/ajax.php`, completeOchgbProcess.bind(null, event.currentTarget, giveaway, `unfade`, main));
    }

    function completeOchgbProcess(button, giveaway, key, main) {
        var i, n, source;
        if ((esgst.giveawayPath && !main) || !esgst.giveawayPath) {
            source = main ? `currentGiveaways` : `popupGiveaways`;
            if (esgst.ochgb_f) {
                for (i = 0, n = esgst[source].length; i < n; ++i) {
                    if (esgst[source][i].gameId === giveaway.gameId) {
                        esgst[source][i][key]();
                    }
                }
            } else {
                for (i = 0, n = esgst[source].length; i < n; ++i) {
                    if (esgst[source][i].gameId === giveaway.gameId) {
                        esgst[source][i].outerWrap.remove();
                    }
                }
            }
        } else {
            button.remove();
        }
    }

    /* [TTEC] Time To Enter Calculator */

    function calculateTtecTime(giveaways, main, source) {
        let nextRefresh, time;
        if (!main || (!esgst.createdPath && !esgst.enteredPath && !esgst.wonPath && !esgst.newGiveawayPath)) {
            nextRefresh = 60 - new Date().getMinutes();
            while (nextRefresh > 15) {
                nextRefresh -= 15;
            }
            giveaways.forEach(giveaway => {
                if (!giveaway.ended && !giveaway.entered && giveaway.points > esgst.points) {
                    if (!giveaway.ttec) {
                        giveaway.ttec = insertHtml(giveaway.panel, (esgst.gv && ((main && esgst.giveawaysPath) || (source === `gb` && esgst.gv_gb) || (source === `ged` && esgst.gv_ged) || (source === `ge` && esgst.gv_ge))) ? `beforeEnd` : `afterBegin`, `<div class="${esgst.giveawayPath ? `featured__column` : ``} esgst-ttec" title="Time to wait until you have enough points to enter this giveaway"></div>`);
                    }
                    giveaway.ttec.classList.remove(`esgst-hidden`);
                    giveaway.ttec.innerHTML = `
                        <i class="fa fa-clock-o"></i> ${getTtecTime(Math.round((nextRefresh + (15 * Math.floor((giveaway.points - esgst.points) / 6))) * 100) / 100)}
                    `;
                } else if (giveaway.ttec) {
                    giveaway.ttec.classList.add(`esgst-hidden`);
                }
            });
        }
    }

    function getTtecTime(m) {
        let d, h, w;
        h = Math.round(m / 60 * 10) / 10;
        if (Math.floor(h) > 0) {
            d = Math.round(m / 60 / 24 * 10) / 10;
            if (Math.floor(d) > 0) {
                w = Math.round(d / 60 / 24 / 7 * 10) / 10;
                if (Math.floor(w) > 0) {
                    return `${w}w`;
                } else {
                    return `${d}d`;
                }
            } else {
                return `${h}h`;
            }
        } else {
            return `${m}m`;
        }
    }

    /* [GWC] Giveaway Winning Chance */

    function addGwcChances(giveaways, main, source) {
        var giveaway, i, n;
        if (((esgst.createdPath || esgst.wonPath || esgst.newGiveawayPath) && !main) || (!esgst.createdPath && !esgst.wonPath && !esgst.newGiveawayPath)) {
            for (i = 0, n = giveaways.length; i < n; ++i) {
                giveaway = giveaways[i];
                if (((giveaway.inviteOnly && ((main && esgst.giveawayPath) || !main || giveaway.ended)) || !giveaway.inviteOnly) && !giveaway.innerWrap.getElementsByClassName(`esgst-gwc`)[0]) {
                    if (giveaway.started) {
                        addGwcChance(insertHtml(giveaway.panel, (esgst.gv && ((main && esgst.giveawaysPath) || (source === `gb` && esgst.gv_gb) || (source === `ged` && esgst.gv_ged) || (source === `ge` && esgst.gv_ge))) ? `afterBegin` : `beforeEnd`, `<div class="${esgst.giveawayPath ? `featured__column` : ``} esgst-gwc" title="Giveaway Winning Chance">`), giveaway);
                    } else {
                        giveaway.chance = 100;
                        giveaway.chancePerPoint = Math.round(100 / giveaway.points * 100) / 100;
                    }
                }
            }
        }
    }

    function addGwcChance(context, giveaway) {
        let advancedChance, advancedColor, basicChance, basicColor, colors, entries, i;
        entries = giveaway.entered || giveaway.ended || giveaway.created || !esgst.gwc_e ? giveaway.entries : giveaway.entries + 1;
        basicChance = entries > 0 ? Math.round(giveaway.copies / entries * 10000) / 100 : 100;
        basicChance = basicChance > 100 ? 100 : (basicChance <= 0 ? 0.01 : basicChance);
        if (esgst.gwc_a && !giveaway.ended && giveaway.startTime) {
            advancedChance = entries > 0 ? Math.round(giveaway.copies / (entries / (Date.now() - giveaway.startTime) * (giveaway.endTime - giveaway.startTime)) * 10000) / 100 : 100;
            advancedChance = advancedChance > 100 ? 100 : (advancedChance <= 0 ? 0.01 : advancedChance);
        }
        giveaway.chance = esgst.gwc_a && !esgst.gwc_a_b ? advancedChance : basicChance;
        giveaway.chancePerPoint = Math.round(giveaway.chance / giveaway.points * 100) / 100;
        context.title = `Giveaway Winning Chance (${giveaway.chancePerPoint}% per point)`;
        context.setAttribute(`data-chance`, giveaway.chance);
        for (i = esgst.gwc_colors.length - 1; i > -1; --i) {
            colors = esgst.gwc_colors[i];
            if (basicChance >= parseFloat(colors.lower) && basicChance <= parseFloat(colors.upper)) {
                basicColor = colors.color;
                break;
            }
        }
        for (i = esgst.gwc_colors.length - 1; i > -1; --i) {
            colors = esgst.gwc_colors[i];
            if (advancedChance >= parseFloat(colors.lower) && advancedChance <= parseFloat(colors.upper)) {
                advancedColor = colors.color;
                break;
            }
        }
        if (esgst.enteredPath) {
            context.style.display = `inline-block`;
        }
        context.innerHTML = `
            ${esgst.enteredPath ? `` : `<i class="fa fa-area-chart"></i>`}
            <span>${esgst.gwc_a && advancedChance ? (esgst.gwc_a_b ? `<span${basicColor ? ` style="color: ${basicColor}; font-weight: bold;"` : ``}>${basicChance}%</span> (<span${advancedColor ? ` style="color: ${advancedColor}; font-weight: bold;"` : ``}>${advancedChance}%</span>)` : `<span${advancedColor ? ` style="color: ${advancedColor}; font-weight: bold;"` : ``}>${advancedChance}%</span>`) : `<span${basicColor ? ` style="color: ${basicColor}; font-weight: bold;"` : ``}>${basicChance}%</span>`}${esgst.enteredPath && esgst.gwr ? ` / ` : ``}</span>
        `;
    }

    /* [GWR] Giveaway Winning Ratio */

    function addGwrRatios(giveaways, main, source) {
        var giveaway, i, n;
        if (((esgst.createdPath || esgst.wonPath || esgst.newGiveawayPath) && !main) || (!esgst.createdPath && !esgst.wonPath && !esgst.newGiveawayPath)) {
            for (i = 0, n = giveaways.length; i < n; ++i) {
                giveaway = giveaways[i];
                if (giveaway.started && ((giveaway.inviteOnly && ((main && esgst.giveawayPath) || !main || giveaway.ended)) || !giveaway.inviteOnly) && !giveaway.innerWrap.getElementsByClassName(`esgst-gwr`)[0]) {
                    addGwcRatio(insertHtml(giveaway.panel, (esgst.gv && ((main && esgst.giveawaysPath) || (source === `gb` && esgst.gv_gb) || (source === `ged` && esgst.gv_ged) || (source === `ge` && esgst.gv_ge))) ? `afterBegin` : `beforeEnd`, `<div class="${esgst.giveawayPath ? `featured__column` : ``} esgst-gwr" title="Giveaway Winning Ratio">`), giveaway);
                }
            }
        }
    }

    function addGwcRatio(context, giveaway) {
        let advancedColor, advancedRatio, basicColor, basicRatio, colors, entries, i;
        entries = giveaway.entered || giveaway.ended || giveaway.created || !esgst.gwr_e ? giveaway.entries : giveaway.entries + 1;
        basicRatio = Math.ceil(entries / giveaway.copies);
        if (esgst.gwr_a && !giveaway.ended && giveaway.startTime) {
            advancedRatio = Math.ceil((entries / (Date.now() - giveaway.startTime) * (giveaway.endTime - giveaway.startTime)) / giveaway.copies);
        }
        giveaway.ratio = esgst.gwr_a && !esgst.gwr_a_b ? advancedRatio : basicRatio;
        context.setAttribute(`data-ratio`, giveaway.ratio);
        for (i = esgst.gwr_colors.length - 1; i > -1; --i) {
            colors = esgst.gwr_colors[i];
            if (basicRatio >= parseInt(colors.lower) && basicRatio <= parseInt(colors.upper)) {
                basicColor = colors.color;
                break;
            }
        }
        for (i = esgst.gwr_colors.length - 1; i > -1; --i) {
            colors = esgst.gwr_colors[i];
            if (advancedRatio >= parseInt(colors.lower) && advancedRatio <= parseInt(colors.upper)) {
                advancedColor = colors.color;
                break;
            }
        }
        if (esgst.enteredPath) {
            context.style.display = `inline-block`;
        }
        context.innerHTML = `
            ${esgst.enteredPath ? `` : `<i class="fa fa-pie-chart"></i>`}
            <span>${esgst.gwr_a && advancedRatio ? (esgst.gwr_a_b ? `<span${basicColor ? ` style="color: ${basicColor}; font-weight: bold;"` : ``}>${basicRatio}:1</span> (<span${advancedColor ? ` style="color: ${advancedColor}; font-weight: bold;"` : ``}>${advancedRatio}:1</span>)` : `<span${advancedColor ? ` style="color: ${advancedColor}; font-weight: bold;"` : ``}>${advancedRatio}:1</span>`) : `<span${basicColor ? ` style="color: ${basicColor}; font-weight: bold;"` : ``}>${basicRatio}:1</span>`}</span>
        `;
    }

    function addGwcrHeading(context, main) {
        var table, title;
        if ((!esgst.createdPath && !esgst.wonPath) && main) {
            table = context.getElementsByClassName(`table__heading`)[0];
            if (table && !table.getElementsByClassName(`esgst-gwcr-heading`)[0]) {
                if (esgst.gwc && esgst.gwr) {
                    title = `Chance / Ratio`;
                } else if (esgst.gwc) {
                    title = `Chance`;
                } else {
                    title = `Ratio`;
                }
                table.firstElementChild.insertAdjacentHTML(`afterEnd`, `<div class="table__column--width-small text-center esgst-gwcr-heading">${title}</div>`);
            }
        }
    }

    /* [GP] Giveaway Popup */

    function addGpButtons(giveaways, main, source) {
        let buttonSet;
        if (((esgst.createdPath || esgst.enteredPath || esgst.wonPath || esgst.giveawayPath || esgst.newGiveawayPath) && !main) || (!esgst.createdPath && !esgst.enteredPath && !esgst.wonPath && !esgst.giveawayPath && !esgst.newGiveawayPath)) {
            giveaways.forEach(giveaway => {
                if (!giveaway.innerWrap.getElementsByClassName(`esgst-gp-button`)[0] && (!giveaway.inviteOnly || giveaway.url)) {
                    buttonSet = new ButtonSet(`grey`, `grey`, `fa-external-link`, `fa-circle-o-notch fa-spin`, ``, ``, openElgbPopup.bind(null, giveaway, main, source)).set;
                    buttonSet.classList.add(`esgst-gp-button`);
                    buttonSet.title = `View giveaway description/add a comment`;
                    giveaway.panel.appendChild(buttonSet);
                }
            });
        }
    }

    /* [ELGB] Enter/Leave Giveaway Button */

    function addElgbButtons(giveaways, main, source) {
        var games, giveaway, i, n;
        getValue(`games`).then(value => {
            games = JSON.parse(value);
            if (((main && !esgst.elgb_p) || !main) && (((esgst.createdPath || esgst.enteredPath || esgst.wonPath) && !main) || (!esgst.createdPath && !esgst.enteredPath && !esgst.wonPath))) {
                for (i = 0, n = giveaways.length; i < n; ++i) {
                    giveaway = giveaways[i];
                    if (!giveaway.innerWrap.getElementsByClassName(`esgst-elgb-button`)[0]) {
                        if (!giveaway.blacklist && ((giveaway.inviteOnly && giveaway.url) || !giveaway.inviteOnly) && giveaway.started && !giveaway.ended && !giveaway.created && giveaway.level <= esgst.level && ((giveaway.id && ((games[giveaway.type][giveaway.id] && !games[giveaway.type][giveaway.id].owned && !games[giveaway.type][giveaway.id].won && (!games[giveaway.type][giveaway.id].hidden || !esgst.hgebd)) || !games[giveaway.type][giveaway.id])) || !giveaway.id)) {
                            if (esgst.giveawayPath && main) {
                                let sidebarButton = document.getElementsByClassName(`sidebar__error is-disabled`)[0];
                                if (sidebarButton && sidebarButton.textContent.trim() === `Not Enough Points`) {
                                    giveaway.elgbPanel = insertHtml(sidebarButton.parentElement, `afterBegin`, `<div></div>`);
                                    sidebarButton.remove();
                                    addElgbButton(giveaway, main, source);
                                }
                            } else {
                                addElgbButton(giveaway, main, source);
                            }
                        }
                    }
                }
            }
        });
    }

    function addElgbButton(giveaway, main, source) {
        if (giveaway.elgbButton) {
            giveaway.elgbButton.remove();
        }
        if (giveaway.entered) {
            giveaway.elgbButton = new ButtonSet(`yellow`, `grey`, `fa-minus-circle`, `fa-circle-o-notch fa-spin`, `Leave`, `Leaving...`, leaveElgbGiveaway.bind(null, giveaway, main, source)).set;
            giveaway.elgbButton.removeAttribute(`title`);
        } else if (giveaway.error) {
            giveaway.elgbButton = document.createElement(`div`);
            giveaway.elgbButton.className = `esgst-button-set`;
            giveaway.elgbButton.innerHTML = `
                <div class="sidebar__error is-disabled">
                    <i class="fa fa-exclamation-circle"></i>
                    <span>${giveaway.error}</span>
                </div>
            `;
        } else if (giveaway.noPoints) {
            giveaway.elgbButton = new ButtonSet(`red`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Enter`, `Entering...`, enterElgbGiveaway.bind(null, giveaway, main, null, source)).set;
            giveaway.elgbButton.setAttribute(`title`, `Not Enough Points`);
        } else {
            if (giveaway.points <= esgst.points) {
                giveaway.elgbButton = new ButtonSet(`green`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Enter`, `Entering...`, enterElgbGiveaway.bind(null, giveaway, main, null, source)).set;
                giveaway.elgbButton.removeAttribute(`title`);
            } else {
                giveaway.elgbButton = new ButtonSet(`red`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Enter`, `Entering...`, enterElgbGiveaway.bind(null, giveaway, main, null, source)).set;
                giveaway.elgbButton.setAttribute(`title`, `Not Enough Points`);
            }
        }
        giveaway.elgbButton.classList.add(`esgst-elgb-button`);
        if (esgst.gv && ((main && esgst.giveawaysPath) || (source === `gb` && esgst.gv_gb) || (source === `ged` && esgst.gv_ged) || (source === `ge` && esgst.gv_ge))) {
            giveaway.elgbPanel.insertBefore(giveaway.elgbButton, giveaway.elgbPanel.firstElementChild);
        } else {
            giveaway.elgbPanel.appendChild(giveaway.elgbButton);
        }
    }

    function openElgbPopup(giveaway, main, source, mainCallback) {
        var box, description, popup, set;
        if (esgst.elgb_d || (esgst.elgb_r && esgst.elgb_r_d) || mainCallback) {
            request(null, null, `GET`, false, giveaway.url, function(response) {
                popup = new Popup(`fa-file-text-o`, `<a href="${giveaway.url}"><span>${giveaway.name}</span></a> by <a href="/user/${giveaway.creator}">${giveaway.creator}</a>`, true);
                new Promise((resolve, reject) => {
                    if (giveaway.entered) {
                        set = new ButtonSet(`yellow`, `grey`, `fa-minus-circle`, `fa-circle-o-notch fa-spin`, `Leave Giveaway`, `Leaving...`, function (callback) {
                            leaveElgbGiveaway(giveaway, main, source, function () {
                                callback();
                                popup.close();
                            });
                        });
                        popup.description.appendChild(set.set);
                        resolve();
                    } else {
                        getValue(`games`).then(value => {
                            let games = JSON.parse(value);
                            if (giveaway.started && !giveaway.ended && !giveaway.created && giveaway.level <= esgst.level && ((giveaway.id && ((games[giveaway.type][giveaway.id] && !games[giveaway.type][giveaway.id].owned && (!games[giveaway.type][giveaway.id].hidden || !esgst.hgebd)) || !games[giveaway.type][giveaway.id])) || !giveaway.id)) {
                                set = new ButtonSet(`green`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Enter Giveaway`, `Entering...`, function (callback) {
                                    enterElgbGiveaway(giveaway, main, true, source, function () {
                                        callback();
                                        popup.close();
                                    });
                                });
                                popup.description.appendChild(set.set);
                            }
                            resolve();
                        });
                    }
                }).then(() => {
                    description = parseHtml(response.responseText).getElementsByClassName(`page__description`)[0];
                    if (description && description.textContent.trim()) {
                        if (!mainCallback) {
                            if (esgst.elgb_c) {
                                if (Date.now() - esgst.elgbCache.timestamp > 3600000) {
                                    esgst.elgbCache = {
                                        descriptions: {},
                                        timestamp: Date.now()
                                    };
                                    setLocalValue(`elgbCache`, JSON.stringify(esgst.elgbCache));
                                }
                                if (!esgst.elgbCache.descriptions[giveaway.creator]) {
                                    esgst.elgbCache.descriptions[giveaway.creator] = [];
                                }
                                let html = description.innerHTML, i;
                                for (i = esgst.elgbCache.descriptions[giveaway.creator].length - 1; i > -1 && esgst.elgbCache.descriptions[giveaway.creator][i] !== html; --i);
                                if (i > -1) {
                                    description = null;
                                } else {
                                    esgst.elgbCache.descriptions[giveaway.creator].push(html);
                                    setLocalValue(`elgbCache`, JSON.stringify(esgst.elgbCache));
                                    if (esgst.elgb_f) {
                                        let text = description.textContent.replace(/[^a-zA-Z]/g, ``).toLowerCase();
                                        if (text.match(new RegExp(`^(${esgst.elgb_filters})$`))) {
                                            description = null;
                                        }
                                    }
                                }
                            } else if (esgst.elgb_f) {
                                let text = description.textContent.replace(/[^a-zA-Z]/g, ``).toLowerCase();
                                if (text.match(new RegExp(`^(${esgst.elgb_filters})$`))) {
                                    description = null;
                                }
                            }
                        }
                        if (description) {
                            description.classList.add(`esgst-text-left`);
                            popup.scrollable.insertAdjacentHTML(`beforeEnd`, description.outerHTML);
                            if (esgst.elgb_r || mainCallback) {
                                box = insertHtml(popup.scrollable, `beforeEnd`, `<textarea></textarea>`);
                                if (esgst.cfh) {
                                    addCfhPanel(box);
                                }
                                popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-arrow-circle-right`, `fa-circle-o-notch fa-spin`, `Add Comment`, `Saving...`, function (callback) {
                                    if (box.value) {
                                        request(`xsrf_token=${esgst.xsrfToken}&do=comment_new&description=${box.value}`, null, `POST`, false, giveaway.url, function() {
                                            callback();
                                            popup.close();
                                        });
                                    } else {
                                        callback();
                                        popup.close();
                                    }
                                }).set);
                                if (mainCallback) {
                                    popup.onClose = mainCallback;
                                }
                                if (esgst.elgb_f) {
                                    set = new ButtonSet(`grey`, `grey`, `fa-eye`, `fa-circle-o-notch fa-spin`, `Add Description To Filters`, `Filtering...`, function (callback) {
                                        esgst.elgb_filters = `${esgst.elgb_filters}|${description.textContent.replace(/[^a-zA-Z]/g, ``).toLowerCase()}`;
                                        setSetting(`elgb_filters`, esgst.elgb_filters).then(() => {
                                            callback();
                                            set.remove();
                                        });
                                    }).set;
                                    popup.description.appendChild(set);
                                }
                                popup.open(function () {
                                    box.focus();
                                });
                            } else {
                                if (mainCallback) {
                                    popup.onClose = mainCallback;
                                }
                                if (esgst.elgb_f) {
                                    set = new ButtonSet(`grey`, `grey`, `fa-eye`, `fa-circle-o-notch fa-spin`, `Add Description To Filters`, `Filtering...`, function (callback) {
                                        esgst.elgb_filters = `${esgst.elgb_filters}|${description.textContent.replace(/[^a-zA-Z]/g, ``).toLowerCase()}`;
                                        setSetting(`elgb_filters`, esgst.elgb_filters).then(() => {
                                            callback();
                                            set.remove();
                                        });
                                    }).set;
                                    popup.description.appendChild(set);
                                }
                                popup.open();
                            }
                        } else if ((esgst.elgb_r && !esgst.elgb_r_d) || mainCallback) {
                            box = insertHtml(popup.scrollable, `beforeEnd`, `<textarea></textarea>`);
                            if (esgst.cfh) {
                                addCfhPanel(box);
                            }
                            popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-arrow-circle-right`, `fa-circle-o-notch fa-spin`, `Add Comment`, `Saving...`, function (callback) {
                                if (box.value) {
                                    request(`xsrf_token=${esgst.xsrfToken}&do=comment_new&description=${box.value}`, null, `POST`, false, giveaway.url, function() {
                                        callback();
                                        popup.close();
                                    });
                                } else {
                                    callback();
                                    popup.close();
                                }
                            }).set);
                            if (mainCallback) {
                                popup.onClose = mainCallback;
                            }
                            popup.open(function () {
                                box.focus();
                            });
                        }
                    } else if ((esgst.elgb_r && !esgst.elgb_r_d) || mainCallback) {
                        box = insertHtml(popup.scrollable, `beforeEnd`, `<textarea></textarea>`);
                        if (esgst.cfh) {
                            addCfhPanel(box);
                        }
                        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-arrow-circle-right`, `fa-circle-o-notch fa-spin`, `Add Comment`, `Saving...`, function (callback) {
                            if (box.value) {
                                request(`xsrf_token=${esgst.xsrfToken}&do=comment_new&description=${box.value}`, null, `POST`, false, giveaway.url, function() {
                                    callback();
                                    popup.close();
                                });
                            } else {
                                callback();
                                popup.close();
                            }
                        }).set);
                        if (mainCallback) {
                            popup.onClose = mainCallback;
                        }
                        popup.open(function () {
                            box.focus();
                        });
                    }
                });
            });
        } else if (esgst.elgb_r && !esgst.elgb_r_d) {
            popup = new Popup(`fa-file-text-o`, `<a href="${giveaway.url}"><span>${giveaway.name}</span></a> by <a href="/user/${giveaway.creator}">${giveaway.creator}</a>`, true);
            new Promise((resolve, reject) => {
                if (giveaway.entered) {
                    set = new ButtonSet(`yellow`, `grey`, `fa-minus-circle`, `fa-circle-o-notch fa-spin`, `Leave Giveaway`, `Leaving...`, function (callback) {
                        leaveElgbGiveaway(giveaway, main, source, function () {
                            callback();
                            popup.close();
                        });
                    });
                    popup.description.appendChild(set.set);
                    resolve();
                } else {
                    getValue(`games`).then(value => {
                        let games = JSON.parse(value);
                        if (giveaway.started && !giveaway.ended && !giveaway.created && giveaway.level <= esgst.level && ((giveaway.id && ((games[giveaway.type][giveaway.id] && !games[giveaway.type][giveaway.id].owned && (!games[giveaway.type][giveaway.id].hidden || !esgst.hgebd)) || !games[giveaway.type][giveaway.id])) || !giveaway.id)) {
                            set = new ButtonSet(`green`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Enter Giveaway`, `Entering...`, function (callback) {
                                enterElgbGiveaway(giveaway, main, true, source, function () {
                                    callback();
                                    popup.close();
                                });
                            });
                            popup.description.appendChild(set.set);
                        }
                        resolve();
                    });
                }
            }).then(() => {
                box = insertHtml(popup.scrollable, `beforeEnd`, `<textarea></textarea>`);
                if (esgst.cfh) {
                    addCfhPanel(box);
                }
                popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-arrow-circle-right`, `fa-circle-o-notch fa-spin`, `Add Comment`, `Saving...`, function (callback) {
                    if (box.value) {
                        request(`xsrf_token=${esgst.xsrfToken}&do=comment_new&description=${box.value}`, null, `POST`, false, giveaway.url, function() {
                            callback();
                            popup.close();
                        });
                    } else {
                        callback();
                        popup.close();
                    }
                }).set);
                if (mainCallback) {
                    popup.onClose = mainCallback;
                }
                popup.open(function () {
                    box.focus();
                });
            });
        }
    }

    function enterElgbGiveaway(giveaway, main, popup, source, callback) {
        request(`xsrf_token=${esgst.xsrfToken}&do=entry_insert&code=${giveaway.code}`, null, `POST`, false, `/ajax.php`, function(response) {
            var responseJson;
            responseJson = JSON.parse(response.responseText);
            if (responseJson.type === `success`) {
                if (!esgst.giveawayPath || !main) {
                    giveaway.innerWrap.classList.add(`is-faded`);
                }
                giveaway.entered = true;
                giveaway.noPoints = false;
                addElgbButton(giveaway, main, source);
                if (esgst.et) {
                    setEtEntry(giveaway.code, true, giveaway.name);
                }
                esgst.pointsContainer.textContent = responseJson.points;
                refreshHeaderElements(document).then(() => {
                    if (esgst.hr) {
                        setLocalValue(`hrCache`, JSON.stringify(getHrCache()));
                    }
                });
                updateElgbButtons();
                if (esgst.egh) {
                    saveEghGame(giveaway.id, giveaway.type);
                }
                if (esgst.gb && esgst.gb_ue) {
                    var button = giveaway.outerWrap.getElementsByClassName(`esgst-gb-button`)[0];
                    if (button) {
                        unbookmarkGbGiveaway(giveaway, function() {
                            button.remove();
                            addGbBookmarkButton(giveaway, main);
                        });
                    }
                }
                if (esgst.gf && esgst.gf.filteredCount && esgst[`gf_enable${esgst.gf.type}`]) {
                    filterGfGiveaways(esgst.gf);
                }
                if (esgst.gfPopup && esgst.gfPopup.filteredCount && esgst[`gf_enable${esgst.gfPopup.type}`]) {
                    filterGfGiveaways(esgst.gfPopup);
                }
                callback();
                if (!popup && (!esgst.giveawayPath || !main)) {
                    openElgbPopup(giveaway, main, source);
                }
            } else {
                giveaway.entered = false;
                if (responseJson.msg.match(/Not Enough Points/)) {
                    giveaway.noPoints = true;
                } else {
                    giveaway.error = responseJson.msg;
                }
                addElgbButton(giveaway, main, source);
                callback();
            }
        });
    }

    function leaveElgbGiveaway(giveaway, main, source, callback) {
        request(`xsrf_token=${esgst.xsrfToken}&do=entry_delete&code=${giveaway.code}`, null, `POST`, false, `/ajax.php`, function(response) {
            var responseJson;
            responseJson = JSON.parse(response.responseText);
            if (responseJson.type === `success`) {
                giveaway.innerWrap.classList.remove(`is-faded`);
                giveaway.entered = false;
                giveaway.noPoints = false;
                addElgbButton(giveaway, main, source);
                if (esgst.et) {
                    setEtEntry(giveaway.code, false, giveaway.name);
                }
                esgst.pointsContainer.textContent = responseJson.points;
                refreshHeaderElements(document).then(() => {
                    if (esgst.hr) {
                        setLocalValue(`hrCache`, JSON.stringify(getHrCache()));
                    }
                });
                updateElgbButtons();
                if (esgst.gf && esgst.gf.filteredCount && esgst[`gf_enable${esgst.gf.type}`]) {
                    filterGfGiveaways(esgst.gf);
                }
                if (esgst.gfPopup && esgst.gfPopup.filteredCount && esgst[`gf_enable${esgst.gfPopup.type}`]) {
                    filterGfGiveaways(esgst.gfPopup);
                }
                callback();
            } else {
                callback();
            }
        });
    }

    function updateElgbButtons() {
        var giveaway, i, n;
        for (i = 0, n = esgst.currentGiveaways.length; i < n; ++i) {
            giveaway = esgst.currentGiveaways[i];
            if (giveaway.elgbButton && !giveaway.entered) {
                addElgbButton(giveaway, true);
            }
        }
        if (esgst.ttec) {
            calculateTtecTime(esgst.currentGiveaways, true);
        }
    }

    /* [GGL] Giveaway Groups Loader */

    function setGglButtons(giveaways, main) {
        var i, n;
        if ((main && !esgst.createdPath && !esgst.enteredPath && !esgst.wonPath) || !main) {
            for (i = 0, n = giveaways.length; i < n; ++i) {
                setGglButton(giveaways[i]);
            }
        }
    }

    function setGglButton(giveaway) {
        var container, context, delay, eventType, exitTimeout, newGiveaways, newGroups, onClick, savedGiveaways, savedGroups, timeout;
        if (giveaway.group) {
            switch (esgst.ggl_index) {
                case 1:
                    eventType = `mouseenter`;
                    onClick = false;
                    delay = 1000;
                    giveaway.group.addEventListener(`mouseleave`, function(event) {
                        if (timeout) {
                            clearTimeout(timeout);
                            timeout = null;
                        }
                        exitTimeout = setTimeout(function() {
                            if (context && !container.contains(event.relatedTarget)) {
                                context.close();
                            }
                        }, 1000);
                    });
                    giveaway.group.addEventListener(`click`, function() {
                        if (timeout) {
                            clearTimeout(timeout);
                            timeout = null;
                        }
                    });
                    break;
                case 2:
                    giveaway.group.removeAttribute(`href`);
                    giveaway.group.classList.add(`esgst-clickable`);
                    eventType = `click`;
                    onClick = true;
                    delay = 0;
                    break;
                case 3:
                    giveaway.group.removeAttribute(`href`);
                    giveaway.group.classList.add(`esgst-clickable`);
                    eventType = `click`;
                    delay = 0;
                    break;
            }
            giveaway.group.addEventListener(eventType, function() {
                timeout = setTimeout(function() {
                    if (context) {
                        switch (esgst.ggl_index) {
                            case 1:
                                context.open(giveaway.group);
                                break;
                            case 2:
                                if (context.isOpen) {
                                    context.close();
                                } else {
                                    context.open(giveaway.group);
                                }
                            case 3:
                                context.open();
                                break;
                        }
                    } else {
                        if (esgst.ggl_index === 3) {
                            context = new Popup(`fa-user`, `<a href="${giveaway.url}/groups">Giveaway Groups</a>`);
                            container = context.scrollable;
                            context.open();
                        } else {
                            context = new Popout(`esgst-ggl-popout`, null, 1000, onClick);
                            container = context.popout;
                            context.open(giveaway.group);
                        }
                        container.innerHTML = `
                            <i class="fa fa-circle-o-notch fa-spin"></i>
                            <span>Loading groups...</span>
                        `;
                        newGiveaways = {};
                        newGroups = {};
                        getValues({
                            giveaways: `{}`,
                            groups: `[]`
                        }).then(values => {
                            savedGiveaways = JSON.parse(values.giveaways);
                            savedGroups = JSON.parse(values.groups);
                            loadGglGroups([giveaway], 0, 1, newGiveaways, newGroups, savedGiveaways, savedGroups, function(groups) {
                                var className, code, group, groupCount, i, j, n, link;
                                if (groups) {
                                    container.innerHTML = `
                                        <div class="esgst-text-left table esgst-hidden">
                                            <div class="table__rows"></div>
                                        </div>
                                    `;
                                    groupCount = 0;
                                    for (i = 0, n = groups.length; i < n; ++i) {
                                        code = groups[i];
                                        for (j = savedGroups.length - 1; j >= 0 && savedGroups[j].code !== code; --j);
                                        if (j >= 0) {
                                            group = savedGroups[j];
                                        } else {
                                            group = newGroups[code];
                                        }
                                        if (group && group.member) {
                                            className = `esgst-ggl-member`;
                                            groupCount += 1;
                                        } else if (esgst.ggl_m) {
                                            className = `esgst-hidden`;
                                        } else {
                                            className = ``;
                                            groupCount += 1;
                                        }
                                        if (className !== `esgst-hidden`) {
                                            link = insertHtml(container.firstElementChild.firstElementChild, `beforeEnd`, `
                                                <div class="table__row-outer-wrap ${className}">
                                                    <div class="table__row-inner-wrap">
                                                        <div>
                                                            <a class="table_image_avatar" href="/group/${group.code}/" style="background-image:url(http://cdn.edgecast.steamstatic.com/steamcommunity/public/images/avatars/${group.avatar}_medium.jpg)"></a>
                                                        </div>
                                                        <div class="table__column--width-fill">
                                                            <a class="table__column__heading" href="/group/${group.code}/"></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            `).getElementsByClassName(`table__column__heading`)[0];
                                            link.textContent = group.name;
                                        }
                                    }
                                    if (groupCount === 0) {
                                        container.innerHTML = `
                                            <i class="fa fa-exclamation-mark"></i>
                                            <span>You are not a member of any group in this giveaway.</span>
                                        `;
                                    } else {
                                        container.firstElementChild.classList.remove(`esgst-hidden`);
                                        loadEndlessFeatures(container);
                                    }
                                    if (esgst.ggl_index === 2) {
                                        container.insertAdjacentHTML(`afterBegin`, `<a class="esgst-ggl-heading" href="${giveaway.url}/groups">Giveaway Groups</a>`);
                                    }
                                    context.reposition();
                                } else {
                                    container.innerHTML = `
                                        <i class="fa fa-times-circle"></i>
                                        <span>An error ocurred.</span>
                                    `;
                                    if (esgst.ggl_index === 2) {
                                        container.insertAdjacentHTML(`afterBegin`, `<a class="esgst-ggl-heading" href="${giveaway.url}/groups">Giveaway Groups</a>`);
                                    }
                                    context.reposition();
                                }
                            });
                        });
                    }
                    if (esgst.ggl_index === 1) {
                        container.onmouseenter = function() {
                            if (exitTimeout) {
                                clearTimeout(exitTimeout);
                                exitTimeout = null;
                            }
                        };
                    }
                }, delay);
            });
        }
    }

    function getGglGiveaways(giveaways) {
        var newGiveaways, newGroups, savedGiveaways, savedGroups;
        newGiveaways = {};
        newGroups = {};
        getValues({
            giveaways: `{}`,
            groups: `[]`
        }).then(values => {
            savedGiveaways = JSON.parse(values.giveaways);
            savedGroups = JSON.parse(values.groups);
            loadGglGroups(giveaways, 0, giveaways.length, newGiveaways, newGroups, savedGiveaways, savedGroups);
        });
    }

    function loadGglGroups(giveaways, i, n, newGiveaways, newGroups, savedGiveaways, savedGroups, callback) {
        let giveaway, found, j, k;
        if (i < n) {
            giveaway = giveaways[i];
            if (giveaway.group) {
                if (savedGiveaways[giveaway.code] && Array.isArray(savedGiveaways[giveaway.code].groups)) {
                    found = true;
                    for (j = savedGiveaways[giveaway.code].groups.length - 1; j > -1 && found; --j) {
                        for (k = esgst.groups.length - 1; k > -1 && esgst.groups[k].code !== savedGiveaways[giveaway.code].groups[j]; --k);
                        if (k <= -1) {
                            found = false;
                        }
                    }
                }
                if (found) {
                    if (callback) {
                        callback(savedGiveaways[giveaway.code].groups);
                    } else {
                        addGglPanel(giveaway, savedGiveaways[giveaway.code].groups, newGroups, savedGroups);
                    }
                    setTimeout(loadGglGroups, 0, giveaways, ++i, n, newGiveaways, newGroups, savedGiveaways, savedGroups);
                } else {
                    getGglGroups([], 1, newGroups, `${giveaway.url}/groups/search?page=`, function (groups) {
                        if (groups) {
                            newGiveaways[giveaway.code] = {
                                groups: groups
                            };
                            if (callback) {
                                callback(groups);
                            } else {
                                addGglPanel(giveaway, groups, newGroups, savedGroups);
                            }
                            setTimeout(loadGglGroups, 0, giveaways, ++i, n, newGiveaways, newGroups,  savedGiveaways, savedGroups);
                        } else if (callback) {
                            callback(null);
                        } else {
                            setTimeout(loadGglGroups, 0, giveaways, ++i, n, newGiveaways, newGroups,  savedGiveaways, savedGroups);
                        }
                    });
                }
            } else {
                setTimeout(loadGglGroups, 0, giveaways, ++i, n, newGiveaways, newGroups,  savedGiveaways, savedGroups);
            }
        } else {
            lockAndSaveGiveaways(newGiveaways);
            lockAndSaveGroups(newGroups);
        }
    }

    function addGglPanel(giveaway, groups, newGroups, savedGroups) {
        var className, code, group, groupCount, i, link, n, panel;
        if (!giveaway.summary.getElementsByClassName(`esgst-ggl-panel`)[0]) {
            panel = insertHtml(giveaway.summary, `beforeEnd`, `
                <div class="esgst-ggl-panel"></div>
            `);
            groupCount = 0;
            for (i = 0, n = groups.length; i < n; ++i) {
                code = groups[i];
                for (j = savedGroups.length - 1; j >= 0 && savedGroups[j].code !== code; --j);
                if (j >= 0) {
                    group = savedGroups[j];
                } else {
                    group = newGroups[code];
                }
                if (group && group.member) {
                    className = `esgst-ggl-member`;
                    groupCount += 1;
                } else if (esgst.ggl_m) {
                    className = `esgst-hidden`;
                } else {
                    className = ``;
                    groupCount += 1;
                }
                if (className !== `esgst-hidden`) {
                    link = insertHtml(panel, `beforeEnd`, `
                        <div class="${className}">
                            <a class="table_image_avatar" href="/group/${group.code}/"  style="background-image:url(http://cdn.edgecast.steamstatic.com/steamcommunity/public/images/avatars/${group.avatar}_medium.jpg)"></a>
                            <a href="/group/${group.code}/"></a>
                        </div>
                    `).lastElementChild;
                    link.textContent = group.name;
                    if (esgst.ap) {
                        getApAvatars(panel);
                    }
                }
            }
            if (groupCount === 0) {
                panel.remove();
            }
        }
    }

    function getGglGroups(groups, nextPage, newGroups, url, callback) {
        var code, element, elements, error, heading, i, match, n, pagination, responseHtml;
        request(null, null, `GET`, false, `${url}${nextPage}`, function(response) {
            responseHtml = parseHtml(response.responseText);
            error = responseHtml.getElementsByClassName(`table--summary`)[0];
            if (error) {
                setTimeout(callback, 0, null);
            } else {
                elements = responseHtml.getElementsByClassName(`table__row-inner-wrap`);
                for (i = 0, n = elements.length; i < n; ++i) {
                    element = elements[i];
                    heading = element.getElementsByClassName(`table__column__heading`)[0];
                    match = heading.getAttribute(`href`).match(/group\/(.+?)\//);
                    code = match[1];
                    newGroups[code] = {
                        avatar: element.getElementsByClassName(`table_image_avatar`)[0].style.backgroundImage.match(/\/avatars\/(.+)_medium/)[1],
                        code: code,
                        name: heading.textContent
                    };
                    groups.push(code);
                }
                pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
                if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(getGglGroups, 0, groups, ++nextPage, newGroups, url, callback);
                } else {
                    setTimeout(callback, 0, groups);
                }
            }
        });
    }

    /* [GCL] Giveaway Countries Loader */

    function setGclButtons(giveaways, main) {
        var i, n;
        if ((main && !esgst.createdPath && !esgst.enteredPath && !esgst.wonPath) || !main) {
            for (i = 0, n = giveaways.length; i < n; ++i) {
                setGclButton(giveaways[i]);
            }
        }
    }

    function setGclButton(giveaway) {
        var container, context, delay, eventType, exitTimeout, onClick, timeout;
        if (giveaway.regionRestricted) {
            switch (esgst.gcl_index) {
                case 0:
                    eventType = `mouseenter`;
                    onClick = false;
                    delay = 1000;
                    giveaway.regionRestricted.addEventListener(`mouseleave`, function(event) {
                        if (timeout) {
                            clearTimeout(timeout);
                            timeout = null;
                        }
                        exitTimeout = setTimeout(function() {
                            if (context && !container.contains(event.relatedTarget)) {
                                context.close();
                            }
                        }, 1000);
                    });
                    giveaway.regionRestricted.addEventListener(`click`, function() {
                        if (timeout) {
                            clearTimeout(timeout);
                            timeout = null;
                        }
                    });
                    break;
                case 1:
                    eventType = `click`;
                    onClick = true;
                    delay = 0;
                    giveaway.regionRestricted.removeAttribute(`href`);
                    giveaway.regionRestricted.classList.add(`esgst-clickable`);
                    break;
                case 2:
                    eventType = `click`;
                    delay = 0;
                    giveaway.regionRestricted.removeAttribute(`href`);
                    giveaway.regionRestricted.classList.add(`esgst-clickable`);
                    break;
            }
            giveaway.regionRestricted.addEventListener(eventType, function() {
                timeout = setTimeout(function() {
                    if (context) {
                        switch (esgst.gcl_index) {
                            case 0:
                                context.open(giveaway.regionRestricted);
                                break;
                            case 1:
                                if (context.isOpen) {
                                    context.close();
                                } else {
                                    context.open(giveaway.regionRestricted);
                                }
                                break;
                            case 2:
                                context.open();
                                break;
                        }
                    } else {
                        if (esgst.gcl_index === 2) {
                            context = new Popup(`fa-globe`, `<a href="${giveaway.url}/region-restrictions">Giveaway Countries</a>`);
                            container = context.scrollable;
                            context.open();
                        } else {
                            context = new Popout(`esgst-gcl-popout`, null, 1000, onClick);
                            container = context.popout;
                            context.open(giveaway.regionRestricted);
                        }
                        container.innerHTML = `
                            <i class="fa fa-circle-o-notch fa-spin"></i>
                            <span>Loading countries...</span>
                        `;
                        getGclCountries([], 1, `${giveaway.url}/region-restrictions/search?page=`, countries => {
                            if (countries) {
                                container.innerHTML = `
                                    <input placeholder="Search country..." type="text"/>
                                    <div class="esgst-text-left table">
                                        <div class="table__rows"></div>
                                    </div>
                                `;
                                container.firstElementChild.addEventListener(`input`, () => {
                                    let elements, i, value;
                                    value = container.firstElementChild.value.toLowerCase();
                                    elements = container.lastElementChild.firstElementChild.children;
                                    if (value) {
                                        for (i = elements.length - 1; i > -1; --i) {
                                            element = elements[i];
                                            if (element.getElementsByClassName(`table__column__heading`)[0].textContent.toLowerCase().match(value)) {
                                                element.classList.remove(`esgst-hidden`);
                                            } else {
                                                element.classList.add(`esgst-hidden`);
                                            }
                                        }
                                    } else {
                                        for (i = elements.length - 1; i > -1; --i) {
                                            elements[i].classList.remove(`esgst-hidden`);
                                        }
                                    }
                                    context.reposition();
                                });
                                countries.forEach(country => {
                                    container.lastElementChild.firstElementChild.insertAdjacentHTML(`beforeEnd`, country);
                                });
                                loadEndlessFeatures(container).then(() => {
                                    if (esgst.gcl_index === 1) {
                                        container.insertAdjacentHTML(`afterBegin`, `<a class="esgst-ggl-heading" href="${giveaway.url}/region-restrictions">Giveaway Countries</a>`);
                                    }
                                    context.reposition();
                                });
                            } else {
                                container.innerHTML = `
                                    <i class="fa fa-times-circle"></i>
                                    <span>An error ocurred.</span>
                                `;
                                if (esgst.gcl_index === 1) {
                                    container.insertAdjacentHTML(`afterBegin`, `<a class="esgst-ggl-heading" href="${giveaway.url}/region-restrictions">Giveaway Countries</a>`);
                                }
                                context.reposition();
                            }
                        });
                    }
                    if (esgst.gcl_index === 0) {
                        container.onmouseenter = function() {
                            if (exitTimeout) {
                                clearTimeout(exitTimeout);
                                exitTimeout = null;
                            }
                        };
                    }
                }, delay);
            });
        }
    }

    function getGclCountries(countries, nextPage, url, callback) {
        request(null, null, `GET`, false, `${url}${nextPage}`, response => {
            let responseHtml = parseHtml(response.responseText);
            if (responseHtml.getElementsByClassName(`table--summary`)[0]) {
                setTimeout(callback, 0, null);
            } else {
                let elements, i, n, pagination;
                elements = responseHtml.getElementsByClassName(`table__row-outer-wrap`);
                for (i = 0, n = elements.length; i < n; ++i) {
                    countries.push(elements[i].outerHTML);
                }
                pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
                if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(getGclCountries, 0, countries, ++nextPage, url, callback);
                } else {
                    setTimeout(callback, 0, countries);
                }
            }
        });
    }

    /* [GWL] Giveaway Winners Link */

    function addGwlLinks(giveaways) {
        var giveaway, i, link, n;
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            if (!giveaway.innerWrap.getElementsByClassName(`esgst-gwl`)[0]) {
                if (giveaway.ended) {
                    link = giveaway.url ? `href="${giveaway.url}/winners"` : ``;
                    giveaway.entriesLink.insertAdjacentHTML(`afterEnd`, `
                        <a class="esgst-gwl" ${link}>
                            <i class="fa fa-trophy"></i>
                            <span>${giveaway.winners} winners</span>
                        </a>
                    `);
                }
            }
        }
    }

    /* [GR] Giveaway Recreator */

    function recreateGrGiveaway(button, giveaway) {
        var context, elements, i, keys, n, responseJson, template;
        button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        if (esgst.createdPath) {
            request(null, null, `GET`, false, giveaway.url, function (response) {
                getGiveaways(parseHtml(response.responseText), false, response.finalUrl, false, `giveaway`).then(giveaways => {
                    saveGrTemplate(button, giveaways[0] || giveaway);
                });
            });
        } else {
            saveGrTemplate(button, giveaway);
        }
    }

    function saveGrTemplate(button, giveaway) {
        request(`do=autocomplete_giveaway_game&page_number=1&search_query=${encodeURIComponent(giveaway.name)}`, null, `POST`, false, `/ajax.php`, function(response) {
            template = {
                delay: 0,
                description: ``,
                duration: giveaway.endTime - giveaway.startTime,
                gameName: giveaway.name,
                groups: ``,
                level: giveaway.level,
                region: `0`
            };
            if (giveaway.group || giveaway.whitelist) {
                template.type = `groups`;
                if (giveaway.whitelist) {
                    template.whitelist = `1`;
                }
            } else if (giveaway.inviteOnly) {
                template.type = `invite_only`;
            } else {
                template.type = `everyone`;
            }
            elements = parseHtml(JSON.parse(response.responseText).html).getElementsByClassName(`table__row-outer-wrap`);
            for (i = 0, n = elements.length; i < n && elements[i].getAttribute(`data-autocomplete-name`) !== giveaway.name; ++i);
            if (i < n) {
                template.gameId = elements[i].getAttribute(`data-autocomplete-id`);
            }
            request(`xsrf_token=${esgst.xsrfToken}&do=popup_keys&code=${giveaway.code}`, null, `POST`, false, `/ajax.php`, function (response) {
                responseJson = JSON.parse(response.responseText);
                keys = [];
                context = parseHtml(JSON.parse(response.responseText).html).getElementsByClassName(`popup__keys__heading`);
                if (context) {
                    context = context[context.length - 1];
                    elements = context.nextElementSibling.nextElementSibling.children;
                    for (i = 0, n = elements.length; i < n; ++i) {
                        keys.push(elements[i].textContent);
                    }
                }
                if (keys.length > 0) {
                    template.keys = keys.join(`\n`);
                } else {
                    template.copies = giveaway.copies;
                }
                setValue(`grTemplate`, JSON.stringify(template)).then(getValue.bind(null, `giveaways`)).then(value => {
                    giveaways = JSON.parse(value);
                    if (!giveaways[giveaway.code]) {
                        giveaways[giveaway.code] = {};
                    }
                    giveaways[giveaway.code].recreated = true;
                    return setValue(`giveaways`, JSON.stringify(giveaways));
                }).then(() => {
                    button.remove();
                    open(`/giveaways/new`);
                });
            });
        });
    }

    function loadGrGiveaway() {
        var template;
        getValue(`grTemplate`).then(value => {
            template = value;
            if (template) {
                delValue(`grTemplate`).then(() => {
                    template = JSON.parse(template);
                    applyGtsTemplate(template);
                });
            }
        });
    }

    /* [GTS] Giveaway Templates */

    function addGtsButtonSection(button, rows) {
        var createGiveawayButton, delay, deletedTemplates, edit, endTime, input, message, preciseEndCheckbox, preciseEndDateCheckbox, preciseEndOption, preciseEndDateOption, preciseStartCheckbox, preciseStartDateCheckbox, preciseStartOption, preciseStartDateOption, reviewButton, section, set, startTime, undo, warning;
        if (rows) {
            gts = {};
            deletedTemplates = [];
            reviewButton = rows.lastElementChild;
            createGiveawayButton = new ButtonSet(`green`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Create Giveaway`, `Creating...`, function (callback) {
                var data;
                data = `xsrf_token=${esgst.xsrfToken}&next_step=3&`;
                data += `game_id=${document.querySelector(`[name="game_id"]`).value}&`;
                data += `type=${document.querySelector(`[name="type"]`).value}&`;
                data += `copies=${document.querySelector(`[name="copies"]`).value}&`;
                data += `key_string=${document.querySelector(`[name="key_string"]`).value}&`;
                data += `start_time=${document.querySelector(`[name="start_time"]`).value}&`;
                data += `end_time=${document.querySelector(`[name="end_time"]`).value}&`;
                data += `region_restricted=${document.querySelector(`[name="region_restricted"]`).value}&`;
                data += `country_item_string=${document.querySelector(`[name="country_item_string"]`).value.trim()}&`;
                data += `group_item_string=${document.querySelector(`[name="group_item_string"]`).value.trim()}&`;
                data += `who_can_enter=${document.querySelector(`[name="who_can_enter"]`).value}&`;
                data += `whitelist=${document.querySelector(`.form__row--who-can-enter [name="whitelist"]`).value}&`;
                data += `contributor_level=${document.querySelector(`[name="contributor_level"]`).value}&`;
                data += `description=${encodeURIComponent(document.querySelector(`[name="description"]`).value)}`;
                request(data, null, `POST`, false, `/giveaways/new`, function (response) {
                    callback();
                    location.href = response.finalUrl;
                });
            });
            rows.appendChild(createGiveawayButton.set);
            button.addEventListener(`click`, function () {
                var days, details, hours, i, n, popup, savedTemplate, savedTemplates, template, templates, time, weeks;
                popup = new Popup(`fa-file`, `View/apply templates:`, true);
                popup.description.insertAdjacentHTML(`afterBegin`, `
                    <div class="esgst-description">Drag and drop templates to move them.</div>
                `);
                undo = insertHtml(popup.description, `beforeEnd`, `
                    <div class="esgst-clickable esgst-hidden">
                        <i class="fa fa-rotate-left"></i>
                        <span>Undo Delete</span>
                    </div>
                `);
                undo.addEventListener(`click`, undoGtsDelete);
                templates = insertHtml(popup.scrollable, `beforeEnd`, `
                    <div class="esgst-text-left popup__keys__list"></div>
                `);
                getValue(`templates`, `[]`).then(value => {
                    savedTemplates = JSON.parse(value);
                    for (i = 0, n = savedTemplates.length; i < n; ++i) {
                        savedTemplate = savedTemplates[i];
                        details = ``;
                        if (savedTemplate.startTime || savedTemplate.endTime) {
                            if (savedTemplate.startTime) {
                                time = new Date(savedTemplate.startTime);
                                if (savedTemplate.startDate) {
                                    details += `${savedTemplate.startDate.year}-${savedTemplate.startDate.month + 1}-${savedTemplate.startDate.day} `;
                                }
                                details += `${`0${time.getHours()}`.slice(-2)}:${`0${time.getMinutes()}`.slice(-2)} to`;
                            } else {
                                details += `? to`;
                            }
                            if (savedTemplate.endTime) {
                                time = new Date(savedTemplate.endTime);
                                if (savedTemplate.endDate) {
                                    details += ` ${savedTemplate.endDate.year}-${savedTemplate.endDate.month + 1}-${savedTemplate.endDate.day}`;
                                }
                                details += ` ${`0${time.getHours()}`.slice(-2)}:${`0${time.getMinutes()}`.slice(-2)}`;
                            } else {
                                details += ` ?`;
                            }
                            details += `, `;
                        } else if (savedTemplate.startDate || savedTemplate.endDate) {
                            if (savedTemplate.startDate) {
                                details += `${savedTemplate.startDate.year}-${savedTemplate.startDate.month + 1}-${savedTemplate.startDate.day} to`;
                            } else {
                                details += `? to`;
                            }
                            if (savedTemplate.endDate) {
                                details += ` ${savedTemplate.endDate.year}-${savedTemplate.endDate.month + 1}-${savedTemplate.endDate.day}`;
                            } else {
                                details = ` ?`;
                            }
                            details += `, `;
                        }
                        hours = Math.floor(savedTemplate.duration / 3600000);
                        if (hours > 23) {
                            days = Math.floor(hours / 24);
                            if (days > 6) {
                                weeks = Math.floor(days / 7);
                                if (weeks === 1) {
                                    details += `1 week`;
                                } else {
                                    details += `${weeks} weeks`;
                                }
                            } else if (days === 1) {
                                details += `1 day`;
                            } else {
                                details += `${days} days`;
                            }
                        } else if (hours === 1) {
                            details += `1 hour`;
                        } else {
                            details += `${hours} hours`;
                        }
                        if (savedTemplate.region !== `0`) {
                            details += `, region restricted`;
                        }
                        if (savedTemplate.type === `everyone`) {
                            details += `, public`;
                        } else if (savedTemplate.type === `invite_only`) {
                            details += `, invite only`;
                        } else {
                            if (savedTemplate.whitelist === `1`) {
                                details += `, whitelist`;
                            }
                            if (savedTemplate.groups.trim()) {
                                details += `, groups`;
                            }
                        }
                        details += `, level ${savedTemplate.level}`;
                        template = insertHtml(templates, `beforeEnd`, `
                            <div draggable="true">
                                <div class="esgst-clickable" style="float: left;">
                                    <span class="esgst-bold">${savedTemplate.name}</span>
                                </div>
                                <div class="esgst-clickable" style="float: right;">
                                    <i class="fa fa-trash" title="Delete template"></i>
                                </div>
                                <div style="clear: both;"></div>
                                <div class="esgst-description">${details}</div>
                            </div>
                        `);
                        template.addEventListener(`dragstart`, setGtsSource.bind(null, gts, savedTemplate.name, template));
                        template.addEventListener(`dragenter`, getGtsSource.bind(null, gts, template, templates));
                        template.addEventListener(`dragend`, saveGtsSource.bind(null, gts));
                        setGtsTemplate(popup, template, savedTemplate);
                    }
                    popup.open();
                });
            });
            section = insertHtml(reviewButton, `beforeBegin`, `
                <div class="esgst-form-row">
                    <div class="esgst-form-heading">
                        <div class="esgst-form-heading-number">9.</div>
                        <div class="esgst-form-heading-text">Template</div>
                    </div>
                    <div class="esgst-gts-section esgst-form-row-indent">
                        <div>
                            <span>Use precise start time.</span>
                        </div>
                        <div>
                            <span>Use precise end time.</span>
                        </div>
                        <div>
                            <span>Use precise start date.</span>
                        </div>
                        <div>
                            <span>Use precise end date.</span>
                        </div>
                        <input class="form__input-small" type="text"/>
                        <span class="esgst-description esgst-hidden">Saved!</span>
                        <div class="esgst-hidden form__row__error">
                            <i class="fa fa-exclamation-circle"></i> Please enter a name for the template.
                        </div>
                        <div class="esgst-description">The name of the template.</div>
                    </div>
                </div>
            `).lastElementChild;
            preciseStartOption = section.firstElementChild;
            preciseEndOption = preciseStartOption.nextElementSibling;
            preciseStartDateOption = preciseEndOption.nextElementSibling;
            preciseEndDateOption = preciseStartDateOption.nextElementSibling;
            input = preciseEndDateOption.nextElementSibling;
            message = input.nextElementSibling;
            warning = message.nextElementSibling;
            preciseStartCheckbox = new Checkbox(preciseStartOption, esgst.gts_preciseStart);
            preciseEndCheckbox = new Checkbox(preciseEndOption, esgst.gts_preciseEnd);
            preciseStartDateCheckbox = new Checkbox(preciseStartDateOption, esgst.gts_preciseStartDate);
            preciseEndDateCheckbox = new Checkbox(preciseEndDateOption, esgst.gts_preciseEndDate);
            preciseStartOption.addEventListener(`click`, function () {
                setSetting(`gts_preciseStart`, preciseStartCheckbox.input.checked);
                esgst.gts_preciseStart = preciseStartCheckbox.input.checked;
            });
            preciseEndOption.addEventListener(`click`, function () {
                setSetting(`gts_preciseEnd`, preciseEndCheckbox.input.checked);
                esgst.gts_preciseEnd = preciseEndCheckbox.input.checked;
            });
            preciseStartDateOption.addEventListener(`click`, function () {
                setSetting(`gts_preciseStartDate`, preciseStartDateCheckbox.input.checked);
                esgst.gts_preciseStartDate = preciseStartDateCheckbox.input.checked;
            });
            preciseEndDateOption.addEventListener(`click`, function () {
                setSetting(`gts_preciseEndDate`, preciseEndDateCheckbox.input.checked);
                esgst.gts_preciseEndDate = preciseEndDateCheckbox.input.checked;
            });
            set = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save Template`, `Saving...`, function (callback) {
                var i, n, template, savedTemplates, startDate, endDate;
                if (input.value) {
                    warning.classList.add(`esgst-hidden`);
                    startDate = new Date(document.querySelector(`[name="start_time"]`).value);
                    startTime = startDate.getTime();
                    endDate = new Date(document.querySelector(`[name="end_time"]`).value);
                    endTime = endDate.getTime();
                    delay = startTime - Date.now();
                    if (delay < 0) {
                        delay = 0;
                    }
                    template = {
                        countries: document.querySelector(`[name="country_item_string"]`).value.trim(),
                        delay: delay,
                        description: document.querySelector(`[name="description"]`).value,
                        duration: endTime - startTime,
                        groups: document.querySelector(`[name="group_item_string"]`).value.trim(),
                        level: document.querySelector(`[name="contributor_level"]`).value,
                        name: input.value,
                        region: document.querySelector(`[name="region_restricted"]`).value,
                        type: document.querySelector(`[name="who_can_enter"]`).value,
                        whitelist: document.querySelector(`.form__row--who-can-enter [name="whitelist"]`).value
                    };
                    if (preciseStartCheckbox.input.checked) {
                        template.startTime = startTime;
                    }
                    if (preciseEndCheckbox.input.checked) {
                        template.endTime = endTime;
                    }
                    if (preciseStartDateCheckbox.input.checked) {
                        template.startDate = {
                            day: startDate.getDate(),
                            month: startDate.getMonth(),
                            year: startDate.getFullYear()
                        };
                    }
                    if (preciseEndDateCheckbox.input.checked) {
                        template.endDate = {
                            day: endDate.getDate(),
                            month: endDate.getMonth(),
                            year: endDate.getFullYear()
                        };
                    }
                    createLock(`templateLock`, 300, function(deleteLock) {
                        getValue(`templates`, `[]`).then(value => {
                            savedTemplates = JSON.parse(value);
                            for (i = 0, n = savedTemplates.length; i < n && savedTemplates[i].name !== template.name; ++i);
                            if (i < n) {
                                if (edit) {
                                    savedTemplates[i] = template;
                                    message.classList.remove(`esgst-hidden`);
                                    setTimeout(function () {
                                        message.classList.add(`esgst-hidden`);
                                    }, 2000);
                                } else if (confirm(`There already exists a template with this name. Do you want to overwrite it?`)) {
                                    savedTemplates[i] = template;
                                    message.classList.remove(`esgst-hidden`);
                                    setTimeout(function () {
                                        message.classList.add(`esgst-hidden`);
                                    }, 2000);
                                }
                            } else {
                                savedTemplates.push(template);
                                message.classList.remove(`esgst-hidden`);
                                setTimeout(function () {
                                    message.classList.add(`esgst-hidden`);
                                }, 2000);
                            }
                            return setValue(`templates`, JSON.stringify(savedTemplates));
                        }).then(() => {
                            deleteLock();
                            callback();
                        });
                    });
                } else {
                    warning.classList.remove(`esgst-hidden`);
                    callback();
                }
            });
            section.appendChild(set.set);
            rows.insertBefore(createGiveawayButton.set, rows.firstElementChild);
            rows.insertBefore(reviewButton, rows.firstElementChild);
            createGiveawayButton.set.style.display = `inline-block`;
            createGiveawayButton.set.style.margin = `20px 5px`;
            reviewButton.style.margin = `20px 0`;
            var first, last;
            first = true;
            last = false;
            addEventListener(`scroll`, function () {
                if (scrollY < 138) {
                    if (!first) {
                        rows.insertBefore(createGiveawayButton.set, rows.firstElementChild);
                        rows.insertBefore(reviewButton, rows.firstElementChild);
                        createGiveawayButton.set.style.margin = `20px 5px`;
                        reviewButton.style.margin = `20px 0`;
                        first = true;
                        last = false;
                    }
                } else if (!last) {
                    rows.appendChild(reviewButton);
                    rows.appendChild(createGiveawayButton.set);
                    reviewButton.style.margin = ``;
                    createGiveawayButton.set.style.margin = `0 5px`;
                    last = true;
                    first = false;
                }
            });
        }

        function setGtsTemplate(popup, template, savedTemplate) {
            var applyButton, deleteButton, i, n, savedTemplates;
            applyButton = template.firstElementChild;
            deleteButton = applyButton.nextElementSibling;
            applyButton.addEventListener(`click`, function () {
                applyGtsTemplate(savedTemplate);
                input.value = savedTemplate.name;
                edit = true;
                popup.close();
            });
            deleteButton.addEventListener(`click`, function () {
                deleteButton.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                `;
                createLock(`templateLock`, 300, function (deleteLock) {
                    getValue(`templates`, `[]`).then(value => {
                        savedTemplates = JSON.parse(value);
                        for (i = 0, n = savedTemplates.length; i < n && savedTemplates[i].name !== savedTemplate.name; ++i);
                        savedTemplates.splice(i, 1);
                        return setValue(`templates`, JSON.stringify(savedTemplates));
                    }).then(() => {
                        deleteLock();
                        deleteButton.innerHTML = `
                            <i class="fa fa-trash"></i>
                        `;
                        template.classList.add(`esgst-hidden`);
                        deletedTemplates.push({
                            template: template,
                            savedTemplate: savedTemplate
                        });
                        undo.classList.remove(`esgst-hidden`);
                        edit = false;
                    });
                });
            });
        }

        function undoGtsDelete() {
            var deletedTemplate;
            deletedTemplate = deletedTemplates.pop();
            deletedTemplate.template.classList.remove(`esgst-hidden`);
            deletedTemplate.template.parentElement.appendChild(deletedTemplate.template);
            getValue(`templates`, `[]`).then(value => {
                savedTemplates = JSON.parse(value);
                savedTemplates.push(deletedTemplate.savedTemplate);
                return setValue(`templates`, JSON.stringify(savedTemplates));
            }).then(() => {
                if (deletedTemplates.length === 0) {
                    undo.classList.add(`esgst-hidden`);
                }
            });
        }
    }

    function applyGtsTemplate(savedTemplate) {
        var context, countries, currentDate, days, endTime, groups, i, id, j, matches, n, newEndTime, newEndTimeBackup, newStartTime, startTime, selected;
        currentDate = new Date();
        if (savedTemplate.edit) {
            document.querySelector(`[name="start_time"]`).value = savedTemplate.startTime;
            document.querySelector(`[name="end_time"]`).value = savedTemplate.endTime;
        } else {
            if (savedTemplate.startTime && savedTemplate.endTime) {
                startTime = new Date(savedTemplate.startTime);
                newStartTime = new Date(currentDate.getTime());
                newStartTime.setHours(startTime.getHours(), startTime.getMinutes(), startTime.getSeconds(), startTime.getMilliseconds());
                if (newStartTime.getTime() < currentDate.getTime()) {
                    newStartTime.setDate(newStartTime.getDate() + 1);
                }
                endTime = new Date(savedTemplate.endTime);
                newEndTime = new Date(newStartTime.getTime());
                if (endTime.getMonth() !== startTime.getMonth()) {
                    days = (new Date(startTime.getFullYear(), startTime.getMonth() + 1, 0).getDate()) - newStartTime.getDate() + endTime.getDate();
                } else {
                    days = endTime.getDate() - startTime.getDate();
                }
                newEndTime.setDate(newStartTime.getDate() + days);
                newEndTime.setHours(endTime.getHours(), endTime.getMinutes(), endTime.getSeconds(), endTime.getMilliseconds());
                document.querySelector(`[name="start_time"]`).value = formatDate(newStartTime);
                document.querySelector(`[name="end_time"]`).value = formatDate(newEndTime);
            } else if (savedTemplate.startTime) {
                startTime = new Date(savedTemplate.startTime);
                newStartTime = new Date(currentDate.getTime());
                newStartTime.setHours(startTime.getHours(), startTime.getMinutes(), startTime.getSeconds(), startTime.getMilliseconds());
                if (newStartTime.getTime() < currentDate.getTime()) {
                    newStartTime.setDate(newStartTime.getDate() + 1);
                }
                newEndTime = new Date(newStartTime.getTime() + savedTemplate.duration);
                document.querySelector(`[name="start_time"]`).value = formatDate(newStartTime);
                document.querySelector(`[name="end_time"]`).value = formatDate(newEndTime);
            } else if (savedTemplate.endTime) {
                endTime = new Date(savedTemplate.endTime);
                newStartTime = new Date(currentDate.getTime() + savedTemplate.delay);
                newEndTime = new Date(newStartTime.getTime() + savedTemplate.duration);
                newEndTime.setHours(endTime.getHours(), endTime.getMinutes(), endTime.getSeconds(), endTime.getMilliseconds());
                if (newEndTime.getTime() < newStartTime.getTime()) {
                    newEndTime.setDate(newEndTime.getDate() + 1);
                }
                document.querySelector(`[name="start_time"]`).value = formatDate(newStartTime);
                document.querySelector(`[name="end_time"]`).value = formatDate(newEndTime);
            } else {
                newStartTime = new Date(currentDate.getTime() + savedTemplate.delay);
                newEndTime = new Date(currentDate.getTime() + savedTemplate.delay + savedTemplate.duration)
                document.querySelector(`[name="start_time"]`).value = formatDate(newStartTime);
                document.querySelector(`[name="end_time"]`).value = formatDate(newEndTime);
            }
            if (savedTemplate.startDate) {
                newStartTime.setFullYear(savedTemplate.startDate.year);
                newStartTime.setMonth(savedTemplate.startDate.month);
                newStartTime.setDate(savedTemplate.startDate.day);
                document.querySelector(`[name="start_time"]`).value = formatDate(newStartTime);
            }
            if (savedTemplate.endDate) {
                newEndTime.setFullYear(savedTemplate.endDate.year);
                newEndTime.setMonth(savedTemplate.endDate.month);
                newEndTime.setDate(savedTemplate.endDate.day);
                document.querySelector(`[name="end_time"]`).value = formatDate(newEndTime);
            }
        }
        if (!savedTemplate.region.match(/^(1|0)$/)) {
            savedTemplate.region = `0`;
        }
        document.querySelector(`[data-checkbox-value="${savedTemplate.region}"]`).click();
        if (savedTemplate.countries) {
            matches = document.querySelector(`.form_list[data-input="country_item_string"]`).children;
            countries = savedTemplate.countries.trim().split(/\s/);
            for (i = matches.length - 1; i > 0; --i) {
                context = matches[i];
                id = context.getAttribute(`data-item-id`);
                selected = context.classList.contains(`is-selected`);
                j = countries.indexOf(id);
                if ((selected && j < 0) || (!selected && j >= 0)) {
                    context.click();
                }
            }
        }
        document.querySelector(`[data-checkbox-value="${savedTemplate.type}"]`).click();
        if (savedTemplate.gameName) {
            document.getElementsByClassName(`js__autocomplete-name`)[0].value = savedTemplate.gameName;
        }
        if (savedTemplate.gameId) {
            document.querySelector(`[name="game_id"]`).value = savedTemplate.gameId;
        }
        if (savedTemplate.keys) {
            document.querySelector(`[data-checkbox-value="key"]`).click();
            document.querySelector(`[name="key_string"]`).value = savedTemplate.keys;
        } else if (savedTemplate.copies) {
            document.querySelector(`[data-checkbox-value="gift"]`).click();
            document.querySelector(`[name="copies"]`).value = savedTemplate.copies;
        }
        if (savedTemplate.type === `groups`) {
            matches = document.querySelector(`.form_list[data-input="group_item_string"]`).children;
            context = matches[0];
            if ((savedTemplate.whitelist === `1` && !context.classList.contains(`is-selected`)) || (savedTemplate.whitelist !== `1` && context.classList.contains(`is-selected`))) {
                context.click();
            }
            if (savedTemplate.groups) {
                groups = savedTemplate.groups.trim().split(/\s/);
                for (i = matches.length - 1; i > 0; --i) {
                    context = matches[i];
                    id = context.getAttribute(`data-item-id`);
                    selected = context.classList.contains(`is-selected`);
                    j = groups.indexOf(id);
                    if ((selected && j < 0) || (!selected && j >= 0)) {
                        context.click();
                    }
                }
            } else {
                for (i = matches.length - 1; i > 0; --i) {
                    context = matches[i];
                    if (context.classList.contains(`is-selected`)) {
                        context.click();
                    }
                }
            }
        }
        if (savedTemplate.level > 0) {
            document.getElementsByClassName(`ui-slider-range`)[0].style.width = `${savedTemplate.level * 10}%`;
            document.getElementsByClassName(`form__level`)[0].textContent = `level ${savedTemplate.level}`;
            document.getElementsByClassName(`form__input-description--no-level`)[0].classList.add(`is-hidden`);
            document.getElementsByClassName(`form__input-description--level`)[0].classList.remove(`is-hidden`);
        } else {
            document.getElementsByClassName(`ui-slider-range`)[0].style.width = `0%`;
            document.getElementsByClassName(`form__input-description--level`)[0].classList.add(`is-hidden`);
            document.getElementsByClassName(`form__input-description--no-level`)[0].classList.remove(`is-hidden`);
        }
        document.getElementsByClassName(`ui-slider-handle`)[0].style.left = `${savedTemplate.level * 10}%`;
        document.querySelector(`[name="contributor_level"]`).value = savedTemplate.level;
        document.querySelector(`[name="description"]`).value = savedTemplate.description;
    }

    function setGtsSource(gts, name, template, event) {
        var i, n, savedTemplates;
        event.dataTransfer.setData(`text/plain`, ``);
        gts.source = template;
        getValue(`templates`, `[]`).then(value => {
            savedTemplates = JSON.parse(value);
            for (i = 0, n = savedTemplates.length; i < n && savedTemplates[i].name !== name; ++i);
            if (i < n) {
                gts.sourceIndex = i;
            }
        });
    }

    function getGtsSource(gts, template, templates) {
        var current, i;
        current = gts.source;
        i = 0;
        do {
            current = current.previousElementSibling;
            if (current && current === template) {
                gts.sourceNewIndex = i;
                templates.insertBefore(gts.source, template);
                return;
            }
            ++i;
        } while (current);
        gts.sourceNewIndex = i - 1;
        templates.insertBefore(gts.source, template.nextElementSibling);
    }

    function saveGtsSource(gts) {
        var savedTemplates;
        getValue(`templates`, `[]`).then(value => {
            savedTemplates = JSON.parse(value);
            savedTemplates.splice(gts.sourceNewIndex, 0, savedTemplates.splice(gts.sourceIndex, 1)[0]);
            setValue(`templates`, JSON.stringify(savedTemplates));
        });
    }

    /* [MGC] Multiple Giveaways Creator */

    function loadMgc() {
        if (esgst.newGiveawayPath) {
            addMgcSection();
        }
        if (esgst.newDiscussionPath) {
            if ((getLocalValue(`mgcAttach_step1`) || getLocalValue(`mgcAttach_step2`))) {
                delLocalValue(`mgcAttach_step1`);
                delLocalValue(`mgcAttach_step2`);
                addMgcCreateAndAttachButton();
            }
        } else if (esgst.editDiscussionPath) {
            if (getLocalValue(`mgcAttach_step4`)) {
                editMgcDiscussion();
            }
        } else if (esgst.discussionPath) {
            if (getLocalValue(`mgcAttach_step2`)) {
                delLocalValue(`mgcAttach_step2`);
                setLocalValue(`mgcAttach_step3`, location.pathname.match(/\/discussion\/(.+?)\//)[1]);
                request(`xsrf_token=${esgst.xsrfToken}&do=close_discussion`, null, `POST`, false, location.href, function () {
                    close();
                });
            } else if (getLocalValue(`mgcAttach_step4`)) {
                document.querySelector(`form[action="/discussions/edit"]`).submit();
            } else if (getLocalValue(`mgcAttach_step5`)) {
                delLocalValue(`mgcAttach_step5`);
                request(`xsrf_token=${esgst.xsrfToken}&do=reopen_discussion`, null, `POST`, false, location.href, function () {
                    setLocalValue(`mgcAttach_step6`, true);
                    location.reload();
                });
            } else if (getLocalValue(`mgcAttach_step6`)) {
                delLocalValue(`mgcAttach_step6`);
                new Popup(`fa-check`, `Train created with success! You can close this now.`, true).open();
            }
        }
    }

    function addMgcSection() {
        var addButton, attachButton, createButton, createTrainDescription, createTrainOption, createTrainSwitch, detach, emptyButton, exportButton, importButton, mgc, removeIcon, rows, section, shuffleButton, viewButton;
        rows = document.getElementsByClassName(`form__rows`)[0];
        if (rows) {
            mgc = {
                countries: document.querySelector(`[name="country_item_string"]`),
                gameId: document.querySelector(`[name="game_id"]`),
                gameType: document.querySelector(`[name="type"]`),
                copies: document.querySelector(`[name="copies"]`),
                keys: document.querySelector(`[name="key_string"]`),
                startTime: document.querySelector(`[name="start_time"]`),
                endTime: document.querySelector(`[name="end_time"]`),
                region: document.querySelector(`[name="region_restricted"]`),
                type: document.querySelector(`[name="who_can_enter"]`),
                whitelist: document.querySelector(`.form__row--who-can-enter [name="whitelist"]`),
                groups: document.querySelector(`[name="group_item_string"]`),
                level: document.querySelector(`[name="contributor_level"]`),
                description: document.querySelector(`[name="description"]`),
                datas: [],
                values: [],
                created: []
            };
            mgc.gameName = mgc.gameId.nextElementSibling;
            section = insertHtml(rows, `afterBegin`, `
                <div class="esgst-form-row">
                    <div class="esgst-form-heading">
                        <div class="esgst-form-heading-number">0.</div>
                        <div class="esgst-form-heading-text">
                            Create Multiple Giveaways <i class="fa fa-question-circle" title="How To Use\n
                            1. Fill the details of the giveaway (you can use templates for it).
                            2. Click 'Add Giveaway' or import giveaways.
                            3. Repeat steps 1-2 until all giveaways have been added.
                            4. Click 'Create Giveaways' and wait.\n
                            For train creations:
                            1. Enable 'Create train.'.
                            2. Fill the details of the giveaway and add the connection/counter style to the description (you can use templates for it).
                            3. Click 'Add Giveaway' or import giveaways.
                            4. Repeat steps 2-3 until all giveaways have been added.
                            5. Click 'Create Giveaways' and wait."></i>
                        </div>
                    </div>
                    <div class="esgst-gm-section esgst-form-row-indent">
                        <div>
                            <div></div>
                            <div class="esgst-hidden">
                                <div></div>
                            </div>
                        </div>
                    </div>
                </div>
            `).lastElementChild;
            createTrainOption = section.firstElementChild;
            createTrainDescription = createTrainOption.lastElementChild;
            if (esgst.mgc_createTrain) {
                createTrainDescription.classList.remove(`esgst-hidden`);
            }
            createTrainSwitch = new ToggleSwitch(createTrainOption.firstElementChild, `mgc_createTrain`, false, `Create train. <i class="fa fa-question-circle"></i>`, false, false, null, esgst.mgc_createTrain);
            createTrainSwitch.dependencies.push(createTrainDescription);
            createTooltip(createTrainSwitch.name.lastElementChild, `
                <div class="esgst-description markdown">
                    <div>Add the connection style to the description of the giveaway, wherever you want it to appear, using the format [ESGST-P]...[P]...[/P]...[/ESGST-P]...[ESGST-N]...[N]...[/N]...[/ESGST-N] or the simplified format [ESGST-P]...[/ESGST-P]...[ESGST-N]...[/ESGST-N], where [P]...[/P] and [N]...[/N] delimit the clickable link, [ESGST-P]...[/ESGST-P] and [ESGST-N]...[/ESGST-N] delimit the entire text area that includes the clickable link, and the "..." between [/ESGST-P] and [ESGST-N] delimit the separator between the links. If using the simplified format, [P]...[/P] and [N]...[/N] are not required and the entire text inside [ESGST-P]...[/ESGST-P] and [ESGST-N]...[/ESGST-N] will be turned into a link.</div>
                    <br/>
                    <div>Some examples:</div>
                    <br/>
                    <div>[ESGST-P]Previous[/ESGST-P] [ESGST-N]Next[/ESGST-N] -> Result will look like "<a href="">Previous</a> <a href="">Next</a>".</div>
                    <br/>
                    <div>### [ESGST-P] [P]Previous[/P][/ESGST-P] | [ESGST-N][N]Next[/N] [/ESGST-N] -> Result will look like " <a href="">Previous</a> | <a href="">Next</a> " in medium font size.</div>
                    <br/>
                    <div>[ESGST-P]Go [P]back[/P].[/ESGST-P] [ESGST-N]Go [N]forward[/N].[/ESGST-N] -> Result will look like "Go <a href="">back</a>. Go <a href="">forward</a>.".</div>
                    <br/>
                    <div>You can also add a counter style to the description, using the format [ESGST-C]...[/ESGST-C], where "..." delimits the separator between the numbers.</div>
                    <br/>
                    <div>Some examples:</div>
                    <br/>
                    <div>[ESGST-C] of [/ESGST-C] -> Result will look like "2 of 10".</div>
                    <br/>
                    <div>[ESGST-C]/[/ESGST-C] -> Result will look like "2/10".</div>
                    <br/>
                    <div>An example merging the connection with the counter:</div>
                    <br/>
                    <div>[ESGST-P]Previous[/ESGST-P] [ESGST-N]Next[/ESGST-N] ([ESGST-C] of [/ESGST-C]) -> Result will look like "<a href="">Previous</a> <a href="">Next</a> (2 of 10)".</div>
                </div>
            `);
            new ToggleSwitch(createTrainDescription.firstElementChild, `mgc_removeLinks`, false, `Remove previous/next links from the first/last wagons.`, false, false, `Disabling this keeps the links as plain text.`, esgst.mgc_removeLinks);
            mgc.editButton = new ButtonSet(`green`, `grey`, `fa-edit`, `fa-circle-o-notch fa-spin`, `Edit`, `Editing...`, getMgcValues.bind(null, true, mgc));
            mgc.editButton.set.classList.add(`esgst-hidden`);
            addButton = new ButtonSet(`green`, `grey`, `fa-plus-circle`, `fa-circle-o-notch fa-spin`, `Add`, `Adding...`, getMgcValues.bind(null, false, mgc));
            importButton = new ButtonSet(`green`, `grey`, `fa-arrow-circle-up`, `fa-circle-o-notch fa-spin`, `Import`, `Importing...`, importMgcGiveaways.bind(null, mgc));
            exportButton = new ButtonSet(`green`, `grey`, `fa-arrow-circle-down`, `fa-circle-o-notch fa-spin`, `Export`, `Exporting...`, exportMgcGiveaways.bind(null, mgc));
            shuffleButton = new ButtonSet(`green`, `grey`, `fa-random`, `fa-circle-o-notch fa-spin`, `Shuffle`, `Shuffling...`, shuffleMgcGiveaways.bind(null, mgc));
            emptyButton = new ButtonSet(`green`, `grey`, `fa-trash`, `fa-circle-o-notch fa-spin`, `Empty`, `Emptying...`, emptyMgcGiveaways.bind(null, mgc));
            attachButton = new ButtonSet(`green`, `grey`, `fa-paperclip`, `fa-circle-o-notch fa-spin`, `Attach Discussion`, `Attaching...`, attachMgcDiscussion.bind(null, mgc));
            createTrainSwitch.dependencies.push(attachButton.set);
            if (!esgst.mgc_createTrain) {
                attachButton.set.classList.add(`esgst-hidden`);
            }
            viewButton = new ButtonSet(`green`, `grey`, `fa-eye`, `fa-circle-o-notch fa-spin`, `View Results`, `Opening...`, viewMgcResults.bind(null, mgc));
            createButton = new ButtonSet(`green`, `grey`, `fa-arrow-circle-right`, `fa-circle-o-notch fa-spin`, `Create`, `Creating...`, createMgcGiveaways.bind(null, mgc, viewButton));
            viewButton.set.classList.add(`esgst-hidden`);
            section.appendChild(mgc.editButton.set);
            section.appendChild(addButton.set);
            section.appendChild(importButton.set);
            section.appendChild(exportButton.set);
            section.appendChild(shuffleButton.set);
            section.appendChild(emptyButton.set);
            section.appendChild(attachButton.set);
            section.appendChild(createButton.set);
            section.appendChild(viewButton.set);
            mgc.discussionPanel = insertHtml(section, `beforeEnd`, `
                <div class="esgst-hidden">
                    <span class="esgst-bold">Discussion Attached:</span> <a></a> <i class="esgst-clickable fa fa-times" title="Detach discussion"></i>
                </div>
            `);
            detach = mgc.discussionPanel.lastElementChild;
            detach.addEventListener(`click`, detachMgcDiscussion.bind(null, mgc));
            mgc.discussionLink = detach.previousElementSibling;
            new ToggleSwitch(mgc.discussionPanel, `mgc_bumpLast`, false, `Only insert the bump link in the last wagon.`, false, false, `If disabled, the bump link will appear on all wagons.`, esgst.mgc_bumpLast);
            mgc.giveaways = insertHtml(section, `beforeEnd`, `
                <div class="pinned-giveaways__outer-wrap">
                    <div class="pinned-giveaways__inner-wrap"></div>
                    <i class="fa fa-trash" title="Drag a giveaway here to remove it"></i>
                    <div class="esgst-description">To edit a giveaway, click on it and a "Edit" button will appear. Then make your alterations and click "Edit".</div>
                    <div class="esgst-description">Giveaways successfully created will turn green, giveaways successfully connected will be strikethrough (for train creations) and giveaways that were not successfully created will turn red.</div>
                </div>
            `).firstElementChild;
            removeIcon = mgc.giveaways.nextElementSibling;
            removeIcon.addEventListener(`dragenter`, removeMgcGiveaway.bind(null, mgc));
            JSON.parse(getLocalValue(`mgcCache`, `[]`)).forEach(values => {
                addMgcGiveaway(false, mgc, values);
            });
        }
    }

    function getMgcValues(edit, mgc, callback) {
        var cache, values;
        values = {
            gameId: mgc.gameId.value,
            gameType: mgc.gameType.value,
            copies: mgc.copies.value,
            keys: mgc.keys.value
        };
        if (values.gameId && ((values.gameType === `gift` && parseInt(values.copies) > 0) || (values.gameType === `key` && values.keys))) {
            esgst.busy = true;
            values.countries = mgc.countries.value.trim();
            values.gameName = mgc.gameName.value;
            values.startTime = mgc.startTime.value;
            values.endTime = mgc.endTime.value;
            values.region = mgc.region.value;
            values.type = mgc.type.value;
            values.whitelist = mgc.whitelist.value;
            values.groups = mgc.groups.value.trim();
            values.level = mgc.level.value;
            values.description = mgc.description.value;
            if ((esgst.mgc_createTrain && mgc.description.value.match(/\[ESGST-P\]|\[ESGST-N\]/)) || !esgst.mgc_createTrain) {
                if ((mgc.discussion && mgc.description.value.match(/\[ESGST-B\]/)) || !mgc.discussion) {
                    addMgcGiveaway(edit, mgc, values);
                    updateMgcCache(mgc);
                    mgc.copies.value = `1`;
                    mgc.keys.value = ``;
                } else {
                    createAlert(`The bump link format is missing from the description.`);
                }
            } else {
                createAlert(`The next/previous links format is missing from the description.`);
            }
        } else {
            createAlert(`You must first fill the details of the giveaway.`);
        }
        callback();
    }

    function addMgcGiveaway(edit, mgc, values) {
        var data, details;
        details = `${values.gameName.replace(/"/g, `&quot;`)}\n`;
        if (values.gameType === `gift`) {
            details += `Gift\n${values.copies} Copies\n`;
        } else {
            details += `Keys\n${values.keys}\n`;
        }
        details += `\n${values.startTime} - ${values.endTime}\n`;
        if (values.region !== `0`) {
            details += `Region Restricted\n`;
        }
        if (values.type === `everyone`) {
            details += `Public\n`;
        } else if (values.type === `invite_only`) {
            details += `Invite Only\n`;
        } else {
            if (values.whitelist === `1`) {
                details += `Whitelist\n`;
            }
            if (values.groups.trim()) {
                details += `Groups\n`;
            }
        }
        details += `Level ${values.level}\n\n${values.description}`;
        data = `xsrf_token=${esgst.xsrfToken}&next_step=3&game_id=${values.gameId}&type=${values.gameType}&copies=${values.copies}&key_string=${values.keys}&start_time=${values.startTime}&end_time=${values.endTime}&region_restricted=${values.region}&country_item_string=${values.countries}&who_can_enter=${values.type}&whitelist=${values.whitelist}&group_item_string=${values.groups}&contributor_level=${values.level}&description=${encodeURIComponent(values.description)}`;
        if (edit) {
            mgc.datas[mgc.editPos] = data;
            mgc.values[mgc.editPos] = values;
            mgc.giveaways.children[mgc.editPos].title = details;
            mgc.editButton.set.classList.add(`esgst-hidden`);
        } else {
            mgc.datas.push(data);
            mgc.values.push(values);
            setMgcGiveaway(insertHtml(mgc.giveaways, `beforeEnd`, `
                <div class="esgst-gm-giveaway" draggable="true" title="${details}">${mgc.datas.length}</div>
            `), mgc);
        }
    }

    function setMgcGiveaway(giveaway, mgc) {
        giveaway.addEventListener(`click`, setMgcValues.bind(null, giveaway, mgc))
        giveaway.addEventListener(`dragstart`, setMgcSource.bind(null, giveaway, mgc));
        giveaway.addEventListener(`dragenter`, getMgcSource.bind(null, giveaway, mgc));
    }

    function setMgcValues(giveaway, mgc) {
        var pos, values;
        pos = parseInt(giveaway.textContent) - 1;
        values = mgc.values[pos];
        mgc.countries.value = values.countries;
        mgc.gameId.value = values.gameId;
        mgc.gameType.value = values.gameType;
        mgc.copies.value = values.copies;
        mgc.keys.value = values.keys;
        mgc.gameName.value = values.gameName;
        mgc.startTime.value = values.startTime;
        mgc.endTime.value = values.endTime;
        mgc.region.value = values.region;
        mgc.type.value = values.type;
        mgc.whitelist.value = values.whitelist;
        mgc.groups.value = values.groups;
        mgc.level.value = values.level;
        mgc.description.value = values.description;
        values.edit = true;
        applyGtsTemplate(values);
        mgc.editPos = pos;
        mgc.editButton.set.classList.remove(`esgst-hidden`);
    }

    function setMgcSource(giveaway, mgc, event) {
        mgc.source = giveaway;
        event.dataTransfer.setData(`text/plain`, ``);
    }

    function getMgcSource(giveaway, mgc) {
        var current;
        current = mgc.source;
        do {
            current = current.previousElementSibling;
            if (current && current === giveaway) {
                mgc.giveaways.insertBefore(mgc.source, giveaway);
                updateMgcCache(mgc);
                return;
            }
        } while (current);
        mgc.giveaways.insertBefore(mgc.source, giveaway.nextElementSibling);
        updateMgcCache(mgc);
    }

    function importMgcGiveaways(mgc, callback) {
        var counter, popup, progress, progressPanel, textArea;
        popup = new Popup(`fa-arrow-up`, `Import Giveaways`, true);
        popup.popup.classList.add(`esgst-popup-large`);
        popup.description.insertAdjacentHTML(`afterBegin`, `
            <div class="esgst-description">
                Insert the keys below. <i class="fa fa-question-circle"></i>
            </div>
        `);
        createTooltip(popup.description.firstElementChild.lastElementChild, `
            <div>Before importing, make sure you have filled the details of the giveaway (time, region, whitelist, group, level and description) or applied a template. Having different details for each giveaway is currently not supported.</div>
            <br/>
            <div>Separate giveaways with a new line. For gift giveaways, write the name of the game (exactly like it is on Steam) and the number of copies (only required if bigger than 1) in the format "(X Copies)" without the quotes and separated from the name of the game by a single space. For key giveaways, write the name of the game (exactly like it is on Steam) and put the key after or before the name of the game, separated from the name of the game by a single space (Steam and HumbleBundle gift links are supported and work just like the keys, but they must start with "http://" or "https://" to be detected). Here's an example:</div>
            <br/>
            <div>Portal</div>
            <div>ABCDE-FGHIJ-KLMNO Portal</div>
            <div>Portal ABCDE-FGHIJ-PQRST</div>
            <div>Portal (2 Copies)</div>
            <div>Portal ABCDE-FGHIJ-UVWXY</div>
            <br/>
            <div>In the example above, 5 giveaways will be created (one for each line) if the option to group keys is disabled. But if the option is enabled, only 4 giveaways will be created, because the two adjacent (next to each other) Portal keys will be grouped in a single giveaway. Note that the last Portal key will not grouped, as it is not adjacent to the other keys.</div>
            <br/>
            <div>You can also put keys in front of each other, separated by a space. The below will generate the same result as above:</div>
            <br/>
            <div>Portal</div>
            <div>Portal ABCDE-FGHIJ-KLMNO ABCDE-FGHIJ-PQRST</div>
            <div>Portal (2 Copies)</div>
            <div>Portal ABCDE-FGHIJ-UVWXY</div>
        `);
        new ToggleSwitch(popup.description, `mgc_groupKeys`, false, `Group adjacent keys for the same game.`, false, false, ``, esgst.mgc_groupKeys);
        textArea = insertHtml(popup.scrollable, `beforeEnd`, `
            <textarea></textarea>
        `);
        progressPanel = insertHtml(popup.description, `beforeEnd`, `
            <div>
                <div class="esgst-progress-bar"></div>
                <div>
                    <span>0</span> of <span>0</span> giveaways imported.
                </div>
            </div>
        `);
        progress = {
            bar: progressPanel.firstElementChild,
        };
        counter = progressPanel.lastElementChild;
        progress.current = counter.firstElementChild;
        progress.total = progress.current.nextElementSibling;
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-arrow-circle-up`, `fa-circle-o-notch fa-spin`, `Import`, `Importing...`, getMgcGiveaways.bind(null, mgc, popup, progress, textArea)).set);
        popup.onClose = callback;
        popup.open(focusMgcTextArea.bind(null, textArea));
        textArea.style.height = `${innerHeight * 0.9 - (popup.popup.offsetHeight - popup.scrollable.offsetHeight) - 25}px`;
        textArea.style.overflow = `auto`;
        textArea.addEventListener(`paste`, resizeMgcTextArea.bind(null, popup, textArea));
    }

    function resizeMgcTextArea(popup, textArea) {
        var interval, value;
        value = textArea.value;
        interval = setInterval(function () {
            if (value !== textArea.value) {
                clearInterval(interval);
                textArea.style.height = `${innerHeight * 0.9 - (popup.popup.offsetHeight - popup.scrollable.offsetHeight) - 25}px`;
                textArea.style.overflow = `auto`;
            }
        }, 250);
    }

    function getMgcGiveaways(mgc, popup, progress, textArea, callback) {
        var giveaways, lines, max, n, value;
        if ((esgst.mgc_createTrain && mgc.description.value.match(/\[ESGST-P\]|\[ESGST-N\]/)) || !esgst.mgc_createTrain) {
            if ((mgc.discussion && mgc.description.value.match(/\[ESGST-B\]/)) || !mgc.discussion) {
                esgst.busy = true;
                giveaways = [];
                lines = textArea.value.trim().split(/\n/);
                for (i = 0, n = lines.length; i < n; ++i) {
                    line = lines[i].trim();
                    if (line) {
                        giveaways.push(line);
                    }
                }
                textArea.value = giveaways.join(`\n`);
                n = giveaways.length;
                if ($(progress.bar).progressbar(`instance`)) {
                    max = $(progress.bar).progressbar(`option`, `max`);
                    value = $(progress.bar).progressbar(`option`, `value`);
                    if (value + n !== max) {
                        $(progress.bar).progressbar({
                            max: value + n,
                            value: value
                        });
                        progress.total.textContent = value + n;
                    }
                } else {
                    $(progress.bar).progressbar({
                        max: n
                    });
                    progress.total.textContent = n;
                }
                importMgcGiveaway(giveaways, 0, mgc, n, popup, progress, textArea, () => {
                    updateMgcCache(mgc);
                    popup.close();
                }, callback);
            } else {
                createAlert(`The bump link format is missing from the description.`);
                callback();
            }
        } else {
            createAlert(`The next/previous links format is missing from the description.`);
            callback();
        }
    }

    function importMgcGiveaway(giveaways, i, mgc, n, popup, progress, textArea, mainCallback, callback) {
        var copies, found, giveaway, j, key, keyPos, match, name, namePos, regExp, values;
        if (i < n) {
            match = giveaways[i].match(/^(([\d\w]{5}(-[\d\w]{5}){2,}\s?|https?:\/\/.+?\s?)+)\s(.+)$/);
            if (match) {
                key = true;
                keyPos = 1;
                namePos = 4;
            } else {
                match = giveaways[i].match(/^(.+?)\s(([\d\w]{5}(-[\d\w]{5}){2,}\s?|https?:\/\/.+?\s?)+)$/);
                if (match) {
                    key = true;
                    keyPos = 2;
                    namePos = 1;
                } else {
                    match = giveaways[i].match(/^(.+?)(\s\((\d+?)\sCopies\))?$/);
                    if (match) {
                        key = false;
                        namePos = 1;
                    }
                }
            }
            if (match) {
                name = match[namePos];
                values = {
                    countries: mgc.countries.value.trim(),
                    gameName: name,
                    startTime: mgc.startTime.value,
                    endTime: mgc.endTime.value,
                    region: mgc.region.value,
                    type: mgc.type.value,
                    whitelist: mgc.whitelist.value,
                    groups: mgc.groups.value.trim(),
                    level: mgc.level.value,
                    description: mgc.description.value
                };
                if (key) {
                    values.gameType = `key`;
                    values.keys = match[keyPos].replace(/\s/g, `\n`);
                } else {
                    values.gameType = `gift`;
                    copies = match[3];
                    if (copies) {
                        values.copies = copies;
                    } else {
                        values.copies = `1`;
                    }
                }
                j = 1;
                if (esgst.mgc_groupKeys && key) {
                    do {
                        found = false;
                        giveaway = giveaways[i + 1];
                        if (giveaway) {
                            match = giveaway.match(/^(([\d\w]{5}(-[\d\w]{5}){2,}\s?|https?:\/\/.+?\s?)+)\s(.+)$/);
                            if (match) {
                                key = true;
                                keyPos = 1;
                                namePos = 4;
                            } else {
                                match = giveaway.match(/^(.+?)\s(([\d\w]{5}(-[\d\w]{5}){2,}\s?|https?:\/\/.+?\s?)+)$/);
                                if (match) {
                                    key = true;
                                    keyPos = 2;
                                    namePos = 1;
                                } else {
                                    key = false;
                                }
                            }
                            if (match && key && match[namePos] === name) {
                                found = true;
                                values.keys += `\n${match[keyPos].replace(/\s/g, `\n`)}`;
                                ++i;
                                ++j;
                            }
                        }
                    } while (found);
                }
                request(`do=autocomplete_giveaway_game&page_number=1&search_query=${encodeURIComponent(name)}`, null, `POST`, false, `/ajax.php`, getMgcGiveaway.bind(null, giveaways, i, j, mgc, n, name, popup, progress, textArea, values, mainCallback, callback));
            } else {
                createAlert(`The next giveaway is not in the right format. Please correct it and click on "Import" again to continue importing.`);
                callback();
            }
        } else {
            mainCallback();
        }
    }

    function getMgcGiveaway(giveaways, i, j, mgc, n, name, popup, progress, textArea, values, mainCallback, callback, response) {
        var cache, elements, k, numElements, value;
        elements = parseHtml(JSON.parse(response.responseText).html).getElementsByClassName(`table__row-outer-wrap`);
        for (k = 0, numElements = elements.length; k < numElements && elements[k].getAttribute(`data-autocomplete-name`) !== name; ++k);
        if (k < numElements) {
            values.gameId = elements[k].getAttribute(`data-autocomplete-id`);
            addMgcGiveaway(false, mgc, values);
            value = $(progress.bar).progressbar(`option`, `value`) + j;
            $(progress.bar).progressbar(`option`, `value`, value);
            progress.current.textContent = value;
            do {
                textArea.value = textArea.value.replace(/^(.+?)\n/, ``);
                --j;
            } while (j > 0);
            setTimeout(importMgcGiveaway, 0, giveaways, ++i, mgc, n, popup, progress, textArea, mainCallback, callback);
        } else {
            createAlert(`${name} was not found! Please correct the title of the game and click on "Import" again to continue importing (it must be exactly like on Steam).`);
            callback();
        }
    }

    function focusMgcTextArea(textArea) {
        textArea.focus();
    }

    function exportMgcGiveaways(mgc, mainCallback) {
        var anchor, file, i, j, n, name, popup, url, values;
        popup = new Popup(`fa-arrow-down`, `Export`);
        new ToggleSwitch(popup.description, `mgc_reversePosition`, false, `Export keys in reverse position (before the name of the game).`, false, false, ``, esgst.mgc_reversePosition);
        popup.description.appendChild(new ButtonSet(`green`, ``, `fa-arrow-down`, ``, `Export`, ``, function (callback) {
            file = ``;
            for (i = 0, n = mgc.giveaways.children.length; i < n; ++i) {
                values = mgc.giveaways.children[i].title.split(/\n/);
                if (values[1] === `Gift`) {
                    if (parseInt(values[2].match(/\d+/)[0]) > 1) {
                        file += `${values[0]} (${values[2]})\r\n`;
                    } else {
                        file += `${values[0]}\r\n`;
                    }
                } else {
                    for (j = 2; values[j]; ++j) {
                        if (esgst.mgc_reversePosition) {
                            file += `${values[j]} ${values[0]}\r\n`;
                        } else {
                            file += `${values[0]} ${values[j]}\r\n`;
                        }
                    }
                }
            }
            anchor = document.createElement(`a`);
            anchor.download = `giveaways.txt`;
            url = URL.createObjectURL(new Blob([file]));
            anchor.href = url;
            document.body.appendChild(anchor);
            anchor.click();
            anchor.remove();
            URL.revokeObjectURL(url);
            callback();
            mainCallback();
        }).set);
        popup.onClose = mainCallback;
        popup.open();
    }

    function emptyMgcGiveaways(mgc, callback) {
        if (confirm(`Are you sure you want to empty the creator?`)) {
            delLocalValue(`mgcCache`);
            esgst.busy = false;
            mgc.datas = [];
            mgc.values = [];
            mgc.created = [];
            mgc.giveaways.innerHTML = ``;
            mgc.copies.value = `1`;
            mgc.keys.value = ``;
        }
        callback();
    }

    function createMgcGiveaways(mgc, viewButton, callback) {
        if ((esgst.mgc_createTrain && mgc.description.value.match(/\[ESGST-P\]|\[ESGST-N\]/)) || !esgst.mgc_createTrain) {
            if ((mgc.discussion && mgc.description.value.match(/\[ESGST-B\]/)) || !mgc.discussion) {
                mgc.copies.value = `1`;
                mgc.keys.value = ``;
                viewButton.set.classList.add(`esgst-hidden`);
                mgc.saveGiveaways = {};
                createMgcGiveaway(0, mgc, mgc.giveaways.children.length, esgst.cewgd || (esgst.gc && esgst.gc_gi) || esgst.lpv || esgst.rcvc ? saveMgcGiveaways.bind(null, mgc, completeMgcCreation.bind(null, mgc, viewButton, callback)) : completeMgcCreation.bind(null, mgc, viewButton, callback));
            } else {
                createAlert(`The bump link format is missing from the description.`);
                callback();
            }
        } else {
            createAlert(`The next/previous links format is missing from the description.`);
            callback();
        }
    }

    function createMgcGiveaway(i, mgc, n, callback) {
        var j, popup;
        if (i < n) {
            if (!mgc.giveaways.children[i].classList.contains(`success`)) {
                j = parseInt(mgc.giveaways.children[i].textContent) - 1;
                if (j > 0 && mgc.datas[j].replace(/key_string=(.*?)&/, ``).replace(/copies=(.*?)&/, ``) === mgc.datas[j - 1].replace(/key_string=(.*?)&/, ``).replace(/copies=(.*?)&/, ``)) {
                    popup = new Popup(`fa-circle-o-notch fa-spin`, `Waiting 2 minutes to create another identical giveaway...`, true);
                    popup.open();
                    setTimeout(() => {
                        popup.close();
                        request(mgc.datas[j].replace(/start_time=(.+?)&/, correctMgcTime), null, `POST`, false, `/giveaways/new`, checkMgcCreation.bind(null, i, mgc, n, callback));
                    }, 120000);
                } else {
                    request(mgc.datas[j].replace(/start_time=(.+?)&/, correctMgcTime), null, `POST`, false, `/giveaways/new`, checkMgcCreation.bind(null, i, mgc, n, callback));
                }
            } else {
                setTimeout(createMgcGiveaway, 0, ++i, mgc, n, callback);
            }
        } else if (esgst.mgc_createTrain) {
            createMgcTrain(0, mgc, mgc.created.length, callback);
        } else {
            callback();
        }
    }

    function correctMgcTime(fullMatch, match1) {
        if ((new Date(match1).getTime()) < Date.now()) {
            return `start_time=${formatDate(new Date())}&`;
        } else {
            return fullMatch;
        }
    }

    function checkMgcCreation(i, mgc, n, callback, response) {
        var errors, errorsTitle, giveaway, j, numErrors, responseHtml;
        giveaway = mgc.giveaways.children[i];
        if (response.finalUrl.match(/\/giveaways\/new/)) {
            giveaway.classList.add(`error`);
            errors = parseHtml(response.responseText).getElementsByClassName(`form__row__error`);
            errorsTitle = `Errors:\n`;
            for (j = 0, numErrors = errors.length; j < numErrors; ++j) {
                errorsTitle += `${errors[j].textContent}\n`;
            }
            errorsTitle += `\n`;
            giveaway.title = `${errorsTitle}${giveaway.title}`;
            setTimeout(createMgcGiveaway, 0, ++i, mgc, n, callback);
        } else {
            giveaway.classList.add(`success`);
            responseHtml = parseHtml(response.responseText);
            mgc.created.push({
                giveaway: giveaway,
                html: buildGiveaway(responseHtml, response.finalUrl).html,
                url: response.finalUrl
            });
            if (esgst.cewgd || (esgst.gc && esgst.gc_gi) || esgst.lpv || esgst.rcvc) {
                getGiveaways(responseHtml, false, response.finalUrl).then(giveaways => {
                    giveaway = giveaways[0];
                    if (giveaway) {
                        mgc.saveGiveaways[giveaway.code] = giveaway;
                    }
                    setTimeout(createMgcGiveaway, 0, ++i, mgc, n, callback);
                });
            } else {                
                setTimeout(createMgcGiveaway, 0, ++i, mgc, n, callback);
            }
        }
    }

    function saveMgcGiveaways(mgc, callback) {
        var user = {
            steamId: esgst.steamId,
            username: esgst.username
        };
        var ugd;
        getUser(null, user).then(savedUser => {
            var giveaways = null;
            if (savedUser) {
                giveaways = savedUser.giveaways;
            }
            if (!giveaways) {
                giveaways = {
                    sent: {
                        apps: {},
                        subs: {}
                    },
                    won: {
                        apps: {},
                        subs: {}
                    },
                    sentTimestamp: 0,
                    wonTimestamp: 0
                };
                if (savedUser) {
                    ugd = savedUser.ugd;
                    if (ugd) {
                        if (ugd.sent) {
                            for (var key in ugd.sent.apps) {
                                giveaways.sent.apps[key] = [];
                                for (var i = 0, n = ugd.sent.apps[key].length; i < n; ++i) {
                                    mgc.saveGiveaways[ugd.sent.apps[key][i].code] = ugd.sent.apps[key][i];
                                    giveaways.sent.apps[key].push(ugd.sent.apps[key][i].code);
                                }
                            }
                            for (var key in ugd.sent.subs) {
                                giveaways.sent.subs[key] = [];
                                for (var i = 0, n = ugd.sent.subs[key].length; i < n; ++i) {
                                    mgc.saveGiveaways[ugd.sent.subs[key][i].code] = ugd.sent.subs[key][i];
                                    giveaways.sent.subs[key].push(ugd.sent.subs[key][i].code);
                                }
                            }
                            giveaways.sentTimestamp = ugd.sentTimestamp;
                        }
                        if (ugd.won) {
                            for (var key in ugd.won.apps) {
                                giveaways.won.apps[key] = [];
                                for (var i = 0, n = ugd.won.apps[key].length; i < n; ++i) {
                                    mgc.saveGiveaways[ugd.won.apps[key][i].code] = ugd.won.apps[key][i];
                                    giveaways.won.apps[key].push(ugd.won.apps[key][i].code);
                                }
                            }
                            for (var key in ugd.won.subs) {
                                giveaways.won.subs[key] = [];
                                for (var i = 0, n = ugd.won.subs[key].length; i < n; ++i) {
                                    mgc.saveGiveaways[ugd.won.subs[key][i].code] = ugd.won.subs[key][i];
                                    giveaways.won.subs[key].push(ugd.won.subs[key][i].code);
                                }
                            }
                            giveaways.wonTimestamp = ugd.wonTimestamp;
                        }
                    }
                }
            }
            for (key in mgc.saveGiveaways) {
                var giveaway = mgc.saveGiveaways[key];
                if (!giveaways.sent[giveaway.gameType][giveaway.gameSteamId]) {
                    giveaways.sent[giveaway.gameType][giveaway.gameSteamId] = [];
                }
                if (giveaways.sent[giveaway.gameType][giveaway.gameSteamId].indexOf(giveaway.code) < 0) {
                    giveaways.sent[giveaway.gameType][giveaway.gameSteamId].push(giveaway.code);
                }
            }
            user.values = {
                giveaways: giveaways
            };
            lockAndSaveGiveaways(mgc.saveGiveaways, saveUser.bind(null, null, null, user, callback));
        });
    }

    function createMgcTrain(i, mgc, n, callback) {
        if (i >= n || n - 1 === 0) {
            callback();
        } else {
            request(null, null, `GET`, false, mgc.created[i].url, createMgcWagon.bind(null, i, mgc, n, callback));
        }
    }

    function createMgcWagon(i, mgc, n, callback, response) {
        var description, id, replaceCallback, responseHtml;
        responseHtml = parseHtml(response.responseText);
        id = responseHtml.querySelector(`[name="giveaway_id"]`).value;
        description = responseHtml.querySelector(`[name="description"]`).value;
        if (i === 0) {
            mgc.firstWagon = mgc.created[i].url;
            replaceCallback = getMgcNext;
        } else if (i === n - 1) {
            replaceCallback = getMgcPrevious;
        } else {
            replaceCallback = getMgcBoth;
        }
        description = description.replace(/\[ESGST-P\](.+?)\[\/ESGST-P\](.+?)\[ESGST-N\](.+?)\[\/ESGST-N\]/g, replaceCallback.bind(null, i, mgc, false));
        description = description.replace(/\[ESGST-P\](.+?)\[\/ESGST-P\]|\[ESGST-N\](.+?)\[\/ESGST-N\]/g, replaceCallback.bind(null, i, mgc, true));
        description = description.replace(/\[ESGST-C\](.+?)\[\/ESGST-C\]/g, getMgcCounter.bind(null, i, n));
        if (mgc.discussion && (!esgst.mgc_bumpLast || i === n - 1)) {
            description = description.replace(/\[ESGST-B\](.+?)\[\/ESGST-B\]/g, `[$1](/discussion/${mgc.discussion}/)`);
        } else {
            description = description.replace(/\[ESGST-B\](.+?)\[\/ESGST-B\]/g, ``);
        }
        request(`xsrf_token=${esgst.xsrfToken}&do=edit_giveaway_description&giveaway_id=${id}&description=${encodeURIComponent(description.trim())}`, null, `POST`, false, `/ajax.php`, connectMgcWagon.bind(null, i, mgc, n, callback));
    }

    function getMgcNext(i, mgc, single, fullMatch, match1, match2, match3) {
        var match, next, nextPref, nextSuf;
        if ((single && match2) || !single) {
            match = (single ? match2 : match3).match(/(.*?)\[N\](.+?)\[\/N\](.*?)$/);
            if (match) {
                nextPref = match[1];
                next = match[2];
                nextSuf = match[3];
            } else {
                nextPref = ``;
                next = single ? match2 : match3;
                nextSuf = ``;
            }
            if (esgst.mgc_removeLinks || single) {
                return `${nextPref}[${next}](${mgc.created[i + 1].url})${nextSuf}`;
            } else {
                return `${match1}${match2}${nextPref}[${next}](${mgc.created[i + 1].url})${nextSuf}`;
            }
        } else {
            return ``;
        }
    }

    function getMgcPrevious(i, mgc, single, fullMatch, match1, match2, match3) {
        var match, prev, prevPref, prevSuf;
        if ((single && match1) || !single) {
            match = match1.match(/(.*?)\[P\](.+?)\[\/P\](.*?)$/);
            if (match) {
                prevPref = match[1];
                prev = match[2];
                prevSuf = match[3];
            } else {
                prevPref = ``;
                prev = match1;
                prevSuf = ``;
            }
            if (esgst.mgc_removeLinks || single) {
                return `${prevPref}[${prev}](${mgc.created[i - 1].url})${prevSuf}`;
            } else {
                return `${prevPref}[${prev}](${mgc.created[i - 1].url})${prevSuf}${match2}${match3}`;
            }
        } else {
            return ``;
        }
    }

    function getMgcBoth(i, mgc, single, fullMatch, match1, match2, match3) {
        var match, next, nextPref, nextSuf, prev, prevPref, prevSuf;
        if (single) {
            if (match1) {
                return getMgcPrevious(i, mgc, true, fullMatch, match1);
            } else {
                return getMgcNext(i, mgc, true, fullMatch, null, match2);
            }
        } else {
            match = match1.match(/(.*?)\[P\](.+?)\[\/P\](.*?)$/);
            if (match) {
                prevPref = match[1];
                prev = match[2];
                prevSuf = match[3];
            } else {
                prevPref = ``;
                prev = match1;
                prevSuf = ``;
            }
            match = match3.match(/(.*?)\[N\](.+?)\[\/N\](.*?)$/);
            if (match) {
                nextPref = match[1];
                next = match[2];
                nextSuf = match[3];
            } else {
                nextPref = ``;
                next = match3;
                nextSuf = ``;
            }
            return `${prevPref}[${prev}](${mgc.created[i - 1].url})${prevSuf}${match2}${nextPref}[${next}](${mgc.created[i + 1].url})${nextSuf}`;
        }
    }

    function getMgcCounter(i, n, fullMatch, match1) {
        return `${i + 1}${match1}${n}`;
    }

    function connectMgcWagon(i, mgc, n, callback) {
        mgc.created[i].giveaway.classList.add(`connected`);
        setTimeout(createMgcTrain, 0, ++i, mgc, n, callback);
    }

    function completeMgcCreation(mgc, viewButton, callback) {
        if (mgc.discussion) {
            if (mgc.created.length) {
                delLocalValue(`mgcCache`);
                setLocalValue(`mgcAttach_step4`, mgc.firstWagon);
                open(`/discussion/${mgc.discussion}/`);
                viewButton.set.classList.remove(`esgst-hidden`);
            }
            callback();
        } else {
            if (mgc.created.length) {
                delLocalValue(`mgcCache`);
                viewButton.set.classList.remove(`esgst-hidden`);
            }
            callback();
        }
    }

    function shuffleMgcGiveaways(mgc, callback) {
        let i;
        for (i = mgc.giveaways.children.length; i > -1; --i) {
            mgc.giveaways.appendChild(mgc.giveaways.children[Math.random() * i | 0]);
        }
        updateMgcCache(mgc);
        callback();
    }

    function updateMgcCache(mgc) {
        let cache, i, n;
        cache = [];
        for (i = 0, n = mgc.giveaways.children.length; i < n; ++i) {
            cache.push(mgc.values[parseInt(mgc.giveaways.children[i].textContent) - 1]);
        }
        setLocalValue(`mgcCache`, JSON.stringify(cache));
    }

    function attachMgcDiscussion(mgc, callback) {
        var input, popup;
        callback();
        popup = new Popup(`fa-comments`, `Attach discussion:`);
        popup.description.insertAdjacentHTML(`afterBegin`, `
            <div class="esgst-description">
                <div>You can attach an existing or a new discussion. To attach an existing discussion, simply enter its code below and click "Attach Existing". To attach a new discussion, simply click "Attach New".</div>
                <br/>
                <div>Use [ESGST-B][/ESGST-B] to delimit the bump link in the description of the giveaway, for example: ### [ESGST-B]Bump[/ESGST-B]</div>
                <br/>
                <div>Use [ESGST-T][/ESGST-T] to delimit the train link in the description of the discussion (this link will lead to the first giveaway of the train), for example: ### [ESGST-T]Choo choo![/ESGST-T]</div>
                <br/>
                <div>When the discussion page opens in your browser at the end of the train creation, wait until it has completely finished altering it (you will get a popup when this happens).</div>
            </div>
        `);
        input = insertHtml(popup.description, `beforeEnd`, `<input placeholder="XXXXX" type="text"/>`);
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-paperclip`, `fa-circle-o-notch fa-spin`, `Attach Existing`, `Attaching...`, attachExistingMgcDiscussion.bind(null, input, mgc, popup)).set);
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-paperclip`, `fa-circle-o-notch fa-spin`, `Attach New`, `Attaching...`, attachNewMgcDiscussion.bind(null, mgc, popup)).set);
        popup.open();
    }

    function attachExistingMgcDiscussion(input, mgc, popup, callback) {
        mgc.discussion = input.value;
        mgc.discussionPanel.classList.remove(`esgst-hidden`);
        mgc.discussionLink.href = `/discussion/${mgc.discussion}/`;
        mgc.discussionLink.textContent = mgc.discussion;
        callback();
        popup.close();
    }

    function attachNewMgcDiscussion(mgc, popup, callback) {
        var win;
        setLocalValue(`mgcAttach_step1`, true);
        win = open(`/discussions/new`);
        setTimeout(checkMgcAttached, 100, mgc, popup, win, callback);
    }

    function checkMgcAttached(mgc, popup, win, callback) {
        if (win.closed) {
            mgc.discussion = getLocalValue(`mgcAttach_step3`);
            delLocalValue(`mgcAttach_step3`);
            mgc.discussionPanel.classList.remove(`esgst-hidden`);
            mgc.discussionLink.href = `/discussion/${mgc.discussion}/`;
            mgc.discussionLink.textContent = mgc.discussion;
            callback();
            popup.close();
        } else {
            setTimeout(checkMgcAttached, 100, mgc, popup, win, callback);
        }
    }

    function addMgcCreateAndAttachButton() {
        var rows;
        rows = document.getElementsByClassName(`form__rows`)[0];
        rows.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Create & Attach`, `Creating & attaching...`, createAndAttachMgcDiscussion.bind(null, rows)).set);
    }

    function createAndAttachMgcDiscussion(rows) {
        setLocalValue(`mgcAttach_step2`, true);
        rows.parentElement.submit();
    }

    function editMgcDiscussion() {
        description = document.querySelector(`[name=description]`);
        description.value = description.value.replace(/\[ESGST-T\](.+?)\[\/ESGST-T\]/g, `[$1](${getLocalValue(`mgcAttach_step4`)})`);
        delLocalValue(`mgcAttach_step4`);
        setLocalValue(`mgcAttach_step5`, true);
        document.getElementsByClassName(`js__submit-form`)[0].click();
    }

    function detachMgcDiscussion(mgc) {
        mgc.discussion = null;
        mgc.discussionPanel.classList.add(`esgst-hidden`);
    }

    function viewMgcResults(mgc, callback) {
        var button, html, i, n, popup, toggleSwitch, url;
        popup = new Popup(`fa-eye`, `Results`);
        html = ``;
        for (i = 0, n = mgc.created.length; i < n; ++i) {
            html += mgc.created[i].html;
        }
        popup.scrollable.insertAdjacentHTML(`beforeEnd`, `
            <div class="popup__keys__list">
                ${html}
            </div>
        `);
        getGiveaways(popup.scrollable).then(giveaways => {
            if (esgst.gm) {
                esgst.gmCheckboxes = {};
                button = insertHtml(popup.scrollable, `afterBegin`, `
                    <div class="esgst-page-heading">
                        <div class="esgst-heading-button" title="Manage giveaways">
                            <span></span>
                            <i class="fa fa-gear"></i>
                        </div>
                    </div>
                `).firstElementChild;
                button.lastElementChild.addEventListener(`click`, openGmPopout.bind(null, giveaways, {
                    button: button
                }));
                toggleSwitch = new ToggleSwitch(button.firstElementChild, `gm_enable`, true, ``, false, false, null, esgst.gm_enable);
                toggleSwitch.onEnabled = enableGm.bind(null, null, giveaways);
                toggleSwitch.onDisabled = disableGm.bind(null, null, giveaways);
                if (esgst.gm_enable) {
                    enableGm(null, giveaways);
                }
            }
            popup.open();
            callback();
        });
    }

    function removeMgcGiveaway(mgc) {
        if (confirm(`Are you sure you want to remove this giveaway?`)) {
            mgc.source.remove();
            mgc.source = null;
            updateMgcCache(mgc);
        }
    }

    /* [SGAC] Stickied Giveaway Countries */

    function addSgacStickyButton(container, context, id, separator, button) {
        if (button) {
            button.remove();
        }
        button = insertHtml(context, `afterBegin`, `
            <div class="esgst-sgg-sticky-button">
                <a title="Sticky country">
                    <i class="fa fa-thumb-tack"></i>
                </a>
            </div>
        `);
        button.firstElementChild.addEventListener(`click`, (event) => {
            event.stopPropagation();
            button.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
            `;
            if (container) {
                if (context === separator) {
                    separator = separator.nextElementSibling;
                }
                container.insertBefore(context, separator);
            }
            getValue(`stickiedCountries`, `[]`).then(value => {
                let stickiedCountries = JSON.parse(value);
                if (stickiedCountries.indexOf(id) < 0) {
                    stickiedCountries.push(id);
                    setValue(`stickiedCountries`, JSON.stringify(stickiedCountries));
                }
                addSgacUnstickyButton(container, context, id, separator, button);
            });
        });
    }

    function addSgacUnstickyButton(container, context, id, separator, button) {
        if (button) {
            button.remove();
        }
        button = insertHtml(context, `afterBegin`, `
            <div class="esgst-sgg-unsticky-button">
                <a title="Unsticky country">
                    <i class="fa fa-thumb-tack"></i>
                </a>
            </div>
        `);
        button.firstElementChild.addEventListener(`click`, (event) => {
            event.stopPropagation();
            button.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
            `;
            if (container) {
                container.insertBefore(context, separator);
                separator = separator.previousElementSibling;
            }
            getValue(`stickiedCountries`, `[]`).then(value => {
                let stickiedCountries = JSON.parse(value);
                const index = stickiedCountries.indexOf(id);
                if (index >= 0) {
                    stickiedCountries.splice(index, 1);
                    setValue(`stickiedCountries`, JSON.stringify(stickiedCountries));
                }
                addSgacStickyButton(container, context, id, separator, button);
            });
        });
    }

    /* [SGG] Stickied Giveaway Groups */

    function setSggGiveawayGroups() {
        var avatar, code, container, context, elements, i, id, j, n, savedGroups, separator, stickied;
        getValue(`groups`, `[]`).then(value => {
            savedGroups = JSON.parse(value);
            container = document.querySelector(`.form_list[data-input="group_item_string"]`);
            separator = container.firstElementChild.nextElementSibling;
            elements = container.children;
            for (i = 1, n = elements.length; i < n; ++i) {
                context = elements[i];
                id = context.getAttribute(`data-item-id`);
                avatar = context.firstElementChild.style.backgroundImage;
                code = null;
                stickied = false;
                for (j = savedGroups.length - 1; j >= 0; --j) {
                    if (avatar.match(savedGroups[j].avatar)) {
                        code = savedGroups[j].code;
                        if (savedGroups[j].stickied) {
                            stickied = true;
                        }
                        break;
                    }
                }
                if (code) {
                    if (stickied) {
                        if (context === separator) {
                            separator = separator.nextElementSibling;
                        }
                        container.insertBefore(context, separator);
                        addSggUnstickyButton(code, container, context, id, separator);
                    } else {
                        addSggStickyButton(code, container, context, id, separator);
                    }
                }
            }
        });
    }

    function setSggGroups(context) {
        var avatar, code, element, elements, i, j, key, n, savedGroups, stickied;
        getValue(`groups`, `[]`).then(value => {
            savedGroups = JSON.parse(value);
            elements = context.getElementsByClassName(`table__row-inner-wrap`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                avatar = element.getElementsByClassName(`table_image_avatar`)[0].style.backgroundImage;
                stickied = false;
                for (j = savedGroups.length - 1; j >= 0; --j) {
                    if (avatar.match(savedGroups[j].avatar)) {
                        code = savedGroups[j].code;
                        if (savedGroups[j].stickied) {
                            stickied = true;
                        }
                        break;
                    }
                }
                if (code) {
                    if (stickied) {
                        addSggUnstickyButton(code, null, element);
                    } else {
                        addSggStickyButton(code, null, element);
                    }
                }
            }
        });
    }

    function addSggStickyButton(code, container, context, id, separator, button) {
        if (button) {
            button.remove();
        }
        button = insertHtml(context, `afterBegin`, `
            <div class="esgst-sgg-sticky-button">
                <a title="Sticky group">
                    <i class="fa fa-thumb-tack"></i>
                </a>
            </div>
        `);
        button.firstElementChild.addEventListener(`click`, stickySggGroup.bind(null, code, container, context, id, separator, button));
    }

    function addSggUnstickyButton(code, container, context, id, separator, button) {
        if (button) {
            button.remove();
        }
        button = insertHtml(context, `afterBegin`, `
            <div class="esgst-sgg-unsticky-button">
                <a title="Unsticky group">
                    <i class="fa fa-thumb-tack"></i>
                </a>
            </div>
        `);
        button.firstElementChild.addEventListener(`click`, unstickySggGroup.bind(null, code, container, context, id, separator, button));
    }

    function stickySggGroup(code, container, context, id, separator, button, event) {
        var groups;
        event.stopPropagation();
        button.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
        `;
        if (container) {
            if (context === separator) {
                separator = separator.nextElementSibling;
            }
            container.insertBefore(context, separator);
        }
        groups = {};
        groups[code] = {
            stickied: true
        };
        if (id) {
            groups[code].id = id;
        }
        lockAndSaveGroups(groups, false, addSggUnstickyButton.bind(null, code, container, context, id, separator, button));
    }

    function unstickySggGroup(code, container, context, id, separator, button, event) {
        var groups;
        event.stopPropagation();
        button.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
        `;
        if (container) {
            container.insertBefore(context, separator);
            separator = separator.previousElementSibling;
        }
        groups = {};
        groups[code] = {
            stickied: false
        };
        if (id) {
            groups[code].id = id;
        }
        lockAndSaveGroups(groups, false, addSggStickyButton.bind(null, code, container, context, id, separator, button));
    }

    /* [RCVC] Real CV Calculator */

    function loadRcvc() {
        if (esgst.newGiveawayPath) {
            var table = document.getElementsByClassName(`table--summary`)[0], button;
            if (table) {
                getValue(`rcvcGame`).then(value => {
                    var game = value;
                    if (game) {
                        var type = game.type;
                        var id = game.id;
                        var i, n;
                        var headings = document.getElementsByClassName(`featured__heading__small`);
                        var copies = headings.length > 1 ? parseInt(headings[0].textContent.match(/\d+/)[0]) : 1;
                        request(null, null, `GET`, false, `http://store.steampowered.com/api/${type === `apps` ? `appdetails?appids` : `packagedetails?packageids`}=${id}&cc=us&filters=price,price_overview`, response => {
                            try {
                                var responseJson = JSON.parse(response.responseText)[id].data;
                                var value = Math.ceil((responseJson.price_overview || responseJson.price).initial / 100);
                                var games, user;
                                getValue(`games`).then(value => {
                                    games = JSON.parse(value);
                                    if (games[type][id]) {
                                        if (games[type][id].noCV) {
                                            value = 0;
                                        } else if (games[type][id].reducedCV) {
                                            value *= 0.15;
                                        }
                                    }
                                    user = {
                                        Username: esgst.username,
                                        SteamID64: esgst.steamId
                                    };
                                    return getValue(`users`);
                                }).then(value => {
                                    var users = JSON.parse(value);
                                    var savedUser = users.users[user.SteamID64];
                                    var sent = 0;
                                    var currentDate = Date.now();
                                    if (savedUser && savedUser.giveaways && savedUser.giveaways.sent && savedUser.giveaways.sent[type][id]) {
                                        var giveaways = savedUser.giveaways.sent[type][id];
                                        for (i = 0, n = giveaways.length; i < n; ++i) {
                                            var giveaway = esgst.giveaways[giveaways[i]];
                                            if (giveaway) {
                                                if (giveaway.entries >= 5 || (!giveaway.inviteOnly && !giveaway.group && !giveaway.whitelist)) {
                                                    if (Array.isArray(giveaway.winners)) {
                                                        if (giveaway.winners.length > 0) {
                                                            giveaway.winners.forEach(winner => {
                                                                if (winner.received) {
                                                                    sent += 1;
                                                                }
                                                            });
                                                        } else if (currentDate < giveaway.endTime) {
                                                            sent += giveaway.copies;
                                                        }
                                                    } else if (giveaway.winners > 0) {
                                                        sent += Math.min(giveaway.entries, giveaway.winners);
                                                    }
                                                } else if (currentDate < giveaway.endTime) {
                                                    sent += giveaway.copies;
                                                }
                                            }
                                        }
                                        if (sent > 5) {
                                            for (i = 0, n = sent - 5; i < n; ++i) {
                                                value *= 0.90;
                                            }
                                        }
                                    }
                                    var cv;
                                    if (copies > 1) {
                                        var total = copies + sent;
                                        if (total > 5) {
                                            n = total - 5;
                                            cv = (copies - n) * value;
                                            for (i = 0; i < n; ++i) {
                                                value *= 0.90;
                                                cv += value;
                                            }
                                        } else {
                                            cv = value * copies;
                                        }
                                    } else if ((sent + 1) > 5) {
                                        cv = value * 0.90;
                                    } else {
                                        cv = value;
                                    }
                                    cv = Math.round(cv * 100) / 100;
                                    var html = `
                                        <div class="table__row-outer-wrap">
                                            <div class="table__row-inner-wrap">
                                                <div class="table__column--width-medium table__column--align-top">
                                                    <span class="esgst-bold">Real CV</span>
                                                </div>
                                                <div class="table__column--width-fill">You should get ~$${cv} real CV for this giveaway.</div>
                                            </div>
                                        </div>
                                    `;
                                    table.insertAdjacentHTML(`beforeEnd`, html);
                                });
                            } catch (e) {}
                            button = document.getElementsByClassName(`js__submit-form`)[0];
                            button.addEventListener(`click`, function () {
                                delValue(`rcvcGame`);
                            });
                        });
                    }
                });
            } else {
                button = document.getElementsByClassName(`js__submit-form`)[0];
                var input = document.querySelector(`[name="game_id"]`);
                button.addEventListener(`click`, function () {
                    var selectedId = input.value;
                    var selected = document.querySelector(`[data-autocomplete-id="${selectedId}"]`);
                    var info = getGameInfo(selected);
                    setValue(`rcvcGame`, {
                        type: info.type,
                        id: info.id
                    });
                });
            }
        }
    }

    /* [UGS] Unsent Gifts Sender */

    function saveUgsReroll(category, winner) {
        var rerolls;
        if (category.value === `1`) {
            id = winner.value;
            if (id) {
                getValue(`rerolls`).then(value => {
                    rerolls = JSON.parse(value);
                    if (rerolls.indexOf(id) < 0) {
                        rerolls.push(id);
                        setValue(`rerolls`, JSON.stringify(rerolls));
                    }
                });
            }
        }
    }

    function openUgsPopup(ugs) {
        var checkMemberSwitch, checkDifferenceSwitch;
        if (!ugs.popup) {
            ugs.popup = new Popup(`fa-gift`, `Send unsent gifts:`);
            new ToggleSwitch(ugs.popup.description, `ugs_checkRules`, false, `Do not send if the winner has any not activated/multiple wins.`, false, false, `The winners will be checked in real time.`, esgst.ugs_checkRules);
            checkMemberSwitch = new ToggleSwitch(ugs.popup.description, `ugs_checkMember`, false, `Do not send if the winner is no longer a member of at least one of the groups for group giveaways.`, false, false, `The winners will be checked in real time.`, esgst.ugs_checkMember);
            checkDifferenceSwitch = new ToggleSwitch(ugs.popup.description, `ugs_checkDifference`, false, `Do not send if the winner has a gift difference lower than <input class="esgst-ugs-difference" step="0.1" type="number" value="${esgst.ugs_difference}"/>.`, false, false, `The winners will be checked in real time.`, esgst.ugs_checkDifference);
            new ToggleSwitch(ugs.popup.description, `ugs_checkWhitelist`, false, `Do not send if the winner is not on your whitelist.`, false, false, `You must sync your whitelist through the settings menu. Whitelisted winners get a pass for broken rules, so if this option is enabled and the winner is whitelisted, the gift will be sent regardless of whether or not the first option is enabled.`, esgst.ugs_checkWhitelist);
            new ToggleSwitch(ugs.popup.description, `ugs_checkBlacklist`, false, `Do not send if the winner on your blacklist.`, false, false, `You must sync your blacklist through the settings menu. If the winner is blacklisted, but is a member of one of the groups, the gift will be sent anyway.`, esgst.ugs_checkBlacklist);
            if (!esgst.ugs_checkMember) {
                checkDifferenceSwitch.container.classList.add(`esgst-hidden`);
            }
            checkDifferenceSwitch.name.firstElementChild.addEventListener(`change`, setUgsDifference);
            checkMemberSwitch.dependencies.push(checkDifferenceSwitch.container);
            ugs.results = insertHtml(ugs.popup.scrollable, `beforeEnd`, `
                <div class="esgst-hidden markdown">
                    <ul>
                        <li>
                            <span class="esgst-bold">Successfully sent gifts to <span>0</span> winners:</span> <span></span>
                        </li>
                        <li>
                            <span class="esgst-bold">Failed to send gifts to <span>0</span> winners (check the tooltips to find out the cause of the failures):</span> <span></span>
                        </li>
                    </ul>
                </div>
            `);
            ugs.sent = ugs.results.firstElementChild.firstElementChild;
            ugs.sentCount = ugs.sent.firstElementChild.firstElementChild;
            ugs.sentGifts = ugs.sent.lastElementChild;
            ugs.unsent = ugs.sent.nextElementSibling;
            ugs.unsentCount = ugs.unsent.firstElementChild.firstElementChild;
            ugs.unsentGifts = ugs.unsent.lastElementChild;
            ugs.popup.description.appendChild(new ButtonSet(`green`, `red`, `fa-send`, `fa-times-circle`, `Send`, `Cancel`, startUgsSender.bind(null, ugs), cancelUgsSender.bind(null, ugs)).set);
            ugs.progress = insertHtml(ugs.popup.description, `beforeEnd`, `<div></div>`);
            ugs.overallProgress = insertHtml(ugs.popup.description, `beforeEnd`, `<div></div>`);
            ugs.popup.description.appendChild(ugs.popup.scrollable);
        }
        ugs.popup.open();
    }

    function setUgsDifference(event) {
        setSetting(`ugs_difference`, event.currentTarget.value);
    }

    function startUgsSender(ugs, callback) {
        var unsent;
        ugs.button.classList.add(`esgst-busy`);
        ugs.results.classList.add(`esgst-hidden`);
        ugs.sent.classList.add(`esgst-hidden`);
        ugs.unsent.classList.add(`esgst-hidden`);
        ugs.sentCount.textContent = ugs.unsentCount.textContent = `0`;
        ugs.sentGifts.innerHTML = ugs.unsentGifts.innerHTML = ``;
        ugs.progress.innerHTML = ``;
        ugs.overallProgress.textContent = ``;
        ugs.giveaways = [];
        ugs.canceled = false;
        unsent = esgst.createdButton.getElementsByClassName(`nav__notification`)[0];
        if (unsent) {
            ugs.count = parseInt(unsent.textContent);
            getUgsGiveaways(document, ugs, esgst.currentPage, continueUgsSender.bind(null, ugs, callback));
        } else {
            ugs.button.classList.remove(`esgst-busy`);
            ugs.progress.innerHTML = `You do not have any unsent gifts.`;
            callback();
        }
    }

    function getUgsGiveaways(context, ugs, nextPage, callback) {
        var element, elements, giveaways, heading, i, n, unsent, url;
        if (!ugs.canceled) {
            if (context) {
                if (nextPage === esgst.currentPage) {
                    ugs.lastPage = getLastPage(context);
                    ugs.lastPage = ugs.lastPage === 999999999 ? `` : ` of ${ugs.lastPage}`;
                }
                ugs.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Searching for unsent gifts (page ${nextPage - 1}${ugs.lastPage})...</span>
                `;
                giveaways = [];
                elements = context.getElementsByClassName(`table__row-outer-wrap`);
                ugs.continue = false;
                for (i = 0, n = elements.length; i < n; ++i) {
                    element = elements[i];
                    unsent = element.getElementsByClassName(`fa icon-red fa-warning`)[0];
                    if (unsent) {
                        heading = element.getElementsByClassName(`table__column__heading`)[0];
                        url = heading.getAttribute(`href`);
                        giveaways.push({
                            code: url.match(/\/giveaway\/(.+?)\//)[1],
                            context: unsent,
                            name: heading.firstChild.textContent.trim().match(/(.+?)(\s\(.+\sCopies\))?$/)[1],
                            url: url
                        });
                        ugs.continue = true;
                    }
                }
                n = giveaways.length;
                if (n > 0) {
                    setUgsGiveaways(giveaways, ugs, 0, n, checkNextUgsPage.bind(null, context, ugs, nextPage, callback));
                } else {
                    checkNextUgsPage(context, ugs, nextPage, callback);
                }
            } else if (document.getElementsByClassName(`esgst-es-page-${nextPage}}`)[0]) {
                setTimeout(getUgsGiveaways, 0, null, ugs, ++nextPage, callback);
            } else if (!ugs.canceled) {
                request(null, null, `GET`, false, `/giveaways/created/search?page=${nextPage}`, loadNextUgsPage.bind(null, ugs, nextPage, callback));
            }
        }
    }

    function setUgsGiveaways(giveaways, ugs, i, n, callback) {
        var giveaway;
        if (!ugs.canceled) {
            ugs.overallProgress.textContent = `${i} of ${n} giveaways checked...`;
            if (i < n) {
                giveaway = giveaways[i];
                ugs.giveaways[giveaway.code] = {
                    code: giveaway.code,
                    context: giveaway.context,
                    name: giveaway.name,
                    url: giveaway.url,
                    winners: []
                };
                getUgsWinners(giveaway.code, ugs, 1, `${giveaway.url}/winners/search?page=`, checkUgsGiveawayGroups.bind(null, giveaway, giveaways, ugs, i, n, callback));
            } else {
                callback();
            }
        }
    }

    function getUgsWinners(code, ugs, nextPage, url, callback) {
        if (!ugs.canceled) {
            request(null, null, `GET`, false, `${url}${nextPage}`, loadNextUgsWinnersPage.bind(null, code, ugs, nextPage, url, callback));
        }
    }

    function loadNextUgsWinnersPage(code, ugs, nextPage, url, callback, response) {
        var elements, i, n, pagination, responseHtml, unsent;
        if (!ugs.canceled) {
            responseHtml = parseHtml(response.responseText);
            if (nextPage === 1) {
                ugs.lastWinnersPage = getLastPage(responseHtml);
                ugs.lastWinnersPage = ugs.lastWinnersPage === 999999999 ? `` : ` of ${ugs.lastWinnersPage}`;
            }
            ugs.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Retrieving winners (page ${nextPage - 1}${ugs.lastWinnersPage})...</span>
            `;
            elements = responseHtml.getElementsByClassName(`table__row-outer-wrap`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                unsent = element.querySelector(`.table__gift-not-sent:not(.is-hidden)`);
                if (unsent) {
                    ugs.giveaways[code].winners.push({
                        username: element.getElementsByClassName(`table__column__heading`)[0].textContent,
                        values: {},
                        winnerId: element.querySelector(`[name="winner_id"]`).value
                    });
                    ugs.count -= 1;
                }
            }
            pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
            if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(getUgsWinners, 0, code, ugs, ++nextPage, url, callback);
            } else {
                if (responseHtml.getElementsByClassName(`featured__column--group`)[0]) {
                    ugs.giveaways[code].group = true;
                }
                if (responseHtml.getElementsByClassName(`featured__column--whitelist`)[0]) {
                    ugs.giveaways[code].whitelist = true;
                }
                callback();
            }
        }
    }

    function checkUgsGiveawayGroups(giveaway, giveaways, ugs, i, n, callback) {
        if (!ugs.canceled) {
            if (esgst.ugs_checkMember && ugs.giveaways[giveaway.code].group) {
                ugs.giveaways[giveaway.code].groups = [];
                getUgsGroups(giveaway.code, ugs, 1, `${giveaway.url}/groups/search?page=`, setTimeout.bind(null, setUgsGiveaways, 0, giveaways, ugs, ++i, n, callback));
            } else {
                setTimeout(setUgsGiveaways, 0, giveaways, ugs, ++i, n, callback);
            }
        }
    }

    function getUgsGroups(code, ugs, nextPage, url, callback) {
        if (!ugs.canceled) {
            request(null, null, `GET`, false, `${url}${nextPage}`, loadNextUgsGroupsPage.bind(null, code, ugs, nextPage, url, callback));
        }
    }

    function loadNextUgsGroupsPage(code, ugs, nextPage, url, callback, response) {
        var elements, i, match, n, pagination, responseHtml;
        if (!ugs.canceled) {
            responseHtml = parseHtml(response.responseText);
            if (nextPage === 1) {
                ugs.lastGroupsPage = getLastPage(responseHtml);
                ugs.lastGroupsPage = ugs.lastGroupsPage === 999999999 ? `` : ` of ${ugs.lastGroupsPage}`;
            }
            ugs.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Retrieving groups (page ${nextPage - 1}${ugs.lastGroupsPage})...</span>
            `;
            elements = responseHtml.getElementsByClassName(`table__column__heading`);
            for (i = 0, n = elements.length; i < n; ++i) {
                match = elements[i].getAttribute(`href`).match(/\/group\/(.+?)\/(.+)/);
                ugs.giveaways[code].groups.push({
                    code: match[1],
                    name: match[2]
                });
            }
            pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
            if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                setTimeout(getUgsGroups, 0, code, ugs, ++nextPage, url, callback);
            } else {
                callback();
            }
        }
    }

    function checkNextUgsPage(context, ugs, nextPage, callback) {
        var pagination;
        if (!ugs.canceled) {
            if (ugs.count > 0 || ugs.continue) {
                pagination = context.getElementsByClassName(`pagination__navigation`)[0];
                if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(getUgsGiveaways, 0, null, ugs, nextPage, callback);
                } else {
                    callback();
                }
            } else {
                callback();
            }
        }
    }

    function loadNextUgsPage(ugs, nextPage, callback, response) {
        if (!ugs.canceled) {
            setTimeout(getUgsGiveaways, 0, parseHtml(response.responseText), ugs, ++nextPage, callback);
        }
    }

    function continueUgsSender(ugs, callback) {
        var n;
        if (!ugs.canceled) {
            codes = Object.keys(ugs.giveaways);
            n = codes.length;
            if (n > 0) {
                getValue(`rerolls`).then(value => {
                    ugs.rerolls = JSON.parse(value);
                    ugs.sentWinners = {};
                    ugs.winners = {};
                    ugs.results.classList.remove(`esgst-hidden`);
                    checkUgsGifts(codes, ugs, 0, n, completeUgsSender.bind(null, ugs, callback));
                });
            } else {
                ugs.button.classList.remove(`esgst-busy`);
                ugs.progress.innerHTML = `You do not have any unsent gifts.`;
                callback();
            }
        }
    }

    function checkUgsGifts(codes, ugs, i, n, callback) {
        var code, giveaway, j, numWinners, savedUser, winner, winners;
        if (!ugs.canceled) {
            if (i < n) {
                ugs.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Checking winners...</span>
                `;
                ugs.overallProgress.textContent = `${i} of ${n} giveaways checked...`;
                code = codes[i];
                giveaway = ugs.giveaways[code];
                winners = giveaway.winners;
                numWinners = winners.length;
                if (esgst.ugs_checkRules) {
                    if (esgst.ugs_checkMember && giveaway.group) {
                        checkUgsRules(code, ugs, 0, numWinners, checkUgsGroups.bind(null, code, ugs, 0, numWinners, sendUgsGifts.bind(null, code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback))));
                    } else {
                        checkUgsRules(code, ugs, 0, numWinners, sendUgsGifts.bind(null, code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback)));
                    }
                } else if (esgst.ugs_checkMember && giveaway.group) {
                    checkUgsGroups(code, ugs, 0, numWinners, sendUgsGifts.bind(null, code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback)));
                } else if (esgst.ugs_checkWhitelist) {
                    checkUgsWhitelist(code, ugs, 0, numWinners, sendUgsGifts.bind(null, code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback)));
                } else if (esgst.ugs_checkBlacklist) {
                    checkUgsBlacklist(code, ugs, 0, numWinners, sendUgsGifts.bind(null, code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback)));
                } else {
                    for (j = 0; j < numWinners; ++j) {
                        winner = winners[j];
                        if (ugs.rerolls.indexOf(winner.winnerId) >= 0) {
                            winner.error = `${winner.username} is currently being rerolled.`;
                        }
                    }
                    sendUgsGifts(code, ugs, 0, numWinners, setTimeout.bind(null, checkUgsGifts, 0, codes, ugs, ++i, n, callback));
                }
            } else {
                callback();
            }
        }
    }

    function checkUgsWhitelist(code, ugs, i, n, callback) {
        if (!ugs.canceled) {
            if (i < n) {
                giveaway = ugs.giveaways[code];
                winner = giveaway.winners[i];
                if (ugs.rerolls.indexOf(winner.winnerId) < 0) {
                    savedUser = getUser(esgst.users, winner);
                    if (savedUser && !savedUser.whitelisted) {
                        winner.error = `${winner.username} is not whitelisted.`;
                    }
                } else {
                    winner.error = `${winner.username} is currently being rerolled.`;
                }
                setTimeout(checkUgsWhitelist, 0, code, ugs, ++i, n, callback);
            } else {
                callback();
            }
        }
    }

    function checkUgsBlacklist(code, ugs, i, n, callback) {
        if (!ugs.canceled) {
            if (i < n) {
                giveaway = ugs.giveaways[code];
                winner = giveaway.winners[i];
                if (ugs.rerolls.indexOf(winner.winnerId) < 0) {
                    savedUser = getUser(esgst.users, winner);
                    if (savedUser && savedUser.blacklisted) {
                        winner.error = `${winner.username} is blacklisted.`;
                    }
                } else {
                    winner.error = `${winner.username} is currently being rerolled.`;
                }
                setTimeout(checkUgsBlacklist, 0, code, ugs, ++i, n, callback);
            } else {
                callback();
            }
        }
    }

    function checkUgsRules(code, ugs, i, n, callback) {
        var giveaway, namwc, winner;
        if (!ugs.canceled) {
            if (i < n) {
                giveaway = ugs.giveaways[code];
                winner = giveaway.winners[i];
                ugs.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Checking if ${winner.username} has not activated/multiple wins...</span>
                `;
                if (ugs.rerolls.indexOf(winner.winnerId) < 0) {
                    namwc = {
                        lastCheck: Date.now(),
                        results: {}
                    };
                    checkNAMWCNotActivated(ugs, namwc, winner.username, function (namwc) {
                        checkNAMWCMultiple(ugs, namwc, winner.username, function (namwc) {
                            winner.values.namwc = namwc;
                            if ((Array.isArray(namwc.results.notActivated) && namwc.results.notActivated.length) || (!Array.isArray(namwc.results.notActivated) && namwc.results.notActivated) || (Array.isArray(namwc.results.multiple) && namwc.results.multiple.length) || (!Array.isArray(namwc.results.multiple) && namwc.results.multiple)) {
                                if (esgst.ugs_checkWhitelist) {
                                    savedUser = getUser(esgst.users, winner);
                                    if (savedUser && !savedUser.whitelisted) {
                                        winner.error = `${winner.username} is not whitelisted.`;
                                    }
                                } else if (esgst.ugs_checkBlacklist) {
                                    savedUser = getUser(esgst.users, winner);
                                    if (savedUser && savedUser.blacklisted) {
                                        winner.error = `${winner.username} is blacklisted.`;
                                    }
                                } else {
                                    if ((Array.isArray(namwc.results.notActivated) && namwc.results.notActivated.length) || (!Array.isArray(namwc.results.notActivated) && namwc.results.notActivated) && (Array.isArray(namwc.results.multiple) && namwc.results.multiple.length) || (!Array.isArray(namwc.results.multiple) && namwc.results.multiple)) {
                                        winner.error = `${winner.username} has ${Array.isArray(namwc.results.notActivated) ? namwc.results.notActivated.length : namwc.results.notActivated} not activated wins and ${Array.isArray(namwc.results.multiple) ? namwc.results.multiple.length : namwc.results.multiple} multiple wins.`;
                                    } else if ((Array.isArray(namwc.results.notActivated) && namwc.results.notActivated.length) || (!Array.isArray(namwc.results.notActivated) && namwc.results.notActivated)) {
                                        winner.error = `${winner.username} has ${Array.isArray(namwc.results.notActivated) ? namwc.results.notActivated.length : namwc.results.notActivated} not activated wins.`;
                                    } else {
                                        winner.error = `${winner.username} has ${Array.isArray(namwc.results.multiple) ? namwc.results.multiple.length : namwc.results.multiple} multiple wins.`;
                                    }
                                }
                            }
                            setTimeout(checkUgsRules, 0, code, ugs, ++i, n, callback);
                        });
                    });
                } else {
                    winner.error = `${winner.username} is currently being rerolled.`;
                    setTimeout(checkUgsRules, 0, code, ugs, ++i, n, callback);
                }
            } else {
                callback();
            }
        }
    }

    function checkUgsGroups(code, ugs, i, n, callback) {
        var giveaway, numGroups, winner;
        if (!ugs.canceled) {
            if (i < n) {
                giveaway = ugs.giveaways[code];
                numGroups = giveaway.groups.length;
                winner = giveaway.winners[i];
                ugs.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Checking if ${winner.username} is a member of one of the groups...</span>
                `;
                if (ugs.rerolls.indexOf(winner.winnerId) < 0) {
                    getSteamId(null, false, esgst.users, winner, getUgsGroupMembers.bind(null, giveaway, ugs, 0, numGroups, winner, checkUgsUserGroups.bind(null, giveaway, ugs, winner, setTimeout.bind(null, checkUgsGroups, 0, code, ugs, ++i, n, callback))));
                } else {
                    winner.error = `${winner.username} is currently being rerolled.`;
                    setTimeout(checkUgsGroups, 0, code, ugs, ++i, n, callback);
                }
            } else {
                callback();
            }
        }
    }

    function getUgsGroupMembers(giveaway, ugs, i, n, winner, callback) {
        var code, j;
        if (!ugs.canceled) {
            if (i < n) {
                code = giveaway.groups[i].code;
                for (j = esgst.groups.length - 1; j >= 0 && esgst.groups[j].code !== code; --j);
                request(null, null, `GET`, false, `http://steamcommunity.com/gid/${esgst.groups[j].steamId}/memberslistxml?xml=1`, checkUgsGroupMembers.bind(null, giveaway, ugs, i, n, winner, callback));
            } else {
                callback();
            }
        }
    }

    function checkUgsGroupMembers(giveaway, ugs, i, n, winner, callback, response) {
        var group;
        if (!ugs.canceled) {
            if (response.responseText.match(new RegExp(`<steamID64>${winner.steamId}</steamID64>`))) {
                if (esgst.ugs_checkDifference) {
                    ugs.progress.innerHTML = `
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        <span>Checking if ${winner.username} has a gift difference higher than the one set...</span>
                    `;
                    group = giveaway.groups[i];
                    request(null, null, `GET`, false, `/group/${group.code}/${group.name}/users/search?q=${winner.username}`, checkUgsDifference.bind(null, ugs, winner, callback));
                } else {
                    callback(true);
                }
            } else {
                setTimeout(getUgsGroupMembers, 0, giveaway, ugs, ++i, n, winner, callback);
            }
        }
    }

    function checkUgsDifference(ugs, winner, callback, response) {
        var difference, element, username;
        if (!ugs.canceled) {
            element = parseHtml(response.responseText).getElementsByClassName(`table__row-outer-wrap`)[0];
            if (element) {
                username = element.getElementsByClassName(`table__column__heading`)[0].textContent;
                if (username === winner.username) {
                    difference = parseFloat(element.getElementsByClassName(`table__column--width-small`)[2].textContent);
                    if (difference >= esgst.ugs_difference) {
                        callback(true);
                    } else {
                        winner.error = `${winner.username} has a ${difference} gift difference.`;
                        callback(true);
                    }
                } else {
                    callback();
                }
            } else {
                callback();
            }
        }
    }

    function checkUgsUserGroups(giveaway, ugs, winner, callback, member) {
        var savedUser;
        if (!ugs.canceled) {
            if (member) {
                callback();
            } else if (giveaway.whitelist) {
                savedUser = getUser(esgst.users, winner);
                if (savedUser && !savedUser.whitelisted) {
                    winner.error = `${winner.username} is not whitelisted.`;
                }
                callback();
            } else {
                winner.error = `${winner.username} is not a member of one of the groups.`;
                callback();
            }
        }
    }

    function sendUgsGifts(code, ugs, i, n, callback) {
        var giveaway, winner;
        if (!ugs.canceled) {
            if (i < n) {
                ugs.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Sending gifts...</span>
                `;
                ugs.overallProgress.textContent = `${i} of ${n} gifts sent...`;
                giveaway = ugs.giveaways[code];
                winner = giveaway.winners[i];
                if (!ugs.winners[winner.username]) {
                    ugs.winners[winner.username] = [];
                }
                if (ugs.winners[winner.username].indexOf(giveaway.name) < 0) {
                    if (winner.error) {
                        ugs.unsent.classList.remove(`esgst-hidden`);
                        ugs.unsentCount.textContent = parseInt(ugs.unsentCount.textContent) + 1;
                        ugs.unsentGifts.insertAdjacentHTML(`beforeEnd`, `
                            <span>
                                <a href="/user/${winner.username}">${winner.username}</a> (<a href="${giveaway.url}/winners">${giveaway.name}</a>)
                                <i class="fa fa-question-circle" title="${winner.error}"></i>
                            </span>
                        `);
                        setTimeout(sendUgsGifts, 0, code, ugs, ++i, n, callback);
                    } else if (!ugs.canceled) {
                        request(`xsrf_token=${esgst.xsrfToken}&do=sent_feedback&action=1&winner_id=${winner.winnerId}`, null, `POST`, false, `/ajax.php`, sendUgsGift.bind(null, code, giveaway, ugs, i, n, winner, callback));
                    }
                } else {
                    ugs.unsent.classList.remove(`esgst-hidden`);
                    ugs.unsentCount.textContent = parseInt(ugs.unsentCount.textContent) + 1;
                    ugs.unsentGifts.insertAdjacentHTML(`beforeEnd`, `
                        <span>
                            <a href="/user/${winner.username}">${winner.username}</a> (<a href="${giveaway.url}/winners">${giveaway.name}</a>)
                            <i class="fa fa-question-circle" title="${winner.username} already won ${giveaway.name} from another giveaway of yours"></i>
                        </span>
                    `);
                    setTimeout(sendUgsGifts, 0, code, ugs, ++i, n, callback);
                }
            } else {
                callback();
            }
        }
    }

    function sendUgsGift(code, giveaway, ugs, i, n, winner, callback) {
        if (!ugs.canceled) {
            if (!ugs.sentWinners[giveaway.code]) {
                ugs.sentWinners[giveaway.code] = [];
            }
            ugs.sent.classList.remove(`esgst-hidden`);
            ugs.sentWinners[giveaway.code].push(winner.username);
            ugs.sentCount.textContent = parseInt(ugs.sentCount.textContent) + 1;
            ugs.sentGifts.insertAdjacentHTML(`beforeEnd`, `
                <span>
                    <a href="/user/${winner.username}">${winner.username}</a> (<a href="${giveaway.url}/winners">${giveaway.name}</a>)
                </span>
            `);
            if (!ugs.winners[winner.username]) {
                ugs.winners[winner.username] = [];
            }
            ugs.winners[winner.username].push(giveaway.name);
            if (document.body.contains(giveaway.context)) {
                giveaway.context.className = `fa fa-check-circle icon-green`;
                giveaway.context.nextElementSibling.textContent = `Sent`;
            }
            setTimeout(sendUgsGifts, 0, code, ugs, ++i, n, callback);
        }
    }

    function completeUgsSender(ugs, callback) {
        var i, key, n, savedUsers, winners;
        if (!ugs.canceled) {
            getValue(`winners`, `{}`).then(value => {
                winners = JSON.parse(value);
                for (key in ugs.sentWinners) {
                    if (!winners[key]) {
                        winners[key] = [];
                    }
                    for (i = 0, n = ugs.sentWinners[key].length; i < n; ++i) {
                        winners[key].push(ugs.sentWinners[key][i]);
                    }
                }
                return setValue(`winners`, JSON.stringify(winners));
            }).then(() => {
                savedUsers = [];
                for (key in ugs.giveaways) {
                    for (i = 0, n = ugs.giveaways[key].winners.length; i < n; ++i) {
                        savedUsers.push(ugs.giveaways[key].winners[i]);
                    }
                }
                ugs.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Saving data...</span>
                `;
                ugs.overallProgress.textContent = ``;
                saveUsers(savedUsers, function() {
                    ugs.button.classList.remove(`esgst-busy`);
                    ugs.progress.innerHTML = ``;
                    callback();
                });
            });
        }
    }

    function cancelUgsSender(ugs) {
        ugs.canceled = true;
        ugs.button.classList.remove(`esgst-busy`);
        ugs.progress.innerHTML = ``;
        ugs.overallProgress.textContent = ``;
    }

    /* [SKS] Sent Keys Searcher */

    function openSksPopup(sks) {
        if (!sks.popup) {
            sks.popup = new Popup(`fa-key`, `Search for keys:`);
            sks.textArea = insertHtml(sks.popup.scrollable, `beforeEnd`, `
                <div class="esgst-description">Insert the keys below, one per line.</div>
                <textarea></textarea>
            `);
            new ToggleSwitch(sks.popup.description, `sks_exportKeys`, false, `Export all keys ever sent.`, false, false, `This will search all your giveaways and export a file with all keys ever sent. You don't need to enter any keys if this option is enabled.`, esgst.sks_exportKeys);
            sks.results = insertHtml(sks.popup.scrollable, `beforeEnd`, `<div></div>`);
            sks.popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-search`, `fa-times`, `Search`, `Cancel`, searchSksGiveaways.bind(null, sks), cancelSksSearch.bind(null, sks)).set);
            sks.progress = insertHtml(sks.popup.description, `beforeEnd`, `<div></div>`);
        }
        sks.popup.open();
    }

    function searchSksGiveaways(sks, callback) {
        var i, key, keys, n;
        sks.button.classList.add(`esgst-busy`);
        sks.canceled = false;
        sks.count = 0;
        sks.giveaways = {};
        sks.allKeys = [];
        sks.keys = [];
        sks.progress.innerHTML = ``;
        sks.results.innerHTML = ``;
        keys = sks.textArea.value.trim().split(/\n/);
        n = keys.length;
        if ((n > 0 && !esgst.sks_exportKeys) || esgst.sks_exportKeys) {
            for (i = 0, n = keys.length; i < n; ++i) {
                key = keys[i].trim();
                if (key) {
                    sks.keys.push(key);
                    sks.count += 1;
                }
            }
            sks.textArea.value = sks.keys.join(`\n`);
            getSksGiveaways(document, esgst.currentPage, sks, completeSksSearch.bind(null, sks, callback));
        } else {
            callback();
        }
    }

    function getSksGiveaways(context, nextPage, sks, callback) {
        var element, elements, giveaways, heading, i, n, unsent, url;
        if (!sks.canceled) {
            if (context) {
                if (nextPage === esgst.currentPage) {
                    sks.lastPage = getLastPage(context);
                    sks.lastPage = sks.lastPage === 999999999 ? `` : ` of ${sks.lastPage}`;
                }
                sks.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Searching for ${sks.count} keys (page ${nextPage - 1}${sks.lastPage})...</span>
                `;
                giveaways = [];
                elements = context.getElementsByClassName(`trigger-popup--keys`);
                for (i = 0, n = elements.length; i < n; ++i) {
                    element = elements[i];
                    giveaways.push({
                        active: Date.now() < (parseInt(element.closest(`.table__row-inner-wrap`).querySelector(`[data-timestamp]`).getAttribute(`data-timestamp`)) * 1e3),
                        code: element.parentElement.querySelector(`[name=code]`).value,
                        name: element.getAttribute(`data-name`)
                    });
                }
                n = giveaways.length;
                if (n > 0) {
                    checkSksGiveaways(giveaways, 0, n, sks, checkNextSksPage.bind(null, context, nextPage, sks, callback));
                } else {
                    checkNextSksPage(context, nextPage, sks, callback);
                }
            } else if (document.getElementsByClassName(`esgst-es-page-${nextPage}}`)[0]) {
                setTimeout(getSksGiveaways, 0, null, ++nextPage, sks, callback);
            } else if (!sks.canceled) {
                request(null, null, `GET`, false, `/giveaways/created/search?page=${nextPage}`, loadNextSksPage.bind(null, nextPage, sks, callback));
            }
        }
    }

    function checkSksGiveaways(giveaways, i, n, sks, callback) {
        if (!sks.canceled) {
            if (i < n) {
                request(`xsrf_token=${esgst.xsrfToken}&do=popup_keys&code=${giveaways[i].code}`, null, `POST`, false, `/ajax.php`, checkSksGiveaway.bind(null, giveaways, i, n, sks, callback));
            } else {
                callback();
            }
        }
    }

    function checkSksGiveaway(giveaways, i, n, sks, callback, response) {
        var element, heading, j, key;
        heading = parseHtml(JSON.parse(response.responseText).html).getElementsByClassName(`popup__keys__heading`)[0];
        if (heading && (heading.textContent === `Assigned` || giveaways[i].active)) {
            element = heading.nextElementSibling.nextElementSibling;
            for (j = element.children.length - 1; j >= 0; --j) {
                key = element.children[j].textContent;
                if (sks.keys.indexOf(key) >= 0) {
                    sks.giveaways[key] = giveaways[i];
                    sks.count -= 1;
                }
                if (esgst.sks_exportKeys) {
                    sks.allKeys.push(`${giveaways[i].active ? `[UNASSIGNED] ` : ``}${key} ${giveaways[i].name} https://www.steamgifts.com/giveaway/${giveaways[i].code}/`);
                }
            }
        }
        setTimeout(checkSksGiveaways, 0, giveaways, ++i, n, sks, callback);
    }

    function checkNextSksPage(context, nextPage, sks, callback) {
        var pagination;
        if (!sks.canceled) {
            if (sks.count > 0 || esgst.sks_exportKeys) {
                pagination = context.getElementsByClassName(`pagination__navigation`)[0];
                if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(getSksGiveaways, 0, null, nextPage, sks, callback);
                } else {
                    callback();
                }
            } else {
                callback();
            }
        }
    }

    function loadNextSksPage(nextPage, sks, callback, response) {
        if (!sks.canceled) {
            setTimeout(getSksGiveaways, 0, parseHtml(response.responseText), ++nextPage, sks, callback);
        }
    }

    function completeSksSearch(sks, callback) {
        var anchor, found, giveaway, i, key, n, notFound, url;
        found = [];
        notFound = [];
        for (i = 0, n = sks.keys.length; i < n; ++i) {
            key = sks.keys[i];
            giveaway = sks.giveaways[key];
            if (giveaway) {
                found.push(`<li>${giveaway.active ? `[UNASSIGNED] ` : ``}${key} (<a href="/giveaway/${giveaway.code}/">${giveaway.name}</a>)</li>`);
            } else {
                notFound.push(`<li>${key}</li>`);
            }
        }
        n = found.length;
        if (n > 0) {
            sks.results.insertAdjacentHTML(`beforeEnd`, `
                <div class="markdown">
                    <div>
                        <span class="esgst-bold">Found ${n} keys:</span>
                    </div>
                    <ul>
                        ${found.join(``)}
                    </ul>
                </div>
            `);
        }
        n = notFound.length;
        if (n > 0) {
            sks.results.insertAdjacentHTML(`beforeEnd`, `
                <div class="markdown">
                    <div>
                        <span class="esgst-bold">Did not find ${n} keys:</span>
                    </div>
                    <ul>
                        ${notFound.join(``)}
                    </ul>
                </div>
            `);
        }
        if (esgst.sks_exportKeys) {
            anchor = document.createElement(`a`);
            anchor.download = `esgst_sks_keys_${new Date().toISOString()}.txt`;
            url = URL.createObjectURL(new Blob([sks.allKeys.join(`\r\n`)]));
            anchor.href = url;
            document.body.appendChild(anchor);
            anchor.click();
            anchor.remove();
            URL.revokeObjectURL(url);
        }
        sks.progress.innerHTML = ``;
        sks.button.classList.remove(`esgst-busy`);
        callback();
    }

    function cancelSksSearch(sks) {
        sks.canceled = true;
        sks.button.classList.remove(`esgst-busy`);
        sks.progress.innerHTML = ``;
    }

    /* [ET] Entries Tracker */

    function getEtEntries(context) {
        var elements, i, n;
        elements = context.querySelectorAll(`.table__remove-default:not(.is-hidden)`);
        for (i = 0, n = elements.length; i < n; ++i) {
            setEtObserver(elements[i]);
        }
    }

    function setEtObserver(element) {
        var code, container, heading, name;
        container = element.closest(`.table__row-inner-wrap`);
        heading = container.getElementsByClassName(`table__column__heading`)[0];
        code = heading.getAttribute(`href`).match(/\/giveaway\/(.+?)\//)[1];
        name = heading.firstChild.textContent.trim().match(/(.+?)(\s\(.+\sCopies\))?$/)[1];
        element.addEventListener(`click`, setEtEntry.bind(null, code, false, name));
    }

    function setEtEntry(code, entry, name) {
        var entries;
        getValue(`entries`, `[]`).then(value => {
            entries = JSON.parse(value);
            entries.push({
                code: code,
                entry: entry,
                name: name,
                timestamp: Date.now()
            });
            setValue(`entries`, JSON.stringify(entries));
        });
    }

    /* [GM] Giveaways Manager */

    function loadGm(context) {
        let button, toggleSwitch;
        if (context || esgst.giveawaysPath || esgst.createdPath || esgst.enteredPath || esgst.wonPath || esgst.userPath) {
            esgst.gmCheckboxes = {};
            let key, position;
            if (esgst.leftButtonIds.indexOf(`gm`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            button = insertHtml(context || (esgst.hideButtons && esgst.hideButtons_gm ? esgst[key] : esgst.mainPageHeading), position, `
                <div class="esgst-heading-button" id="esgst-gm" title="Manage giveaways">
                    <span></span>
                    <i class="fa fa-gear"></i>
                </div>
            `)
            toggleSwitch = new ToggleSwitch(button.firstElementChild, `gm_enable`, true, ``, false, false, null, esgst.gm_enable);
            toggleSwitch.onEnabled = enableGm.bind(null, context);
            toggleSwitch.onDisabled = disableGm.bind(null, context);
            button.lastElementChild.addEventListener(`click`, openGmPopout.bind(null, null, {button, context}));
        }
    }

    function enableGm(popup, giveaways) {
        var checkbox, giveaway, giveaways, i, n;
        if (!giveaways) {
            giveaways = esgst[popup ? `popupGiveaways` : `currentGiveaways`];
        }
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            if (!giveaway.innerWrap.getElementsByClassName(`esgst-gm-checkbox`)[0]) {
                checkbox = new Checkbox(insertHtml(giveaway.innerWrap, `afterBegin`, `
                    <div class="esgst-gm-checkbox"></div>
                `));
                checkbox.onEnabled = selectGmGiveaway.bind(null, giveaway, true);
                checkbox.onDisabled = selectGmGiveaway.bind(null, giveaway, false);
                esgst.gmCheckboxes[giveaway.code] = checkbox;
            }
        }
    }

    function selectGmGiveaway(giveaway, value) {
        giveaway.gm = value;
    }

    function disableGm(popup, giveaways) {
        var checkbox, giveaway, giveaways, i, n;
        esgst.gmCheckboxes = {};
        if (!giveaways) {
            giveaways = esgst[popup ? `popupGiveaways` : `currentGiveaways`];
        }
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            checkbox = giveaway.innerWrap.getElementsByClassName(`esgst-gm-checkbox`)[0];
            if (checkbox) {
                checkbox.remove();
            }
            giveaway.gm = false;
        }
    }

    function openGmPopout(giveaways, gm) {
        var checkboxContext, checkbox, group, textArea, toggleSwitch;
        if (!gm.popout) {
            gm.popout = new Popout(`esgst-gm-popout`, gm.button, 0, true);
            group = insertHtml(gm.popout.popout, `beforeEnd`, `<div class="esgst-button-group"><span>Select:</span></div>`);
            group.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle`, `fa-circle-o-notch fa-spin`, `All`, ``, selectSwitches.bind(null, esgst.gmCheckboxes, `check`)).set);
            group.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle-o`, `fa-circle-o-notch fa-spin`, `None`, ``, selectSwitches.bind(null, esgst.gmCheckboxes, `uncheck`)).set);
            group.appendChild(new ButtonSet(`grey`, `grey`, `fa-dot-circle-o`, `fa-circle-o-notch fa-spin`, `Inverse`, ``, selectSwitches.bind(null, esgst.gmCheckboxes, `toggle`)).set);
            group = insertHtml(gm.popout.popout, `beforeEnd`, `<div class="esgst-button-group"></div>`);
            group.appendChild(new ButtonSet(`green`, ``, `fa-search`, ``, `Search & Replace`, ``, openGmPopup.bind(null, giveaways, gm)).set);
            if (esgst.gb) {
                group.appendChild(new ButtonSet(`green`, `grey`, `fa-bookmark`, `fa-circle-o-notch fa-spin`, `Bookmark`, `Bookmarking...`, bookmarkGmGiveaways.bind(null, giveaways, gm)).set);
                group.appendChild(new ButtonSet(`green`, `grey`, `fa-bookmark-o`, `fa-circle-o-notch fa-spin`, `Unbookmark`, `Unbookmarking...`, unbookmarkGmGiveaways.bind(null, giveaways, gm)).set);
            }
            if (esgst.gf && esgst.gf_s) {
                group.appendChild(new ButtonSet(`green`, `grey`, `fa-eye-slash`, `fa-circle-o-notch fa-spin`, `Hide`, `Hiding...`, hideGmGiveaways.bind(null, giveaways, gm)).set);
            }
            if (esgst.ttec) {
                group.appendChild(new ButtonSet(`green`, `grey`, `fa-clock-o`, `fa-circle-o-notch fa-spin`, `Calculate`, `Calculating...`, calculateGmGiveaways.bind(null, giveaways, gm)).set);
            }
            group = insertHtml(gm.popout.popout, `beforeEnd`, `<div class="esgst-button-group"><span>Export to:</span></div>`);
            group.appendChild(new ButtonSet(`green`, `grey`, `fa-puzzle-piece`, `fa-circle-o-notch fa-spin`, `Encrypted Giveaways`, `Exporting...`, exportGmEncrypted.bind(null, giveaways, gm)).set);
            group.appendChild(new ButtonSet(`green`, `grey`, `fa-globe`, `fa-circle-o-notch fa-spin`, `Links`, `Exporting...`, exportGmLinks.bind(null, giveaways, gm)).set);
            group.appendChild(new ButtonSet(`green`, `grey`, `fa-pencil`, `fa-circle-o-notch fa-spin`, `Custom Format`, `Exporting...`, exportGmCustom.bind(null, giveaways, gm)).set);
            createTooltip(insertHtml(gm.popout.popout, `beforeEnd`, `
                <div class="esgst-description">
                    Enter the custom format below. <i class="fa fa-question-circle"></i>
                </div>
            `).lastElementChild, `
                <div>Delimit the line to be replaced and duplicated (in case of more than one giveaways selected) with [LINE][/LINE]. Use [TYPE] for "app" or "sub", [ID] for the app/sub id, [STEAM] for the Steam store URL, [NAME] for the game name, [CODE] for the giveaway code, [SHORT-URL] for the giveaway URL without the game name (https://www.steamgifts.com/giveaway/XXXXX/), [URL] for the full giveaway URL (https://www.steamgifts.com/giveaway/XXXXX/game-name), [POINTS] for the points and [LEVEL] for the level.</div>
                <br/>
                <div>[POINTS] and [LEVEL] only work if Created/Entered/Won Giveaway Details is enabled and the details have been loaded in the current page.</div>
                <br/>
                <div>For example, the following format would result in a table:</div>
                <br/>
                <div>Steam | Giveaway | Points | Level | Steam Store<br/>:-: | :-: | :-: | :-:<br/>[LINE][[NAME]]([STEAM]) | [SHORT-URL] | [POINTS]P | [LEVEL]+[/LINE]</div>
            `);
            gm.textArea = insertHtml(gm.popout.popout, `beforeEnd`, `<textarea></textarea>`);
            if (esgst.cfh) {
                addCfhPanel(gm.textArea);
            }
            gm.message = insertHtml(gm.popout.popout, `beforeEnd`, `<div class="esgst-description"></div>`);
            gm.popout.popout.appendChild(new ButtonSet(`grey`, `grey`, `fa-copy`, `fa-circle-o-notch fa-spin`, `Copy`, `Copying...`, copyGmOutput.bind(null, gm)).set);
        }
    }

    function openGmPopup(giveaways, gm, callback) {
        callback();
        if (!gm.popup) {
            gm.popup = new Popup(`fa-search`, `Search & Replace`);
            new ToggleSwitch(insertHtml(gm.popup.description, `afterBegin`, `<div></div>`), `gm_useRegExp`, false, `Use <a class="esgst-bold" href="https://developer.mozilla.org/en/docs/Web/JavaScript/Guide/Regular_Expressions">regular expression</a>.`, false, false, null, esgst.gm_useRegExp);
            gm.replace = insertHtml(gm.popup.description, `afterBegin`, `Replace with: <input type="text">`);
            gm.message = insertHtml(gm.popup.description, `afterBegin`, `<div class="esgst-description esgst-warning"></div>`);
            gm.search = insertHtml(gm.popup.description, `afterBegin`, `Search for: <input type="text">`);
            gm.results = insertHtml(gm.popup.scrollable, `beforeEnd`, `<div class="markdown"><ul></ul></div>`).firstElementChild;
            gm.popup.description.appendChild(new ButtonSet(`green`, `red`, `fa-search`, `fa-times`, `Search & Replace`, `Cancel`, startGmSearch.bind(null, giveaways, gm), cancelGmSearch.bind(null, gm)).set);
            gm.progress = insertHtml(gm.popup.description, `beforeEnd`, `<div></div>`);
        }
        gm.popup.open();
    }

    function startGmSearch(giveaways, gm, callback) {
        var giveaway, i, n;
        gm.canceled = false;
        gm.button.classList.add(`esgst-busy`);
        gm.progress.innerHTML = ``;
        gm.giveaways = [];
        if (!giveaways) {
            giveaways = esgst[gm.context ? `popupGiveaways` : `currentGiveaways`];
        }
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            if (giveaway.gm && !giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                gm.giveaways.push(giveaway);
            }
        }
        if (esgst.gm_useRegExp) {
            try {
                parts = gm.search.value.match(/^\/(.+)\/(.*)$/);
                gm.searchValue = new RegExp(parts[1], parts[2]);
                gm.replaceValue = gm.replace.value;
                gm.message.textContent = ``;
                searchGmGiveawaysAndReplace(gm, 0, gm.giveaways.length, cancelGmSearch.bind(null, gm, callback));
            } catch (error) {
                cancelGmSearch(gm, callback);
                gm.message.textContent = `Invalid regular expression!`;
            }
        } else {
            gm.searchValue = gm.search.value;
            gm.replaceValue = gm.replace.value;
            searchGmGiveawaysAndReplace(gm, 0, gm.giveaways.length, cancelGmSearch.bind(null, gm, callback));
        }
    }

    function searchGmGiveawaysAndReplace(gm, i, n, callback) {
        var description, giveaway, match, responseJson;
        if (!gm.canceled) {
            if (i < n) {
                gm.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Searching & replacing (${i + 1} of ${n})</span>
                `;
                giveaway = gm.giveaways[i];
                request(null, null, `GET`, false, giveaway.url, function (response) {
                    description = parseHtml(response.responseText).querySelector(`.page__description textarea[name=description]`);
                    if (description) {
                        match = description.value.match(gm.searchValue);
                        if (match) {
                            request(`xsrf_token=${esgst.xsrfToken}&do=edit_giveaway_description&giveaway_id=${description.previousElementSibling.value}&description=${encodeURIComponent(description.value.replace(gm.searchValue, gm.replaceValue))}`, null, `POST`, false, `/ajax.php`, function (response) {
                                responseJson = JSON.parse(response.responseText);
                                if (responseJson.type === `success`) {
                                    gm.results.insertAdjacentHTML(`beforeEnd`, `<li>Found and replaced in <a href="${giveaway.url}">${giveaway.name}</a></li>`);
                                    setTimeout(searchGmGiveawaysAndReplace, 0, gm, ++i, n, callback);
                                } else {
                                    gm.results.insertAdjacentHTML(`beforeEnd`, `<li>Found, but failed to replace, in <a href="${giveaway.url}">${giveaway.name}</a></li>`);
                                    setTimeout(searchGmGiveawaysAndReplace, 0, gm, ++i, n, callback);
                                }
                            });
                        } else {
                            gm.results.insertAdjacentHTML(`beforeEnd`, `<li>Not found in <a href="${giveaway.url}">${giveaway.name}</a></li>`);
                            setTimeout(searchGmGiveawaysAndReplace, 0, gm, ++i, n, callback);
                        }
                    } else {
                        gm.results.insertAdjacentHTML(`beforeEnd`, `<li>Not found in <a href="${giveaway.url}">${giveaway.name}</a></li>`);
                        setTimeout(searchGmGiveawaysAndReplace, 0, gm, ++i, n, callback);
                    }
                });
            } else {
                callback();
            }
        }
    }

    function cancelGmSearch(gm, callback) {
        gm.canceled = true;
        gm.progress.innerHTML = ``;
        gm.button.classList.remove(`esgst-busy`);
        if (callback) {
            callback();
        }
    }

    function exportGmEncrypted(giveaways, gm, callback) {
        var encrypted, giveaway, i, n;
        encrypted = [];
        if (!giveaways) {
            giveaways = esgst[gm.context ? `popupGiveaways` : `currentGiveaways`];
        }
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            if (giveaway.gm && !giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                encrypted.push(`[](ESGST-${encryptGedCode(giveaway.code)})`);
            }
        }
        gm.textArea.value = encrypted.join(` `);
        callback();
    }

    function exportGmLinks(giveaways, gm, callback) {
        var giveaway, i, links, n;
        links = [];
        if (!giveaways) {
            giveaways = esgst[gm.context ? `popupGiveaways` : `currentGiveaways`];
        }
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            if (giveaway.gm && !giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                links.push(`[${giveaway.name}](https://www.steamgifts.com/giveaway/${giveaway.code}/)`);
            }
        }
        gm.textArea.value = links.join(`\n`);
        callback();
    }

    function exportGmCustom(giveaways, gm, callback) {
        var giveaway, i, links, n;
        links = [];
        line = gm.textArea.value.match(/\[LINE\](.+)\[\/LINE\]/)[1];
        if (!giveaways) {
            giveaways = esgst[gm.context ? `popupGiveaways` : `currentGiveaways`];
        }
        for (i = 0, n = giveaways.length; i < n; ++i) {
            giveaway = giveaways[i];
            if (giveaway.gm && !giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                links.push(line.replace(/\[TYPE\]/g, giveaway.type.slice(0, -1)).replace(/\[ID\]/g, giveaway.id).replace(/\[STEAM\]/g, `http://store.steampowered.com/${giveaway.type.slice(0, -1)}/${giveaway.id}`).replace(/\[NAME\]/g, giveaway.name).replace(/\[CODE\]/g, giveaway.code).replace(/\[SHORT-URL\]/g, `https://www.steamgifts.com/giveaway/${giveaway.code}/`).replace(/\[URL\]/g, `https://www.steamgifts.com${giveaway.url.match(/\/giveaway\/.+/)[0]}`).replace(/\[POINTS\]/g, giveaway.points).replace(/\[LEVEL\]/g, giveaway.level));
            }
        }
        gm.textArea.value = gm.textArea.value.replace(/\[LINE\].+\[\/LINE\]/, links.join(`\n`));
        callback();
    }

    function copyGmOutput(gm, callback) {
        gm.textArea.select();
        document.execCommand(`copy`);
        callback();
        createFadeMessage(gm.message, `Copied!`);
    }

    function bookmarkGmGiveaways(giveaways, gm, callback) {
        if (!giveaways) {
            giveaways = esgst[gm.context ? `popupGiveaways` : `currentGiveaways`];
        }
        let newGiveaways = {};
        giveaways.forEach(giveaway => {
            if (giveaway.gm && !giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                button = giveaway.outerWrap.getElementsByClassName(`esgst-gb-button`)[0];
                if (button) {
                    newGiveaways[giveaway.code] = {
                        bookmarked: true,
                        code: giveaway.code,
                        endTime: giveaway.endTime,
                        started: giveaway.started
                    };
                    button.remove();
                    addGbUnbookmarkButton(giveaway);
                }
            }
        });
        lockAndSaveGiveaways(newGiveaways, callback);
    }

    function unbookmarkGmGiveaways(giveaways, gm, callback) {
        if (!giveaways) {
            giveaways = esgst[gm.context ? `popupGiveaways` : `currentGiveaways`];
        }
        let newGiveaways = {};
        giveaways.forEach(giveaway => {
            if (giveaway.gm && !giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                button = giveaway.outerWrap.getElementsByClassName(`esgst-gb-button`)[0];
                if (button) {
                    newGiveaways[giveaway.code] = {
                        bookmarked: false
                    };
                    button.remove();
                    addGbBookmarkButton(giveaway);
                }
            }
        });
        lockAndSaveGiveaways(newGiveaways, callback);
    }

    function hideGmGiveaways(giveaways, gm, callback) {
        if (!giveaways) {
            giveaways = esgst[gm.context ? `popupGiveaways` : `currentGiveaways`];
        }
        let newGiveaways = {};
        giveaways.forEach(giveaway => {
            if (giveaway.gm && !giveaway.outerWrap.classList.contains(`esgst-hidden`)) {
                newGiveaways[giveaway.code] = {
                    code: giveaway.code,
                    endTime: giveaway.endTime,
                    hidden: true
                };
                giveaway.outerWrap.remove();
            }
        });
        lockAndSaveGiveaways(newGiveaways, callback);
    }

    function calculateGmGiveaways(giveaways, gm, callback) {
        let nextRefresh, points;
        if (!giveaways) {
            giveaways = esgst[gm.context ? `popupGiveaways` : `currentGiveaways`];
        }
        points = 0;
        giveaways.forEach(giveaway => {
            if (giveaway.gm && !giveaway.outerWrap.classList.contains(`esgst-hidden`) && !giveaway.ended) {
                points += giveaway.points;
            }
        });
        nextRefresh = 60 - new Date().getMinutes();
        while (nextRefresh > 15) {
            nextRefresh -= 15;
        }
        if (points > esgst.points) {
            gm.textArea.value = `You will need to wait ${getTtecTime(Math.round((nextRefresh + (15 * Math.floor((points - esgst.points) / 6))) * 100) / 100)} to enter all selected giveaways for a total of ${points}P.${points > 400 ? `\n\nSince each 400P regeneration takes about 17h, you will need to return in 17h and use all your points so more can be regenerated.` : ``}`;
        } else {
            gm.textArea.value = `You have enough points to enter all giveaways right now.`;
        }
        callback();
    }

    /* [HGR] Hidden Games Remover */

    function openHgrPopup(hgr) {
        if (!hgr.popup) {
            hgr.popup = new Popup(`fa-times`, `Remove owned games:`);
            hgr.set = new ButtonSet(`green`, `grey`, `fa-arrow-circle-right`, `fa-times`, `Remove`, `Cancel`, startHgrRemover.bind(null, hgr), stopHgrRemover.bind(null, hgr));
            hgr.popup.description.appendChild(hgr.set.set);
            hgr.progress = insertHtml(hgr.popup.description, `beforeEnd`, `<div></div>`);
            hgr.removed = insertHtml(hgr.popup.scrollable, `beforeEnd`, `<div class="markdown"></div>`);
        }
        hgr.popup.open();
    }

    function startHgrRemover(hgr, callback) {
        hgr.canceled = false;
        hgr.button.classList.add(`esgst-busy`);
        hgr.progress.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <span>Removing games...</span>
        `;
        hgr.removed.innerHTML = `<span class="esgst-bold">Removed Games:</span>`;
        removeHgrGames(null, esgst.currentPage, hgr, 1, `/account/settings/giveaways/filters/search?page=`, completeHgrProcess.bind(null, hgr, callback));
    }

    function removeHgrGames(context, currentPage, hgr, nextPage, url, callback) {
        var button, element, elements, game, heading, i, info, n, pagination;
        if (!hgr.canceled) {
            if (currentPage === nextPage) {
                context = document;
                ++nextPage;
            }
            while (document.getElementsByClassName(`esgst-es-page-${nextPage}}`)[0]) {
                ++nextPage;
            }
            if (context) {
                if (nextPage === 1) {
                    hgr.lastPage = getLastPage(context);
                    hgr.lastPage = hgr.lastPage === 999999999 ? `` : ` of ${hgr.lastPage}`;
                } else if (!hgr.lastPage) {
                    hgr.lastPage = ``;
                }
                hgr.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Removing games (page ${nextPage - 1}${hgr.lastPage})...</span>
                `;
                elements = context.getElementsByClassName(`table__row-outer-wrap`)
                for (i = 0, n = elements.length; i < n; ++i) {
                    element = elements[i];
                    info = getGameInfo(element);
                    if (info) {
                        game = esgst.games[info.type][info.id];
                        if (game && game.owned) {
                            button = element.getElementsByClassName(`table__remove-default`)[0];
                            if (context === document) {
                                button.click();
                            } else {
                                request(`xsrf_token=${esgst.xsrfToken}&do=remove_filter&game_id=${button.parentElement.querySelector(`[name="game_id"]`).value}`, null, `POST`, false, `/ajax.php`);
                            }
                            heading = element.getElementsByClassName(`table__column__heading`)[0];
                            hgr.removed.insertAdjacentHTML(`beforeEnd`, `
                                <a href="http://store.steampowered.com/${info.type.slice(0, -1)}/${info.id}">${heading.textContent}</a>
                            `);
                        }
                    }
                }
                pagination = context.getElementsByClassName(`pagination__navigation`)[0];
                if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(removeHgrGames, 0, null, currentPage, hgr, nextPage, url, callback);
                } else {
                    callback();
                }
            } else if (!hgr.canceled) {
                request(null, null, `GET`, false, `${url}${nextPage}`, getNextHgrPage.bind(null, currentPage, hgr, nextPage, url, callback));
            }
        }
    }

    function getNextHgrPage(currentPage, hgr, nextPage, url, callback, response) {
        setTimeout(removeHgrGames, 0, parseHtml(response.responseText), currentPage, hgr, ++nextPage, url, callback);
    }

    function completeHgrProcess(hgr, callback) {
        hgr.button.classList.remove(`esgst-busy`);
        hgr.progress.innerHTML = ``;
        if (hgr.removed.children.length === 1) {
            hgr.removed.innerHTML = `<span class="esgst-bold">0 games removed.</span>`;
        }
        callback();
    }

    function stopHgrRemover(hgr) {
        hgr.canceled = true;
        hgr.button.classList.remove(`esgst-busy`);
        hgr.progress.innerHTML = ``;
    }

    /* [SAL] Steam Activation Links */

    function addSalObservers(context) {
        var elements, i, n;
        elements = context.getElementsByClassName(`view_key_btn`);
        for (i = 0, n = elements.length; i < n; ++i) {
            addSalObserver(elements[i]);
        }
    }

    function addSalObserver(button) {
        var context, element, interval, match;
        context = button.closest(`.table__row-outer-wrap`);
        button.addEventListener(`click`, function() {
            interval = setInterval(function() {
                if (!context.contains(button)) {
                    clearInterval(interval);
                    element = context.querySelector(`[data-clipboard-text]`);
                    match = element.getAttribute(`data-clipboard-text`).match(/^[\d\w]{5}(-[\d\w]{5}){2,}$/);
                    if (match) {
                        addSalLink(element, match[0]);
                    }
                }
            }, 100);
        });
    }

    function addSalLinks(context) {
        var i, element, elements, match, n;
        elements = context.querySelectorAll(`[data-clipboard-text]`);
        for (i = 0, n = elements.length; i < n; ++i) {
            element = elements[i];
            match = element.getAttribute(`data-clipboard-text`).match(/^[\d\w]{5}(-[\d\w]{5}){2,}$/);
            if (match) {
                addSalLink(element, match[0]);
            }
        }
    }

    function addSalLink(element, match) {
        var link, textArea;
        if ((element.nextElementSibling && !element.nextElementSibling.classList.contains(`esgst-sal`)) || !element.nextElementSibling) {
            link = insertHtml(element, `afterEnd`, `
                <span></span>
            `);
            switch (esgst.sal_index) {
                case 0:
                    insertHtml(link, `beforeEnd`, `
                        <span class="esgst-sal esgst-clickable" title="Activate on Steam (client)">
                            <i class="fa fa-steam"></i>
                        </span>
                    `).addEventListener(`click`, function () {
                        textArea = insertHtml(document.body, `beforeEnd`, `
                            <textarea></textarea>
                        `);
                        textArea.value = match;
                        textArea.select();
                        document.execCommand(`copy`);
                        textArea.remove();
                        location.href = `steam://open/activateproduct`;
                    });
                    break;
                case 1:
                    link.insertAdjacentHTML(`beforeEnd`, `
                        <a class="esgst-sal esgst-clickable" href="https://store.steampowered.com/account/registerkey?key=${match}" target="_blank" title="Activate on Steam (browser)">
                            <i class="fa fa-globe"></i>
                        </a>
                    `);
                    break;
                case 2:
                    insertHtml(link, `beforeEnd`, `
                        <span class="esgst-sal esgst-clickable" title="Activate on Steam (client)">
                            <i class="fa fa-steam"></i>
                        </span>
                        <a class="esgst-sal esgst-clickable" href="https://store.steampowered.com/account/registerkey?key=${match}" target="_blank" title="Activate on Steam (browser)">
                            <i class="fa fa-globe"></i>
                        </a>
                    `).previousElementSibling.addEventListener(`click`, function () {
                        textArea = insertHtml(document.body, `beforeEnd`, `
                            <textarea></textarea>
                        `);
                        textArea.value = match;
                        textArea.select();
                        document.execCommand(`copy`);
                        textArea.remove();
                        location.href = `steam://open/activateproduct`;
                    });
                    break;
            }
        }
    }

    /* [CEWGD] Created/Entered/Won Giveaway Details */

    function addCewgdHeading(context, main) {
        var table;
        if (main) {
            table = context.getElementsByClassName(`table__heading`)[0];
            if (table && !table.getElementsByClassName(`esgst-cewgd-heading`)[0]) {
                ((esgst.gwc || esgst.gwr) && esgst.enteredPath ? table.firstElementChild.nextElementSibling : table.firstElementChild).insertAdjacentHTML(`afterEnd`, `
                    <div class="table__column--width-small text-center esgst-cewgd-heading">Type</div>
                    <div class="table__column--width-small text-center esgst-cewgd-heading">Level</div>
                    ${esgst.createdPath ? `
                        <div class="table__column--width-small text-center esgst-cewgd-heading">Winner(s)</div>
                    ` : ``}
                `);
            }
        }
    }

    function getCewgdDetails(giveaways, main) {
        if (main) {
            let cewgd, i, n;
            n = giveaways.length;
            cewgd = new CompletionCheck(n, () => {
                createLock(`giveawayLock`, 300, deleteLock => {
                    let currentGiveaway, i, key, n, savedGiveaways;
                    getValue(`giveaways`, `{}`).then(value => {
                        savedGiveaways = JSON.parse(value);
                        for (i = 0, n = cewgd.giveaways.length; i < n; ++i) {
                            currentGiveaway = cewgd.giveaways[i];
                            if (savedGiveaways[currentGiveaway.code]) {
                                for (key in currentGiveaway) {
                                    savedGiveaways[currentGiveaway.code][key] = currentGiveaway[key];
                                }
                            } else {
                                savedGiveaways[currentGiveaway.code] = currentGiveaway;
                            }
                        }
                        return setValue(`giveaways`, JSON.stringify(savedGiveaways));
                    }).then(deleteLock);
                });
            });
            cewgd.giveaways = [];
            getValue(`giveaways`, `{}`).then(value => {
                cewgd.savedGiveaways = JSON.parse(value);
                for (i = 0; i < n; ++i) {
                    getCewgdDetail(cewgd, giveaways, i);
                }
            });
        }
    }

    function getCewgdDetail(cewgd, giveaways, i) {
        let code, giveaway;
        giveaway = giveaways[i];
        code = giveaway.code;
        if (cewgd.savedGiveaways[code] && cewgd.savedGiveaways[code].gameSteamId && (!esgst.createdPath || Array.isArray(cewgd.savedGiveaways[code].winners)) && (!esgst.wonPath || cewgd.savedGiveaways[code].creator !== esgst.username)) {
            addCewgdDetails(giveaway, cewgd.savedGiveaways[code]);
            cewgd.count += 1;
        } else if (esgst.createdPath) {
            getCewgdWinners(cewgd, null, giveaway, 1, `${giveaway.url}/winners/search?page=`);
        } else {
            request(null, null, `GET`, false, giveaway.url, function (response) {
                let currentGiveaway, currentGiveaways, responseHtml;
                responseHtml = parseHtml(response.responseText);
                getGiveaways(responseHtml, false, response.finalUrl).then(currentGiveaways => {
                    if (currentGiveaways.length > 0) {
                        currentGiveaway = currentGiveaways[0];
                        cewgd.giveaways.push(currentGiveaway);
                        addCewgdDetails(giveaway, currentGiveaway);
                        cewgd.count += 1;
                    } else {
                        (giveaway.panel || (esgst.gm_enable && esgst.createdPath ? giveaway.innerWrap.firstElementChild.nextElementSibling.nextElementSibling : giveaway.innerWrap.firstElementChild.nextElementSibling)).insertAdjacentHTML(`afterEnd`, `
                            <div class="table__column--width-small text-center">-</div>
                            <div class="table__column--width-small text-center">-</div>
                        `);
                        cewgd.count += 1;
                    }
                });
            });
        }
    }

    function getCewgdWinners(cewgd, currentGiveaway, giveaway, nextPage, url) {
        request(null, null, `GET`, false, `${url}${nextPage}`, response => {
            let responseHtml = parseHtml(response.responseText);
            new Promise((resolve, reject) => {
                if (currentGiveaway) {
                    resolve();
                } else {
                    getGiveaways(responseHtml, false, response.finalUrl).then(currentGiveaways => {
                        if (currentGiveaways.length > 0) {
                            currentGiveaway = currentGiveaways[0];
                            currentGiveaway.winners = [];
                        }
                        resolve();
                    });
                }
            }).then(() => {
                if (currentGiveaway) {
                    let element, elements, i, n, pagination;
                    elements = responseHtml.getElementsByClassName(`table__row-inner-wrap`);
                    for (i = 0, n = elements.length; i < n; ++i) {
                        element = elements[i];
                        currentGiveaway.winners.push({
                            received: element.lastElementChild.textContent.trim() === `Received` ? 1 : 0,
                            username: element.firstElementChild.nextElementSibling.firstElementChild.textContent.trim()
                        });
                    }
                    pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
                    if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                        setTimeout(getCewgdWinners, 0, cewgd, currentGiveaway, giveaway, nextPage + 1, url);
                    } else {
                        cewgd.giveaways.push(currentGiveaway);
                        addCewgdDetails(giveaway, currentGiveaway);
                        cewgd.count += 1;
                    }
                } else {
                    (giveaway.panel || (esgst.gm_enable && esgst.createdPath ? giveaway.innerWrap.firstElementChild.nextElementSibling.nextElementSibling : giveaway.innerWrap.firstElementChild.nextElementSibling)).insertAdjacentHTML(`afterEnd`, `
                        <div class="table__column--width-small text-center">-</div>
                        <div class="table__column--width-small text-center">-</div>
                        <div class="table__column--width-small text-center">-</div>
                    `);
                    cewgd.count += 1;
                }
            });
        });
    }

    function addCewgdDetails(giveaway, details) {
        let type, typeColumn;
        giveaway.points = details.points;
        giveaway.level = details.level;
        giveaway.headingName.insertAdjacentHTML(`beforeEnd`, `
            <span>(${details.points}P)</span>
            <a class="giveaway__icon" href="http://store.steampowered.com/${details.gameType.slice(0, -1)}/${details.gameSteamId}" target="_blank">
                <i class="fa fa-steam"></i>
            </a>
        `);
        if (details.inviteOnly) {
            if (details.regionRestricted) {
                type = `Invite + Region`;
            } else {
                type = `Invite`;
            }
        } else if (details.group) {
            if (details.whitelist) {
                if (details.regionRestricted) {
                    type = `Group + Whitelist + Region`;
                } else {
                    type = `Group + Whitelist`;
                }
            } else if (details.regionRestricted) {
                type = `Group + Region`;
            } else {
                type = `Group`;
            }
        } else if (details.whitelist) {
            if (details.regionRestricted) {
                type = `Whitelist + Region`;
            } else {
                type = `Whitelist`;
            }
        } else if (details.regionRestricted) {
            type = `Region`;
        } else {
            type = `Public`;
        }
        typeColumn = insertHtml(giveaway.panel || giveaway.innerWrap.firstElementChild.nextElementSibling, `afterEnd`, `
            <div class="table__column--width-small text-center">${type}</div>
            <div class="table__column--width-small text-center">${details.level}</div>
            ${esgst.createdPath ? `
                <div class="table__column--width-small text-center"></div>
            ` : ``}
        `);
        if (esgst.createdPath) {
            let n, winner, winnersColumn;
            winnersColumn = typeColumn.nextElementSibling.nextElementSibling;
            n = details.winners.length;
            if (n > 0) {
                if (n > 1) {
                    winner = details.winners[0].username;
                    winnersColumn.innerHTML = `<a class="table__column__secondary-link" href="/user/${winner}">${winner}</a> <span class="esgst-clickable table__column__secondary-link">(+${n - 1} more)</span>`;
                    winnersColumn.lastElementChild.addEventListener(`click`, () => {
                        let html, popup;
                        popup = new Popup(`fa-users`, `Winners`);
                        html = `
                            <div class="table__heading">
                                <div class="table__column--width-small">Winner</div>
                                <div class="table__column--width-small">Received</div>
                            </div>
                            <div class="table__rows">
                        `;
                        details.winners.forEach(winner => {
                            html += `
                                <div class="table__row-outer-wrap">
                                    <div class="table__row-inner-wrap">
                                        <div class="table__column--width-small">
                                            <a class="table__column__secondary-link" href="/user/${winner.username}">${winner.username}</a>
                                        </div>
                                        <div class="table__column--width-small">
                                        ${winner.received ? `
                                            <i class="fa fa-check-circle esgst-green"></i>
                                        ` : `
                                            <i class="fa fa-times-circle esgst-red"></i>
                                        `}
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        html += `
                            </div>
                        `;
                        popup.scrollable.innerHTML = html;
                        popup.open();
                        loadEndlessFeatures(popup.scrollable);
                    });
                    let received = 0;
                    details.winners.forEach(winner => {
                        if (winner.received) {
                            received += 1;
                        }
                    });
                    giveaway.innerWrap.lastElementChild.insertAdjacentText(`beforeEnd`, ` (${received}/${n})`);
                } else {
                    winner = details.winners[0].username;
                    winnersColumn.innerHTML = `<a class="table__column__secondary-link" href="/user/${winner}">${winner}</a>`;
                }
            } else {
                winnersColumn.textContent = `-`;
            }
        } else if (esgst.enteredPath || esgst.wonPath) {
            giveaway.endTimeColumn.insertAdjacentHTML(`beforeEnd`, `
                by <a class="table__column__secondary-link" href="/user/${details.creator}">${details.creator}</a>
            `);
        }
        if (type.match(/Group/) && esgst.ggl) {
            giveaway.group = true;
            getGglGiveaways([giveaway]);
        }
    }

    /* [ITADI] Is There Any Deal? Info */

    function getItadiInfo(giveaways, main) {
        var game, games, giveaway, loading, plain;
        if (main) {
            giveaway = giveaways[0];
            if (giveaway) {
                getValue(`games`).then(value => {
                    games = JSON.parse(value);
                    game = games[giveaway.type][giveaway.id];
                    plain = getItadiPlain(giveaway.name);
                    if (game && game.itadi && ((esgst.itadi_h && typeof game.itadi.historical !== `undefined`) || !esgst.itadi_h) && (Date.now() - game.itadi.lastCheck < 86400000)) {
                        addItadiInfo(game.itadi, plain);
                    } else {
                        loading = insertHtml(esgst.sidebar, `beforeEnd`, `
                            <h3 class="sidebar__heading">
                                <i class="fa fa-circle-o-notch fa-spin"></i> Loading Is There Any Deal? info...
                            </h3>
                        `);
                        request(null, null, `GET`, true, `https://isthereanydeal.com/ajax/game/info?plain=${plain}`, function (infoResponse) {
                            if (esgst.itadi_h) {
                                request(null, null, `GET`, true, `https://isthereanydeal.com/ajax/game/price?plain=${plain}`, function (priceResponse) {
                                    loadItadiInfo(giveaway, infoResponse, loading, plain, priceResponse);
                                });
                            } else {
                                loadItadiInfo(giveaway, infoResponse, loading, plain);
                            }
                        });
                    }
                });
            }
        }
    }

    function loadItadiInfo(giveaway, infoResponse, loading, plain, priceResponse) {
        var bundles, current, currentBundle, currentBundles, currentDeal, currentDeals, date, deals, found, games, heading, headings, historical, i, infoHtml, itadi, n, name, parent, priceHtml, tag;
        infoHtml = parseHtml(infoResponse.responseText);
        deals = [];
        currentDeals = infoHtml.getElementsByClassName(`new`);
        n = currentDeals.length;
        if (n > 0) {
            for (i = 0; i < n; ++i) {
                currentDeal = currentDeals[i];
                deals.push({
                    price: currentDeal.textContent,
                    source: currentDeal.closest(`.row`).firstElementChild.firstElementChild.textContent
                });
            }
            deals.sort(function (a, b) {
                a = parseFloat(a.price.replace(/(\$|\|\)/, ``));
                b = parseFloat(b.price.replace(/(\$|\|\)/, ``));
                if (a < b) {
                    return -1;
                } else if (a > b) {
                    return 1;
                } else {
                    return 0;
                }
            });
            current = deals[0];
        } else {
            current = null;
        }
        if (esgst.itadi_h && priceResponse) {
            priceHtml = parseHtml(priceResponse.responseText);
            headings = priceHtml.getElementsByTagName(`th`);
            n = headings.length;
            if (n > 0) {
                found = false;
                for (i = 0; i < n && !found; ++i) {
                    heading = headings[i];
                    if (heading.textContent === `Lowest price`) {
                        found = true;
                        parent = heading.parentElement;
                        historical = {
                            date: parent.getElementsByClassName(`date`)[0].textContent,
                            price: parent.getElementsByClassName(`primary`)[0].textContent,
                            source: parent.getElementsByClassName(`shopTitle`)[0].textContent
                        };
                    }
                }
                if (!found) {
                    historical = null;
                }
            } else {
                historical = null;
            }
        } else {
            historical = null;
        }
        bundles = [];
        currentBundles = infoHtml.getElementsByClassName(`bundle-head`);
        n = currentBundles.length;
        if (n > 0) {
            for (i = 0; i < n; ++i) {
                currentBundle = currentBundles[i];
                tag = currentBundle.firstElementChild;
                if (tag.textContent === `bundle`) {
                    date = tag.nextElementSibling;
                    name = date.nextElementSibling.firstElementChild;
                    bundles.push({
                        date: date.textContent.replace(/expired\s/, ``),
                        id: name.getAttribute(`href`).match(/\d+/)[0],
                        name: name.textContent
                    });
                }
            }
            if (!bundles.length) {
                bundles = null;
            }
        } else {
            bundles = null;
        }
        itadi = {
            bundles: bundles,
            current: current,
            historical: historical,
            lastCheck: Date.now()
        };
        createLock(`gameLock`, 300, function (deleteLock) {
            getValue(`games`).then(value => {
                games = JSON.parse(value);
                if (!games[giveaway.type][giveaway.id]) {
                    games[giveaway.type][giveaway.id] = {};
                }
                games[giveaway.type][giveaway.id].itadi = itadi;
                return setValue(`games`, JSON.stringify(games));
            }).then(() => {
                deleteLock();
                loading.remove();
                addItadiInfo(itadi, plain);
            });
        });
    }

    function addItadiInfo(itadi, plain) {
        var bundle, bundlesHtml, bundlesItem, currentHtml, currentItem, historicalHtml, historicalItem, i, n;
        if (itadi.current) {
            currentItem = `
                <li class="sidebar__navigation__item">
                    <a class="sidebar__navigation__item__link" href="https://isthereanydeal.com/#/page:game/info?plain=${plain}">
                        <div class="sidebar__navigation__item__name">${itadi.current.source}</div>
                        <div class="sidebar__navigation__item__underline"></div>
                        <div class="sidebar__navigation__item__count">${itadi.current.price}</div>
                    </a>
                </li>
            `;
        } else {
            currentItem = `There are no current deals for this game.`;
        }
        currentHtml = `
            <h3 class="sidebar__heading">Best Current Deal</h3>
            <ul class="sidebar__navigation">
                ${currentItem}
            </ul>
        `;
        if (esgst.itadi_h) {
            if (itadi.historical) {
                historicalItem = `
                    <li class="sidebar__navigation__item">
                        <a class="sidebar__navigation__item__link" href="https://isthereanydeal.com/#/page:game/price?plain=${plain}">
                            <div class="sidebar__navigation__item__name">${itadi.historical.source}</div>
                            <div class="sidebar__navigation__item__underline"></div>
                            <div class="sidebar__navigation__item__count">${itadi.historical.price} (${itadi.historical.date})</div>
                        </a>
                    </li>
                `;
            } else {
                historicalItem = `There is no price history for this game.`;
            }
            historicalHtml = `
                <h3 class="sidebar__heading">Historical Lowest Price</h3>
                <ul class="sidebar__navigation">
                    ${historicalItem}
                </ul>
            `;
        } else {
            historicalHtml = ``;
        }
        if (itadi.bundles) {
            bundlesItem = ``;
            for (i = 0, n = itadi.bundles.length; i < n; ++i) {
                bundle = itadi.bundles[i];
                bundlesItem += `
                    <li class="sidebar__navigation__item">
                        <a class="sidebar__navigation__item__link" href="https://isthereanydeal.com/specials/#/filter:id/${bundle.id}">
                            <div class="sidebar__navigation__item__name">${bundle.name}</div>
                            <div class="sidebar__navigation__item__underline"></div>
                            <div class="sidebar__navigation__item__count">${bundle.date}</div>
                        </a>
                    </li>
                `;
            }
        } else {
            bundlesItem = `This game has never been in a bundle.`;
        }
        bundlesHtml = `
            <h3 class="sidebar__heading">Bundles</h3>
            <ul class="sidebar__navigation">
                ${bundlesItem}
            </ul>
        `;
        esgst.sidebar.insertAdjacentHTML(`beforeEnd`, `
            ${currentHtml}${historicalHtml}${bundlesHtml}
        `);
    }

    function getItadiPlain(name) {
        var numbers;
        numbers = [`0`, `i`, `ii`, `iii`, `iv`, `v`, `vi`, `vii`, `viii`, `ix`];
        return name.toLowerCase().replace(/\sthe|the\s/g, ``).replace(/\s/g, ``).replace(/\d/g, function (m) {
            return numbers[m];
        }).replace(/\&/g, `and`).replace(/\+/g, `plus`).replace(/[^\d\w]/g, ``);
    }

    /* [DKC] Delete Keys Confirmation */

    function getDkcLinks(context) {
        var i, link, links, newLink;
        links = context.getElementsByClassName(`form__key-btn-delete`);
        for (i = links.length - 1; i > -1; --i) {
            link = links[i];
            newLink = insertHtml(link, `afterEnd`, `
                <span class="table__column__secondary-link esgst-clickable">Delete</span>
            `);
            link.remove();
            newLink.addEventListener(`click`, createConfirmation.bind(null, `Are you sure you want to delete this key?`, deleteDkcKey.bind(null, newLink), null));
        }
    }

    function deleteDkcKey(link) {
        var row;
        row = link.closest(`.table__row-inner-wrap`);
        row.getElementsByClassName(`form__key-read`)[0].classList.add(`is-hidden`);
        row.getElementsByClassName(`form__key-loading`)[0].classList.remove(`is-hidden`);
        row.querySelector(`[name="key_value"]`).value = ``;
        row.getElementsByClassName(`form__key-value`)[0].textContent = ``;
        request(`xsrf_token=${esgst.xsrfToken}&do=set_gift_key&key_value=&winner_id=${row.querySelector(`[name="winner_id"]`).value}`, null, `POST`, false, `/ajax.php`, function () {
            row.getElementsByClassName(`form__key-loading`)[0].classList.add(`is-hidden`);
            row.getElementsByClassName(`form__key-insert`)[0].classList.remove(`is-hidden`);
            row.getElementsByClassName(`js__sent-text`)[0].textContent = `Sent Gift`;
            row.getElementsByClassName(`js__sent-text`)[1].textContent = `Sent Gift`;
        });
    }

    /* [NPTH] Next/Previous Train Hotkeys */

    function loadNpth() {
        var description, element, elements, i, n, next, previous, text;
        if (esgst.giveawayCommentsPath) {
            description = document.getElementsByClassName(`page__description`)[0];
            if (description) {
                elements = description.querySelectorAll(`[href*="/giveaway/"]`);
                n = elements.length;
                for (i = 0; i < n && (!previous || !next); ++i) {
                    element = elements[i];
                    text = element.textContent.toLowerCase();
                    if (!previous && text.match(/back|last|less|prev|<|/)) {
                        previous = element;
                    } else if (!next && text.match(/forw|more|next|>|/)) {
                        next = element;
                    }
                }
                if (!previous || !next) {
                    if (n > 1) {
                        previous = elements[0];
                        next = elements[1];
                    } else {
                        next = elements[0];
                    }
                }
                if (previous || next) {
                    document.addEventListener(`keydown`, loadNpthGiveaway.bind(null, next, previous));
                }
            }
        }
    }

    function loadNpthGiveaway(next, previous, event) {
        var referrer;
        if (!event.target.closest(`input, textarea`)) {
            if (event.key === esgst.npth_previousKey) {
                if (previous) {
                    if (event.ctrlKey) {
                        open(previous.getAttribute(`href`));
                    } else {
                        location.href = previous.getAttribute(`href`);
                    }
                } else {
                    referrer = document.referrer;
                    if (referrer.match(/\/giveaway\//) && ((next && referrer !== next.getAttribute(`href`)) || !next)) {
                        if (event.ctrlKey) {
                            open(referrer);
                        } else {
                            location.href = referrer;
                        }
                    } else {
                        createAlert(`No previous link found.`);
                    }
                }
            } else if (event.key === esgst.npth_nextKey) {
                if (next) {
                    if (event.ctrlKey) {
                        open(next.getAttribute(`href`));
                    } else {
                        location.href = next.getAttribute(`href`);
                    }
                } else {
                    createAlert(`No next link found.`);
                }
            }
        }
    }

    /* [GE] Giveaways Extractor */

    function getParameters() {
        let parameters = {};
        location.search.replace(/^\?/, ``).split(/&/).forEach(item => {
            item = item.split(/=/);
            parameters[item[0]] = item[1];
        });
        return parameters;
    }

    function loadGe() {
        if (((esgst.giveawayCommentsPath && !document.getElementsByClassName(`table--summary`)[0]) || esgst.discussionPath) && (document.querySelector(`[href*="/giveaway/"]`) || document.querySelector(`[href*="sgtools.info/giveaways/"]`))) {
            let key, position;
            if (esgst.leftButtonIds.indexOf(`ge`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            let ge = {
                button: insertHtml(esgst.hideButtons && esgst.hideButtons_ge ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button" id="esgst-ge" title="Extract giveaways">
                        <i class="fa fa-gift"></i>
                        <i class="fa fa-search"></i>
                    </div>
                `)
            };
            ge.button.addEventListener(`click`, () => {
                if (esgst.ge_t) {
                    open(`/esgst/extracted-giveaways?url=${location.pathname.match(/^\/(giveaway|discussion)\/.+?\//)[0]}`);
                } else {
                    openGePopup(ge);
                }
            });
        } else if (esgst.gePath) {
            request(null, null, `GET`, false, getParameters().url, response => {
                let ge = {
                    context: parseHtml(response.responseText)
                };
                openGePopup(ge);
            });
        }
    }

    function openGePopup(ge) {
        if (!ge.popup) {
            ge.count = 0;
            ge.total = 0;
            ge.sgtools = [];
            ge.extracted = [];
            ge.bumpLink = ``;
            ge.points = 0;
            ge.isDivided = esgst.gc_gi || esgst.gc_r || esgst.gc_rm || esgst.gc_ea || esgst.gc_tc || esgst.gc_a || esgst.gc_mp || esgst.gc_sc || esgst.gc_l || esgst.gc_m || esgst.gc_dlc || esgst.gc_g;
            if (esgst.gePath) {
                ge.popup = {
                    description: esgst.mainContext,
                    scrollable: esgst.mainContext,
                    open: () => {},
                    reposition: () => {}
                };
            } else {
                ge.popup = new Popup(`fa-gift`, `Extracted giveaways:`);
            }
            ge.results = insertHtml(ge.popup.scrollable, `beforeEnd`, `<div class="esgst-text-left"></div>`);
            if ((esgst.gf && esgst.gf_m) || esgst.gm) {
                let heading = insertHtml(ge.popup.scrollable, `afterBegin`, `
                    <div class="page__heading"></div>
                `);
                if (esgst.gf && esgst.gf_m) {
                    heading.appendChild(addGfContainer(heading, `Ge`));
                }
                if (esgst.gm) {
                    loadGm(heading);
                }
            }
            ge.set = new ButtonSet(`green`, `grey`, `fa-search`, `fa-times`, `Extract`, `Cancel`, callback => {
                if (ge.callback) {
                    ge.results.insertAdjacentHTML(`beforeEnd`, `<div></div>`);
                    ge.callback();
                } else {
                    ge.isCanceled = false;
                    if (ge.button) {
                        ge.button.classList.add(`esgst-busy`);
                    }
                    ge.progress.innerHTML = `
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        <span>${ge.total}</span> giveaways extracted.
                    `;
                    ge.results.insertAdjacentHTML(`beforeEnd`, `<div></div>`);
                    ge.mainCallback = callback;
                    let giveaways = getGeGiveaways(ge, esgst.gePath ? ge.context : document);
                    extractGeGiveaways(ge, giveaways, 0, giveaways.length, completeGeExtraction.bind(null, ge, callback));
                }
            }, () => {
                ge.isCanceled = true;
                completeGeExtraction(ge);
            });
            ge.popup.description.appendChild(ge.set.set);
            ge.progress = insertHtml(ge.popup.description, `beforeEnd`, `<div></div>`);
            if (esgst.es_ge) {
                ge.popup.scrollable.addEventListener(`scroll`, () => {
                    if (ge.popup.scrollable.scrollTop + ge.popup.scrollable.offsetHeight >= ge.popup.scrollable.scrollHeight && ge.set && !ge.set.busy) {
                        ge.set.trigger();
                    }
                });
            }
            ge.set.trigger();
        }
        ge.popup.open();
    }

    function extractGeGiveaways(ge, giveaways, i, n, callback) {
        if (!ge.isCanceled) {
            if (i < n) {
                extractGeGiveaway(ge, giveaways[i], setTimeout.bind(null, extractGeGiveaways, 0, ge, giveaways, ++i, n, callback));
            } else {
                callback();
            }
        }
    }

    function extractGeGiveaway(ge, code, callback) {
        if (!ge.isCanceled) {
            if (ge.isDivided && ge.count === 50) {
                let children, filtered, i;
                ge.mainCallback();
                ge.count = 0;
                loadEndlessFeatures(ge.results.lastElementChild, false, `ge`).then(() => {
                    ge.set.set.firstElementChild.lastElementChild.textContent = `Extract More`;
                    ge.progress.firstElementChild.remove();
                    ge.callback = extractGeGiveaway.bind(null, ge, code, callback);
                    filtered = false;
                    children = ge.results.lastElementChild.children;
                    for (i = children.length - 1; i > -1 && !filtered; --i) {
                        if (children[i].firstElementChild.classList.contains(`esgst-hidden`)) {
                            filtered = true;
                        }
                    }
                    if ((esgst.es_ge && ge.popup.scrollable.scrollHeight <= ge.popup.scrollable.offsetHeight) || filtered) {
                        ge.set.trigger();
                    }
                });
            } else {
                if (ge.extracted.indexOf(code) < 0) {
                    request(null, null, `GET`, false, `/giveaway/${code}/`, response => {
                        let bumpLink, button, context, giveaway, giveaways, n, responseHtml;
                        responseHtml = parseHtml(response.responseText);
                        giveaway = buildGiveaway(responseHtml, response.finalUrl);
                        if (giveaway) {
                            giveaway = getGiveawayInfo(insertHtml(ge.results.lastElementChild, `beforeEnd`, giveaway.html).firstElementChild, document, esgst.games).giveaway;
                            if (giveaway.public && esgst.ge_p) {
                                giveaway.outerWrap.classList.add(`esgst-ge-public`);
                                giveaway.summary.classList.add(`esgst-ge-public`);
                            }
                            if ((giveaway.group || giveaway.whitelist) && esgst.ge_g) {
                                giveaway.outerWrap.classList.add(`esgst-ge-group`);
                                giveaway.summary.classList.add(`esgst-ge-group`);
                            }
                            button = responseHtml.getElementsByClassName(`sidebar__error`)[0];
                            if (button) {
                                giveaway.outerWrap.setAttribute(`data-error`, button.textContent);
                            }
                            ge.points += giveaway.points;
                            ge.count += 1;
                            ge.total += 1;
                            ge.progress.innerHTML = `
                                <i class="fa fa-circle-o-notch fa-spin"></i>
                                <span>${ge.total}</span> giveaways extracted.
                            `;
                            ge.extracted.push(code);
                            if (!ge.bumpLink) {
                                bumpLink = responseHtml.querySelector(`[href*="/discussion/"]`);
                                if (bumpLink) {
                                    ge.bumpLink = bumpLink.getAttribute(`href`);
                                }
                            }
                            giveaways = getGeGiveaways(ge, responseHtml);
                            n = giveaways.length;
                            if (n > 0) {
                                setTimeout(extractGeGiveaways, 0, ge, giveaways, 0, n, callback);
                            } else {
                                callback();
                            }
                        } else {
                            request(null, null, `GET`, false, `/giveaway/${code}/`, response => {
                                let bumpLink, context, giveaway, giveaways, n, responseHtml;
                                responseHtml = parseHtml(response.responseText);
                                giveaway = buildGiveaway(responseHtml, response.finalUrl);
                                if (giveaway) {
                                    giveaway = getGiveawayInfo(insertHtml(ge.results.lastElementChild, `beforeEnd`, giveaway.html).firstElementChild, document, esgst.games).giveaway;
                                    giveaway.outerWrap.setAttribute(`data-blacklist`, true);
                                    if (esgst.ge_b) {
                                        giveaway.outerWrap.classList.add(`esgst-ge-blacklist`);
                                        giveaway.summary.classList.add(`esgst-ge-blacklist`);
                                    }
                                    ge.points += giveaway.points;
                                }
                                ge.count += 1;
                                ge.total += 1;
                                ge.progress.innerHTML = `
                                    <i class="fa fa-circle-o-notch fa-spin"></i>
                                    <span>${ge.total}</span> giveaways extracted.
                                `;
                                ge.extracted.push(code);
                                if (!ge.bumpLink) {
                                    bumpLink = responseHtml.querySelector(`[href*="/discussion/"]`);
                                    if (bumpLink) {
                                        ge.bumpLink = bumpLink.getAttribute(`href`);
                                    }
                                }
                                giveaways = getGeGiveaways(ge, responseHtml);
                                n = giveaways.length;
                                if (n > 0) {
                                    setTimeout(extractGeGiveaways, 0, ge, giveaways, 0, n, callback);
                                } else {
                                    callback();
                                }
                            }, true);
                        }
                    });
                } else {
                    callback();
                }
            }
        }
    }

    function getGeGiveaways(ge, context) {
        let code, count, element, elements, giveaways, i, match, n, next, url;
        elements = context.querySelectorAll(`[href*="sgtools.info/giveaways/"]`);
        for (i = 0, n = elements.length; i < n; ++i) {
            url = elements[i].getAttribute(`href`);
            code = url.match(/\/giveaways\/(.+)/)[1];
            if (ge.extracted.indexOf(code) < 0) {
                ge.sgtools.push({
                    code: code,
                    element: insertHtml(ge.results, `afterBegin`, `
                        <div class="markdown esgst-text-center">
                            <a href="${url}">${url}</a>
                        </div>
                    `).firstElementChild
                });
                ge.extracted.push(code);
            }
        }
        giveaways = [];
        if (context === ge.context) {
            match = getParameters().url.match(/\/giveaway\/(.+?)\//);
            if (match) {
                giveaways.push(match[1]);
            }
        } else if (context === document && esgst.giveawayPath) {
            giveaways.push(location.href.match(/\/giveaway\/(.+?)\//)[1]);
        }
        elements = context.querySelectorAll(`.markdown [href*="/giveaway/"]`);
        next = {
            code: null,
            count: 0
        };
        for (i = 0, n = elements.length; i < n; ++i) {
            element = elements[i];
            code = element.getAttribute(`href`).match(/\/giveaway\/(.+?)(\/.*)?$/)[1];
            if (!esgst.ge_o || esgst.discussionPath || element.textContent.toLowerCase().match(/forw|more|next|>|/)) {
                if (ge.extracted.indexOf(code) < 0 && giveaways.indexOf(code) < 0) {
                    giveaways.push(code);
                }
            } else {
                match = element.textContent.match(/\d+/);
                if (match) {
                    count = parseInt(match[0]);
                    if (count > next.count && ge.extracted.indexOf(code) < 0 && giveaways.indexOf(code) < 0) {
                        next.code = code;
                        next.count = count;
                    }
                }
            }
        }
        if (next.count > 0) {
            giveaways.push(next.code);
        }
        return giveaways;
    }

    function completeGeExtraction(ge, callback) {
        if (ge.button) {
            ge.button.classList.remove(`esgst-busy`);
        }
        ge.progress.firstElementChild.remove();
        if (callback) {
            callback();
        }
        loadEndlessFeatures(ge.results.lastElementChild, false, `ge`).then(() => {
            if (ge.sgtools.length > 0) {
                ge.sgtools.forEach(giveaway => {
                    request(null, null, `GET`, false, `http://www.sgtools.info/giveaways/${giveaway.code}`, response => {
                        let context = parseHtml(response.responseText).getElementsByClassName(`featured__outer-wrap`)[0];
                        giveaway.element.textContent = `${context.getElementsByClassName(`featured__heading`)[0].textContent.trim()} - Level ${context.getElementsByClassName(`featured__column--contributor-level`)[0].textContent.match(/\d+/)[0]} (SGTools)`;
                    });
                });
            }
            let html = `
                <div class="markdown esgst-text-center">
                    ${ge.bumpLink && !esgst.discussionPath ? `
                        <h2>
                            <a href="${ge.bumpLink}">Bump</a>
                        </h2>
                    ` : ``}
                    ${ge.points}P required to enter all giveaways.
                </div>
            `;
            ge.results.insertAdjacentHTML(`afterBegin`, html);
            ge.results.insertAdjacentHTML(`beforeEnd`, html);
            ge.set.set.remove();
            ge.set = null;
        });
    }

    /* [CEC] Comments/Entries Checker */

    function openCecPopup(cec) {
        if (!cec.popup) {
            cec.popup = new Popup(`fa-question`, `Check Comments/Entries`);
            cec.set = new ButtonSet(`green`, `grey`, `fa-arrow-right`, `fa-times`, `Check`, `Cancel`, callback => {
                cec.button.classList.add(`esgst-busy`);
                cec.canceled = false;
                cec.comments = [];
                cec.entries = [];
                getCecComments(cec, null, 0, 0, 1, `/giveaway/${location.pathname.match(/\/giveaway\/(.+?)\//)[1]}/`, url => {
                    getCecEntries(cec, 1, `${url.replace(/\/search\?page=/, ``)}/entries/search?page=`, () => {
                        let both, commented, entered, total;
                        cec.set.set.remove();
                        cec.button.classList.remove(`esgst-busy`);
                        cec.progress.innerHTML = ``;
                        cec.comments = Array.from(new Set(cec.comments)).sort((a, b) => {
                            return a.localeCompare(b, {
                                sensitivity: `base`
                            });
                        });
                        cec.entries = Array.from(new Set(cec.entries)).sort((a, b) => {
                            return a.localeCompare(b, {
                                sensitivity: `base`
                            });
                        });
                        both = [];
                        commented = [];
                        entered = [];
                        cec.comments.forEach(user => {
                            if (cec.entries.indexOf(user) > -1) {
                                both.push(`<a href="/user/${user}">${user}</a>`);
                            } else {
                                commented.push(`<a href="/user/${user}">${user}</a>`);
                            }
                        });
                        total = cec.comments.length;
                        cec.entries.forEach(user => {
                            if (cec.comments.indexOf(user) < 0) {
                                entered.push(`<a href="/user/${user}">${user}</a>`);
                                total += 1;
                            }
                        });
                        cec.popup.scrollable.insertAdjacentHTML(`beforeEnd`, `
                            ${both.length > 0 ? `
                                <div>
                                    <span class="esgst-bold">${both.length} user${both.length > 1 ? `s` : ``} commented and entered (${Math.round(both.length / total * 10000) / 100}%):</span> ${both.join(`, `)}
                                </div>
                            ` : ``}
                            ${commented.length > 0 ? `
                                <div>
                                    <span class="esgst-bold">${commented.length} user${commented.length > 1 ? `s` : ``} commented but did not enter (${Math.round(commented.length / total * 10000) / 100}%):</span> ${commented.join(`, `)}
                                </div>
                            ` : ``}
                            ${entered.length > 0 ? `
                                <div>
                                    <span class="esgst-bold">${entered.length} user${entered.length > 1 ? `s` : ``} entered but did not comment (${Math.round(entered.length / total * 10000) / 100}%):</span> ${entered.join(`, `)}
                                </div>
                            ` : ``}
                        `);
                    });
                });
            }, () => {
                cec.canceled = true;
                cec.button.classList.remove(`esgst-busy`);
                cec.progress.innerHTML = ``;
            });
            cec.popup.description.appendChild(cec.set.set);
            cec.progress = insertHtml(cec.popup.description, `beforeEnd`, `<div></div>`);
            cec.set.trigger();
        }
        cec.popup.open();
    }

    function getCecComments(cec, discussions, i, n, nextPage, url, callback) {
        if (!cec.canceled) {
            cec.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Retrieving ${discussions ? `bumps ` : `comments `} (page ${nextPage})...</span>
            `;
            request(null, null, `GET`, true, `${url}${nextPage}`, response => {
                let elements, j, pagination, responseHtml;
                responseHtml = parseHtml(response.responseText);
                elements = responseHtml.querySelectorAll(`.comment:not(.comment--submit) .comment__username:not(.comment__username--op):not(.comment__username--deleted)`);
                for (j = elements.length - 1; j > -1; --j) {
                    cec.comments.push(elements[j].textContent.trim());
                }
                pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
                if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(getCecComments, 0, cec, discussions, i, n, nextPage + 1, nextPage === 1 ? `${response.finalUrl}/search?page=` : url, callback);
                } else {
                    if (discussions) {
                        if (i < n) {
                            setTimeout(getCecComments, 0, cec, discussions, i + 1, n, 1, `/discussion/${discussions[i]}/`, callback.bind(null, nextPage === 1 ? `${response.finalUrl}/search?page=` : url));
                        } else {
                            callback();
                        }
                    } else {
                        let links, n;
                        links = responseHtml.querySelectorAll(`.page__description [href*="/discussion/"]`);
                        n = links.length;
                        if (n > 0) {
                            let discussions = [];
                            for (j = 0; j < n; ++j) {
                                discussions.push(links[j].getAttribute(`href`).match(/\/discussion\/(.+?)\//)[1]);
                            }
                            setTimeout(getCecComments, 0, cec, discussions, i + 1, n, 1, `/discussion/${discussions[i]}/`, callback.bind(null, nextPage === 1 ? `${response.finalUrl}/search?page=` : url));
                        } else {
                            callback(nextPage === 1 ? `${response.finalUrl}/search?page=` : url);
                        }
                    }
                }
            });
        }
    }

    function getCecEntries(cec, nextPage, url, callback) {
        if (!cec.canceled) {
            cec.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Retrieving entries (page ${nextPage})...</span>
            `;
            request(null, null, `GET`, true, `${url}${nextPage}`, response => {
                let elements, i, pagination, responseHtml;
                responseHtml = parseHtml(response.responseText);
                elements = responseHtml.getElementsByClassName(`table__column__heading`);
                for (i = elements.length - 1; i > -1; --i) {
                    cec.entries.push(elements[i].textContent.trim());
                }
                pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
                if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(getCecEntries, 0, cec, nextPage + 1, url, callback);
                } else {
                    callback();
                }
            });
        }
    }

    /* [GESL] Giveaway Error Search Links (by Royalgamer06) */

    function loadGesl() {
        var name;
        if (esgst.giveawayPath && document.getElementsByClassName(`table--summary`)[0]) {
            name = encodeURIComponent(document.getElementsByClassName(`table__column__secondary-link`)[0].textContent);
            document.getElementsByClassName(`table__row-outer-wrap`)[0].insertAdjacentHTML(`afterEnd`, `
                <div class="table__row-outer-wrap">
                    <div class="table__row-inner-wrap">
                        <div class="table__column--width-small">
                            <span class="esgst-bold">Search Links</span>
                        </div>
                        <div class="table__column--width-fill">
                            <a href="https://www.steamgifts.com/giveaways/search?q=${name}" target="_blank" title="Search for active giveaways">
                                <i class="fa"><img src="${esgst.sgIcon}"></i>
                            </a>
                            <a href="http://store.steampowered.com/search/?term=${name}" target="_blank" title="Search on Steam">
                                <i class="fa fa-steam"></i>
                            </a>
                            <a href="https://steamdb.info/search/?a=app&q=${name}" target="_blank" title="Search on SteamDB">
                                <i class="fa"><img src="https://steamdb.info/static/logos/favicon-16x16.png"></i>
                            </a>
                        </div>
                    </div>
                </div>
            `);
        }
    }

    /* [AS] Archive Searcher */

    function loadAs() {
        if (esgst.archivePath) {
            let ASButton, Category, popup;
            let key, position;
            if (esgst.leftButtonIds.indexOf(`as`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            ASButton = insertHtml(esgst.hideButtons && esgst.hideButtons_as ? esgst[key] : esgst.mainPageHeading, position, `
                <div class="esgst-heading-button" id="esgst-as" title="Search archive">
                    <i class="fa fa-folder"></i>
                    <i class="fa fa-search"></i>
                </div>
            `);
            Category = location.pathname.match(/^\/archive\/(coming-soon|open|closed|deleted)/);
            popup = new Popup(`fa-folder`, `Search archive${Category ? ` for ${Category[1]} giveaways` : ``}:`);
            popup.TextInput = insertHtml(popup.description, `beforeEnd`, `<input type="text">`);
            AS = {};
            insertHtml(popup.description, `beforeEnd`, `<div></div>`).appendChild(createOptions([{
                check: true,
                description: `Search by AppID.`,
                id: `as_searchAppId`,
                tooltip: `If unchecked, a search by exact title will be performed.`
            }]));
            popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-search`, `fa-times-circle`, `Search`, `Cancel`, function (Callback) {
                ASButton.classList.add(`esgst-busy`);
                AS.Progress.innerHTML = AS.OverallProgress.innerHTML = AS.Results.innerHTML = ``;
                AS.Canceled = false;
                AS.Query = popup.TextInput.value;
                if (AS.Query) {
                    if (esgst.as_searchAppId) {
                        AS.Progress.innerHTML = `
                            <i class="fa fa-circle-o-notch fa-spin"></i>
                            <span>Retrieving game title...</span>
                        `;
                        request(null, null, `GET`, false, `https://steamcommunity.com/app/${AS.Query}`, function (Response) {
                            var Title;
                            Title = parseHtml(Response.responseText).getElementsByClassName(`apphub_AppName`)[0];
                            if (Title) {
                                AS.Query = Title.textContent;
                                setASSearch(AS, ASButton, Callback);
                            } else {
                                ASButton.classList.remove(`esgst-busy`);
                                AS.Progress.innerHTML = `
                                    <i class="fa fa-times-circle"></i>
                                    <span>Game title not found. Make sure you are entering a valid AppID. For example, 229580 is the AppID for Dream (http://steamcommunity.com/app/229580).</span>
                                `;
                                Callback();
                            }
                        });
                    } else {
                        setASSearch(AS, ASButton, Callback);
                    }
                } else {
                    ASButton.classList.remove(`esgst-busy`);
                    AS.Progress.innerHTML = `
                        <i class="fa fa-times-circle"></i>
                        <span>Please enter a title / AppID.</span>
                    `;
                    Callback();
                }
            }, function () {
                clearInterval(AS.Request);
                AS.Canceled = true;
                setTimeout(function () {
                    AS.Progress.innerHTML = ``;
                }, 500);
                ASButton.classList.remove(`esgst-busy`);
            }).set);
            AS.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
            AS.OverallProgress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
            AS.Results = insertHtml(popup.scrollable, `beforeEnd`, `<div></div>`);
            AS.popup = popup;
            ASButton.addEventListener(`click`, function () {
                popup.open(function () {
                    popup.TextInput.focus();
                });
            });
        }
    }

    function setASSearch(AS, ASButton, Callback) {
        AS.Query = ((AS.Query.length >= 50) ? AS.Query.slice(0, 50) : AS.Query).toLowerCase();
        searchASGame(AS, `${location.href.match(/(.+?)(\/search.+?)?$/)[1]}/search?q=${encodeURIComponent(AS.Query)}&page=`, 1, function () {
            ASButton.classList.remove(`esgst-busy`);
            AS.Progress.innerHTML = ``;
            Callback();
        });
    }

    function searchASGame(AS, URL, NextPage, Callback) {
        if (!AS.Canceled) {
            AS.Progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Loading page ${NextPage}...</span>
            `;
            request(null, null, `GET`, true, URL + NextPage, function (Response) {
                var ResponseHTML, Matches, I, N, Title, Pagination;
                ResponseHTML = parseHtml(Response.responseText);
                Matches = ResponseHTML.getElementsByClassName(`table__row-outer-wrap`);
                for (I = 0, N = Matches.length; I < N; ++I) {
                    Title = Matches[I].getElementsByClassName(`table__column__heading`)[0].textContent.match(/(.+?)( \(.+ Copies\))?$/)[1];
                    if (Title.toLowerCase() === AS.Query) {
                        AS.Results.appendChild(Matches[I].cloneNode(true));
                        loadEndlessFeatures(AS.Results.lastElementChild);
                    }
                }
                AS.OverallProgress.textContent = `${AS.Results.children.length} giveaways found...`;
                Pagination = ResponseHTML.getElementsByClassName(`pagination__navigation`)[0];
                if (Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                    searchASGame(AS, URL, ++NextPage, Callback);
                } else {
                    Callback();
                }
            });
        }
    }

    /* [OADD] Old Active Discussions Design */

    function loadOadd(refresh, callback) {
        var deals, dealsRows, dealsSwitch, discussions, discussionsRows, discussionsSwitch, element, elements, i, j, n, response1Html, response2Html, revisedElements, rows, savedDiscussions;
        request(null, null, `GET`, false, `/discussions`, function (response1) {
            request(null, null, `GET`, false, `/discussions/deals`, function (response2) {
                response1Html = parseHtml(response1.responseText);
                response2Html = parseHtml(response2.responseText);
                esgst.activeDiscussions.classList.add(`esgst-oadd`);
                esgst.activeDiscussions.innerHTML = `
                    <div>
                        <div class="page__heading">
                            <div class="esgst-heading-button" title="Switch to Deals">
                                <i class="fa fa-retweet"></i>
                            </div>
                            <div class="page__heading__breadcrumbs">
                                <a href="/discussions">Active Discussions</a>
                            </div>
                            <a class="page__heading__button page__heading__button--green" href="/discussions">
                                More<i class="fa fa-angle-right"></i>
                            </a>
                        </div>
                        <div class="table">
                            <div class="table__heading">
                                <div class="table__column--width-fill">Summary</div>
                                <div class="table__column--width-small text-center">Comments</div>
                                <div class="table__column--width-medium text-right">Last Post</div>
                            </div>
                            <div class="table__rows"></div>
                        </div>
                    </div>
                    <div class="esgst-hidden">
                        <div class="page__heading">
                            <div class="esgst-heading-button" title="Switch to Discussions">
                                <i class="fa fa-retweet"></i>
                            </div>
                            <div class="page__heading__breadcrumbs">
                                <a href="/discussions/deals">Active Deals</a>
                            </div>
                            <a class="page__heading__button page__heading__button--green" href="/discussions/deals">
                                More<i class="fa fa-angle-right"></i>
                            </a>
                        </div>
                        <div class="table">
                            <div class="table__heading">
                                <div class="table__column--width-fill">Summary</div>
                                <div class="table__column--width-small text-center">Comments</div>
                                <div class="table__column--width-medium text-right">Last Post</div>
                            </div>
                            <div class="table__rows"></div>
                        </div>
                    </div>
                `;
                discussions = esgst.activeDiscussions.firstElementChild;
                deals = discussions.nextElementSibling;
                discussionsSwitch = discussions.firstElementChild.firstElementChild;
                discussionsRows = discussions.lastElementChild.lastElementChild;
                dealsSwitch = deals.firstElementChild.firstElementChild;
                dealsRows = deals.lastElementChild.lastElementChild;
                getValue(`discussions`, `{}`).then(value => {
                    savedDiscussions = JSON.parse(value);
                    return getDiscussions(response1Html, true, savedDiscussions);
                }).then(elements => {
                    if (!esgst.oadd_d) {
                        revisedElements = [];
                        elements.forEach(element => {
                            if (element.category !== `Deals`) {
                                revisedElements.push(element);
                            }
                        });
                        elements = revisedElements;
                    }
                    for (i = 0, j = elements.length - 1; i < 5 && j > -1; ++i, --j) {
                        discussionsRows.appendChild(elements[j].outerWrap);
                    }
                    return getDiscussions(response2Html, true, savedDiscussions);
                }).then(elements => {
                    for (i = 0, j = elements.length - 1; i < 5 && j > -1; ++i, --j) {
                        dealsRows.appendChild(elements[j].outerWrap);
                    }
                    discussionsSwitch.addEventListener(`click`, function () {
                        discussions.classList.add(`esgst-hidden`);
                        deals.classList.remove(`esgst-hidden`);
                    });
                    dealsSwitch.addEventListener(`click`, function () {
                        discussions.classList.remove(`esgst-hidden`);
                        deals.classList.add(`esgst-hidden`);
                    });
                    if (esgst.adots) {
                        loadAdots(refresh);
                    } else if (esgst.radb) {
                        addRadbButtons();
                    }
                    if (refresh) {
                        loadEndlessFeatures(esgst.activeDiscussions).then(() => {
                            if (callback) {
                                callback();
                            }
                        });
                    } else {
                        loadFeatures();
                        if (callback) {
                            callback();
                        }
                    }
                });
            });
        });
    }

    /* [ADOTS] Active Discussions On Top/Sidebar */

    function loadAdots(refresh) {
        var parent, panel, size, tabHeading1, tabHeading2, activeDiscussions, discussions, deals, element, elements, i, icon, n, comments, parent, panel, rows;
        if (esgst.activeDiscussions) {
            if (!refresh) {
                esgst.activeDiscussions.classList.remove(`widget-container--margin-top`);
                esgst.activeDiscussions.classList.add(`esgst-adots`);
            }
            if (esgst.adots_index === 0) {
                if (!refresh) {
                    parent = esgst.activeDiscussions.parentElement;
                    parent.insertBefore(esgst.activeDiscussions, parent.firstElementChild);
                    if (esgst.radb) {
                        addRadbButtons();
                    }
                } else if (esgst.oadd && esgst.radb) {
                    addRadbButtons();
                }
            } else {
                if (!refresh) {
                    if (esgst.ib) {
                        size = 45;
                    } else {
                        size = 35;
                    }
                    esgst.style.insertAdjacentText(`beforeEnd`, `
                        .esgst-adots .table__row-inner-wrap >:first-child {
                            float: left;
                            width: ${size}px;
                            height: ${size}px;
                        }
                        .esgst-adots .table__row-inner-wrap >:first-child >* {
                            width: ${size}px;
                            height: ${size}px;
                        }
                        .esgst-adots .table__row-inner-wrap >:last-child {
                            margin-left: ${size + 5}px;
                            text-align: left;
                            width: auto;
                        }
                        .esgst-adots .table__column--width-fill {
                            margin-left: 5px;
                            vertical-align: top;
                            width: calc(100% - ${size + 15}px);
                        }
                    `);
                    panel = insertHtml(esgst.sidebar, `beforeEnd`, `
                        <h3 class="sidebar__heading">
                            <span class="esgst-adots-tab-heading esgst-selected">Discussions</span>
                            <span class="esgst-adots-tab-heading">Deals</span>
                            <a class="esgst-float-right sidebar__navigation__item__name" href="/discussions">More</a>
                        </h3>
                    `);
                    tabHeading1 = panel.firstElementChild;
                    tabHeading2 = tabHeading1.nextElementSibling;
                    if (esgst.radb) {
                        insertHtml(tabHeading2.nextElementSibling, `beforeBegin`, `
                            <div class="esgst-radb-button">
                                <i class="fa fa-refresh" title="Refresh active discussions/deals"></i>
                            </div>
                        `).addEventListener(`click`, event => {
                            let icon = event.currentTarget.firstElementChild;
                            icon.classList.add(`fa-spin`);
                            if (esgst.oadd) {
                                loadOadd(true, () => {
                                    icon.classList.remove(`fa-spin`);
                                });
                            } else {
                                checkMissingDiscussions(true, () => {
                                    icon.classList.remove(`fa-spin`);
                                });
                            }
                        });
                    }
                }
                if (esgst.oadd) {
                    discussions = esgst.activeDiscussions.firstElementChild;
                    deals = esgst.activeDiscussions.lastElementChild;
                    discussions.firstElementChild.remove();
                    discussions.firstElementChild.firstElementChild.remove();
                    deals.firstElementChild.remove();
                    deals.firstElementChild.firstElementChild.remove();
                    elements = esgst.activeDiscussions.getElementsByClassName(`table__column--last-comment`);
                    for (i = 0, n = elements.length; i < n; ++i) {
                        icon = elements[0].getElementsByClassName(`table__last-comment-icon`)[0];
                        if (icon) {
                            icon.classList.add(`esgst-float-right`);
                            elements[0].previousElementSibling.appendChild(icon);
                        }
                        elements[0].remove();
                    }
                    if (!refresh) {
                        discussions = discussions.firstElementChild.firstElementChild;
                        deals = deals.firstElementChild.firstElementChild;
                    }
                } else {
                    if (refresh) {
                        rows = document.getElementsByClassName(`table`);
                        discussions = rows[0];
                        deals = rows[1];
                    } else {
                        discussions = esgst.activeDiscussions.firstElementChild.firstElementChild.lastElementChild;
                        deals = esgst.activeDiscussions.lastElementChild.firstElementChild.lastElementChild;
                    }
                    elements = discussions.getElementsByClassName(`table__row-outer-wrap`);
                    for (i = 0, n = elements.length; i < n; ++i) {
                        element = elements[i];
                        comments = element.getElementsByClassName(`table__column__secondary-link`)[0];
                        parent = comments.parentElement;
                        panel = insertHtml(parent, `afterEnd`, `<p></p><div style="clear: both;"></div>`);
                        panel.appendChild(comments);
                        if (parent.lastElementChild.classList.contains(`table__last-comment-icon`)) {
                            parent.lastElementChild.classList.add(`esgst-float-right`);
                            panel.appendChild(parent.lastElementChild);
                        }
                        parent.remove();
                    }
                    elements = deals.getElementsByClassName(`table__row-outer-wrap`);
                    for (i = 0, n = elements.length; i < n; ++i) {
                        element = elements[i];
                        comments = element.getElementsByClassName(`table__column__secondary-link`)[0];
                        parent = comments.parentElement;
                        panel = insertHtml(parent, `afterEnd`, `<p></p><div style="clear: both;"></div>`);
                        panel.appendChild(comments);
                        if (parent.lastElementChild.classList.contains(`table__last-comment-icon`)) {
                            parent.lastElementChild.classList.add(`esgst-float-right`);
                            panel.appendChild(parent.lastElementChild);
                        }
                        parent.remove();
                    }
                }
                if (!tabHeading1) {
                    tabHeading1 = discussions.parentElement.previousElementSibling.firstElementChild;
                    tabHeading2 = tabHeading1.nextElementSibling;
                }
                if (tabHeading1.classList.contains(`esgst-selected`)) {
                    deals.classList.add(`esgst-hidden`, `esgst-adots`);
                    discussions.classList.add(`esgst-adots`);
                    discussions.classList.remove(`esgst-hidden`);
                } else {
                    discussions.classList.add(`esgst-hidden`, `esgst-adots`);
                    deals.classList.add(`esgst-adots`);
                    deals.classList.remove(`esgst-hidden`);
                }
                if (!refresh) {
                    activeDiscussions = insertHtml(esgst.sidebar, `beforeEnd`, `<div></div>`);
                    activeDiscussions.appendChild(discussions);
                    activeDiscussions.appendChild(deals);
                    tabHeading1.addEventListener(`click`, changeAdotsTab.bind(null, tabHeading1, tabHeading2));
                    tabHeading2.addEventListener(`click`, changeAdotsTab.bind(null, tabHeading1, tabHeading2));
                    esgst.activeDiscussions.remove();
                    esgst.activeDiscussions = activeDiscussions;
                }
            }
        }
    }

    function changeAdotsTab(button1, button2, event) {
        if ((button1.classList.contains(`esgst-selected`) && event.currentTarget === button2) || (button2.classList.contains(`esgst-selected`) && event.currentTarget === button1)) {
            button1.classList.toggle(`esgst-selected`);
            button2.classList.toggle(`esgst-selected`);
            button1.parentElement.nextElementSibling.firstElementChild.classList.toggle(`esgst-hidden`);
            button1.parentElement.nextElementSibling.lastElementChild.classList.toggle(`esgst-hidden`);
        }
    }

    function checkMissingDiscussions(refresh, callback) {
        let deals, discussions, numDeals, numDiscussions, rows, savedDiscussions;
        getValue(`discussions`, `{}`).then(value => {
            savedDiscussions = JSON.parse(value);
            rows = document.getElementsByClassName(`table__rows`);
            new Promise((resolve, reject) => {
                if (refresh) {
                    rows[0].innerHTML = ``;
                    rows[1].innerHTML = ``;
                    numDiscussions = 0;
                    numDeals = 0;
                    resolve();
                } else {
                    getDiscussions(rows[0], true, savedDiscussions).then(discussions => {
                        numDiscussions = discussions.length;
                        return getDiscussions(rows[1], true, savedDiscussions);
                    }).then(deals => {
                        numDeals = deals.length;
                        resolve();
                    });
                }
            }).then(() => {
                if (numDiscussions < 5 || numDeals < 5) {
                    request(null, null, `GET`, false, `/discussions`, response1 => {
                        request(null, null, `GET`, false, `/discussions/deals`, response2 => {
                            let elements, i, j, response1Html, response2Html, revisedElements;
                            response1Html = parseHtml(response1.responseText);
                            response2Html = parseHtml(response2.responseText);
                            getDiscussions(response1Html, true, savedDiscussions).then(elements => {
                                revisedElements = [];
                                elements.forEach(element => {
                                    if (element.category !== `Deals`) {
                                        revisedElements.push(element);
                                    }
                                });
                                i = revisedElements.length - (numDiscussions + 1);
                                while (numDiscussions < 5 && i > -1) {
                                    setMissingDiscussion(revisedElements[i]);
                                    rows[0].appendChild(revisedElements[i].outerWrap);
                                    i -= 1;
                                    numDiscussions += 1;
                                }
                                return getDiscussions(response2Html, true, savedDiscussions);
                            }).then(elements => {
                                i = elements.length - (numDeals + 1);
                                while (numDeals < 5 && i > -1) {
                                    setMissingDiscussion(elements[i]);
                                    rows[1].appendChild(elements[i].outerWrap);
                                    i -= 1;
                                    numDeals += 1;
                                }
                                if (esgst.adots) {
                                    loadAdots(refresh);
                                } else if (esgst.radb && !refresh) {
                                    addRadbButtons();
                                }
                                if (refresh) {
                                    loadEndlessFeatures(esgst.activeDiscussions).then(() => {
                                        if (callback) {
                                            callback();
                                        }
                                    });
                                } else {
                                    loadFeatures();
                                    if (callback) {
                                        callback();
                                    }
                                }
                            });
                        });
                    });
                } else {
                    if (esgst.adots) {
                        loadAdots();
                    } else if (esgst.radb && !refresh) {
                        addRadbButtons();
                    }
                    loadFeatures();
                    if (callback) {
                        callback();
                    }
                }
            });
        });
    }

    function addRadbButtons() {
        let elements, i;
        elements = esgst.activeDiscussions.querySelectorAll(`.homepage_heading, .esgst-heading-button`);
        for (i = elements.length - 1; i > -1; --i) {
            insertHtml(elements[i], `beforeBegin`, `
                <div class="esgst-radb-button${esgst.oadd ? `` : ` homepage_heading`}">
                    <i class="fa fa-refresh" title="Refresh active discussions/deals"></i>
                </div>
            `).addEventListener(`click`, event => {
                let icon = event.currentTarget.firstElementChild;
                icon.classList.add(`fa-spin`);
                if (esgst.oadd) {
                    loadOadd(true, () => {
                        icon.classList.remove(`fa-spin`);
                    });
                } else {
                    checkMissingDiscussions(true, () => {
                        icon.classList.remove(`fa-spin`);
                    });
                }
            });
        }
    }

    function setMissingDiscussion(context) {
        if (context) {
            context.outerWrap.innerHTML = `
                <div class="table__row-outer-wrap" style="padding: 15px 0;">
                    <div class="table__row-inner-wrap">
                        <div>
                            <a class="table_image_avatar" href="/user/${context.author}" style="background-image:${context.avatar.style.backgroundImage.replace(/"/g, `'`)};"></a>
                        </div>
                        <div class="table__column--width-fill">
                            <h3 style="margin-bottom: 2px;">
                                <a class="homepage_table_column_heading" href="${context.url}">${context.title}</a>
                            </h3>
                            <p>
                                ${context.lastPostTime ? `
                                    <a class="table__column__secondary-link" href="${context.url}">${context.comments} Comments</a> - Last post <span data-timestamp="${context.lastPostTimestamp}">${context.lastPostTime}</span> ago by <a class="table__column__secondary-link" href="/user/${context.lastPostAuthor}">${context.lastPostAuthor}</a>
                                    <a class="icon-green table__last-comment-icon" href="/go/comment/${context.lastPostCode}">
                                        <i class="fa fa-chevron-circle-right"></i>
                                    </a>
                                ` : `
                                    <a class="table__column__secondary-link" href="${context.url}">${context.comments} Comments</a> - Created <span data-timestamp="${context.createdTimestamp}">${context.createdTime}</span> ago by <a class="table__column__secondary-link" href="/user/${context.author}">${context.author}</a>
                                `}
                            </p>
                        </div>
                    </div>
                </div>
            `;
            context.outerWrap = context.outerWrap.firstElementChild;
        }
    }

    /* [DS] Discussions Sorter */

    function openDsPopout(ds) {
        if (!ds.popout) {
            ds.popout = new Popout(`esgst-ds-popout`, ds.button, 0, true);
            ds.toggle = new ToggleSwitch(ds.popout.popout, `ds_auto`, false, `Auto Sort`, false, false, `Automatically sorts the discussions by the selected option when loading the page.`, esgst.ds_auto);
            ds.options = insertHtml(ds.popout.popout, `beforeEnd`, `
                <select>
                    <option value="sortIndex_asc">Default</option>
                    <option value="title_asc">Title - Ascending</option>
                    <option value="title_desc">Title - Descending</option>
                    <option value="category_asc">Category - Ascending</option>
                    <option value="category_desc">Category - Descending</option>
                    <option value="createdTimestamp_asc">Created Time - Ascending</option>
                    <option value="createdTimestamp_desc">Created Time - Descending</option>
                    <option value="author_asc">Author - Ascending</option>
                    <option value="author_desc">Author - Descending</option>
                    <option value="comments_asc">Comments - Ascending</option>
                    <option value="comments_desc">Comments - Descending</option>
                </select>
            `);
            ds.options.value = esgst.ds_option;
            ds.options.addEventListener(`change`, saveAndSortContent.bind(null, `ds_option`, `currentDiscussions`, ds.options, null));
            ds.popout.popout.appendChild(new ButtonSet(`green`, ``, `fa-arrow-circle-right`, ``, `Sort`, ``, saveAndSortContent.bind(null, `ds_option`, `currentDiscussions`, ds.options)).set);
        }
    }

    /* [CODB] Close/Open Discussion Button */

    function addCodbButtons(discussions) {
        discussions.forEach(discussion => {
            if (discussion.author === esgst.username) {
                if (!discussion.heading.parentElement.getElementsByClassName(`esgst-codb-button`)[0]) {
                    if (discussion.closed) {
                        discussion.closed.remove();
                        discussion.closed = true;
                    }
                    if (discussion.closed) {
                        addCodbOpenButton(null, discussion);
                    } else {
                        addCodbCloseButton(null, discussion);
                    }
                }
            }
        });
    }

    function addCodbCloseButton(button, discussion) {
        if (!button) {
            button = insertHtml(discussion.headingContainer.firstElementChild, `beforeBegin`, `
                <div class="esgst-codb-button" title="Close discussion">
                    <i class="fa fa-lock"></i>
                </div>
            `);
        }
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            request(`xsrf_token=${esgst.xsrfToken}&do=close_discussion`, null, `POST`, false, discussion.url, response => {
                button.innerHTML = `<i class="fa fa-lock"></i>`;
                if (parseHtml(response.responseText).getElementsByClassName(`page__heading__button--red`)[0]) {
                    button.classList.add(`icon-red`);
                    button.title = `Open discussion`;
                    addCodbOpenButton(button, discussion);
                    discussion.closed = true;
                    discussion.innerWrap.classList.add(`is-faded`);
                }
            });
        });
    }

    function addCodbOpenButton(button, discussion) {
        if (!button) {
            button = insertHtml(discussion.headingContainer.firstElementChild, `beforeBegin`, `
                <div class="esgst-codb-button icon-red" title="Open discussion">
                    <i class="fa fa-lock"></i>
                </div>
            `);
        }
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            request(`xsrf_token=${esgst.xsrfToken}&do=reopen_discussion`, null, `POST`, false, discussion.url, response => {
                button.innerHTML = `<i class="fa fa-lock"></i>`;
                if (!parseHtml(response.responseText).getElementsByClassName(`page__heading__button--red`)[0]) {
                    button.classList.remove(`icon-red`);
                    button.title = `Close discussion`;
                    addCodbCloseButton(button, discussion);
                    discussion.closed = false;
                    discussion.innerWrap.classList.remove(`is-faded`);
                }
            });
        });
    }

    /* [DF] Discussion Filters */

    function addDfHideButton(discussion, main) {
        var button;
        if (!discussion.heading.parentElement.getElementsByClassName(`esgst-df-button`)[0]) {
            button = insertHtml(discussion.headingContainer.firstElementChild, `beforeBegin`, `
                <div class="esgst-df-button" title="Hide discussion">
                    <i class="fa fa-eye-slash"></i>
                </div>
            `);
            button.firstElementChild.addEventListener(`click`, function() {
                button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
                hideDfDiscussion(discussion, function() {
                    button.remove();
                    if ((esgst.discussionPath && !main) || !esgst.discussionPath) {
                        discussion.outerWrap.remove();
                    }
                });
            });
        }
    }

    function hideDfDiscussion(discussion, callback) {
        createLock(`discussionLock`, 300, function(deleteLock) {
            var discussions;
            getValue(`discussions`, `{}`).then(value => {
                discussions = JSON.parse(value);
                if (!discussions[discussion.code]) {
                    discussions[discussion.code] = {};
                }
                discussions[discussion.code].hidden = discussions[discussion.code].lastUsed = Date.now();
                return setValue(`discussions`, JSON.stringify(discussions));
            }).then(() => {
                deleteLock();
                if (callback) {
                    callback();
                }
            });
        });
    }

    function addDfUnhideButton(discussion, main) {
        var button;
        if (!discussion.heading.parentElement.getElementsByClassName(`esgst-df-button`)[0]) {
            button = insertHtml(discussion.headingContainer.firstElementChild, `beforeBegin`, `
                <div class="esgst-df-button" title="Unhide discussion">
                    <i class="fa fa-eye"></i>
                </div>
            `);
            button.firstElementChild.addEventListener(`click`, function() {
                button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
                unhideDfDiscussion(discussion, function() {
                    button.remove();
                    if ((esgst.discussionPath && !main) || !esgst.discussionPath) {
                        discussion.outerWrap.remove();
                    }
                });
            });
        }
    }

    function unhideDfDiscussion(discussion, callback) {
        createLock(`discussionLock`, 300, function(deleteLock) {
            var discussions;
            getValue(`discussions`, `{}`).then(value => {
                discussions = JSON.parse(value);
                if (discussions[discussion.code]) {
                    delete discussions[discussion.code].hidden;
                    discussions[discussion.code].lastUsed = Date.now();
                }
                return setValue(`discussions`, JSON.stringify(discussions));
            }).then(() => {
                deleteLock();
                if (callback) {
                    callback();
                }
            });
        });
    }

    function setDfOverride(df, context, key) {
        let button, override;
        button = insertHtml(context, `afterBegin`, `<span class="esgst-gf-override"></span>`);
        df.overrideButtons[key] = {
            change: () => {
                if (typeof df.overrides[key] === `undefined`) {
                    df.overrides[key] = 0;
                }
                df.overrideButtons[key].value = df.overrides[key];
                if (df.overrideButtons[key].value) {
                    button.innerHTML = `<i class="fa fa-exclamation" title="Click to make this filter overridable"></i>`;
                } else {
                    button.innerHTML = `<i class="fa fa-exclamation esgst-faded" title="Click to make this filter non-overridable"></i>`;
                }
            }
        };
        df.overrideButtons[key].change();
        button.addEventListener(`click`, () => {
            df.overrides[key] = df.overrideButtons[key].value ? 0 : 1;
            df.overrideButtons[key].change();
            filterDfDiscussions(df);
        });
    }

    function addDfContainer(heading) {
        var basicFilter, basicFilters, box, button, categoryFilter, categoryFilters, collapseButton, display, exceptionButton, exceptionCount, exceptionPanel, expandButton, filters, genres, df, headingButton, i, id, infinite, key, maxKey, maxSavedValue, maxValue, minKey, minSavedValue, minValue, name, preset, presetButton, presetDisplay, presetInput, presetMessage, presetPanel, presets, presetWarning, slider, step, toggleSwitch, typeFilter, typeFilters, value;
        headingButton = document.createElement(`div`);
        headingButton.className = `esgst-heading-button esgst-gf-heading-button`;
        headingButton.id = `esgst-df`;
        headingButton.innerHTML = `
            <span class="esgst-gf-toggle-switch"></span>
            <i class="fa fa-sliders" title="Manage presets"></i>
        `;
        esgst.df = df = {
            counters: {},
            type: esgst.createdDiscussionsPath ? `Created` : ``
        };
        toggleSwitch = new ToggleSwitch(headingButton.firstElementChild, `df_enable${esgst.df.type}`, true, ``, false, false, null, esgst[`df_enable${esgst.df.type}`]);
        toggleSwitch.onEnabled = filterDfDiscussions.bind(null, df);
        toggleSwitch.onDisabled = filterDfDiscussions.bind(null, df, true);
        presetButton = headingButton.lastElementChild;
        df.container = insertHtml(heading, `afterEnd`, `
            <div class="esgst-gf-container">
                <div class="esgst-gf-box">
                    <div class="esgst-gf-filters esgst-hidden">
                        <div class="esgst-gf-basic-filters esgst-hidden">
                            <div>
                                <span class="esgst-bold">Basic Filters:</span>
                                <i class="fa fa-question-circle" title="The entries/copies filters are infinite. To increase/decrease their max value, simply enter the new max value into the input field and it will be changed."></i>
                            </div>
                        </div>
                        <div class="esgst-gf-type-filters">
                            <div>
                                <span class="esgst-bold">Type Filters:</span>
                            </div>
                        </div>
                        <div class="esgst-gf-right-panel">
                            <div class="esgst-gf-legend-panel">
                                <div>
                                    <span class="esgst-bold">Legend:</span>
                                    <i class="fa fa-question-circle" title="This legend applies to the type filters, except where noted"></i>
                                </div>
                                <div class="esgst-gf-legend"><i class="fa fa-circle-o"></i> - Hide all.</div>
                                <div class="esgst-gf-legend"><i class="fa fa-circle"></i> - Show only.</div>
                                <div class="esgst-gf-legend"><i class="fa fa-check-circle"></i> - Show all.</div>
                                <div class="esgst-gf-legend"><i class="fa fa-exclamation esgst-faded"></i> - Overridable <i class="fa fa-question-circle" title="Overridable filters can be overridden by exceptions"></i></div>
                                <div class="esgst-gf-legend"><i class="fa fa-exclamation"></i> - Non-Overridable <i class="fa fa-question-circle" title="Non-Overridable filters cannot be overridden by exceptions"></i></div>
                            </div>
                            <br>
                            <div class="esgst-gf-preset-panel">
                                <div>
                                    <span class="esgst-bold">Preset:</span>
                                </div>
                                <div>
                                    <span></span> exceptions <i class="esgst-clickable fa fa-gear" title="Manage exceptions"></i>
                                </div>
                                <input class="form__input-small" type="text"/>
                                <div class="esgst-description esgst-bold"></div>
                                <div class="form__row__error esgst-hidden">
                                    <i class="fa fa-exclamation-circle"></i> Please enter a name for the preset.
                                </div>
                                <div class="esgst-description">The name of the preset.</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="esgst-gf-button">
                    <span>Expand</span><span class="esgst-hidden">Collapse</span> filters (<span>0</span> filtered - <span></span>)
                </div>
            </div>
        `);
        box = df.container.firstElementChild;
        filters = box.firstElementChild;
        basicFilters = filters.firstElementChild;
        typeFilters = basicFilters.nextElementSibling;
        presetPanel = typeFilters.nextElementSibling.lastElementChild;
        exceptionPanel = presetPanel.firstElementChild.nextElementSibling;
        exceptionCount = exceptionPanel.firstElementChild;
        exceptionButton = exceptionCount.nextElementSibling;
        presetInput = exceptionPanel.nextElementSibling;
        presetMessage = presetInput.nextElementSibling;
        presetWarning = presetMessage.nextElementSibling;
        presetPanel.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save Preset`, `Saving...`, saveDfPreset.bind(null, df, presetInput, presetMessage, presetWarning)).set);
        button = box.nextElementSibling;
        expandButton = button.firstElementChild;
        collapseButton = expandButton.nextElementSibling;
        button.addEventListener(`click`, toggleGfFilters.bind(null, collapseButton, expandButton, filters));
        df.filteredCount = collapseButton.nextElementSibling;
        df.paginationFilteredCount = insertHtml(esgst.pagination.firstElementChild, `beforeEnd`, `
            <span>
                (<span class="esgst-bold">0</span> filtered by Discussion Filters)
            </span>
        `).firstElementChild;
        presetDisplay = df.filteredCount.nextElementSibling;
        presetButton.addEventListener(`click`, openDfPresetPopup.bind(null, df, exceptionCount, presetDisplay, presetInput));
        name = esgst[`df_preset${esgst.df.type}`];
        if (name) {
            presets = JSON.parse(esgst.storage.dfPresets);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
            if (i >= 0) {
                preset = presets[i];
                presetDisplay.textContent = presetInput.value = name;
            } else {
                preset = null;
            }
        }
        if (!preset) {
            name = `Default${esgst.df.type}`;
            preset = { name };
            [`maxComments`, `minComments`, `announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`].forEach(key => {
                preset[key] = esgst.settings[`df_${key}`];
            });
            presets = JSON.parse(esgst.storage.dfPresets);
            presets.push(preset);
            setValue(`dfPresets`, JSON.stringify(presets));
            setSetting(`df_preset${esgst.df.type}`, name);
            presetDisplay.textContent = presetInput.value = name;
        }
        if (preset.exceptions) {
            df.exceptions = preset.exceptions;
            exceptionCount.textContent = preset.exceptions.length;
        } else {
            exceptionCount.textContent = 0;
        }
        df.overrides = preset.overrides || {};
        df.overrideButtons = {};
        exceptionButton.addEventListener(`click`, openDfExceptionPopup.bind(null, exceptionCount, df, presetInput));
        basicFilters.classList.remove(`esgst-hidden`);
        [ { check: true, infinite: true, maxValue: 999999, minValue: 0, name: `Comments` }
        ].forEach(filter => {
            if (filter.check) {
                name = filter.name;
                maxKey = `max${name}`;
                maxValue = filter.maxValue;
                minKey = `min${name}`;
                minValue = filter.minValue;
                key = name.toLowerCase();
                if (esgst[`df_${key}`]) {
                    infinite = filter.infinite;
                    maxSavedValue = preset[maxKey] || maxValue;
                    minSavedValue = preset[minKey] || minValue;
                    step = filter.step || 1;
                    if (!infinite && maxSavedValue > maxValue) {
                        maxSavedValue = maxValue;
                    }
                    df[maxKey] = maxSavedValue;
                    df[minKey] = minSavedValue;
                    basicFilter = insertHtml(basicFilters, `beforeEnd`, `
                        <div class="esgst-gf-basic-filter">
                            <div>${name} <span class="esgst-gf-filter-count" title="Number of discussions this filter is filtering">0</span> <span class="esgst-float-right"><input type="text" value="${minSavedValue}"> - <input type="text" value="${maxSavedValue}"></span></div>
                            <div></div>
                        </div>
                    `);
                    display = basicFilter.firstElementChild;
                    setDfOverride(df, display, key);
                    slider = display.nextElementSibling;
                    df.counters[key] = display.firstElementChild.nextElementSibling;
                    df[`${minKey}Input`] = df.counters[key].nextElementSibling.firstElementChild;
                    df[`${maxKey}Input`] = df[`${minKey}Input`].nextElementSibling;
                    df[`${maxKey}Input`].addEventListener(`change`, changeGfMaxValue.bind(null, infinite, slider, step));
                    df[`${minKey}Input`].addEventListener(`change`, changeGfMinValue.bind(null, slider, step));
                    if (infinite) {
                        maxValue = maxSavedValue;
                    }
                    $(slider).slider({
                        change: changeDfSlider.bind(null, df, maxKey, minKey),
                        min: minValue,
                        max: maxValue,
                        range: true,
                        slide: slideGfSlider.bind(null, df, maxKey, minKey),
                        step: step,
                        values: [minSavedValue, maxSavedValue]
                    });
                } else {
                    df[maxKey] = maxValue;
                    df[minKey] = minValue;
                }
            }
        });
        if (basicFilters.children.length === 1) {
            basicFilters.classList.add(`esgst-hidden`);
        }
        [ { check: true, key: `announcements`, name: `Announcements` },
            { check: true, key: `bugs_suggestions`, name: `Bugs / Suggestion` },
            { check: true, key: `deals`, name: `Deals` },
            { check: true, key: `general`, name: `General` },
            { check: true, key: `groupRecruitment`, name: `Group Recruitment` },
            { check: true, key: `letsPlayTogether`, name: `Let's Play Together` },
            { check: true, key: `offTopic`, name: `Off-Topic` },
            { check: true, key: `puzzles`, name: `Puzzles` },
            { check: true, key: `uncategorized`, name: `Uncategorized` },
            { check: true, key: `created`, name: `Created` },
            { check: true, key: `poll`, name: `Poll` },
            { check: esgst.dh, key: `highlighted`, name: `Highlighted` },
            { check: esgst.gdttt, key: `visited`, name: `Visited` },
            { check: esgst.ct, key: `unread`, name: `Unread` }
        ].forEach(filter => {
            if (filter.check) {
                key = filter.key;
                if (esgst[`df_${key}`]) {
                    name = filter.name;
                    typeFilter = insertHtml(typeFilters, `beforeEnd`, `
                        <div class="esgst-gf-type-filter">
                            <span>${name}</span>
                            <span class="esgst-gf-filter-count" title="Number of discussions this filter is filtering">0</span>
                        </div>
                    `);
                    value = preset[key] || `enabled`;
                    df[key] = value;
                    df[`${key}Checkbox`] = new Checkbox(typeFilter, value, true);
                    df.counters[key] = typeFilter.lastElementChild;
                    setDfOverride(df, typeFilter, key);
                    df[`${key}Checkbox`].checkbox.addEventListener(`click`, changeDfValue.bind(null, df[`${key}Checkbox`], df, key));
                } else {
                    df[key] = `enabled`;
                }
            }
        });
        if (typeFilters.children.length === 1) {
            typeFilters.classList.add(`esgst-hidden`);
        }
        return headingButton;
    }

    function changeDfSlider(df, maxKey, minKey, event, ui) {
        df[maxKey] = ui.values[1];
        df[minKey] = ui.values[0];
        filterDfDiscussions(df);
    }

    function changeDfValue(context, df, key) {
        df[key] = context.value;
        filterDfDiscussions(df);
    }

    function saveDfPreset(df, presetInput, presetMessage, presetWarning, callback) {
        var exceptions, name, preset, presets;
        name = presetInput.value;
        if (name) {
            presetWarning.classList.add(`esgst-hidden`);
            preset = { name };
            [`maxComments`, `minComments`, `announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`].forEach(key => {
                if (typeof df[key] !== `undefined`) {
                    preset[key] = df[key];
                }
            });
            preset.exceptions = df.exceptions;
            preset.overrides = df.overrides;
            getValue(`dfPresets`, `[]`).then(value => {
                presets = JSON.parse(value);
                for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
                if (i >= 0) {
                    exceptions = presets[i].exceptions;
                    if (exceptions) {
                        preset.exceptions = exceptions;
                    }
                    presets[i] = preset;
                } else {
                    presets.push(preset);
                }
                return setValue(`dfPresets`, JSON.stringify(presets));
            }).then(setSetting.bind(null, `df_preset${esgst.df.type}`, name)).then(() => {
                createFadeMessage(presetMessage, `Saved!`);
                callback();
            });
        } else {
            presetWarning.classList.remove(`esgst-hidden`);
            callback();
        }
    }

    function openDfPresetPopup(df, exceptionCount, presetDisplay, presetInput) {
        var deleted, details, heading, hideAll, popup, preset, renameButton, renameInput, row, showOnly, table, undoButton;
        popup = new Popup(`fa-sliders`, `Manage presets:`, true);
        popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-description">To edit a preset, apply it and save it with the same name. To rename a preset, click the edit icon, enter the new name and hit "Enter". Drag and drop presets to move them.</div>`);
        deleted = [];
        undoButton = insertHtml(popup.description, `beforeEnd`, `
            <div class="esgst-clickable esgst-hidden">
                <i class="fa fa-rotate-left"></i>
                <span>Undo Delete</span>
            </div>
        `);
        undoButton.addEventListener(`click`, undoDfDeletePreset.bind(null, deleted, undoButton));
        table = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left popup__keys__list"></div>`);
        getValue(`dfPresets`, `[]`).then(value => {
            JSON.parse(value).forEach(preset => {
                details = ``;
                [ { key: `Comments`, name: `comments` }
                ].forEach(filter => {
                    if (typeof preset[`max${filter.key}`] !== `undefined`) {
                        details += `${preset[`min${filter.key}`]}-${preset[`max${filter.key}`]} ${filter.name}, `;
                    }
                });
                hideAll = [];
                showOnly = [];
                [ { key: `announcements`, name: `announcements` },
                    { key: `bugs_suggestions`, name: `bugs / suggestions` },
                    { key: `deals`, name: `deals` },
                    { key: `general`, name: `general` },
                    { key: `groupRecruitment`, name: `group recruitment` },
                    { key: `letsPlayTogether`, name: `let's play together` },
                    { key: `offTopic`, name: `off-topic` },
                    { key: `puzzles`, name: `puzzles` },
                    { key: `uncategorized`, name: `uncategorized` },
                    { key: `created`, name: `created` },
                    { key: `poll`, name: `poll`},
                    { key: `highlighted`, name: `highlighted` },
                    { key: `visited`, name: `visited` },
                    { key: `unread`, name: `unread` }
                ].forEach(key => {
                    if (preset[key.key] === `disabled`) {
                        hideAll.push(key.name);
                    } else if (preset[key.key] === `none`) {
                        showOnly.push(key.name);
                    }
                });
                if (hideAll.length > 0) {
                    details += `hide: ${hideAll.join(` & `)}, `;
                }
                if (showOnly.length > 0) {
                    details += `only show: ${showOnly.join(` & `)}, `;
                }
                row = insertHtml(table, `beforeEnd`, `
                    <div ${presetInput.value === preset.name ? `class="esgst-green-highlight"` : ``} draggable="true">
                        <div class="esgst-float-left">
                            <input class="esgst-hidden" type="text" value="${preset.name}"/>
                            <strong class="esgst-clickable">${preset.name}</strong>
                        </div>
                        <div class="esgst-clickable esgst-float-right">
                            <i class="fa fa-edit" title="Rename preset"></i>
                            <span title="Delete preset">
                                <i class="fa fa-trash"></i>
                            </span>
                        </div>
                        <div class="esgst-clear"></div>
                        <div class="esgst-description">${details.slice(0, -2)}</div>
                    </div>
                `);
                row.addEventListener(`dragstart`, setDfSource.bind(null, df, preset, row));
                row.addEventListener(`dragenter`, getGfSource.bind(null, df, row, table));
                row.addEventListener(`dragend`, saveDfSource.bind(null, df));
                renameInput = row.firstElementChild.firstElementChild;
                heading = renameInput.nextElementSibling;
                renameInput.addEventListener(`keypress`, renameDfPreset.bind(null, heading, preset, presetDisplay, presetInput));
                heading.addEventListener(`click`, applyDfPreset.bind(null, df, exceptionCount, popup, preset, presetDisplay, presetInput));
                renameButton = row.firstElementChild.nextElementSibling.firstElementChild;
                renameButton.addEventListener(`click`, showGfRenameInput.bind(null, heading, renameInput));
                renameButton.nextElementSibling.addEventListener(`click`, deleteDfPreset.bind(null, deleted, preset, row, undoButton));
            });
            popup.open();
        });
    }

    function setDfSource(df, preset, row, event) {
        var i, presets;
        event.dataTransfer.setData(`text/plain`, ``);
        df.source = row;
        getValue(`dfPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
            df.sourceIndex = i;
        });
    }

    function saveDfSource(df) {
        var presets;
        getValue(`dfPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            presets.splice(df.sourceNewIndex, 0, presets.splice(df.sourceIndex, 1)[0]);
            setValue(`dfPresets`, JSON.stringify(presets));
        });
    }

    function applyDfPreset(df, exceptionCount, popup, preset, presetDisplay, presetInput) {
        var checkbox, input, key;
        [`maxComments`, `minComments`, `announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`].forEach(key => {
            checkbox = df[`${key}Checkbox`];
            if (checkbox) {
                if (checkbox.isThreeState) {
                    df[key] = checkbox.value = preset[key];
                    checkbox.change(false, df[key]);
                } else {
                    if (preset[key]) {
                        df[key] = true;
                        checkbox.check();
                    } else {
                        df[key] = false;
                        checkbox.uncheck();
                    }
                }
            } else {
                input = df[`${key}Input`];
                if (input) {
                    df[key] = input.value = preset[key];
                    input.dispatchEvent(new Event(`change`));
                }
            }
        });
        presetDisplay.textContent = presetInput.value = preset.name;
        if (preset.exceptions) {
            df.exceptions = preset.exceptions;
            exceptionCount.textContent = preset.exceptions.length;
        } else {
            exceptionCount.textContent = 0;
        }
        df.overrides = preset.overrides || {};
        for (key in df.overrideButtons) {
            df.overrideButtons[key].change();
        }
        setSetting(`df_preset${esgst.df.type}`, preset.name).then(() => {
            popup.close();
            filterDfDiscussions(df);
        });
    }

    function renameDfPreset(heading, preset, presetDisplay, presetInput, event) {
        var i, newName, oldName, presets;
        if (event.key === `Enter`) {
            oldName = preset.name;
            newName = event.currentTarget.value;
            getValue(`dfPresets`).then(value => {
                presets = JSON.parse(value);
                for (i = presets.length - 1; i >= 0 && presets[i].name !== oldName; --i);
                preset.name = presets[i].name = newName;
                setValue(`dfPresets`, JSON.stringify(presets));
                heading.textContent = newName;
                if (presetInput.value === oldName) {
                    presetDisplay.textContent = presetInput.value = newName;
                }
                if (esgst[`df_preset${esgst.df.type}`] === oldName) {
                    setSetting(`df_preset${esgst.df.type}`, newName);
                }
                event.currentTarget.classList.add(`esgst-hidden`);
                heading.classList.remove(`esgst-hidden`);
            });
        }
    }

    function deleteDfPreset(deleted, preset, row, undoButton, event) {
        var deleteButton, i, presets;
        deleteButton = event.currentTarget;
        deleteButton.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        getValue(`dfPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
            presets.splice(i, 1);
            return setValue(`dfPresets`, JSON.stringify(presets));
        }).then(() => {
            deleteButton.innerHTML = `<i class="fa fa-trash"></i>`;
            row.classList.add(`esgst-hidden`);
            deleted.push({
                details: preset,
                row: row
            });
            undoButton.classList.remove(`esgst-hidden`);
        });
    }

    function undoDfDeletePreset(deleted, undoButton) {
        var preset, presets;
        preset = deleted.pop();
        preset.row.classList.remove(`esgst-hidden`);
        preset.row.parentElement.appendChild(preset.row);
        getValue(`dfPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            presets.push(preset.details);
            setValue(`dfPresets`, JSON.stringify(presets));
            if (deleted.length === 0) {
                undoButton.classList.add(`esgst-hidden`);
            }
        });
    }

    function openDfExceptionPopup(exceptionCount, df, presetInput) {
        var deleted, details, i, max, min, name, popup, preset, presets, row, table, undoButton;
        popup = new Popup(`fa-gear`, `Manage exceptions: <i class="fa fa-question-circle" title="Exceptions are discussion that will always appear, no matter which filters are set (they still get filtered by type filters). For example, if you have a filter that only shows discussion with 100+ comments, but you have an exception for deals, all deal discussions will appear, regardless of their number of comments.\n\nEach exception works as an AND conjunction, so if you want to make an exception for deal discussions **or** poll discussions, you have to create 2 separate exceptions, otherwise the exception will be for discussions that are both deal **and** poll."></i>`, true);
        deleted = [];
        undoButton = insertHtml(popup.description, `beforeEnd`, `
            <div class="esgst-clickable esgst-hidden">
                <i class="fa fa-rotate-left"></i>
                <span>Undo Delete</span>
            </div>
        `);
        table = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left popup__keys__list"></div>`);
        name = presetInput.value;
        getValue(`dfPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== name; --i);
            preset = presets[i];
            undoButton.addEventListener(`click`, undoDfDeleteException.bind(null, deleted, exceptionCount, df, preset, undoButton));
            if (preset.exceptions) {
                preset.exceptions.forEach(exception => {
                    details = ``;
                    [ { key: `Comments`, name: `comments` }
                    ].forEach(filter => {
                        max = exception[`max${filter.key}`];
                        min = exception[`min${filter.key}`];
                        if (typeof max !== `undefined` && typeof min !== `undefined`) {
                            details += `${min}-${max} ${filter.name}, `;
                        } else if (typeof max !== `undefined`) {
                            details += `?-${max} ${filter.name}, `;
                        } else if (typeof min !== `undefined`) {
                            details += `${min}-? ${filter.name}, `;
                        }
                    });
                    [ { key: `announcements`, name: `announcements` },
                        { key: `bugs_suggestions`, name: `bugs / suggestions` },
                        { key: `deals`, name: `deals` },
                        { key: `general`, name: `general` },
                        { key: `groupRecruitment`, name: `group recruitment` },
                        { key: `letsPlayTogether`, name: `let's play together` },
                        { key: `offTopic`, name: `off-topic` },
                        { key: `puzzles`, name: `puzzles` },
                        { key: `uncategorized`, name: `uncategorized` },
                        { key: `created`, name: `created` },
                        { key: `poll`, name: `poll`},
                        { key: `highlighted`, name: `highlighted` },
                        { key: `visited`, name: `visited` },
                        { key: `unread`, name: `unread` }
                    ].forEach(key => {
                        if (exception[key.key]) {
                            details += `${key.name}, `;
                        }
                    });
                    row = insertHtml(table, `beforeEnd`, `
                        <div>
                            <div class="esgst-bold esgst-clickable esgst-float-left">${exception.name}</div>
                            <div class="esgst-clickable esgst-float-right">
                                <i class="fa fa-edit" title="Edit exception"></i>
                                <span title="Delete exception">
                                    <i class="fa fa-trash"></i>
                                </span>
                            </div>
                            <div class="esgst-clear"></div>
                            <div class="esgst-description">${details.slice(0, -2)}</div>
                        </div>
                    `);
                    heading = row.firstElementChild;
                    editButton = heading.nextElementSibling.firstElementChild;
                    editButton.addEventListener(`click`, openDfManageExceptionPopup.bind(null, exception, exceptionCount, df, preset, () => popup.close()));
                    editButton.nextElementSibling.addEventListener(`click`, deleteDfException.bind(null, deleted, exception, exceptionCount, df, heading, preset, row, undoButton));
                });
            }
            popup.description.appendChild(new ButtonSet(`green`, ``, `fa-plus`, ``, `Create Exception`, ``, openDfManageExceptionPopup.bind(null, {}, exceptionCount, df, preset, () => popup.close())).set);
            popup.open();
        });
    }

    function openDfManageExceptionPopup(exception, exceptionCount, df, preset, callback) {
        var basicFilters, categoryFilters, context, typeFilters;
        if (callback) {
            callback();
        }
        popup = new Popup(`fa-edit`, `Create/edit exception:`, true);
        popup.scrollable.classList.add(`esgst-gf-container`, `esgst-gf-filters`, `esgst-text-left`);
        popup.name = insertHtml(popup.description, `afterBegin`, `Name: <input type="text" value="${exception.name || ``}"/>`);
        basicFilters = insertHtml(popup.scrollable, `beforeEnd`, `
            <div class="esgst-gf-basic-filters">
                <div>
                    <span class="esgst-bold">Basic Filters:</span>
                </div>
            </div>
        `);
        [{ key: `Comments`, name: `Comments` }
        ].forEach(filter => {
            context = insertHtml(basicFilters, `beforeEnd`, `
                <div class="esgst-gf-basic-filter esgst-text-left">
                    <div>${filter.name} <span class="esgst-float-right"><input type="text" value="${exception[`min${filter.key}`] || ``}"/> - <input type="text" value="${exception[`max${filter.key}`] || ``}"/></span></div>
                </div>
            `).firstElementChild.lastElementChild;
            popup[`min${filter.key}`] = context.firstElementChild;
            popup[`max${filter.key}`] = context.lastElementChild;
        });
        typeFilters = insertHtml(popup.scrollable, `beforeEnd`, `
            <div class="esgst-gf-type-filters">
                <div>
                    <span class="esgst-bold">Type Filters:</span>
                </div>
            </div>
        `);
        [{ key: `announcements`, name: `Announcements` },
            { key: `bugs_suggestions`, name: `Bugs / Suggestions` },
            { key: `deals`, name: `Deals` },
            { key: `general`, name: `General` },
            { key: `groupRecruitment`, name: `Group Recruitment` },
            { key: `letsPlayTogether`, name: `Let's Play Together` },
            { key: `offTopic`, name: `Off-Topic` },
            { key: `puzzles`, name: `Puzzles` },
            { key: `uncategorized`, name: `Uncategorized` },
            { key: `created`, name: `Created` },
            { key: `poll`, name: `Poll`},
            { key: `highlighted`, name: `Highlighted` },
            { key: `visited`, name: `Visited` },
            { key: `unread`, name: `Unread` }
        ].forEach(filter => {
            popup[filter.key] = new Checkbox(insertHtml(typeFilters, `beforeEnd`, `<div class="esgst-gf-type-filter"><span></span> ${filter.name}</div>`).firstElementChild, exception[filter.key]);
        });
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveDfException.bind(null, exceptionCount, df, preset, popup)).set);
        popup.open();
    }

    function saveDfException(exceptionCount, df, preset, popup, callback) {
        var exception, i, presets;
        exception = { name: popup.name.value };
        [`Comments`].forEach(name => {
            if (popup[`max${name}`].value.length) {
                exception[`max${name}`] = parseFloat(popup[`max${name}`].value);
            }
            if (popup[`min${name}`].value.length) {
                exception[`min${name}`] = parseFloat(popup[`min${name}`].value);
            }
        });
        [`announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`].forEach(name => {
            if (popup[name].input.checked) {
                if (name === `genres`) {
                    if (popup.genreList.value.length) {
                        exception.genres = 1;
                        exception.genreList = popup.genreList.value;
                    }
                } else {
                    exception[name] = 1;
                }
            }
        });
        if (!preset.exceptions) {
            preset.exceptions = [];
        }
        for (i = preset.exceptions.length - 1; i >= 0 && preset.exceptions[i].name !== exception.name; --i);
        if (i >= 0) {
            preset.exceptions[i] = exception;
        } else {
            preset.exceptions.push(exception);
            exceptionCount.textContent = preset.exceptions.length;
        }
        df.exceptions = preset.exceptions;
        getValue(`dfPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
            presets[i] = preset;
            return setValue(`dfPresets`, JSON.stringify(presets));
        }).then(() => {
            callback();
            popup.close();
            filterDfDiscussions(df);
        });
    }

    function deleteDfException(deleted, exception, exceptionCount, df, heading, preset, row, undoButton, event) {
        var deleteButton, exception, i, preset, presets;
        deleteButton = event.currentTarget;
        deleteButton.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
        for (i = preset.exceptions.length - 1; i >= 0 && preset.exceptions[i].name !== exception.name; --i);
        preset.exceptions.splice(i, 1);
        df.exceptions = preset.exceptions;
        exceptionCount.textContent = preset.exceptions.length;
        getValue(`dfPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
            presets[i] = preset;
            return setValue(`dfPresets`, JSON.stringify(presets));
        }).then(() => {
            deleteButton.innerHTML = `<i class="fa fa-trash"></i>`;
            row.classList.add(`esgst-hidden`);
            deleted.push({
                details: exception,
                row: row
            });
            undoButton.classList.remove(`esgst-hidden`);
            filterDfDiscussions(df);
        });
    }

    function undoDfDeleteException(deleted, exceptionCount, df, preset, undoButton) {
        var exception, i, presets;
        exception = deleted.pop();
        exception.row.classList.remove(`esgst-hidden`);
        exception.row.parentElement.appendChild(exception.row);
        preset.exceptions.push(exception.details);
        df.exceptions = preset.exceptions;
        exceptionCount.textContent = preset.exceptions.length;
        getValue(`dfPresets`, `[]`).then(value => {
            presets = JSON.parse(value);
            for (i = presets.length - 1; i >= 0 && presets[i].name !== preset.name; --i);
            presets[i] = preset;
            setValue(`dfPresets`, JSON.stringify(presets));
            if (deleted.length === 0) {
                undoButton.classList.add(`esgst-hidden`);
            }
        });
    }

    function filterDfDiscussions(df, unfilter, endless) {
        let key;
        for (key in df.counters) {            
            df.counters[key].textContent = `0`;
        }
        esgst.currentDiscussions.forEach(discussion => {
            if (unfilter) {
                if (discussion.outerWrap.classList.contains(`esgst-hidden`)) {
                    discussion.outerWrap.classList.remove(`esgst-hidden`);
                }
            } else if (filterDfDiscussion(df, discussion)) {
                if (!discussion.outerWrap.classList.contains(`esgst-hidden`)) {
                    discussion.outerWrap.classList.add(`esgst-hidden`);
                }
            } else if (discussion.outerWrap.classList.contains(`esgst-hidden`)) {
                discussion.outerWrap.classList.remove(`esgst-hidden`);
            }
        });
        updateDfCount(df, endless);
    }

    function filterDfException(df, discussion) {
        var basicFilters, filtered, i, j, key, maxKey, minKey, n, name, typeFilters;
        basicFilters = [`Comments`];
        typeFilters = [`announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`];
        filtered = false;
        for (i = 0, n = basicFilters.length; !filtered && i < n; ++i) {
            name = basicFilters[i];
            key = name.toLowerCase();
            maxKey = `max${name}`;
            minKey = `min${name}`;
            if (typeof df[minKey] !== `undefined`) {
                filtered = discussion[key] >= df[minKey] ? false : true;
            }
            if (!filtered && typeof df[maxKey] !== `undefined`) {
                filtered = discussion[key] <= df[maxKey] ? false : true;
            }
        }
        for (i = 0, n = typeFilters.length; !filtered && i < n; ++i) {
            key = typeFilters[i];
            if (df[key]) {
                filtered = discussion[key] ? false : true;
            }
        }
        return filtered;
    }

    function filterDfDiscussion(df, discussion) {
        var basicFilters, counterKey, filtered, i, j, key, maxKey, minKey, n, name, override, typeFilters;
        basicFilters = [`Comments`];
        typeFilters = [`announcements`, `bugs_suggestions`, `deals`, `general`, `groupRecruitment`, `letsPlayTogether`, `offTopic`, `puzzles`, `uncategorized`, `created`, `poll`, `highlighted`, `visited`, `unread`];
        filtered = false;
        override = 0;
        for (i = 0, n = basicFilters.length; i < n && (!filtered || !override); ++i) {
            name = basicFilters[i];
            key = name.toLowerCase();
            maxKey = `max${name}`;
            minKey = `min${name}`;
            if (discussion[key] < df[minKey] || discussion[key] > df[maxKey]) {
                filtered = true;
                override = df.overrides[key];
                counterKey = key;
            }
        }
        for (i = 0, n = typeFilters.length; i < n && (!filtered || !override); ++i) {
            key = typeFilters[i];
            if ((df[key] === `disabled` && discussion[key]) || (df[key] === `none` && !discussion[key])) {
                filtered = true;
                override = df.overrides[key];
                if (!counterKey) {
                    counterKey = key;
                }
            }
        }
        if (df.exceptions && !override) {
            for (i = df.exceptions.length - 1; i >= 0 && filtered; --i) {
                filtered = filterDfException(df.exceptions[i], discussion);
            }
        }
        if (filtered) {            
            df.counters[counterKey].textContent = parseInt(df.counters[counterKey].textContent) + 1;
        }
        return filtered;
    }

    function updateDfCount(df, endless) {
        var filtered, discussion, i;
        filtered = 0;
        for (i = esgst.currentDiscussions.length - 1; i > -1; --i) {
            discussion = esgst.currentDiscussions[i];
            if (document.body.contains(discussion.outerWrap) || endless) {
                if (discussion.outerWrap.classList.contains(`esgst-hidden`)) {
                    filtered += 1;
                }
            } else {
                esgst.currentDiscussions.splice(i, 1);
            }
        }
        df.filteredCount.textContent = filtered;
        df.paginationFilteredCount.textContent = filtered;
    }

    /* [DH] Discussions Highlighter */

    function loadDh() {
        var button, code, comments, container, heading, source;
        button = insertHtml(document.getElementsByClassName(`nav__absolute-dropdown`)[1], `beforeEnd`, generateHeaderMenuItem({description: `View your highlighted discussions.`, icon: `fa-star yellow`, name: `View Highlighted`}));
        button.addEventListener(`click`, function() {
            var discussions, i, keys, popup, set;
            popup = new Popup(`fa-star`, `Highlighted Discussions`);
            popup.highlightedDiscussions = insertHtml(popup.scrollable, `afterBegin`, `
                <div class="table esgst-text-left">
                    <div class="table__heading">
                        <div class="table__column--width-fill">Summary</div>
                        <div class="table__column--width-small text-center">Comments</div>
                    </div>
                </div>
            `);
            getValue(`discussions`).then(value => {
                discussions = JSON.parse(value);
                keys = Object.keys(discussions);
                i = 0;
                set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load more...`, `Loading more...`, function (callback) {
                    getDhHighlightedDiscussions(discussions, i, i, keys, i + 5, popup, function (value) {
                        i = value;
                        if (i > keys.length) {
                            set.set.remove();
                        } else if (esgst.es_dh && popup.scrollable.scrollHeight <= popup.scrollable.offsetHeight) {
                            set.trigger();
                        }
                        callback();
                    });
                });
                popup.description.appendChild(set.set);
                popup.open();
                set.trigger();
                if (esgst.es_dh) {
                    popup.scrollable.addEventListener(`scroll`, function () {
                        if ((popup.scrollable.scrollTop + popup.scrollable.offsetHeight) >= popup.scrollable.scrollHeight && !set.busy) {
                            set.trigger();
                        }
                    });
                }
            });
        });
    }

    function highlightDhDiscussion(code, context, save) {
        if (save) {
            createLock(`commentLock`, 300, function(deleteLock) {
                var comments;
                getValue(`discussions`).then(value => {
                    comments = JSON.parse(value);
                    if (!comments[code]) {
                        comments[code] = {
                            readComments: {}
                        };
                    }
                    comments[code].highlighted = true;
                    comments[code].lastUsed = Date.now();
                    return etValue(`discussions`, JSON.stringify(comments));
                }).then(() => {
                    context.classList.add(`esgst-dh-highlighted`);
                    deleteLock();
                });
            });
        } else {
            context.classList.add(`esgst-dh-highlighted`);
        }
    }

    function unhighlightDhDiscussion(code, context, save) {
        if (save) {
            createLock(`commentLock`, 300, function(deleteLock) {
                var comments;
                getValue(`discussions`).then(value => {
                    comments = JSON.parse(value);
                    delete comments[code].highlighted;
                    comments[code].lastUsed = Date.now();
                    return setValue(`discussions`, JSON.stringify(comments));
                }).then(() => {
                    context.classList.remove(`esgst-dh-highlighted`);
                    deleteLock();
                });
            });
        } else {
            context.classList.remove(`esgst-dh-highlighted`);
        }
    }

    function addDhHighlightButton(code, container, context) {
        var button;
        if (!context.getElementsByClassName(`esgst-dh-button`)[0]) {
            button = insertHtml(context, `afterBegin`, `
                <div class="esgst-dh-button" title="Click to highlight this discussion">
                    <i class="fa fa-star-o"></i>
                </div>
            `);
            button.addEventListener(`click`, function() {
                highlightDhDiscussion(code, container, true);
                button.remove();
                addDhUnhighlightButton(code, container, context);
            });
        }
    }

    function addDhUnhighlightButton(code, container, context) {
        var button;
        if (!context.getElementsByClassName(`esgst-dh-button`)[0]) {
            button = insertHtml(context, `afterBegin`, `
                <div class="esgst-dh-button" title="Click to unhighlight this discussion">
                    <i class="fa fa-star"></i>
                </div>
            `);
            button.addEventListener(`click`, function() {
                unhighlightDhDiscussion(code, container, true);
                button.remove();
                addDhHighlightButton(code, container, context);
            });
        }
    }

    function getDhHighlightedDiscussions(discussions, i, j, keys, n, popup, callback) {
        var key;
        if (i < n) {
            key = keys[j];
            if (key) {
                if (discussions[key].highlighted) {
                    request(null, null, `GET`, false, `/discussion/${key}/`, function(response) {
                        var breadcrumbs, categoryLink, context, usernameLink;
                        context = parseHtml(response.responseText);
                        breadcrumbs = context.getElementsByClassName(`page__heading__breadcrumbs`);
                        categoryLink = breadcrumbs[0].firstElementChild.nextElementSibling.nextElementSibling;
                        usernameLink = context.getElementsByClassName(`comment__username`)[0].firstElementChild;
                        popup.highlightedDiscussions.insertAdjacentHTML(`beforeEnd`, `
                            <div>
                                <div class="table__row-outer-wrap">
                                    <div class="table__row-inner-wrap">
                                        <div>
                                            ${context.getElementsByClassName(`global__image-outer-wrap`)[0].outerHTML}
                                        </div>
                                        <div class="table__column--width-fill">
                                            <h3>
                                                <a class="table__column__heading" href="/discussion/${key}/">${categoryLink.nextElementSibling.nextElementSibling.firstElementChild.textContent}</a>
                                            </h3>
                                            <p>
                                                <a class="table__column__secondary-link" href="${categoryLink.getAttribute(`href`)}">${categoryLink.textContent}</a> -
                                                ${context.querySelector(`.comment [data-timestamp]`).outerHTML} ago by
                                                <a class="table__column__secondary-link" href="${usernameLink.getAttribute(`href`)}">${usernameLink.textContent}</a>
                                            </p>
                                        </div>
                                        <div class="table__column--width-small text-center">
                                            <a class="table__column__secondary-link" href="/discussion/${key}/">${breadcrumbs[1].textContent.match(/(.+) Comments?/)[1]}</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `);
                        loadEndlessFeatures(popup.highlightedDiscussions.lastElementChild).then(() => {
                            if (!esgst.giveawaysPath && !esgst.discussionsPath) {
                                if (esgst.gdttt) {
                                    addCtDiscussionPanels(popup.highlightedDiscussions.lastElementChild, false, null, false, true);
                                    checkGdtttVisited(popup.highlightedDiscussions.lastElementChild);
                                } else if (esgst.ct) {
                                    addCtDiscussionPanels(popup.highlightedDiscussions.lastElementChild, false, null, false, true);
                                }
                                loadDiscussionFeatures(popup.highlightedDiscussions.lastElementChild);
                            }
                            setTimeout(getDhHighlightedDiscussions, 0, discussions, ++i, ++j, keys, n, popup, callback);
                        });
                    });
                } else {
                    setTimeout(getDhHighlightedDiscussions, 0, discussions, i, ++j, keys, n, popup, callback);
                }
            } else {
                callback(j + 1);
            }
        } else {
            callback(j);
        }
    }

    /* [MPP] Main Post Popup */

    function loadMpp() {
        if (esgst.discussionPath) {
            let button, discussion, MPPPost, Sibling, Visited, Timestamp, Hidden;
            let key, position;
            if (esgst.leftButtonIds.indexOf(`mpp`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            button = insertHtml(esgst.hideButtons && esgst.hideButtons_mpp ? esgst[key] : esgst.mainPageHeading, position, `
                <div class="esgst-heading-button" id="esgst-mpp" title="Open the main post">
                    <i class="fa fa-home"></i>
                </div>
            `);
            MPPPost = document.createElement(`div`);
            MPPPost.className = `page__outer-wrap`;
            do {
                Sibling = esgst.mainPageHeading.previousElementSibling;
                if (Sibling) {
                    MPPPost.insertBefore(Sibling, MPPPost.firstElementChild);
                }
            } while (Sibling);
            esgst.mainPageHeading.parentElement.insertBefore(MPPPost, esgst.mainPageHeading);
            new Promise((resolve, reject) => {
                if (esgst.mpp_r) {
                    getValue(`discussions`).then(value => {
                        discussion = JSON.parse(value)[location.pathname.match(/^\/discussion\/(.+?)\//)[1]];
                        if (discussion) {
                            if (discussion.readComments && discussion.readComments[``]) {
                                Hidden = true;
                                scrollTo(0, 0);
                                goToComment(esgst.originalHash);
                            } else {
                                Hidden = false;
                            }
                        } else {
                            Hidden = false;
                        }
                        resolve();
                    });
                } else {
                    Hidden = true;
                    scrollTo(0, 0);
                    goToComment(esgst.originalHash);
                    resolve();
                }
            }).then(() => {
                MPPPost.classList.add(Hidden ? `esgst-mpp-hidden` : `esgst-mpp-visible`);
                button.addEventListener(`click`, function () {
                    if (!Hidden) {
                        MPPPost.classList.remove(`esgst-mpp-visible`);
                        MPPPost.classList.add(`esgst-mpp-hidden`);
                    }
                    popup = new Popup(null, null, false, false, MPPPost);
                    MPPPost.classList.add(`esgst-mpp-popup`);
                    popup.open();
                    popup.onClose = function () {
                        MPPPost.classList.remove(`esgst-mpp-popup`);
                        if (!Hidden) {
                            MPPPost.classList.remove(`esgst-mpp-hidden`);
                            MPPPost.classList.add(`esgst-mpp-visible`);
                            MPPPost.removeAttribute(`style`);
                            esgst.mainPageHeading.parentElement.insertBefore(MPPPost, esgst.mainPageHeading);
                        }
                    };
                });
            });
        }
    }

    /* [DED] Discussion Edits Detector */

    function addDEDButton(Context, CommentURL, DEDCallback) {
        var TradeCode, ParentID, Description, URL, DEDButton, DEDStatus, ResponseHTML;
        TradeCode = Context.querySelector(`[name="trade_code"]`);
        TradeCode = TradeCode ? TradeCode.value : ``;
        ParentID = Context.querySelector(`[name="parent_id"]`);
        Description = Context.querySelector(`[name="description"]`);
        URL = esgst.sg ? location.href.match(/(.+?)(#.+?)?$/)[1] : `/ajax.php`;
        Context = Context.getElementsByClassName(esgst.sg ? `align-button-container` : `btn_actions`)[0];
        Context.firstElementChild.remove();
        Context.insertAdjacentHTML(`afterBegin`, `<div class="esgst-ded-button"></div>`);
        Context.insertAdjacentHTML(`beforeEnd`, `<div class="comment__actions action_list esgst-ded-status"></div>`);
        DEDButton = Context.firstElementChild;
        DEDStatus = Context.lastElementChild;
        DEDButton.appendChild(new ButtonSet(`grey`, `grey`, `fa-send`, `fa-circle-o-notch fa-spin`, `Submit`, `Saving...`, function (Callback) {
            DEDStatus.innerHTML = ``;
            if (CommentURL) {
                request(null, null, `GET`, false, CommentURL, function (Response) {
                    ResponseHTML = parseHtml(Response.responseText);
                    TradeCode = esgst.sg ? `` : Response.finalUrl.match(/\/trade\/(.+?)\//)[1];
                    ParentID = ResponseHTML.getElementById(CommentURL.match(/\/comment\/(.+)/)[1]);
                    ParentID = esgst.sg ? ParentID.closest(`.comment`).getAttribute(`data-comment-id`) : ParentID.getAttribute(`data-id`);
                    URL = esgst.sg ? Response.finalUrl.match(/(.+?)(#.+?)?$/)[1] : `/ajax.php`;
                    saveComment(TradeCode, ParentID, Description.value, URL, DEDStatus, Callback, DEDCallback);
                });
            } else {
                saveComment(TradeCode, ParentID.value, Description.value, URL, DEDStatus, Callback, DEDCallback);
            }
        }).set);
    }

    /* [TB] Trades Bumper */

    function getTbTrades(button, context, callback) {
        var elements, i, n;
        if (button) {
            button.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
            `;
        }
        elements = context.querySelectorAll(`.row_inner_wrap:not(.is_faded)`);
        n = elements.length;
        if (n > 0) {
            bumpTbTrades(button, elements, 0, n, callback);
        } else if (button) {
            button.innerHTML = `
                <i class="fa fa-chevron-circle-up"></i>
            `;
        }
    }

    function bumpTbTrades(button, elements, i, n, callback) {
        if (i < n) {
            request(`xsrf_token=${esgst.xsrfToken}&do=trade_bump&code=${elements[i].querySelector(`[href*="/trade/"]`).getAttribute(`href`).match(/\/trade\/(.+?)\//)[1]}`, null, `POST`, false, `https://www.steamtrades.com/ajax.php`, bumpTbTrades.bind(null, button, elements, ++i, n, callback));
        } else {
            if (button) {
                button.innerHTML = `
                    <i class="fa fa-chevron-circle-up"></i>
                `;
            }
            if (callback) {
                callback();
            } else {
                location.reload();
            }
        }
    }

    function setTbAutoBump(button) {
        var currentTime, dif, lastBump;
        getValue(`lastBump`, 0).then(value => {
            lastBump = value;
            currentTime = Date.now();
            dif = currentTime - lastBump;
            if (dif > 3600000) {
                setValue(`lastBump`, currentTime).then(autoBumpTbTrades.bind(null, button));
            } else {
                setTimeout(setTbAutoBump, 3600000 - dif, button);
            }
        });
    }

    function autoBumpTbTrades(button) {
        if (location.href.match(new RegExp(`\\/trades\\/search\\?user=${esgst.steamId}`))) {
            getTbTrades(button, document);
        } else {
            request(null, null, `GET`, true, `https://www.steamtrades.com/trades/search?user=${esgst.steamId}`, loadTbTrades.bind(null, button));
        }
    }

    function loadTbTrades(button, response) {
        getTbTrades(null, parseHtml(response.responseText), setTimeout.bind(null, setTbAutoBump, 3900000, button));
    }

    /* [RML] Reply Mention Link */

    function addRmlLinks(context) {
        var matches = context.getElementsByClassName(esgst.sg ? `comment__children` : `comment_children`);
        for (var i = 0, n = matches.length; i < n; ++i) {
            var Matches = matches[i].children;
            if (Matches.length) {
                addRMLLink(esgst.sg ? matches[i].parentElement.getElementsByClassName(`comment__summary`)[0] : matches[i].parentElement, Matches);
            }
        }
    }

    function addRMLLink(Context, Matches) {
        var Username, ID, I, N, RMLLink;
        Username = Context.getElementsByClassName(esgst.sg ? `comment__username` : `author_name`)[0].textContent.trim();
        ID = Context.id;
        for (I = 0, N = Matches.length; I < N; ++I) {
            Context = Matches[I].getElementsByClassName(esgst.sg ? `comment__actions` : `action_list`)[0];
            RMLLink = Context.getElementsByClassName(`esgst-rml-link`)[0];
            if (RMLLink) {
                RMLLink.textContent = `@${Username}`;
            } else {
                Context.insertAdjacentHTML(`beforeEnd`, `<a class="comment__actions__button esgst-rml-link" href="#${ID}">@${Username}</a>`);
            }
        }
    }

    function setCfhTextAreas(context) {
        let i, textAreas;
        textAreas = context.querySelectorAll(`textarea[name*="description"]`);
        for (i = textAreas.length - 1; i > -1; --i) {
            addCfhPanel(textAreas[i]);
        }
    }

    function addCfhPanel(textArea) {
        if (textArea !== esgst.cfh.textArea) {
            textArea.parentElement.insertBefore(esgst.cfh.panel, textArea);
            textArea.onfocus = addCfhPanel.bind(null, textArea);
            textArea.onpaste = event => {
                if (esgst.cfh_pasteFormatting) {
                    let clipboard, value;
                    clipboard = event.clipboardData.getData(`text/plain`);
                    if (clipboard.match(/^https?:/)) {
                        event.preventDefault();
                        value = textArea.value;
                        undoCfhFormatting(textArea, `${value.slice(0, textArea.selectionStart)}${clipboard}${value.slice(textArea.selectionEnd)}`);
                        formatCfhLink(``, clipboard, clipboard.match(/\.(jpg|jpeg|gif|bmp|png)/), true);
                    }
                }
            };
            if (esgst.cfh_p) {
                esgst.cfh.preview.innerHTML = ``;
                textArea.parentElement.insertBefore(esgst.cfh.preview, textArea.nextElementSibling);
                if (esgst.cfh_p_a) {
                    textArea.oninput = () => {
                        esgst.cfh.preview.innerHTML = parseMarkdown(textArea.value);
                        formatCfhImages(esgst.cfh.preview);
                    };
                }
            }
            esgst.cfh.textArea = textArea;
        }
    }

    function undoCfhFormatting(textArea, value) {
        esgst.cfh.history.push(value);
        esgst.cfh.undo.classList.remove(`esgst-faded`);
        textArea.onkeydown = event => {
            textArea.onkeydown = null;
            if (event.key === `Backspace`) {
                event.preventDefault();
                esgst.cfh.undo.click();
            }
        };
    }

    function redoCfhFormatting(textArea, value) {
        esgst.cfh.backup.push(value);
        esgst.cfh.redo.classList.remove(`esgst-faded`);
        textArea.onkeydown = event => {
            if (event.key !== `Shift`) {
                textArea.onkeydown = null;
                if (event.shiftKey && event.key === `Backspace`) {
                    event.preventDefault();
                    esgst.cfh.redo.click();
                }
            }
        };
    }

    function formatCfhItem(prefix = ``, suffix = ``, multiline) {
        let end, n, range, start, text, value;
        value = esgst.cfh.textArea.value;
        undoCfhFormatting(esgst.cfh.textArea, value);
        start = esgst.cfh.textArea.selectionStart;
        end = esgst.cfh.textArea.selectionEnd;
        text = value.slice(start, end);
        range = text.length;
        if (multiline) {
            n = 0;
            text = text.replace(/^|\n/g, match => {
                return `${match}${prefix.replace(/\[n\]/, ++n)}`;
            });
        } else {
            text = `${prefix}${text}${suffix}`;
        }
        range += range > 0 ? start + text.length - range : start + text.length - range - suffix.length;
        esgst.cfh.textArea.value = `${value.slice(0, start)}${text}${value.slice(end)}`;
        esgst.cfh.textArea.setSelectionRange(range, range);
        esgst.cfh.textArea.focus();
    }

    function formatCfhLink(title, url, isImage, isPaste) {
        let end, start, value;
        if (!isPaste) {
            undoCfhFormatting(esgst.cfh.textArea, esgst.cfh.textArea.value);
        }
        start = esgst.cfh.textArea.selectionStart;
        end = esgst.cfh.textArea.selectionEnd;
        value = isImage ? `![${title}](${url})` : `[${title}](${url})`;
        esgst.cfh.textArea.value = `${esgst.cfh.textArea.value.slice(0, start)}${value}${esgst.cfh.textArea.value.slice(end)}`;
        if (title) {
            esgst.cfh.textArea.setSelectionRange(end + value.length, end + value.length);
        } else {
            esgst.cfh.textArea.setSelectionRange(end + value.indexOf(`[`) + 1, end + value.indexOf(`[`) + 1);
        }
        esgst.cfh.textArea.focus();
    }

    function checkImgurComplete(popout, url) {
        getValue(`imgurToken`).then(value => {
            if (value) {
                uploadImgurImage(`Bearer ${value}`, popout, url);
            } else {
                setTimeout(checkImgurComplete, 250, popout, url);
            }
        });
    }

    function uploadImgurImage(authorization, popout, url) {
        let input, popup, warning;
        popup = new Popup(`fa-upload`, `Upload Image`, true);
        input = insertHtml(popup.description, `beforeEnd`, `<input type="file"/>`);
        warning = insertHtml(popup.description, `beforeEnd`, `<div class="esgst-description esgst-warning"></div>`);
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-upload`, `fa-circle-o-notch fa-spin`, `Upload`, `Uploading...`, callback => {
            let file = input.files[0];
            if (file) {
                if (file.type.match(/^image/)) {
                    if (file.size / 1024 / 1024 <= 10) {
                        let reader = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onload = readImgurFile.bind(null, authorization, popout, popup, reader, url, warning, callback);
                    } else {
                        createFadeMessage(warning, `Image is larger than 10 MB!`);
                        callback();
                    }
                } else {
                    createFadeMessage(warning, `File is not an image!`);
                    callback();
                }
            } else {
                createFadeMessage(warning, `No file was loaded!`);
                callback();
            }
        }).set);
        if (esgst.cfh_img_remember) {
            popup.description.appendChild(new ButtonSet(`grey`, `grey`, `fa-rotate-left`, `fa-circle-o-notch fa-spin`, `Reset`, `Resetting...`, callback => {
                setSetting(`cfh_img_remember`, false).then(() => {
                    esgst.cfh_img_remember = false;
                    callback();
                    popup.close();
                });
            }).set);
        }
        popup.open();
    }

    function readImgurFile(authorization, popout, popup, reader, url, warning, callback) {
        request(`image=${encodeURIComponent(reader.result.match(/base64,(.+)/)[1])}`, {authorization}, `POST`, false, `https://api.imgur.com/3/image`, response => {
            let responseJson = JSON.parse(response.responseText);
            if (responseJson.success) {
                callback();
                popup.close();
                url.value = responseJson.data.link;
                popout.open();
            } else {
                createFadeMessage(warning, `Could not upload image!`);
                callback();
            }
        });
    }

    function insertCfhTableRows(rows, table) {
        let deleteRow, i, j, n, row;
        while (rows > 0) {
            n = table.rows.length;
            row = table.insertRow(n);
            for (i = 0, j = table.rows[0].cells.length - 1; i < j; ++i) {
                row.insertCell(0).innerHTML = `<input placeholder="Value" type="text"/>`;
            }
            deleteRow = row.insertCell(0);
            if (n > 2) {
                deleteRow.innerHTML = `
                    <a>
                        <i class="fa fa-times-circle" title="Delete row"></i>
                    </a>
                `;
                deleteRow.firstElementChild.addEventListener(`click`, () => {
                    if (table.rows.length > 4) {
                        deleteRow.remove();
                    } else {
                        alert(`A table must have a least one row and two columns.`);
                    }
                });
            }
            --rows;
        }
    }

    function insertCfhTableColumns(columns, table) {
        let column, deleteColumn, i, j, n, rows;
        while (columns > 0) {
            rows = table.rows;
            n = rows[0].cells.length;
            for (i = 3, j = rows.length; i < j; ++i) {
                rows[i].insertCell(n).innerHTML = `<input placeholder="Value" type="text"/>`;
            }
            rows[2].insertCell(n).innerHTML = `
                <select>
                    <option value=":-">Left</option>
                    <option value=":-:">Center</option>
                    <option value="-:">Right</option>
                </select>
            `;
            column = rows[1].insertCell(n);
            column.innerHTML = `<input placeholder="Header" type="text"/>`;
            deleteColumn = rows[0].insertCell(n);
            deleteColumn.innerHTML = `
                <a>
                    <i class="fa fa-times-circle" title="Delete column"></i>
                </a>
            `;
            deleteColumn.firstElementChild.addEventListener(`click`, () => {
                rows = table.rows;
                n = rows[1].cells.length;
                if (n > 3) {
                    do {
                        --n;
                    } while (rows[1].cells[n] !== column);
                    for (i = 0, j = rows.length; i < j; ++i) {
                        rows[i].deleteCell(n);
                    }
                } else {
                    alert(`A table must have at least one row and two columns.`);
                }
            });
            --columns;
        }
    }

    function setCfhEmojis(emojis) {
        let emoji, i;
        for (i = emojis.children.length - 1; i > -1; --i) {
            emoji = emojis.children[i];
            emoji.addEventListener(`click`, formatCfhItem.bind(null, emoji.textContent, ``));
        }
    }

    function setCfhReply(replies, savedReply) {
        let editButton, description, name, reply, summary;
        reply = insertHtml(replies, `beforeEnd`, `
            <div class="esgst-cfh-sr-box" draggable="true">
                <div class="esgst-cfh-sr-summary">
                    <div class="esgst-cfh-sr-name">${savedReply.name}</div>
                    <div class="esgst-cfh-sr-description">${savedReply.description}</div>
                </div>
                <div class="esgst-cfh-sr-controls">
                    <i class="esgst-clickable fa fa-edit" title="Edit reply"></i>
                    <i class="esgst-clickable fa fa-trash" title="Delete reply"></i>
                    <i class="fa fa-question-circle" title="Drag the reply to move it"></i>
                </div>
            </div>
        `);
        summary = reply.firstElementChild;
        name = summary.firstElementChild;
        description = name.nextElementSibling;
        editButton = summary.nextElementSibling.firstElementChild;
        reply.addEventListener(`dragstart`, setCfhSource.bind(null, description, name, reply));
        reply.addEventListener(`dragenter`, getCfhSource.bind(null, reply, replies));
        reply.addEventListener(`dragend`, saveCfhSource);
        summary.addEventListener(`click`, () => {
            let end, i, matches, n, value;
            end = esgst.cfh.textArea.selectionEnd;
            value = savedReply.description;
            matches = value.match(/\[ESGST-R\][\s\S]+?\[\/ESGST-R\]/g);
            if (matches) {
                n = matches.length;
                i = Math.floor(Math.random() * n);
                value = matches[i].match(/\[ESGST-R\]([\s\S]+?)\[\/ESGST-R\]/)[1];
            }
            esgst.cfh.textArea.value = `${esgst.cfh.textArea.value.slice(0, esgst.cfh.textArea.selectionStart)}${value}${esgst.cfh.textArea.value.slice(end)}`;
            esgst.cfh.textArea.setSelectionRange(end + value.length, end + value.length);
            esgst.cfh.textArea.focus();
        });
        editButton.addEventListener(`click`, openCfhReplyPopup.bind(null, savedReply.description, savedReply.name, replies, summary));
        editButton.nextElementSibling.addEventListener(`click`, () => {
            let savedReplies;
            getValue(`savedReplies`, `[]`).then(value => {
                savedReplies = JSON.parse(value);
                for (i = savedReplies.length - 1; i > -1 && savedReplies[i].name !== name.textContent && savedReplies[i].description !== description.textContent; --i);
                if (i > -1) {
                    savedReplies.splice(i, 1);
                    setValue(`savedReplies`, JSON.stringify(savedReplies));
                    reply.classList.add(`esgst-hidden`);
                    esgst.cfh.deletedReplies.push({
                        reply: reply,
                        savedReply: savedReply
                    });
                    esgst.cfh.undoDelete.classList.remove(`esgst-hidden`);
                }
            });
        });
    }

    function setCfhSource(description, name, reply, event) {
        let i, savedReplies;
        event.dataTransfer.setData(`text/plain`, ``);
        esgst.cfh.source = reply;
        getValue(`savedReplies`, `[]`).then(value => {
            savedReplies = JSON.parse(value);
            for (i = savedReplies.length - 1; i > -1 && savedReplies[i].name !== name.textContent && savedReplies[i].description !== description.textContent; --i);
            if (i > -1) {
                esgst.cfh.sourceIndex = i;
            }
        });
    }

    function getCfhSource(reply, replies) {
        let current, i;
        current = esgst.cfh.source;
        i = 0;
        do {
            current = current.previousElementSibling;
            if (current && current === reply) {
                esgst.cfh.sourceNewIndex = i;
                replies.insertBefore(esgst.cfh.source, reply);
                return;
            }
            ++i;
        } while (current);
        esgst.cfh.sourceNewIndex = i - 1;
        replies.insertBefore(esgst.cfh.source, reply.nextElementSibling);
    }

    function saveCfhSource() {
        getValue(`savedReplies`, `[]`).then(value => {
            let savedReplies = JSON.parse(value);
            savedReplies.splice(esgst.cfh.sourceNewIndex, 0, savedReplies.splice(esgst.cfh.sourceIndex, 1)[0]);
            setValue(`savedReplies`, JSON.stringify(savedReplies));
        });
    }

    function openCfhReplyPopup(description, name, replies, summary) {
        let descriptionArea, nameArea, panel, popup;
        popup = new Popup(`fa-floppy-o`, summary ? `Edit reply:` : `Save new reply:`, true);
        popup.scrollable.insertAdjacentHTML(`beforeEnd`, `
            <div class="esgst-description">
                You can save a defined list of replies to be picked at random when using it. To do so, enclose each option with <span class="esgst-bold">[ESGST-R][/ESGST-R]</span>. For example, a defined list that renders a random "thank you" comment when using it would look like this:<br/><br/>
                [ESGST-R]Thanks![/ESGST-R]<br/>
                [ESGST-R]Thank you![/ESGST-R]<br/>
                [ESGST-R]Thank you so much!<br/><br/>
                Can't wait to play this game![/ESGST-R]
            </div>
        `);
        panel = insertHtml(popup.scrollable, `beforeEnd`, `
            <div>
                <div>
                    <div>Name:</div>
                    <input type="text" value="${name || ``}"/>
                </div>
                <div>
                    <div>Description:</div>
                    <textarea>${description || ``}</textarea>
                </div>
            </div>
        `);
        nameArea = panel.firstElementChild;
        descriptionArea = nameArea.nextElementSibling;
        nameArea = nameArea.lastElementChild;
        descriptionArea = descriptionArea.lastElementChild;
        if (esgst.cfh) {
            addCfhPanel(descriptionArea);
        }
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveCfhReply.bind(null, description, descriptionArea, name, nameArea, popup, replies, summary)).set);
        popup.open();
    }

    function saveCfhReply(description, descriptionArea, name, nameArea, popup, replies, summary, callback) {
        let descVal, i, nameVal, reply, savedReplies, savedReply;
        descVal = descriptionArea.value.trim();
        nameVal = nameArea.value.trim();
        if (descVal && nameVal) {
            getValue(`savedReplies`, `[]`).then(value => {
                savedReplies = JSON.parse(value);
                savedReply = {
                    description: descVal,
                    name: nameVal
                };
                if (summary) {
                    for (i = savedReplies.length - 1; i > -1 && savedReplies[i].name !== name && savedReplies[i].description !== description; --i);
                    if (i > -1) {
                        savedReplies[i] = savedReply;
                        summary.firstElementChild.textContent = nameVal;
                        summary.lastElementChild.textContent = descVal;
                    }
                } else {
                    savedReplies.push(savedReply);
                    setCfhReply(replies, savedReply);
                }
                return setValue(`savedReplies`, JSON.stringify(savedReplies));
            }).then(() => {
                callback();
                popup.close();
            });
        } else {
            callback();
            createAlert(`Both fields are required.`);
        }
    }

    function filterCfhReplies(replies, event) {
        let i, reply, value;
        value = event.currentTarget.value;
        for (i = replies.children.length - 1; i > -1; --i) {
            reply = replies.children[i];
            if (reply.textContent.toLowerCase().match(value.toLowerCase())) {
                reply.classList.remove(`esgst-hidden`);
            } else {
                reply.classList.add(`esgst-hidden`);
            }
        }
    }

    function undoCfhDelete() {
        let deleted, saved;
        deleted = esgst.cfh.deletedReplies.pop();
        deleted.reply.classList.remove(`esgst-hidden`);
        deleted.reply.parentElement.appendChild(deleted.reply);
        getValue(`savedReplies`, `[]`).then(value => {
            saved = JSON.parse(value);
            saved.push(deleted.savedReply);
            setValue(`savedReplies`, JSON.stringify(saved));
            if (esgst.cfh.deletedReplies.length === 0) {
                esgst.cfh.undoDelete.classList.add(`esgst-hidden`);
            }
        });
    }

    function setCfhAlipf(value) {
        if (typeof value === `undefined`) {
            value = esgst.cfh_pasteFormatting ? false : true;
        }
        setSetting(`cfh_pasteFormatting`, value);
        esgst.cfh_pasteFormatting = value;
        if (value) {
            esgst.cfh.alipf.title = `Automatic Links / Images Paste Formatting: ON`;
            esgst.cfh.alipf.classList.remove(`esgst-faded`);
        } else {
            esgst.cfh.alipf.title = `Automatic Links / Images Paste Formatting: OFF`;
            esgst.cfh.alipf.classList.add(`esgst-faded`);
        }
        if (esgst.cfh.textArea) {
            esgst.cfh.textArea.focus();
        }
    }

    function formatCfhImages(context) {
        let i, images, n;
        images = context.getElementsByTagName(`img`);
        for (i = 0, n = images.length; i < n; ++i) {
            image = images[0];
            context.appendChild(image);
            image.classList.add(`is-hidden`, `is_hidden`);
            image.outerHTML = `
                <div>
                    <div class="${esgst.sg ? `comment__toggle-attached` : `view_attached`}">View attached image.</div>
                    <a href="${image.getAttribute(`src`)}" rel="nofollow noreferrer" target="_blank">
                        ${image.outerHTML}
                    </a>
                </div>
            `;
        }
    }

    /* [CERB] Collapse/Expand Replies Button */

    function getCerbReplies(collapse, expand, permalink, context) {
        var elements, i, n, reply, replies;
        elements = context.querySelectorAll(`:not(.esgst-popup) .comments > .comment, :not(.esgst-popup) .comments > .comment_outer`);
        for (i = 0, n = elements.length; i < n; ++i) {
            reply = elements[i];
            replies = reply.querySelector(`.comment__children, .comment_children`);
            if (replies && replies.children.length) {
                setCerbButton(insertHtml(reply.firstElementChild, `afterBegin`, `
                    <div class="esgst-cerb-reply-button esgst-clickable">
                        <span title="Collapse all replies">
                            <i class="fa fa-minus-square"></i>
                        </span>
                        <span class="esgst-hidden" title="Expand all replies">
                            <i class="fa fa-plus-square"></i>
                        </span>
                    </div>
                `), permalink && reply.contains(permalink), reply, replies.children);
            }
        }
        if (esgst.cerb_a) {
            collapseAllCerbReplies(collapse, expand);
        }
    }

    function setCerbButton(button, permalink,  reply, replies) {
        var collapse, expand;
        collapse = button.firstElementChild;
        expand = collapse.nextElementSibling;
        esgst.cerbButtons.push({
            collapse: collapseCerbReplies.bind(null, collapse, expand, replies),
            expand: expandCerbReplies.bind(null, collapse, expand, replies),
            permalink: permalink
        });
        collapse.addEventListener(`click`, collapseCerbReplies.bind(null, collapse, expand, replies));
        expand.addEventListener(`click`, expandCerbReplies.bind(null, collapse, expand, replies));
        if (esgst.cerb_a && !permalink) {
            collapse.classList.toggle(`esgst-hidden`);
            expand.classList.toggle(`esgst-hidden`);
        }
    }

    function collapseCerbReplies(collapse, expand, replies) {
        var i, n, replies;
        for (i = 0, n = replies.length; i < n; ++i) {
            replies[i].classList.add(`esgst-hidden`);
        }
        collapse.classList.add(`esgst-hidden`);
        expand.classList.remove(`esgst-hidden`);
    }

    function expandCerbReplies(collapse, expand, replies) {
        var i, n, replies;
        for (i = 0, n = replies.length; i < n; ++i) {
            replies[i].classList.remove(`esgst-hidden`);
        }
        collapse.classList.remove(`esgst-hidden`);
        expand.classList.add(`esgst-hidden`);
    }

    function collapseAllCerbReplies(collapse, expand) {
        var i, n;
        for (i = 0, n = esgst.cerbButtons.length; i < n; ++i) {
            if (!esgst.cerbButtons[i].permalink) {
                esgst.cerbButtons[i].collapse();
            }
        }
        collapse.classList.add(`esgst-hidden`);
        expand.classList.remove(`esgst-hidden`);
    }

    function expandAllCerbReplies(collapse, expand) {
        var i, n;
        for (i = 0, n = esgst.cerbButtons.length; i < n; ++i) {
            esgst.cerbButtons[i].expand();
        }
        collapse.classList.remove(`esgst-hidden`);
        expand.classList.add(`esgst-hidden`);
    }

    /* [RBOT] Reply Box On Top */

    function loadRbot() {
        if (esgst.replyBox) {
            var html = `
                <div class="esgst-rbot"></div>
            `;
            var sibling;
            if (esgst.mainPageHeadingBackground) {
                sibling = esgst.mainPageHeadingBackground;
            } else {
                sibling = esgst.mainPageHeading;
            }
            sibling.insertAdjacentHTML(`afterEnd`, html);
            var box = sibling.nextElementSibling;
            box.appendChild(esgst.replyBox);
            var button = box.getElementsByClassName(esgst.cancelButtonClass)[0];
            if (button) {
                button.addEventListener(`click`, waitToRestoreReplyBox);
            }
        }

        function waitToRestoreReplyBox() {
            setTimeout(restoreReplyBox, 0);
        }

        function restoreReplyBox() {
            box.appendChild(esgst.replyBox);
        }
    }

    /* [CS] Comment Searcher */

    function openCsPopup(cs) {
        if (!cs.popup) {
            cs.popup = new Popup(`fa-comments` , `Search comments from specific users:`);
            cs.input = insertHtml(cs.popup.description, `afterBegin`, `<input type="text" placeholder="username1, username2, ..."/>`);
            cs.input.addEventListener(`keydown`, triggerCsInput.bind(null, cs));
            cs.results = insertHtml(cs.popup.scrollable, `beforeEnd`, `<div class="esgst-text-left"></div>`);
            cs.set = new ButtonSet(`green`, `grey`, `fa-search`, `fa-times`, `Search`, `Cancel`, startCsSearch.bind(null, cs), cancelCsSearch.bind(null, cs));
            cs.popup.description.appendChild(cs.set.set);
            cs.progress = insertHtml(cs.popup.description, `beforeEnd`, `<div></div>`);
        }
        cs.popup.open(focusCsInput.bind(null, cs));
    }

    function focusCsInput(cs) {
        cs.input.focus();
    }

    function triggerCsInput(cs, event) {
        if (event.key === `Enter`) {
            cs.set.trigger();
        }
    }

    function startCsSearch(cs, callback) {
        var cache, csCache;
        cs.canceled = false;
        cs.button.classList.add(`esgst-busy`);
        cs.results.innerHTML = ``;
        cs.usernames = cs.input.value.toLowerCase().replace(/(,\s*)+/g, function (match, p1, offset, string) {
            return (((offset === 0) || (offset === (string.length - match.length))) ? `` : `, `);
        }).split(`, `);
        match = location.pathname.match(/^\/(giveaway|discussion|support\/ticket|trade)\/(.+?)\//);
        cs.code = match[2];
        cs.type = match[1];
        cs.title = esgst.originalTitle.replace(/\s-\sPage\s\d+/, ``);
        searchCsComments(cs, 1, esgst.searchUrl, completeCsSearch.bind(null, cs, callback));
    }

    function searchCsComments(cs, nextPage, url, callback) {
        if (!cs.canceled) {
            request(null, null, `GET`, false, `${url}${nextPage}`, getNextCsPage.bind(null, cs, nextPage, url, callback));
        }
    }

    function getNextCsPage(cs, nextPage, url, callback, response) {
        var comments, element, elements, html, i, n, pagination, parent;
        if (!cs.canceled) {
            responseHtml = parseHtml(response.responseText);
            if (nextPage === 1) {
                cs.lastPage = getLastPage(responseHtml, false, esgst.discussionPath);
                cs.lastPage = cs.lastPage === 999999999 ? `` : ` of ${cs.lastPage}`;
            }
            cs.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Searching comments (page ${nextPage - 1}${cs.lastPage})...</span>
            `;
            comments = responseHtml.getElementsByClassName(`comments`);
            comments = comments[1] || comments[0];
            elements = comments.querySelectorAll(`.comment:not(.comment--submit), .comment_outer`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                if (esgst.sg) {
                    element.firstElementChild.classList.remove(`comment__parent`);
                    element.firstElementChild.classList.add(`comment__child`);
                }
                parent = element.parentElement.closest(`.comment, .comment_outer`);
                element = element.cloneNode(true);
                element.lastElementChild.innerHTML = ``;
                html = `<div class="comment comments comment_outer">`;
                if (parent) {
                    parent = parent.cloneNode(true);
                    parent.lastElementChild.remove();
                    parent.insertAdjacentHTML(`beforeEnd`, `
                        <div class="comment__children comment_children">${element.outerHTML}</div>
                    `);
                    html += parent.outerHTML;
                } else {
                    if (esgst.st) {
                        element.getElementsByClassName(`action_list`)[0].firstElementChild.insertAdjacentHTML(`afterEnd`, `
                            <a href="/${cs.type}/${cs.code}/">${cs.title} - Page ${nextPage}</a>
                        `);
                    }
                    html += esgst.sg ? `
                        <div class="comments__entity">
                            <p class="comments__entity__name">
                                <a href="/${cs.type}/${cs.code}/">${cs.title} - Page ${nextPage}</a>
                            </p>
                        </div>` : ``;
                    html += `<div class="comment__children comment_children">${element.outerHTML}</div>`;
                }
                html += `</div>`;
                if (cs.usernames.indexOf(element.querySelector(`.comment__username, .author_name`).textContent.trim().toLowerCase()) >= 0) {
                    cs.results.insertAdjacentHTML(`beforeEnd`, html);
                }
            }
            pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
            if (pagination && !pagination.lastElementChild.classList.contains(esgst.selectedClass)) {
                setTimeout(searchCsComments, 0, cs, ++nextPage, url, callback);
            } else {
                callback();
            }
        }
    }

    function completeCsSearch(cs, callback) {
        cs.button.classList.remove(`esgst-busy`);
        cs.progress.innerHTML = `${cs.results.children.length} results found.`;
        loadEndlessFeatures(cs.results).then(callback);
    }

    function cancelCsSearch(cs) {
        cs.button.classList.remove(`esgst-busy`);
        cs.canceled = true;
        cs.progress.innerHTML = `${cs.results.children.length} results found.`;
        loadEndlessFeatures(cs.results);
    }

    /* [RRBP] Received Reply Box Popup */

    function openRrbp(giveaway) {
        var popup, progress, textArea;
        popup = new Popup(`fa-comment`, `Add a comment:`);
        textArea = insertHtml(popup.scrollable, `beforeEnd`, `<textarea></textarea>`);
        if (esgst.cfh) {
            addCfhPanel(textArea);
        }
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, function (callback) {
            progress.innerHTML = ``;
            saveComment(``, ``, textArea.value, giveaway.url, progress, callback, function () {
                popup.close();
            });
        }).set);
        progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        popup.open(function () {
            textArea.focus();
        });
    }

    /* [RBP] Reply Box Popup */

    function loadRbp() {
        if (esgst.replyBox) {
            let button, popup;
            let key, position;
            if (esgst.leftButtonIds.indexOf(`rbp`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            button = insertHtml(esgst.hideButtons && esgst.hideButtons_rbp ? esgst[key] : esgst.mainPageHeading, position, `
                <div class="esgst-heading-button" id="esgst-rbp" title="Add a comment">
                    <i class="fa fa-comment"></i>
                </div>
            `);
            popup = new Popup(`fa-comment`, `Add a comment:`);
            popup.TextArea = insertHtml(popup.scrollable, `beforeEnd`, `<textarea></textarea>`);
            if (esgst.cfh) {
                addCfhPanel(popup.TextArea);
            }
            popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, function (Callback) {
                popup.Progress.innerHTML = ``;
                saveComment(esgst.sg ? `` : document.querySelector(`[name="trade_code"]`).value, ``, popup.TextArea.value, esgst.sg ? location.href.match(/(.+?)(#.+?)?$/)[1] : `/ajax.php`, popup.Progress,
                    Callback);
            }).set);
            popup.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
            button.addEventListener(`click`, function () {
                popup.open(function () {
                    popup.TextArea.focus();
                });
            });
        }
    }

    /* [MR] Multi-Reply */
    /* [RFI] Reply From Inbox */

    function getMrRfiButtons(context) {
        var matches = context.getElementsByClassName(esgst.sg ? `comment__actions` : `action_list`);
        for (var i = 0, n = matches.length; i < n; ++i) {
            addMRButton(matches[i]);
        }
    }

    function addMRButton(Context) {
        var MR, Parent, ReplyButton, Permalink;
        MR = {
            Context: Context,
            Comment: Context.closest(esgst.sg ? `.comment` : `.comment_outer`)
        };
        if (MR.Comment) {
            Parent = MR.Comment.closest(esgst.sg ? `.comment` : `.comment_outer`);
            MR.Container = MR.Comment.getElementsByClassName(esgst.sg ? `comment__summary` : `comment_inner`)[0];
            MR.Timestamp = MR.Context.firstElementChild;
            ReplyButton = MR.Context.getElementsByClassName(esgst.sg ? `js__comment-reply` : `js_comment_reply`)[0];
            Permalink = MR.Context.querySelectorAll(`[href*="/go/comment/"]`);
            Permalink = Permalink[Permalink.length - 1];
            if (ReplyButton || location.pathname.match(/^\/messages/)) {
                if (ReplyButton) {
                    ReplyButton.remove();
                    MR.ParentID = Parent.getAttribute(esgst.sg ? `data-comment-id` : `data-id`);
                    if (location.pathname.match(/^\/messages/)) {
                        MR.URL = Permalink.getAttribute(`href`);
                    }
                    MR.url = Permalink.getAttribute(`href`);
                } else {
                    MR.url = MR.URL = Permalink.getAttribute(`href`);
                    MR.Comment.insertAdjacentHTML(`beforeEnd`, `<div class="comment__children comment_children"></div>`);
                }
                if (esgst.sg) {
                    MR.TradeCode = ``;
                } else {
                    if (!location.pathname.match(/^\/messages/)) {
                        MR.TradeCode = location.pathname.match(/^\/trade\/(.+?)\//)[1];
                    }
                    MR.Username = MR.Comment.getElementsByClassName(`author_name`)[0].textContent;
                }
                MR.Timestamp.insertAdjacentHTML(`afterEnd`, `<a class="comment__actions__button esgst-mr-reply">Reply</a>`);
                MR.Timestamp.nextElementSibling.addEventListener(`click`, function () {
                    if (!MR.Box) {
                        addMRBox(MR);
                    } else {
                        MR.Description.focus();
                    }
                });
            }
            MR.Children = MR.Comment.getElementsByClassName(esgst.sg ? `comment__children` : `comment_children`)[0];
            setMREdit(MR);
            setMrDelete(MR);
            setMrUndelete(MR);
        }
    }

    function addMRBox(MR) {
        var Username;
        Username = esgst.username;
        MR.Children.insertAdjacentHTML(`afterBegin`, `
            <div class="comment reply_form MRBox">
            ${esgst.sg ? `
                <div class="comment__child">
                    <a href="/user/${Username}" class="global__image-outer-wrap global__image-outer-wrap--avatar-small">
                        <div class="global__image-inner-wrap" style="background-image: url(${esgst.avatar});"></div>
                    </a>
                    <div class="comment__summary">
                        <div class="comment__author">
                            <div class="comment__username">
                                <a href="/user/${Username}">${Username}</a>
                            </div>
                        </div>
                        <div class="comment__display-state">
                            <div class="comment__description">
            ` : ``}
                                <input name="trade_code" type="hidden" value="${MR.TradeCode}">
                                <input name="parent_id" type="hidden" value="${MR.ParentID}">
                                <textarea class="esgst-mr-description" name="description"${esgst.sg ? `` : ` placeholder="Write a reply to ${MR.Username}..."`}></textarea>
                                <div class="align-button-container btn_actions">
                                    <div></div>
                                    <div class="comment__cancel-button btn_cancel esgst-mr-cancel">
                                        <span>Cancel</span>
                                    </div>
                                </div>
            ${esgst.sg ? `
                            </div>
                        </div>
                    </div>
                </div>
            ` : ``}
            </div>
        `);
        MR.Box = MR.Children.firstElementChild;
        MR.Description = MR.Box.getElementsByClassName(`esgst-mr-description`)[0];
        MR.Cancel = MR.Box.getElementsByClassName(`esgst-mr-cancel`)[0];
        if (esgst.cfh) {
            addCfhPanel(MR.Description);
        }
        MR.Description.focus();
        addDEDButton(MR.Box, MR.URL, function (id, Response, DEDStatus) {
            var encryptedCode, codes, ReplyID, Reply, ResponseJSON;
            if (esgst.sg) {
                if (id) {
                    Reply = parseHtml(Response.responseText).getElementById(id).closest(`.comment`);
                    codes = [];
                    var elements = Reply.querySelectorAll(`[href^="ESGST-"]`);
                    for (var i = 0, n = elements.length; i < n; ++i) {
                        var element = elements[i];
                        encryptedCode = element.getAttribute(`href`).match(/ESGST-(.+)/)[1];
                        if (!encryptedCode.match(/currentVersion/)) {
                            codes.push(decryptGedCode(encryptedCode));
                        }
                    }
                    saveGedGiveaways(codes, id, function () {
                        if (esgst.rfi && esgst.rfi_s) {
                            saveRfiReply(id, Reply.outerHTML, MR.url);
                        }
                        addRMLLink(MR.Container, [Reply]);
                        loadEndlessFeatures(Reply).then(() => {
                            MR.Box.remove();
                            MR.Box = null;
                            MR.Children.appendChild(Reply);
                            location.hash = id;
                        });
                    });
                } else {
                    DEDStatus.innerHTML = `
                        <i class="fa fa-times"></i>
                        <span>Failed!</span>
                    `;
                }
            } else {
                if (id) {
                    Reply = parseHtml(JSON.parse(Response.responseText).html).getElementById(id);
                    codes = [];
                    var elements = Reply.querySelectorAll(`[href^="ESGST-"]`);
                    for (var i = 0, n = elements.length; i < n; ++i) {
                        var element = elements[i];
                        encryptedCode = element.getAttribute(`href`).match(/ESGST-(.+)/)[1];
                        if (!encryptedCode.match(/currentVersion/)) {
                            codes.push(decryptGedCode(encryptedCode));
                        }
                    }
                    saveGedGiveaways(codes, id, function () {
                        if (esgst.rfi && esgst.rfi_s) {
                            saveRfiReply(id, Reply.outerHTML, MR.url);
                        }
                        addRMLLink(MR.Container, [Reply]);
                        loadEndlessFeatures(Reply).then(() => {
                            MR.Box.remove();
                            MR.Box = null;
                            MR.Children.appendChild(Reply);
                            location.hash = id;
                        });
                    });
                } else {
                    DEDStatus.innerHTML = `
                        <i class="fa fa-times"></i>
                        <span>Failed!</span>
                    `;
                }
            }
        });
        MR.Cancel.addEventListener(`click`, function () {
            MR.Box.remove();
            MR.Box = null;
        });
    }

    function saveRfiReply(id, reply, url, edit) {
        var i, n, source, saved;
        if (url) {
            source = url.match(/\/comment\/(.+)/)[1];
        }
        getValue(`${esgst.name}RfiCache`, `{}`).then(value => {
            saved = JSON.parse(value);
            if (edit) {
                for (key in saved) {
                    for (i = 0, n = saved[key].length; i < n && saved[key][i].id !== id; ++i);
                    if (i < n) {
                        saved[key][i].reply = reply;
                        saved[key][i].timestamp = Date.now();
                    }
                }
            } else {
                if (!saved[source]) {
                    saved[source] = [];
                }
                saved[source].push({
                    id: id,
                    reply: reply,
                    timestamp: Date.now()
                });
            }
            setValue(`${esgst.name}RfiCache`, JSON.stringify(saved));
        });
    }

    function getRfiReplies(comments, main) {
        var children, comment, i, id, ids, j, key, n, numReplies, saved;
        ids = [];
        getValue(`${esgst.name}RfiCache`, `{}`).then(value => {
            saved = JSON.parse(value);
            for (i = 0, n = comments.length; i < n; ++i) {
                comment = comments[i];
                id = comment.id;
                if (id && saved[id]) {
                    children = comment.comment.closest(`.comment, .comment_outer`).querySelector(`.comment__children, .comment_children`);
                    for (j = 0, numReplies = saved[id].length; j < numReplies; ++j) {
                        insertHtml(children, `beforeEnd`, saved[id][j].reply).querySelector(`[data-timestamp]`).textContent = getTimeSince(saved[id][j].timestamp);
                    }
                    if (main) {
                        loadEndlessFeatures(children);
                    }
                }
            }
            for (key in saved) {
                for (i = 0, n = saved[key].length; i < n; ++i) {
                    if (Date.now() - saved[key][i].timestamp > 604800000) {
                        saved[key].splice(i, 1);
                        i -= 1;
                        n -= 1;
                    }
                }
                if (!saved[key].length) {
                    delete saved[key];
                }
            }
            setValue(`${esgst.name}RfiCache`, JSON.stringify(saved));
        });
    }

    function getTimeSince(timestamp) {
        let n, s;
        s = Math.floor((Date.now() - timestamp) / 1000);
        n = Math.floor(s / 31104000);
        if (n >= 1) {
            return `${n} year${n === 1 ? `` : `s`}`;
        }
        n = Math.floor(s / 2592000);
        if (n >= 1) {
            return `${n} month${n === 1 ? `` : `s`}`;
        }
        n = Math.floor(s / 86400);
        if (n >= 1) {
            return `${n} day${n === 1 ? `` : `s`}`;
        }
        n = Math.floor(s / 3600);
        if (n >= 1) {
            return `${n} hour${n === 1 ? `` : `s`}`;
        }
        n = Math.floor(s / 60);
        if (n >= 1) {
            return `${n} minute${n === 1 ? `` : `s`}`;
        }
        n = Math.floor(s);
        return `${n} second${n === 1 ? `` : `s`}`;
    }

    function setMREdit(MR) {
        var DisplayState, EditState, EditSave, ID, AllowReplies, Description;
        MR.Edit = MR.Context.getElementsByClassName(esgst.sg ? `js__comment-edit` : `js_comment_edit`)[0];
        if (MR.Edit) {
            MR.Edit.insertAdjacentHTML(`afterEnd`, `<a class="comment__actions__button esgst-mr-edit">Edit</a>`);
            MR.Edit = MR.Edit.nextElementSibling;
            MR.Edit.previousElementSibling.remove();
            DisplayState = MR.Comment.getElementsByClassName(esgst.sg ? `comment__display-state` : `comment_body_default`)[0];
            EditState = MR.Comment.getElementsByClassName(esgst.sg ? `comment__edit-state` : `edit_form`)[0];
            EditSave = EditState.querySelector(`.js__comment-edit-save, .js_submit, .EditSave`);
            EditSave.insertAdjacentHTML(`afterEnd`, `
                <a class="comment__submit-button btn_action white EditSave">
                    <i class="fa fa-edit"></i>
                    <span>Edit</span>
                </a>
            `);
            EditSave = EditSave.nextElementSibling;
            EditSave.previousElementSibling.remove();
            ID = EditState.querySelector(`[name="comment_id"]`).value;
            AllowReplies = esgst.sg ? EditState.querySelector(`[name="allow_replies"]`).value : ``;
            Description = EditState.querySelector(`[name="description"]`);
            MR.Edit.addEventListener(`click`, function () {
                var Temp;
                if (esgst.sg) {
                    DisplayState.classList.add(`is-hidden`);
                    MR.Context.classList.add(`is-hidden`);
                } else {
                    MR.Container.classList.add(`is_hidden`);
                }
                EditState.classList.remove(esgst.sg ? `is-hidden` : `is_hidden`);
                Temp = Description.value;
                Description.focus();
                Description.value = ``;
                Description.value = Temp;
            });
            EditSave.addEventListener(`click`, function () {
                request(`xsrf_token=${esgst.xsrfToken}&do=comment_edit&comment_id=${ID}&allow_replies=${AllowReplies}&description=${encodeURIComponent(Description.value)}`, null, `POST`, false,
                    `/ajax.php`, function (Response) {
                        var codes, encryptedCode, ResponseJSON, ResponseHTML;
                        ResponseJSON = JSON.parse(Response.responseText);
                        if (ResponseJSON.type === `success` || ResponseJSON.success) {
                            ResponseHTML = parseHtml(ResponseJSON[esgst.sg ? `comment` : `html`]);
                            codes = [];
                            var elements = ResponseHTML.querySelectorAll(`[href^="ESGST-"]`);
                            for (var i = 0, n = elements.length; i < n; ++i) {
                                var element = elements[i];
                                encryptedCode = element.getAttribute(`href`).match(/ESGST-(.+)/)[1];
                                if (!encryptedCode.match(/currentVersion/)) {
                                    codes.push(decryptGedCode(encryptedCode));
                                }
                            }
                            saveGedGiveaways(codes, MR.url.match(/\/comment\/(.+)/)[1], function () {
                                if (esgst.rfi && esgst.rfi_s) {
                                    var reply = MR.Comment.cloneNode(true);
                                    if (esgst.sg) {
                                        reply.innerHTML = `
                                            <div class="ajax comment__child">${ResponseHTML.body.innerHTML}</div>
                                            <div class="comment__children"></div>
                                        `;
                                    } else {
                                        reply.innerHTML = `
                                            ${ResponseHTML.body.innerHTML}
                                            <div class="comment_children"></div>
                                        `;
                                    }
                                    saveRfiReply(MR.url.match(/\/comment\/(.+)/)[1], reply.outerHTML, null, true);
                                }
                                DisplayState.innerHTML = ResponseHTML.getElementsByClassName(esgst.sg ? `comment__display-state` : `comment_body_default`)[0].innerHTML;
                                EditState.classList.add(esgst.sg ? `is-hidden` : `is_hidden`);
                                MR.Timestamp.innerHTML = ResponseHTML.getElementsByClassName(esgst.sg ? `comment__actions` : `action_list`)[0].firstElementChild.innerHTML;
                                if (esgst.at) {
                                    getTimestamps(MR.Timestamp);
                                }
                                if (esgst.ged) {
                                    esgst.checkGedGiveaways(MR.Container);
                                }
                                if (esgst.sg) {
                                    DisplayState.classList.remove(`is-hidden`);
                                    MR.Context.classList.remove(`is-hidden`);
                                } else {
                                    MR.Container.classList.remove(`is_hidden`);
                                }
                            });
                        }
                    });
            });
        }
    }

    function setMrDelete(mr) {
        var allowReplies, data, id;
        mr.delete = mr.Context.getElementsByClassName(esgst.sg ? `js__comment-delete` : `js_comment_delete`)[0];
        if (mr.delete) {
            if (esgst.sg) {
                allowReplies = mr.delete.parentElement.querySelector(`[name="allow_replies"]`).value;
                id = mr.delete.parentElement.querySelector(`[name="comment_id"]`).value;
                data = `xsrf_token=${esgst.xsrfToken}&do=comment_delete&allow_replies=${allowReplies}&comment_id=${id}`;
            } else {
                data = mr.delete.getAttribute(`data-form`);
            }
            mr.delete.insertAdjacentHTML(`afterEnd`, `<a class="comment__actions__button esgst-mr-delete">Delete</a>`);
            mr.delete = mr.delete.nextElementSibling;
            mr.delete.previousElementSibling.remove();
            mr.delete.addEventListener(`click`, request.bind(null, data, null, `POST`, false, `/ajax.php`, editMrReply.bind(null, mr), false));
        }
    }

    function setMrUndelete(mr) {
        var allowReplies, data, id;
        mr.undelete = mr.Context.getElementsByClassName(esgst.sg ? `js__comment-undelete` : `js_comment_undelete`)[0];
        if (mr.undelete) {
            if (esgst.sg) {
                allowReplies = mr.undelete.parentElement.querySelector(`[name="allow_replies"]`).value;
                id = mr.undelete.parentElement.querySelector(`[name="comment_id"]`).value;
                data = `xsrf_token=${esgst.xsrfToken}&do=comment_undelete&allow_replies=${allowReplies}&comment_id=${id}`;
            } else {
                data = mr.undelete.getAttribute(`data-form`);
            }
            mr.undelete.insertAdjacentHTML(`afterEnd`, `<a class="comment__actions__button esgst-mr-undelete">Undelete</a>`);
            mr.undelete = mr.undelete.nextElementSibling;
            mr.undelete.previousElementSibling.remove();
            mr.undelete.addEventListener(`click`, request.bind(null, data, null, `POST`, false, `/ajax.php`, editMrReply.bind(null, mr), false));
        }
    }

    function editMrReply(mr, response) {
        var responseHtml, responseJson;
        responseJson = JSON.parse(response.responseText);
        if (responseJson.type === `success` || responseJson.success) {
            responseHtml = parseHtml(responseJson[esgst.sg ? `comment` : `html`]);
            if (esgst.sg) {
                mr.Container.innerHTML = responseHtml.getElementsByClassName(`comment__summary`)[0].innerHTML;
            } else {
                mr.Container.innerHTML = responseHtml.getElementsByClassName(`comment_inner`)[0].innerHTML;
            }
            if (esgst.rfi && esgst.rfi_s) {
                var reply = mr.Comment.cloneNode(true);
                if (esgst.sg) {
                    reply.innerHTML = `
                        <div class="ajax comment__child">${responseHtml.body.innerHTML}</div>
                        <div class="comment__children"></div>
                    `;
                } else {
                    reply.innerHTML = `
                        ${responseHtml.body.innerHTML}
                        <div class="comment_children"></div>
                    `;
                }
                saveRfiReply(mr.url.match(/\/comment\/(.+)/)[1], reply.outerHTML, null, true);
            }
            loadEndlessFeatures(mr.Container);
        }
    }

    /* [CT] Comment Tracker */

    function loadCt() {
        if ((esgst.giveawaysPath || esgst.commentsPath || esgst.inboxPath || esgst.discussionsPath) && !document.getElementsByClassName(`table--summary`)[0]) {
            if (esgst.commentsPath || esgst.inboxPath) {
            } else {
                esgst.endlessFeatures.push(addCtDiscussionPanels);
                addCtDiscussionPanels(document);
            }
        }
        if (((esgst.commentsPath && (!esgst.giveawayPath || !document.getElementsByClassName(`table--summary`)[0])) || esgst.inboxPath) && !esgst.ct_s) {
            if (!esgst.ct_s) {
                let button1, button2, button3;
                let key, position;
                if (esgst.leftButtonIds.indexOf(`ctUnread`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                button3 = insertHtml(esgst.hideButtons && esgst.hideButtons_ctUnread ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button" id="esgst-ctUnread" title="Mark all comments in this page as unread">
                        <i class="fa fa-eye-slash"></i>
                    </div>
                `);
                if (esgst.leftButtonIds.indexOf(`ctRead`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                button2 = insertHtml(esgst.hideButtons && esgst.hideButtons_ctRead ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button" id="esgst-ctRead" title="Mark all comments in this page as read">
                        <i class="fa fa-eye"></i>
                    </div>
                `);
                if (esgst.leftButtonIds.indexOf(`ctGo`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                button1 = insertHtml(esgst.hideButtons && esgst.hideButtons_ctGo ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button" id="esgst-ctGo" title="Go to the first unread comment of this page">
                        <i class="fa fa-comments-o"></i>
                    </div>
                `);
                addCtCommentPanel(button1, button2, button3);
            }
            let match = location.pathname.match(/\/(giveaway|discussion|ticket|trade)\/(.+?)\//);
            if (match) {
                let code, count, diff, comments, element, type;
                element = esgst.mainPageHeading.querySelector(`.page__heading__breadcrumbs, .page_heading_breadcrumbs`).firstElementChild;
                type = `${match[1]}s`;
                code = match[2];
                getValue(type).then(value => {
                    comments = JSON.parse(value);
                    count = parseInt(element.textContent.replace(/,/g, ``).match(/\d+/)[0]);
                    if (comments[code]) {
                        let id, read;
                        if (esgst.ct_s) {
                            read = comments[code].count || (esgst.ct_s_h ? count : 0);
                        } else {
                            read = 0;
                            for (id in comments[code].readComments) {
                                if (!id.match(/^(Count|undefined|)$/) && comments[code].readComments[id]) {
                                    ++read;
                                }
                            }
                        }
                        diff = count === read ? 0 : count - read;
                    } else if (esgst.ct_s && esgst.ct_s_h) {
                        diff = 0;
                    } else {
                        diff = count;
                    }
                    if (diff > 0) {
                        element.insertAdjacentHTML(`beforeEnd`, ` <span class="esgst-ct-count" title="Unread comments">(+${diff})</span>`);
                    }
                });
            }
        }
    }

    function getCtComments(count, comments, index, goToUnread, markRead, markUnread, callback) {
        if (goToUnread) {
            checkCtComments(count, comments, index, true, false, false, callback);
        } else {
            createLock(`commentLock`, 300, function(deleteLock) {
                checkCtComments(count, comments, index, false, markRead, markUnread, callback);
                deleteLock();
            });
        }
    }

    function checkCtComments(count, comments, index, goToUnread, markRead, markUnread, callback) {
        var button, code, comment, found, i, n, saved, source, type, unread;
        getValues({
            giveaways: `{}`,
            discussions: `{}`,
            tickets: `{}`,
            trades: `{}`
        }).then(values => {
            if (esgst.sg) {
                saved = {
                    giveaways: JSON.parse(values.giveaways),
                    discussions: JSON.parse(values.discussions),
                    tickets: JSON.parse(values.tickets)
                };
            } else {
                saved = {
                    trades: JSON.parse(values.trades)
                };
            }
            n = comments.length;
            if (n > 0) {
                found = false;
                for (i = index || 0; i < n; ++i) {
                    comment = comments[i];
                    if (comment.id || comment.id.match(/^$/)) {
                        if (!saved[comment.type][comment.code]) {
                            saved[comment.type][comment.code] = {
                                readComments: {}
                            };
                        } else if (!saved[comment.type][comment.code].readComments) {
                            saved[comment.type][comment.code].readComments = {};
                        }
                        if (count > 0) {
                            saved[comment.type][comment.code].count = count;
                        }
                        if (esgst.gdttt && esgst[`gdttt_v${{
                            giveaways: `g`,
                            discussions: `d`,
                            tickets: `t`,
                            trades: `ts`
                        }[comment.type]}`]) {
                            saved[comment.type][comment.code].visited = true;
                        }
                        saved[comment.type][comment.code].lastUsed = Date.now();
                        if (!esgst.ct_s) {
                            buttons = comment.comment.getElementsByClassName(`esgst-ct-comment-button`);
                            if (comment.author === esgst.username) {
                                markCtCommentRead(comment, saved);
                            } else if (!saved[comment.type][comment.code].readComments[comment.id] || comment.timestamp !== saved[comment.type][comment.code].readComments[comment.id]) {
                                if (goToUnread && (!esgst.ctGoToUnread || ((((esgst.ct_r && !esgst.cr) || (!esgst.ct_r && esgst.cr)) && comment.comment.offsetTop < scrollY + esgst.commentsTop) || (((!esgst.ct_r && !esgst.cr) || (esgst.ct_r && esgst.cr)) && comment.comment.offsetTop > scrollY + esgst.commentsTop)))) {
                                    esgst.ctGoToUnread = true;
                                    if ((esgst.discussionPath && ((!esgst.ct_r && !esgst.cr) || (esgst.ct_r && esgst.cr))) || (!esgst.discussionPath && !esgst.ct_r)) {
                                        unread = comment;
                                        found = true;
                                    } else {
                                        if (esgst.discussionsPath) {
                                            esgst.ctUnreadFound = true;
                                            if (esgst.sto) {
                                                if (comment.id) {
                                                    location.href = `/go/comment/${comment.id}`;
                                                } else {
                                                    location.href = `/discussion/${comment.code}/`;
                                                }
                                            } else {
                                                if (comment.id) {
                                                    open(`/go/comment/${comment.id}`);
                                                } else {
                                                    open(`/discussion/${comment.code}/`);
                                                }
                                            }
                                        } else {
                                            goToComment(comment.id, comment.comment);
                                        }
                                        found = true;
                                        break;
                                    }
                                } else {
                                    if (markRead) {
                                        markCtCommentRead(comment, saved);
                                        addCtUnreadCommentButton(buttons[0], comment);
                                    } else {
                                        markCtCommentUnread(comment, saved);
                                        addCtReadCommentButton(buttons[0], comment);
                                    }
                                    addCtReadUntilHereButton(buttons[1], comment);
                                    addCtUnreadUntilHereButton(buttons[2], comment);
                                }
                            } else {
                                if (markUnread) {
                                    markCtCommentUnread(comment, saved);
                                    addCtReadCommentButton(buttons[0], comment);
                                } else {
                                    markCtCommentRead(comment, saved);
                                    addCtUnreadCommentButton(buttons[0], comment);
                                }
                                addCtReadUntilHereButton(buttons[1], comment);
                                addCtUnreadUntilHereButton(buttons[2], comment);
                            }
                        }
                    }
                }
                if (!esgst.ct_s && goToUnread) {
                    if (unread) {
                        if (esgst.discussionsPath) {
                            esgst.ctUnreadFound = true;
                            if (esgst.sto) {
                                if (unread.id) {
                                    location.href = `/go/comment/${unread.id}`;
                                } else {
                                    location.href = `/discussion/${unread.code}/`;
                                }
                            } else {
                                if (unread.id) {
                                    open(`/go/comment/${unread.id}`);
                                } else {
                                    open(`/discussion/${unread.code}/`);
                                }
                            }
                        } else {
                            goToComment(unread.id, unread.comment);
                        }
                    }
                } else {
                    if (esgst.sg) {
                        setValues({
                            giveaways: JSON.stringify(saved.giveaways),
                            discussions: JSON.stringify(saved.discussions),
                            tickets: JSON.stringify(saved.tickets)
                        }).then(() => {
                            if (callback) {
                                callback(found);
                            }
                        });
                    } else {
                        setValue(`trades`, JSON.stringify(saved.trades)).then(() => {
                            if (callback) {
                                callback(found);
                            }
                        });
                    }
                }
            } else {
                source = location.pathname.match(/(giveaway|discussion|trade|ticket)\/(.+?)(\/.*)?$/);
                if (source) {
                    type = `${source[1]}s`;
                    code = source[2];
                    if (!saved[type][code]) {
                        saved[type][code] = {
                            readComments: {},
                            visited: true
                        };
                    }
                    if (count > 0) {
                        saved[type][code].count = count;
                    }
                    saved[type][code].lastUsed = Date.now();
                    if (esgst.sg) {
                        setValues({
                            giveaways: JSON.stringify(saved.giveaways),
                            discussions: JSON.stringify(saved.discussions),
                            tickets: JSON.stringify(saved.tickets)
                        }).then(() => {
                            if (callback) {
                                callback();
                            }
                        });
                    } else {
                        setValue(`trades`, JSON.stringify(saved.trades)).then(() => {
                            if (callback) {
                                callback();
                            }
                        });
                    }
                } else if (callback) {
                    callback();
                }
            }
        });
    }

    function markCtCommentRead(comment, comments, save, callback) {
        var count;
        if (save) {
            createLock(`commentLock`, 300, function(deleteLock) {
                getValue(comment.type).then(value => {
                    comments = JSON.parse(value);
                    if (comment.id && !comments[comment.code].readComments[comment.id] && esgst.commentsPath) {
                        count = document.getElementsByClassName(`esgst-ct-count`)[0];
                        count.textContent = ` (+${parseInt(count.textContent.match(/\d+/)[0]) - 1})`;
                    }
                    comments[comment.code].readComments[comment.id] = comment.timestamp;
                    return setValue(comment.type, JSON.stringify(comments));
                }).then(() => {
                    deleteLock();
                    comment.comment.classList.add(`esgst-ct-comment-read`);
                    comment.comment.style.opacity = `0.5`;
                    setHoverOpacity(comment.comment, `1`, `0.5`);
                    callback();
                });
            });
        } else {
            if (comments) {
                if (comment.id && !comments[comment.type][comment.code].readComments[comment.id] && esgst.commentsPath) {
                    count = document.getElementsByClassName(`esgst-ct-count`)[0];
                    count.textContent = ` (+${parseInt(count.textContent.match(/\d+/)[0]) - 1})`;
                }
                comments[comment.type][comment.code].readComments[comment.id] = comment.timestamp;
            }
            comment.comment.classList.add(`esgst-ct-comment-read`);
            comment.comment.style.opacity = `0.5`;
            setHoverOpacity(comment.comment, `1`, `0.5`);
        }
    }

    function markCtCommentUnread(comment, comments, save, callback) {
        var count;
        if (save) {
            createLock(`commentLock`, 300, function(deleteLock) {
                var comments;
                getValue(comment.type).then(value => {
                    comments = JSON.parse(value);
                    if (comments[comment.code].readComments[comment.id]) {
                        delete comments[comment.code].readComments[comment.id];
                        if (comment.id && esgst.commentsPath) {
                            count = document.getElementsByClassName(`esgst-ct-count`)[0];
                            count.textContent = ` (+${parseInt(count.textContent.match(/\d+/)[0]) + 1})`;
                        }
                    }
                    return setValue(comment.type, JSON.stringify(comments));
                }).then(() => {
                    deleteLock();
                    comment.comment.classList.remove(`esgst-ct-comment-read`);
                    comment.comment.style.opacity = `1`;
                    setHoverOpacity(comment.comment, `1`, `1`);
                    callback();
                });
            });
        } else {
            if (comments && comments[comment.type][comment.code].readComments[comment.id]) {
                if (comment.id && esgst.commentsPath) {
                    count = document.getElementsByClassName(`esgst-ct-count`)[0];
                    count.textContent = ` (+${parseInt(count.textContent.match(/\d+/)[0]) + 1})`;
                }
                delete comments[comment.type][comment.code].readComments[comment.id];
            }
            comment.comment.classList.remove(`esgst-ct-comment-read`);
            comment.comment.style.opacity = `1`;
            setHoverOpacity(comment.comment, `1`, `1`);
        }
    }

    function addCtReadUntilHereButton(button, comment) {
        if (!button) {
            button = insertHtml(comment.actions, `beforeEnd`, `<div class="esgst-ct-comment-button" title="Mark all comments from this comment upwards as read"></div>`);
        }
        button.innerHTML = `
            <span>
                <i class="fa fa-eye"></i>
                <i class="fa fa-angle-up"></i>
            </span>
        `;
        button.firstElementChild.addEventListener(`click`, function () {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            getCtComments(0, esgst.currentComments, comment.index, false, true, false, function () {
                addCtReadUntilHereButton(button, comment);
            });
        });
    }

    function addCtUnreadUntilHereButton(button, comment) {
        if (!button) {
            button = insertHtml(comment.actions, `beforeEnd`, `<div class="esgst-ct-comment-button" title="Mark all comments from this comment upwards as unread"></div>`);
        }
        button.innerHTML = `
            <span>
                <i class="fa fa-eye-slash"></i>
                <i class="fa fa-angle-up"></i>
            </span>
        `;
        button.firstElementChild.addEventListener(`click`, function () {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            getCtComments(0, esgst.currentComments, comment.index, false, false, true, function () {
                addCtReadUntilHereButton(button, comment);
            });
        });
    }

    function addCtReadCommentButton(button, comment) {
        if (!button) {
            button = insertHtml(comment.actions, `beforeEnd`, `<div class="esgst-ct-comment-button"></div>`);
        }
        button.innerHTML = `
            <i class="fa fa-eye" title="Mark this comment as read"></i>
            <span title="Mark this comment as read and go to the next unread comment">
                <i class="fa fa-eye"></i>
                <i class="fa fa-angle-double-right"></i>
            </span>
        `;
        button.firstElementChild.addEventListener(`click`, function () {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            markCtCommentRead(comment, null, true, function () {
                button.innerHTML = ``;
                addCtUnreadCommentButton(button, comment);
            });
        });
        button.lastElementChild.addEventListener(`click`, function () {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            markCtCommentRead(comment, null, true, function () {
                button.innerHTML = ``;
                addCtUnreadCommentButton(button, comment);
                getCtComments(0, esgst.currentComments, null, true);
            });
        });
    }

    function addCtUnreadCommentButton(button, comment) {
        if (!button) {
            button = insertHtml(comment.actions, `beforeEnd`, `<div class="esgst-ct-comment-button"></div>`);
        }
        button.innerHTML = `<i class="fa fa-eye-slash" title="Mark comment as unread">`;
        button.firstElementChild.addEventListener(`click`, function() {
            button.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            markCtCommentUnread(comment, null, true, function() {
                button.innerHTML = ``;
                addCtReadCommentButton(button, comment);
            });
        });
    }

    function addCtCommentPanel(goToUnread, markRead, markUnread) {
        var button, key, newButton, url;
        goToUnread.addEventListener(`click`, goToCtUnread.bind(null, goToUnread));
        markRead.addEventListener(`click`, markCtCommentsRead.bind(null, markRead, null));
        markUnread.addEventListener(`click`, markCtCommentsUnread.bind(null, markUnread));
        if (esgst.ct_a && esgst.inboxPath) {
            button = document.querySelector(`.js__submit-form, .js_mark_as_read`);
            if (button) {
                if (esgst.sg) {
                    newButton = insertHtml(button, `afterEnd`, `
                        <div class="sidebar__action-button">
                            <i class="fa fa-check-circle"></i> Mark as Read
                        </div>
                    `);
                    key = `read_messages`;
                    url = `/messages`;
                } else {
                    newButton = insertHtml(button, `afterEnd`, `
                        <a class="page_heading_btn green">
                            <i class="fa fa-check-square-o"></i>
                            <span>Mark as Read</span>
                        </a>
                    `);
                    key = `mark_as_read`;
                    url = `/ajax.php`;
                }
                button.remove();
                newButton.addEventListener(`click`, request.bind(null, `xsrf_token=${esgst.xsrfToken}&do=${key}`, null, `POST`, false, url, markCtCommentsRead.bind(null, markRead, completeCtInboxRead.bind(null, newButton)), false));
            }
        }
    }

    function completeCtInboxRead(newButton) {
        var elements, i, n;
        elements = document.querySelectorAll(`.comment__envelope, .comment_unread`);
        for (i = 0, n = elements.length; i < n; ++i) {
            elements[i].remove();
        }
        newButton.remove();
    }

    function goToCtUnread(goToUnread) {
        goToUnread.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
        `;
        getCtComments(0, esgst.currentComments, null, true, false, false, function (found) {
            goToUnread.innerHTML = `
                <i class="fa fa-comments-o"></i>
            `;
            if (!found) {
                createAlert(`No unread comments were found.`);
            }
        });
    }

    function markCtCommentsRead(markRead, callback) {
        markRead.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
        `;
        getCtComments(0, esgst.currentComments, null, false, true, false, function () {
            markRead.innerHTML = `
                <i class="fa fa-eye"></i>
            `;
            if (callback) {
                callback();
            }
        });
    }

    function markCtCommentsUnread(markUnread) {
        markUnread.innerHTML = `
            <i class="fa fa-circle-o-notch fa-spin"></i>
        `;
        getCtComments(0, esgst.currentComments, null, false, false, true, function () {
            markUnread.innerHTML = `
                <i class="fa fa-eye-slash"></i>
            `;
        });
    }

    function addCtDiscussionPanels(context, main, source, endless, dh) {
        var code, comments, count, countLink, diff, heading, i, id, j, match, matches, n, read, url, key;
        if (esgst.discussionsPath || dh) {
            key = `discussions`;
        } else if (esgst.ticketsPath) {
            key = `tickets`;
        } else if (esgst.tradesPath) {
            key = `trades`;
        } else {
            key = `discussions`;
        }
        getValue(key, `{}`).then(value => {
            comments = JSON.parse(value);
            matches = context.querySelectorAll(`.table__row-outer-wrap, .row_outer_wrap`);
            for (i = 0, n = matches.length; i < n; ++i) {
                match = matches[i];
                countLink = match.querySelector(`.table__column__secondary-link[href*="/discussion/"], .table__column--width-small.text-center, .column_small.text_center`);
                if (countLink) {
                    count = parseInt(countLink.textContent.replace(/,/g, ``));
                    heading = match.querySelector(`.homepage_table_column_heading, .table__column__heading, .column_flex h3 a`);
                    url = heading.getAttribute(`href`);
                    if (url) {
                        code = url.match(new RegExp(`/${key.slice(0, -1)}/(.+?)(/.*)?$`));
                        if (code) {
                            code = code[1];
                            if (esgst.ust && key === `tickets` && (!comments[code] || !comments[code].sent) && match.getElementsByClassName(`table__column__secondary-link`)[0].textContent.trim().match(/Request\sNew\sWinner|User\sReport/)) {
                                addUstCheckbox(code, heading.parentElement);
                            }
                            if (esgst.gdttt || esgst.ct) {
                                if (comments[code]) {
                                    if (esgst.ct_s) {
                                        read = comments[code].count || (esgst.ct_s_h ? count : 0);
                                    } else {
                                        read = 0;
                                        for (id in comments[code].readComments) {
                                            if (!id.match(/^(Count|undefined|)$/) && comments[code].readComments[id]) {
                                                ++read;
                                            }
                                        }
                                    }
                                    diff = count === read ? 0 : count - read;
                                } else if (esgst.ct_s && esgst.ct_s_h) {
                                    diff = 0;
                                } else {
                                    diff = count;
                                }
                                if (key === `discussions` && diff > 0) {
                                    for (j = esgst.currentDiscussions.length - 1; j > -1 && esgst.currentDiscussions[j].code !== code; --j);
                                    if (j > -1) {
                                        esgst.currentDiscussions[j].unread = true;
                                    }
                                }
                                addCtDiscussionPanel(code, comments, match, countLink, count, diff, url, key, dh);
                            }
                        }
                    }
                }
            }
            if (esgst.df && esgst.df.filteredCount && esgst[`df_enable${esgst.df.type}`]) {
                filterDfDiscussions(esgst.df, false, endless);
            }
            if (esgst.ustButton) {
                if (esgst.numUstTickets > 0) {
                    esgst.ustButton.classList.remove(`esgst-hidden`);
                } else {
                    esgst.ustButton.classList.add(`esgst-hidden`);
                }
            }
        });
    }

    function addCtDiscussionPanel(code, comments, container, context, count, diff, url, type, dh) {
        var diffContainer, goToUnread, loadingIcon, markRead, markUnread, markVisited, markUnvisited, panel;
        panel = insertHtml(context, esgst.giveawaysPath && !esgst.oadd ? `afterEnd` : `beforeEnd`, `
            <span>
                <span class="esgst-ct-count esgst-hidden">(+${diff})</span>
                <div class="esgst-heading-button esgst-hidden" title="Go to first unread comment of this discussion">
                    <i class="fa fa-comments-o"></i>
                </div>
                <div class="esgst-heading-button esgst-hidden" title="Mark all comments in this discussion as read">
                    <i class="fa fa-eye"></i>
                </div>
                <div class="esgst-heading-button esgst-hidden" title="Mark all comments in this discussion as unread">
                    <i class="fa fa-eye-slash"></i>
                </div>
                <div class="esgst-heading-button esgst-hidden" title="Mark this discussion as visited">
                    <i class="fa fa-check"></i>
                </div>
                <div class="esgst-heading-button esgst-hidden" title="Mark this discussion as unvisited">
                    <i class="fa fa-times"></i>
                </div>
                <i class="fa fa-circle-o-notch fa-spin esgst-hidden"></i>
            </span>
        `);
        diffContainer = panel.firstElementChild;
        goToUnread = diffContainer.nextElementSibling;
        markRead = goToUnread.nextElementSibling;
        markUnread = markRead.nextElementSibling;
        markVisited = markUnread.nextElementSibling;
        markUnvisited = markVisited.nextElementSibling;
        loadingIcon = markUnvisited.nextElementSibling;
        if (esgst.ct && (esgst.giveawaysPath || esgst.discussionsPath || dh)) {
            if (esgst.ct_s) {
                if (diff > 0) {
                    diffContainer.classList.remove(`esgst-hidden`);
                }
            } else {
                if (diff > 0) {
                    diffContainer.classList.remove(`esgst-hidden`);
                    goToUnread.classList.remove(`esgst-hidden`);
                    markRead.classList.remove(`esgst-hidden`);
                    if (diff !== count) {
                        markUnread.classList.remove(`esgst-hidden`);
                    }
                } else {
                    markUnread.classList.remove(`esgst-hidden`);
                }
            }
        }
        if (esgst.gdttt) {
            if (!comments[code] || !comments[code].visited) {
                markVisited.classList.remove(`esgst-hidden`);
            } else {
                markUnvisited.classList.remove(`esgst-hidden`);
            }
        }
        goToUnread.addEventListener(`click`, function() {
            goToUnread.classList.add(`esgst-hidden`);
            markRead.classList.add(`esgst-hidden`);
            markUnread.classList.add(`esgst-hidden`);
            loadingIcon.classList.remove(`esgst-hidden`);
            esgst.ctUnreadFound = false;
            markCtCommentsReadUnread(true, true, false, false, false, 1, `${url}/search?page=`, function() {
                loadingIcon.classList.add(`esgst-hidden`);
                diffContainer.classList.add(`esgst-hidden`);
                goToUnread.classList.remove(`esgst-hidden`);
                markRead.classList.remove(`esgst-hidden`);
                markUnread.classList.remove(`esgst-hidden`);
            });
        });
        markRead.addEventListener(`click`, function() {
            goToUnread.classList.add(`esgst-hidden`);
            markRead.classList.add(`esgst-hidden`);
            markUnread.classList.add(`esgst-hidden`);
            loadingIcon.classList.remove(`esgst-hidden`);
            markCtCommentsReadUnread(true, false, false, true, false, 1, `${url}/search?page=`, function() {
                loadingIcon.classList.add(`esgst-hidden`);
                diffContainer.classList.add(`esgst-hidden`);
                markUnread.classList.remove(`esgst-hidden`);
            });
        });
        markUnread.addEventListener(`click`, function() {
            goToUnread.classList.add(`esgst-hidden`);
            markRead.classList.add(`esgst-hidden`);
            markUnread.classList.add(`esgst-hidden`);
            loadingIcon.classList.remove(`esgst-hidden`);
            createLock(`commentLock`, 300, function(deleteLock) {
                var key;
                getValue(`discussions`).then(value => {
                    comments = JSON.parse(value);
                    for (key in comments[code].readComments) {
                        delete comments[code].readComments[key];
                    }
                    comments[code].lastUsed = Date.now();
                    return setValue(`discussions`, JSON.stringify(comments));
                }).then(() => {
                    deleteLock();
                    loadingIcon.classList.add(`esgst-hidden`);
                    diffContainer.classList.remove(`esgst-hidden`);
                    diffContainer.textContent = `(+${count})`;
                    goToUnread.classList.remove(`esgst-hidden`);
                    markRead.classList.remove(`esgst-hidden`);
                });
            });
        });
        markVisited.addEventListener(`click`, function() {
            goToUnread.classList.add(`esgst-hidden`);
            markRead.classList.add(`esgst-hidden`);
            markUnread.classList.add(`esgst-hidden`);
            markVisited.classList.add(`esgst-hidden`);
            loadingIcon.classList.remove(`esgst-hidden`);
            createLock(`commentLock`, 300, function(deleteLock) {
                getValue(type).then(value => {
                    comments = JSON.parse(value);
                    if (!comments[code]) {
                        comments[code] = {
                            readComments: {}
                        };
                    }
                    if (esgst.ct_s) {
                        comments[code].count = count;
                        diffContainer.textContent = ``;
                    }
                    comments[code].visited = true;
                    comments[code].lastUsed = Date.now();
                    return setValue(type, JSON.stringify(comments));
                }).then(() => {
                    deleteLock();
                    loadingIcon.classList.add(`esgst-hidden`);
                    if (esgst.ct && !esgst.ct_s && (esgst.giveawaysPath || esgst.discussionsPath || dh)) {
                        goToUnread.classList.remove(`esgst-hidden`);
                        markRead.classList.remove(`esgst-hidden`);
                        markUnread.classList.remove(`esgst-hidden`);
                    }
                    markUnvisited.classList.remove(`esgst-hidden`);
                    container.classList.add(`esgst-ct-visited`);
                    container.style.opacity = `0.5`;
                    setHoverOpacity(container, `1`, `0.5`);
                });
            });
        });
        markUnvisited.addEventListener(`click`, function() {
            goToUnread.classList.add(`esgst-hidden`);
            markRead.classList.add(`esgst-hidden`);
            markUnread.classList.add(`esgst-hidden`);
            markUnvisited.classList.add(`esgst-hidden`);
            loadingIcon.classList.remove(`esgst-hidden`);
            createLock(`commentLock`, 300, function(deleteLock) {
                getValue(type).then(value => {
                    comments = JSON.parse(value);
                    if (esgst.ct_s) {
                        delete comments[code].count;
                        diffContainer.textContent = `(+${count})`;
                    }
                    delete comments[code].visited;
                    comments[code].lastUsed = Date.now();
                    return setValue(type, JSON.stringify(comments));
                }).then(() => {
                    deleteLock();
                    loadingIcon.classList.add(`esgst-hidden`);
                    if (esgst.ct && !esgst.ct_s && (esgst.giveawaysPath || esgst.discussionsPath || dh)) {
                        goToUnread.classList.remove(`esgst-hidden`);
                        markRead.classList.remove(`esgst-hidden`);
                        markUnread.classList.remove(`esgst-hidden`);
                    }
                    markVisited.classList.remove(`esgst-hidden`);
                    container.classList.remove(`esgst-ct-visited`);
                    container.style.opacity = `1`;
                    setHoverOpacity(container, `1`, `1`);
                });
            });
        });
    }

    function markCtCommentsReadUnread(firstRun, goToUnread, lastPageMissing, markRead, markUnread, nextPage, url, callback) {
        request(null, null, `GET`, true, `${url}${nextPage}`, function(response) {
            var context, lastLink, pagination;
            context = parseHtml(response.responseText);
            getComments(context, context).then(comments => {
                getCtComments(0, comments, null, goToUnread, markRead, markUnread);
                if ((goToUnread && !esgst.ctUnreadFound) || !goToUnread) {
                    pagination = context.getElementsByClassName(`pagination__navigation`)[0];
                    ++nextPage;
                    if (pagination && ((goToUnread && ((esgst.ct_r && nextPage > 1) || (!esgst.ct_r && !pagination.lastElementChild.classList.contains(`is-selected`)))) || (!goToUnread && !pagination.lastElementChild.classList.contains(`is-selected`)))) {
                        if (goToUnread && esgst.ct_r) {
                            if (firstRun) {
                                lastLink = pagination.lastElementChild;
                                if (lastLink.textContent.match(/Last/)) {
                                    nextPage = parseInt(lastLink.getAttribute(`data-page-number`));
                                } else {
                                    nextPage = 999999999;
                                    lastPageMissing = true;
                                }
                            } else {
                                if (lastPageMissing) {
                                    nextPage = parseInt(pagination.lastElementChild.getAttribute(`data-page-number`)) - 1;
                                } else {
                                    nextPage -= 2;
                                }
                            }
                            if (nextPage > 1) {
                                setTimeout(markCtCommentsReadUnread, 0, false, goToUnread, lastPageMissing, markRead, markUnread, nextPage, url, callback);
                            } else {
                                callback();
                            }
                        } else {
                            setTimeout(markCtCommentsReadUnread, 0, false, goToUnread, lastPageMissing, markRead, markUnread, nextPage, url, callback);
                        }
                    } else {
                        callback();
                    }
                } else {
                    callback();
                }
            });
        });
    }

    /* [CH] Comment History */

    function saveChComment(id, timestamp) {
        createLock(`${esgst.name}CommentHistoryLock`, 300, function (deleteLock) {
            var comments, key;
            key = `${esgst.name}CommentHistory`;
            getValue(key, `[]`).then(value => {
                comments = JSON.parse(value);
                comments.unshift({
                    id: id,
                    timestamp: timestamp
                });
                return setValue(key, JSON.stringify(comments));
            }).then(deleteLock);
        });
    }

    function getChComments(comments, i, n, popup, callback) {
        var comment, id;
        if (i < n) {
            comment = comments[i];
            if (comment) {
                id = comment.id;
                request(null, null, `GET`, false, `https://${location.hostname}/go/comment/${id}`, function (response) {
                    var html, parent, responseHtml;
                    responseHtml = parseHtml(response.responseText);
                    comment = responseHtml.getElementById(id);
                    if (esgst.sg) {
                        comment = comment.closest(`.comment`);
                        comment.firstElementChild.classList.remove(`comment__parent`);
                        comment.firstElementChild.classList.add(`comment__child`);
                    }
                    comment.lastElementChild.remove();
                    parent = comment.parentElement.closest(`.comment, .comment_outer`);
                    if (parent) {
                        parent.lastElementChild.remove();
                        parent.insertAdjacentHTML(`beforeEnd`, `
                            <div class="comment__children comment_children">${comment.outerHTML}</div>
                        `);
                        html = parent.outerHTML;
                    } else {
                        if (esgst.st) {
                            comment.getElementsByClassName(`action_list`)[0].firstElementChild.insertAdjacentHTML(`afterEnd`, `
                                <a href="${response.finalUrl}">${responseHtml.title}</a>
                            `);
                        }
                        html = esgst.sg ? `
                            <div class="comments__entity">
                                <p class="comments__entity__name">
                                    <a href="${response.finalUrl}">${responseHtml.title}</a>
                                </p>
                            </div>` : ``;
                        html += `<div class="comment__children comment_children">${comment.outerHTML}</div>`;
                    }
                    popup.commentHistory.insertAdjacentHTML(`beforeEnd`, `<div class="comment comments comment_outer">${html}</div>`);
                    loadEndlessFeatures(popup.commentHistory.lastElementChild).then(() => {
                        setTimeout(getChComments, 0, comments, ++i, n, popup, callback);
                    });
                });
            } else {
                callback(i + 1);
            }
        } else {
            callback(i);
        }
    }

    /* [UH] Username History */

    function addUhContainer(profile) {
        var button, box, container, list;
        container = insertHtml(profile.heading, `beforeEnd`, `
            <div class="esgst-uh-container">
                <a class="esgst-uh-button" title="View username history">
                    <i class="fa fa-caret-down"></i>
                </a>
                <div class="esgst-uh-box esgst-hidden">
                    <div class="esgst-uh-title">
                        <span>Username History</span>
                        <a href="https://goo.gl/C2wjUh" target="_blank" title="Expand the database">
                            <i class="fa fa-expand"></i>
                        </a>
                    </div>
                    <ul class="esgst-uh-list"></ul>
                </div>
            </div>
        `);
        button = container.firstElementChild;
        box = button.nextElementSibling;
        list = box.lastElementChild;
        button.addEventListener(`click`, toggleUhBox.bind(null, box, profile, list));
        document.addEventListener(`click`, closeUhBox.bind(null, box, container));
    }

    function toggleUhBox(box, profile, list) {
        var progress, url;
        box.classList.toggle(`esgst-hidden`);
        if (!list.innerHTML) {
            progress = insertHtml(list, `beforeEnd`, `
                <div>
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Loading username history...</span>
                </div>
            `);
            url = `https://script.google.com/macros/s/AKfycbzvOuHG913mRIXOsqHIeAuQUkLYyxTHOZim5n8iP-k80iza6g0/exec?Action=1&SteamID64=${profile.steamId}&Username=${profile.username}`;
            request(null, null, `GET`, false, url, loadUhList.bind(null, list, progress));
        }
    }

    function loadUhList(list, progress, response) {
        var responseJson, usernames;
        responseJson = JSON.parse(response.responseText);
        usernames = responseJson.Usernames.join(`</li><li>`);
        progress.remove();
        list.innerHTML = `<li>${usernames}</li>`;
    }

    function closeUhBox(box, container, event) {
        if (!box.classList.contains(`esgst-hidden`) && !container.contains(event.target)) {
            box.classList.add(`esgst-hidden`);
        }
    }

    /* [UN] User Notes */

    function addUnButton(profile, savedUser) {
        var blacklistButton, position, whitelistButton;
        if (esgst.sg) {
            position = `beforeEnd`;
            if (esgst.un_p) {
                whitelistButton = profile.steamButtonContainer.getElementsByClassName(`sidebar__shortcut__whitelist`)[0];
                if (whitelistButton) {
                    whitelistButton.addEventListener(`click`, openUnPopup.bind(null, profile));
                }
                blacklistButton = profile.steamButtonContainer.getElementsByClassName(`sidebar__shortcut__blacklist`)[0];
                if (blacklistButton) {
                    blacklistButton.addEventListener(`click`, openUnPopup.bind(null, profile));
                }
            }
        } else {
            position = `afterBegin`;
        }
        profile.unButton = insertHtml(profile.heading, position, `
            <a class="esgst-un-button" title="Edit user notes">
                <i class="fa"></i>
            </a>
        `);
        profile.unIcon = profile.unButton.firstElementChild;
        if (savedUser && savedUser.notes) {
            profile.unIcon.classList.add(`fa-sticky-note`);
        } else {
            profile.unIcon.classList.add(`fa-sticky-note-o`);
        }
        profile.unButton.addEventListener(`click`, openUnPopup.bind(null, profile));
    }

    function openUnPopup(profile) {
        var set;
        profile.unPopup = new Popup(`fa-sticky-note`, `Edit user notes for <span>${profile.name}</span>:`, true);
        profile.unTextArea = insertHtml(profile.unPopup.scrollable, `beforeEnd`, `
            <textarea></textarea>
        `);
        set = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveUnNotes.bind(null, profile));
        profile.unTextArea.addEventListener(`keydown`, event => {
            if (event.ctrlKey && event.key === `Enter`) {
                set.trigger();
            }
        });
        profile.unPopup.description.appendChild(set.set);
        profile.unPopup.open(getUnNotes.bind(null, profile));
    }

    function saveUnNotes(profile, resetButton) {
        var notes, user;
        notes = profile.unTextArea.value.trim();
        user = {
            steamId: profile.steamId,
            id: profile.id,
            username: profile.username,
            values: {
                notes: notes
            }
        };
        if (notes) {
            profile.unIcon.classList.remove(`fa-sticky-note-o`);
            profile.unIcon.classList.add(`fa-sticky-note`);
        } else {
            profile.unIcon.classList.remove(`fa-sticky-note`);
            profile.unIcon.classList.add(`fa-sticky-note-o`);
        }
        saveUser(null, null, user, closeUnPopup.bind(null, profile, resetButton));
    }

    function closeUnPopup(profile, resetButton) {
        resetButton();
        profile.unPopup.close();
    }

    function getUnNotes(profile) {
        var notes, savedUser, savedUsers;
        profile.unTextArea.focus();
        getValue(`users`).then(value => {
            savedUsers = JSON.parse(value);
            savedUser = savedUsers.users[profile.steamId];
            if (savedUser) {
                notes = savedUser.notes;
                if (notes) {
                    profile.unTextArea.value = notes;
                }
            }
        });
    }

    /* [UF] User Filters */

    function addUfButton(profile, savedUser) {
        var uf;
        if (profile.username !== esgst.username) {
            profile.ufButton = insertHtml(profile.heading, `beforeEnd`, `
                <a class="esgst-uf-button" title="Edit user filters">
                    <i class="fa"></i>
                </a>
            `);
            profile.ufIcon = profile.ufButton.firstElementChild;
            if (savedUser) {
                profile.ufValues = savedUser.uf;
                if (profile.ufValues && (profile.ufValues.giveaways || profile.ufValues.discussions || profile.ufValues.posts)) {
                    profile.ufIcon.classList.add(`fa-eye-slash`);
                } else {
                    profile.ufIcon.classList.add(`fa-eye`);
                    profile.ufValues = {
                        giveaways: false,
                        discussions: false,
                        posts: false
                    };
                }
            } else {
                profile.ufIcon.classList.add(`fa-eye`);
                profile.ufValues = {
                    giveaways: false,
                    discussions: false,
                    posts: false
                };
            }
            profile.ufButton.addEventListener(`click`, openUfPopup.bind(null, profile));
        }
    }

    function openUfPopup(profile) {
        var resetSet, saveSet;
        profile.ufPopup = new Popup(`fa-eye`, `Apply user filters for <span>${profile.name}</span>:`, true);
        profile.ufOptions = insertHtml(profile.ufPopup.description, `beforeEnd`, `<div></div>`);
        profile.ufGiveawaysOption = new ToggleSwitch(profile.ufOptions, null, false, `Filter this user's giveaways.`, false, false, `Hides the user's giveaways from the main pages.`, profile.ufValues.giveaways);
        profile.ufDiscussionsOption = new ToggleSwitch(profile.ufOptions, null, false, `Filter this user's discussions.`, false, false, `Hides the user's discussions from the main pages.`, profile.ufValues.discussions);
        profile.ufPostsOption = new ToggleSwitch(profile.ufOptions, null, false, `Filter this user's posts.`, false, false, `Hides the user's posts everywhere.`, profile.ufValues.posts);
        saveSet = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save Settings`, `Saving...`, saveUfSettings.bind(null, profile, false));
        resetSet = new ButtonSet(`green`, `grey`, `fa-rotate-left`, `fa-circle-o-notch fa-spin`, `Reset Settings`, `Resetting...`, saveUfSettings.bind(null, profile, true));
        saveSet.dependencies.push(resetSet.set);
        resetSet.dependencies.push(saveSet.set);
        profile.ufPopup.description.appendChild(saveSet.set);
        profile.ufPopup.description.appendChild(resetSet.set);
        profile.ufPopup.open();
    }

    function saveUfSettings(profile, reset, resetButton) {
        var uf, user;
        if (reset) {
            uf = null;
            profile.ufGiveawaysOption.input.checked = false;
            profile.ufDiscussionsOption.input.checked = false;
            profile.ufPostsOption.input.checked = false;
            profile.ufValues = {
                giveaways: false,
                discussions: false,
                posts: false
            };
        } else {
            profile.ufValues = {
                giveaways: profile.ufGiveawaysOption.input.checked,
                discussions: profile.ufDiscussionsOption.input.checked,
                posts: profile.ufPostsOption.input.checked
            };
        }
        user = {
            steamId: profile.steamId,
            id: profile.id,
            username: profile.username,
            values: {
                uf: profile.ufValues
            }
        };
        if (profile.ufValues && (profile.ufValues.giveaways || profile.ufValues.discussions || profile.ufValues.posts)) {
            profile.ufIcon.classList.remove(`fa-eye`);
            profile.ufIcon.classList.add(`fa-eye-slash`);
        } else {
            profile.ufIcon.classList.remove(`fa-eye-slash`);
            profile.ufIcon.classList.add(`fa-eye`);
        }
        saveUser(null, null, user, closeUfPopup.bind(null, profile, resetButton));
    }

    function closeUfPopup(profile, resetButton) {
        resetButton();
        profile.ufPopup.close();
    }

    function updateUfCount(context, extraCount) {
        var count;
        count = context.getElementsByClassName(`esgst-uf-count`)[0];
        context = context.firstElementChild;
        if (!extraCount) {
            extraCount = 0;
        }
        if (count) {
            count.innerHTML = `
                (<span class="esgst-bold">${parseInt(count.firstElementChild.textContent) + 1 + extraCount}</span> filtered by User Filters)
            `;
        } else {
            context.insertAdjacentHTML(`beforeEnd`, `
                <span class="esgst-uf-count">
                    (<span class="esgst-bold">${1 + extraCount}</span> filtered by User Filters)
                </span>
            `);
        }
    }

    /* [SGC] Shared Groups Checker */

    function addSgcButton(profile) {
        if (profile.username !== esgst.username) {
            profile.sgcButton = insertHtml(profile.heading, `beforeEnd`, `
                <a class="esgst-sgc-button" title="Check shared groups">
                    <i class="fa fa-users"></i>
                </a>
            `);
            profile.sgcButton.addEventListener(`click`, openSgcPopup.bind(null, profile));
        }
    }

    function openSgcPopup(profile) {
        if (profile.sgcPopup) {
            profile.sgcPopup.open();
        } else {
            profile.sgcPopup = new Popup(`fa-users`, `Shared Groups`);
            profile.sgcProgress = insertHtml(profile.sgcPopup.description, `beforeEnd`, `
                <div>
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Checking shared groups...</span>
                </div>
            `);
            profile.sgcResults = insertHtml(profile.sgcPopup.scrollable, `beforeEnd`, `
                <div class="esgst-sgc-results esgst-glwc-results esgst-text-left">
                    <div>
                        <div class="esgst-glwc-heading">Public</div>
                        <div class="table esgst-hidden">
                            <div class="table__heading">
                                <div class="table__column--width-fill">Group</div>
                            </div>
                            <div class="table__rows"></div>
                        </div>
                    </div>
                    <div>
                        <div class="esgst-glwc-heading">Private</div>
                        <div class="table esgst-hidden">
                            <div class="table__heading">
                                <div class="table__column--width-fill">Group</div>
                            </div>
                            <div class="table__rows"></div>
                        </div>
                    </div>
                </div>
            `);
            profile.sgcPublic = profile.sgcResults.firstElementChild.lastElementChild;
            profile.sgcPublicResults = profile.sgcPublic.lastElementChild;
            profile.sgcPrivate = profile.sgcResults.lastElementChild.lastElementChild;
            profile.sgcPrivateResults = profile.sgcPrivate.lastElementChild;
            profile.sgcPopup.open();
            request(null, null, `GET`, false, `http://steamcommunity.com/profiles/${profile.steamId}/groups`, loadSgcGroups.bind(null, profile));
        }
    }

    function loadSgcGroups(profile, response) {
        var avatar, element, elements, i, n, n1, n2, name, privateGroups, publicGroups, responseHtml, savedGroup, savedGroups;
        publicGroups = [];
        privateGroups = [];
        getValue(`groups`, `[]`).then(value => {
            savedGroups = JSON.parse(value);
            responseHtml = parseHtml(response.responseText);
            elements = responseHtml.getElementsByClassName(`groupBlock`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                name = element.getElementsByClassName(`linkTitle`)[0].textContent;
                avatar = element.getElementsByClassName(`playerAvatar`)[0].firstElementChild.firstElementChild.getAttribute(`src`);
                for (j = savedGroups.length - 1; j >= 0 && savedGroups[j].name !== name; --j);
                if (j >= 0 && savedGroups[j].member) {
                    (element.getElementsByClassName(`pubGroup`)[0] ? publicGroups : privateGroups).push({
                        name: name,
                        html: `
                            <div class="table__row-outer-wrap">
                                <div class="table__row-inner-wrap">
                                    <div>
                                        <a class="table_image_avatar" href="/group/${savedGroups[j].code}/" style="background-image:url(${avatar})"></a>
                                    </div>
                                    <div class="table__column--width-fill">
                                        <a class="table__column__heading" href="/group/${savedGroups[j].code}/"></a>
                                    </div>
                                </div>
                            </div>
                        `
                    });
                }
            }
            n1 = publicGroups.length;
            n2 = privateGroups.length;
            if (n1 > 0 || n2 > 0) {
                if (n1 > 0) {
                    publicGroups = sortArrayByKey(publicGroups, `name`);
                    profile.sgcPublic.classList.remove(`esgst-hidden`);
                    for (i = 0; i < n1; ++i) {
                        insertHtml(profile.sgcPublicResults, `beforeEnd`, publicGroups[i].html).getElementsByClassName(`table__column__heading`)[0].textContent = publicGroups[i].name;
                    }
                } else {
                    profile.sgcPublic.outerHTML = `
                        <div>No shared public groups found.</div>
                    `;
                }
                if (n2 > 0) {
                    privateGroups = sortArrayByKey(privateGroups, `name`);
                    profile.sgcPrivate.classList.remove(`esgst-hidden`);
                    for (i = 0; i < n2; ++i) {
                        insertHtml(profile.sgcPrivateResults, `beforeEnd`, privateGroups[i].html).getElementsByClassName(`table__column__heading`)[0].textContent = privateGroups[i].name;
                    }
                } else {
                    profile.sgcPrivate.outerHTML = `
                        <div>No shared private groups found.</div>
                    `;
                }
                profile.sgcProgress.remove();
                profile.sgcProgress = null;
            } else {
                profile.sgcProgress.innerHTML = `No shared groups found.`;
            }
            loadEndlessFeatures(profile.sgcResults);
        });
    }

    /* [RWSCVL] Real Won/Sent CV Link */

    function addRwscvlLinks(profile, savedUser) {
        var sentUrl, wonUrl;
        wonUrl = `http://www.sgtools.info/won/${profile.username}`;
        sentUrl = `http://www.sgtools.info/sent/${profile.username}`;
        if (esgst.rwscvl_r) {
            wonUrl += `/newestfirst`;
            sentUrl += `/newestfirst`;
        }
        profile.wonRowLeft.innerHTML = `
            <a class="esgst-rwscvl-link" href="${wonUrl}" target="_blank">Gifts Won</a>
        `;
        profile.sentRowLeft.innerHTML = `
            <a class="esgst-rwscvl-link" href="${sentUrl}" target="_blank">Gifts Sent</a>
        `;
    }

    /* [UGD] User Giveaways Data */

    function addUgdButtons(profile) {
        var user = {
            steamId: profile.steamId,
            id: profile.id,
            username: profile.username
        };
        addUgdButton(profile.wonRowLeft, `won`, user);
        addUgdButton(profile.sentRowLeft, `sent`, user);
    }

    function addUgdButton(Context, Key, user) {
        var UGD, UGDButton, popup;
        UGD = {
            Key: Key
        };
        Context.insertAdjacentHTML(`beforeEnd`, `
            <span class="esgst-ugd-button" title="Get ${UGD.Key} giveaways data">
                <i class="fa fa-bar-chart"></i>
            </span>
        `);
        UGDButton = Context.lastElementChild;
        popup = new Popup(`fa-bar-chart`, `Get ${user.username}'s ${UGD.Key} giveaways data:`);
        insertHtml(popup.description, `beforeEnd`, `<div></div>`).appendChild(createOptions([{
            check: UGD.Key === `won`,
            dependencies: [`ugd_getAchievements`],
            description: `Get playtime stats.`,
            id: `ugd_getPlaytime`,
            tooltip: `Get playtime stats for each won game by this user (requires a Steam API Key inserted into the settings menu - does not check DLCs/packages).`
        }, {
            check: UGD.Key === `won`,
            description: `Get achievements stats.`,
            id: `ugd_getAchievements`,
            tooltip: `Get achievements stats for each won game by this user (slower - does not check DLCs/packages).`
        }, {
            check: true,
            description: `Clear cache.`,
            id: `ugd_clearCache`,
            tooltip: `If enabled, the cache will be cleared and all giveaways will be retrieved again (slower).`
        }]));
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-bar-chart`, `fa-times-circle`, `Get Data`, `Cancel`, function (Callback) {
            UGD.Canceled = false;
            UGDButton.classList.add(`esgst-busy`);
            var ugd, giveaways;
            getUser(null, user).then(savedUser => {
                if (savedUser) {
                    giveaways = savedUser.giveaways;
                }
                if (!giveaways) {
                    giveaways = {
                        sent: {
                            apps: {},
                            subs: {}
                        },
                        won: {
                            apps: {},
                            subs: {}
                        },
                        sentTimestamp: 0,
                        wonTimestamp: 0
                    };
                    if (savedUser) {
                        ugd = savedUser.ugd;
                        if (ugd) {
                            var ggiveaways = {};
                            if (ugd.sent) {
                                for (var key in ugd.sent.apps) {
                                    giveaways.sent.apps[key] = [];
                                    for (var i = 0, n = ugd.sent.apps[key].length; i < n; ++i) {
                                        ggiveaways[ugd.sent.apps[key][i].code] = ugd.sent.apps[key][i];
                                        giveaways.sent.apps[key].push(ugd.sent.apps[key][i].code);
                                    }
                                }
                                for (var key in ugd.sent.subs) {
                                    giveaways.sent.subs[key] = [];
                                    for (var i = 0, n = ugd.sent.subs[key].length; i < n; ++i) {
                                        ggiveaways[ugd.sent.subs[key][i].code] = ugd.sent.subs[key][i];
                                        giveaways.sent.subs[key].push(ugd.sent.subs[key][i].code);
                                    }
                                }
                                giveaways.sentTimestamp = ugd.sentTimestamp;
                            }
                            if (ugd.won) {
                                for (var key in ugd.won.apps) {
                                    giveaways.won.apps[key] = [];
                                    for (var i = 0, n = ugd.won.apps[key].length; i < n; ++i) {
                                        ggiveaways[ugd.won.apps[key][i].code] = ugd.won.apps[key][i];
                                        giveaways.won.apps[key].push(ugd.won.apps[key][i].code);
                                    }
                                }
                                for (var key in ugd.won.subs) {
                                    giveaways.won.subs[key] = [];
                                    for (var i = 0, n = ugd.won.subs[key].length; i < n; ++i) {
                                        ggiveaways[ugd.won.subs[key][i].code] = ugd.won.subs[key][i];
                                        giveaways.won.subs[key].push(ugd.won.subs[key][i].code);
                                    }
                                }
                                giveaways.wonTimestamp = ugd.wonTimestamp;
                            }
                            if (Object.keys(ggiveaways).length > 0) {
                                lockAndSaveGiveaways(ggiveaways);
                            }
                        }
                    }
                }
                if (esgst.ugd_clearCache) {
                    giveaways[UGD.Key] = null;
                }
                if (!giveaways.sent) {
                    giveaways.sent = {
                        apps: {},
                        subs: {}
                    };
                    giveaways.sentTimestamp = 0;
                }
                if (!giveaways.won) {
                    giveaways.won = {
                        apps: {},
                        subs: {}
                    };
                    giveaways.wonTimestamp = 0;
                }
                if (UGD.Key === `sent` && user.username === esgst.username && !giveaways.version) {
                    giveaways.sent = {
                        apps: {},
                        subs: {}
                    };
                    giveaways.sentTimestamp = 0;
                    giveaways.version = `7.11.1`;
                }
                var Match = location.pathname.match(new RegExp(`^\/user\/${user.username}${UGD.Key === `won` ? `/giveaways/won` : ``}`));
                var CurrentPage = location.href.match(/page=(\d+)/);
                CurrentPage = Match ? (CurrentPage ? parseInt(CurrentPage[1]) : 1) : 0;
                UGD.giveaways = {};
                getUGDGiveaways(UGD, giveaways, 1, `/user/${user.username}${UGD.Key === `won` ? `/giveaways/won` : ``}/search?page=`, user.username, function (giveaways) {
                    user.values = {
                        giveaways: giveaways,
                        ugd: null
                    };
                    saveUser(null, null, user, function () {
                        var Giveaways, Types, TypesTotal, Frequencies, Total, LevelsTotal;
                        UGDButton.classList.remove(`esgst-busy`);
                        Giveaways = giveaways[UGD.Key];
                            Types = {
                                Everyone: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                Invite: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                Group: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                Whitelist: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                Group_Whitelist: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                Region: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                Region_Invite: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                Region_Group: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                Region_Whitelist: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                                Region_Group_Whitelist: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                            };
                            TypesTotal = {
                                Everyone: 0,
                                Invite: 0,
                                Group: 0,
                                Whitelist: 0,
                                Group_Whitelist: 0,
                                Region: 0,
                                Region_Invite: 0,
                                Region_Group: 0,
                                Region_Whitelist: 0,
                                Region_Group_Whitelist: 0
                            };
                            LevelsTotal = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                            Total = 0;
                            Frequencies = {};
                        UGD.Progress.textContent = `Calculating stats...`;
                        countUgdGiveaways(Frequencies, Giveaways.apps, LevelsTotal, Total, UGD.Key === `won` ? `creators` : `apps`, Types, TypesTotal, UGD, function(LevelsTotal, Total) {
                            countUgdGiveaways(Frequencies, Giveaways.subs, LevelsTotal, Total, UGD.Key === `won` ? `creators` : `subs`, Types, TypesTotal, UGD, function(LevelsTotal, Total) {
                                var Type, I, N, Value, Ordered;
                                UGD.HTML = `
                                    <div class="esgst-ugd-table table">
                                        <div class="table__heading">
                                            <div class="table__column--width-small text-center">Type</div>
                                            <div class="table__column--width-small text-center">Level 0</div>
                                            <div class="table__column--width-small text-center">Level 1</div>
                                            <div class="table__column--width-small text-center">Level 2</div>
                                            <div class="table__column--width-small text-center">Level 3</div>
                                            <div class="table__column--width-small text-center">Level 4</div>
                                            <div class="table__column--width-small text-center">Level 5</div>
                                            <div class="table__column--width-small text-center">Level 6</div>
                                            <div class="table__column--width-small text-center">Level 7</div>
                                            <div class="table__column--width-small text-center">Level 8</div>
                                            <div class="table__column--width-small text-center">Level 9</div>
                                            <div class="table__column--width-small text-center">Level 10</div>
                                            <div class="table__column--width-small text-center">Total</div>
                                        </div>
                                        <div class="table__rows">
                                `;
                                for (Type in Types) {
                                    UGD.HTML += `
                                            <div class="table__row-outer-wrap">
                                                <div class="table__row-inner-wrap">
                                                        <div class="table__column--width-small text-center">${Type.replace(/_/g, ` + `)}</div>
                                    `;
                                    for (I = 0; I <= 10; ++I) {
                                        Value = Types[Type][I];
                                        UGD.HTML += `
                                                    <div class="table__column--width-small text-center${Value ? `` : ` is-faded`}">${Value}</div>
                                        `;
                                    }
                                    Value = Math.round(TypesTotal[Type] / Total * 10000) / 100;
                                    UGD.HTML += `
                                                    <div class="table__column--width-small text-center${Value ? `` : ` is-faded`}">${TypesTotal[Type]} (${Value}%)</div>
                                                </div>
                                            </div>
                                    `;
                                }
                                UGD.HTML += `
                                            <div class="table__row-outer-wrap">
                                                <div class="table__row-inner-wrap">
                                                    <div class="table__column--width-small text-center">Total</div>
                                `;
                                for (I = 0; I <= 10; ++I) {
                                    Value = Math.round(LevelsTotal[I] / Total * 10000) / 100;
                                    UGD.HTML += `
                                                    <div class="table__column--width-small text-center${Value ? `` : ` is-faded`}">${LevelsTotal[I]} (${Value}%)</div>
                                    `;
                                }
                                UGD.HTML += `
                                                    <div class="table__column--width-small text-center${Total ? `` : ` is-faded`}">${Total}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                Ordered = [];
                                for (Key in Frequencies.apps) {
                                    for (I = 0, N = Ordered.length; (I < N) && (Frequencies.apps[Key].frequency <= Ordered[I].frequency); ++I);
                                    Ordered.splice(I, 0, Frequencies.apps[Key]);
                                }
                                for (Key in Frequencies.subs) {
                                        for (I = 0, N = Ordered.length; (I < N) && (Frequencies.subs[Key].frequency <= Ordered[I].frequency); ++I);
                                    Ordered.splice(I, 0, Frequencies.subs[Key]);
                                }
                                for (Key in Frequencies.creators) {
                                    for (I = 0, N = Ordered.length; (I < N) && (Frequencies.creators[Key].frequency <= Ordered[I].frequency); ++I);
                                    Ordered.splice(I, 0, Frequencies.creators[Key]);
                                }
                                UGD.ordered = Ordered;
                                if (UGD.Key === `won` && esgst.ugd_getPlaytime && esgst.steamApiKey) {
                                    UGD.Progress.textContent = `Retrieving game stats...`;
                                    UGD.HTML += `
                                        <div class="esgst-ugd-table table">
                                            <div class="table__heading">
                                                <div class="table__column--width-fill">Game</div>
                                                <div class="table__column--width-small text-center">Playtime (Last 2 Weeks)</div>
                                                <div class="table__column--width-small text-center">Playtime (Forever)</div>
                                                ${esgst.ugd_getAchievements ? `<div class="table__column--width-small text-center">Achievements</div>` : ``}
                                                <div class="table__column--width-small text-center">Gifter</div>
                                            </div>
                                            <div class="table__rows">
                                    `;
                                    request(null, null, `GET`, false, `https://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=${esgst.steamApiKey}&steamid=${user.steamId}&format=json`, response => {
                                        let check, games = JSON.parse(response.responseText).response.games, id;
                                        check = new CompletionCheck(Object.keys(Giveaways.apps).length + Object.keys(Giveaways.subs).length, completeUgd.bind(null, popup, UGD, Callback), () => {
                                            UGD.Progress.textContent = `Retrieving game stats (${check.count} of ${check.total})...`;
                                        });
                                        UGD.total = check.total;
                                        UGD.playedCount = 0;
                                        UGD.achievementsCount = 0;
                                        UGD.achievementsTotal = 0;
                                        for (id in Giveaways.apps) {
                                            for (i = games.length - 1; i >= 0 && games[i].appid !== parseInt(id); --i);
                                            let giveaway = typeof Giveaways.apps[id][0] === `string` ? esgst.giveaways[Giveaways.apps[id][0]] : Giveaways.apps[id][0];
                                            if (i >= 0) {
                                                let game = games[i];
                                                let time2Weeks = game.playtime_2weeks;
                                                let timeForever = game.playtime_forever;
                                                if (timeForever > 0) {
                                                    UGD.playedCount += 1;
                                                }
                                                time2Weeks = time2Weeks && time2Weeks > 0 ? (time2Weeks > 60 ? `${Math.round(time2Weeks / 60 * 100) / 100}h` : `${time2Weeks}m`) : `0`;
                                                timeForever = timeForever > 0 ? (timeForever > 60 ? `${Math.round(timeForever / 60 * 100) / 100}h` : `${timeForever}m`) : `0`;
                                                if (esgst.ugd_getAchievements) {
                                                    request(null, null, `GET`, false, `http://api.steampowered.com/ISteamUserStats/GetPlayerAchievements/v0001/?appid=${game.appid}&key=${esgst.steamApiKey}&steamid=${user.steamId}`, response => {
                                                        let responseJson = JSON.parse(response.responseText).playerstats, achievements, count = 0, total = 0;
                                                        if (responseJson.success && responseJson.achievements) {
                                                            responseJson.achievements.forEach(achievement => {
                                                                if (achievement.achieved) {
                                                                    count += 1;
                                                                }
                                                                total += 1;
                                                            });
                                                            if (count > 0) {
                                                                UGD.achievementsCount += 1;
                                                            }
                                                            UGD.achievementsTotal += 1;
                                                            achievements = `${count}/${total} (${Math.round(count / total * 10000) / 100}%)`;
                                                        } else {
                                                            achievements = `0/0`;
                                                        }
                                                        UGD.HTML += `
                                                            <div class="table__row-outer-wrap">
                                                                <div class="table__row-inner-wrap">
                                                                    <div class="table__column--width-fill">${giveaway.gameName}</div>
                                                                    <div class="table__column--width-small text-center" data-sort-value="${game.playtime_2weeks || 0}">${time2Weeks}</div>
                                                                    <div class="table__column--width-small text-center" data-sort-value="${game.playtime_forever}">${timeForever}</div>
                                                                    <div class="table__column--width-small text-center" data-sort-value="${Math.round(count / total * 10000) / 100}">${achievements}</div>
                                                                    <div class="table__column--width-small text-center"><a class="table__column__secondary-link" href="/user/${giveaway.creator}">${giveaway.creator}</a></div>
                                                                </div>
                                                            </div>
                                                        `;
                                                        check.count += 1;
                                                    });
                                                } else {
                                                    UGD.HTML += `
                                                        <div class="table__row-outer-wrap">
                                                            <div class="table__row-inner-wrap">
                                                                <div class="table__column--width-fill">${giveaway.gameName}</div>
                                                                <div class="table__column--width-small text-center" data-sort-value="${game.playtime_2weeks || 0}">${time2Weeks}</div>
                                                                <div class="table__column--width-small text-center" data-sort-value="${game.playtime_forever}">${timeForever}</div>
                                                                <div class="table__column--width-small text-center"><a class="table__column__secondary-link" href="/user/${giveaway.creator}">${giveaway.creator}</a></div>
                                                            </div>
                                                        </div>
                                                    `;
                                                    check.count += 1;
                                                }
                                            } else {
                                                UGD.HTML += `
                                                    <div class="table__row-outer-wrap">
                                                        <div class="table__row-inner-wrap">
                                                            <div class="table__column--width-fill">${giveaway.gameName}</div>
                                                            <div class="table__column--width-small text-center">0</div>
                                                            <div class="table__column--width-small text-center">0</div>
                                                            ${esgst.ugd_getAchievements ? `<div class="table__column--width-small text-center">0/0</div>` : ``}
                                                            <div class="table__column--width-small text-center"><a class="table__column__secondary-link" href="/user/${giveaway.creator}">${giveaway.creator}</a></div>
                                                        </div>
                                                    </div>
                                                `;
                                                check.count += 1;
                                            }
                                        }
                                        for (id in Giveaways.subs) {
                                            let giveaway = typeof Giveaways.subs[id][0] === `string` ? esgst.giveaways[Giveaways.subs[id][0]] : Giveaways.subs[id][0];
                                            UGD.HTML += `
                                                <div class="table__row-outer-wrap">
                                                    <div class="table__row-inner-wrap">
                                                        <div class="table__column--width-fill">${giveaway.gameName}</div>
                                                        <div class="table__column--width-small text-center">0</div>
                                                        <div class="table__column--width-small text-center">0</div>
                                                        ${esgst.ugd_getAchievements ? `<div class="table__column--width-small text-center">0/0</div>` : ``}
                                                        <div class="table__column--width-small text-center"><a class="table__column__secondary-link" href="/user/${giveaway.creator}">${giveaway.creator}</a></div>
                                                    </div>
                                                </div>
                                            `;
                                            check.count += 1;
                                        }
                                    });
                                } else {
                                    completeUgd(popup, UGD, Callback);
                                }
                            });
                        });
                    });
                });
            });
        }, function () {
            clearInterval(UGD.Request);
            clearInterval(UGD.Save);
            UGD.Canceled = true;
            setTimeout(function () {
                UGD.Progress.innerHTML = UGD.OverallProgress = ``;
            }, 500);
            UGDButton.classList.remove(`esgst-busy`);
        }).set);
        UGD.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        UGD.OverallProgress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        popup.Results = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left"></div>`);
        UGD.popup = popup;
        UGDButton.addEventListener(`click`, function () {
            popup.open();
        });
    }

    function completeUgd(popup, UGD, callback) {
        let key;
        if (UGD.Key === `won` && esgst.ugd_getPlaytime && esgst.steamApiKey) {
            UGD.HTML += `
                    </div>
                </div>
                <div class="esgst-bold">${UGD.playedCount} out of ${UGD.total} games with more than 0 hours playtime (${Math.round(UGD.playedCount / UGD.total * 10000) / 100}%)</div>
                ${esgst.ugd_getAchievements ? `<div class="esgst-bold">${UGD.achievementsCount} out of ${UGD.achievementsTotal} games with more than 0 achievements (${Math.round(UGD.achievementsCount / UGD.achievementsTotal * 10000) / 100}%)</div>` : ``}
                <br/>
            `;
        }
        UGD.HTML += `
            <div class="esgst-text-center markdown">
                <div class="esgst-bold">${UGD.Key === `sent` ? `Most given away:` : `Most won from:`}</div>
                <ol>
        `;
        for (key in UGD.ordered) {
            UGD.HTML += `
                    <li>${UGD.ordered[key].name} - <span class="esgst-bold">${UGD.ordered[key].frequency}</span></li>
            `;
        }
        UGD.HTML += `
                </ol>
            </div>
        `;
        popup.Results.innerHTML = UGD.HTML;
        UGD.Progress.innerHTML = ``;
        loadEndlessFeatures(popup.Results).then(callback);
    }

    function countUgdGiveaways(Frequencies, Giveaways, LevelsTotal, Total, type, Types, TypesTotal, UGD, Callback) {
        var Key, I, N, Giveaway, Private, Group, Whitelist, Region, Level, Copies;
        getValue(`giveaways`).then(value => {
            var savedGiveaways = JSON.parse(value);
            for (Key in Giveaways) {
                for (I = 0, N = Giveaways[Key].length; I < N; ++I) {
                    Giveaway = typeof Giveaways[Key][I] === `string` ? savedGiveaways[Giveaways[Key][I]] : Giveaways[Key][I];
                    if (Giveaway && Giveaway.entries > 0) {
                        Private = Giveaway.inviteOnly;
                        Group = Giveaway.group;
                        Whitelist = Giveaway.whitelist;
                        Region = Giveaway.regionRestricted;
                        Level = Giveaway.level;
                        Copies = (UGD.Key === `sent`) ? Giveaway.copies : 1;
                        if (Private) {
                            if (Region) {
                                Types.Region_Invite[Level] += Copies;
                                TypesTotal.Region_Invite += Copies;
                            } else {
                                Types.Invite[Level] += Copies;
                                TypesTotal.Invite += Copies;
                            }
                        } else if (Group) {
                            if (Region) {
                                Types.Region_Group[Level] += Copies;
                                TypesTotal.Region_Group += Copies;
                            } else if (Whitelist) {
                                if (Region) {
                                    Types.Region_Group_Whitelist[Level] += Copies;
                                    TypesTotal.Region_Group_Whitelist += Copies;
                                } else {
                                    Types.Group_Whitelist[Level] += Copies;
                                    TypesTotal.Group_Whitelist += Copies;
                                }
                            } else {
                                Types.Group[Level] += Copies;
                                TypesTotal.Group += Copies;
                            }
                        } else if (Whitelist) {
                            if (Region) {
                                Types.Region_Whitelist[Level] += Copies;
                                TypesTotal.Region_Whitelist += Copies;
                            } else {
                                Types.Whitelist[Level] += Copies;
                                TypesTotal.Whitelist += Copies;
                            }
                        } else if (Region) {
                            Types.Region[Level] += Copies;
                            TypesTotal.Region += Copies;
                        } else {
                            Types.Everyone[Level] += Copies;
                            TypesTotal.Everyone += Copies;
                        }
                        LevelsTotal[Level] += Copies;
                        Total += Copies;
                        if (UGD.Key === `sent`) {
                            if (!Frequencies[type]) {
                                Frequencies[type] = {};
                            }
                            if (!Frequencies[type][Key]) {
                                Frequencies[type][Key] = {
                                    name: Giveaway.gameName,
                                    frequency: 0
                                };
                            }
                            Frequencies[type][Key].frequency += Copies;
                        } else {
                            if (!Frequencies[type]) {
                                Frequencies[type] = {};
                            }
                            if (!Frequencies[type][Giveaway.creator]) {
                                Frequencies[type][Giveaway.creator] = {
                                    name: Giveaway.creator,
                                    frequency: 0
                                };
                            }
                            ++Frequencies[type][Giveaway.creator].frequency;
                        }
                    }
                }
            }
            Callback(LevelsTotal, Total);
        });
    }

    function getUGDGiveaways(UGD, giveaways, NextPage, URL, username, Callback, Context) {
        var Giveaways, I, NumGiveaways, Giveaway, Found, Pagination;
        if (!UGD.Canceled) {
            if (Context) {
                if (UGD.Progress) {
                    if (NextPage === 2) {
                        UGD.lastPage = getLastPage(Context, false, false, true, UGD.Key === `won`);
                        UGD.lastPage = UGD.lastPage === 999999999 ? `` : ` of ${UGD.lastPage}`;
                    }
                    UGD.Progress.innerHTML = `
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        <span>Retrieving giveaways (page ${NextPage - 1}${UGD.lastPage})...</span>
                    `;
                }
                Giveaways = Context.getElementsByClassName(`giveaway__row-outer-wrap`);
                let toGiveaways = [];
                for (I = 0, NumGiveaways = Giveaways.length; I < NumGiveaways; ++I) {
                    Giveaway = getGiveawayInfo(Giveaways[I], document, null, null, username, UGD.Key).data;
                    if (Giveaway.endTime < new Date().getTime()) {
                        if (!UGD.Timestamp) {
                            UGD.Timestamp = Giveaway.endTime;
                        }
                        if (Giveaway.endTime > giveaways[`${UGD.Key}Timestamp`]) {
                            if (Giveaway.gameSteamId) {
                                if (!giveaways[UGD.Key][Giveaway.gameType][Giveaway.gameSteamId]) {
                                    giveaways[UGD.Key][Giveaway.gameType][Giveaway.gameSteamId] = [];
                                }
                                if (Giveaway.code) {
                                    giveaways[UGD.Key][Giveaway.gameType][Giveaway.gameSteamId].push(Giveaway.code);
                                    UGD.giveaways[Giveaway.code] = Giveaway;
                                } else {
                                    giveaways[UGD.Key][Giveaway.gameType][Giveaway.gameSteamId].push(Giveaway);
                                }
                                toGiveaways.push(Giveaway);
                            }
                        } else {
                            Found = true;
                            break;
                        }
                    }
                }
                if (UGD.Key === `sent` && username === esgst.username) {
                    getUgdGiveaway(toGiveaways, 0, toGiveaways.length, () => {
                        Pagination = Context.getElementsByClassName(`pagination__navigation`)[0];
                        if (!Found && Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                            setTimeout(getUGDGiveaways, 0, UGD, giveaways, NextPage, URL, username, Callback);
                        } else {
                            giveaways[`${UGD.Key}Timestamp`] = UGD.Timestamp;
                            lockAndSaveGiveaways(UGD.giveaways, Callback.bind(null, giveaways));
                        }
                    });
                } else {
                    Pagination = Context.getElementsByClassName(`pagination__navigation`)[0];
                    if (!Found && Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                        setTimeout(getUGDGiveaways, 0, UGD, giveaways, NextPage, URL, username, Callback);
                    } else {
                        giveaways[`${UGD.Key}Timestamp`] = UGD.Timestamp;
                        lockAndSaveGiveaways(UGD.giveaways, Callback.bind(null, giveaways));
                    }
                }
            } else if (!UGD.Canceled) {
                request(null, null, `GET`, true, URL + NextPage, function (Response) {
                    setTimeout(getUGDGiveaways, 0, UGD, giveaways, ++NextPage, URL, username, Callback, parseHtml(Response.responseText));
                });
            }
        }
    }

    function getUgdGiveaway(giveaways, i, n, callback) {
        if (i < n) {
            let giveaway = giveaways[i];
            if (giveaway.code) {
                giveaway.winners = [];
                getUgdWinners(giveaway, 1, `/giveaway/${giveaway.code}/_/winners/search?page=`, setTimeout.bind(null, getUgdGiveaway, 0, giveaways, i + 1, n, callback));
            } else {
                setTimeout(getUgdGiveaway, 0, giveaways, i + 1, n, callback);
            }
        } else {
            callback();
        }
    }

    function getUgdWinners(giveaway, nextPage, url, callback) {
        request(null, null, `GET`, false, `${url}${nextPage}`, response => {
            let element, elements, i, n, pagination, responseHtml;
            responseHtml = parseHtml(response.responseText);
            elements = responseHtml.getElementsByClassName(`table__row-inner-wrap`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                giveaway.winners.push({
                    received: element.lastElementChild.textContent.trim() === `Received` ? 1 : 0,
                    username: element.firstElementChild.nextElementSibling.firstElementChild.textContent.trim()
                });
            }
            pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
            if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                if (nextPage === 1) {
                    url = `${response.finalUrl}/search?page=`;
                }
                setTimeout(getUgdWinners, 0, giveaway, nextPage + 1, url, callback);
            } else {
                callback();
            }
        });
    }

    /* [NAMWC] Not Activated/Multiple Wins Checker */

    function addNamwcProfileButton(profile) {
        setNAMWCPopup(insertHtml(profile.wonRowLeft, `beforeEnd`, `
            <span class="esgst-namwc-button">
                <i class="fa fa-question-circle" title="Check for not activated/multiple wins"></i>
            </span>
        `), {
            SteamID64: profile.steamId,
            ID: profile.id,
            Username: profile.username
        });
    }

    function setNAMWCPopup(NAMWCButton, User, Mnu) {
        var popup, NAMWC;
        NAMWC = {
            User: (User ? User : null)
        };
        popup = new Popup(!Mnu ? `fa-question` : `fa-cog`, !Mnu ? `Check for ${NAMWC.User ? `${NAMWC.User.Username}'s ` : ``} not activated / multiple wins:` : `Manage Not Activated / Multiple Wins Checker caches:`);
        if (!Mnu) {
            popup.Options = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
            popup.Options.appendChild(createOptions([{
                check: true,
                description: `Only check for not activated wins.`,
                exclusions: [`namwc_checkMultiple`],
                id: `namwc_checkNotActivated`,
                tooltip: `If enabled, multiple wins will not be checked (faster).`
            }, {
                check: true,
                description: `Only check for multiple wins.`,
                exclusions: [`namwc_checkNotActivated`],
                id: `namwc_checkMultiple`,
                tooltip: `If enabled, not activated wins will not be checked (faster).`
            }]));
            popup.Options.insertAdjacentHTML(`afterEnd`, `<div class="esgst-description">If an user is highlighted, that means they have been either checked for the first time or updated.</div>`);
            popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-question-circle`, `fa-times-circle`, `Check`, `Cancel`, function (Callback) {
                NAMWC.ShowResults = false;
                NAMWCButton.classList.add(`esgst-busy`);
                setNAMWCCheck(NAMWC, function () {
                    NAMWCButton.classList.remove(`esgst-busy`);
                    NAMWC.Progress.innerHTML = ``;
                    Callback();
                });
            }, function () {
                clearInterval(NAMWC.Request);
                clearInterval(NAMWC.Save);
                NAMWC.Canceled = true;
                setTimeout(function () {
                    NAMWC.Progress.innerHTML = ``;
                }, 500);
                NAMWCButton.classList.remove(`esgst-busy`);
            }).set);
        }
        NAMWC.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        NAMWC.OverallProgress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        popup.Results = insertHtml(popup.scrollable, `beforeEnd`, `<div></div>`);
        createResults(popup.Results, NAMWC, [{
            Icon: `<i class="fa fa-check-circle esgst-positive"></i> `,
            Description: `Users with 0 not activated wins`,
            Key: `activated`
        }, {
            Icon: `<i class="fa fa-check-circle esgst-positive"></i> `,
            Description: `Users with 0 multiple wins`,
            Key: `notMultiple`
        }, {
            Icon: `<i class="fa fa-times-circle esgst-negative"></i> `,
            Description: `Users with not activated wins`,
            Key: `notActivated`
        }, {
            Icon: `<i class="fa fa-times-circle esgst-negative"></i> `,
            Description: `Users with multiple wins`,
            Key: `multiple`
        }, {
            Icon: `<i class="fa fa-question-circle"></i> `,
            Description: `Users who cannot be checked for not activated wins either because they have a private profile or SteamCommunity is down`,
            Key: `unknown`
        }]);
        NAMWC.popup = popup;
        NAMWCButton.addEventListener(`click`, function () {
            popup.open(function () {
                if (Mnu) {
                    NAMWC.ShowResults = true;
                    setNAMWCCheck(NAMWC);
                }
            });
        });
    }

    function setNAMWCCheck(NAMWC, Callback) {
        var SavedUsers, I, N, Username;
        NAMWC.Progress.innerHTML = NAMWC.OverallProgress.innerHTML = ``;
        NAMWC.activated.classList.add(`esgst-hidden`);
        NAMWC.notMultiple.classList.add(`esgst-hidden`);
        NAMWC.notActivated.classList.add(`esgst-hidden`);
        NAMWC.multiple.classList.add(`esgst-hidden`);
        NAMWC.unknown.classList.add(`esgst-hidden`);
        NAMWC.activatedCount.textContent = NAMWC.notMultipleCount.textContent = NAMWC.notActivatedCount.textContent = NAMWC.multipleCount.textContent = NAMWC.unknownCount.textContent = `0`;
        NAMWC.activatedUsers.innerHTML = NAMWC.notMultipleUsers.textContent = NAMWC.notActivatedUsers.innerHTML = NAMWC.multipleUsers.innerHTML = NAMWC.unknownUsers.innerHTML = ``;
        NAMWC.Users = [];
        NAMWC.users = {
            activated: {},
            notMultiple: {},
            notActivated: {},
            multiple: {},
            unknown: {}
        };
        NAMWC.steamIds = [];
        NAMWC.Canceled = false;
        if (NAMWC.ShowResults) {
            getValue(`users`).then(value => {
                SavedUsers = JSON.parse(value);
                for (I in SavedUsers.users) {
                    if (SavedUsers.users[I].namwc && SavedUsers.users[I].namwc.results) {
                        NAMWC.Users.push(SavedUsers.users[I].username);
                    }
                }
                NAMWC.Users = sortArray(NAMWC.Users);
                for (I = 0, N = NAMWC.Users.length; I < N; ++I) {
                    var user = {
                        steamId: SavedUsers.steamIds[NAMWC.Users[I]],
                        username: NAMWC.Users[I]
                    };
                    setNAMWCResult(NAMWC, user, SavedUsers.users[SavedUsers.steamIds[NAMWC.Users[I]]].namwc, false);
                }
            });
        } else if (NAMWC.User) {
            NAMWC.Users.push(NAMWC.User.Username);
            checkNAMWCUsers(NAMWC, 0, 1, Callback);
        } else {
            for (Username in esgst.currentUsers) {
                if (Username != esgst.username) {
                    if (NAMWC.Users.length < 26) {
                        NAMWC.Users.push(Username);
                    } else {
                        break;
                    }
                }
            }
            NAMWC.Users = sortArray(NAMWC.Users);
            checkNAMWCUsers(NAMWC, 0, NAMWC.Users.length, Callback);
        }
    }

    function checkNAMWCUsers(NAMWC, I, N, Callback) {
        if (!NAMWC.Canceled) {
            NAMWC.Progress.innerHTML = ``;
            NAMWC.OverallProgress.textContent = `${I} of ${N} users checked...`;
            if (I < N) {
                let Key, newR, Results, savedUser, User, user;
                User = NAMWC.User ? NAMWC.User : {
                    Username: NAMWC.Users[I]
                };
                user = {
                    steamId: User.SteamID64,
                    id: User.ID,
                    username: User.Username
                };
                var namwc = null;
                getUser(null, user).then(savedUser => {
                    if (savedUser) {
                        namwc = savedUser.namwc;
                    }
                    if (namwc && namwc.results) {
                        Results = namwc.results;
                    }
                    checkNAMWCUser(NAMWC, namwc, user.username, function(namwc) {
                        if (Results) {
                            for (Key in Results) {
                                let value = (Array.isArray(Results[Key]) && Results[Key].length) || (!Array.isArray(Results[Key]) && Results[Key]);
                                if (value !== ((Array.isArray(namwc.results[Key]) && namwc.results[Key].length) || (!Array.isArray(namwc.results[Key]) && namwc.results[Key]))) {
                                    newR = true;
                                    break;
                                }
                            }
                        } else {
                            newR = true;
                        }
                        setTimeout(setNAMWCResult, 0, NAMWC, user, namwc, newR, I, N, Callback);
                    });
                });
            } else {
                NAMWC.Progress.textContent = `Checking suspensions...`;             
                request(null, null, `GET`, false, `https://script.google.com/macros/s/AKfycbwdKNormCJs-hEKV0GVwawgWj1a26oVtPylgmxOOvNk1Gf17A/exec?steamIds=${NAMWC.steamIds.join(`,`)}`, response => {
                    let i, n, namwc, savedUser, savedUsers, steamId, suspensions, user, users;
                    users = [];
                    getValue(`users`).then(value => {
                        savedUsers = JSON.parse(value);
                        suspensions = JSON.parse(response.responseText).suspensions;
                        for (steamId in suspensions) {
                            suspension = suspensions[steamId];
                            user = {
                                steamId: steamId
                            };
                            savedUser = getUser(savedUsers, user);
                            user.id = savedUser.id;
                            user.username = savedUser.username;
                            namwc = savedUser.namwc;
                            namwc.suspension = suspension;
                            user.values = {
                                namwc: namwc
                            };
                            users.push(user);
                            if (Array.isArray(namwc.results.notActivated)) {
                                for (i = 0, n = namwc.results.notActivated.length; i < n && namwc.results.notActivated[i] <= suspension; ++i);
                                i -= 1;
                                if (i > 0) {
                                    NAMWC.users[steamId].notActivated.insertAdjacentHTML(`beforeEnd`, ` <span title="This user already served suspension for ${i} of their not activated wins (until ${getTimestamp(suspension / 1e3, true, true)})">[-${i}]</span>`);
                                }
                            }
                            if (Array.isArray(namwc.results.multiple)) {
                                for (i = 0, n = namwc.results.multiple.length; i < n && namwc.results.multiple[i] <= suspension; ++i);
                                i -= 1;
                                if (i > 0) {
                                    NAMWC.users[steamId].multiple.insertAdjacentHTML(`beforeEnd`, ` <span title="This user already served suspension for ${i} of their multiple wins (until ${getTimestamp(suspension / 1e3, true, true)})">[-${i}]</span>`);
                                }
                            }
                        }
                        saveUsers(users, () => {
                            if (Callback) {
                                Callback();
                            }
                        });
                    });
                });
            }
        }
    }

    function setNAMWCResult(NAMWC, user, namwc, New, I, N, Callback) {
        var elements, Key;
        if (!NAMWC.Canceled) {
            elements = {};
            for (Key in namwc.results) {
                if ((Array.isArray(namwc.results[Key]) && namwc.results[Key].length) || (!Array.isArray(namwc.results[Key]) && namwc.results[Key])) {
                    NAMWC[Key].classList.remove(`esgst-hidden`);
                    NAMWC[`${Key}Count`].textContent = parseInt(NAMWC[`${Key}Count`].textContent) + 1;
                    elements[Key] = insertHtml(NAMWC[`${Key}Users`], `beforeEnd`, `
                        <a ${New ? `class="esgst-bold esgst-italic" ` : ``}href="http://www.sgtools.info/${Key.match(/multiple|notMultiple/) ? `multiple` : `nonactivated`}/${user.username}" target="_blank">${user.username}${Key.match(/^(notActivated|multiple)$/) ? ` (${(Array.isArray(namwc.results[Key]) && namwc.results[Key].length) || (!Array.isArray(namwc.results[Key]) && namwc.results[Key])})` : ``}</a>
                    `);
                }
            }
            if (!NAMWC.ShowResults) {
                user.values = {
                    namwc: namwc
                };
                saveUser(null, null, user, function () {
                    NAMWC.users[user.steamId] = elements;
                    NAMWC.steamIds.push(user.steamId);
                    NAMWC.Progress.innerHTML = ``;
                    setTimeout(checkNAMWCUsers, 0, NAMWC, ++I, N, Callback);
                });
            }
        }
    }

    function checkNAMWCUser(NAMWC, namwc, username, Callback) {
        if (!NAMWC.Canceled) {
            if (!namwc) {
                namwc = {
                    lastCheck: 0,
                    results: {}
                };
            }
            if ((Date.now() - namwc.lastCheck) > 604800000) {
                if (esgst.namwc_checkNotActivated) {
                    checkNAMWCNotActivated(NAMWC, namwc, username, Callback);
                } else if (esgst.namwc_checkMultiple) {
                    checkNAMWCMultiple(NAMWC, namwc, username, Callback);
                } else {
                    checkNAMWCNotActivated(NAMWC, namwc, username, function (namwc) {
                        checkNAMWCMultiple(NAMWC, namwc, username, Callback);
                    });
                }
            } else {
                Callback(namwc);
            }
        }
    }

    function checkNAMWCNotActivated(NAMWC, namwc, username, Callback) {
        if (!NAMWC.Canceled) {
            if (NAMWC.Progress) {
                NAMWC.Progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Retrieving ${username}'s not activated wins...</span>
                `;
            }
            request(null, null, `GET`, true, `http://www.sgtools.info/nonactivated/${username}`, response => {
                let responseText = response.responseText;
                if (responseText.match(/has a private profile/)) {
                    namwc.results.activated = false;
                    namwc.results.notActivated = [];
                    namwc.results.unknown = true;
                } else {
                    let elements, i, n;
                    namwc.results.notActivated = [];
                    elements = parseHtml(responseText).getElementsByClassName(`notActivatedGame`);
                    for (i = 0, n = elements.length; i < n; ++i) {
                        namwc.results.notActivated.push(new Date(elements[i].textContent.match(/\((\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2})\)/)[1]).getTime());
                    }
                    namwc.results.activated = n === 0 ? true : false;
                    namwc.results.unknown = false;
                }
                namwc.lastCheck = Date.now();
                Callback(namwc);
            });
        }
    }

    function checkNAMWCMultiple(NAMWC, namwc, username, Callback) {
        if (!NAMWC.Canceled) {
            if (NAMWC.Progress) {
                NAMWC.Progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Retrieving ${username}'s multiple wins...</span>
                `;
            }
            request(null, null, `GET`, true, `http://www.sgtools.info/multiple/${username}`, response => {
                let elements, i, n;
                namwc.results.multiple = [];
                elements = parseHtml(response.responseText).getElementsByClassName(`multiplewins`);
                for (i = 0, n = elements.length; i < n; ++i) {
                    namwc.results.multiple.push(new Date(elements[i].textContent.match(/and\s(\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2})\)/)[1]).getTime());
                }
                namwc.results.notMultiple = n === 0 ? true : false;
                namwc.lastCheck = Date.now();
                Callback(namwc);
            });
        }
    }

    /* [NRF] Not Received Finder */

    function addNrfButton(profile, savedUser) {
        var NRF;
        NRF = {
            N: profile.notSent
        };
        if (NRF.N > 0) {
            NRF.I = 0;
            NRF.Multiple = [];
            profile.sentRowLeft.insertAdjacentHTML(`beforeEnd`, `
                <span class="esgst-nrf-button">
                    <i class="fa fa-times-circle" title="Find not received giveaways"></i>
                </span>
            `);
            setNRFPopup(NRF, profile.sentRowLeft.lastElementChild, profile);
        }
    }

    function setNRFPopup(NRF, NRFButton, profile) {
        var popup;
        popup = new Popup(`fa-times`, `Find ${profile.username}'s not received giveaways:`);
        popup.Options = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        popup.Options.appendChild(createOptions([{
            check: true,
            description: `Also search inside giveaways with multiple copies.`,
            id: `nrf_searchMultiple`,
            tooltip: `If disabled, only giveaways with visible not received copies will be found (faster).`
        }]));
        popup.Options.insertAdjacentHTML(`afterEnd`, `<div class="esgst-description">If you're blacklisted / not whitelisted / not a member of the same Steam groups, not all giveaways will be found.`);
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-search`, `fa-times-circle`, `Find`, `Cancel`, function (Callback) {
            NRFButton.classList.add(`esgst-busy`);
            setNRFSearch(NRF, profile, function () {
                NRF.Progress.innerHTML = ``;
                NRFButton.classList.remove(`esgst-busy`);
                Callback();
            });
        }, function () {
            clearInterval(NRF.Request);
            clearInterval(NRF.Save);
            NRF.Canceled = true;
            setTimeout(function () {
                NRF.Progress.innerHTML = ``;
            }, 500);
            NRFButton.classList.remove(`esgst-busy`);
        }).set);
        NRF.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        NRF.OverallProgress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        NRF.Results = insertHtml(popup.scrollable, `beforeEnd`, `<div></div>`);
        NRF.popup = popup;
        NRFButton.addEventListener(`click`, function () {
            popup.open();
        });
    }

    function setNRFSearch(NRF, profile, Callback) {
        NRF.Progress.innerHTML = NRF.OverallProgress.innerHTML = NRF.Results.innerHTML = ``;
        NRF.Canceled = false;
        var user = {
            steamId: profile.steamId,
            id: profile.id,
            username: profile.username
        };
        var nrf;
        getUser(null, user).then(savedUser => {
            if (savedUser) {
                nrf = savedUser.nrf;
            }
            if (!nrf) {
                nrf = {
                    lastCheck: 0,
                    found: 0,
                    total: 0,
                    results: ``
                };
            }
            if ((Date.now() - nrf.lastCheck) > 604800000) {
                searchNRFUser(NRF, user.username, 1, 0, `/user/${user.username}/search?page=`, function () {
                    nrf.lastCheck = Date.now();
                    nrf.found = NRF.I;
                    nrf.total = NRF.N;
                    nrf.results = NRF.Results.innerHTML;
                    user.values = {
                        nrf: nrf
                    };
                    saveUser(null, null, user, function () {
                        loadEndlessFeatures(NRF.Results).then(() => {
                            NRF.Progress.innerHTML = ``;
                            Callback();
                        });
                    });
                });
            } else {
                NRF.Results.innerHTML = nrf.results;
                NRF.OverallProgress.innerHTML = `${nrf.found} of ${nrf.total} not received giveaways found...`;
                loadEndlessFeatures(NRF.Results).then(Callback);
            }
        });
    }

    function searchNRFUser(NRF, username, NextPage, CurrentPage, URL, Callback, Context) {
        var Matches, I, N, Match, Pagination;
        if (!NRF.Canceled) {
            if (Context) {
                if (NextPage === 2) {
                    NRF.lastPage = getLastPage(Context, false, false, true);
                    NRF.lastPage = NRF.lastPage === 999999999 ? `` : ` of ${NRF.lastPage}`;
                }
                NRF.Progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Searching ${username}'s giveaways (page ${NextPage - 1}${NRF.lastPage})...</span>
                `;
                Matches = Context.querySelectorAll(`div.giveaway__column--negative`);
                for (I = 0, N = Matches.length; I < N; ++I) {
                    NRF.I += Matches[I].querySelectorAll(`a[href*="/user/"]`).length;
                    NRF.Results.appendChild(Matches[I].closest(`.giveaway__row-outer-wrap`).cloneNode(true));
                }
                NRF.OverallProgress.innerHTML = `${NRF.I} of ${NRF.N} not received giveaways found...`;
                if (NRF.I < NRF.N) {
                    if (esgst.nrf_searchMultiple) {
                        Matches = Context.getElementsByClassName(`giveaway__heading__thin`);
                        for (I = 0, N = Matches.length; I < N; ++I) {
                            Match = Matches[I].textContent.match(/\((.+) Copies\)/);
                            if (Match && (parseInt(Match[1]) > 3)) {
                                NRF.Multiple.push(Matches[I].closest(`.giveaway__row-outer-wrap`).cloneNode(true));
                            }
                        }
                    }
                    Pagination = Context.getElementsByClassName(`pagination__navigation`)[0];
                    if (Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                        setTimeout(searchNRFUser, 0, NRF, username, NextPage, CurrentPage, URL, Callback);
                    } else if (esgst.nrf_searchMultiple && NRF.Multiple.length) {
                        setTimeout(searchNRFMultiple, 0, NRF, 0, NRF.Multiple.length, Callback);
                    } else {
                        Callback();
                    }
                } else {
                    Callback();
                }
            } else if (!NRF.Canceled) {
                request(null, null, `GET`, true, URL + NextPage, function (Response) {
                    setTimeout(searchNRFUser, 0, NRF, username, ++NextPage, CurrentPage, URL, Callback, parseHtml(Response.responseText));
                });
            }
        }
    }

    function searchNRFMultiple(NRF, I, N, Callback) {
        if (!NRF.Canceled) {
            NRF.Progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Searching inside giveaways with multiple copies (${I - 1} of ${N})...</span>
            `;
            if (I < N) {
                searchNRFGiveaway(NRF, `${NRF.Multiple[I].getElementsByClassName(`giveaway__heading__name`)[0].getAttribute(`href`)}/winners/search?page=`, 1, function (Found) {
                    if (Found) {
                        NRF.Results.appendChild(NRF.Multiple[I].cloneNode(true));
                    }
                    if (NRF.I < NRF.N) {
                        setTimeout(searchNRFMultiple, 0, NRF, ++I, N, Callback);
                    } else {
                        Callback();
                    }
                });
            } else {
                Callback();
            }
        }
    }

    function searchNRFGiveaway(NRF, URL, NextPage, Callback) {
        if (!NRF.Canceled) {
            request(null, null, `GET`, true, URL + NextPage, function (Response) {
                var ResponseHTML, Matches, I, N, Found, Pagination;
                ResponseHTML = parseHtml(Response.responseText);
                Matches = ResponseHTML.getElementsByClassName(`table__column--width-small`);
                for (I = 0, N = Matches.length; I < N; ++I) {
                    if (Matches[I].textContent.match(/Not Received/)) {
                        Found = true;
                        ++NRF.I;
                        NRF.OverallProgress.innerHTML = `${NRF.I} of ${NRF.N} not received giveaways found...`;
                        if (NRF.I >= NRF.N) {
                            break;
                        }
                    }
                }
                Pagination = ResponseHTML.getElementsByClassName(`pagination__navigation`)[0];
                if ((NRF.I < NRF.N) && Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(searchNRFGiveaway, 0, NRF, URL, ++NextPage, Callback);
                } else {
                    Callback(Found);
                }
            });
        }
    }

    /* [SWR] Sent/Won Ratio */

    function addSwrRatio(profile) {
        var ratio, fullRatio, reducedRatio, zeroRatio, cvRatio, realCVRatio;
        ratio = profile.wonCount > 0 ? Math.round(profile.sentCount / profile.wonCount * 100) / 100 : 0;
        fullRatio = profile.wonFull > 0 ? Math.round(profile.sentFull / profile.wonFull * 100) / 100 : 0;
        reducedRatio = profile.wonReduced > 0 ? Math.round(profile.sentReduced / profile.wonReduced * 100) / 100 : 0;
        zeroRatio = profile.wonZero > 0 ? Math.round(profile.sentZero / profile.wonZero * 100) / 100 : 0;
        cvRatio = profile.wonCV > 0 ? Math.round(profile.sentCV / profile.wonCV * 100) / 100 : 0;
        realCVRatio = profile.realWonCV > 0 ? Math.round(profile.realSentCV / profile.realWonCV * 100) / 100 : 0;
        var ratioTooltip = {
            rows: [
                {
                    columns: [
                        {
                            name: `Ratio`
                        },
                        {
                            color: `#8f96a6`,
                            name: ratio
                        }
                    ],
                    icon: [
                        {
                            class: `fa-pie-chart`,
                            color: `#77899a`
                        }
                    ]
                },
                {
                    columns: [
                        {
                            color: `#8f96a6`,
                            name: `Full Value`
                        },
                        {
                            color: `#8f96a6`,
                            name: fullRatio
                        }
                    ],
                    indent: `80px`
                },
                {
                    columns: [
                        {
                            color: `#8f96a6`,
                            name: `Reduced Value`
                        },
                        {
                            color: `#8f96a6`,
                            name: reducedRatio
                        }
                    ],
                    indent: `80px`
                },
                {
                    columns: [
                        {
                            color: `#8f96a6`,
                            name: `No Value`
                        },
                        {
                            color: `#8f96a6`,
                            name: zeroRatio
                        }
                    ],
                    indent: `80px;`
                }
            ]
        };
        var cvTooltip = {
            rows: [
                {
                    columns: [
                        {
                            name: `Real Value`
                        },
                        {
                            color: `#8f96a6`,
                            name: `\$${realCVRatio}`
                        }
                    ],
                    icon : [
                        {
                            class: `fa-dollar`,
                            color: `#84cfda`
                        }
                    ]
                }
            ]
        };
        profile.sentRow.insertAdjacentHTML(`afterEnd`, `
            <div class="esgst-swr-ratio featured__table__row">
                <div class="featured__table__row__left">Ratio</div>
                <div class="featured__table__row__right">
                    <span data-ui-tooltip='${JSON.stringify(ratioTooltip)}'>${ratio}</span>
                    (<span data-ui-tooltip='${JSON.stringify(cvTooltip)}'>\$${cvRatio}</span>)
                </div>
            </div>
        `);
    }

    /* [LUC] Level Up Calculator */

    function calculateLuvValue(profile) {
        var base, lower, upper, value, values;
        base = parseInt(profile.level);
        if (base < 10) {
            values = [0, 0.01, 25.01, 50.01, 100.01, 250.01, 500.01, 1000.01, 2000.01, 3000.01, 5000.01];
            lower = values[base];
            upper = values[base + 1];
            value = Math.round((upper - (lower + ((upper - lower) * (profile.level - base)))) * 100) / 100;
            profile.levelRowRight.insertAdjacentHTML(`beforeEnd`, `<span class="esgst-luc-value">(~\$${value} real CV to level ${base + 1})</span>`);
        }
    }

    /* [SGPB] SteamGifts Profile Button */

    function addSgpbButton(profile) {
        var button;
        button = insertHtml(profile.steamButtonContainer, `beforeEnd`, `
            <div class="esgst-sgpb-container">
                <a class="esgst-sgpb-button" href="https://www.steamgifts.com/go/user/${profile.steamId}" rel="nofollow" target="_blank">
                    <i class="fa">
                        <img src="${esgst.sgIcon}">
                    </i>
                    <span>Visit SteamGifts Profile</span>
                </a>
            </div>
        `);
        button.insertBefore(profile.steamButton, button.firstElementChild);
    }

    /* [STPB] SteamTrades Profile Button */

    function addStpbButton(profile) {
        var button, tooltip;
        button = insertHtml(profile.steamButtonContainer.firstElementChild, `beforeEnd`, `
            <a class="esgst-stpb-button" href="https://www.steamtrades.com/user/${profile.steamId}" rel="nofollow" target="_blank">
                <i class="fa fa-fw">
                    <img src="${esgst.stIcon}">
                </i>
            </a>
        `);
        tooltip = profile.steamButtonContainer.getElementsByClassName(`js-tooltip`)[0];
        if (tooltip) {
            button.addEventListener(`mouseenter`, showStpbTooltip.bind(null, button, tooltip));
            button.addEventListener(`mouseleave`, hideStpbTooltip.bind(null, button));
        }
    }

    function showStpbTooltip(button, tooltip) {
        tooltip.textContent = `Visit SteamTrades Profile`;
        setSiblingsOpacity(button, `0.2`);
    }

    function hideStpbTooltip(button) {
        setSiblingsOpacity(button, `1`);
    }

    /* [WBC] Whitelist/Blacklist Checker */

    function addWBCButton(Context, WBCButton) {
        var checkAllSwitch, checkSingleSwitch, popup, skip, WBC;
        WBC = {
            Update: (Context ? false : true),
            B: esgst.wbc_b,
            Username: esgst.username
        };
        popup = new Popup(WBC.Update ? `fa-cog` : `fa-question`, WBC.Update ? `Manage Whitelist/Blacklist Checker caches:` : `Check for whitelists${WBC.B ? `/blacklists` : ``}:`);
        if (location.pathname.match(new RegExp(`^\/user\/(?!${WBC.Username})`))) {
            WBC.User = {
                Username: document.getElementsByClassName(`featured__heading__medium`)[0].textContent,
                ID: document.querySelector(`[name="child_user_id"]`).value,
                SteamID64: document.querySelector(`a[href*="/profiles/"]`).href.match(/\d+/)[0],
            };
        }
        popup.Options = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        if (WBC.User) {
            checkSingleSwitch = new ToggleSwitch(popup.Options, `wbc_checkSingle`, false, `Only check ${WBC.User ? WBC.User.Username : `current user`}.`, false, false, `If disabled, all users in the current page will be checked.`, esgst.wbc_checkSingle);
        }
        checkSelectedSwitch = new ToggleSwitch(popup.Options, `wbc_checkSelected`, false, `Only check selected.`, false, false, `To check only selected users in the page, enable the user selector at the left side of the Whitelist/Blacklist Checker button (same selector used for Multi-Tags) and select the users. Then come back here, enable this option if you haven't done so already and check.`, esgst.wbc_checkSelected);
        if (WBC.B) {
            new ToggleSwitch(popup.Options, `wbc_checkWhitelist`, false, `Also check whitelist.`, false, false, `If disabled, a blacklist-only check will be performed (faster).`, esgst.wbc_checkWhitelist);
        }
        if (!WBC.Update && !location.pathname.match(/^\/(discussions|users|archive)/)) {
            checkAllSwitch = new ToggleSwitch(popup.Options, `wbc_checkAll`, false, `Check all pages.`, false, false, `If disabled, only the current page will be checked.`, esgst.wbc_checkAll);
        }
        new ToggleSwitch(popup.Options, `wbc_returnWhitelist`, false, `Return whitelists.`, false, false, `If enabled, everyone who has whitelisted you will be whitelisted back.`, esgst.wbc_returnWhitelist);
        if (WBC.B) {
            new ToggleSwitch(popup.Options, `wbc_returnBlacklist`, false, `Return blacklists.`, false, false, `If enabled, everyone who has blacklisted you will be blacklisted back.`, esgst.wbc_returnBlacklist);
        }
        new ToggleSwitch(popup.Options, `wbc_checkNew`, false, `Only check users who have not whitelisted ${WBC.B ? `/blacklisted` : ``} you.`, false, false, `If enabled, everyone who has whitelisted ${WBC.B ? `/blacklisted` : ``} you will be ignored (might lead to outdated data if someone who had whitelisted ${WBC.B ? `/blacklisted` : ``} you in the past removed you from those lists).`, esgst.wbc_checkNew);
        new ToggleSwitch(popup.Options, `wbc_skipUsers`, false, `Skip users after <input class="esgst-ugs-difference" type="number" value="${esgst.wbc_pages}"/> pages.`, false, false, `If enabled, when a user check passes the number of pages specified, the user will be skipped.`, esgst.wbc_skipUsers).name.firstElementChild.addEventListener(`change`, event => {
            setSetting(`wbc_pages`, event.currentTarget.value);
            esgst.wbc_pages = event.currentTarget.value;
        });
        new ToggleSwitch(popup.Options, `wbc_clearCache`, false, `Clear caches.`, false, false, `If enabled, the caches of all checked users will be cleared (slower).`, esgst.wbc_clearCache);
        if (checkSingleSwitch || checkAllSwitch) {
            if (checkSingleSwitch) {
                if (checkAllSwitch) {
                    checkSingleSwitch.exclusions.push(checkAllSwitch.container);
                }
                checkSingleSwitch.exclusions.push(checkSelectedSwitch.container);
                checkSelectedSwitch.exclusions.push(checkSingleSwitch.container);
                if (esgst.wbc_checkSingle) {
                    if (checkAllSwitch) {
                        checkAllSwitch.container.classList.add(`esgst-hidden`);
                    }
                    checkSelectedSwitch.container.classList.add(`esgst-hidden`);
                } else if (esgst.wbc_checkSelected) {
                    checkSingleSwitch.container.classList.add(`esgst-hidden`);
                }
            }
            if (checkAllSwitch) {
                if (checkSingleSwitch) {
                    checkAllSwitch.exclusions.push(checkSingleSwitch.container);
                }
                checkSelectedSwitch.exclusions.push(checkAllSwitch.container);
                checkAllSwitch.exclusions.push(checkSelectedSwitch.container);
                if (esgst.wbc_checkAll) {
                    if (checkSingleSwitch) {
                        checkSingleSwitch.container.classList.add(`esgst-hidden`);
                    }
                    checkSelectedSwitch.container.classList.add(`esgst-hidden`);
                } else if (esgst.wbc_checkSelected) {
                    checkAllSwitch.container.classList.add(`esgst-hidden`);
                }
            }
        }
        popup.Options.insertAdjacentHTML(`afterEnd`, `<div class="esgst-description">If an user is highlighted, that means they have been either checked for the first time or updated.</div>`);
        popup.description.appendChild(new ButtonSet(`green`, `grey`, WBC.Update ? `fa-refresh` : `fa-question-circle`, `fa-times-circle`, WBC.Update ? `Update` : `Check`, `Cancel`, function (Callback) {
            WBC.ShowResults = false;
            WBCButton.classList.add(`esgst-busy`);
            setWBCCheck(WBC, skip, function () {
                skip.innerHTML = ``;
                WBCButton.classList.remove(`esgst-busy`);
                Callback();
            });
        }, function () {
            clearInterval(WBC.Request);
            clearInterval(WBC.Save);
            WBC.Canceled = true;
            setTimeout(function () {
                WBC.Progress.innerHTML = ``;
            }, 500);
            WBCButton.classList.remove(`esgst-busy`);
        }).set);
        skip = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        WBC.Progress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        WBC.OverallProgress = insertHtml(popup.description, `beforeEnd`, `<div></div>`);
        popup.Results = insertHtml(popup.scrollable, `beforeEnd`, `<div></div>`);
        createResults(popup.Results, WBC, [{
            Icon: `<i class="fa fa-heart esgst-whitelist"></i> `,
            Description: `You are whitelisted by`,
            Key: `whitelisted`
        }, {
            Icon: `<i class="fa fa-ban esgst-blacklist"></i> `,
            Description: `You are blacklisted by`,
            Key: `blacklisted`
        }, {
            Icon: `<i class="fa fa-check-circle"></i> `,
            Description: WBC.B ? "You are neither whitelisted nor blacklisted by" : `You are not whitelisted by`,
            Key: `none`
        }, {
            Icon: `<i class="fa fa-question-circle"></i> `,
            Description: `You are not blacklisted and there is not enough information to know if you are whitelisted by`,
            Key: `notBlacklisted`
        }, {
            Icon: `<i class="fa fa-question-circle"></i> `,
            Description: `There is not enough information to know if you are whitelisted${WBC.B ? ` or blacklisted` : ``} by`,
            Key: `unknown`
        }, {
            Icon: `<i class="fa fa-forward"></i> `,
            Description: `Skipped users`,
            Key: `skipped`
        }]);
        WBCButton.addEventListener(`click`, function () {
            WBC.popup = popup;
            popup.open(function () {
                if (WBC.Update) {
                    WBC.ShowResults = true;
                    setWBCCheck(WBC, skip);
                }
            });
        });
    }

    function setWBCCheck(WBC, skip, Callback) {
        var SavedUsers, I, N, Username;
        WBC.Progress.innerHTML = WBC.OverallProgress.innerHTML = ``;
        WBC.whitelisted.classList.add(`esgst-hidden`);
        WBC.blacklisted.classList.add(`esgst-hidden`);
        WBC.none.classList.add(`esgst-hidden`);
        WBC.notBlacklisted.classList.add(`esgst-hidden`);
        WBC.unknown.classList.add(`esgst-hidden`);
        WBC.skipped.classList.add(`esgst-hidden`);
        WBC.whitelistedCount.textContent = WBC.blacklistedCount.textContent = WBC.noneCount.textContent = WBC.notBlacklistedCount.textContent = WBC.unknownCount.textContent = WBC.skippedCount.textContent = `0`;
        WBC.whitelistedUsers.innerHTML = WBC.blacklistedUsers.innerHTML = WBC.noneUsers.innerHTML = WBC.notBlacklistedUsers.innerHTML = WBC.unknownUsers.innerHTML = WBC.skippedUsers.innerHTML = ``;
        WBC.Users = [];
        WBC.Canceled = false;
        if (WBC.Update) {
            getValue(`users`).then(value => {
                SavedUsers = JSON.parse(value);
                for (I in SavedUsers.users) {
                    if (SavedUsers.users[I].wbc && SavedUsers.users[I].wbc.result) {
                        WBC.Users.push(SavedUsers.users[I].username);
                    }
                }
                WBC.Users = sortArray(WBC.Users);
                if (WBC.ShowResults) {
                    for (I = 0, N = WBC.Users.length; I < N; ++I) {
                        var user = {
                            steamId: SavedUsers.steamIds[WBC.Users[I]],
                            id: SavedUsers.users[SavedUsers.steamIds[WBC.Users[I]]].id,
                            username: WBC.Users[I]
                        };
                        setWBCResult(WBC, user, SavedUsers.users[SavedUsers.steamIds[WBC.Users[I]]].wbc, SavedUsers.users[SavedUsers.steamIds[WBC.Users[I]]].notes, SavedUsers.users[SavedUsers.steamIds[WBC.Users[I]]].whitelisted, SavedUsers.users[SavedUsers.steamIds[WBC.Users[I]]].blacklisted, false);
                    }
                } else {
                    skip.appendChild(new ButtonSet(`green`, ``, `fa-forward`, ``, `Skip User`, ``, callback => {
                        callback();
                        WBC.manualSkip = true;
                    }).set);
                    checkWBCUsers(WBC, 0, WBC.Users.length, Callback);
                }
            });
        } else if (WBC.User && esgst.wbc_checkSingle) {
            WBC.Users.push(WBC.User.Username);
            checkWBCUsers(WBC, 0, 1, Callback);
        } else {
            if (esgst.wbc_checkSelected) {
                WBC.Users = Array.from(esgst.mtUsers);
            } else {
                for (Username in esgst.currentUsers) {
                    if (Username != WBC.Username) {
                        WBC.Users.push(Username);
                    }
                }
            }
            if (esgst.wbc_checkAll && ((((WBC.User && !esgst.wbc_checkSingle) || !WBC.User) && !WBC.Update && !location.pathname.match(/^\/(discussions|users|archive)/)))) {
                getWBCUsers(WBC, 1, esgst.currentPage, esgst.searchUrl, function () {
                    skip.appendChild(new ButtonSet(`green`, ``, `fa-forward`, ``, `Skip User`, ``, callback => {
                        callback();
                        WBC.manualSkip = true;
                    }).set);
                    WBC.Users = sortArray(WBC.Users);
                    checkWBCUsers(WBC, 0, WBC.Users.length, Callback);
                });
            } else {
                skip.appendChild(new ButtonSet(`green`, ``, `fa-forward`, ``, `Skip User`, ``, callback => {
                    callback();
                    WBC.manualSkip = true;
                }).set);
                WBC.Users = sortArray(WBC.Users);
                checkWBCUsers(WBC, 0, WBC.Users.length, Callback);
            }
        }
    }

    function skipWbcUser(wbc, username) {
        wbc.manualSkip = false;
        wbc.skipped.classList.remove(`esgst-hidden`);
        wbc.skippedCount.textContent = parseInt(wbc.skippedCount.textContent) + 1;
        wbc.skippedUsers.insertAdjacentHTML(`beforeEnd`, `<a href="/user/${username}">${username}</a>`);
    }

    function checkWBCUsers(WBC, I, N, Callback) {
        var User, Result;
        if (!WBC.Canceled) {
            WBC.Progress.innerHTML = ``;
            WBC.OverallProgress.textContent = `${I} of ${N} users checked...`;
            if (I < N) {
                if (WBC.manualSkip) {
                    skipWbcUser(WBC, WBC.Users[I]);
                    setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
                } else {
                    User = (WBC.User && esgst.wbc_checkSingle) ? WBC.User : {
                        Username: WBC.Users[I]
                    };
                    var user = {
                        steamId: User.SteamID64,
                        id: User.ID,
                        username: User.Username
                    };
                    var notes, whitelisted, blacklisted, wbc;
                    getUser(null, user).then(savedUser => {
                        if (savedUser) {
                            notes = savedUser.notes;
                            whitelisted = savedUser.whitelisted;
                            blacklisted = savedUser.blacklisted;
                            wbc = savedUser.wbc;
                        }
                        if (wbc && wbc.result) {
                            Result = wbc.result;
                        }
                        if (!wbc || !esgst.wbc_checkNew) {
                            checkWBCUser(WBC, wbc, user.username, function (wbc) {
                                if (wbc) {
                                    setTimeout(setWBCResult, 0, WBC, user, wbc, notes, whitelisted, blacklisted, (Result != wbc.result) ? true : false, I, N, Callback);
                                } else {
                                    skipWbcUser(WBC, user.username);
                                    setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
                                }
                            });
                        } else {
                            setTimeout(setWBCResult, 0, WBC, user, wbc, notes, whitelisted, blacklisted, (Result != wbc.result) ? true : false, I, N, Callback);
                        }
                    });
                }
            } else if (Callback) {
                Callback();
            }
        }
    }

    function setWBCResult(WBC, user, wbc, notes, whitelisted, blacklisted, New, I, N, Callback) {
        var Key;
        if (!WBC.Canceled) {
            Key = ((wbc.result === `blacklisted` || wbc.result === `notBlacklisted`) && !WBC.B) ? `unknown` : wbc.result;
            WBC[Key].classList.remove(`esgst-hidden`);
            WBC[`${Key}Count`].textContent = parseInt(WBC[`${Key}Count`].textContent) + 1;
            WBC[`${Key}Users`].insertAdjacentHTML(`beforeEnd`, `<a ${New ? `class="esgst-bold esgst-italic" ` : ``}href="/user/${user.username}">${user.username}</a>`);
            if (!WBC.ShowResults) {
                if ((esgst.wbc_returnWhitelist && (wbc.result === `whitelisted`) && !whitelisted) || (WBC.B && esgst.wbc_returnBlacklist && (wbc.result === `blacklisted`) && !blacklisted)) {
                    if (user.id) {
                        returnWBCWhitelistBlacklist(WBC, wbc, user.username, user.id, notes, function (success, notes) {
                            if (success) {
                                user.values = {
                                    wbc: wbc,
                                    whitelisted: false,
                                    blacklisted: false
                                };
                                if (notes) {
                                    user.values.notes = notes;
                                }
                                user.values[wbc.result] = true;
                                user.values[`${wbc.result}Date`] = Date.now();
                            }
                            saveUser(null, null, user, function () {
                                setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
                            });
                        });
                    } else {
                        getUserId(user, function() {
                            returnWBCWhitelistBlacklist(WBC, wbc, user.username, user.id, notes, function (success, notes) {
                                if (success) {
                                    user.values = {
                                        wbc: wbc,
                                        whitelisted: false,
                                        blacklisted: false
                                    };
                                    if (notes) {
                                        user.values.notes = notes;
                                    }
                                    user.values[wbc.result] = true;
                                    user.values[`${wbc.result}Date`] = Date.now();
                                }
                                saveUser(null, null, user, function () {
                                    setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
                                });
                            });
                        });
                    }
                } else if (wbc.result === `whitelisted` || wbc.result === `blacklisted` || whitelisted || blacklisted) {
                    user.values = {
                        wbc: wbc
                    };
                    saveUser(null, null, user, function() {
                        setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
                    });
                } else if (New) {
                    user.values = {
                        wbc: null
                    };
                    saveUser(null, null, user, function() {
                        setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
                    });
                } else {
                    setTimeout(checkWBCUsers, 0, WBC, ++I, N, Callback);
                }
            }
        }
    }

    function returnWBCWhitelistBlacklist(WBC, wbc, username, id, notes, Callback) {
        var Key, Type;
        if (!WBC.Canceled) {
            Key = wbc.result;
            Type = Key.match(/(.+)ed/)[1];
            WBC.Progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Returning ${Type} for ${username}...</span>
            `;
            if (location.pathname.match(new RegExp(`^\/user\/${username}`))) {
                document.getElementsByClassName(`sidebar__shortcut__${Type}`)[0].click();
                if (esgst.wbc_n) {
                    var msg = `Returned ${Type}.`;
                    if (notes) {
                        notes = `${msg}\n\n${notes}`;
                    } else {
                        notes = msg;
                    }
                }
                Callback(true, notes);
            } else {
                request(`xsrf_token=${esgst.xsrfToken}&do=${Type}&child_user_id=${id}&action=insert`, null, `POST`, true, `/ajax.php`, function (Response) {
                    var success = false;
                    if (JSON.parse(Response.responseText).type === `success`) {
                        success = true;
                        if (esgst.wbc_n) {
                            var msg = `${Key} in return.`;
                            if (notes) {
                                notes = `${msg}\n\n${notes}`;
                            } else {
                                notes = msg;
                            }
                        }
                    }
                    Callback(success, notes);
                });
            }
        }
    }

    function checkWBCUser(WBC, wbc, username, Callback) {
        let match;
        if (!WBC.Canceled) {
            if (WBC.manualSkip) {
                Callback();
            } else {
                if (esgst.wbc_clearCache) {
                    wbc = null;
                }
                if (!wbc) {
                    wbc = {
                        lastCheck: 0,
                        timestamp: 0
                    };
                }
                if (wbc.giveaway) {
                    match = wbc.giveaway.match(/\/giveaway\/(.+?)\//);
                    if (match) {
                        delete wbc.giveaway;
                        wbc.ga = match[1];
                    }
                }
                if (wbc.whitelistGiveaway) {
                    match = wbc.whitelistGiveaway.match(/\/giveaway\/(.+?)\//);
                    if (match) {
                        delete wbc.whitelistGiveaway;
                        wbc.wl_ga = match[1];
                    }
                }
                if (wbc.groupGiveaways) {
                    let key;
                    for (key in wbc.groupGiveaways) {
                        match = key.match(/^(.+?)\//);
                        if (match) {
                            if (!wbc.g_wl_gas) {
                                wbc.g_wl_gas = {};
                            }
                            wbc.g_wl_gas[match[1]] = wbc.groupGiveaways[key];
                            delete wbc.groupGiveaways[key];
                        }
                    }
                    if (Object.keys(wbc.groupGiveaways).length === 0) {
                        delete wbc.groupGiveaways;
                    }
                }
                if (((Date.now() - wbc.lastCheck) > 86400000) || WBC.Update) {
                    if (((esgst.wbc_checkWhitelist || !WBC.B) && (wbc.wl_ga || wbc.g_wl_ga)) || (!esgst.wbc_checkWhitelist && WBC.B && wbc.ga)) {
                        WBC.Timestamp = wbc.timestamp;
                        checkWBCGiveaway(WBC, wbc, username, Callback);
                    } else {
                        WBC.Timestamp = 0;
                        WBC.GroupGiveaways = [];
                        match = location.href.match(new RegExp(`\/user\/${username}(\/search\?page=(\d+))?`));
                        getWBCGiveaways(WBC, wbc, username, 1, match ? (match[2] ? parseInt(match[2]) : 1) : 0, `/user/${username}/search?page=`, Callback);
                    }
                } else {
                    Callback(wbc);
                }
            }
        }
    }

    function checkWBCGiveaway(WBC, wbc, username, Callback) {
        if (!WBC.Canceled) {
            request(null, null, `GET`, true, `/giveaway/${wbc.wl_ga || wbc.g_wl_ga || wbc.ga}/`, function (Response) {
                var responseHtml = parseHtml(Response.responseText);
                var errorMessage = responseHtml.getElementsByClassName(`table--summary`)[0];
                var stop;
                if (errorMessage) {
                    errorMessage = errorMessage.textContent;
                    if (errorMessage.match(/blacklisted the giveaway creator/)) {
                        wbc.result = `notBlacklisted`;
                        stop = true;
                    } else if (errorMessage.match(/blacklisted by the giveaway creator/)) {
                        wbc.result = `blacklisted`;
                    } else if (errorMessage.match(/not a member of the giveaway creator's whitelist/)) {
                        wbc.result = `none`;
                    } else {
                        wbc.result = `notBlacklisted`;
                    }
                    wbc.lastCheck = Date.now();
                    wbc.timestamp = WBC.Timestamp;
                    Callback(wbc, stop);
                } else if (wbc.wl_ga) {
                    wbc.result = `whitelisted`;
                    wbc.lastCheck = Date.now();
                    wbc.timestamp = WBC.Timestamp;
                    Callback(wbc, stop);
                } else if (wbc.g_wl_ga) {
                    let found, groups, i, j, n;
                    found = false;
                    getValue(`groups`, `[]`).then(value => {
                        groups = JSON.parse(value);
                        for (i = 0, n = wbc.g_wl_gas[wbc.g_wl_ga].length; i < n && !found; ++i) {
                            for (j = groups.length - 1; j > -1 && groups[j].code !== wbc.g_wl_gas[wbc.g_wl_ga][i]; --j);
                            if (j > -1 && groups[j].member) {
                                found = true;
                            }
                        }
                        if (found) {
                            WBC.Timestamp = 0;
                            WBC.GroupGiveaways = [];
                            let match = location.href.match(new RegExp(`\/user\/${username}(\/search\?page=(\d+))?`));
                            getWBCGiveaways(WBC, wbc, username, 1, match ? (match[2] ? parseInt(match[2]) : 1) : 0, `/user/${username}/search?page=`, Callback);
                        } else {
                            wbc.result = `whitelisted`;
                            wbc.lastCheck = Date.now();
                            wbc.timestamp = WBC.Timestamp;
                            Callback(wbc, stop);
                        }
                    });
                } else {
                    wbc.result = `notBlacklisted`;
                    wbc.lastCheck = Date.now();
                    wbc.timestamp = WBC.Timestamp;
                    Callback(wbc, stop);
                }
            });
        }
    }

    function getWBCGiveaways(WBC, wbc, username, NextPage, CurrentPage, URL, Callback, Context) {
        var Giveaway, Pagination;
        if (!WBC.Canceled) {
            if (!esgst.wbc_skipUsers || NextPage - 1 <= esgst.wbc_pages) {
                if (WBC.manualSkip) {
                    Callback();
                } else {
                    if (Context) {
                        if (NextPage === 2) {
                            WBC.lastPage = getLastPage(Context, false, false, true);
                            WBC.lastPage = WBC.lastPage === 999999999 ? `` : ` of ${WBC.lastPage}`;
                        }
                        WBC.Progress.innerHTML = `
                            <i class="fa fa-circle-o-notch fa-spin"></i>
                            <span>Retrieving ${username}'s giveaways (page ${NextPage - 1}${WBC.lastPage})...</span>
                        `;
                        if (!wbc.ga) {
                            Giveaway = Context.querySelector(`[class="giveaway__heading__name"][href*="/giveaway/"]`);
                            wbc.ga = Giveaway ? Giveaway.getAttribute(`href`).match(/\/giveaway\/(.+?)\//)[1] : null;
                        }
                        Pagination = Context.getElementsByClassName(`pagination__navigation`)[0];
                        Giveaway = Context.getElementsByClassName(`giveaway__summary`)[0];
                        if (Giveaway && (WBC.Timestamp === 0)) {
                            WBC.Timestamp = parseInt(Giveaway.querySelector(`[data-timestamp]`).getAttribute(`data-timestamp`));
                            if (WBC.Timestamp >= (new Date().getTime())) {
                                WBC.Timestamp = 0;
                            }
                        }
                        if (wbc.ga) {
                            checkWBCGiveaway(WBC, wbc, username, function (wbc, stop) {
                                var WhitelistGiveaways, I, N, GroupGiveaway;
                                if ((wbc.result === `notBlacklisted`) && !stop && (esgst.wbc_checkWhitelist || !WBC.B)) {
                                    WhitelistGiveaways = Context.getElementsByClassName(`giveaway__column--whitelist`);
                                    for (I = 0, N = WhitelistGiveaways.length; (I < N) && !wbc.wl_ga; ++I) {
                                        GroupGiveaway = WhitelistGiveaways[I].parentElement.getElementsByClassName(`giveaway__column--group`)[0];
                                        if (GroupGiveaway) {
                                            WBC.GroupGiveaways.push(GroupGiveaway.getAttribute(`href`).match(/\/giveaway\/(.+?)\//)[1]);
                                        } else {
                                            wbc.wl_ga = WhitelistGiveaways[I].closest(`.giveaway__summary`).getElementsByClassName(`giveaway__heading__name`)[0].getAttribute(`href`).match(/\/giveaway\/(.+?)\//)[1];
                                        }
                                    }
                                    if (wbc.wl_ga) {
                                        checkWBCGiveaway(WBC, wbc, username, Callback);
                                    } else if (((WBC.Timestamp >= wbc.timestamp) || (WBC.Timestamp === 0)) && Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                                        setTimeout(getWBCGiveaways, 0, WBC, wbc, username, NextPage, CurrentPage, URL, Callback);
                                    } else if ((wbc.g_wl_gas && Object.keys(wbc.g_wl_gas).length) || WBC.GroupGiveaways.length) {
                                        getWBCGroupGiveaways(WBC, 0, WBC.GroupGiveaways.length, wbc, username, function (wbc, Result) {
                                            var Groups, GroupGiveaways, Found, J, NumGroups;
                                            if (wbc) {
                                                if (Result) {
                                                    Callback(wbc);
                                                } else {
                                                    getValue(`groups`, `[]`).then(value => {
                                                        Groups = JSON.parse(value);
                                                        for (GroupGiveaway in wbc.g_wl_gas) {
                                                            Found = false;
                                                            GroupGiveaways = wbc.g_wl_gas[GroupGiveaway];
                                                            for (I = 0, N = GroupGiveaways.length; (I < N) && !Found; ++I) {
                                                                var i;
                                                                for (i = Groups.length - 1; i >= 0 && Groups[i].code !== GroupGiveaways[I]; --i);
                                                                if (i >= 0 && Groups[i].member) {
                                                                    Found = true;
                                                                }
                                                            }
                                                            if (!Found) {
                                                                wbc.g_wl_ga = GroupGiveaway;
                                                                break;
                                                            }
                                                        }
                                                        if (Found) {
                                                            Callback(wbc);
                                                        } else {
                                                            wbc.result = `whitelisted`;
                                                            Callback(wbc);
                                                        }
                                                    });
                                                }
                                            } else {
                                                Callback();
                                            }
                                        });
                                    } else {
                                        Callback(wbc);
                                    }
                                } else {
                                    Callback(wbc);
                                }
                            });
                        } else if (((WBC.Timestamp >= wbc.timestamp) || (WBC.Timestamp === 0)) && Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                            setTimeout(getWBCGiveaways, 0, WBC, wbc, username, NextPage, CurrentPage, URL, Callback);
                        } else {
                            wbc.result = `unknown`;
                            wbc.lastCheck = Date.now();
                            wbc.timestamp = WBC.Timestamp;
                            Callback(wbc);
                        }
                    } else if (!WBC.Canceled) {
                        if (CurrentPage != NextPage) {
                            request(null, null, `GET`, true, URL + NextPage, function (Response) {
                                if (Response.finalUrl.match(/\/user\//)) {
                                    setTimeout(getWBCGiveaways, 0, WBC, wbc, username, ++NextPage, CurrentPage, URL, Callback, parseHtml(Response.responseText));
                                } else {
                                    wbc.result = `unknown`;
                                    wbc.lastCheck = Date.now();
                                    wbc.timestamp = WBC.Timestamp;
                                    Callback(wbc);
                                }
                            });
                        } else {
                            setTimeout(getWBCGiveaways, 0, WBC, wbc, username, ++NextPage, CurrentPage, URL, Callback, document);
                        }
                    }
                }
            } else {
                Callback();
            }
        }
    }

    function getWBCGroupGiveaways(WBC, I, N, wbc, username, callback) {
        if (!WBC.Canceled) {
            if (I < N) {
                if (WBC.manualSkip) {
                    callback();
                } else {
                    WBC.Progress.innerHTML = `
                        <i class="fa fa-circle-o-notch"></i>
                        <span>Retrieving ${username}'s group giveaways (${I - 1} of ${N})...</span>
                    `;
                    if (wbc.groupGiveaways && wbc.groupGiveaways[WBC.GroupGiveaways[I]]) {
                        setTimeout(getWBCGroupGiveaways, 0, WBC, ++I, N, wbc, username, callback);
                    } else {
                        getWBCGroups(WBC, `/giveaway/${WBC.GroupGiveaways[I]}/_/groups/search?page=`, 1, wbc, username, function (wbc, Result) {
                            if (wbc) {
                                if (Result) {
                                    callback(wbc, Result);
                                } else {
                                    setTimeout(getWBCGroupGiveaways, 0, WBC, ++I, N, wbc, username, callback);
                                }
                            } else {
                                callback();
                            }
                        });
                    }
                }
            } else {
                callback(wbc);
            }
        }
    }

    function getWBCGroups(WBC, URL, NextPage, wbc, username, Callback) {
        if (!WBC.Canceled) {
            if (WBC.manualSkip) {
                Callback();
            } else {
                request(null, null, `GET`, true, URL + NextPage, function (Response) {
                    var ResponseText, ResponseHTML, Groups, N, GroupGiveaway, I, Group, Pagination;
                    ResponseText = Response.responseText;
                    ResponseHTML = parseHtml(ResponseText);
                    Groups = ResponseHTML.getElementsByClassName(`table__column__heading`);
                    N = Groups.length;
                    if (N > 0) {
                        if (!wbc.g_wl_gas) {
                            wbc.g_wl_gas = {};
                        }
                        GroupGiveaway = URL.match(/\/giveaway\/(.+?)\//)[1];
                        if (!wbc.g_wl_gas[GroupGiveaway]) {
                            wbc.g_wl_gas[GroupGiveaway] = [];
                        }
                        for (I = 0; I < N; ++I) {
                            Group = Groups[I].getAttribute(`href`).match(/\/group\/(.+?)\//)[1];
                            if (wbc.g_wl_gas[GroupGiveaway].indexOf(Group) < 0) {
                                wbc.g_wl_gas[GroupGiveaway].push(Group);
                            }
                        }
                        Pagination = ResponseHTML.getElementsByClassName(`pagination__navigation`)[0];
                        if (Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                            setTimeout(getWBCGroups, 0, WBC, NextPage === 1 ? `${Response.finalUrl}/search?page=` : URL, ++NextPage, wbc, username, Callback);
                        } else {
                            Callback(wbc);
                        }
                    } else {
                        wbc.result = `none`;
                        Callback(wbc, true);
                    }
                });
            }
        }
    }

    function getWBCUsers(WBC, NextPage, CurrentPage, URL, Callback, Context) {
        var Matches, I, N, Match, Username, Pagination;
        if (!WBC.Canceled) {
            if (Context) {
                if (NextPage === 2) {
                    WBC.lastPage = getLastPage(Context, true);
                    WBC.lastPage = WBC.lastPage === 999999999 ? `` : ` of ${WBC.lastPage}`;
                }
                WBC.Progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Retrieving users (page ${NextPage - 1}${WBC.lastPage})...</span>
                `;
                Matches = Context.querySelectorAll(`a[href*="/user/"]`);
                for (I = 0, N = Matches.length; I < N; ++I) {
                    Match = Matches[I].getAttribute(`href`).match(/\/user\/(.+)/);
                    if (Match) {
                        Username = Match[1];
                        if ((WBC.Users.indexOf(Username) < 0) && (Username != WBC.Username) && (Username === Matches[I].textContent) && !Matches[I].closest(`.markdown`)) {
                            WBC.Users.push(Username);
                        }
                    }
                }
                Pagination = Context.getElementsByClassName(`pagination__navigation`)[0];
                if (Pagination && !Pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(getWBCUsers, 0, WBC, NextPage, CurrentPage, URL, Callback);
                } else {
                    Callback();
                }
            } else if (!WBC.Canceled) {
                if (CurrentPage != NextPage) {
                    request(null, null, `GET`, true, URL + NextPage, function (Response) {
                        setTimeout(getWBCUsers, 0, WBC, ++NextPage, CurrentPage, URL, Callback, parseHtml(Response.responseText));
                    });
                } else {
                    setTimeout(getWBCUsers, 0, WBC, ++NextPage, CurrentPage, URL, Callback, document);
                }
            }
        }
    }

    /* [WBS] Whitelist/Blacklist Sorter */

    function addWbsButton(dateKey, key, saveKey, sortAscButton, sortDescButton) {
        sortAscButton.addEventListener(`click`, function () {
                sortWbsList(true, dateKey, `fa-sort-amount-asc`, key, saveKey, `Oldest to newest ${saveKey} users:`);
        });
        sortDescButton.addEventListener(`click`, function () {
                sortWbsList(false, dateKey, `fa-sort-amount-desc`, key, saveKey, `Newest to oldest ${saveKey} users:`);
        });
    }

    function sortWbsList(asc, dateKey, icon, key, saveKey, title) {
        var i, n, popup, row, rows, savedUsers, steamId, table, user, users;
        users = [];
        getValue(`users`).then(value => {
            savedUsers = JSON.parse(value).users;
            for (steamId in savedUsers) {
                if (savedUsers[steamId][saveKey]) {
                    users.push({
                        steamId: steamId,
                        user: savedUsers[steamId]
                    });
                }
            }
            users.sort(function (a, b) {
                if (a.user[dateKey] < b.user[dateKey]) {
                    if (asc) {
                        return -1;
                    } else {
                        return 1;
                    }
                } else if (a.user[dateKey] > b.user[dateKey]) {
                    if (asc) {
                        return 1;
                    } else {
                        return -1;
                    }
                } else {
                    return 0;
                }
            });
            popup = new Popup(icon, title, true);
            popup.popup.classList.add(`esgst-wbs-popup`);
            table = insertHtml(popup.scrollable, `beforeEnd`, `
                <div class="esgst-text-left table">
                    <div class="table__heading">
                    <div class="table__column--width-fill">User</div>
                    <div class="table__column--width-small text-center">Added</div>
                        <div class="table__column--width-small text-center">Remove</div>
                    </div>
                    <div class="table__rows"></div>
                </div>
            `);
            rows = table.lastElementChild;
            for (i = 0, n = users.length; i < n; ++i) {
                user = users[i].user;
                steamId = users[i].steamId;
                row = insertHtml(rows, `beforeEnd`, `
                    <div class="table__row-outer-wrap">
                        <div class="table__row-inner-wrap">
                            <div class="table__column--width-fill">
                                <a class="table__column__heading" href="/user/${user.username}">${user.username}</a>
                            </div>
                            <div class="table__column--width-small text-center">${getTimestamp(user[dateKey] / 1e3)}</div>
                            <div class="table__column--width-small text-center">
                                <div class="table__remove-default esgst-clickable">
                                    <i class="icon-red fa fa-times-circle"></i>
                                    <span class="table__column__secondary-link">Remove</span>
                                </div>
                                <div class="table__remove-loading esgst-hidden">
                                    <i class="fa fa-refresh fa-spin"></i> Removing...
                                </div>
                                <div class="table__remove-complete esgst-hidden">
                                    <i class="fa fa-times-circle"></i> Removed
                                </div>
                            </div>
                        </div>
                    </div>
                `);
                setWbsRemove(dateKey, key, row, saveKey, steamId, user);
            }
            loadEndlessFeatures(table).then(() => popup.open());
        });
    }

    function setWbsRemove(dateKey, key, row, saveKey, steamId, user) {
        var removeButton, removedButton, removingButton, savedUsers;
        removeButton = row.firstElementChild.lastElementChild.firstElementChild;
        removingButton = removeButton.nextElementSibling;
        removedButton = removingButton.nextElementSibling;
        removeButton.addEventListener(`click`, function () {
            removeButton.classList.add(`esgst-hidden`);
            removingButton.classList.remove(`esgst-hidden`);
            request(`xsrf_token=${esgst.xsrfToken}&do=${key}&action=delete&child_user_id=${user.id}`, null, `POST`, false, `/ajax.php`, function () {
                createLock(`userLock`, 300, function (deleteLock) {
                    getValue(`users`).then(value => {
                        savedUsers = JSON.parse(value);
                        delete savedUsers.users[steamId][saveKey];
                        delete savedUsers.users[steamId][dateKey];
                        return setValue(`users`, JSON.stringify(savedUsers));
                    }).then(() => {
                        removingButton.classList.add(`esgst-hidden`);
                        removedButton.classList.remove(`esgst-hidden`);
                    });
                });
            });
        });
    }

    /* [WBM] Whitelist/Blacklist Manager */

    function openWbmPopup(wbm) {
        if (!wbm.popup) {
            wbm.popup = new Popup(`fa-gear`, `Manage ${wbm.name}:`);
            new ToggleSwitch(wbm.popup.description, `wbm_useCache`, false, `Use cache.`, false, false, `Uses the cache created the last time you synced your whitelist/blacklist. This speeds up the process, but could lead to incomplete results if your cache isn't up-to-date.`, esgst.wbm_useCache);
            new ToggleSwitch(wbm.popup.description, `wbm_clearTags`, false, `Only clear users who are tagged with these specific tags (separate with comma): <input class="esgst-switch-input esgst-switch-input-large" type="text" value="${esgst.wbm_tags.join(`, `)}">`, false, false, `Uses the User Tags database to remove only users with the specified tags.`, esgst.wbm_clearTags).name.firstElementChild.addEventListener(`change`, event => {
                let tags = event.currentTarget.value.replace(/(,\s*)+/g, formatTags).split(`, `);
                setSetting(`wbm_tags`, tags);
                esgst.wbm_tags = tags;
            });
            wbm.input = insertHtml(wbm.popup.description, `beforeEnd`, `<input type="file"/>`);
            wbm.message = insertHtml(wbm.popup.description, `beforeEnd`, `<div class="esgst-description"></div>`);
            wbm.warning = insertHtml(wbm.popup.description, `beforeEnd`, `<div class="esgst-description esgst-warning"></div>`);
            wbm.popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-arrow-up`, `fa-times`, `Import`, `Cancel`, startWbmProcess.bind(null, wbm, importWbmList.bind(null, wbm)), cancelWbmProcess.bind(null, wbm)).set);
            wbm.popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-arrow-down`, `fa-times`, `Export`, `Cancel`, startWbmProcess.bind(null, wbm, exportWbmList.bind(null, wbm, [], 1)), cancelWbmProcess.bind(null, wbm)).set);
            wbm.popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-trash`, `fa-times`, `Clear`, `Cancel`, startWbmProcess.bind(null, wbm, clearWbmList.bind(null, wbm, [], 1)), cancelWbmProcess.bind(null, wbm)).set);
            wbm.results = insertHtml(wbm.popup.scrollable,  `beforeEnd`, `<div></div>`);
        }
        wbm.popup.open();
    }

    function startWbmProcess(wbm, callback, mainCallback) {
        createConfirmation(`Are you sure you want to do this?`, () => {
            wbm.isCanceled = false;
            wbm.button.classList.add(`esgst-busy`);
            wbm.usernames = [];
            wbm.results.innerHTML = ``;
            callback(completeWbmProcess.bind(null, wbm, mainCallback));
        }, mainCallback);
    }

    function completeWbmProcess(wbm, callback) {
        wbm.button.classList.remove(`esgst-busy`);
        callback();
    }

    function cancelWbmProcess(wbm) {
        wbm.isCanceled = true;
        wbm.button.classList.remove(`esgst-busy`);
    }

    function importWbmList(wbm, callback) {
        let file = wbm.input.files[0];
        if (file) {
            let reader = new FileReader();
            reader.readAsText(file);
            reader.onload = () => {
                try {
                    let list = JSON.parse(reader.result);
                    insertWbmUsers(wbm, list, 0, list.length, callback);
                } catch (error) {
                    createFadeMessage(wbm.warning, `Cannot parse file!`);
                    callback();
                }
            };
        } else {
            createFadeMessage(wbm.warning, `No file was loaded!`);
            callback();
        }
    }

    function insertWbmUsers(wbm, list, i, n, callback) {
        if (!wbm.isCanceled) {
            wbm.message.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Importing list (${i} of ${n})...</span>
            `;
            if (i < n) {
                request(`xsrf_token=${esgst.xsrfToken}&do=${wbm.key}&action=insert&child_user_id=${list[i]}`, null, `POST`, false, `/ajax.php`, setTimeout.bind(null, insertWbmUsers, 0, wbm, list, ++i, n, callback));
            } else {
                createFadeMessage(wbm.message, `List imported with success!`);
                callback();
            }
        }
    }

    function exportWbmList(wbm, list, nextPage, callback) {
        if (!wbm.isCanceled) {
            if (esgst.wbm_useCache) {
                let file, steamId, url;
                for (steamId in esgst.users.users) {
                    if (esgst.users.users[steamId][`${wbm.key}ed`]) {
                        list.push(esgst.users.users[steamId].id);
                    }
                }
                url = URL.createObjectURL(new Blob([JSON.stringify(list)]));
                file = document.createElement(`a`);
                file.download = `esgst_${wbm.key}_${new Date().toISOString()}.json`;
                file.href = url;
                document.body.appendChild(file);
                file.click();
                file.remove();
                URL.revokeObjectURL(url);
                createFadeMessage(wbm.message, `List exported with success!`);
                callback();
            } else {
                wbm.message.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Retrieving list (page ${nextPage})...</span>
                `;
                request(null, null, `GET`, false, `https://www.steamgifts.com/account/manage/${wbm.key}/search?page=${nextPage}`, response => {
                    let elements, i, n, pagination, responseHtml;
                    responseHtml = parseHtml(response.responseText);
                    elements = responseHtml.querySelectorAll(`[name="child_user_id"]`);
                    for (i = 0, n = elements.length; i < n; ++i) {
                        list.push(elements[i].value);
                    }
                    pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
                    if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                        setTimeout(exportWbmList, 0, wbm, list, ++nextPage, callback);
                    } else {
                        let file, url;
                        url = URL.createObjectURL(new Blob([JSON.stringify(list)]));
                        file = document.createElement(`a`);
                        file.download = `esgst_${wbm.key}_${new Date().toISOString()}.json`;
                        file.href = url;
                        document.body.appendChild(file);
                        file.click();
                        file.remove();
                        URL.revokeObjectURL(url);
                        createFadeMessage(wbm.message, `List exported with success!`);
                        callback();
                    }
                });
            }
        }
    }

    function clearWbmList(wbm, list, nextPage, callback) {
        if (!wbm.isCanceled) {
            if (esgst.wbm_useCache) {
                let steamId;
                for (steamId in esgst.users.users) {
                    let user = esgst.users.users[steamId];
                    if (user[`${wbm.key}ed`]) {
                        if (esgst.wbm_clearTags) {
                            if (user.tags) {
                                let i;
                                for (i = user.tags.length - 1; i > -1 && esgst.wbm_tags.indexOf(user.tags[i]) < 0; --i);
                                if (i > -1) {
                                    list.push(user.id);
                                    wbm.usernames.push(user.username);
                                }
                            }
                        } else {
                            list.push(user.id);
                        }
                    }
                }
                deleteWbmUsers(wbm, list, 0, list.length, callback);
            } else {
                wbm.message.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Retrieving list (page ${nextPage})...</span>
                `;
                request(null, null, `GET`, false, `https://www.steamgifts.com/account/manage/${wbm.key}/search?page=${nextPage}`, response => {
                    let element, elements, i, n, pagination, responseHtml;
                    responseHtml = parseHtml(response.responseText);
                    elements = responseHtml.querySelectorAll(`[name="child_user_id"]`);
                    for (i = 0, n = elements.length; i < n; ++i) {
                        element = elements[i];
                        if (esgst.wbm_clearTags) {
                            let steamId, username;
                            username = element.closest(`.table__row-inner-wrap`).getElementsByClassName(`table__column__heading`)[0].textContent;
                            steamId = esgst.users.steamIds[username];
                            if (steamId) {
                                let user = esgst.users.users[steamId];
                                if (user.tags) {
                                    let j;
                                    for (j = user.tags.length - 1; j > -1 && esgst.wbm_tags.indexOf(user.tags[j]) < 0; --j);
                                    if (j > -1) {
                                        list.push(element.value);
                                        wbm.usernames.push(username);
                                    }
                                }
                            }
                        } else {
                            list.push(element.value);
                        }
                    }
                    pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
                    if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                        setTimeout(clearWbmList, 0, wbm, list, ++nextPage, callback);
                    } else {
                        deleteWbmUsers(wbm, list, 0, list.length, callback);
                    }
                });
            }
        }
    }

    function deleteWbmUsers(wbm, list, i, n, callback) {
        if (!wbm.isCanceled) {
            wbm.message.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Clearing list (${i} of ${n})...</span>
            `;
            if (i < n) {
                request(`xsrf_token=${esgst.xsrfToken}&do=${wbm.key}&action=delete&child_user_id=${list[i]}`, null, `POST`, false, `/ajax.php`, setTimeout.bind(null, deleteWbmUsers, 0, wbm, list, ++i, n, callback));
            } else {
                createFadeMessage(wbm.message, `List cleared with success!`);
                wbm.results.innerHTML = `
                    <span class="esgst-bold">Users cleared (${wbm.usernames.length}):</span>
                    <span class="esgst-popup-actions"></span>
                `;
                wbm.usernames.forEach(username => {
                    wbm.results.lastElementChild.insertAdjacentHTML(`beforeEnd`, `<a href="/user/${username}">${username}</a>`);
                });
                callback();
            }
        }
    }

    /* [GLWC] Group Library/Wishlist Checker */

    function loadGlwc() {
        if (esgst.whitelistPath || esgst.blacklistPath || esgst.groupPath) {
            let parameters;
            if (esgst.whitelistPath) {
                parameters = `?url=account/manage/whitelist`;
            } else if (esgst.blacklistPath) {
                parameters = `?url=account/manage/blacklist`;
            } else {
                parameters = `?url=${location.pathname.match(/\/(group\/(.+?)\/(.+?))(\/.*)?$/)[1]}/users&id=${document.querySelector(`[href*="/gid/"]`).getAttribute(`href`).match(/\d+/)[0]}`;
            }
            let key, position;
            if (esgst.leftButtonIds.indexOf(`glwc`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            insertHtml(esgst.hideButtons && esgst.hideButtons_glwc ? esgst[key] : esgst.mainPageHeading, position, `
                <div class="esgst-heading-button" id="esgst-glwc" title="Check libraries/wishlists">
                    <i class="fa fa-folder"></i>
                    <i class="fa fa-star"></i>
                </div>
            `).addEventListener(`click`, () => {
                open(`/esgst/glwc${parameters}`);
            });
        } else if (esgst.glwcPath) {
            let glwc = {}, parameters;
            glwc.context = document.body.firstElementChild.nextElementSibling.firstElementChild;
            glwc.progress = insertHtml(glwc.context, `beforeEnd`, `<div></div>`);
            glwc.overallProgress = insertHtml(glwc.context, `beforeEnd`, `<div></div>`);
            parameters = getParameters();
            glwc.id = parameters.id;
            glwc.url = parameters.url;
            glwc.users = [];
            glwc.games = {};
            if (glwc.id) {
                glwc.overallProgress.textContent = `Preparing...`;
                request(null, null, `GET`, false, `http://steamcommunity.com/gid/${glwc.id}/memberslistxml?xml=1`, response => {
                    glwc.members = [];
                    members = response.responseText.match(/<steamID64>.+?<\/steamID64>/g);
                    members.forEach(member => {
                        glwc.members.push(member.match(/<steamID64>(.+?)<\/steamID64>/)[1]);
                    });
                    glwc.overallProgress.textContent = `Step 1 of 3`;
                    getGlwcUsers(glwc, 1);
                });
            } else {
                glwc.overallProgress.textContent = `Step 1 of 3`;
                getGlwcUsers(glwc, 1);
            }
        }
    }

    function getGlwcUsers(glwc, nextPage) {
        if (!glwc.isCanceled) {
            glwc.progress.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
                <span>Retrieving users (page ${nextPage})...</span>
            `;
            request(null, null, `GET`, false, `/${glwc.url}/search?page=${nextPage}`, response => {
                let elements, i, n, pagination, responseHtml;
                responseHtml = parseHtml(response.responseText);
                elements = responseHtml.querySelectorAll(`.table__row-inner-wrap:not(.is-faded)`);
                for (i = 0, n = elements.length; i < n; ++i) {
                    glwc.users.push({
                        username: elements[i].getElementsByClassName(`table__column__heading`)[0].textContent
                    });
                }
                pagination = responseHtml.getElementsByClassName(`pagination__navigation`)[0];
                if (pagination && !pagination.lastElementChild.classList.contains(`is-selected`)) {
                    setTimeout(getGlwcUsers, 0, glwc, ++nextPage);
                } else {
                    glwc.overallProgress.textContent = `Step 2 of 3`;
                    getGlwcSteamIds(glwc, 0, glwc.users.length);
                }
            });
        }
    }

    function getGlwcSteamIds(glwc, i, n) {
        if (!glwc.isCanceled) {
            if (i < n) {
                glwc.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Retrieving Steam ids (${i + 1} of ${n})...</span>
                `;
                let steamId = esgst.users.steamIds[glwc.users[i].username];
                if (steamId) {
                    glwc.users[i].steamId = steamId;
                    setTimeout(getGlwcSteamIds, 0, glwc, ++i, n);
                } else {
                    request(null, null, `GET`, false, `/user/${glwc.users[i].username}`, response => {
                        glwc.users[i].steamId = parseHtml(response.responseText).querySelector(`[href*="/profiles/"]`).getAttribute(`href`).match(/\d+/)[0];
                        setTimeout(getGlwcSteamIds, 0, glwc, ++i, n);
                    });
                }
            } else {
                glwc.overallProgress.textContent = `Step 3 of 3 (this might take a while)`;
                glwc.memberCount = 0;
                getGlwcGames(glwc, 0, glwc.users.length);
            }
        }
    }

    function getGlwcGames(glwc, i, n) {
        if (!glwc.isCanceled) {
            if (i < n) {
                glwc.progress.innerHTML = `
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Retrieving libraries/wishlists (${i + 1} of ${n})...</span>
                `;
                if (!glwc.id || glwc.members.indexOf(glwc.users[i].steamId) >= 0) {
                    request(null, null, `GET`, false, `http://api.steampowered.com/IPlayerService/GetOwnedGames/v0001/?key=${esgst.steamApiKey}&steamid=${glwc.users[i].steamId}&format=json`, response => {
                        let game, element, elements, j;
                        try {
                            glwc.users[i].library = [];
                            elements = JSON.parse(response.responseText).response.games;
                            if (elements) {
                                elements.forEach(element => {
                                    game = {
                                        id: element.appid,
                                        logo: `https://steamcdn-a.akamaihd.net/steam/apps/${element.appid}/header.jpg`,
                                        name: `${element.appid}`
                                    };
                                    if (!glwc.games[game.id]) {
                                        game.libraries = [];
                                        game.wishlists = [];
                                        glwc.games[game.id] = game;
                                    }
                                    glwc.games[game.id].libraries.push(i);
                                    glwc.users[i].library.push(game.id);
                                });
                            }
                        } catch (e) {}
                        request(null, null, `GET`, false, `http://steamcommunity.com/profiles/${glwc.users[i].steamId}/wishlist/`, response => {
                            glwc.users[i].wishlist = [];
                            elements = parseHtml(response.responseText).querySelectorAll(`.gameListRow, .wishlistRow`);
                            for (j = elements.length - 1; j > -1; --j) {
                                element = elements[j];
                                game = {
                                    id: element.id.match(/^game_(.+)/)[1],
                                    logo: element.getElementsByClassName(`gameListRowLogo`)[0].firstElementChild.firstElementChild.getAttribute(`src`),
                                    name: element.getElementsByClassName(`ellipsis`)[0].textContent,
                                };
                                if (glwc.games[game.id]) {
                                    glwc.games[game.id].logo = game.logo;
                                    glwc.games[game.id].name = game.name;
                                } else {
                                    game.libraries = [];
                                    game.wishlists = [];
                                    glwc.games[game.id] = game;
                                }
                                glwc.games[game.id].wishlists.push(i);
                                glwc.users[i].wishlist.push(parseInt(game.id));
                            }
                            glwc.memberCount += 1;
                            setTimeout(getGlwcGames, 0, glwc, ++i, n);
                        });
                    });
                } else {
                    setTimeout(getGlwcGames, 0, glwc, ++i, n);
                }
            } else {
                showGlwcResults(glwc);
            }
        }
    }

    function showGlwcResults(glwc) {
        let game, i, id, j, library, libraryInput, libraryResults, librarySearch, n, user, users, wishlist, wishlistInput, wishlistResults, wishlistSearch;
        glwc.context.classList.add(`esgst-glwc-results`);
        glwc.context.innerHTML = `
            <div>
                <div class="esgst-glwc-heading">Libraries</div>
                <input placeholder="Search by game name or app id..." type="text"/>
                <div class="table">
                    <div class="table__heading">
                        <div class="table__column--width-small text-center">Rank</div>
                        <div class="table__column--width-fill">Game</div>
                        <div class="table__column--width-small text-center">Libraries</div>
                    </div>
                    <div class="table__rows"></div>
                    <div class="table__rows"></div>
                </div>
            </div>
            <div>
                <div class="esgst-glwc-heading">Wishlists</div>
                <input placeholder="Search by game name or app id..." type="text"/>
                <div class="table">
                    <div class="table__heading">
                        <div class="table__column--width-small text-center">Rank</div>
                        <div class="table__column--width-fill">Game</div>
                        <div class="table__column--width-small text-center">Wishlists</div>
                    </div>
                    <div class="table__rows"></div>
                    <div class="table__rows"></div>
                </div>
            </div>
        `;
        libraryInput = glwc.context.firstElementChild.firstElementChild.nextElementSibling;
        libraryResults = libraryInput.nextElementSibling.lastElementChild;
        librarySearch = libraryResults.previousElementSibling;
        wishlistInput = glwc.context.lastElementChild.firstElementChild.nextElementSibling;
        wishlistResults = wishlistInput.nextElementSibling.lastElementChild;
        wishlistSearch = wishlistResults.previousElementSibling;
        library = [];
        wishlist = [];
        for (id in glwc.games) {
            if (glwc.games[id].libraries.length) {
                library.push(glwc.games[id]);
            }
            if (glwc.games[id].wishlists.length) {
                wishlist.push(glwc.games[id]);
            }
        }
        if (library.length > 0) {
            library = library.sort((a, b) => {
                if (a.libraries.length > b.libraries.length) {
                    return -1;
                } else if (a.libraries.length < b.libraries.length) {
                    return 1;
                } else {
                    return 0;
                }
            });
            for (i = 0, n = library.length; i < 100 && i < n; ++i) {
                game = library[i];
                if (i <= 0 || game.libraries.length !== library[i - 1].libraries.length) {
                    j = i + 1;
                }
                users = [];
                game.libraries.forEach(k => {
                    user = glwc.users[k];
                    users.push(`<a href="http://steamcommunity.com/profiles/${user.steamId}/games?tab=all">${user.username}</a>`);
                });
                createTooltip(insertHtml(libraryResults, `beforeEnd`, `
                    <div class="table__row-outer-wrap">
                        <div class="table__row-inner-wrap">
                            <div class="table__column--width-small text-center">
                                <span class="table__column__rank">${j}.</span>
                            </div>
                            <div>
                                <div class="table_image_thumbnail" style="background-image:url(${game.logo});"></div>
                            </div>
                            <div class="table__column--width-fill">
                                <p class="table__column__heading">${game.name}</p>
                                <p>
                                    <a class="table__column__secondary-link" href="http://store.steampowered.com/app/${game.id}" rel="nofollow" target="_blank">http://store.steampowered.com/app/${game.id}</a>
                                </p>
                            </div>
                            <div class="table__column--width-small text-center">
                                <span class="table__column__secondary-link esgst-clickable">${game.libraries.length} (${Math.round(game.libraries.length / glwc.memberCount * 10000) / 100}%)</span>
                            </div>
                        </div>
                    </div>
                `).firstElementChild.lastElementChild.firstElementChild, users.join(`, `));
            }
        } else {
            libraryResults.innerHTML = `To get libraries data you must have a Steam API key set in the settings menu.`;
        }
        wishlist = wishlist.sort((a, b) => {
            if (a.wishlists.length > b.wishlists.length) {
                return -1;
            } else if (a.wishlists.length < b.wishlists.length) {
                return 1;
            } else {
                return 0;
            }
        });
        for (i = 0, n = wishlist.length; i < 100 && i < n; ++i) {
            game = wishlist[i];
            if (i <= 0 || game.wishlists.length !== wishlist[i - 1].wishlists.length) {
                j = i + 1;
            }
            users = [];
            game.wishlists.forEach(k => {
                user = glwc.users[k];
                users.push(`<a href="http://steamcommunity.com/profiles/${user.steamId}/wishlist">${user.username}</a>`);
            });
            createTooltip(insertHtml(wishlistResults, `beforeEnd`, `
                <div class="table__row-outer-wrap">
                    <div class="table__row-inner-wrap">
                        <div class="table__column--width-small text-center">
                            <span class="table__column__rank">${j}.</span>
                        </div>
                        <div>
                            <div class="table_image_thumbnail" style="background-image:url(${game.logo});"></div>
                        </div>
                        <div class="table__column--width-fill">
                            <p class="table__column__heading">${game.name}</p>
                            <p>
                                <a class="table__column__secondary-link" href="http://store.steampowered.com/app/${game.id}" rel="nofollow" target="_blank">http://store.steampowered.com/app/${game.id}</a>
                            </p>
                        </div>
                        <div class="table__column--width-small text-center">
                            <span class="table__column__secondary-link esgst-clickable">${game.wishlists.length} (${Math.round(game.wishlists.length / glwc.memberCount * 10000) / 100}%)</span>
                        </div>
                    </div>
                </div>
            `).firstElementChild.lastElementChild.firstElementChild, users.join(`, `));
        }
        libraryInput.addEventListener(`input`, () => {
            value = libraryInput.value.toLowerCase();
            if (value) {
                game = glwc.games[value];
                if (game) {
                    if (game.libraries.length) {
                        users = [];
                        game.libraries.forEach(k => {
                            user = glwc.users[k];
                            users.push(`<a href="http://steamcommunity.com/profiles/${user.steamId}/games?tab=all">${user.username}</a>`);
                        });
                        librarySearch.innerHTML = `
                            <div class="table__row-outer-wrap">
                                <div class="table__row-inner-wrap">
                                    <div class="table__column--width-small text-center">
                                        <span class="table__column__rank">-</span>
                                    </div>
                                    <div>
                                        <div class="table_image_thumbnail" style="background-image:url(${game.logo});"></div>
                                    </div>
                                    <div class="table__column--width-fill">
                                        <p class="table__column__heading">${game.name}</p>
                                        <p>
                                            <a class="table__column__secondary-link" href="http://store.steampowered.com/app/${game.id}" rel="nofollow" target="_blank">http://store.steampowered.com/app/${game.id}</a>
                                        </p>
                                    </div>
                                    <div class="table__column--width-small text-center">
                                        <span class="table__column__secondary-link esgst-clickable">${game.libraries.length} (${Math.round(game.libraries.length / glwc.memberCount * 10000) / 100}%)</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        createTooltip(librarySearch.firstElementChild.firstElementChild.lastElementChild.firstElementChild, users.join(`, `));
                    } else {
                        librarySearch.innerHTML = `Nothing found...`;
                    }
                } else {
                    librarySearch.innerHTML = ``;
                    for (i = 0, j = 0, n = library.length; j < 100 && i < n; ++i) {
                        game = library[i];
                        if (game.name.toLowerCase().match(value)) {
                            users = [];
                            game.libraries.forEach(k => {
                                user = glwc.users[k];
                                users.push(`<a href="http://steamcommunity.com/profiles/${user.steamId}/games?tab=all">${user.username}</a>`);
                            });
                            createTooltip(insertHtml(librarySearch, `beforeEnd`, `
                                <div class="table__row-outer-wrap">
                                    <div class="table__row-inner-wrap">
                                        <div class="table__column--width-small text-center">
                                            <span class="table__column__rank">-</span>
                                        </div>
                                        <div>
                                            <div class="table_image_thumbnail" style="background-image:url(${game.logo});"></div>
                                        </div>
                                        <div class="table__column--width-fill">
                                            <p class="table__column__heading">${game.name}</p>
                                            <p>
                                                <a class="table__column__secondary-link" href="http://store.steampowered.com/app/${game.id}" rel="nofollow" target="_blank">http://store.steampowered.com/app/${game.id}</a>
                                            </p>
                                        </div>
                                        <div class="table__column--width-small text-center">
                                            <span class="table__column__secondary-link esgst-clickable">${game.libraries.length} (${Math.round(game.libraries.length / glwc.memberCount * 10000) / 100}%)</span>
                                        </div>
                                    </div>
                                </div>
                            `).firstElementChild.lastElementChild.firstElementChild, users.join(`, `));
                            j += 1;
                        }
                    }
                    if (!librarySearch.innerHTML) {
                        librarySearch.innerHTML = `Nothing found...`;
                    }
                }
                librarySearch.classList.remove(`esgst-hidden`);
                libraryResults.classList.add(`esgst-hidden`);
            } else {
                libraryResults.classList.remove(`esgst-hidden`);
                librarySearch.classList.add(`esgst-hidden`);
            }
        });
        wishlistInput.addEventListener(`input`, () => {
            value = wishlistInput.value;
            if (value) {
                game = glwc.games[value];
                if (game) {
                    if (game.wishlists.length) {
                        game.wishlists.forEach(k => {
                            user = glwc.users[k];
                            users.push(`<a href="http://steamcommunity.com/profiles/${user.steamId}/wishlist">${user.username}</a>`);
                        });
                        wishlistSearch.innerHTML = `
                            <div class="table__row-outer-wrap">
                                <div class="table__row-inner-wrap">
                                    <div class="table__column--width-small text-center">
                                        <span class="table__column__rank">-</span>
                                    </div>
                                    <div>
                                        <div class="table_image_thumbnail" style="background-image:url(${game.logo});"></div>
                                    </div>
                                    <div class="table__column--width-fill">
                                        <p class="table__column__heading">${game.name}</p>
                                        <p>
                                            <a class="table__column__secondary-link" href="http://store.steampowered.com/app/${game.id}" rel="nofollow" target="_blank">http://store.steampowered.com/app/${game.id}</a>
                                        </p>
                                    </div>
                                    <div class="table__column--width-small text-center">
                                        <span class="table__column__secondary-link esgst-clickable">${game.wishlists.length} (${Math.round(game.wishlists.length / glwc.memberCount * 10000) / 100}%)</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        createTooltip(wishlistSearch.firstElementChild.firstElementChild.lastElementChild.firstElementChild, users.join(`, `));
                    } else {
                        wishlistSearch.innerHTML = `Nothing found...`;
                    }
                } else {
                    wishlistSearch.innerHTML = ``;
                    for (i = 0, j = 0, n = wishlist.length; j < 100 && i < n; ++i) {
                        game = wishlist[i];
                        if (game.name.toLowerCase().match(value)) {
                            users = [];
                            game.wishlists.forEach(k => {
                                user = glwc.users[k];
                                users.push(`<a href="http://steamcommunity.com/profiles/${user.steamId}/wishlists">${user.username}</a>`);
                            });
                            createTooltip(insertHtml(wishlistSearch, `beforeEnd`, `
                                <div class="table__row-outer-wrap">
                                    <div class="table__row-inner-wrap">
                                        <div class="table__column--width-small text-center">
                                            <span class="table__column__rank">-</span>
                                        </div>
                                        <div>
                                            <div class="table_image_thumbnail" style="background-image:url(${game.logo});"></div>
                                        </div>
                                        <div class="table__column--width-fill">
                                            <p class="table__column__heading">${game.name}</p>
                                            <p>
                                                <a class="table__column__secondary-link" href="http://store.steampowered.com/app/${game.id}" rel="nofollow" target="_blank">http://store.steampowered.com/app/${game.id}</a>
                                            </p>
                                        </div>
                                        <div class="table__column--width-small text-center">
                                            <span class="table__column__secondary-link esgst-clickable">${game.wishlists.length} (${Math.round(game.wishlists.length / glwc.memberCount * 10000) / 100}%)</span>
                                        </div>
                                    </div>
                                </div>
                            `).firstElementChild.lastElementChild.firstElementChild, users.join(`, `));
                            j += 1;
                        }
                    }
                    if (!wishlistSearch.innerHTML) {
                        wishlistSearch.innerHTML = `Nothing found...`;
                    }
                }
                wishlistSearch.classList.remove(`esgst-hidden`);
                wishlistResults.classList.add(`esgst-hidden`);
            } else {
                wishlistResults.classList.remove(`esgst-hidden`);
                wishlistSearch.classList.add(`esgst-hidden`);
            }
        });
    }

    /* [US] Users Stats */

    function getUsUsers(context, main) {
        var element, elements, i, n, us, username, users;
        if (main || context.closest(`.esgst-wbs-popup`)) {
            if (context === document || !main) {
                context.getElementsByClassName(`table__heading`)[0].firstElementChild.insertAdjacentHTML(`afterEnd`, `
                    <div class="table__column--width-small text-center">Last Online</div>
                    <div class="table__column--width-small text-center">Gifts Won</div>
                    <div class="table__column--width-small text-center">Gifts Sent</div>
                    <div class="table__column--width-small text-center">Ratio</div>
                    <div class="table__column--width-small text-center">Contributor Level</div>
                `);
            }
            users = {};
            elements = context.getElementsByClassName(`table__row-inner-wrap`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                users[element.getElementsByClassName(`table__column__heading`)[0].textContent] = (main && element.firstElementChild.nextElementSibling) || element.firstElementChild;
            }
            us = new CompletionCheck(Object.keys(users).length, sortTsTables);
            for (username in users) {
                request(null, null, `GET`, false, `/user/${username}`, loadUsStats.bind(null, users[username], us, username));
            }
        }
    }

    function loadUsStats(context, us, username, response) {
        var element, elements, html, i, n, profile;
        html = [];
        profile = {};
        elements = parseHtml(response.responseText).getElementsByClassName(`featured__table__row__left`);
        for (i = 0, n = elements.length; i < n; ++i) {
            element = elements[i];
            switch (element.textContent) {
                case `Last Online`:
                    html.push(`
                        <div class="table__column--width-small text-center">${element.nextElementSibling.innerHTML}</div>
                    `);
                    break;
                case `Gifts Won`:
                    profile.wonRow = element.parentElement;
                    profile.wonRowLeft = element;
                    profile.wonRowRight = element.nextElementSibling;
                    rows = JSON.parse(profile.wonRowRight.firstElementChild.firstElementChild.getAttribute(`data-ui-tooltip`)).rows;
                    profile.wonCount = parseInt(rows[0].columns[1].name.replace(/,/g, ``));
                    profile.wonFull = parseInt(rows[1].columns[1].name.replace(/,/g, ``));
                    profile.wonReduced = parseInt(rows[2].columns[1].name.replace(/,/g, ``));
                    profile.wonZero = parseInt(rows[3].columns[1].name.replace(/,/g, ``));
                    cvrow = profile.wonRowRight.firstElementChild.lastElementChild;
                    rows = JSON.parse(cvrow.getAttribute(`data-ui-tooltip`)).rows;
                    profile.wonCV = parseFloat(cvrow.textContent.replace(/\$|,/g, ``));
                    profile.realWonCV = parseFloat(rows[0].columns[1].name.replace(/\$|,/g, ``));
                    element.nextElementSibling.firstElementChild.firstElementChild.firstElementChild.removeAttribute(`style`);
                    html.push(`
                        <div class="table__column--width-small text-center">${element.nextElementSibling.innerHTML}</div>
                    `);
                    break;
                case `Gifts Sent`:
                    profile.sentRow = element.parentElement;
                    profile.sentRowLeft = element;
                    profile.sentRowRight = element.nextElementSibling;
                    rows = JSON.parse(profile.sentRowRight.firstElementChild.firstElementChild.getAttribute(`data-ui-tooltip`)).rows;
                    profile.sentCount = parseInt(rows[0].columns[1].name.replace(/,/g, ``));
                    profile.sentFull = parseInt(rows[1].columns[1].name.replace(/,/g, ``));
                    profile.sentReduced = parseInt(rows[2].columns[1].name.replace(/,/g, ``));
                    profile.sentZero = parseInt(rows[3].columns[1].name.replace(/,/g, ``));
                    profile.notSent = parseInt(rows[5].columns[1].name.replace(/,/g, ``));
                    cvrow = profile.sentRowRight.firstElementChild.lastElementChild;
                    rows = JSON.parse(cvrow.getAttribute(`data-ui-tooltip`)).rows;
                    profile.sentCV = parseFloat(cvrow.textContent.replace(/\$|,/g, ``));
                    profile.realSentCV = parseFloat(rows[0].columns[1].name.replace(/\$|,/g, ``));
                    element.nextElementSibling.firstElementChild.firstElementChild.firstElementChild.removeAttribute(`style`);
                    html.push(`
                        <div class="table__column--width-small text-center">${element.nextElementSibling.innerHTML}</div>
                    `);
                    break;
                case `Contributor Level`:
                    addSwrRatio(profile);
                    html.push(`
                        <div class="table__column--width-small text-center">${profile.sentRow.nextElementSibling.lastElementChild.innerHTML}</div>
                    `);
                    html.push(`
                        <div class="table__column--width-small text-center">${parseFloat(JSON.parse(element.nextElementSibling.firstElementChild.getAttribute(`data-ui-tooltip`)).rows[0].columns[1].name)}</div>
                    `);
                    break;
            }
        }
        context.insertAdjacentHTML(`afterEnd`, html.join(``));
        us.count += 1;
    }

    /* [IBH] Inbox Winners Highlighter */

    function getIwhUsers(context) {
        var className;
        var callback;
        if (esgst.winnersPath) {
            className = `table__gift-not-sent`;
            callback = setIWHObserver;
        } else {
            className = `comments__entity`;
            callback = highlightIWHWinner;
        }
        var matches = context.getElementsByClassName(className);
        for (var i = 0, n = matches.length; i < n; ++i) {
            callback(matches[i]);
        }
    }

    function setIWHObserver(Context) {
        var Key, Username;
        Key = location.pathname.match(/\/giveaway\/(.+?)\//)[1];
        Username = Context.closest(`.table__row-inner-wrap`).getElementsByClassName(`table__column__heading`)[0].querySelector(`a[href*="/user/"]`).textContent;
        Context.addEventListener(`click`, function () {
            var Winners;
            getValue(`winners`, `{}`).then(value => {
                Winners = JSON.parse(value);
                if (!Winners[Key]) {
                    Winners[Key] = [];
                }
                if (Winners[Key].indexOf(Username) < 0) {
                    Winners[Key].push(Username);
                }
                setValue(`winners`, JSON.stringify(Winners));
            });
        });
    }

    function highlightIWHWinner(Context) {
        var Match, Key, Winners, Matches, I, N, Username;
        Match = Context.firstElementChild.firstElementChild.getAttribute(`href`).match(/\/giveaway\/(.+?)\//);
        if (Match) {
            Key = Match[1];
            getValue(`winners`, `{}`).then(value => {
                Winners = JSON.parse(value);
                if (Winners[Key]) {
                    Matches = Context.nextElementSibling.children;
                    for (I = 0, N = Matches.length; I < N; ++I) {
                        Context = Matches[I].getElementsByClassName(`comment__username`)[0];
                        Username = Context.textContent;
                        if (Winners[Key].indexOf(Username) >= 0) {
                            Context.insertAdjacentHTML(`afterEnd`, `<i class="fa fa-trophy esgst-iwh-icon" title="This is the winner or one of the winners of this giveaway"></i>`);
                        }
                    }
                }
            });
        }
    }

    /* [GH] Groups Highlighter */

    function highlightGhGroups(context) {
        var code, element, elements, i, j, key, n, savedGroups;
        getValue(`groups`, `[]`).then(value => {
            savedGroups = JSON.parse(value);
            elements = context.querySelectorAll(`.table__column__heading[href*="/group/"]`);
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                code = element.getAttribute(`href`).match(/\/group\/(.+?)\//)[1];
                for (j = savedGroups.length - 1; j >= 0 && savedGroups[j].code !== code; --j);
                if (j >= 0 && savedGroups[j].member) {
                    element.closest(`.table__row-outer-wrap`).classList.add(`esgst-gh-highlight`);
                }
            }
        });
    }

    /* [GS] Group Stats */

    function getGsGroups(context) {
        elements = context.getElementsByClassName(`table__row-inner-wrap`);
        addGsStatus(elements, 0, elements.length);
    }

    function addGSHeading() {
        var Context;
        Context = document.getElementsByClassName(`table__heading`)[0];
        Context.insertAdjacentHTML(`beforeEnd`, `
            <div class="table__column--width-small text-center">Sent</div>
            <div class="table__column--width-small text-center">Received</div>
            <div class="table__column--width-small text-center">Gift Difference</div>
            <div class="table__column--width-small text-center">Value Difference</div>
        `);
    }

    function addGsStatus(groups, i, n) {
        var element, elements, group, j, numElements, responseHtml, url, username;
        if (i < n) {
            group = groups[i];
            url = `${group.getElementsByClassName(`table__column__heading`)[0].getAttribute(`href`)}/users/search?q=${esgst.username}`;
            request(null, null, `GET`, false, url, function (response) {
                var Matches, I, N;
                responseHtml = parseHtml(response.responseText);
                element = responseHtml.getElementsByClassName(`table__row-inner-wrap`)[0];
                if (element) {
                    username = element.getElementsByClassName(`table__column__heading`)[0].textContent;
                    if (username === esgst.username) {
                        elements = element.getElementsByClassName(`table__column--width-small`);
                        for (j = 0, numElements = elements.length; j < numElements; ++j) {
                            group.appendChild(elements[0]);
                        }
                        setTimeout(addGsStatus, 0, groups, ++i, n);
                    } else {
                        setTimeout(addGsStatus, 0, groups, ++i, n);
                    }
                } else {
                    setTimeout(addGsStatus, 0, groups, ++i, n);
                }
            });
        }
    }

    /* [EGH] Entered Games Highlighter */

    function saveEghGame(id, type) {
        var games;
        if (id && type) {
            getValue(`games`).then(value => {
                games = JSON.parse(value);
                if (!games[type][id] || !games[type][id].entered) {
                    createLock(`gameLock`, 300, function (deleteLock) {
                        getValue(`games`).then(value => {
                            games = JSON.parse(value);
                            if (!games[type][id]) {
                                games[type][id] = {};
                            }
                            games[type][id].entered = true;
                            return setValue(`games`, JSON.stringify(games));
                        }).then(deleteLock);
                    });
                }
            });
        }
    }

    function unhighlightEghGame(id, type, event) {
        let icon = event.currentTarget;
        if (!icon.classList.contains(`fa-spin`)) {
            icon.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
            createLock(`gameLock`, 300, deleteLock => {
                getValue(`games`).then(value => {
                    let games = JSON.parse(value);
                    delete games[type][id].entered;
                    return setValue(`games`, JSON.stringify(games));
                }).then(() => {
                    icon.remove();
                    deleteLock();
                });
            });
        }
    }

    /* [GT] Game Tags */

    function openGtPopup(id, name, type) {
        var popup, set;
        popup = new Popup(`fa-tag`, `Edit game tags for <span>${name}</span>:`);
        set = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveGtTags.bind(null, id, popup, type));
        popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Drag the tags to move them.<br/><br/>When editing a tag color, it will also alter the color for all games with that tag (you have to refresh the page for it to take effect).</div>`);
        popup.tags = insertHtml(popup.description, `beforeEnd`, `<div class="esgst-gt-tags"></div>`);
        popup.input = insertHtml(popup.description, `beforeEnd`, `<input type="text"/>`);
        insertHtml(popup.description, `beforeEnd`, `<i class="esgst-ut-existing-button esgst-clickable fa fa-list" title="Select from existing tags"></i>`).addEventListener(`click`, showGtExistingTags.bind(null, popup));
        popup.input.addEventListener(`keydown`, triggerSetOnEnter.bind(null, set));
        popup.input.addEventListener(`input`, createGtTags.bind(null, popup));
        popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Use commas to separate tags, for example: Tag1, Tag2, ...</div>`);
        popup.description.appendChild(set.set);
        popup.open(loadGtTags.bind(null, id, popup, type));
    }

    function showGtExistingTags(mainPopup) {
        let key, list, popup, savedGames, selectedTags, tag, tagCount, tags;
        popup = new Popup(`fa-list`, `Select from existing tags:`, true);
        tagCount = {};
        getValue(`games`).then(value => {
            savedGames = JSON.parse(value);
            for (key in savedGames.apps) {
                tags = savedGames.apps[key].tags;
                if (tags) {
                    tags.forEach(tag => {
                        if (!tagCount[tag]) {
                            tagCount[tag] = 0;
                        }
                        tagCount[tag] += 1;
                    });
                }
            }
            for (key in savedGames.subs) {
                tags = savedGames.subs[key].tags;
                if (tags) {
                    tags.forEach(tag => {
                        if (!tagCount[tag]) {
                            tagCount[tag] = 0;
                        }
                        tagCount[tag] += 1;
                    });
                }
            }
            tags = [];
            for (tag in tagCount) {
                tags.push({
                    count: tagCount[tag],
                    tag: tag
                });
            }
            list = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-ut-existing-tags popup__keys__list"></div>`);
            selectedTags = [];
            tags = sortArrayByNumberKey(tags, `count`, true);
            tags.forEach(tag => {
                let checkbox, item;
                tag = tag.tag;
                item = insertHtml(list, `beforeEnd`, `
                    <div>
                        <span></span> ${tag}
                    </div>
                `);
                if (esgst.gt_colors[tag]) {
                    item.style.color = esgst.gt_colors[tag].color;
                    item.style.backgroundColor = esgst.gt_colors[tag].bgColor;
                }
                checkbox = new Checkbox(item);
                checkbox.onEnabled = () => {
                    selectedTags.push(tag);
                };
                checkbox.onDisabled = () => {
                    selectedTags.splice(selectedTags.indexOf(tag), 1);
                };
            });
            popup.description.appendChild(new ButtonSet(`green`, ``, `fa-check`, ``, `Add Tags`, ``, callback => {
                selectedTags.forEach(tag => {
                    createGtTag(mainPopup, tag);
                });
                mainPopup.input.value = mainPopup.input.value ? `${mainPopup.input.value}, ${selectedTags.join(`, `)}` : selectedTags.join(`, `);
                callback();
                popup.close();
            }).set);
            popup.open();
        });
    }

    function createGtTags(popup) {
        var i, n, tags;
        tags = popup.input.value.replace(/(,\s*)+/g, formatTags).split(`, `);
        popup.tags.innerHTML = ``;
        for (i = 0, n = tags.length; i < n; ++i) {
            createGtTag(popup, tags[i]);
        }
    }

    function createGtTag(popup, tag) {
        var bgColorInput, colorInput, colors, container, deleteButton, editButton, input, tagBox, tagContainer;
        container = insertHtml(popup.tags, `beforeEnd`, `
            <div class="esgst-gt-preview" draggable="true">
                <div class="esgst-gt-tags">
                    <span class="global__image-outer-wrap author_avatar is_icon">${tag}</span>
                </div>
                <input class="esgst-hidden" type="text"/>
                <input title="Set text color for this tag" type="color"/>
                <input title="Set background color for this tag" type="color"/>
                <i class="esgst-clickable fa fa-edit" title="Edit tag"></i>
                <i class="esgst-clickable fa fa-trash" title="Delete tag"></i>
                <i class="esgst-clickable fa fa-rotate-left" title="Reset tag color"></i>
            </div>
        `);
        tagContainer = container.firstElementChild;
        tagBox = tagContainer.firstElementChild;
        input = tagContainer.nextElementSibling;
        colorInput = input.nextElementSibling;
        bgColorInput = colorInput.nextElementSibling;
        editButton = bgColorInput.nextElementSibling;
        deleteButton = editButton.nextElementSibling;
        resetButton = deleteButton.nextElementSibling;
        colors = esgst.gt_colors[tag];
        if (colors) {
            colorInput.value = tagBox.style.color = colors.color;
            bgColorInput.value = tagBox.style.backgroundColor = colors.bgColor;
        }
        container.addEventListener(`dragstart`, startGtDrag.bind(null, container, popup));
        container.addEventListener(`dragenter`, continueGtDrag.bind(null, container, popup));
        container.addEventListener(`dragend`, endGtDrag.bind(null, popup));
        input.addEventListener(`keydown`, editGtTag.bind(null, bgColorInput, colorInput, input, popup, tagBox, tagContainer));
        colorInput.addEventListener(`change`, saveGtColor.bind(null, colorInput, `color`, `color`, tagBox));
        bgColorInput.addEventListener(`change`, saveGtColor.bind(null, bgColorInput, `backgroundColor`, `bgColor`, tagBox));
        editButton.addEventListener(`click`, showGtEdit.bind(null, input, tagBox, tagContainer));
        deleteButton.addEventListener(`click`, deleteGtTag.bind(null, container, popup));
        resetButton.addEventListener(`click`, resetGtColor.bind(null, bgColorInput, colorInput, tagBox));
    }

    function startGtDrag(container, popup, event) {
        event.dataTransfer.setData(`text/plain`, ``);
        popup.dragged = container;
    }

    function continueGtDrag(container, popup) {
        var current;
        current = popup.dragged;
        do {
            current = current.previousElementSibling;
            if (current && current === container) {
                popup.tags.insertBefore(popup.dragged, container);
                return;
            }
        } while (current);
        popup.tags.insertBefore(popup.dragged, container.nextElementSibling);
    }

    function endGtDrag(popup) {
        var children, i, n, tags;
        tags = [];
        children = popup.tags.children;
        for (i = 0, n = children.length; i < n; ++i) {
            tags.push(children[i].firstElementChild.firstElementChild.textContent);
        }
        popup.input.value = tags.join(`, `);
    }

    function editGtTag(bgColorInput, colorInput, input, popup, tagBox, tagContainer, event) {
        var colors, name, oldName, tag;
        if (event.key === `Enter`) {
            tagContainer.classList.remove(`esgst-hidden`);
            input.classList.add(`esgst-hidden`);
            oldName = tagBox.textContent;
            tag = input.value;
            tagBox.textContent = tag;
            colors = esgst.gt_colors[tag];
            if (colors) {
                colorInput.value = tagBox.style.color = colors.color;
                bgColorInput.value = tagBox.style.backgroundColor = colors.bgColor;
            }
            endGtDrag(popup);
        }
    }

    function saveGtColor(input, key, saveKey, tagBox) {
        var tag;
        tag = tagBox.textContent;
        if (!esgst.gt_colors[tag]) {
            esgst.gt_colors[tag] = {
                bgColor: ``,
                color: ``
            };
        }
        esgst.gt_colors[tag][saveKey] = tagBox.style[key] = input.value;
    }

    function resetGtColor(bgColorInput, colorInput, tagBox) {
        bgColorInput.value = ``;
        colorInput.value = ``;
        tagBox.style.backgroundColor = ``;
        tagBox.style.color = ``;
        delete esgst.gt_colors[tagBox.textContent];
    }

    function showGtEdit(input, tagBox, tagContainer) {
        tagContainer.classList.add(`esgst-hidden`);
        input.classList.remove(`esgst-hidden`);
        input.value = tagBox.textContent;
        input.focus();
    }

    function deleteGtTag(container, popup) {
        container.remove();
        endGtDrag(popup);
    }

    function saveGtTags(id, popup, type, callback) {
        var savedGames, tags;
        tags = popup.input.value.replace(/(,\s*)+/g, formatTags).split(`, `);
        if (tags.length === 1 && !tags[0].trim()) {
            tags = ``;
        }
        createLock(`gameLock`, 300, function (deleteLock) {
            getValue(`games`).then(value => {
                savedGames = JSON.parse(value);
                if (!savedGames[type][id]) {
                    savedGames[type][id] = {};
                }
                savedGames[type][id].tags = tags;
                return setValue(`games`, JSON.stringify(savedGames));
            }).then(() => {
                deleteLock();
                completeGtSave(id, popup, tags, type, callback);
            });
        });
    }

    function completeGtSave(id, popup, tags, type, callback) {
        setSetting(`gt_colors`, esgst.gt_colors).then(() => {
            addGtTags(null, id, tags, type);
            callback();
            popup.close();
        });
    }

    function loadGtTags(id, popup, type) {
        var game, i, n, savedGames, tags;
        getValue(`games`).then(value => {
            savedGames = JSON.parse(value);
            game = savedGames[type][id];
            popup.input.focus();
            if (game) {
                tags = game.tags;
                if (tags) {
                    popup.tags.innerHTML = ``;
                    for (i = 0, n = tags.length; i < n; ++i) {
                        createGtTag(popup, tags[i]);
                    }
                    popup.input.value = tags.join(`, `);
                }
            }
        });
    }

    function addGtTags(games, id, tags, type) {
        var button, children, colors, game, html, i, j, n, numTags, prefix, suffix, tagsBox, tagsContainer;
        prefix = `<span class="global__image-outer-wrap author_avatar is_icon">`;
        suffix = `</span>`;
        html = tags.length && tags[0] ? `${prefix}${tags.join(`${suffix}${prefix}`)}${suffix}` : ``;
        new Promise((resolve, reject) => {
            if (games) {
                resolve();
            } else {
                getValue(`games`).then(value => {
                    games = getGames(document, true, JSON.parse(value))[type][id];
                    resolve();
                });
            }
        }).then(() => {
            if (games) {
                for (i = 0, n = games.length; i < n; ++i) {
                    game = games[i];
                    if ((game.table && esgst.gt_t) || !game.table) {
                        button = game.container.getElementsByClassName(`esgst-gt-button`)[0];
                        if (html) {
                            button.classList.remove(`esgst-faded`);
                        } else {
                            button.classList.add(`esgst-faded`);
                        }
                        tagsContainer = button.lastElementChild;
                        tagsContainer.innerHTML = html;
                        children = tagsContainer.children;
                        for (j = 0, numTags = children.length; j < numTags; ++j) {
                            tagsBox = children[j];
                            colors = esgst.gt_colors[tagsBox.textContent];
                            if (colors) {
                                tagsBox.style.color = colors.color;
                                tagsBox.style.backgroundColor = colors.bgColor;
                            }
                        }
                    }
                }
            }
        });
    }

    /* [GC] Game Categories */

    function checkGcNewGiveaway(context) {
        if (context.style.opacity === `1`) {
            loadGameFeatures(document, true).then(() => {
                esgst.isCheckingGc = false;
            });
        } else {
            setTimeout(checkGcNewGiveaway, 100, context);
        }
    }

    function getGcGames(games, endless) {
        var gc, element, elements, i, id, missingApps, missingSubs, n, numApps, numSubs, savedGames;
        gc = {
            apps: Object.keys(games.apps),
            cache: {
                apps: {},
                subs: {}
            },
            subs: Object.keys(games.subs)
        };
        for (id in games.apps) {
            elements = games.apps[id];
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                if (!element.container.getElementsByClassName(`esgst-gc-panel`)[0] && ((element.table && esgst.gc_t) || !element.table)) {
                    if (element.container.closest(`.poll`)) {
                        element.container.getElementsByClassName(`table__column__heading`)[0].insertAdjacentHTML(`afterEnd`, `<div class="esgst-gc-panel"></div>`);
                    } else {
                        element.heading.insertAdjacentHTML(`afterEnd`, `<div class="esgst-gc-panel"></div>`);
                    }
                }
            }
        }
        for (id in games.subs) {
            elements = games.subs[id];
            for (i = 0, n = elements.length; i < n; ++i) {
                element = elements[i];
                if (!element.container.getElementsByClassName(`esgst-gc-panel`)[0] && ((element.table && esgst.gc_t) || !element.table)) {
                    if (element.container.closest(`.poll`)) {
                        element.container.getElementsByClassName(`table__column__heading`)[0].insertAdjacentHTML(`afterEnd`, `<div class="esgst-gc-panel"></div>`);
                    } else {
                        element.heading.insertAdjacentHTML(`afterEnd`, `<div class="esgst-gc-panel"></div>`);
                    }
                }
            }
        }
        if (esgst.gc_gi || esgst.gc_r || esgst.gc_a || esgst.gc_mp || esgst.gc_sc || esgst.gc_tc || esgst.gc_l || esgst.gc_m || esgst.gc_dlc || esgst.gc_ea || esgst.gc_rm || esgst.gc_g) {
            gc.cache = JSON.parse(getLocalValue(`gcCache`, `{ "apps": {}, "subs": {}, "timestamp": 0 }`));
            var currentTime = Date.now();
            for (id in gc.cache.apps) {
                if (gc.cache.apps[id].lastCheck) {
                    if (currentTime - gc.cache.apps[id].lastCheck > 604800000 || gc.cache.apps[id].price === -1 || (!gc.cache.apps[id].tags && !gc.cache.apps[id].rating)) {
                        delete gc.cache.apps[id];
                    }
                } else {
                    gc.cache.apps[id].lastCheck = currentTime;
                }
            }
            for (id in gc.cache.subs) {
                if (gc.cache.subs[id].lastCheck) {
                    if (currentTime - gc.cache.subs[id].lastCheck > 604800000 || gc.cache.subs[id].price === -1) {
                        delete gc.cache.subs[id];
                    }
                } else {
                    gc.cache.subs[id].lastCheck = currentTime;
                }
            }
            setLocalValue(`gcCache`, JSON.stringify(gc.cache));
            missingApps = [];
            missingSubs = [];
            for (i = 0, n = gc.apps.length; i < n; ++i) {
                id = gc.apps[i];
                if (!gc.cache.apps[id]) {
                    missingApps.push(id);
                }
            }
            for (i = 0, n = gc.subs.length; i < n; ++i) {
                id = gc.subs[i];
                if (!gc.cache.subs[id]) {
                    missingSubs.push(id);
                }
            }
            numApps = missingApps.length;
            numSubs = missingSubs.length;
            if (numApps || numSubs) {
                let check = new CompletionCheck(numApps + numSubs, () => {                    
                    setLocalValue(`gcCache`, JSON.stringify(gc.cache));
                    addGcCategories(games, gc, endless);
                });
                for (i = 0, n = missingApps.length; i < n; ++i) {
                    getGcCategories(check, gc, missingApps[i], `apps`);
                }
                for (i = 0, n = missingSubs.length; i < n; ++i) {
                    getGcCategories(check, gc, missingSubs[i], `subs`);
                }
            } else {
                addGcCategories(games, gc, endless);
            }
        } else {
            addGcCategories(games, gc, endless);
        }
    }

    function getGcCategories(check, gc, id, type) {
        var categories, data, elements, genres, i, match, n, platforms, price, response, responseHtml, responseJson, tags;
        request(null, null, `GET`, false, `http://store.steampowered.com/api/${type === `apps` ? `appdetails?appids=` : `packagedetails?packageids=`}${id}&filters=basic,categories,genres,name,platforms,price,price_overview&cc=us&l=en`, function (response) {
            try {
                categories = {
                    achievements: 0,
                    dlc: 0,
                    earlyAccess: 0,
                    genres: ``,
                    linux: 0,
                    mac: 0,
                    multiplayer: 0,
                    name: ``,
                    price: -1,
                    rating: ``,
                    ratingType: ``,
                    removed: 1,
                    steamCloud: 0,
                    tags: ``,
                    tradingCards: 0
                };
                responseJson = JSON.parse(response.responseText);
                if (responseJson && responseJson[id]) {
                    data = responseJson[id].data;
                    if (data) {
                        if (data.categories) {
                            for (i = 0, n = data.categories.length; i < n; ++i) {
                                switch (data.categories[i].description) {
                                    case `Steam Achievements`:
                                        categories.achievements = 1;
                                        break;
                                    case `Multi-player`:
                                        categories.multiplayer = 1;
                                        break;
                                    case `Steam Cloud`:
                                        categories.steamCloud = 1;
                                        break;
                                    case `Steam Trading Cards`:
                                        categories.tradingCards = 1;
                                        break;
                                    default:
                                        break;
                                }
                            }
                        }
                        categories.dlc = data.type === `dlc` ? 1 : 0;
                        genres = [];
                        if (data.genres) {
                            for (i = 0, n = data.genres.length; i < n; ++i) {
                                genres.push(data.genres[i].description.trim());
                            }
                        }
                        genres.sort(function (a, b) {
                            return a.localeCompare(b, {
                                sensitivity: `base`
                            });
                        });
                        categories.earlyAccess = genres.indexOf(`Early Access`) >= 0 ? 1 : 0;
                        categories.genres = genres.join(`, `);
                        platforms = data.platforms;
                        categories.linux = platforms.linux ? 1 : 0;
                        categories.mac = platforms.mac ? 1 : 0;
                        categories.name = data.name;
                        price = data.price || data.price_overview;
                        categories.price = price ? (price.currency === `USD` ? Math.ceil(price.initial / 100) : -1) : 0;
                    }
                }
                request(null, null, `GET`, false, `http://store.steampowered.com/${type.slice(0, -1)}/${id}`, function (response) {
                    responseHtml = parseHtml(response.responseText);
                    if (response.finalUrl.match(id)) {
                        elements = responseHtml.getElementsByClassName(`user_reviews_summary_row`);
                        n = elements.length;
                        if (n > 0) {
                            var rating = elements[n - 1].getAttribute(`data-store-tooltip`).replace(/,|\./g, ``);
                            match = rating.match(/(\d+)%.+?(\d+)/);
                            var percentageIndex = 1;
                            var countIndex = 2;
                            if (!match) {
                                match = rating.match(/(\d+).+?(\d+)%/);
                                percentageIndex = 2;
                                countIndex = 1;
                            }
                            if (match) {
                                categories.rating = `${match[percentageIndex]}% (${match[countIndex]})`;
                                rating = parseInt(match[percentageIndex]);
                                if (rating >= 0) {
                                    if (rating < 40) {
                                        categories.ratingType = `Negative`;
                                    } else if (rating < 70) {
                                        categories.ratingType = `Mixed`;
                                    } else {
                                        categories.ratingType = `Positive`;
                                    }
                                } else {
                                    categories.ratingType = `?`;
                                }
                            }
                        }
                        categories.removed = 0;
                        tags = [];
                        elements = responseHtml.querySelectorAll(`a.app_tag`);
                        for (i = 0, n = elements.length; i < n; ++i) {
                            tags.push(elements[i].textContent.trim());
                        }
                        tags.sort(function (a, b) {
                            return a.localeCompare(b, {
                                sensitivity: `base`
                            });
                        });
                        categories.tags = tags.join(`, `);
                    }
                    gc.cache[type][id] = categories;
                    if (esgst.gc_dlc_b && categories.dlc && data.fullgame && data.fullgame.appid) {
                        request(null, null, `GET`, false, `http://store.steampowered.com/api/appdetails?appids=${data.fullgame.appid}&filters=basic&cc=us&l=en`, response => {
                            categories.freeBase = JSON.parse(response.responseText)[data.fullgame.appid].data.is_free;
                            check.count += 1;
                        });
                    } else {
                        check.count += 1;
                    }
                });
            } catch (error) {
                check.count += 1;
                console.log(error);
            }
        });
    }

    function addGcCategories(games, gc, endless) {
        var borders, category, categoryNames, categories, giveaway, i, j, id, n, numCategories, savedGames;
        getValue(`games`).then(value => {
            savedGames = JSON.parse(value);
            for (i = 0, n = gc.apps.length; i < n; ++i) {
                id = gc.apps[i];
                addGcCategory(gc.cache.apps[id], games.apps[id], id, savedGames.apps[id], `apps`);
            }
            for (i = 0, n = gc.subs.length; i < n; ++i) {
                id = gc.subs[i];
                addGcCategory(gc.cache.subs[id], games.subs[id], id, savedGames.subs[id], `subs`);
            }
            categories = [`achievements`, `dlc`, `dlcFree`, `dlcNonFree`, `genres`, `linux`, `mac`, `multiplayer`, `package`, `rating`, `removed`, `steamCloud`, `tradingCards`];
            for (i = 0, n = esgst.currentGiveaways.length; i < n; ++i) {
                giveaway = esgst.currentGiveaways[i];
                if (!giveaway.gcReady && giveaway.outerWrap.querySelector(`[data-gcReady]`)) {
                    for (j = 0, numCategories = categories.length; j < numCategories; ++j) {
                        id = categories[j];
                        category = giveaway.outerWrap.getElementsByClassName(`esgst-gc-${id}`)[0];
                        if (category) {
                            if (id === `genres`) {
                                giveaway.genres = category.textContent.toLowerCase().trim().replace(/\s{2,}/g, `, `).split(/,\s/);
                            } else if (id === `rating`) {
                                giveaway.rating = parseInt(category.title.match(/(\d+)%/)[1]);
                            } else {
                                giveaway[id] = true;
                            }
                        } else if (id === `rating`) {
                            giveaway.rating = 0;
                        }
                    }
                    if (giveaway.grid && esgst.gc_b) {
                        borders = insertHtml(giveaway.outerWrap, `beforeEnd`, `<div class="esgst-gc-border"></div>`);
                        categoryNames = {
                            gc_fcv: `fullCV`,
                            gc_rcv: `reducedCV`,
                            gc_ncv: `noCV`,
                            gc_h: `hidden`,
                            gc_i: `ignored`,
                            gc_o: `owned`,
                            gc_w: `wishlisted`,
                            gc_a: `achievements`,
                            gc_mp: `multiplayer`,
                            gc_sc: `steamCloud`,
                            gc_tc: `tradingCards`,
                            gc_l: `linux`,
                            gc_m: `mac`,
                            gc_ea: `earlyAccess`,
                            gc_rm: `removed`,
                            gc_dlc: `dlc`,
                            gc_p: `package`
                        };
                        esgst.gc_categories.forEach(category => {
                            if (categoryNames[category] && giveaway.innerWrap.getElementsByClassName(`esgst-gc-${categoryNames[category]}`)[0]) {
                                borders.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-gc-${categoryNames[category]}"></div>`);
                            }
                        });
                    }
                    giveaway.gcReady = true;
                }
            }
            for (i = 0, n = esgst.popupGiveaways.length; i < n; ++i) {
                giveaway = esgst.popupGiveaways[i];
                if (!giveaway.gcReady && giveaway.outerWrap.querySelector(`[data-gcReady]`)) {
                    for (j = 0, numCategories = categories.length; j < numCategories; ++j) {
                        id = categories[j];
                        category = giveaway.outerWrap.getElementsByClassName(`esgst-gc-${id}`)[0];
                        if (category) {
                            if (id === `genres`) {
                                giveaway.genres = category.textContent.toLowerCase().trim().replace(/\s{2,}/g, `, `).split(/,\s/);
                            } else if (id === `rating`) {
                                giveaway.rating = parseInt(category.title.match(/(\d+)%/)[1]);
                            } else {
                                giveaway[id] = true;
                            }
                        } else if (id === `rating`) {
                            giveaway.rating = 0;
                        }
                    }
                    if (giveaway.grid && esgst.gc_b) {
                        borders = insertHtml(giveaway.outerWrap, `beforeEnd`, `<div class="esgst-gc-border"></div>`);
                        categoryNames = {
                            gc_fcv: `fullCV`,
                            gc_rcv: `reducedCV`,
                            gc_ncv: `noCV`,
                            gc_h: `hidden`,
                            gc_i: `ignored`,
                            gc_o: `owned`,
                            gc_w: `wishlisted`,
                            gc_a: `achievements`,
                            gc_mp: `multiplayer`,
                            gc_sc: `steamCloud`,
                            gc_tc: `tradingCards`,
                            gc_l: `linux`,
                            gc_m: `mac`,
                            gc_ea: `earlyAccess`,
                            gc_rm: `removed`,
                            gc_dlc: `dlc`,
                            gc_p: `package`
                        };
                        esgst.gc_categories.forEach(category => {
                            if (categoryNames[category] && giveaway.innerWrap.getElementsByClassName(`esgst-gc-${categoryNames[category]}`)[0]) {
                                borders.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-gc-${categoryNames[category]}"></div>`);
                            }
                        });
                    }
                    giveaway.gcReady = true;
                }
            }
            if (esgst.gf && esgst.gf.filteredCount && esgst[`gf_enable${esgst.gf.type}`]) {
                filterGfGiveaways(esgst.gf, false, endless);
            }
            if (esgst.gfPopup && esgst.gfPopup.filteredCount && esgst[`gf_enable${esgst.gfPopup.type}`]) {
                filterGfGiveaways(esgst.gfPopup);
            }
        });
    }

    function addGcCategory(cache, games, id, savedGame, type) {
        var active, category, colored, count, cv, elements, encodedName, genre, genreList, genres, giveaway, giveaways, html, i, icons, j, k, n, panel, name, ratingType, sent, singularType, user, value;
        singularType = type.slice(0, -1);
        name = cache ? cache.name : games[0].name;
        encodedName = encodeURIComponent(name.replace(/\.\.\.$/, ``));
        elements = [];
        for (i = 0, n = esgst.gc_categories.length; i < n; ++i) {
            category = esgst.gc_categories[i];
            if (esgst[category]) {
                switch (category) {
                    case `gc_fcv`:
                        if ((savedGame && !savedGame.reducedCV && !savedGame.noCV) || !savedGame) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-fullCV" href="https://www.steamgifts.com/bundle-games/search?q=${encodedName}" title="Full CV">${esgst.gc_fcv_s ? (esgst.gc_fcv_s_i ? `<i class="fa fa-${esgst.gc_fcvIcon}"></i>` : `FCV`) : esgst.gc_fcvLabel}</a>
                            `);
                        }
                        break;
                    case `gc_rcv`:
                        if (savedGame && savedGame.reducedCV && !location.pathname.match(/^\/bundle-games/) && (!esgst.gc_ncv_o || !savedGame.noCV)) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-reducedCV" href="https://www.steamgifts.com/bundle-games/search?q=${encodedName}" title="Reduced CV since ${savedGame.reducedCV}">${esgst.gc_rcv_s ? (esgst.gc_rcv_s_i ? `<i class="fa fa-${esgst.gc_rcvIcon}"></i>` : `RCV`) : esgst.gc_rcvLabel}</a>
                            `);
                        }
                        break;
                    case `gc_ncv`:
                        if (savedGame && savedGame.noCV) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-noCV" href="https://www.steamgifts.com/bundle-games/search?q=${encodedName}" title="No CV since ${savedGame.noCV}">${esgst.gc_ncv_s ? (esgst.gc_ncv_s_i ? `<i class="fa fa-${esgst.gc_ncvIcon}"></i>` : `NCV`) : esgst.gc_ncvLabel}</a>
                            `);
                        }
                        break;
                    case `gc_h`:
                        if (savedGame && savedGame.hidden) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-hidden" href="https://www.steamgifts.com/account/settings/giveaways/filters/search?q=${encodedName}" title="Hidden">${esgst.gc_h_s ? (esgst.gc_h_s_i ? `<i class="fa fa-${esgst.gc_hIcon}"></i>` : `H`) : esgst.gc_hLabel}</a>
                            `);
                        }
                        break;
                    case `gc_i`:
                        if (savedGame && savedGame.ignored) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-ignored" href="http://store.steampowered.com/${singularType}/${id}" title="Ignored">${esgst.gc_i_s ? (esgst.gc_i_s_i ? `<i class="fa fa-${esgst.gc_iIcon}"></i>` : `I`) : esgst.gc_iLabel}</a>
                            `);
                        }
                        break;
                    case `gc_o`:
                        if (savedGame && savedGame.owned) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-owned" href="https://www.steamgifts.com/account/steam/games/search?q=${encodedName}" title="Owned">${esgst.gc_o_s ? (esgst.gc_o_s_i ? `<i class="fa fa-${esgst.gc_oIcon}"></i>` : `O`) : esgst.gc_oLabel}</a>
                            `);
                        }
                        if (!esgst.gc_o_t || games[0].table) {
                            esgst.gc_o_altAccounts.forEach(account => {
                                var game = account.games[type][id];
                                if (game && game.owned) {
                                    elements.push(`
                                        <a class="esgst-gc esgst-gc-owned" href="http://steamcommunity.com/profiles/${account.steamId}/games" style="background-color: ${account.bgColor} !important; color: ${account.color} !important;" title="Owned by ${account.name}">${esgst.gc_o_s ? (esgst.gc_o_s_i ? `<i class="fa fa-${account.icon}"></i>` : `O`) : account.label}</a>
                                    `);
                                }
                            });
                        }
                        break;
                    case `gc_w`:
                        if (savedGame && savedGame.wishlisted) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-wishlisted" href="https://www.steamgifts.com/account/steam/wishlist/search?q=${encodedName}" title="Wishlisted">${esgst.gc_w_s ? (esgst.gc_w_s_i ? `<i class="fa fa-${esgst.gc_wIcon}"></i>` : `W`) : esgst.gc_wLabel}</a>
                            `);
                        }
                        break;
                    case `gc_gi`:
                        if (((esgst.gc_gi_t && games[0].table) || !esgst.gc_gi_t) && (esgst.gc_gi_cew && (esgst.createdPath || esgst.enteredPath || esgst.wonPath) || !esgst.gc_gi_cew) && cache && cache.price) {
                            user = esgst.users.users[esgst.steamId];
                            if (user) {
                                giveaways = user.giveaways;
                                if (giveaways) {
                                    giveaways = giveaways.sent[type][id];
                                    active = 0;
                                    count = 0;
                                    sent = 0;
                                    if (giveaways) {
                                        var currentDate = Date.now();
                                        for (j = 0, numGiveaways = giveaways.length; j < numGiveaways; ++j) {
                                            giveaway = esgst.giveaways[giveaways[j]];
                                            if (giveaway) {
                                                if (Array.isArray(giveaway.winners)) {
                                                    if (giveaway.winners.length > 0) {
                                                        giveaway.winners.forEach(winner => {
                                                            count += 1;
                                                            if ((giveaway.entries >= 5 || (!giveaway.inviteOnly && !giveaway.group && !giveaway.whitelist)) && winner.received) {
                                                                sent += 1;
                                                            }
                                                        });
                                                    } else if (currentDate < giveaway.endTime) {
                                                        active += giveaway.copies;
                                                    }
                                                } else if (giveaway.winners > 0) {
                                                    count += Math.min(giveaway.entries, giveaway.winners);
                                                    if (giveaway.entries >= 5 || (!giveaway.inviteOnly && !giveaway.group && !giveaway.whitelist)) {
                                                        sent += Math.min(giveaway.entries, giveaway.winners);
                                                    }
                                                } else if (currentDate < giveaway.endTime) {
                                                    active += giveaway.copies;
                                                }
                                            }
                                        }
                                        value = cache.price;
                                        if (savedGame) {
                                            if (savedGame.noCV) {
                                                value = 0;
                                            } else if (savedGame.reducedCV) {
                                                value *= 0.15;
                                            }
                                        }
                                        if (sent > 5) {
                                            for (j = 0, numGiveaways = sent - 5; j < numGiveaways; ++j) {
                                                value *= 0.90;
                                            }
                                        }
                                        cv = (sent + 1) > 5 ? value * 0.90 : value;
                                        cv = Math.round(cv * 100) / 100;
                                    } else {
                                        value = cache.price;
                                        if (savedGame) {
                                            if (savedGame.noCV) {
                                                value = 0;
                                            } else if (savedGame.reducedCV) {
                                                value *= 0.15;
                                            }
                                        }
                                        cv = Math.round(value * 100) / 100;
                                    }
                                    elements.push(`
                                        <a class="esgst-gc esgst-gc-giveawayInfo" href="https://www.steamgifts.com/user/${esgst.username}" title="You have sent ${count} copies of this game (${sent} of which added to your CV)${active ? `\nYou currently have ${active} open giveaways for this game` : ``}\nYou should get \$${cv} real CV for sending a new copy of this game\nA giveaway for this game is worth ${Math.min(Math.ceil(cache.price), 50)}P"><i class="fa fa-info"></i> ${count} <i class="fa fa-dollar"></i> ${cv}</a>
                                    `);
                                }
                            }
                        }
                        break;
                    case `gc_r`:
                        if (cache && cache.rating) {
                            icons = {
                                positive: `thumbs-up`,
                                negative: `thumbs-down`,
                                mixed: `minus-circle`
                            };
                            ratingType = cache.ratingType.toLowerCase();
                            elements.push(`
                                <a class="esgst-gc esgst-gc-rating esgst-gc-rating-${ratingType}" href="http://store.steampowered.com/${singularType}/${id}" title="${cache.rating}"><i class="fa fa-${icons[ratingType]}"></i>${esgst.gc_r_s ? ` ${cache.rating}` : ``}</a>
                            `);
                        }
                        break;
                    case `gc_a`:
                        if (cache && cache.achievements) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-achievements" href="http://steamcommunity.com/stats/${id}/achievements" title="Achievements">${esgst.gc_a_s ? (esgst.gc_a_s_i ? `<i class="fa fa-${esgst.gc_aIcon}"></i>` : `A`) : esgst.gc_aLabel}</a>
                            `);
                        }
                        break;
                    case `gc_mp`:
                        if (cache && cache.multiplayer) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-multiplayer" href="http://store.steampowered.com/${singularType}/${id}" title="Multiplayer">${esgst.gc_mp_s ? (esgst.gc_mp_s_i ? `<i class="fa fa-${esgst.gc_mpIcon}"></i>` : `MP`) : esgst.gc_mpLabel}</a>
                            `);
                        }
                        break;
                    case `gc_sc`:
                        if (cache && cache.steamCloud) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-steamCloud" href="http://store.steampowered.com/${singularType}/${id}" title="Steam Cloud">${esgst.gc_sc_s ? (esgst.gc_sc_s_i ? `<i class="fa fa-${esgst.gc_scIcon}"></i>` : `SC`) : esgst.gc_scLabel}</a>
                            `);
                        }
                        break;
                    case `gc_tc`:
                        if (cache && cache.tradingCards) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-tradingCards" href="http://www.steamcardexchange.net/index.php?gamepage-${singularType}id-${id}" title="Trading Cards">${esgst.gc_tc_s ? (esgst.gc_tc_s_i ? `<i class="fa fa-${esgst.gc_tcIcon}"></i>` : `TC`) : esgst.gc_tcLabel}</a>
                            `);
                        }
                        break;
                    case `gc_l`:
                        if (cache && cache.linux) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-linux" href="http://store.steampowered.com/${singularType}/${id}" title="Linux">${esgst.gc_l_s ? (esgst.gc_l_s_i ? `<i class="fa fa-${esgst.gc_lIcon}"></i>` : `L`) : esgst.gc_lLabel}</a>
                            `);
                        }
                        break;
                    case `gc_m`:
                        if (cache && cache.mac) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-mac" href="http://store.steampowered.com/${singularType}/${id}" title="Mac">${esgst.gc_m_s ? (esgst.gc_m_s_i ? `<i class="fa fa-${esgst.gc_mIcon}"></i>` : `M`) : esgst.gc_mLabel}</a>
                            `);
                        }
                        break;
                    case `gc_dlc`:
                        if (cache && cache.dlc) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-dlc" href="http://store.steampowered.com/${singularType}/${id}" title="DLC${typeof cache.freeBase !== `undefined` ? (cache.freeBase ? ` (the base game of this DLC is free)` : ` (the base game of this DLC is not free)`) : ``}">${esgst.gc_dlc_s ? (esgst.gc_dlc_s_i ? `<i class="fa fa-${esgst.gc_dlcIcon}"></i>${typeof cache.freeBase !== `undefined` ? (cache.freeBase ? ` <i class="fa fa-certificate esgst-gc-dlcFree"></i>` : ` <i class="fa fa-money esgst-gc-dlcNonFree"></i>`) : ``}` : `DLC${typeof cache.freeBase !== `undefined` ? (cache.freeBase ? ` <span class="esgst-gc-dlcFree">(F)</span>` : ` <span class="esgst-gc-dlcNonFree">(NF)</span>`) : ``}`) : `${esgst.gc_dlcLabel}${typeof cache.freeBase !== `undefined` ? (cache.freeBase ? ` <span class="esgst-gc-dlcFree">(Free)</span>` : ` <span class="esgst-gc-dlcNonFree">(Not Free)</span>`) : ``}`}</a>
                            `);
                        }
                        break;
                    case `gc_p`:
                        if (type === `subs`) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-package" href="http://store.steampowered.com/${singularType}/${id}" title="Package">${esgst.gc_p_s ? (esgst.gc_p_s_i ? `<i class="fa fa-${esgst.gc_pIcon}"></i>` : `P`) : esgst.gc_pLabel}</a>
                            `);
                        }
                        break;
                    case `gc_ea`:
                        if (cache && cache.earlyAccess) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-earlyAccess" href="http://store.steampowered.com/${singularType}/${id}" title="Early Access">${esgst.gc_ea_s ? (esgst.gc_ea_s_i ? `<i class="fa fa-${esgst.gc_eaIcon}"></i>` : `EA`) : esgst.gc_eaLabel}</a>
                            `);
                        }
                        break;
                    case `gc_rm`:
                        if (cache && cache.removed) {
                            elements.push(`
                                <a class="esgst-gc esgst-gc-removed" href="http://steamdb.info/${singularType}/${id}" title="Removed">${esgst.gc_rm_s ? (esgst.gc_rm_s_i ? `<i class="fa fa-${esgst.gc_rmIcon}"></i>` : `RM`) : esgst.gc_rmLabel}</a>
                            `);
                        }
                        break;
                    case `gc_g`:
                        if (cache && cache.genres) {
                            let filters;
                            genres = esgst.gc_g_udt && cache.tags ? `${cache.genres}, ${cache.tags}` : cache.genres;
                            genreList = sortArray(Array.from(new Set(genres.split(/,\s/))));
                            genres = genreList.join(`, `);
                            colored = [];
                            if (esgst.gc_g_filters.trim()) {
                                filters = esgst.gc_g_filters.trim().toLowerCase().split(/\s*,\s*/);
                            }
                            for (j = genreList.length - 1; j >= 0; --j) {
                                genre = genreList[j].toLowerCase();
                                if (!filters || filters.indexOf(genre) > -1) {
                                    for (k = esgst.gc_g_colors.length - 1; k >= 0 && esgst.gc_g_colors[k].genre.toLowerCase() !== genre; --k);
                                    if (k >= 0) {
                                        if (esgst.gc_g_s) {
                                            colored.push(`
                                                <a class="esgst-gc esgst-gc-genres" href="http://store.steampowered.com/${singularType}/${id}" style="background-color: ${esgst.gc_g_colors[k].bgColor} !important; color: ${esgst.gc_g_colors[k].color} !important;" title="${genreList[j]}">${genreList.splice(j, 1)}</a>
                                            `);
                                        } else {
                                            colored.push(`
                                                <span style="color: ${esgst.gc_g_colors[k].color}">${genreList.splice(j, 1)}</span>
                                            `);
                                        }
                                    } else if (esgst.gc_g_s) {
                                        genreList[j] = `
                                            <a class="esgst-gc esgst-gc-genres" href="http://store.steampowered.com/${singularType}/${id}" title="${genreList[j]}">${genreList[j]}</a>
                                        `;
                                    }
                                } else {
                                    genreList.splice(j, 1);
                                }
                            }
                            if (colored.length) {
                                colored = sortArray(colored);
                                for (j = colored.length - 1; j >= 0; --j) {
                                    genreList.unshift(colored[j]);
                                }
                            }
                            if (esgst.gc_g_s) {
                                elements.push(`
                                    <span class="esgst-gc-genres">${genreList.join(``)}</span>
                                `);
                            } else if (genreList.length > 0) {
                                elements.push(`
                                    <a class="esgst-gc esgst-gc-genres" href="http://store.steampowered.com/${singularType}/${id}" title="${genres}">${genreList.join(`, `)}</a>
                                `);
                            }
                        }
                        break;
                }
            }
        }
        html = elements.join(``);
        for (i = 0, n = games.length; i < n; ++i) {
            panel = games[i].container.getElementsByClassName(`esgst-gc-panel`)[0];
            if (panel && !panel.getAttribute(`data-gcReady`)) {
                if (esgst.gc_il && !esgst.giveawayPath) {
                    panel.previousElementSibling.style.display = `inline-block`;
                    panel.classList.add(`esgst-gc-panel-inline`);
                }
                panel.innerHTML = html;
                if (!esgst.gc_lp || (!esgst.gc_lp_gv && games[i].grid)) {
                    for (j = panel.children.length - 1; j > -1; --j) {
                        panel.children[j].removeAttribute(`href`);
                    }
                }
                panel.setAttribute(`data-gcReady`, 1);
            }
        }
    }

    /* [MT] Multi-Tag */

    function loadMt() {
        if (esgst.mainPageHeading) {
            let mt, toggleSwitch;
            if (esgst.ut || esgst.wbc) {
                let key, position;
                if (esgst.leftButtonIds.indexOf(`mtUsers`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                esgst.mtUserButton = insertHtml(esgst.hideButtons && esgst.hideButtons_mtUsers ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button esgst-hidden" id="esgst-mtUsers" title="Manage users">
                        <span></span>
                        <span>
                            <i class="fa fa-user"></i>
                        </span>
                    </div>
                `);
                mt = {
                    button: esgst.mtUserButton,
                    type: `user`
                };
                toggleSwitch = new ToggleSwitch(esgst.mtUserButton.firstElementChild, null, true, ``);
                toggleSwitch.onEnabled = enableMt.bind(null, mt);
                toggleSwitch.onDisabled = disableMt.bind(null, mt);
                esgst.mtUserButton.addEventListener(`click`, openMtPopout.bind(null, mt));
            }
            if (esgst.gt) {
                let key, position;
                if (esgst.leftButtonIds.indexOf(`mtGames`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                esgst.mtGameButton = insertHtml(esgst.hideButtons && esgst.hideButtons_mtGames ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-heading-button esgst-hidden" id="esgst-mtGames" title="Multi-tag games">
                        <span></span>
                        <span>
                            <i class="fa fa-gamepad"></i>
                            <i class="fa fa-tags"></i>
                        </span>
                    </div>
                `);
                mt = {
                    button: esgst.mtGameButton,
                    type: `game`
                };
                toggleSwitch = new ToggleSwitch(esgst.mtGameButton.firstElementChild, null, true, ``);
                toggleSwitch.onEnabled = enableMt.bind(null, mt);
                toggleSwitch.onDisabled = disableMt.bind(null, mt);
                esgst.mtGameButton.addEventListener(`click`, openMtPopout.bind(null, mt));
            }
        }
    }

    function enableMt(mt, current) {
        var checkbox, container, id;
        if (mt.type === `user`) {
            mt.users = {};
            mt.userCheckboxes = [];
            esgst.mtUsers = mt.selectedUsers = [];
            if (!current) {
                current = esgst.currentUsers;
            }
            for (id in current) {
                current[id].elements.forEach(element => {
                    container = element.parentElement;
                    if (!container.classList.contains(`esgst-hidden`)) {
                        if (container.classList.contains(`comment__username`)) {
                            element = container;
                        }
                        checkbox = new Checkbox(insertHtml(element, `beforeBegin`, `
                            <span class="esgst-mt-checkbox"></span>
                        `));
                        checkbox.onEnabled = addMtUser.bind(null, id, mt);
                        checkbox.onDisabled = removeMtUser.bind(null, id, mt);
                        if (!mt.users[id]) {
                            mt.users[id] = {
                                checkboxes: []
                            };
                        }
                        mt.users[id].checkboxes.push(checkbox);
                        mt.userCheckboxes.push(checkbox);
                    }
                });
            }
        } else {
            mt.games = {
                apps: {},
                subs: {}
            };
            mt.gameCheckboxes = [];
            mt.selectedGames = {
                apps: [],
                subs: []
            };
            if (!current) {
                current = esgst.currentGames;
            }
            for (id in current.apps) {
                current.apps[id].forEach(element => {
                    if (!element.heading.classList.contains(`esgst-hidden`)) {
                        checkbox = new Checkbox(insertHtml(element.heading, `afterBegin`, `
                            <span class="esgst-mt-checkbox"></span>
                        `));
                        checkbox.onEnabled = addMtGame.bind(null, id, mt, `apps`);
                        checkbox.onDisabled = removeMtGame.bind(null, id, mt, `apps`);
                        if (!mt.games.apps[id]) {
                            mt.games.apps[id] = {
                                checkboxes: []
                            };
                        }
                        mt.games.apps[id].checkboxes.push(checkbox);
                        mt.gameCheckboxes.push(checkbox);
                    }
                });
            }
            for (id in current.subs) {
                current.subs[id].forEach(element => {
                    if (!element.heading.classList.contains(`esgst-hidden`)) {
                        checkbox = new Checkbox(insertHtml(element.heading, `afterBegin`, `
                            <span class="esgst-mt-checkbox"></span>
                        `));
                        checkbox.onEnabled = addMtGame.bind(null, id, mt, `subs`);
                        checkbox.onDisabled = removeMtGame.bind(null, id, mt, `subs`);
                        if (!mt.games.subs[id]) {
                            mt.games.subs[id] = {
                                checkboxes: []
                            };
                        }
                        mt.games.subs[id].checkboxes.push(checkbox);
                        mt.gameCheckboxes.push(checkbox);
                    }
                });
            }
        }
        if (!mt.popout) {
            openMtPopout(mt);
        }
    }

    function addMtUser(id, mt) {
        var count;
        if (mt.selectedUsers.indexOf(id) < 0) {
            mt.selectedUsers.push(id);
            mt.users[id].checkboxes.forEach(checkbox => {
                checkbox.check();
            });
            count = parseInt(mt.count.textContent) + 1
            mt.count.textContent = count;
            if (count > 1 && mt.tagButton) {
                mt.tagButton.classList.remove(`esgst-hidden`);
            }
        }
    }

    function removeMtUser(id, mt) {
        var count, index;
        index = mt.selectedUsers.indexOf(id);
        if (index >= 0) {
            mt.selectedUsers.splice(index, 1);
            mt.users[id].checkboxes.forEach(checkbox => {
                checkbox.uncheck();
            });
            count = parseInt(mt.count.textContent) - 1;
            mt.count.textContent = count;
            if (count <= 1 && mt.tagButton) {
                mt.tagButton.classList.add(`esgst-hidden`);
            }
        }
    }

    function addMtGame(id, mt, type) {
        var count;
        if (mt.selectedGames[type].indexOf(id) < 0) {
            mt.selectedGames[type].push(id);
            mt.games[type][id].checkboxes.forEach(checkbox => {
                checkbox.check();
            });
            count = parseInt(mt.count.textContent) + 1
            mt.count.textContent = count;
            if (count > 1 && mt.tagButton) {
                mt.tagButton.classList.remove(`esgst-hidden`);
            }
        }
    }

    function removeMtGame(id, mt, type) {
        var count, index;
        index = mt.selectedGames[type].indexOf(id);
        if (index >= 0) {
            mt.selectedGames[type].splice(index, 1);
            mt.games[type][id].checkboxes.forEach(checkbox => {
                checkbox.uncheck();
            });
            count = parseInt(mt.count.textContent) - 1;
            mt.count.textContent = count;
            if (count <= 1 && mt.tagButton) {
                mt.tagButton.classList.add(`esgst-hidden`);
            }
        }
    }

    function disableMt(mt) {
        mt[`${mt.type}Checkboxes`].forEach(checkbox => {
            checkbox.checkbox.parentElement.remove();
        });
        mt.count.textContent = 0;
        if (mt.tagButton) {
            mt.tagButton.classList.add(`esgst-hidden`);
        }
    }

    function openMtPopout(mt) {
        if (!mt.popout) {
            mt.popout = new Popout(`esgst-mt-popout`, mt.button, 0, true);
            group = insertHtml(mt.popout.popout, `beforeEnd`, `<div class="esgst-button-group"><span>Select:</span></div>`);
            group.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle`, `fa-circle-o-notch fa-spin`, `All`, ``, selectMtCheckboxes.bind(null, mt, `check`)).set);
            group.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle-o`, `fa-circle-o-notch fa-spin`, `None`, ``, selectMtCheckboxes.bind(null, mt, `uncheck`)).set);
            group.appendChild(new ButtonSet(`grey`, `grey`, `fa-dot-circle-o`, `fa-circle-o-notch fa-spin`, `Inverse`, ``, selectMtCheckboxes.bind(null, mt, `toggle`)).set);
            if (mt.type !== `user` || esgst.ut) {
                mt.tagButton = new ButtonSet(`green`, ``, `fa-tags`, ``, `Multi-Tag`, ``, openMtPopup.bind(null, mt)).set;
                mt.tagButton.classList.add(`esgst-hidden`);
                mt.popout.popout.appendChild(mt.tagButton);
            }
            mt.count = insertHtml(mt.popout.popout, `beforeEnd`, `
                <div><span>0</span> selected.</div>
            `).firstElementChild;
        }
    }

    function selectMtCheckboxes(mt, key, callback) {
        callback();
        selectSwitches(mt[`${mt.type}Checkboxes`], key);
    }

    function openMtPopup(mt, callback) {
        callback();
        popup = new Popup(`fa-tags`, `Multi-tag <span>${mt.count.textContent}</span> ${mt.type}s:`);
        set = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveMtTags.bind(null, mt, popup));
        popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Drag the tags to move them.<br/><br/>When editing a tag color, it will also alter the color for all users/games with that tag (you have to refresh the page for it to take effect).<br/><br/>[*] means that there are tags that are not shared between all users/games. If you delete the [*] tag, those individual tags will be deleted.</div>`);
        popup.tags = insertHtml(popup.description, `beforeEnd`, `<div class="esgst-${mt.type === `user` ? `ut` : `gt`}-tags"></div>`);
        popup.input = insertHtml(popup.description, `beforeEnd`, `<input type="text"/>`);
        popup.input.addEventListener(`keydown`, triggerSetOnEnter.bind(null, set));
        if (mt.type === `user`) {
            popup.input.addEventListener(`input`, createUtTags.bind(null, popup));
        } else {
            popup.input.addEventListener(`input`, createGtTags.bind(null, popup));
        }
        popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Use commas to separate tags, for example: Tag1, Tag2, ...</div>`);
        popup.description.appendChild(set.set);
        popup.open(loadMtTags.bind(null, mt, popup));
    }

    function loadMtTags(mt, popup) {
        var index, individual, savedUser, savedUsers, tags;
        mt.tags = [];
        if (mt.type === `user`) {
            getValue(`users`).then(value => {
                savedUsers = JSON.parse(value);
                mt.selectedUsers.forEach(username => {
                    savedUser = getUser(savedUsers, {
                        username: username
                    });
                    if (savedUser) {
                        tags = savedUser.tags;
                        if (tags) {
                            mt.users[username].tags = tags;
                            tags.forEach(tag => {
                                if (mt.tags.indexOf(tag) < 0) {
                                    mt.tags.push(tag);
                                }
                            });
                        } else {
                            mt.users[username].tags = [];
                        }
                    } else {
                        mt.users[username].tags = [];
                    }
                });
                individual = false;
                mt.selectedUsers.forEach(username => {
                    mt.users[username].tags.forEach(tag => {
                        mt.selectedUsers.forEach(subUsername => {
                            if (subUsername !== username && mt.users[subUsername].tags.indexOf(tag) < 0) {
                                index = mt.tags.indexOf(tag);
                                if (index >= 0) {
                                    mt.tags.splice(index, 1);
                                }
                                individual = true;
                            }
                        });
                    });
                });
                if (individual) {
                    mt.tags.push(`[*]`);
                }
                mt.tags.forEach(tag => {
                    createUtTag(popup, tag);
                });
                popup.input.value = mt.tags.join(`, `);
            });
        } else {
            getValue(`games`).then(value => {
                savedGames = JSON.parse(value);
                mt.selectedGames.apps.forEach(id => {
                    savedGame = savedGames.apps[id];
                    if (savedGame) {
                        tags = savedGame.tags;
                        if (tags) {
                            mt.games.apps[id].tags = tags;
                            tags.forEach(tag => {
                                if (mt.tags.indexOf(tag) < 0) {
                                    mt.tags.push(tag);
                                }
                            });
                        } else {
                            mt.games.apps[id].tags = [];
                        }
                    } else {
                        mt.games.apps[id].tags = [];
                    }
                });
                mt.selectedGames.subs.forEach(id => {
                    savedGame = savedGames.subs[id];
                    if (savedGame) {
                        tags = savedGame.tags;
                        if (tags) {
                            mt.games.subs[id].tags = tags;
                            tags.forEach(tag => {
                                if (mt.tags.indexOf(tag) < 0) {
                                    mt.tags.push(tag);
                                }
                            });
                        } else {
                            mt.games.subs[id].tags = [];
                        }
                    } else {
                        mt.games.subs[id].tags = [];
                    }
                });
                individual = false;
                mt.selectedGames.apps.forEach(id => {
                    mt.games.apps[id].tags.forEach(tag => {
                        mt.selectedGames.apps.forEach(subId => {
                            if (subId !== id && mt.games.apps[subId].tags.indexOf(tag) < 0) {
                                index = mt.tags.indexOf(tag);
                                if (index >= 0) {
                                    mt.tags.splice(index, 1);
                                }
                                individual = true;
                            }
                        });
                        mt.selectedGames.subs.forEach(subId => {
                            if (subId !== id && mt.games.subs[subId].tags.indexOf(tag) < 0) {
                                index = mt.tags.indexOf(tag);
                                if (index >= 0) {
                                    mt.tags.splice(index, 1);
                                }
                                individual = true;
                            }
                        });
                    });
                });
                mt.selectedGames.subs.forEach(id => {
                    mt.games.subs[id].tags.forEach(tag => {
                        mt.selectedGames.apps.forEach(subId => {
                            if (subId !== id && mt.games.apps[subId].tags.indexOf(tag) < 0) {
                                index = mt.tags.indexOf(tag);
                                if (index >= 0) {
                                    mt.tags.splice(index, 1);
                                }
                                individual = true;
                            }
                        });
                        mt.selectedGames.subs.forEach(subId => {
                            if (subId !== id && mt.games.subs[subId].tags.indexOf(tag) < 0) {
                                index = mt.tags.indexOf(tag);
                                if (index >= 0) {
                                    mt.tags.splice(index, 1);
                                }
                                individual = true;
                            }
                        });
                    });
                });
                if (individual) {
                    mt.tags.push(`[*]`);
                }
                mt.tags.forEach(tag => {
                    createGtTag(popup, tag);
                });
                popup.input.value = mt.tags.join(`, `);
            });
        }
    }

    function saveMtTags(mt, popup, callback) {
        var games, i, index, tags, users;
        if (mt.type === `user`) {
            users = [];
            tags = popup.input.value.replace(/(,\s*)+/g, formatTags);
            mt.selectedUsers.forEach(username => {
                mt.tags.forEach(tag => {
                    index = mt.users[username].tags.indexOf(tag);
                    if (index >= 0) {
                        mt.users[username].tags.splice(index, 1);
                    }
                });
                if (mt.users[username].tags.length > 0) {
                    mt.users[username].tags = tags.replace(/\[\*\]/, mt.users[username].tags.join(`, `)).split(/,\s/);
                } else {
                    mt.users[username].tags = tags.replace(/\[\*\]|,\s\[\*\]/, ``).split(/,\s/);
                }
                for (i = mt.users[username].tags.length - 1; i >= 0; --i) {
                    if (!mt.users[username].tags[i]) {
                        mt.users[username].tags.splice(i, 1);
                    }
                }
                users.push({
                    username: username,
                    values: {
                        tags: Array.from(new Set(mt.users[username].tags))
                    }
                });
            });
            saveUsers(users, completeMtSave.bind(null, mt, popup, callback));
        } else {
            games = {
                apps: {},
                subs: {}
            };
            tags = popup.input.value.replace(/(,\s*)+/g, formatTags);
            mt.selectedGames.apps.forEach(id => {
                mt.tags.forEach(tag => {
                    index = mt.games.apps[id].tags.indexOf(tag);
                    if (index >= 0) {
                        mt.games.apps[id].tags.splice(index, 1);
                    }
                });
                if (mt.games.apps[id].tags.length > 0) {
                    mt.games.apps[id].tags = tags.replace(/\[\*\]/, mt.games.apps[id].tags.join(`, `)).split(/,\s/);
                } else {
                    mt.games.apps[id].tags = tags.replace(/\[\*\]|,\s\[\*\]/, ``).split(/,\s/);
                }
                for (i = mt.games.apps[id].tags.length - 1; i >= 0; --i) {
                    if (!mt.games.apps[id].tags[i]) {
                        mt.games.apps[id].tags.splice(i, 1);
                    }
                }
                games.apps[id] = {
                    tags: Array.from(new Set(mt.games.apps[id].tags))
                };
            });
            mt.selectedGames.subs.forEach(id => {
                mt.tags.forEach(tag => {
                    index = mt.games.subs[id].tags.indexOf(tag);
                    if (index >= 0) {
                        mt.games.subs[id].tags.splice(index, 1);
                    }
                });
                if (mt.games.subs[id].tags.length > 0) {
                    mt.games.subs[id].tags = tags.replace(/\[\*\]/, mt.games.subs[id].tags.join(`, `)).split(/,\s/);
                } else {
                    mt.games.subs[id].tags = tags.replace(/\[\*\]|,\s\[\*\]/, ``).split(/,\s/);
                }
                for (i = mt.games.subs[id].tags.length - 1; i >= 0; --i) {
                    if (!mt.games.subs[id].tags[i]) {
                        mt.games.subs[id].tags.splice(i, 1);
                    }
                }
                games.subs[id] = {
                    tags: Array.from(new Set(mt.games.subs[id].tags))
                };
            });
            lockAndSaveGames(games, completeMtSave.bind(null, mt, popup, callback));
        }
    }

    function completeMtSave(mt, popup, callback) {
        if (mt.type === `user`) {
            setSetting(`ut_colors`, esgst.ut_colors);
            mt.selectedUsers.forEach(username => {
                addUtTags(username, mt.users[username].tags);
            });
        } else {
            setSetting(`gt_colors`, esgst.gt_colors);
            mt.selectedGames.apps.forEach(id => {
                addGtTags(null, id, mt.games.apps[id].tags, `apps`);
            });
            mt.selectedGames.subs.forEach(id => {
                addGtTags(null, id, mt.games.subs[id].tags, `subs`);
            });
        }
        callback();
        popup.close();
    }

    /* */

    function debug() {
        let popup, textArea;
        popup = new Popup(`fa-bug`, `Debug`);
        popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-description">Insert the Javascript code below to debug it. To open the console, use Ctrl + Shift + I.<br><br><span class="esgst-bold esgst-red">BE CAREFUL! Only do this if you know what you are doing or if you have been instructed to.<br><br>Playing with this when you do not know what you are doing could lead to serious consequences, such as having your entire data wiped out.<br><br>YOU HAVE BEEN WARNED!</span></div>`);
        textArea = insertHtml(popup.scrollable, `beforeEnd`, `<textarea class="esgst-debug"></textarea>`);
        popup.description.appendChild(new ButtonSet(`green`, ``, `fa-bug`, ``, `Debug`, ``, callback => {
            callback();
            try {
                eval(textArea.value);
            } catch (e) {
                console.log(e);
            }
        }).set);
        popup.open(() => textArea.focus());
    }

    function requestGroupInvite() {
        request(`username=${esgst.username}`, null, `POST`, false, `https://script.google.com/macros/s/AKfycbw0odO9iXZBJmK54M_MUQ_IEv5l4RNzj7cEx_FWCZbrtNBNmQ/exec`, () => {
            new Popup(``, `Request sent! You should be accepted in 24 hours at most.`, true).open();
        });
    }

    function filterSm(event) {
        let collapse, element, expand, found, id, type, typeFound, value;
        value = event.currentTarget.value.toLowerCase().trim();
        for (type in esgst.features) {
            found = false;
            typeFound = false;
            for (id in esgst.features[type].features) {
                found = filterSmFeature(esgst.features[type].features[id], id, value);
                if (found) {
                    typeFound = true;
                    unhideSmFeature(esgst.features[type].features[id], id);
                }
            }
            element = document.getElementById(`esgst_${type}`);
            if (element) {
                if (typeFound) {
                    element.classList.remove(`esgst-hidden`);
                } else {
                    element.classList.add(`esgst-hidden`);
                }
                if (value) {
                    expand = element.getElementsByClassName(`fa-plus-square`)[0];
                    if (expand) {
                        expand.click();
                    }
                } else {
                    collapse = element.getElementsByClassName(`fa-minus-square`)[0];
                    if (collapse) {
                        collapse.click();
                    }
                }
            }
        }
    }

    function filterSmFeature(feature, id, value) {
        let element, found, subId;
        found = false;
        if (feature.features) {
            for (subId in feature.features) {
                found = found || filterSmFeature(feature.features[subId], subId, value);
            }
            found = found || (feature.description && feature.description.toLowerCase().match(value)) || feature.name.toLowerCase().match(value);
        } else {
            found = (feature.description && feature.description.toLowerCase().match(value)) || feature.name.toLowerCase().match(value);
        }
        element = document.getElementById(`esgst_${id}`);
        if (element) {
            if (found) {
                element.classList.remove(`esgst-hidden`);
            } else {
                element.classList.add(`esgst-hidden`);
            }
        }
        return found;
    }

    function unhideSmFeature(feature, id) {
        let element = document.getElementById(`esgst_${id}`);
        if (element) {
            element.classList.remove(`esgst-hidden`);
        }
        if (feature.features) {
            for (id in feature.features) {
                unhideSmFeature(feature.features[id], id);
            }
        }
    }

    function loadSMMenu(tab) {
        let I, Container, SMManageFilteredUsers, SMAPIKey, popup;
        if (tab) {
            document.body.className = `esgst-tab-menu`;
            Container = document.body;
        } else {
            popup = new Popup(`fa-gear`, `Settings`, true, true);
            popup.description.classList.add(`esgst-text-left`);
            Container = popup.scrollable;
        }
        Container.innerHTML = `
            <div class="esgst-page-heading"></div>
            <input placeholder="Filter features..." type="text">
            <div class="esgst-settings-menu"></div>
        `;
        Container.firstElementChild.nextElementSibling.addEventListener(`input`, filterSm);
        var heading = Container.getElementsByClassName(`esgst-page-heading`)[0];
        createSMButtons(heading, [{
            Check: true,
            Icons: [`fa-refresh`],
            Name: `esgst-heading-button`,
            Title: `Sync data`
        }, {
            Check: true,
            Icons: [`fa-arrow-circle-up`],
            Name: `esgst-heading-button`,
            Title: `Import data`
        }, {
            Check: true,
            Icons: [`fa-arrow-circle-down`],
            Name: `esgst-heading-button`,
            Title: `Export data`
        }, {
            Check: true,
            Icons: [`fa-trash`],
            Name: `esgst-heading-button`,
            Title: `Delete data`
        }, {
            Check: true,
            Icons: [`fa-gear`, `fa-arrow-circle-down`],
            Name: `esgst-heading-button`,
            Title: `Export settings (exports settings without personal data so you can easily share them with other users)`
        }, {
            Check: true,
            Icons: [`fa-paint-brush`],
            Name: `esgst-heading-button`,
            Title: `Clean old data`
        }, {
            Check: true,
            Icons: [`fa-user`, `fa-history`],
            Name: `SMViewUsernameChanges esgst-heading-button`,
            Title: `View recent username changes`
        }, {
            Check: esgst.uf,
            Icons: [`fa-user`, `fa-eye-slash`],
            Name: `SMManageFilteredUsers esgst-heading-button`,
            Title: `See list of filtered users`
        }, {
            Check: esgst.sg && esgst.gf && esgst.gf_s,
            Icons: [`fa-gift`, `fa-eye-slash`],
            Name: `SMManageFilteredGiveaways esgst-heading-button`,
            Title: `Manage hidden giveaways`
        }, {
            Check: esgst.sg && esgst.df && esgst.df_s,
            Icons: [`fa-comments`, `fa-eye-slash`],
            Name: `SMManageFilteredDiscussions esgst-heading-button`,
            Title: `Manage hidden discussions`
        }, {
            Check: esgst.ut,
            Icons: [`fa-user`, `fa-tags`],
            Name: `SMManageUserTags esgst-heading-button`,
            Title: `Manage user tags`
        }, {
            Check: esgst.gt,
            Icons: [`fa-gamepad`, `fa-tags`],
            Name: `SMManageGameTags esgst-heading-button`,
            Title: `Manage game tags`
        }, {
            Check: esgst.wbc,
            Icons: [`fa-heart`, `fa-ban`, `fa-cog`],
            Name: `esgst-wbc-button esgst-heading-button`,
            Title: `Manage Whitelist / Blacklist Checker caches`
        }, {
            Check: esgst.namwc,
            Icons: [`fa-trophy`, `fa-cog`],
            Name: `esgst-namwc-button esgst-heading-button`,
            Title: `Manage Not Activated / Multiple Wins Checker caches`
        }, {
            Check: true,
            Icons: [`fa-bug`],
            Name: `esgst-heading-button`,
            Title: `Debug`
        }, {
            Check: true,
            Icons: [`fa-steam`],
            Name: `esgst-heading-button`,
            Title: `Request access to the Steam group`
        }]);
        var SMMenu = Container.getElementsByClassName(`esgst-settings-menu`)[0];
        let i, type;
        i = 1;
        for (type in esgst.features) {
            if (type !== `trades` || esgst.settings.esgst_st) {
                let id, j, section, title;
                title = type.replace(/^./, m => { return m.toUpperCase() });
                section = createMenuSection(SMMenu, null, i, esgst.features[type].newBelow ? `
                    <span class="esgst-bold esgst-red" title="There is a new feature/option in this section">
                        <i class="fa fa-star"></i>
                    </span>
                    ${title}
                ` : title, type);
                j = 1;
                for (id in esgst.features[type].features) {
                    let feature, ft;
                    feature = esgst.features[type].features[id];
                    ft = getSMFeature(feature, id, j);
                    if (ft) {
                        section.lastElementChild.appendChild(ft);
                        j += 1;
                    }
                }
                i += 1;
            }
        }
        createMenuSection(SMMenu, `
            <input class="esgst-steam-api-key" type="text"/>
            <div class="esgst-description">This is optional for syncing owned games faster and required for syncing alt accounts. Get a Steam API Key <a class="esgst-bold" href="https://steamcommunity.com/dev/apikey" target="_blank">here</a>.</div>
        `, i, `Steam API Key`);
        SMManageFilteredUsers = Container.getElementsByClassName(`SMManageFilteredUsers`)[0];
        var SMManageFilteredGiveaways = Container.getElementsByClassName(`SMManageFilteredGiveaways`)[0];
        var SMManageFilteredDiscussions = Container.getElementsByClassName(`SMManageFilteredDiscussions`)[0];
        var SMManageUserTags = Container.getElementsByClassName(`SMManageUserTags`)[0];
        var SMManageGameTags = Container.getElementsByClassName(`SMManageGameTags`)[0];
        var SMViewUsernameChanges = Container.getElementsByClassName(`SMViewUsernameChanges`)[0];
        if (esgst.wbc) {
            addWBCButton(null, Container.getElementsByClassName(`esgst-wbc-button`)[0]);
        }
        var SMNAMWCButton = Container.getElementsByClassName(`esgst-namwc-button`)[0];
        if (esgst.namwc) {
            setNAMWCPopup(SMNAMWCButton, null, true);
        }
        SMAPIKey = Container.getElementsByClassName(`esgst-steam-api-key`)[0];
        key = esgst.steamApiKey;
        if (key) {
            SMAPIKey.value = key;
        }
        heading.firstElementChild.addEventListener(`click`, () => {
            heading.firstElementChild.classList.add(`esgst-busy`);
            checkSync(true, () => {
                heading.firstElementChild.classList.remove(`esgst-busy`);
            });
        });
        heading.firstElementChild.nextElementSibling.addEventListener(`click`, loadDataManagement.bind(null, false, `import`, null));
        heading.firstElementChild.nextElementSibling.nextElementSibling.addEventListener(`click`, loadDataManagement.bind(null, false, `export`, null));
        heading.firstElementChild.nextElementSibling.nextElementSibling.nextElementSibling.addEventListener(`click`, loadDataManagement.bind(null, false, `delete`, null));
        heading.firstElementChild.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.addEventListener(`click`, exportSettings);
        heading.firstElementChild.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.addEventListener(`click`, loadDataCleaner);
        heading.lastElementChild.previousElementSibling.addEventListener(`click`, debug);
        heading.lastElementChild.addEventListener(`click`, requestGroupInvite);
        if (SMManageUserTags) {
            SMManageUserTags.addEventListener(`click`, openManageUserTagsPopup);
        }
        if (SMManageGameTags) {
            SMManageGameTags.addEventListener(`click`, openManageGameTagsPopup);
        }
        if (SMManageFilteredUsers) {
            setSMManageFilteredUsers(SMManageFilteredUsers);
        }
        if (SMManageFilteredGiveaways) {
            setSMManageFilteredGiveaways(SMManageFilteredGiveaways);
        }
        if (SMManageFilteredDiscussions) {
            setSMManageFilteredDiscussions(SMManageFilteredDiscussions);
        }
        if (SMViewUsernameChanges) {
            setSMRecentUsernameChanges(SMViewUsernameChanges);
        }
        SMAPIKey.addEventListener(`input`, function () {
            setSetting(`steamApiKey`, SMAPIKey.value);
        });
        if (!tab) {
            popup.open();
            if (esgst.firstInstall) {
                let pp = new Popup(`fa-check`, `Getting Started`, true);
                pp.scrollable.innerHTML = `
                    <div class="esgst-bold">Here are some things you should know to help you get started:</div>
                    <br/>
                    <div class="markdown">
                        <ul>
                            <li>Bugs and suggestions should be reported on the <a href="https://github.com/revilheart/ESGST/issues">GitHub page</a>.</li>
                            <li>Make sure you backup your data using the export button at the top of the menu every once in a while to prevent any data loss that might occur. It's also probably a good idea to disable automatic updates, since ESGST is in constant development.</li>
                            <li>Hover over the <i class="fa fa-question-circle"></i> icon next to each option that has it to learn more about it and how to use it. Some options are currently missing documentation, so feel free to ask about them in the official ESGST thread.</li>
                            <li>Some features rely on sync to work properly. These features have a <i class="fa fa-refresh esgst-negative"></i> icon next to their names, and when you hover over the icon you can see what type of data you have to sync. You should sync often to keep your data up-to-date. ESGST offers an option to automatically sync your data for you every amount of days so you don't have to do it manually. To enable the automatic sync, simply go to the sync section of the menu (section 1) and select the number of days in the dropdown.</li>
                            <li>ESGST uses 2 terms to define a window opened in the same page: <strong>popout</strong> is when the window opens up, down, left or right from the element you clicked/hovered over (like the one you get with the description of the features) and <strong>popup</strong> is when the window opens in the center of the screen with a modal background behind it (like this one).</li>
                            <li>That's all for now, you can close this.</li>
                        </ul>
                    </div>
                `;
                pp.open();
                esgst.firstInstall = false;
            }
        }
    }

    function getSMFeature(Feature, ID, aaa) {
        var Menu, Checkbox, CheckboxInput, SMFeatures;
        Menu = document.createElement(`div`);
        Menu.id = `esgst_${ID}`;
        Menu.insertAdjacentHTML(`beforeEnd`, `
            <div class="esgst-sm-small-number esgst-form-heading-number">${aaa}.</div>
        `);
        if (Feature.new) {
            Menu.insertAdjacentHTML(`beforeEnd`, `
                <span class="esgst-bold esgst-red" title="This is a new feature/option">[NEW]</span>
            `);
        } else if (Feature.newBelow) {
            Menu.insertAdjacentHTML(`beforeEnd`, `
                <span class="esgst-bold esgst-red" title="There is a new feature/option in this section">
                    <i class="fa fa-star"></i>
                </span>
            `);
        }
        var localID, val, val1, val2;
        var siwtchSg, siwtchSt;
        if (Feature.sg) {
            localID = `${ID}_sg`;
            val1 = esgst.settings[localID];
            if (typeof val1 === `undefined`) {
                val1 = false;
            }
            siwtchSg = new ToggleSwitch(Menu, ID, true, esgst.settings.esgst_st ? `[SG]` : ``, true, false, null, val1);
            if (Feature.conflicts) {
                siwtchSg.onEnabled = () => {
                    for (let ci = 0, cn = Feature.conflicts.length; ci < cn; ++ci) {
                        if (esgst.settings[`${Feature.conflicts[ci].id}_sg`]) {
                            siwtchSg.disable();
                            new Popup(`fa-exclamation`, `This feature conflicts with ${Feature.conflicts[ci].name}. While that feature is enabled, this feature cannot be enabled.`, true).open();
                            ci = cn;
                        }
                    }
                }
            }
        }
        if (Feature.st && (esgst.settings.esgst_st || ID === `esgst`)) {
            localID = `${ID}_st`;
            val2 = esgst.settings[localID];
            if (typeof val2 === `undefined`) {
                val2 = false;
            }
            siwtchSt = new ToggleSwitch(Menu, ID, true, `[ST]`, false, true, null, val2);
            if (Feature.conflicts) {
                siwtchSt.onEnabled = () => {
                    for (let ci = 0, cn = Feature.conflicts.length; ci < cn; ++ci) {
                        if (esgst.settings[`${Feature.conflicts[ci].id}_st`]) {
                            siwtchSt.disable();
                            new Popup(`fa-exclamation`, `This feature conflicts with ${Feature.conflicts[ci].name}. While that feature is enabled, this feature cannot be enabled.`, true).open();
                            ci = cn;
                        }
                    }
                }
            }
        }
        if (siwtchSg || siwtchSt) {
        val = val1 || val2;
        Menu.insertAdjacentHTML(`beforeEnd`, `
            <span>${esgst.settings.esgst_st ? `- ` : ``}${Feature.name}</span> ${Feature.features ? `<i class="fa fa-ellipsis-h" title="This option has sub-options"></i>` : ``} ${Feature.sync ? `<i class="esgst-negative fa fa-refresh" title="This feature requires ${Feature.sync} data to be synced (section 1 of this menu)"></i>` : ``} ${Feature.description ? `<i class="fa fa-question-circle esgst-clickable"></i>` : ``}
            <div class="esgst-form-row-indent SMFeatures esgst-hidden"></div>
        `);
        SMFeatures = Menu.lastElementChild;
        if (Feature.description) {
            var tool = SMFeatures.previousElementSibling;
            var popout;
            popout = new Popout(`esgst-feature-description markdown`, tool, 100);
            popout.popout.style.maxHeight = `300px`;
            popout.popout.style.overflow = `auto`;
            popout.popout.innerHTML = Feature.description;
        }
        if (Feature.features) {
            let ft, i, id;
            i = 1;
            for (id in Feature.features) {
                ft = getSMFeature(Feature.features[id], id, i);
                if (ft) {
                    SMFeatures.appendChild(ft);
                    i += 1;
                }
            }
            if (siwtchSg) {
                siwtchSg.dependencies.push(SMFeatures);
            }
            if (siwtchSt) {
                siwtchSt.dependencies.push(SMFeatures);
            }
            if (val) {
                SMFeatures.classList.remove(`esgst-hidden`);
            }
        }
        if (ID === `gc`) {
            var elements = [];
            for (i = 0, n = esgst.gc_categories.length; i < n; ++i) {
                switch (esgst.gc_categories[i]) {
                    case `gc_fcv`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-fullCV ${esgst.gc_fcv ? `` : `esgst-hidden`}" draggable="true" id="gc_fcv" title="Full CV">${esgst.gc_fcv_s ? (esgst.gc_fcv_s_i ? `<i class="fa fa-${esgst.gc_fcvIcon}"></i>` : `FCV`) : esgst.gc_fcvLabel}</div>
                        `);
                        break;
                    case `gc_rcv`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-reducedCV ${esgst.gc_rcv ? `` : `esgst-hidden`}" draggable="true" id="gc_rcv" title="Reduced CV">${esgst.gc_rcv_s ? (esgst.gc_rcv_s_i ? `<i class="fa fa-${esgst.gc_rcvIcon}"></i>` : `RCV`) : esgst.gc_rcvLabel}</div>
                        `);
                        break;
                    case `gc_ncv`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-noCV ${esgst.gc_ncv ? `` : `esgst-hidden`}" draggable="true" id="gc_ncv" title="No CV">${esgst.gc_ncv_s ? (esgst.gc_ncv_s_i ? `<i class="fa fa-${esgst.gc_ncvIcon}"></i>` : `NCV`) : esgst.gc_ncvLabel}</div>
                        `);
                        break;
                    case `gc_h`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-hidden ${esgst.gc_h ? `` : `esgst-hidden`}" draggable="true" id="gc_h" title="Hidden">${esgst.gc_h_s ? (esgst.gc_h_s_i ? `<i class="fa fa-${esgst.gc_hIcon}"></i>` : `H`) : esgst.gc_hLabel}</div>
                        `);
                        break;
                    case `gc_i`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-ignored ${esgst.gc_i ? `` : `esgst-hidden`}" draggable="true" id="gc_i" title="Ignored">${esgst.gc_i_s ? (esgst.gc_i_s_i ? `<i class="fa fa-${esgst.gc_iIcon}"></i>` : `I`) : esgst.gc_iLabel}</div>
                        `);
                        break;
                    case `gc_o`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-owned ${esgst.gc_o ? `` : `esgst-hidden`}" draggable="true" id="gc_o" title="Owned">${esgst.gc_o_s ? (esgst.gc_o_s_i ? `<i class="fa fa-${esgst.gc_oIcon}"></i>` : `O`) : esgst.gc_oLabel}</div>
                        `);
                        esgst.gc_o_altAccounts.forEach(account => {
                            elements.push(`
                                <div class="esgst-clickable esgst-gc esgst-gc-owned ${esgst.gc_o ? `` : `esgst-hidden`}" draggable="true" id="gc_o" style="background-color: ${account.bgColor} !important; color: ${account.color} !important;" title="Owned by ${account.name}">${esgst.gc_o_s ? (esgst.gc_o_s_i ? `<i class="fa fa-${account.icon}"></i>` : `O`) : account.label}</div>
                            `);
                        });
                        break;
                    case `gc_w`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-wishlisted ${esgst.gc_w ? `` : `esgst-hidden`}" draggable="true" id="gc_w" title="Wishlisted">${esgst.gc_w_s ? (esgst.gc_w_s_i ? `<i class="fa fa-${esgst.gc_wIcon}"></i>` : `W`) : esgst.gc_wLabel}</div>
                        `);
                        break;
                    case `gc_gi`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-giveawayInfo ${esgst.gc_gi ? `` : `esgst-hidden`}" draggable="true" id="gc_gi" title="Giveaway Info"><i class="fa fa-info"></i> 0 <i class="fa fa-dollar"></i> 0</div>
                        `);
                        break;
                    case `gc_r`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-rating esgst-gc-rating-positive ${esgst.gc_r ? `` : `esgst-hidden`}" draggable="true" id="gc_r" title="Rating"><i class="fa fa-thumbs-up"></i>${esgst.gc_r_s ? ` 0% (0)` : ``}</div>
                        `);
                        break;
                    case `gc_a`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-achievements ${esgst.gc_a ? `` : `esgst-hidden`}" draggable="true" id="gc_a" title="Achievements">${esgst.gc_a_s ? (esgst.gc_a_s_i ? `<i class="fa fa-${esgst.gc_aIcon}"></i>` : `A`) : esgst.gc_aLabel}</div>
                        `);
                        break;
                    case `gc_mp`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-multiplayer ${esgst.gc_mp ? `` : `esgst-hidden`}" draggable="true" id="gc_mp" title="Multiplayer">${esgst.gc_mp_s ? (esgst.gc_mp_s_i ? `<i class="fa fa-${esgst.gc_mpIcon}"></i>` : `MP`) : esgst.gc_mpLabel}</div>
                        `);
                        break;
                    case `gc_sc`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-steamCloud ${esgst.gc_sc ? `` : `esgst-hidden`}" draggable="true" id="gc_sc" title="Steam Cloud">${esgst.gc_sc_s ? (esgst.gc_sc_s_i ? `<i class="fa fa-${esgst.gc_scIcon}"></i>` : `SC`) : esgst.gc_scLabel}</div>
                        `);
                        break;
                    case `gc_tc`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-tradingCards ${esgst.gc_tc ? `` : `esgst-hidden`}" draggable="true" id="gc_tc" title="Trading Cards">${esgst.gc_tc_s ? (esgst.gc_tc_s_i ? `<i class="fa fa-${esgst.gc_tcIcon}"></i>` : `TC`) : esgst.gc_tcLabel}</div>
                        `);
                        break;
                    case `gc_l`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-linux ${esgst.gc_l ? `` : `esgst-hidden`}" draggable="true" id="gc_l" title="Linux">${esgst.gc_l_s ? (esgst.gc_l_s_i ? `<i class="fa fa-${esgst.gc_lIcon}"></i>` : `L`) : esgst.gc_lLabel}</div>
                        `);
                        break;
                    case `gc_m`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-mac ${esgst.gc_m ? `` : `esgst-hidden`}" draggable="true" id="gc_m" title="Mac">${esgst.gc_m_s ? (esgst.gc_m_s_i ? `<i class="fa fa-${esgst.gc_mIcon}"></i>` : `M`) : esgst.gc_mLabel}</div>
                        `);
                        break;
                    case `gc_dlc`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-dlc ${esgst.gc_dlc ? `` : `esgst-hidden`}" draggable="true" id="gc_dlc" title="DLC">${esgst.gc_dlc_s ? (esgst.gc_dlc_s_i ? `<i class="fa fa-${esgst.gc_dlcIcon}"></i>` : `DLC`) : esgst.gc_dlcLabel}</div>
                        `);
                        break;
                    case `gc_p`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-package ${esgst.gc_p ? `` : `esgst-hidden`}" draggable="true" id="gc_p" title="Package">${esgst.gc_p_s ? (esgst.gc_p_s_i ? `<i class="fa fa-${esgst.gc_pIcon}"></i>` : `P`) : esgst.gc_pLabel}</div>
                        `);
                        break;
                    case `gc_ea`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-earlyAccess ${esgst.gc_ea ? `` : `esgst-hidden`}" draggable="true" id="gc_ea" title="Early Access">${esgst.gc_ea_s ? (esgst.gc_ea_s_i ? `<i class="fa fa-${esgst.gc_eaIcon}"></i>` : `EA`) : esgst.gc_eaLabel}</div>
                        `);
                        break;
                    case `gc_rm`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-removed ${esgst.gc_rm ? `` : `esgst-hidden`}" draggable="true" id="gc_rm" title="Removed">${esgst.gc_rm_s ? (esgst.gc_rm_s_i ? `<i class="fa fa-${esgst.gc_rmIcon}"></i>` : `RM`) : esgst.gc_rmLabel}</div>
                        `);
                        break;
                    case `gc_g`:
                        elements.push(`
                            <div class="esgst-clickable esgst-gc esgst-gc-genres ${esgst.gc_g ? `` : `esgst-hidden`}" draggable="true" id="gc_g" title="Genres">Genres</div>
                        `);
                        break;
                }
            }
            var panel = insertHtml(SMFeatures, `beforeEnd`, `
                <div class="esgst-description">Drag the categories to sort them.</div>
                <div class="esgst-gc-panel">${elements.join(``)}</div>
            `);
            var sm = {
                panel: panel
            };
            for (i = 0, n = panel.children.length; i < n; ++i) {
                var child = panel.children[i];
                child.addEventListener(`dragstart`, setSmSource.bind(null, child, sm));
                child.addEventListener(`dragenter`, getSmSource.bind(null, child, sm));
                child.addEventListener(`dragend`, saveSmSource.bind(null, sm));
            }
        } else if (ID === `gwc`) {
            addGwcrMenuPanel(SMFeatures, `gwc_colors`, `chance`);
        } else if (ID === `gwr`) {
            addGwcrMenuPanel(SMFeatures, `gwr_colors`, `ratio`);
        } else if (Feature.colors || Feature.background) {
            var color = esgst[`${ID}_color`];
            var bgColor = esgst[`${ID}_bgColor`];
            var html = `
                <div class="esgst-sm-colors">
                    ${Feature.background ? `` : `Text: <input type="color" value="${color}">`}
                    Background: <input type="color" value="${bgColor}">
                    <div class="form__saving-button esgst-sm-colors-default">Use Default</div>
                </div>
            `;
            SMFeatures.insertAdjacentHTML(`beforeEnd`, html);
            var colorContext = SMFeatures.lastElementChild.firstElementChild;
            var bgColorContext = Feature.background ? colorContext : colorContext.nextElementSibling;
            if (!Feature.background) {
                addColorObserver(colorContext, ID, `color`);
            }
            addColorObserver(bgColorContext, ID, `bgColor`);
            bgColorContext.nextElementSibling.addEventListener(`click`, function () {
                if (!Feature.background) {
                    colorContext.value = esgst.defaultValues[`${ID}_color`];
                    setSetting(`${ID}_color`, colorContext.value);
                }
                bgColorContext.value = esgst.defaultValues[`${ID}_bgColor`];
                setSetting(`${ID}_bgColor`, bgColorContext.value);
            });
            if (ID === `gc_g`) {
                input = insertHtml(SMFeatures, `beforeEnd`, `
                    <div class="esgst-sm-colors">
                        <span class="esgst-bold esgst-red" title="This is a new feature/option">[NEW]</span>
                        Only show the following genres: <input type="text" value="${esgst.gc_g_filters}">
                        <i class="fa fa-question-circle" title="If you enter genres here, a genre category will only appear if the game has the listed genre. Separate genres with a comma, for example: Genre1, Genre2"></i>
                    </div>
                `);
                input.firstElementChild.nextElementSibling.addEventListener(`change`, function() {
                    setSetting(`gc_g_filters`, input.firstElementChild.nextElementSibling.value);
                    esgst.gc_g_filters = input.firstElementChild.nextElementSibling.value;
                });
                addGcMenuPanel(SMFeatures);
            } else if (ID === `gc_o`) {
                addGcAltMenuPanel(SMFeatures);
            }
            if (Feature.input) {
                input = insertHtml(SMFeatures, `beforeEnd`, `
                    <div class="esgst-sm-colors">
                        Icon: <input type="text" value="${esgst[`${ID}Icon`]}"> <i class="esgst-clickable fa fa-question-circle"></i>
                        <br/>
                        Label: <input type="text" value="${esgst[`${ID}Label`]}">
                    </div>
                `);
                createTooltip(input.firstElementChild.nextElementSibling, `The name of the icon must be any name in this page: <a href="http://fontawesome.io/icons/">http://fontawesome.io/icons/</a> (except for the 41 new icons from 4.7, SG doesn't support that)`);
                input.firstElementChild.addEventListener(`change`, function() {
                    setSetting(`${ID}Icon`, input.firstElementChild.value);
                    esgst[`${ID}Icon`] = input.firstElementChild.value;
                });
                input.lastElementChild.addEventListener(`change`, function() {
                    setSetting(`${ID}Label`, input.lastElementChild.value);
                    esgst[`${ID}Label`] = input.lastElementChild.value;
                });
            }
            if (siwtchSg) {
                siwtchSg.dependencies.push(SMFeatures);
            }
            if (siwtchSt) {
                siwtchSt.dependencies.push(SMFeatures);
            }
            if (val) {
                SMFeatures.classList.remove(`esgst-hidden`);
            }
        } else if (Feature.input) {
            var input, prev, next;
            if (ID === `npth`) {
                input = insertHtml(SMFeatures, `beforeEnd`, `
                    <div class="esgst-sm-colors">
                        Enter the key you want to use for previous links: <input type="text" value=${esgst.npth_previousKey}>
                        <br/>
                        Enter the key you want to use for next links: <input type="text" value=${esgst.npth_nextKey}>
                    </div>
                `);
                prev = input.firstElementChild;
                next = input.lastElementChild;
                prev.addEventListener(`keydown`, function (e) {
                    e.preventDefault();
                    setSetting(`npth_previousKey`, e.key);
                    esgst.npth_previousKey = e.key;
                    prev.value = e.key;
                });
                next.addEventListener(`keydown`, function (e) {
                    e.preventDefault();
                    setSetting(`npth_nextKey`, e.key);
                    esgst.npth_nextKey = e.key;
                    next.value = e.key;
                });
            } else if (ID.match(/^sk_/)) {
                setSkMenu(Feature.input, insertHtml(SMFeatures, `beforeEnd`, `
                    <div class="esgst-sm-colors"></div>`
                ));
            } else if (ID === `gb_h`) {
                var hours = esgst.gb_hours;
                input = insertHtml(SMFeatures, `beforeEnd`, `
                    <div class="esgst-sm-colors">
                        Time range to trigger highlight: <input type="text" value=${hours}> hours
                    </div>
                `);
                input.firstElementChild.addEventListener(`change`, function() {
                    setSetting(`gb_hours`, input.firstElementChild.value);
                    esgst.gb_hours = input.firstElementChild.value;
                });
            } else if (ID === `hr_w_h`) {
                var hours = esgst.hr_w_hours;
                input = insertHtml(SMFeatures, `beforeEnd`, `
                    <div class="esgst-sm-colors">
                        Hours: <input type="text" value=${hours}>
                    </div>
                `);
                input.firstElementChild.addEventListener(`change`, function() {
                    setSetting(`hr_w_hours`, input.firstElementChild.value);
                    esgst.hr_w_hours = input.firstElementChild.value;
                });
            } else if (ID === `autoBackup`) {
                var days = esgst.autoBackup_days;
                input = insertHtml(SMFeatures, `beforeEnd`, `
                    <div class="esgst-sm-colors">
                        Days: <input type="text" value=${days}>
                    </div>
                `);
                input.firstElementChild.addEventListener(`change`, function() {
                    setSetting(`autoBackup_days`, input.firstElementChild.value);
                    esgst.autoBackup_days = input.firstElementChild.value;
                });
            } else if (ID === `hr`) {
                input = insertHtml(SMFeatures, `beforeEnd`, `
                    <div class="esgst-sm-colors">
                        Refresh every <input type="text" value=${esgst.hr_minutes}> minutes
                    </div>
                `);
                input.firstElementChild.addEventListener(`change`, function() {
                    setSetting(`hr_minutes`, input.firstElementChild.value);
                    esgst.hr_minutes = input.firstElementChild.value;
                });
            } else if (ID === `elgb_f`) {
                input = insertHtml(SMFeatures, `beforeEnd`, `
                    <div class="esgst-sm-colors">
                        Filters: <input style="width: 300px;" type="text" value="${esgst.elgb_filters}"> <i class="fa fa-question-circle" title="Enter only lowercase letters with no spaces and separate filters with '|'.\n\nFor example, if you want to filter out 'Good luck! No need to thank, unless you're the winner.', use the filter 'goodlucknoneedtothankunlessyourethewinner'.\n\nIf you're familiar with regular expressions, you can also use them. For example, to include a variation of the description above that uses 'you are' instead of 'you're' you could use the filter 'goodlucknoneedtothankunlessyoua?rethewinner'. 'a?' will match or not an 'a' between 'you' and 're'.\n\nThe '.' filter, for example, filters out any descriptions that only have one letter."></i>
                    </div>
                `);
                input.firstElementChild.addEventListener(`change`, function() {
                    setSetting(`elgb_filters`, input.firstElementChild.value);
                    esgst.elgb_filters = input.firstElementChild.value;
                });
            }
            if (siwtchSg) {
                siwtchSg.dependencies.push(SMFeatures);
            }
            if (siwtchSt) {
                siwtchSt.dependencies.push(SMFeatures);
            }
            if (val) {
                SMFeatures.classList.remove(`esgst-hidden`);
            }
        }
        if (Feature.options) {
            var index = esgst[`${ID}_index`];
            var options = ``;
            for (var j = 0, jj = Feature.options.values.length; j < jj; ++j) {
                options += `<option>${Feature.options.values[j]}</option>`;
            }
            var select = insertHtml(SMFeatures, `beforeEnd`, `
                <div class="esgst-sm-colors">
                    ${Feature.options.title}
                    <select>
                        ${options}
                    </select>
                </div>
            `);
            select.firstElementChild.selectedIndex = index;
            select.firstElementChild.addEventListener(`change`, function() {
                setSetting(`${ID}_index`, select.firstElementChild.selectedIndex);
                esgst[`${ID}_index`] = select.firstElementChild.selectedIndex;
            });
            if (siwtchSg) {
                siwtchSg.dependencies.push(SMFeatures);
            }
            if (siwtchSt) {
                siwtchSt.dependencies.push(SMFeatures);
            }
            if (val) {
                SMFeatures.classList.remove(`esgst-hidden`);
            }
        }
        return Menu;
        } else {
            Menu.lastElementChild.remove();
            return null;
        }
    }

    function setSkMenu(id, input) {
        let value, context = insertHtml(input, `beforeEnd`, `
            Enter the key you want to use for this task: <input type="text" value="${esgst[id]}">
        `);
        context.addEventListener(`keydown`, event => {
            event.preventDefault();
            event.stopPropagation();
            if (!event.repeat) {
                value = ``;
                if (event.ctrlKey) {
                    value += `ctrlKey + `;
                } else if (event.shiftKey) {
                    value += `shiftKey + `;
                } else if (event.altKey) {
                    value += `altKey + `;
                }
                value += event.key.toLowerCase();
            }
        }, true);
        context.addEventListener(`keyup`, event => {
            setSetting(id, value);
            esgst[id] = value;
            event.currentTarget.value = value;
        });
    }

    function setSmSource(child, sm, event) {
        event.dataTransfer.setData(`text/plain`, ``);
        sm.source = child;
    }

    function getSmSource(child, sm) {
        var categories, current, i, n;
        current = sm.source;
        do {
            current = current.previousElementSibling;
            if (current && current === child) {
                sm.panel.insertBefore(sm.source, child);
                return;
            }
        } while (current);
        sm.panel.insertBefore(sm.source, child.nextElementSibling);
    }

    function saveSmSource(sm) {
        var categories, i, n;
        categories = [];
        for (i = 0, n = sm.panel.children.length; i < n; ++i) {
            categories.push(sm.panel.children[i].id);
        }
        setSetting(`gc_categories`, categories);
    }

    function addGwcrMenuPanel(context, id, key) {
        var button, colors, i, n, panel;
        panel = insertHtml(context, `beforeEnd`, `
            <div class="esgst-sm-colors">
                <div class="form__saving-button esgst-sm-colors-default">
                    <span>Add Color Setting</span>
                </div>
                <i class="fa fa-question-circle" title="Allows you to set different colors for different ${key} ranges."></i>
            </div>
        `);
        button = panel.firstElementChild;
        for (i = 0, n = esgst[id].length; i < n; ++i) {
            addGwcColorSetting(esgst[id][i], id, key, panel);
        }
        button.addEventListener(`click`, function () {
            colors = {
                color: `#ffffff`,
                lower: `0`,
                upper: `100`
            };
            esgst[id].push(colors);
            addGwcColorSetting(colors, id, key, panel);
        });
    }

    function addGwcColorSetting(colors, id, key, panel) {
        var color, i, lower, n, remove, setting, upper;
        setting = insertHtml(panel, `beforeEnd`, `
            <div>
                From <input step="0.01" type="number" value="${colors.lower}"/> to <input step="0.01" type="number" value="${colors.upper}"/> ${key}, color it as <input type="color" value="${colors.color}"/>. <i class="esgst-clickable fa fa-times" title="Delete this setting"></i>
            </div>
        `);
        lower = setting.firstElementChild;
        upper = lower.nextElementSibling;
        color = upper.nextElementSibling;
        remove = color.nextElementSibling;
        lower.addEventListener(`change`, function () {
            colors.lower = lower.value;
            setSetting(id, esgst[id]);
        });
        upper.addEventListener(`change`, function () {
            colors.upper = upper.value;
            setSetting(id, esgst[id]);
        });
        color.addEventListener(`change`, function () {
            colors.color = color.value;
            setSetting(id, esgst[id]);
        });
        remove.addEventListener(`click`, function () {
            if (confirm(`Are you sure you want to delete this setting?`)) {
                for (i = 0, n = esgst[id].length; i < n && esgst[id][i] !== colors; ++i);
                if (i < n) {
                    esgst[id].splice(i, 1);
                    setSetting(id, esgst[id]);
                    setting.remove();
                }
            }
        });
    }

    function addGcMenuPanel(context) {
        var button, colorSetting, i, n, panel;
        panel = insertHtml(context, `beforeEnd`, `
            <div class="esgst-sm-colors">
                <div class="form__saving-button esgst-sm-colors-default">
                    <span>Add Custom Genre Color</span>
                </div>
                <i class="fa fa-question-circle" title="Allows you to color genres (colored genres will appear at the beginning of the list)."></i>
            </div>
        `);
        button = panel.firstElementChild;
        for (i = 0, n = esgst.gc_g_colors.length; i < n; ++i) {
            addGcColorSetting(esgst.gc_g_colors[i], panel);
        }
        button.addEventListener(`click`, function () {
            colorSetting = {
                bgColor: `#7f8c8d`,
                color: `#ffffff`,
                genre: ``
            };
            esgst.gc_g_colors.push(colorSetting);
            addGcColorSetting(colorSetting, panel);
        });
    }

    function addGcColorSetting(colorSetting, panel) {
        var color, genre, i, n, remove, setting;
        setting = insertHtml(panel, `beforeEnd`, `
            <div>
                For genre <input type="text" value="${colorSetting.genre}"/>, color it as <input type="color" value="${colorSetting.color}"> with background <input type="color" value="${colorSetting.bgColor}">. <i class="esgst-clickable fa fa-times" title="Delete this setting"></i>
            </div>
        `);
        genre = setting.firstElementChild;
        color = genre.nextElementSibling;
        bgColor = color.nextElementSibling;
        remove = bgColor.nextElementSibling;
        genre.addEventListener(`change`, function () {
            colorSetting.genre = genre.value;
            setSetting(`gc_g_colors`, esgst.gc_g_colors);
        });
        color.addEventListener(`change`, function () {
            colorSetting.color = color.value;
            setSetting(`gc_g_colors`, esgst.gc_g_colors);
        });
        bgColor.addEventListener(`change`, function () {
            colorSetting.bgColor = bgColor.value;
            setSetting(`gc_g_colors`, esgst.gc_g_colors);
        });
        remove.addEventListener(`click`, function () {
            if (confirm(`Are you sure you want to delete this setting?`)) {
                for (i = 0, n = esgst.gc_g_colors.length; i < n && esgst.gc_g_colors[i] !== colorSetting; ++i);
                if (i < n) {
                    esgst.gc_g_colors.splice(i, 1);
                    setSetting(`gc_g_colors`, esgst.gc_g_colors);
                    setting.remove();
                }
            }
        });
    }

    function addGcAltMenuPanel(context) {
        var altSetting, button, i, n, panel;
        panel = insertHtml(context, `beforeEnd`, `
            <div class="esgst-sm-colors">
                <div class="form__saving-button esgst-sm-colors-default">
                    <span>Add Alt Account</span>
                </div>
            </div>
        `);
        button = panel.firstElementChild;
        createTooltip(insertHtml(panel, `beforeEnd`, `<i class="fa fa-question-circle"></i>`), `
            <div>You must sync your owned games normally for the script to pick up the games owned by your alt accounts. Syncing with alt accounts only works with a Steam API Key though, so make sure one is set at the last section of this menu.</div>
            <br/>
            <div>Steam ID is the number that comes after "steamcommunity.com/profiles/" in your alt account's URL. If your alt account has a URL in the format "steamcommunity.com/id/" though, you can get your Steam ID <a href="https://steamid.io/">here</a> by entering your URL in the input (you want the steamID64 one).</div>
            <br/>
            <div>You must fill the fields relative to your settings. For example, if you have simplified version enabled with icons, you must fill the "icon" field. If you don't have simplified version enabled, you must fill the "label" field. The current text in the fields are simply placeholders.</div>
        `);
        for (i = 0, n = esgst.gc_o_altAccounts.length; i < n; ++i) {
            addGcAltSetting(esgst.gc_o_altAccounts[i], panel);
        }
        button.addEventListener(`click`, function () {
            altSetting = {
                bgColor: `#000000`,
                color: `#ffffff`,
                games: {
                    apps: {},
                    subs: {}
                },
                icon: ``,
                label: ``,
                name: ``,
                steamId: ``
            };
            esgst.gc_o_altAccounts.push(altSetting);
            addGcAltSetting(altSetting, panel);
        });
    }

    function addGcAltSetting(altSetting, panel) {
        var color, bgColor, i, icon, label, n, name, remove, setting, steamId;
        setting = insertHtml(panel, `beforeEnd`, `
            <div>
                For account with Steam ID <input placeholder="0000000000000000" type="text" value="${altSetting.steamId}"/>, using the nickname <input placeholder="alt1" type="text" value="${altSetting.name}"/>, <br/>color it as <input type="color" value="${altSetting.color}"/> with background <input type="color" value="${altSetting.bgColor}"/>, icon <input placeholder="folder" type="text" value="${altSetting.icon}"/> and label <input placeholder="Owned by alt1" type="text" value="${altSetting.label}"/>. <i class="esgst-clickable fa fa-times" title="Delete this setting"></i>
            </div>
        `);
        steamId = setting.firstElementChild;
        name = steamId.nextElementSibling;
        color = name.nextElementSibling.nextElementSibling;
        bgColor = color.nextElementSibling;
        icon = bgColor.nextElementSibling;
        label = icon.nextElementSibling;
        remove = label.nextElementSibling;
        steamId.addEventListener(`change`, function () {
            altSetting.steamId = steamId.value;
            setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
        });
        name.addEventListener(`change`, function () {
            altSetting.name = name.value;
            setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
        });
        color.addEventListener(`change`, function () {
            altSetting.color = color.value;
            setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
        });
        bgColor.addEventListener(`change`, function () {
            altSetting.bgColor = bgColor.value;
            setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
        });
        icon.addEventListener(`change`, function () {
            altSetting.icon = icon.value;
            setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
        });
        label.addEventListener(`change`, function () {
            altSetting.label = label.value;
            setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
        });
        remove.addEventListener(`click`, function () {
            if (confirm(`Are you sure you want to delete this setting?`)) {
                for (i = 0, n = esgst.gc_o_altAccounts.length; i < n && esgst.gc_o_altAccounts[i] !== altSetting; ++i);
                if (i < n) {
                    esgst.gc_o_altAccounts.splice(i, 1);
                    setSetting(`gc_o_altAccounts`, esgst.gc_o_altAccounts);
                    setting.remove();
                }
            }
        });
    }

    function addColorObserver(context, id, key) {
        context.addEventListener(`change`, function () {
            setSetting(`${id}_${key}`, context.value);
        });
    }

    function createMenuSection(context, html, number, title, type) {
        let section = insertHtml(context, `beforeEnd`, `
            <div class="esgst-form-row" id="esgst_${type}">
                <div class="esgst-form-heading">
                    <div class="esgst-form-heading-number">${number}.</div>
                    <div class="esgst-form-heading-text">${title}</div>
                </div>
                <div class="esgst-form-row-indent">${html ? html : ``}</div>
            </div>
        `);
        if (esgst.collapseSections && !title.match(/(Im|Ex)port|Delete/)) {
            let button, container, isExpanded;
            button = insertHtml(section.firstElementChild, `afterBegin`, `
                <span class="esgst-clickable" style="margin-right: 5px;">
                    <i class="fa fa-plus-square" title="Expand section"></i>
                </span>
            `);
            container = section.lastElementChild;
            container.classList.add(`esgst-hidden`);
            isExpanded = false;
            button.addEventListener(`click`, () => {
                if (isExpanded) {
                    container.classList.add(`esgst-hidden`);
                    button.innerHTML = `<i class="fa fa-plus-square" title="Expand section"></i>`;
                    isExpanded = false;
                } else {
                    container.classList.remove(`esgst-hidden`);
                    button.innerHTML = `<i class="fa fa-minus-square" title="Collapse section"></i>`;
                    isExpanded = true;
                }
            });
        }
        return section;
    }

    function createSMButtons(Heading, Items) {
        var I, N, Item, Icons, J, NumIcons;
        for (I = 0, N = Items.length; I < N; ++I) {
            Item = Items[I];
            if (Item.Check) {
                Icons = ``;
                for (J = 0, NumIcons = Item.Icons.length; J < NumIcons; ++J) {
                    Icons += `<i class="fa ${Item.Icons[J]}"></i> `;
                }
                Heading.insertAdjacentHTML(`beforeEnd`, `<a class="${Item.Name}" title="${Item.Title}">${Icons}</a>`);
            }
        }
    }

    function setSMManageFilteredUsers(SMManageFilteredUsers) {
        var popup;
        SMManageFilteredUsers.addEventListener(`click`, function() {
            if (popup) {                
                popup.open();
            } else {
                popup = new Popup(`fa-eye-slash`, `Filtered Users`);
                getValue(`users`).then(value => {
                    var users = JSON.parse(value);
                    var filtered = [];
                    for (var key in users.users) {
                        if (users.users[key].uf && (users.users[key].uf.posts || users.users[key].uf.giveaways || users.users[key].uf.discussions)) {
                            filtered.push(users.users[key]);
                        }
                    }
                    filtered.sort(function(a, b) {
                        if (a.username > b.username) {
                            return -1;
                        } else {
                            return 1;
                        }
                    });
                    var table = insertHtml(popup.scrollable, `beforeEnd`, `
                        <div class="table">
                            <div class="table__heading">
                                <div class="table__column--width-fill">Username</div>
                                <div class="table__column--width-small">Posts Hidden</div>
                                <div class="table__column--width-small">Discussions Hidden</div>
                                <div class="table__column--width-small">Giveaways Hidden</div>
                            </div>
                            <div class="table__rows"></div>
                        </div>
                    `);
                    for (var i = 0, n = filtered.length; i < n; ++i) {
                        var postsIcon = filtered[i].uf.posts ? `<i class="fa fa-check"></i>` : ``;
                        var discussionsIcon = filtered[i].uf.discussions ? `<i class="fa fa-check"></i>` : ``;
                        var giveawaysIcon = filtered[i].uf.giveaways ? `<i class="fa fa-check"></i>` : ``;
                        table.lastElementChild.insertAdjacentHTML(`beforeEnd`, `
                            <div class="table__row-outer-wrap">
                                <div class="table__row-inner-wrap">
                                    <div class="table__column--width-fill"><a href="/user/${filtered[i].username}">${filtered[i].username}</a></div>
                                    <div class="table__column--width-small">${postsIcon}</div>
                                    <div class="table__column--width-small">${discussionsIcon}</div>
                                    <div class="table__column--width-small">${giveawaysIcon}</div>
                                </div>
                            </div>
                        `);
                    }
                    popup.open();
                });
            }
        });
    }

    function setSMManageFilteredDiscussions(SMManageFilteredDiscussions) {
        var discussion, discussions, hidden, i, popup, set;
        SMManageFilteredDiscussions.addEventListener(`click`, function() {
            popup = new Popup(`fa-comments`, `Hidden Discussions`);
            popup.discussions = insertHtml(popup.scrollable, `afterBegin`, `
                <div class="table esgst-text-left">
                    <div class="table__heading">
                        <div class="table__column--width-fill">Summary</div>
                        <div class="table__column--width-small text-center">Comments</div>
                    </div>
                </div>
            `);
            getValue(`discussions`).then(value => {
                discussions = JSON.parse(value);
                hidden = [];
                for (key in discussions) {
                    if (discussions[key].hidden) {
                        discussion = {
                            code: key,
                            hidden: discussions[key].hidden
                        };
                        hidden.push(discussion);
                    }
                }
                hidden = hidden.sort((a, b) => {
                    if (a.hidden > b.hidden) {
                        return -1;
                    } else if (a.hidden < b.hidden) {
                        return 1;
                    } else {
                        return 0;
                    }
                });
                i = 0;
                set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load more...`, `Loading more...`, function (callback) {
                    getDfDiscussions(hidden, i, i, i + 5, popup, function (value) {
                        i = value;
                        if (i > hidden.length) {
                            set.set.remove();
                        } else if (esgst.es_df && popup.scrollable.scrollHeight <= popup.scrollable.offsetHeight) {
                            set.trigger();
                        }
                        callback();
                    });
                });
                popup.description.appendChild(set.set);
                popup.open();
                set.trigger();
                if (esgst.es_df) {
                    popup.scrollable.addEventListener(`scroll`, function () {
                        if ((popup.scrollable.scrollTop + popup.scrollable.offsetHeight) >= popup.scrollable.scrollHeight && !set.busy) {
                            set.trigger();
                        }
                    });
                }
            });
        });
    }

    function getDfDiscussions(hidden, i, j, n, popup, callback) {
        var key;
        if (i < n) {
            if (hidden[i]) {
                request(null, null, `GET`, false, `/discussion/${hidden[i].code}/`, function(response) {
                    var breadcrumbs, categoryLink, context, usernameLink;
                    context = parseHtml(response.responseText);
                    breadcrumbs = context.getElementsByClassName(`page__heading__breadcrumbs`);
                    categoryLink = breadcrumbs[0].firstElementChild.nextElementSibling.nextElementSibling;
                    usernameLink = context.getElementsByClassName(`comment__username`)[0].firstElementChild;
                    popup.discussions.insertAdjacentHTML(`beforeEnd`, `
                        <div>
                            <div class="table__row-outer-wrap">
                                <div class="table__row-inner-wrap">
                                    <div>
                                        ${context.getElementsByClassName(`global__image-outer-wrap`)[0].outerHTML}
                                    </div>
                                    <div class="table__column--width-fill">
                                        <h3>
                                            <a class="table__column__heading" href="/discussion/${hidden[i].code}/">${categoryLink.nextElementSibling.nextElementSibling.firstElementChild.textContent}</a>
                                        </h3>
                                        <p>
                                            <a class="table__column__secondary-link" href="${categoryLink.getAttribute(`href`)}">${categoryLink.textContent}</a> -
                                            ${context.querySelector(`.comment [data-timestamp]`).outerHTML} ago by
                                            <a class="table__column__secondary-link" href="${usernameLink.getAttribute(`href`)}">${usernameLink.textContent}</a>
                                        </p>
                                    </div>
                                    <div class="table__column--width-small text-center">
                                        <a class="table__column__secondary-link" href="/discussion/${hidden[i].code}/">${breadcrumbs[1].textContent.match(/(.+) Comments?/)[1]}</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `);
                    loadEndlessFeatures(popup.discussions.lastElementChild).then(() => {
                        if (!esgst.giveawaysPath && !esgst.discussionsPath) {
                            if (esgst.gdttt) {
                                addCtDiscussionPanels(popup.discussions.lastElementChild, true);
                                checkGdtttVisited(popup.discussions.lastElementChild);
                            } else if (esgst.ct) {
                                addCtDiscussionPanels(popup.discussions.lastElementChild, true);
                            }
                            loadDiscussionFeatures(popup.discussions.lastElementChild);
                        }
                        setTimeout(getDfDiscussions, 0, hidden, ++i, ++j, n, popup, callback);
                    });
                });
            } else {
                callback(j + 1);
            }
        } else {
            callback(j);
        }
    }

    function setSMManageFilteredGiveaways(SMManageFilteredGiveaways) {
        var gfGiveaways, giveaway, hidden, i, key, n, popup, set;
        SMManageFilteredGiveaways.addEventListener(`click`, function() {
            popup = new Popup(`fa-gift`, `Hidden Giveaways`, true);
            hidden = [];
            for (key in esgst.giveaways) {
                giveaway = esgst.giveaways[key];
                if (giveaway.hidden && giveaway.code && giveaway.endTime) {
                    if (Date.now() >= giveaway.endTime) {
                        delete giveaway.hidden;
                    } else {
                        hidden.push(giveaway);
                    }
                } else {
                    delete giveaway.hidden;
                }
            }
            hidden = hidden.sort((a, b) => {
                if (a.hidden > b.hidden) {
                    return -1;
                } else if (a.hidden < b.hidden) {
                    return 1;
                } else {
                    return 0;
                }
            });
            setValue(`giveaways`, JSON.stringify(esgst.giveaways));
            i = 0;
            n = hidden.length;
            gfGiveaways = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-text-left"></div>`);
            if (n > 0) {
                set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load more...`, `Loading more...`, function (callback) {
                    loadGfGiveaways(i, i + 5, hidden, gfGiveaways, popup, function (value) {
                        i = value;
                        if (i > n) {
                            set.set.remove();
                        } else if (esgst.es_gf && popup.scrollable.scrollHeight <= popup.scrollable.offsetHeight) {
                            set.trigger();
                        }
                        callback();
                    });
                });
                popup.description.appendChild(set.set);
                popup.open();
                set.trigger();
                if (esgst.es_gf) {
                    popup.scrollable.addEventListener(`scroll`, function () {
                        if ((popup.scrollable.scrollTop + popup.scrollable.offsetHeight) >= popup.scrollable.scrollHeight && !set.busy) {
                            set.trigger();
                        }
                    });
                }
            } else {
                gfGiveaways.textContent = `No hidden giveaways found.`;
                popup.open();
            }
        });
    }

    function loadGfGiveaways(i, n, hidden, gfGiveaways, popup, callback) {
        var giveaway;
        if (i < n) {
            if (hidden[i]) {
                request(null, null, `GET`, true, `https://www.steamgifts.com/giveaway/${hidden[i].code}/`, function (response) {
                    giveaway = buildGiveaway(parseHtml(response.responseText), response.finalUrl);
                    if (giveaway) {
                        gfGiveaways.insertAdjacentHTML(`beforeEnd`, giveaway.html);
                        loadEndlessFeatures(gfGiveaways.lastElementChild, false, `gf`).then(() => {
                            setTimeout(loadGfGiveaways, 0, ++i, n, hidden, gfGiveaways, popup, callback);
                        });
                    } else {
                        setTimeout(loadGfGiveaways, 0, ++i, n, hidden, gfGiveaways, popup, callback);
                    }
                });
            } else {
                callback(i + 1);
            }
        } else {
            callback(i);
        }
    }

    function getDate(timestamp) {
        let date = new Date(timestamp);
        return `${[`Jan`, `Feb`, `Mar`, `Apr`, `May`, `Jun`, `Jul`, `Aug`, `Sep`, `Oct`, `Nov`, `Dec`][date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
    }

    function setSMManageEntriesTracker(button) {
        var average, date, dates, entry, entries, highest, history, historyHtml, i, key, keys, lowest, popup, table, tableHtml, total;
        button.addEventListener(`click`, function () {
            getValue(`entries`, `[]`).then(value => {
                entries = JSON.parse(value);
                historyHtml = ``;
                dates = {};
                for (i = entries.length - 1; i >= 0; --i) {
                    entry = entries[i];
                    historyHtml += `
                        <li>
                            ${entry.entry ? `Entered` : `Left`} <a href="/giveaway/${entry.code}/">${entry.name}</a> on ${getTimestamp(entry.timestamp / 1e3, esgst.at_24, esgst.at_s)}
                        </li>
                    `;
                    date = getDate(entry.timestamp);
                    key = new Date(date).getTime();
                    if (!dates[key]) {
                        dates[key] = {
                            date: date,
                            entered: 0,
                            left: 0
                        };
                    }
                    if (entry.entry) {
                        dates[key].entered += 1;
                    } else {
                        dates[key].left += 1;
                    }
                }
                tableHtml = `
                    <div class="esgst-text-left esgst-float-right table" style="padding-left: 5px; width: auto;">
                        <div class="table__heading">
                            <div class="table__column--width-small">Date</div>
                            <div class="table__column--width-small">Entered</div>
                            <div class="table__column--width-small">Left</div>
                        </div>
                        <div class="table__rows">
                `;
                keys = Object.keys(dates);
                keys.sort();
                lowest = {
                    count: 999999999,
                    date: null
                };
                highest = {
                    count: 0,
                    date: null
                };
                total = 0;
                for (i = keys.length - 1; i > -1; --i) {
                    key = keys[i];
                    tableHtml += `
                        <div class="table__row-outer-wrap">
                            <div class="table__row-inner-wrap">
                                <div class="table__column--width-small">${dates[key].date}</div>
                                <div class="table__column--width-small">${dates[key].entered}</div>
                                <div class="table__column--width-small">${dates[key].left}</div>
                            </div>
                        </div>
                    `;
                    total += dates[key].entered;
                    if (dates[key].entered < lowest.count) {
                        lowest.count = dates[key].entered;
                        lowest.date = dates[key].date;
                    }
                    if (dates[key].entered > highest.count) {
                        highest.count = dates[key].entered;
                        highest.date = dates[key].date;
                    }
                }
                tableHtml += `
                        </div>
                    </div>
                `;
                average = Math.round(total / keys.length * 100) / 100;
                popup = new Popup(`fa-history`, `Entries Tracker`, true);
                popup.description.insertAdjacentHTML(`afterBegin`, `
                    <div>
                        You enter on average <span class="esgst-bold">${average}</span> giveaways per day.
                    </div>
                    <div>
                        Your highest entry count was on <span class="esgst-italic">${highest.date}</span> with <span class="esgst-bold">${highest.count}</span> entries.
                    </div>
                    <div>
                        Your lowest entry count was on <span class="esgst-italic">${lowest.date}</span> with <span class="esgst-bold">${lowest.count}</span> entries.
                    </div>
                `);
                history = insertHtml(popup.scrollable, `beforeEnd`, `
                    <div class="esgst-text-left esgst-float-left markdown" style="border-right: 1px solid #ccc; padding-right: 5px;">
                        <ul>${historyHtml}</ul>
                    </div>
                `);
                table = insertHtml(popup.scrollable, `beforeEnd`, tableHtml);
                popup.scrollable.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-clear"></div>`);
                popup.open();
            });
        });
    }

    function openManageUserTagsPopup() {
        var button, context, current, input, mt, popup, savedUser, savedUsers, toggleSwitch, users;
        popup = new Popup(`fa-tags`, `Manage user tags:`, true);
        input = insertHtml(popup.description, `afterBegin`, `<input type="text"/>`);
        popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-description">Type tags below to filter the users by.</div>`);
        button = insertHtml(popup.description, `afterBegin`, `
            <div class="esgst-page-heading">
                <div class="esgst-heading-button">
                    <span></span>
                    <span>
                        <i class="fa fa-user"></i>
                        <i class="fa fa-tags"></i>
                    </span>
                </div>
            </div>
        `).firstElementChild;
        toggleSwitch = new ToggleSwitch(button.firstElementChild, null, true, ``);
        getValue(`users`).then(value => {
            savedUsers = JSON.parse(value);        
            current = {};
            users = {};
            for (steamId in savedUsers.users) {
                savedUser = savedUsers.users[steamId];
                if (savedUser.tags && (savedUser.tags.length > 1 || savedUser.tags[0].trim())) {
                    context = insertHtml(popup.scrollable, `beforeEnd`, `
                        <div>
                            <a href="/user/${savedUser.username}">${savedUser.username}</a>
                        </div>
                    `);
                    current[savedUser.username] = {
                        elements: [context.firstElementChild]
                    };
                    users[savedUser.username] = {
                        context: context
                    };
                }
            }
            return loadEndlessFeatures(popup.scrollable);
        }).then(() => {
            mt = {
                button: button,
                type: `user`
            };
            toggleSwitch.onEnabled = enableMt.bind(null, mt, current);
            toggleSwitch.onDisabled = disableMt.bind(null, mt);
            button.lastElementChild.addEventListener(`click`, openMtPopout.bind(null, mt));
            input.addEventListener(`input`, filterUserTags.bind(null, current, mt, popup, users));
            popup.open();
        });
    }

    function filterUserTags(current, mt, popup, users, event) {
        var i, tags, username, userTags;
        if (event.currentTarget.value) {
            tags = event.currentTarget.value.replace(/,\s+/g, ``).split(/,\s/);
            for (username in users) {
                userTags = users[username].context.getElementsByClassName(`esgst-ut-tags`)[0];
                for (i = tags.length - 1; i >= 0 && !userTags.innerHTML.match(new RegExp(`>${tags[i]}<`)); --i);
                if (i < 0) {
                    users[username].context.classList.add(`esgst-hidden`);
                } else {
                    users[username].context.classList.remove(`esgst-hidden`);
                }
            }
        } else {
            for (username in users) {
                users[username].context.classList.remove(`esgst-hidden`);
            }
        }
        if (mt.popout) {
            disableMt(mt);
            enableMt(mt, current);
        }
    }

    function openManageGameTagsPopup() {
        var button, context, current, games, input, mt, popup, savedGame, savedGames, toggleSwitch;
        popup = new Popup(`fa-tags`, `Manage game tags:`, true);
        input = insertHtml(popup.description, `afterBegin`, `<input type="text"/>`);
        popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-description">Type tags below to filter the games by.</div>`);
        button = insertHtml(popup.description, `afterBegin`, `
            <div class="esgst-page-heading">
                <div class="esgst-heading-button">
                    <span></span>
                    <span>
                        <i class="fa fa-gamepad"></i>
                        <i class="fa fa-tags"></i>
                    </span>
                </div>
            </div>
        `).firstElementChild;
        toggleSwitch = new ToggleSwitch(button.firstElementChild, null, true, ``);
        getValue(`games`).then(value => {
            savedGames = JSON.parse(value);
            current = {
                apps: {},
                subs: {}
            };
            games = {
                apps: {},
                subs: {}
            };
            for (id in savedGames.apps) {
                savedGame = savedGames.apps[id];
                if (savedGame.tags && (savedGame.tags.length > 1 || savedGame.tags[0].trim())) {
                    context = insertHtml(popup.scrollable, `beforeEnd`, `
                        <div class="table__row-outer-wrap">
                            <a class="table__column__heading" href="http://store.steampowered.com/app/${id}">App - ${id}</a>
                        </div>
                    `);
                    current.apps[id] = [{
                        heading: context
                    }];
                    games.apps[id] = {
                        context: context
                    };
                }
            }
            for (id in savedGames.subs) {
                savedGame = savedGames.subs[id];
                if (savedGame.tags && (savedGame.tags.length > 1 || savedGame.tags[0].trim())) {
                    context = insertHtml(popup.scrollable, `beforeEnd`, `
                        <div class="table__row-outer-wrap">
                            <a class="table__column__heading" href="http://store.steampowered.com/sub/${id}">Sub - ${id}</a>
                        </div>
                    `);
                    current.subs[id] = [{
                        heading: context
                    }];
                    games.subs[id] = {
                        context: context
                    };
                }
            }
            return loadEndlessFeatures(popup.scrollable);
        }).then(() => {
            mt = {
                button: button,
                type: `game`
            };
            toggleSwitch.onEnabled = enableMt.bind(null, mt, current);
            toggleSwitch.onDisabled = disableMt.bind(null, mt);
            button.lastElementChild.addEventListener(`click`, openMtPopout.bind(null, mt));
            input.addEventListener(`input`, filterGameTags.bind(null, current, games, mt, popup));
            popup.open();
        });
    }

    function filterGameTags(current, games, mt, popup, event) {
        var gameTags, i, id, tags;
        if (event.currentTarget.value) {
            tags = event.currentTarget.value.replace(/,\s+/g, ``).split(/,\s/);
            for (id in games.apps) {
                gameTags = games.apps[id].context.getElementsByClassName(`esgst-gt-tags`)[0];
                for (i = tags.length - 1; i >= 0 && !gameTags.innerHTML.match(new RegExp(`>${tags[i]}<`)); --i);
                if (i < 0) {
                    games.apps[id].context.classList.add(`esgst-hidden`);
                } else {
                    games.apps[id].context.classList.remove(`esgst-hidden`);
                }
            }
            for (id in games.subs) {
                gameTags = games.subs[id].context.getElementsByClassName(`esgst-gt-tags`)[0];
                for (i = tags.length - 1; i >= 0 && !gameTags.innerHTML.match(new RegExp(`>${tags[i]}<`)); --i);
                if (i < 0) {
                    games.subs[id].context.classList.add(`esgst-hidden`);
                } else {
                    games.subs[id].context.classList.remove(`esgst-hidden`);
                }
            }
        } else {
            for (id in games.apps) {
                games.apps[id].context.classList.remove(`esgst-hidden`);
            }
            for (id in games.subs) {
                games.subs[id].context.classList.remove(`esgst-hidden`);
            }
        }
        if (mt.popout) {
            disableMt(mt);
            enableMt(mt, current);
        }
    }

    function setSMRecentUsernameChanges(SMRecentUsernameChanges) {
        SMRecentUsernameChanges.addEventListener(`click`, function () {
            var popup, SMRecentUsernameChangesPopup;
            popup = new Popup(`fa-comments`, `Recent Username Changes`);
            popup.Progress = insertHtml(popup.description, `beforeEnd`, `
                <div>
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    <span>Loading recent username changes...</span>
                </div>
            `);
            popup.Results = insertHtml(popup.scrollable, `beforeEnd`, `
                <div class="esgst-uh-popup"></div>
            `);
            request(null, null, `GET`, false, `https://script.google.com/macros/s/AKfycbzvOuHG913mRIXOsqHIeAuQUkLYyxTHOZim5n8iP-k80iza6g0/exec?Action=2`, function (Response) {
                var RecentChanges, HTML, I, N;
                popup.Progress.innerHTML = ``;
                RecentChanges = JSON.parse(Response.responseText).RecentChanges;
                HTML = ``;
                for (I = 0, N = RecentChanges.length; I < N; ++I) {
                    HTML += `<div>${RecentChanges[I][0]} changed to <a class="esgst-bold" href="/user/${RecentChanges[I][1]}">${RecentChanges[I][1]}</a></div>`;
                }
                popup.Results.innerHTML = HTML;
                if (esgst.sg) {
                    loadEndlessFeatures(popup.Results);
                }
            });
            popup.open();
        });
    }

    function setSMCommentHistory(SMCommentHistory) {
        SMCommentHistory.addEventListener(`click`, function () {
            var comments, i, popup, set;
            popup = new Popup(`fa-comments`, `Comment History`);
            popup.commentHistory = insertHtml(popup.scrollable, `afterBegin`, `<div class="comments esgst-text-left"></div>`);
            getValue(`${esgst.name}CommentHistory`, `[]`).then(value => {
                comments = JSON.parse(value);
                i = 0;
                set = new ButtonSet(`green`, `grey`, `fa-plus`, `fa-circle-o-notch fa-spin`, `Load more...`, `Loading more...`, function (callback) {
                    getChComments(comments, i, i + 5, popup, function (value) {
                        i = value;
                        if (i > comments.length) {
                            set.set.remove();
                        } else if (esgst.es_ch && popup.scrollable.scrollHeight <= popup.scrollable.offsetHeight) {
                            set.trigger();
                        }
                        callback();
                    });
                });
                popup.description.appendChild(set.set);
                popup.open();
                set.trigger();
                if (esgst.es_ch) {
                    popup.scrollable.addEventListener(`scroll`, function () {
                        if ((popup.scrollable.scrollTop + popup.scrollable.offsetHeight) >= popup.scrollable.scrollHeight && !set.busy) {
                            set.trigger();
                        }
                    });
                }
            });
        });
    }

    function checkNewVersion() {
        if (esgst.version !== esgst.currentVersion) {
            if (typeof esgst.version === `undefined`) {
                esgst.firstInstall = true;
                popup = new Popup(`fa-smile-o`, `<i class="fa fa-circle-o-notch fa-spin"></i> Hi! ESGST is getting things ready for you. This will not take long...`, true);
                popup.open();
                checkSync(true, () => {
                    popup.title.innerHTML = `
                        <i class="fa fa-check"></i> Thanks for installing ESGST, <span>${esgst.username}</span>. You are ready to go! Click on the <span>Settings</span> link below to choose which features you want to use.
                    `;

                });
            } else if (esgst.showChangelog) {
                loadChangelog(esgst.version);
            }
            esgst.version = esgst.currentVersion;
            setValue(`version`, esgst.version);
        }
    }

    function loadGiveawayFeatures(context, main, source, endless) {
        return new Promise((resolve, reject) => {
            var i, n, savedGiveaways;
            getGiveaways(context, main, null, false, null, false, endless, source).then(giveaways => {
                if (main) {
                    for (i = giveaways.length - 1; i > -1; --i) {
                        giveaways[i].sortIndex = esgst.currentGiveaways.length;
                        esgst.currentGiveaways.push(giveaways[i]);
                    }
                } else {
                    for (i = giveaways.length - 1; i > -1; --i) {
                        giveaways[i].sortIndex = esgst.popupGiveaways.length;
                        esgst.popupGiveaways.push(giveaways[i]);
                    }
                }
                if (esgst.gwl && (((esgst.createdPath || esgst.enteredPath || esgst.wonPath || esgst.giveawayPath) && !main) || (!esgst.giveawayPath && !esgst.createdPath && !esgst.enteredPath && !esgst.wonPath))) {
                    addGwlLinks(giveaways);
                }
                for (i = 0, n = esgst.giveawayFeatures.length; i < n; ++i) {
                    esgst.giveawayFeatures[i](giveaways, main, source);
                }
                if (esgst.gas && esgst[esgst.gas.autoKey]) {
                    sortContent(giveaways, esgst[esgst.gas.optionKey]);
                }
                if (esgst.gf && esgst.gf.filteredCount && esgst[`gf_enable${esgst.gf.type}`]) {
                    filterGfGiveaways(esgst.gf, false, endless);
                }
                if (esgst.gfPopup && esgst.gfPopup.filteredCount && esgst[`gf_enable${esgst.gfPopup.type}`]) {
                    filterGfGiveaways(esgst.gfPopup);
                }
                if (esgst.gm_enable && esgst.gmCheckboxes) {
                    enableGm();
                    enableGm(true);
                }
                resolve();
            });
        });
    }

    function getGiveaways(context, main, mainUrl, hr, key, ged, endless, source) {
        return new Promise((resolve, reject) => {
            var games, giveaway, giveaways, i, mainContext, matches, n, query, savedUsers;
            getValues({
                games: `{"apps":{},"subs":{}}`,
                users: `{"steamIds":{},"users":{}}`
            }).then(values => {
                games = JSON.parse(values.games);
                savedUsers = JSON.parse(values.users);
                giveaways = [];
                if (!hr && main && (esgst.createdPath || esgst.enteredPath || esgst.wonPath)) {
                    query = `.giveaway__row-outer-wrap, .featured__outer-wrap--giveaway, .table:not(.table--summary) .table__row-outer-wrap`;
                } else {
                    query = `.giveaway__row-outer-wrap, .featured__outer-wrap--giveaway`;
                }
                if (key) {
                    mainContext = context;
                } else {
                    if (mainUrl) {
                        mainContext = context;
                        key = `data`;
                    } else {
                        mainContext = document;
                        key = `giveaway`;
                    }
                }
                matches = context.querySelectorAll(query);
                for (i = matches.length - 1; i > -1; --i) {
                    giveaway = getGiveawayInfo(matches[i], mainContext, games, savedUsers, null, null, main, mainUrl, ged, endless, source);
                    if (giveaway) {
                        giveaways.push(giveaway[key]);
                    }
                }
                resolve(giveaways);
            });
        });
    }

    function getGiveawayInfo(context, mainContext, games, savedUsers, ugd, ugdType, main, mainUrl, ged, endless, source) {
        var category, categories, chance, element, giveaway, i, id, info, key, keys, match, n, savedUser, uf, thinHeadings;
        giveaway = {};
        giveaway.outerWrap = context;
        giveaway.gameId = giveaway.outerWrap.getAttribute(`data-game-id`);
        info = getGameInfo(giveaway.outerWrap);
        if (info) {
            giveaway.id = info.id;
            giveaway.type = info.type;
            if (games && games[giveaway.type][giveaway.id]) {
                keys = [`owned`, `wishlisted`, `hidden`, `ignored`, `previouslyEntered`, `previouslyWon`, `reducedCV`, `noCV`];
                for (i = 0, n = keys.length; i < n; ++i) {
                    key = keys[i];
                    if (games[giveaway.type][giveaway.id][key === `previouslyEntered` ? `entered` : (key === `previouslyWon` ? `won` : key)]) {
                        giveaway[key] = true;
                    }
                }
            }
        }
        if (giveaway.outerWrap.classList.contains(`table__row-outer-wrap`) && esgst.giveawayPath) {
            return;
        }
        giveaway.innerWrap = giveaway.outerWrap.querySelector(`.giveaway__row-inner-wrap, .featured__inner-wrap, .table__row-inner-wrap`);
        giveaway.avatar = giveaway.outerWrap.querySelector(`.giveaway_image_avatar, .featured_giveaway_image_avatar`);
        giveaway.image = giveaway.outerWrap.querySelector(`.giveaway_image_thumbnail, .giveaway_image_thumbnail_missing, .global__image-outer-wrap--game-medium`);
        giveaway.summary = giveaway.innerWrap.querySelector(`.giveaway__summary, .featured__summary, .table__column--width-fill`);
        if (source === `gb`) {
            giveaway.entered = giveaway.outerWrap.getAttribute(`data-entered`);
        } else if (esgst.giveawayPath && main) {
            var button = mainContext.getElementsByClassName(`sidebar__entry-delete`)[0];
            if (button) {
                giveaway.entered = !button.classList.contains(`is-hidden`);
            }
        } else if (esgst.enteredPath && main) {
            giveaway.entered = true;
        } else {
            giveaway.entered = giveaway.innerWrap.classList.contains(`is-faded`);
        }
        giveaway.headingName = giveaway.innerWrap.querySelector(`.giveaway__heading__name, .featured__heading__medium, .table__column__heading`);
        giveaway.name = giveaway.headingName.textContent;
        match = giveaway.name.match(/\s\((.+) Copies\)/);
        if (match) {
            giveaway.name = giveaway.name.replace(match[0], ``);
            giveaway.copies = parseInt(match[1].replace(/,/g, ``).match(/\d+/)[0]);
        } else {
            giveaway.copies = 1;
        }
        giveaway.url = esgst.giveawayPath && main && !ugd ? location.pathname : (mainUrl || giveaway.headingName.getAttribute(`href`));
        if (giveaway.url) {
            match = giveaway.url.match(/\/giveaway\/(.+?)(\/.+?)$/);
            if (match) {
                giveaway.code = match[1];
            } else {
                return null;
            }
        }
        giveaway.pinned = giveaway.outerWrap.closest(`.pinned-giveaways__outer-wrap`);
        thinHeadings = giveaway.innerWrap.querySelectorAll(`.giveaway__heading__thin, .featured__heading__small`);
        n = thinHeadings.length;
        giveaway.points = 0;
        if (n > 0) {
            if (n > 1) {
                if (esgst.gch && !giveaway.pinned) {
                    thinHeadings[0].classList.add(`esgst-bold`, `esgst-red`);
                }
                giveaway.copies = parseInt(thinHeadings[0].textContent.replace(/,/g, ``).match(/\d+/)[0]);
                giveaway.pointsContainer = thinHeadings[1];
                giveaway.points = parseInt(thinHeadings[1].textContent.match(/\d+/)[0]);
            } else {
                giveaway.copies = 1;
                giveaway.pointsContainer = thinHeadings[0];
                giveaway.points = parseInt(thinHeadings[0].textContent.match(/\d+/)[0]);
            }
        }
        giveaway.columns = giveaway.innerWrap.querySelector(`.giveaway__columns, .featured__columns`);
        if (giveaway.columns && (!esgst.archivePath || !main)) {
            giveaway.endTimeColumn = giveaway.columns.firstElementChild;
            giveaway.started = !giveaway.endTimeColumn.textContent.match(/Begins/);
            giveaway.endTime = parseInt(giveaway.endTimeColumn.lastElementChild.getAttribute(`data-timestamp`)) * 1e3;
            giveaway.ended = !giveaway.deleted && giveaway.endTime < Date.now();
            if (giveaway.ended && ((main && (esgst.userPath || esgst.groupPath)) || ugd)) {
                giveaway.startTimeColumn = giveaway.endTimeColumn.nextElementSibling.nextElementSibling;
                if (giveaway.startTimeColumn.classList.contains(`giveaway__column--negative`)) {
                    giveaway.startTimeColumn = giveaway.startTimeColumn.nextElementSibling;
                }
            } else {
                giveaway.startTimeColumn = giveaway.endTimeColumn.nextElementSibling;
            }
            giveaway.startTime = parseInt(giveaway.startTimeColumn.firstElementChild.getAttribute(`data-timestamp`)) * 1e3;
            if (!esgst.userPath || (ugd && ugdType === `won`) || ged) {
                giveaway.creatorContainer = giveaway.startTimeColumn.lastElementChild;
                giveaway.creator = giveaway.creatorContainer.textContent;
            }
            giveaway.winners = giveaway.columns.textContent.match(/No winners/) ? 0 : giveaway.copies;
        } else {
            giveaway.started = true;
        }
        if (!giveaway.endTime && main && (esgst.createdPath || esgst.enteredPath || esgst.wonPath)) {
            giveaway.endTime = giveaway.innerWrap.querySelector(`[data-timestamp]`);
            if (giveaway.endTime) {
                giveaway.endTimeColumn = giveaway.endTime.parentElement;
                giveaway.started = !giveaway.endTimeColumn.textContent.match(/Begins/);
                giveaway.deleted = giveaway.endTimeColumn.parentElement.textContent.match(/Deleted/);
                giveaway.endTime = parseInt(giveaway.endTime.getAttribute(`data-timestamp`)) * 1e3;
            } else {
                giveaway.endTime = 0;
            }
            giveaway.ended = !giveaway.deleted && giveaway.endTime < Date.now();
        }
        if (!giveaway.ended) {
            giveaway.winners = 0;
        }
        if (ugd) {
            if (ugdType === `sent`) {
                giveaway.creator = ugd;
            }
        } else if (esgst.userPath && main && !ged) {
            giveaway.creator = location.pathname.match(/^\/user\/(.+?)(\/.*)?$/)[1];
        } else if (esgst.createdPath && main) {
            giveaway.creator = esgst.username;
        }
        if (esgst.createdPath && main) {
            var status = giveaway.outerWrap.querySelector(`.table__column--width-small.text-center:last-of-type`);
            if (status) {
                if (status.textContent.match(/Not\sReceived/)) {
                    giveaway.notReceived = true;
                } else if (status.textContent.match(/Received/)) {
                    giveaway.received = true;
                } else if (status.textContent.match(/Awaiting\sFeedback/)) {
                    giveaway.awaitingFeedback = true;
                }
            }
        }
        giveaway.created = giveaway.creator === esgst.username;
        if (esgst.uf && esgst.giveawaysPath && main && savedUsers) {
            savedUser = getUser(savedUsers, {
                username: giveaway.creator
            });
            if (savedUser) {
                uf = savedUser.uf;
                if (esgst.uf_g && savedUser.blacklisted && !uf) {
                    updateUfCount(giveaway.outerWrap.parentElement.nextElementSibling);
                    giveaway.outerWrap.remove();
                    return null;
                } else if (uf && uf.giveaways) {
                    updateUfCount(giveaway.outerWrap.parentElement.nextElementSibling);
                    giveaway.outerWrap.remove();
                    return null;
                }
            }
        }
        if (esgst.gf && esgst.gf_s && main) {
            var savedGiveaway = esgst.giveaways[giveaway.code];
            if ((esgst.giveawaysPath || esgst.groupPath) && savedGiveaway && savedGiveaway.hidden && savedGiveaway.code) {
                giveaway.outerWrap.remove();
                return null;
            }
        }
        giveaway.links = giveaway.innerWrap.getElementsByClassName(`giveaway__links`)[0];
        if (giveaway.links) {
            giveaway.links.classList.add(`esgst-giveaway-links`);
            giveaway.entriesLink = giveaway.links.firstElementChild;
            giveaway.commentsLink = giveaway.entriesLink.nextElementSibling;
        } else {
            giveaway.entriesLink = mainContext.getElementsByClassName(`sidebar__navigation__item__count`)[1];
            giveaway.commentsLink = mainContext.getElementsByClassName(`sidebar__navigation__item__count`)[0];
        }
        if (giveaway.entriesLink && giveaway.commentsLink) {
            giveaway.entries = parseInt(giveaway.entriesLink.textContent.replace(/,/g, ``).match(/\d+/)[0]);
            giveaway.comments = parseInt(giveaway.commentsLink.textContent.replace(/,/g, ``).match(/\d+/)[0]);
        }
        giveaway.panel = giveaway.innerWrap.getElementsByClassName(`esgst-giveaway-panel`)[0];
        if (!giveaway.panel && (esgst.gwc || esgst.gwr || esgst.gp || esgst.elgb || esgst.cewgd)) {
            if (giveaway.links) {
                giveaway.panel = insertHtml(giveaway.links, `afterEnd`, `
                    <div class="giveaway__columns esgst-giveaway-panel"></div>
                    <div style="clear: both;"></div>
                `);
                if (giveaway.startTimeColumn) {
                    element = giveaway.startTimeColumn.nextElementSibling;
                    while (element) {
                        giveaway.panel.appendChild(element);
                        element = giveaway.startTimeColumn.nextElementSibling;
                    }
                }
            } else if (giveaway.columns) {
                giveaway.panel = insertHtml(giveaway.columns, `afterEnd`, `<div class="featured__columns esgst-giveaway-panel"></div>`);
            } else if (esgst.enteredPath && (esgst.gwc || esgst.gwr)) {
                giveaway.panel = insertHtml(giveaway.innerWrap.firstElementChild.nextElementSibling, `afterEnd`, `<div class="table__column--width-small text-center esgst-giveaway-panel"></div>`);
            }
        }
        giveaway.elgbPanel = giveaway.panel;
        if (!giveaway.entriesLink) {
            var ct = giveaway.panel || (esgst.gm_enable && esgst.createdPath ? giveaway.innerWrap.firstElementChild.nextElementSibling.nextElementSibling : giveaway.innerWrap.firstElementChild.nextElementSibling);
            if (ct.nextElementSibling) {
                giveaway.entries = parseInt(ct.nextElementSibling.textContent.replace(/,/g, ``));
            }
        }
        giveaway.levelColumn = giveaway.outerWrap.querySelector(`.giveaway__column--contributor-level, .featured__column--contributor-level`);
        giveaway.level = giveaway.levelColumn ? parseInt(giveaway.levelColumn.textContent.match(/\d+/)[0]) : 0;
        giveaway.inviteOnly = giveaway.outerWrap.querySelector(`.giveaway__column--invite-only, .featured__column--invite-only`);
        giveaway.regionRestricted = giveaway.outerWrap.querySelector(`.giveaway__column--region-restricted, .featured__column--region-restricted`);
        giveaway.group = giveaway.outerWrap.querySelector(`.giveaway__column--group, .featured__column--group`);
        giveaway.whitelist = giveaway.outerWrap.querySelector(`.giveaway__column--whitelist, .featured__column--whitelist`);
        giveaway.public = !giveaway.inviteOnly && !giveaway.regionRestricted && !giveaway.group && !giveaway.whitelist;
        if (!main || !esgst.giveawayPath) {
            if (giveaway.inviteOnly) {
                giveaway.inviteOnly.innerHTML = `<i class="fa fa-lock"></i>`;
            }
            if (giveaway.group) {
                giveaway.group.innerHTML = `<i class="fa fa-user"></i>`;
            }
            if (giveaway.whitelist) {
                giveaway.whitelist.innerHTML = `<i class="fa fa-heart"></i>`;
            }
        }
        chance = context.getElementsByClassName(`esgst-gwc`)[0];
        giveaway.chance = chance ? parseFloat(chance.getAttribute(`data-chance`)) : 0;
        giveaway.chancePerPoint = Math.round(giveaway.chance / giveaway.points * 100) / 100;
        var feedback = giveaway.outerWrap.getElementsByClassName(`table__gift-feedback-awaiting-reply`)[0];
        if (esgst.rrbp && feedback) {
            feedback.addEventListener(`click`, openRrbp.bind(null, giveaway));
        }
        giveaway.blacklist = giveaway.outerWrap.getAttribute(`data-blacklist`);
        giveaway.error = giveaway.outerWrap.getAttribute(`data-error`);
        if (main) {
            if (esgst.gr && giveaway.ended && giveaway.creator === esgst.username && (giveaway.entries === 0 || giveaway.entries < giveaway.copies) && (!esgst.gr_r || !esgst.giveaways[giveaway.code] || !esgst.giveaways[giveaway.code].recreated) && !giveaway.headingName.parentElement.getElementsByClassName(`esgst-gr-button`)[0]) {
                var button = insertHtml(giveaway.headingName, `beforeBegin`, `
                    <div class="esgst-gr-button" title="Recreate giveaway">
                        <i class="fa fa-rotate-left"></i>
                    </div>
                `);
                button.firstElementChild.addEventListener(`click`, recreateGrGiveaway.bind(null, button, giveaway));
            }
        }
        let hideButton = giveaway.innerWrap.querySelector(`.giveaway__hide, .featured__giveaway__hide`);
        if ((!main || endless) && hideButton && !hideButton.classList.contains(`fa-eye`)) {
            if (hideButton.classList.contains(`featured__giveaway__hide`)) {
                hideButton = hideButton.parentElement;
            }
            const temp = hideButton.previousElementSibling;
            hideButton.outerHTML = `
                <i class="fa fa-eye-slash giveaway__hide giveaway__icon"></i>
            `;
            hideButton = temp.nextElementSibling;
            hideButton.addEventListener(`click`, hideGame.bind(null, hideButton, giveaway.gameId, giveaway.name));
        }
        return {
            giveaway: giveaway,
            data: {
                gameId: giveaway.gameId,
                gameSteamId: giveaway.id,
                gameType: giveaway.type,
                gameName: giveaway.name,
                code: giveaway.code,
                copies: giveaway.copies,
                points: giveaway.points,
                endTime: giveaway.endTime,
                startTime: giveaway.startTime,
                started: giveaway.started,
                creator: giveaway.creator,
                winners: giveaway.winners,
                entries: giveaway.entries,
                comments: giveaway.comments,
                level: giveaway.level,
                inviteOnly: giveaway.inviteOnly ? true : false,
                regionRestricted: giveaway.regionRestricted ? true : false,
                group: giveaway.group ? true : false,
                whitelist: giveaway.whitelist ? true : false
            }
        };
    }

    function loadDiscussionFeatures(context, main, source, endless) {
        return new Promise((resolve, reject) => {
            var i, n, discussion, discussions, savedDiscussion, savedDiscussions;
            getValue(`discussions`, `{}`).then(value => {
                savedDiscussions = JSON.parse(value);
                return getDiscussions(context, main, savedDiscussions);
            }).then(discussions => {
                for (i = discussions.length - 1; i > -1; --i) {
                    discussions[i].sortIndex = esgst.currentDiscussions.length;
                    esgst.currentDiscussions.push(discussions[i]);
                }
                if (esgst.codb) {
                    addCodbButtons(discussions);
                }
                if ((esgst.df && esgst.df_s) || esgst.dh || esgst.pm) {
                    for (i = 0, n = discussions.length; i < n; ++i) {
                        discussion = discussions[i];
                        savedDiscussion = savedDiscussions[discussion.code];
                        if (savedDiscussion) {
                            if (esgst.df && esgst.df_s) {
                                if (savedDiscussion.hidden) {
                                    addDfUnhideButton(discussion, main);
                                } else {
                                    addDfHideButton(discussion, main);
                                }
                            }
                            if (esgst.dh) {
                                if (savedDiscussion.highlighted) {
                                    highlightDhDiscussion(discussion.code, discussion.outerWrap);
                                    addDhUnhighlightButton(discussion.code, discussion.outerWrap, discussion.heading.parentElement);
                                    if (esgst.dh_t) {
                                        discussion.outerWrap.parentElement.insertBefore(discussion.outerWrap, discussion.outerWrap.parentElement.firstElementChild);
                                    }
                                } else {
                                    addDhHighlightButton(discussion.code, discussion.outerWrap, discussion.heading.parentElement);
                                }
                            }
                            if (esgst.pm && (esgst.pm_a || discussion.category === `Puzzles`)) {
                                addPmButton(discussion.code, discussion.heading.parentElement, savedDiscussion.status || `off`);
                            }
                        } else {
                            if (esgst.df && esgst.df_s) {
                                addDfHideButton(discussion, main);
                            }
                            if (esgst.dh) {
                                addDhHighlightButton(discussion.code, discussion.outerWrap, discussion.heading.parentElement);
                            }
                            if (esgst.pm && (esgst.pm_a || discussion.category === `Puzzles`)) {
                                addPmButton(discussion.code, discussion.heading.parentElement, `off`);
                            }
                        }
                    }
                }
                if (esgst.df && esgst.df.filteredCount && esgst[`df_enable${esgst.df.type}`]) {
                    filterDfDiscussions(esgst.df, false, endless);
                }
                if (esgst.ds && esgst.ds_auto) {
                    sortContent(discussions, esgst.ds_option);
                }
                resolve();
            });
        });
    }

    function getDiscussions(context, main, savedDiscussions) {
        return new Promise((resolve, reject) => {
            var discussion, discussions, elements, i, n, savedUsers;
            discussions = [];
            getValue(`users`).then(value => {
                savedUsers = JSON.parse(value);
                elements = context.getElementsByClassName(`table__row-outer-wrap`);
                for (i = elements.length - 1; i > -1; --i) {
                    discussion = getDiscussionInfo(elements[i], main, savedDiscussions, savedUsers);
                    if (discussion) {
                        discussions.push(discussion);
                    }
                }
                resolve(discussions);
            });
        });
    }

    function getDiscussionInfo(context, main, savedDiscussions, savedUsers) {
        var match, discussion, savedUser, uf;
        discussion = {};
        discussion.outerWrap = context;
        discussion.innerWrap = discussion.outerWrap.firstElementChild;
        discussion.avatarColumn = discussion.innerWrap.firstElementChild;
        if (!discussion.avatarColumn) {
            return null;
        }
        discussion.avatar = discussion.avatarColumn.firstElementChild;
        discussion.headingColumn = discussion.avatarColumn.nextElementSibling;
        discussion.headingContainer = discussion.headingColumn.firstElementChild;
        discussion.closed = discussion.headingContainer.getElementsByClassName(`fa-lock`)[0];
        discussion.heading = discussion.headingContainer.lastElementChild;
        discussion.info = discussion.headingContainer.nextElementSibling;
        if (discussion.heading) {
            discussion.title = discussion.heading.textContent;
            discussion.url = discussion.heading.getAttribute(`href`);
            if (discussion.url) {
                match = discussion.url.match(/discussion\/(.+?)\//);
                if (match) {
                    discussion.code = match[1];
                    if (discussion.code === `TDyzv` && esgst.checkVersionMain) {
                        let version = discussion.title.match(/v(.+?)\s/)[1];
                        getValue(`dismissedVersion`).then(value => {
                            if (version !== esgst.version && version !== value) {
                                notifyNewVersion(version);
                            }
                        });
                    }
                    if (main && esgst.df && esgst.df_s && savedDiscussions[discussion.code] && savedDiscussions[discussion.code].hidden) {
                        discussion.outerWrap.remove();
                        return null;
                    }
                    if (savedDiscussions[discussion.code]) {
                        discussion.highlighted = savedDiscussions[discussion.code].highlighted;
                        discussion.visited = savedDiscussions[discussion.code].visited;
                    }
                    discussion.categoryContainer = discussion.info.firstElementChild;
                    discussion.category = discussion.categoryContainer.textContent;
                    discussion[discussion.category.replace(/\W/g, ``).replace(/^(.)/, (m, p1) => { return p1.toLowerCase(); })] = true;
                    discussion.createdContainer = discussion.categoryContainer.nextElementSibling;
                    if (discussion.createdContainer) {
                        discussion.createdTime = discussion.createdContainer.textContent;
                        discussion.createdTimestamp = parseInt(discussion.createdContainer.getAttribute(`data-timestamp`)) * 1e3;
                        if (esgst.giveawaysPath) {
                            discussion.author = discussion.avatar.getAttribute(`href`).match(/\/user\/(.+)/)[1];
                        } else {
                            discussion.author = discussion.createdContainer.nextElementSibling.textContent;
                        }
                    }
                    discussion.created = discussion.author === esgst.username;
                    discussion.poll = discussion.outerWrap.getElementsByClassName(`fa-align-left`)[0];
                    if (discussion.headingColumn) {
                        discussion.commentsColumn = discussion.headingColumn.nextElementSibling;
                        if (discussion.commentsColumn) {
                            discussion.comments = parseInt(discussion.commentsColumn.firstElementChild.textContent.replace(/,/g, ``));
                        }
                    }
                    discussion.lastPost = discussion.outerWrap.getElementsByClassName(`table__column--last-comment`)[0];
                    if (discussion.lastPost && discussion.lastPost.firstElementChild) {
                        discussion.lastPostTime = discussion.lastPost.firstElementChild.firstElementChild;
                        discussion.lastPostAuthor = discussion.lastPostTime.nextElementSibling;
                        discussion.lastPostCode = discussion.lastPostAuthor.lastElementChild.getAttribute(`href`).match(/\/comment\/(.+)/)[1];
                        discussion.lastPostAuthor = discussion.lastPostAuthor.firstElementChild.textContent;
                        discussion.lastPostTime = discussion.lastPostTime.firstElementChild;
                        discussion.lastPostTimestamp = discussion.lastPostTime.getAttribute(`data-timestamp`);
                        discussion.lastPostTime = discussion.lastPostTime.textContent;
                    }
                    if (esgst.uf && savedUsers) {
                        savedUser = getUser(savedUsers, {
                            username: discussion.author
                        });
                        if (savedUser) {
                            uf = savedUser.uf;
                            if (esgst.uf_d && savedUser.blacklisted && !uf) {
                                if (!esgst.giveawaysPath) {
                                    updateUfCount(discussion.outerWrap.parentElement.parentElement.nextElementSibling);
                                }
                                discussion.outerWrap.remove();
                                return null;
                            } else if (uf && uf.discussions) {
                                if (!esgst.giveawaysPath) {
                                    updateUfCount(discussion.outerWrap.parentElement.parentElement.nextElementSibling);
                                }
                                discussion.outerWrap.remove();
                                return null;
                            }
                        }
                    }
                    return discussion;
                } else {
                    return null;
                }
            } else {
                return null;
            }
        } else {
            return null;
        }
    }

    function addPmButton(code, context, status) {
        if (!context.getElementsByClassName(`esgst-pm-button`)[0]) {
            let button, colors, icons, nextStatuses;
            colors = {
                'off': `grey`,
                'unsolved': `red`,
                'in progress': `orange`,
                'solved': `green`
            };
            icons = {
                'off': `circle-o`,
                'unsolved': `times-circle`,
                'in progress': `exclamation-circle`,
                'solved': `check-circle`
            };
            nextStatuses = {
                'off': `unsolved`,
                'unsolved': `in progress`,
                'in progress': `solved`,
                'solved': `off`
            };
            button = insertHtml(context, `afterBegin`, `
                <div class="esgst-pm-button esgst-${colors[status]}" title="Current status is '${status}'. Click to change to '${nextStatuses[status]}'.">
                    <i class="fa fa-${icons[status]}"></i>
                </div>
            `);
            button.addEventListener(`click`, () => {
                createLock(`commentLock`, 300, deleteLock => {
                    getValue(`discussions`).then(value => {
                        let discussions = JSON.parse(value);
                        if (!discussions[code]) {
                            discussions[code] = {
                                readComments: {}
                            };
                        }
                        status = nextStatuses[status];
                        if (status === `off`) {
                            delete discussions[code].status;
                        } else {
                            discussions[code].status = status;
                        }
                        discussions[code].lastUsed = Date.now();
                        return setValue(`discussions`, JSON.stringify(discussions));
                    }).then(() => {
                        deleteLock();
                        button.className = `esgst-pm-button esgst-${colors[status]}`;
                        button.title = `Current status is '${status}'. Click to change to '${nextStatuses[status]}'.`;
                        button.firstElementChild.className = `fa fa-${icons[status]}`;
                    });
                });
            });
        }
    }

    function addUstCheckbox(code, context) {
        if (!context.getElementsByClassName(`esgst-ust-checkbox`)[0]) {
            let checkbox = new Checkbox(context);
            checkbox.checkbox.classList.add(`esgst-ust-checkbox`);
            esgst.ustTickets[code] = checkbox;
            checkbox.onEnabled = event => {
                if (event) {
                    if (event.ctrlKey) {
                        for (let code in esgst.ustTickets) {
                            esgst.ustTickets[code].check();
                        }
                    } else if (event.altKey) {
                        checkbox.toggle();
                        for (let code in esgst.ustTickets) {
                            esgst.ustTickets[code].toggle();
                        }
                    }
                }
                esgst.ustCheckboxes[code] = checkbox.checkbox;
            };
            checkbox.onDisabled = event => {
                if (event) {
                    if (event.ctrlKey) {
                        for (let code in esgst.ustTickets) {
                            esgst.ustTickets[code].uncheck();
                        }
                    } else if (event.altKey) {
                        checkbox.toggle();
                        for (let code in esgst.ustTickets) {
                            esgst.ustTickets[code].toggle();
                        }
                    }
                }
                delete esgst.ustCheckboxes[code];
            };
            esgst.numUstTickets += 1;
        }
    }

    function loadCommentFeatures(context, main) {
        var count, comments, i, n, pagination;
        getComments(context, document, main).then(comments => {
            if (main) {
                for (i = 0, n = comments.length; i < n; ++i) {
                    comments[i].index = i;
                    esgst.currentComments.push(comments[i]);
                }
            }
            if (esgst.ct) {
                if (esgst.inboxPath) {
                    count = 0;
                } else {
                    count = context.getElementsByClassName(`page__heading__breadcrumbs`)[1];
                    if (count) {
                        count = parseInt(count.firstElementChild.textContent.replace(/,/g, ``).match(/\d+/));
                    } else {
                        count = 0;
                    }
                }
                getCtComments(count, comments);
            }
            if (esgst.rfi && esgst.rfi_s && esgst.inboxPath) {
                getRfiReplies(comments, main);
            }
        });
    }

    function getComments(context, mainContext, main) {
        return new Promise((resolve, reject) => {
            var comment, comments, i, matches, sourceLink, savedUsers;
            comments = [];
            getValue(`users`).then(value => {
                savedUsers = JSON.parse(value);
                matches = context.querySelectorAll(`:not(.comment--submit) > .comment__parent, .comment__child, .comment_inner`);
                sourceLink = mainContext.querySelector(`.page__heading__breadcrumbs a[href*="/giveaway/"], .page__heading__breadcrumbs a[href*="/discussion/"], .page__heading__breadcrumbs a[href*="/ticket/"], .page_heading_breadcrumbs a[href*="/trade/"]`);
                for (i = matches.length - 1; i >= 0; --i) {
                    comment = getCommentInfo(matches[i], sourceLink, savedUsers, main);
                    if (comment) {
                        comments.push(comment);
                    }
                }
                resolve(comments);
            });
        });
    }

    function getCommentInfo(context, sourceLink, savedUsers, main) {
        var comment, matches, n, source;
        comment = {};
        comment.comment = context;
        comment.author = comment.comment.querySelector(`.comment__author, .author_name`).textContent.trim();
                if (esgst.uf && savedUsers) {
                    var savedUser = getUser(savedUsers, {
                        username: comment.author
                    });
                    if (savedUser) {
                        var uf = savedUser.uf, comments, extraCount;
                        if (esgst.uf_p && savedUser.blacklisted && !uf) {
                            comments = comment.comment.closest(`.comments`);
                            if (esgst.inboxPath) {
                                updateUfCount(comments.parentElement.nextElementSibling);
                                comment.comment.parentElement.remove();
                                if (!comments.children.length) {
                                    comments.previousElementSibling.remove();
                                    comments.remove();
                                }
                            } else {
                                if (comment.comment.nextElementSibling) {
                                    extraCount = comment.comment.nextElementSibling.children.length;
                                } else {
                                    extraCount = 0;
                                }
                                updateUfCount(comments.nextElementSibling, extraCount);
                                comment.comment.parentElement.remove();
                            }
                            return null;
                        } else if (uf && uf.posts) {
                            comments = comment.comment.closest(`.comments`);
                            updateUfCount(comment.comment.closest(`.comments`).nextElementSibling);
                            if (esgst.inboxPath) {
                                updateUfCount(comments.parentElement.nextElementSibling);
                                comment.comment.parentElement.remove();
                                if (!comments.children.length) {
                                    comments.previousElementSibling.remove();
                                    comments.remove();
                                }
                            } else {
                                if (comment.comment.nextElementSibling) {
                                    extraCount = comment.comment.nextElementSibling.children.length;
                                } else {
                                    extraCount = 0;
                                }
                                updateUfCount(comments.nextElementSibling, extraCount);
                                comment.comment.parentElement.remove();
                            }
                            return null;
                        }
                    }
                }
        comment.actions = comment.comment.querySelector(`.comment__actions, .action_list`);
        matches = comment.actions.querySelectorAll(`[href*="/comment/"]`);
        n = matches.length;
        if (n > 0) {
            comment.permalink = matches[n - 1];
        }
        comment.id = comment.permalink ? comment.permalink.getAttribute(`href`).match(/\/comment\/(.+)/)[1] : ``;
        comment.timestamp = parseInt(comment.actions.firstElementChild.lastElementChild.getAttribute(`data-timestamp`));
        if (main && esgst.inboxPath) {
            if (esgst.sg) {
                source = comment.comment.closest(`.comments`).previousElementSibling.firstElementChild.firstElementChild.getAttribute(`href`);
            } else {
                source = comment.actions.querySelector(`[href*="/trade/"]`).getAttribute(`href`);
            }
        } else if (sourceLink) {
            source = sourceLink.getAttribute(`href`);
        }
        if (source) {
            source = source.match(/(giveaway|discussion|ticket|trade)\/(.+?)(\/.*)?$/);
            comment.type = `${source[1]}s`;
            comment.code = source[2];
            return comment;
        } else {
            return null;
        }
    }

    function loadProfileFeatures(context) {
        var action, cvrow, element, elements, i, input, key, match, n, profile, rows, savedUsers;
        profile = {};
        if (esgst.sg) {
            profile.heading = context.getElementsByClassName(`featured__heading`)[0];
            input = context.querySelector(`[name="child_user_id"]`);
            if (input) {
                profile.id = input.value;
            } else {
                profile.id = ``;
            }
            profile.username = profile.heading.textContent.replace(/\s[\s\S]*/, ``);
            profile.steamButtonContainer = context.getElementsByClassName(`sidebar__shortcut-outer-wrap`)[0];
            profile.steamButton = profile.steamButtonContainer.querySelector(`[href*="/profiles/"]`);
            profile.steamId = profile.steamButton.getAttribute(`href`).match(/\d+/)[0];
            profile.name = profile.username;
        } else {
            profile.heading = esgst.mainPageHeading;
            profile.id = ``;
            profile.username = ``;
            profile.steamButtonContainer = context.getElementsByClassName(`profile_links`)[0];
            profile.steamButton = profile.steamButtonContainer.querySelector(`[href*="/profiles/"]`);
            profile.steamId = profile.steamButton.getAttribute(`href`).match(/\d+/)[0];
            profile.name = profile.steamId;
        }
        elements = context.getElementsByClassName(`featured__table__row__left`);
        for (i = elements.length - 1; i >= 0; --i) {
            element = elements[i];
            match = element.textContent.match(/(Gifts (Won|Sent)|Contributor Level)/);
            if (match) {
                key = match[2];
                if (key) {
                    if (key === `Won`) {
                        profile.wonRow = element.parentElement;
                        profile.wonRowLeft = element;
                        profile.wonRowRight = element.nextElementSibling;
                        rows = JSON.parse(profile.wonRowRight.firstElementChild.firstElementChild.getAttribute(`data-ui-tooltip`)).rows;
                        profile.wonCount = parseInt(rows[0].columns[1].name.replace(/,/g, ``));
                        profile.wonFull = parseInt(rows[1].columns[1].name.replace(/,/g, ``));
                        profile.wonReduced = parseInt(rows[2].columns[1].name.replace(/,/g, ``));
                        profile.wonZero = parseInt(rows[3].columns[1].name.replace(/,/g, ``));
                        cvrow = profile.wonRowRight.firstElementChild.lastElementChild;
                        rows = JSON.parse(cvrow.getAttribute(`data-ui-tooltip`)).rows;
                        profile.wonCV = parseFloat(cvrow.textContent.replace(/\$|,/g, ``));
                        profile.realWonCV = parseFloat(rows[0].columns[1].name.replace(/\$|,/g, ``));
                    } else {
                        profile.sentRow = element.parentElement;
                        profile.sentRowLeft = element;
                        profile.sentRowRight = element.nextElementSibling;
                        rows = JSON.parse(profile.sentRowRight.firstElementChild.firstElementChild.getAttribute(`data-ui-tooltip`)).rows;
                        profile.sentCount = parseInt(rows[0].columns[1].name.replace(/,/g, ``));
                        profile.sentFull = parseInt(rows[1].columns[1].name.replace(/,/g, ``));
                        profile.sentReduced = parseInt(rows[2].columns[1].name.replace(/,/g, ``));
                        profile.sentZero = parseInt(rows[3].columns[1].name.replace(/,/g, ``));
                        profile.notSent = parseInt(rows[5].columns[1].name.replace(/,/g, ``));
                        cvrow = profile.sentRowRight.firstElementChild.lastElementChild;
                        rows = JSON.parse(cvrow.getAttribute(`data-ui-tooltip`)).rows;
                        profile.sentCV = parseFloat(cvrow.textContent.replace(/\$|,/g, ``));
                        profile.realSentCV = parseFloat(rows[0].columns[1].name.replace(/\$|,/g, ``));
                    }
                } else {
                    profile.levelRow = element.parentElement;
                    profile.levelRowLeft = element;
                    profile.levelRowRight = element.nextElementSibling;
                    rows = JSON.parse(profile.levelRowRight.firstElementChild.getAttribute(`data-ui-tooltip`)).rows;
                    profile.level = parseFloat(rows[0].columns[1].name);
                }
            }
        }
        profile.whitelistButton = profile.steamButtonContainer.getElementsByClassName(`sidebar__shortcut__whitelist`)[0];
        profile.blacklistButton = profile.steamButtonContainer.getElementsByClassName(`sidebar__shortcut__blacklist`)[0];
        if (profile.whitelistButton) {
            if (esgst.updateWhitelistBlacklist) {
                profile.whitelistButton.addEventListener(`click`, updateWhitelistBlacklist.bind(null, `whitelisted`, profile));
            }
        }
        if (profile.blacklistButton) {
            if (esgst.updateWhitelistBlacklist) {
                profile.blacklistButton.addEventListener(`click`, updateWhitelistBlacklist.bind(null, `blacklisted`, profile));
            }
        }
        getValue(`users`).then(value => {
            savedUsers = JSON.parse(value);
            for (i = 0, n = esgst.profileFeatures.length; i < n; ++i) {
                esgst.profileFeatures[i](profile, savedUsers.users[profile.steamId]);
            }
        });
    }

    function updateWhitelistBlacklist(key, profile, event) {
        var user;
        user = {
            steamId: profile.steamId,
            id: profile.id,
            username: profile.username,
            values: {}
        };
        if (event.currentTarget.classList.contains(`is-selected`)) {
            user.values[key] = false;
        } else {
            user.values[key] = true;
            user.values[`${key}Date`] = Date.now();
        }
        saveUser(null, null, user);
    }

    function triggerSetOnEnter(set, event) {
        if (event.key === `Enter`) {
            set.trigger();
        }
    }

    function addUtButton(context, key, steamId, username) {
        var container;
        container = context.parentElement;
        if (container.classList.contains(`comment__username`)) {
            context = container;
        }
        insertHtml(context, `afterEnd`, `
            <a class="esgst-ut-button esgst-faded" title="Edit user tags">
                <i class="fa fa-tag"></i>
                <span class="esgst-ut-tags"></span>
            </a>
        `).addEventListener(`click`, openUtPopup.bind(null, key, steamId, username));
    }

    function openUtPopup(key, steamId, username) {
        var popup, set;
        user = {
            steamId: steamId,
            username: username
        };
        popup = new Popup(`fa-tag`, `Edit user tags for <span>${key}</span>:`);
        set = new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Save`, `Saving...`, saveUtTags.bind(null, key, popup, user));
        popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Drag the tags to move them.<br/><br/>When editing a tag color, it will also alter the color for all users with that tag (you have to refresh the page for it to take effect).</div>`);
        popup.tags = insertHtml(popup.description, `beforeEnd`, `<div class="esgst-ut-tags"></div>`);
        popup.input = insertHtml(popup.description, `beforeEnd`, `<input type="text"/>`);
        insertHtml(popup.description, `beforeEnd`, `<i class="esgst-ut-existing-button esgst-clickable fa fa-list" title="Select from existing tags"></i>`).addEventListener(`click`, showUtExistingTags.bind(null, popup));
        popup.input.addEventListener(`keydown`, triggerSetOnEnter.bind(null, set));
        popup.input.addEventListener(`input`, createUtTags.bind(null, popup));
        popup.description.insertAdjacentHTML(`beforeEnd`, `<div class="esgst-description">Use commas to separate tags, for example: Tag1, Tag2, ...</div>`);
        popup.description.appendChild(set.set);
        popup.open(loadUtTags.bind(null, popup, user));
    }

    function showUtExistingTags(mainPopup) {
        let key, list, popup, savedUsers, selectedTags, tag, tagCount, tags;
        popup = new Popup(`fa-list`, `Select from existing tags:`, true);
        tagCount = {};
        getValue(`users`).then(value => {
            savedUsers = JSON.parse(value).users;
            for (key in savedUsers) {
                tags = savedUsers[key].tags;
                if (tags) {
                    tags.forEach(tag => {
                        if (!tagCount[tag]) {
                            tagCount[tag] = 0;
                        }
                        tagCount[tag] += 1;
                    });
                }
            }
            tags = [];
            for (tag in tagCount) {
                tags.push({
                    count: tagCount[tag],
                    tag: tag
                });
            }
            list = insertHtml(popup.scrollable, `beforeEnd`, `<div class="esgst-ut-existing-tags popup__keys__list"></div>`);
            selectedTags = [];
            tags = sortArrayByNumberKey(tags, `count`, true);
            tags.forEach(tag => {
                let checkbox, item;
                tag = tag.tag;
                item = insertHtml(list, `beforeEnd`, `
                    <div>
                        <span></span> ${tag}
                    </div>
                `);
                if (esgst.ut_colors[tag]) {
                    item.style.color = esgst.ut_colors[tag].color;
                    item.style.backgroundColor = esgst.ut_colors[tag].bgColor;
                }
                checkbox = new Checkbox(item);
                checkbox.onEnabled = () => {
                    selectedTags.push(tag);
                };
                checkbox.onDisabled = () => {
                    selectedTags.splice(selectedTags.indexOf(tag), 1);
                };
            });
            popup.description.appendChild(new ButtonSet(`green`, ``, `fa-check`, ``, `Add Tags`, ``, callback => {
                selectedTags.forEach(tag => {
                    createUtTag(mainPopup, tag);
                });
                mainPopup.input.value = mainPopup.input.value ? `${mainPopup.input.value}, ${selectedTags.join(`, `)}` : selectedTags.join(`, `);
                callback();
                popup.close();
            }).set);
            popup.open();
        });
    }

    function createUtTags(popup) {
        var i, n, tags;
        tags = popup.input.value.replace(/(,\s*)+/g, formatTags).split(`, `);
        popup.tags.innerHTML = ``;
        for (i = 0, n = tags.length; i < n; ++i) {
            createUtTag(popup, tags[i]);
        }
    }

    function createUtTag(popup, tag) {
        var bgColorInput, colorInput, colors, container, deleteButton, editButton, input, resetButton, tagBox, tagContainer;
        container = insertHtml(popup.tags, `beforeEnd`, `
            <div class="esgst-ut-preview" draggable="true">
                <div class="esgst-ut-tags">
                    <span class="global__image-outer-wrap author_avatar is_icon">${tag}</span>
                </div>
                <input class="esgst-hidden" type="text"/>
                <input title="Set text color for this tag" type="color"/>
                <input title="Set background color for this tag" type="color"/>
                <i class="esgst-clickable fa fa-edit" title="Edit tag"></i>
                <i class="esgst-clickable fa fa-trash" title="Delete tag"></i>
                <i class="esgst-clickable fa fa-rotate-left" title="Reset tag color"></i>
            </div>
        `);
        tagContainer = container.firstElementChild;
        tagBox = tagContainer.firstElementChild;
        input = tagContainer.nextElementSibling;
        colorInput = input.nextElementSibling;
        bgColorInput = colorInput.nextElementSibling;
        editButton = bgColorInput.nextElementSibling;
        deleteButton = editButton.nextElementSibling;
        resetButton = deleteButton.nextElementSibling;
        colors = esgst.ut_colors[tag];
        if (colors) {
            colorInput.value = tagBox.style.color = colors.color;
            bgColorInput.value = tagBox.style.backgroundColor = colors.bgColor;
        }
        container.addEventListener(`dragstart`, startUtDrag.bind(null, container, popup));
        container.addEventListener(`dragenter`, continueUtDrag.bind(null, container, popup));
        container.addEventListener(`dragend`, endUtDrag.bind(null, popup));
        input.addEventListener(`keydown`, editUtTag.bind(null, bgColorInput, colorInput, input, popup, tagBox, tagContainer));
        colorInput.addEventListener(`change`, saveUtColor.bind(null, colorInput, `color`, `color`, tagBox));
        bgColorInput.addEventListener(`change`, saveUtColor.bind(null, bgColorInput, `backgroundColor`, `bgColor`, tagBox));
        editButton.addEventListener(`click`, showUtEdit.bind(null, input, tagBox, tagContainer));
        deleteButton.addEventListener(`click`, deleteUtTag.bind(null, container, popup));
        resetButton.addEventListener(`click`, resetUtColor.bind(null, bgColorInput, colorInput, tagBox));
    }

    function startUtDrag(container, popup, event) {
        event.dataTransfer.setData(`text/plain`, ``);
        popup.dragged = container;
    }

    function continueUtDrag(container, popup) {
        var current;
        current = popup.dragged;
        do {
            current = current.previousElementSibling;
            if (current && current === container) {
                popup.tags.insertBefore(popup.dragged, container);
                return;
            }
        } while (current);
        popup.tags.insertBefore(popup.dragged, container.nextElementSibling);
    }

    function endUtDrag(popup) {
        var children, i, n, tags;
        tags = [];
        children = popup.tags.children;
        for (i = 0, n = children.length; i < n; ++i) {
            tags.push(children[i].firstElementChild.firstElementChild.textContent);
        }
        popup.input.value = tags.join(`, `);
    }

    function editUtTag(bgColorInput, colorInput, input, popup, tagBox, tagContainer, event) {
        var colors, name, oldName, tag;
        if (event.key === `Enter`) {
            tagContainer.classList.remove(`esgst-hidden`);
            input.classList.add(`esgst-hidden`);
            oldName = tagBox.textContent;
            tag = input.value;
            tagBox.textContent = tag;
            colors = esgst.ut_colors[tag];
            if (colors) {
                colorInput.value = tagBox.style.color = colors.color;
                bgColorInput.value = tagBox.style.backgroundColor = colors.bgColor;
            }
            endUtDrag(popup);
        }
    }

    function saveUtColor(input, key, saveKey, tagBox) {
        var tag;
        tag = tagBox.textContent;
        if (!esgst.ut_colors[tag]) {
            esgst.ut_colors[tag] = {
                bgColor: ``,
                color: ``
            };
        }
        esgst.ut_colors[tag][saveKey] = tagBox.style[key] = input.value;
    }

    function resetUtColor(bgColorInput, colorInput, tagBox) {
        bgColorInput.value = ``;
        colorInput.value = ``;
        tagBox.style.backgroundColor = ``;
        tagBox.style.color = ``;
        delete esgst.ut_colors[tagBox.textContent];
    }

    function showUtEdit(input, tagBox, tagContainer) {
        tagContainer.classList.add(`esgst-hidden`);
        input.classList.remove(`esgst-hidden`);
        input.value = tagBox.textContent;
        input.focus();
    }

    function deleteUtTag(container, popup) {
        container.remove();
        endUtDrag(popup);
    }

    function formatTags(fullMatch, match1, offset, string) {
        return (((offset === 0) || (offset === (string.length - fullMatch.length))) ? `` : `, `);
    }

    function saveUtTags(key, popup, user, callback) {
        var tags;
        tags = popup.input.value.replace(/(,\s*)+/g, formatTags).split(`, `);
        if (tags.length === 1 && !tags[0].trim()) {
            tags = ``;
        }
        user.values = {
            tags: tags
        };
        saveUser(null, null, user, completeUtSave.bind(null, key, popup, tags, callback));
    }

    function completeUtSave(key, popup, tags, callback) {
        setSetting(`ut_colors`, esgst.ut_colors).then(() => {
            addUtTags(key, tags);
            callback();
            popup.close();
        });
    }

    function loadUtTags(popup, user) {
        var i, n, savedUser, tags;
        getUser(null, user).then(savedUser => {
            popup.input.focus();
            if (savedUser) {
                tags = savedUser.tags;
                if (tags) {
                    popup.tags.innerHTML = ``;
                    for (i = 0, n = tags.length; i < n; ++i) {
                        createUtTag(popup, tags[i]);
                    }
                    popup.input.value = tags.join(`, `);
                }
            }
        });
    }

    function addUtTags(key, tags) {
        var button, children, colors, container, context, elements, html, i, n, prefix, suffix, tagsBox, tagsContainer;
        elements = esgst.currentUsers[key].elements;
        prefix = `<span class="global__image-outer-wrap author_avatar is_icon">`;
        suffix = `</span>`;
        html = tags.length && tags[0] ? `${prefix}${tags.join(`${suffix}${prefix}`)}${suffix}` : ``;
        for (i = 0, n = elements.length; i < n; ++i) {
            context = elements[i];
            container = context.parentElement;
            if (container) {
                if (container.classList.contains(`comment__username`)) {
                    context = container;
                }
                button = context.parentElement.getElementsByClassName(`esgst-ut-button`)[0];
                if (html) {
                    button.classList.remove(`esgst-faded`);
                } else {
                    button.classList.add(`esgst-faded`);
                }
                tagsContainer = button.lastElementChild;
                tagsContainer.innerHTML = html;
                children = tagsContainer.children;
                for (j = 0, numTags = children.length; j < numTags; ++j) {
                    tagsBox = children[j];
                    colors = esgst.ut_colors[tagsBox.textContent];
                    if (colors) {
                        tagsBox.style.color = colors.color;
                        tagsBox.style.backgroundColor = colors.bgColor;
                    }
                }
            }
        }
    }

    function loadUserFeatures(mainContext) {
        let container, context, element, elements, found, highlight, html, i, icon, id, match, result, results, savedUser, status, steamId, title;
        elements = mainContext.querySelectorAll(`a[href*='/user/']`);
        for (i = elements.length - 1; i > -1; --i) {
            element = elements[i];
            match = element.getAttribute(`href`).match(/\/user\/(.+)/);
            if (match) {
                id = match[1];
                if (((esgst.sg && element.textContent === id) || (!esgst.sg && element.textContent && !element.children.length)) && !element.closest(`.markdown`)) {
                    if (!esgst.currentUsers[id]) {
                        esgst.currentUsers[id] = {
                            elements: []
                        };
                        steamId = esgst.sg ? esgst.users.steamIds[id] : id;
                        esgst.currentUsers[id].savedUser = esgst.users.users[steamId];
                        if (esgst.currentUsers[id].savedUser) {
                            esgst.currentUsers[id].steamId = steamId;
                        }
                    }
                    esgst.currentUsers[id].elements.push(element);
                    savedUser = esgst.currentUsers[id].savedUser;
                    container = element.parentElement;
                    context = container.classList.contains(`comment__username`) ? container : element;
                    if (savedUser) {
                        html = ``;
                        if (esgst.namwc && esgst.namwc_h && savedUser.namwc && savedUser.namwc.results) {
                            results = savedUser.namwc.results;
                            if (results.activated && (results.notMultiple || esgst.namwc_h_m)) {
                                highlight = `positive`;
                                icon = `fa-thumbs-up`;
                            } else if (results.unknown) {
                                highlight = `unknown`;
                                icon = `fa-warning`;
                            } else {
                                highlight = `negative`;
                                icon = `fa-thumbs-down`;
                            }
                            if (((highlight === `positive` || highlight === `unknown`) && !esgst.namwc_h_f) || highlight === `negative`) {
                                title = `${savedUser.username} has ${results.unknown ? `?` : Array.isArray(results.notActivated) ? results.notActivated.length : results.notActivated} not activated wins and ${Array.isArray(results.multiple) ? results.multiple.length : results.multiple} multiple wins (last checked ${getTimestamp(savedUser.namwc.lastCheck / 1e3)})`;
                                if (esgst.namwc_h_i || (esgst.wbh && (esgst.wbh_w || esgst.wbh_b))) {
                                    html += `
                                        <span class="esgst-user-icon" title="${title}">
                                            <i class="fa ${icon} esgst-${highlight}"></i>
                                        </span>
                                    `;
                                } else {
                                    element.classList.add(`esgst-namwc-highlight`, `esgst-${highlight}`);
                                    element.title = title;
                                }
                            }
                        }
                        if (esgst.wbc && esgst.wbc_h && savedUser.wbc) {
                            result = savedUser.wbc.result;
                            if ((result === `whitelisted`) || ((result === `blacklisted`) && esgst.wbc_b)) {
                                html += `
                                    <span class="esgst-user-icon" title="${savedUser.username} has ${result} you (last checked ${getTimestamp(savedUser.wbc.lastCheck / 1e3)})">
                                        <i class="fa ${(result === `whitelisted`) ? `fa-check esgst-whitelist` : `fa-times esgst-blacklist`}"></i>
                                    </span>
                                `;
                            }
                        }
                        if (esgst.wbh && !esgst.accountPath && (savedUser.whitelisted || savedUser.blacklisted)) {
                            if (savedUser.whitelisted) {
                                status = `whitelisted`;
                                icon = `fa-heart sidebar__shortcut__whitelist`;
                            } else {
                                status = `blacklisted`;
                                icon = `fa-ban sidebar__shortcut__blacklist`;
                            }
                            title = `You ${status} ${savedUser.username} on ${getTimestamp(savedUser[`${status}Date`] / 1e3)}`;
                            if ((esgst.wbh_w && savedUser.whitelisted) || (esgst.wbh_b && savedUser.blacklisted)) {
                                element.classList.add(`esgst-wbh-highlight`, `esgst-wbh-highlight-${status}`);
                                element.title = title;
                            } else {
                                html += `
                                    <span class="esgst-user-icon" title="${title}">
                                        <i class="fa ${icon} esgst-${status.slice(0, -2)}"></i>
                                    </span>
                                `;
                            }
                        }
                        if (html) {
                            insertHtml(context, `beforeBegin`, html);
                        }
                        if (esgst.ut) {
                            addUtButton(context, id, esgst.currentUsers[id].steamId, savedUser.username);
                            if (savedUser.tags) {
                                addUtTags(id, savedUser.tags);
                            }
                        }
                    } else if (esgst.ut) {
                        addUtButton(context, id, esgst.sg ? null : id, esgst.sg ? id : null);
                    }
                    if (esgst.ap) {
                        setApAvatar(element);
                    }
                    if (!found) {
                        found = true;
                    }
                }
            }
        }
        if (found && (esgst.wbcButton || esgst.mtUserButton) && mainContext === document && !esgst.aboutPath) {
            if (esgst.wbcButton) {
                esgst.wbcButton.classList.remove(`esgst-hidden`);
                esgst.wbcButton.parentElement.classList.remove(`esgst-hidden`);
            }
            if (esgst.mtUserButton) {
                esgst.mtUserButton.classList.remove(`esgst-hidden`);
                esgst.mtUserButton.parentElement.classList.remove(`esgst-hidden`);
            }
        }
    }

    function loadGameFeatures(context, main, source, endless) {
        return new Promise((resolve, reject) => {
            var found, games, i, id, n, savedGames;
            getValue(`games`).then(value => {
                savedGames = JSON.parse(value);
                games = getGames(context, main, savedGames);
                if (main) {
                    found = false;
                    for (id in games.apps) {
                        if (!esgst.currentGames.apps[id]) {
                            esgst.currentGames.apps[id] = [];
                        }
                        games.apps[id].forEach(game => {
                            found = true;
                            esgst.currentGames.apps[id].push(game);
                        });
                    }
                    for (id in games.subs) {
                        if (!esgst.currentGames.subs[id]) {
                            esgst.currentGames.subs[id] = [];
                        }
                        games.subs[id].forEach(game => {
                            found = true;
                            esgst.currentGames.subs[id].push(game);
                        });
                    }
                    if (found && esgst.mtGameButton) {
                        esgst.mtGameButton.classList.remove(`esgst-hidden`);
                        esgst.mtGameButton.parentElement.classList.remove(`esgst-hidden`);
                    }
                }
                if (esgst.gc && (!esgst.menuPath || esgst.gbPath || esgst.gedPath || esgst.gePath)) {
                    getGcGames(games, endless);
                }
            });
            resolve();
        });
    }

    function getGames(context, main, savedGames) {
        var game, games, name, i, id, info, matches, n, headingQuery, matchesQuery, type;
        games = {
            apps: {},
            subs: {}
        };
        if (esgst.discussionPath && (esgst.gc_t || esgst.gt_t || esgst.egh_t) && main) {
            matchesQuery = `.featured__outer-wrap--giveaway, .giveaway__row-outer-wrap, .table__row-outer-wrap, .markdown table td`;
            headingQuery = `.featured__heading, .giveaway__heading, .table__column__heading, a`;
        } else {
            matchesQuery = `.featured__outer-wrap--giveaway, .giveaway__row-outer-wrap, .table__row-outer-wrap`;
            headingQuery = `.featured__heading, .giveaway__heading, .table__column__heading`;
        }
        matches = context.querySelectorAll(matchesQuery);
        for (i = 0, n = matches.length; i < n; ++i) {
            game = {
                container: matches[i]
            };
            game.table = game.container.closest(`table`) ? true : false;
            game.grid = game.container.closest(`.esgst-gv-view`);
            info = getGameInfo(game.container);
            game.heading = game.container.querySelector(headingQuery);
            if (info && game.heading) {
                game.headingName = game.heading.querySelector(`.featured__heading__medium, .giveaway__heading__name`) || game.heading;
                game.name = game.headingName.textContent;
                id = info.id;
                type = info.type;
                if (!games[type][id]) {
                    games[type][id] = [];
                }
                if (esgst.wishlistPath && main && esgst.cwsl) {
                    let giveawayCount = game.heading.parentElement.nextElementSibling.nextElementSibling;
                    giveawayCount.innerHTML = `
                        <a class="table__column__secondary-link" href="/giveaways/search?${type.slice(0, -1)}=${id}">${giveawayCount.innerHTML}</a>
                    `;
                }
                if (esgst.egh) {
                    if (esgst.giveawayPath) {
                        let button = document.querySelector(`.sidebar__entry-insert`);
                        if (button) {
                            button.addEventListener(`click`, saveEghGame.bind(null, id, type));
                        }
                    }
                    if (!esgst.menuPath && savedGames[type][id] && savedGames[type][id].entered && !game.container.getElementsByClassName(`esgst-egh-button`)[0] && (!game.table || esgst.egh_t)) {
                        insertHtml((game.container.closest(`.poll`) && game.container.getElementsByClassName(`table__column__heading`)[0]) || game.headingName, `beforeBegin`, `
                            <a class="esgst-egh-button">
                                <i class="fa fa-star esgst-egh-icon" title="You have entered giveaways for this game before. Click to unhighlight it"></i>
                            </a>
                        `).addEventListener(`click`, unhighlightEghGame.bind(null, id, type));
                    }
                }
                if (esgst.gt) {
                    if (!game.container.getElementsByClassName(`esgst-gt-button`)[0] && (!game.table || esgst.gt_t)) {
                        insertHtml((game.container.closest(`.poll`) && game.container.getElementsByClassName(`table__column__heading`)[0]) || game.heading.lastElementChild || game.heading, `afterEnd`, `
                            <a class="esgst-faded esgst-gt-button" title="Edit game tags">
                                <i class="fa fa-tag"></i>
                                <span class="esgst-gt-tags"></span>
                            </a>
                        `).addEventListener(`click`, openGtPopup.bind(null, id, game.name, type));
                    }
                    if (savedGames[type][id] && savedGames[type][id].tags) {
                        addGtTags([game], id, savedGames[type][id].tags, type);
                    }
                }
                games[type][id].push(game);
            }
        }
        return games;
    }

    function getGameInfo(context, steamLink) {
        var image, info, link, url;
        link = context.querySelector(`[href*="/app/"], [href*="/sub/"]`);
        image = context.querySelector(`[style*="/apps/"], [style*="/subs/"]`);
        if (link || image) {
            url = (link && link.getAttribute(`href`)) || (image && image.getAttribute(`style`));
            if (url) {
                info = url.match(/\/(app|sub)s?\/(\d+)/);
                return {
                    type: `${info[1]}s`,
                    id: info[2]
                };
            } else {
                return null;
            }
        } else {
            return null;
        }
    }

    /* [AP] Avatar Popout */

    function getApAvatars(context) {
        var i, matches, n;
        matches = context.querySelectorAll(`.global__image-outer-wrap--avatar-small, .giveaway_image_avatar, .table_image_avatar, .featured_giveaway_image_avatar`);
        for (i = 0, n = matches.length; i < n; ++i) {
            setApAvatar(matches[i]);
        }
    }

    function setApAvatar(apAvatar) {
        var delay, eventType, exitTimeout, id, match, onClick, popout, timeout, type, url;
        url = apAvatar.getAttribute(`href`);
        if (url) {
            if (esgst.ap_index === 0) {
                eventType = `mouseenter`;
                onClick = false;
                delay = 1000;
                apAvatar.addEventListener(`mouseleave`, function(event) {
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout = null;
                    }
                    exitTimeout = setTimeout(function() {
                        if (popout && !popout.popout.contains(event.relatedTarget)) {
                            popout.close();
                        }
                    }, 1000);
                });
                apAvatar.addEventListener(`click`, function() {
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout = null;
                    }
                });
            } else {
                eventType = `click`;
                onClick = true;
                delay = 0;
                apAvatar.removeAttribute(`href`);
                apAvatar.classList.add(`esgst-clickable`);
            }
            match = url.match(/\/(user|group)\/(.+?)(\/.*)?$/);
            if (match) {
                id = match[2];
                type = match[1];
                apAvatar.addEventListener(eventType, function() {
                    timeout = setTimeout(function() {
                        popout = esgst.apPopouts[id];
                        if (popout) {
                            if (esgst.ap_index === 1 && popout.isOpen) {
                                popout.close();
                            } else {
                                popout.open(apAvatar);
                            }
                        } else {
                            esgst.apPopouts[id] = popout = new Popout(`esgst-ap-popout`, null, 1000, onClick);
                            popout.popout.innerHTML = `
                                <i class="fa fa-circle-o-notch fa-spin"></i>
                                <span>Loading ${type}...</span>
                            `;
                            popout.open(apAvatar);
                            request(null, null, `GET`, false, url, function (response) {
                                var avatar, columns, i, link, n, reportButton, responseHtml, table;
                                responseHtml = parseHtml(response.responseText);
                                popout.popout.innerHTML = ``;
                                popout.popout.appendChild(responseHtml.getElementsByClassName(`featured__outer-wrap`)[0]);
                                avatar = popout.popout.getElementsByClassName(`global__image-outer-wrap--avatar-large`)[0];
                                link = insertHtml(avatar, `afterEnd`, `<a class="esgst-ap-link"></a>`);
                                link.appendChild(avatar);
                                link.setAttribute(`href`, url);
                                table = popout.popout.getElementsByClassName(`featured__table`)[0];
                                responseHtml.getElementsByClassName(`sidebar__shortcut-outer-wrap`)[0].lastElementChild.remove();
                                table.parentElement.insertBefore(responseHtml.getElementsByClassName(`sidebar__shortcut-outer-wrap`)[0], table);
                                reportButton = popout.popout.getElementsByClassName(`js__submit-form-inner`)[0];
                                if (reportButton) {
                                    reportButton.addEventListener(`click`, function() {
                                        return reportButton.getElementsByTagName(`form`)[0].submit();
                                    });
                                }
                                columns = table.children;
                                for (i = 0, n = columns[1].children.length; i < n; ++i) {
                                    columns[0].appendChild(columns[1].firstElementChild);
                                }
                                suspension = responseHtml.getElementsByClassName(`sidebar__suspension`)[0];
                                if (suspension) {
                                    columns[0].insertAdjacentHTML(`beforeEnd`, `
                                        <div class="esgst-ap-suspended featured__table__row">
                                            <div class="featured__table__row__left">${suspension.textContent}</div>
                                            <div class="featured__table__row__right">${suspension.nextElementSibling.textContent}</div>
                                        </div>
                                    `);
                                }
                                columns[1].remove();
                                if (type === `user`) {
                                    loadProfileFeatures(popout.popout);
                                }
                                popout.reposition();
                            });
                        }
                        if (esgst.ap_index === 0) {
                            popout.popout.onmouseenter = function() {
                                if (exitTimeout) {
                                    clearTimeout(exitTimeout);
                                    exitTimeout = null;
                                }
                            };
                        }
                    }, delay);
                });
            }
        }
    }

    function loadStbb() {
        let button, key, position;
        switch (esgst.stbb_index) {
            case 0:
                button = insertHtml(document.body, `beforeEnd`, `
                    <div class="esgst-stbb-button esgst-stbb-button-fixed" title="Scroll to bottom">
                        <i class="fa fa-chevron-down"></i>
                    </div>
                `);
                addEventListener(`scroll`, () => {
                    if (document.documentElement.offsetHeight - innerHeight >= scrollY + 100) {
                        button.classList.remove(`esgst-hidden`);
                    } else {
                        button.classList.add(`esgst-hidden`);
                    }
                });
                break;
            case 1:
                if (esgst.leftButtonIds.indexOf(`stbb`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                button = insertHtml(esgst.hideButtons && esgst.hideButtons_stbb ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-stbb-button esgst-heading-button" id="esgst-stbb" title="Scroll to bottom">
                        <i class="fa fa-chevron-down"></i>
                    </div>
                `);
                break;
            case 2:
                button = insertHtml(esgst.footer.firstElementChild.lastElementChild, `beforeEnd`, `
                    <div class="esgst-stbb-button" title="Scroll to bottom">
                        <i class="fa fa-chevron-down"></i>
                    </div>
                `);
                break;
        }
        button.addEventListener(`click`, () => animateScroll(document.documentElement.offsetHeight));
    }

    function loadSttb() {
        let button, key, position;
        switch (esgst.sttb_index) {
            case 0:
                button = insertHtml(document.body, `beforeEnd`, `
                    <div class="esgst-sttb-button esgst-sttb-button-fixed" title="Scroll to top">
                        <i class="fa fa-chevron-up"></i>
                    </div>
                `);
                button.classList.add(`esgst-hidden`);
                addEventListener(`scroll`, () => {
                    if (scrollY > 100) {
                        button.classList.remove(`esgst-hidden`);
                    } else {
                        button.classList.add(`esgst-hidden`);
                    }
                });
                break;
            case 1:
                if (esgst.leftButtonIds.indexOf(`sttb`) > -1) {
                    key = `leftButtons`;
                    position = `afterBegin`;
                } else {
                    key = `rightButtons`;
                    position = `beforeEnd`;
                }
                button = insertHtml(esgst.hideButtons && esgst.hideButtons_sttb ? esgst[key] : esgst.mainPageHeading, position, `
                    <div class="esgst-sttb-button esgst-heading-button" id="esgst-sttb" title="Scroll to top">
                        <i class="fa fa-chevron-up"></i>
                    </div>
                `);
                break;
            case 2:
                button = insertHtml(esgst.footer.firstElementChild.lastElementChild, `beforeEnd`, `
                    <div class="esgst-sttb-button" title="Scroll to top">
                        <i class="fa fa-chevron-up"></i>
                    </div>
                `);
                break;
        }
        button.addEventListener(`click`, animateScroll.bind(null, 0));
    }

    function animateScroll(y) {
        // From https://stackoverflow.com/a/26808520/8115112

        var currentTime, time;
        currentTime = 0;
        if (y > 0) {
            y -= esgst.commentsTop;
        }
        time = Math.max(0.1, Math.min(Math.abs(scrollY - y) / 2000, 0.8));

        function tick() {
            var p;
            currentTime += 1 / 60;
            p = currentTime / time;
            if (p < 1) {
                requestAnimationFrame(tick);
                scrollTo(0, scrollY + ((y - scrollY) * ((p /= 0.5) < 1 ? 0.5 * Math.pow(p, 5) : 0.5 * (Math.pow((p - 2), 5) + 2))));
            } else {
                scrollTo(0, y);
            }
        }

        tick();
    }

    /* [ES] Endless Scrolling */

    function loadEs() {
        let busy, continuous, continuousButton, currentPage, divisors, ended, i, lastLink, mainContext, n, nextButton, nextPage, pageIndex, paginations, pageBase, pauseButton, paused, progress, refreshAllButton, refreshButton, resumeButton, reversePages, reverseScrolling, row, step;
        if (esgst.es && esgst.mainPageHeading && esgst.pagination && ((esgst.es_g && esgst.giveawaysPath) || (esgst.es_d && esgst.discussionsTicketsPath) || (esgst.es_t && esgst.tradesPath) || (esgst.es_c && esgst.commentsPath) || (esgst.es_l && !esgst.giveawaysPath && !esgst.discussionsTicketsPath && !esgst.tradesPath && !esgst.commentsPath))) {
            divisors = ((esgst.es_g_d && esgst.giveawaysPath) || (esgst.es_d_d && esgst.discussionsTicketsPath) || (esgst.es_t_d && esgst.tradesPath) || (esgst.es_c_d && esgst.commentsPath) || (esgst.es_l_d && !esgst.giveawaysPath && !esgst.discussionsTicketsPath && !esgst.tradesPath && !esgst.commentsPath));
            mainContext = esgst.pagination.previousElementSibling;
            rows = mainContext.getElementsByClassName(`table__rows`)[0];
            if (rows) {
                mainContext = rows;
            }
            paginations = [esgst.paginationNavigation ? esgst.paginationNavigation.innerHTML : ``];
            reverseScrolling = esgst.es_r && esgst.discussionPath;
            if (reverseScrolling) {
                if (esgst.currentPage === 1 && esgst.paginationNavigation && document.referrer.match(/www.steamgifts.com\/($|discussions|messages)/)) {
                    for (i = 0, n = mainContext.children.length; i < n; ++i) {
                        mainContext.children[0].remove();
                    }
                    esgst.currentComments = [];
                    esgst.pagination.firstElementChild.firstElementChild.nextElementSibling.textContent = 0;
                    if (esgst.paginationNavigation) {
                        lastLink = esgst.paginationNavigation.lastElementChild;
                        if (lastLink.classList.contains(`is-selected`) && lastLink.textContent.match(/Last/) && !esgst.lastPageLink) {
                            currentPage = parseInt(lastLink.getAttribute(`data-page-number`));
                        } else {
                            currentPage = 999999999;
                        }
                    } else {
                        currentPage = 999999999;
                    }
                    nextPage = currentPage;
                    reversePages = true;
                    ended = false;
                    activateEndlessScrolling();
                } else {
                    currentPage = esgst.currentPage;
                    nextPage = currentPage - 1;
                    pageBase = currentPage + 1;
                    ended = nextPage === 0;
                    activateEndlessScrolling();
                }
            } else {
                currentPage = esgst.currentPage;
                nextPage = currentPage + 1;
                pageBase = currentPage - 1;
                ended = (!esgst.paginationNavigation || esgst.paginationNavigation.lastElementChild.classList.contains(esgst.selectedClass));
                activateEndlessScrolling();
            }
        }

        function activateEndlessScrolling() {
            var i, n;
            for (i = 0, n = mainContext.children.length; i < n; ++i) {
                mainContext.children[i].classList.add(`esgst-es-page-${currentPage}`);
            }
            let key, position;
            if (esgst.leftButtonIds.indexOf(`esNext`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            nextButton = insertHtml(esgst.hideButtons && esgst.hideButtons_esNext ? esgst[key] : esgst.mainPageHeading, position, `
                <div class="esgst-heading-button esgst-es-next-button" id="esgst-esNext" title="Load next page">
                    <i class="fa fa-step-forward"></i>
                </div>
            `);
            if (esgst.leftButtonIds.indexOf(`esContinuous`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            continuousButton = insertHtml(esgst.hideButtons && esgst.hideButtons_esContinuous ? esgst[key] : esgst.mainPageHeading, position, `
                <div class="esgst-heading-button esgst-es-continuous-button" id="esgst-esContinuous" title="Continuously load pages">
                    <i class="fa fa-fast-forward"></i>
                </div>
            `);
            if (esgst.leftButtonIds.indexOf(`esPause`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            if (ended) {
                continuousButton.classList.add(`esgst-hidden`);
            }
            pauseButton = insertHtml(esgst.hideButtons && esgst.hideButtons_esPause ? esgst[key] : esgst.mainPageHeading, position, `
                <div class="esgst-heading-button esgst-es-pause-button" id="esgst-esPause" title="Pause the endless scrolling">
                    <i class="fa fa-pause"></i>
                </div>
            `);
            if (esgst.leftButtonIds.indexOf(`esResume`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            resumeButton = insertHtml(esgst.hideButtons && esgst.hideButtons_esPause ? esgst[key] : esgst.mainPageHeading, position, `
                <div class="esgst-heading-button esgst-es-resume-button esgst-hidden" id="esgst-esResume" title="Resume the endless scrolling">
                    <i class="fa fa-play"></i>
                </div>
            `);
            if (esgst.leftButtonIds.indexOf(`esRefresh`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            refreshButton = insertHtml(esgst.hideButtons && esgst.hideButtons_esRefresh ? esgst[key] : esgst.mainPageHeading, position, `
                <div class="esgst-heading-button esgst-es-refresh-button" id="esgst-esRefresh" title="Refresh current page">
                    <i class="fa fa-refresh"></i>
                    <i class="fa fa-map-marker"></i>
                </div>
            `);
            if (esgst.leftButtonIds.indexOf(`esRefreshAll`) > -1) {
                key = `leftButtons`;
                position = `afterBegin`;
            } else {
                key = `rightButtons`;
                position = `beforeEnd`;
            }
            refreshAllButton = insertHtml(esgst.hideButtons && esgst.hideButtons_esRefreshAll ? esgst[key] : esgst.mainPageHeading, position, `
                <div class="esgst-heading-button esgst-es-refresh-all-button" id="esgst-esRefreshAll" title="Refresh all pages">
                    <i class="fa fa-refresh"></i>
                </div>
            `);
            refreshButton.addEventListener(`click`, refreshPage);
            refreshAllButton.addEventListener(`click`, refreshAllPages);
            continuousButton.addEventListener(`click`, continuouslyLoad);
            nextButton.addEventListener(`click`, stepNextPage);
            pauseButton.addEventListener(`click`, pauseEndlessScrolling);
            resumeButton.addEventListener(`click`, resumeEndlessScrolling);
            if (esgst.paginationNavigation) {
                lastLink = esgst.paginationNavigation.lastElementChild;
                if (esgst.lastPageLink && esgst.lastPage !== pageIndex && !lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
                    esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
                }
                setEsPaginationNavigation();
            }
            busy = false;
            getValue(`esPause`, false).then(value => {
                if (value) {
                    pauseEndlessScrolling();
                } else {
                    paused = false;
                    document.addEventListener(`scroll`, loadNextPage);
                    loadNextPage();
                }
                pageIndex = currentPage;
                document.addEventListener(`scroll`, changePaginationNavigation);
                esgst.checkEndlessScrolling = loadNextPage;
            });
        }

        function loadNextPage(callback) {
            if (!esgst.stopEs && !busy && !paused && !ended && (continuous || step || scrollY >= document.body.offsetHeight - innerHeight * 2)) {
                busy = true;
                document.removeEventListener(`scroll`, loadNextPage);
                progress = insertHtml(esgst.pagination.firstElementChild, `beforeEnd`, `
                    <span class="esgst-bold"><i class="fa fa-circle-o-notch fa-spin"></i> Loading next page...</span>
                `);
                request(null, null, `GET`, false, `${esgst.searchUrl}${nextPage}`, getNextPage.bind(null, false, false, callback));
            } else if (callback && typeof callback === `function`) {
                callback();
            }
        }

        function getNextPage(refresh, refreshAll, callback, response) {
            var child, context, element, elements, fragment, i, n, oldN, rows, pagination, paginationNavigation;
            pagination = parseHtml(response.responseText).getElementsByClassName(`pagination`)[0];
            context = pagination.previousElementSibling;
            rows = context.getElementsByClassName(`table__rows`)[0];
            if (rows) {
                context = rows;
            }
            paginationNavigation = pagination.getElementsByClassName(esgst.paginationNavigationClass)[0];
            if (reversePages) {
                paginations[0] = paginationNavigation.innerHTML;
                esgst.paginationNavigation.innerHTML = paginations[0];
                if (esgst.paginationNavigation) {
                    lastLink = esgst.paginationNavigation.lastElementChild;
                    if (esgst.lastPageLink && esgst.lastPage !== pageIndex && !lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
                        esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
                    }
                    setEsPaginationNavigation();
                }
                reversePages = false;
                if (currentPage === 999999999) {
                    currentPage = parseInt(paginationNavigation.lastElementChild.getAttribute(`data-page-number`));
                    nextPage = currentPage;
                    pageBase = currentPage + 1;
                    pageIndex = currentPage;
                }
            } else if (refresh) {
                pagination = paginations[(reverseScrolling ? pageBase - (refreshAll || pageIndex) : (refreshAll || pageIndex) - pageBase) - 1];
                if (paginationNavigation && pagination !== paginationNavigation.innerHTML) {
                    paginations[(reverseScrolling ? pageBase - (refreshAll || pageIndex) : (refreshAll || pageIndex) - pageBase) - 1] = paginationNavigation.innerHTML;
                    ended = false;
                }
            } else {
                paginations.push(paginationNavigation.innerHTML);
            }
            fragment = document.createDocumentFragment();
            if (esgst.cr && esgst.discussionPath) {
                reverseComments(context);
            }
            new Promise((resolve, reject) => {
                if (refreshAll) {
                    resolve();
                } else {
                    loadEndlessFeatures(context, true, null, true).then(() => {
                        setESRemoveEntry(context);
                        resolve();
                    });
                }
            }).then(() => {
                n = context.children.length;
                for (i = 0; i < n; ++i) {
                    child = context.children[0];
                    child.classList.add(`esgst-es-page-${refresh ? refreshAll || pageIndex : nextPage}`);
                    fragment.appendChild(child);
                }
                if (refresh) {
                    elements = document.getElementsByClassName(`esgst-es-page-${refreshAll || pageIndex}`);
                    oldN = elements.length;
                    for (i = 1; i < oldN; ++i) {
                        elements[0].remove();
                    }
                    element = elements[0];
                    mainContext.insertBefore(fragment, element);
                    element.remove();
                    if (!refreshAll) {
                        if (esgst.gf && esgst.gf.filteredCount) {
                            updateGfCount(esgst.gf);
                        }
                        if (esgst.df && esgst.df.filteredCount) {
                            updateDfCount(esgst.df);
                        }
                        if (esgst.ts && !esgst.us) {
                            sortTsTables();
                        }
                    }
                    esgst.pagination.firstElementChild.firstElementChild.nextElementSibling.textContent = (parseInt(esgst.pagination.firstElementChild.firstElementChild.nextElementSibling.textContent.replace(/,/g, ``)) - oldN + n).toString().replace(/\B(?=(\d{3})+(?!\d))/g, `,`);
                    if (refreshAll) {
                        check.count += 1;
                    } else {
                        refreshButton.addEventListener(`click`, refreshPage);
                        refreshButton.innerHTML = `
                            <i class="fa fa-refresh"></i>
                            <i class="fa fa-map-marker"></i>
                        `;
                    }
                } else {
                    if (divisors) {
                        mainContext.insertAdjacentHTML(`beforeEnd`, `
                            <div class="esgst-page-heading esgst-es-page-divisor">
                                <div class="page__heading__breadcrumbs page_heading_breadcrumbs">
                                    <a href="${esgst.searchUrl}${nextPage}">Page ${nextPage}</a>
                                </div>
                            </div>
                        `);
                    }
                    mainContext.appendChild(fragment);
                    if (esgst.ts && !esgst.us) {
                        sortTsTables();
                    }
                    esgst.pagination.firstElementChild.firstElementChild.nextElementSibling.textContent = (parseInt(esgst.pagination.firstElementChild.firstElementChild.nextElementSibling.textContent.replace(/,/g, ``)) + n).toString().replace(/\B(?=(\d{3})+(?!\d))/g, `,`);
                    progress.remove();
                    if (reverseScrolling) {
                        --nextPage;
                        busy = false;
                        if (nextPage <= 0) {
                            ended = true;
                            if (callback && typeof callback === `function`) {
                                callback();
                            }
                        } else if (!paused && !step) {
                            if (!continuous) {
                                document.addEventListener(`scroll`, loadNextPage);
                            }
                            loadNextPage(callback);
                        } else if (callback && typeof callback === `function`) {
                            callback();
                        }
                    } else {
                        ++nextPage;
                        busy = false;
                        if (paginationNavigation.lastElementChild.classList.contains(esgst.selectedClass)) {
                            ended = true;
                            if (callback && typeof callback === `function`) {
                                callback();
                            }
                        } else if (!paused && !step) {
                            if (!continuous) {
                                document.addEventListener(`scroll`, loadNextPage);
                            }
                            loadNextPage(callback);
                        } else if (callback && typeof callback === `function`) {
                            callback();
                        }
                    }
                }
            });
        }

        function changePaginationNavigation() {
            var currentElement, nextElement, pagination;
            if (esgst.paginationNavigation && paginations.length > 0) {
                if (scrollY + innerHeight === document.documentElement.offsetHeight) {
                    pageIndex = reverseScrolling ? pageBase - paginations.length : pageBase + paginations.length;
                } else {
                    currentElement = document.querySelector(`.esgst-es-page-${pageIndex}:not(.esgst-hidden)`);
                    nextElement = document.querySelector(`.esgst-es-page-${reverseScrolling ? pageIndex - 1 : pageIndex + 1}:not(.esgst-hidden)`);
                    if (currentElement) {
                        if (scrollY + esgst.commentsTop < currentElement.offsetTop) {
                            if (pageIndex !== currentPage) {
                                pageIndex = reverseScrolling ? pageIndex + 1 : pageIndex - 1;
                            }
                        } else if (nextElement && scrollY + esgst.commentsTop >= nextElement.offsetTop) {
                            pageIndex = reverseScrolling ? pageIndex - 1 : pageIndex + 1;
                        }
                    } else if (nextElement && scrollY + esgst.commentsTop >= nextElement.offsetTop) {
                        pageIndex = reverseScrolling ? pageIndex - 1 : pageIndex + 1;
                    } else if (pageIndex !== currentPage) {
                        pageIndex = reverseScrolling ? pageIndex + 1 : pageIndex - 1;
                    }
                }
                pagination = paginations[(reverseScrolling ? pageBase - pageIndex : pageIndex - pageBase) - 1] || paginations[0];
                if (esgst.paginationNavigation.innerHTML !== pagination) {
                    esgst.paginationNavigation.innerHTML = pagination;
                    lastLink = esgst.paginationNavigation.lastElementChild;
                    if (esgst.lastPageLink && esgst.lastPage !== pageIndex && !lastLink.classList.contains(`is-selected`) && !lastLink.textContent.match(/Last/)) {
                        esgst.paginationNavigation.insertAdjacentHTML(`beforeEnd`, esgst.lastPageLink);
                    }
                    setEsPaginationNavigation();
                }
            }
        }

        function stepNextPage() {
            if (!step) {
                nextButton.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
                step = true;
                let wasPaused = paused;
                resumeEndlessScrolling();
                document.addEventListener(`scroll`, loadNextPage);
                loadNextPage(() => {
                    step = false;
                    if (wasPaused) {
                        pauseEndlessScrolling();
                    } else {
                        resumeEndlessScrolling();
                    }
                    nextButton.innerHTML = `<i class="fa fa-step-forward"></i>`;
                });
            }
        }

        function continuouslyLoad() {
            if (!continuous) {
                continuousButton.innerHTML = `<i class="fa fa-circle-o-notch fa-spin"></i>`;
                continuous = true;
                resumeEndlessScrolling();
                document.addEventListener(`scroll`, loadNextPage);
                loadNextPage(() => {
                    continuous = false;
                    continuousButton.innerHTML = `<i class="fa fa-fast-forward"></i>`;
                });
            }
        }

        function pauseEndlessScrolling() {
            if (!ended) {
                document.removeEventListener(`scroll`, loadNextPage);
            }
            pauseButton.classList.add(`esgst-hidden`);
            resumeButton.classList.remove(`esgst-hidden`);
            paused = true;
            setValue(`esPause`, paused).then(() => {
                continuous = false;
                continuousButton.innerHTML = `<i class="fa fa-fast-forward"></i>`;
            });
        }

        function resumeEndlessScrolling() {
            resumeButton.classList.add(`esgst-hidden`);
            pauseButton.classList.remove(`esgst-hidden`);
            paused = false;
            setValue(`esPause`, paused).then(() => {
                if (!ended && !continuous && !step) {
                    document.addEventListener(`scroll`, loadNextPage);
                    loadNextPage();
                }
            });
        }

        function refreshPage() {
            refreshButton.removeEventListener(`click`, refreshPage);
            refreshButton.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
            `;
            request(null, null, `GET`, false, `${esgst.searchUrl}${pageIndex}`, response => {
                getNextPage(true, false, null, response);
                if (esgst.giveawaysPath && esgst.es_rd) {
                    if (esgst.oadd) {
                        loadOadd(true);
                    } else {
                        checkMissingDiscussions(true);
                    }
                }
                if (esgst.pinnedGiveaways) {
                    esgst.pinnedGiveaways.innerHTML = parseHtml(response.responseText).getElementsByClassName(`pinned-giveaways__outer-wrap`)[0].innerHTML;
                    loadEndlessFeatures(esgst.pinnedGiveaways, true).then(loadPgb);
                }
            });
            if (!esgst.hr) {
                request(null, null, `GET`, false, esgst.sg ? `/giveaways/search?type=wishlist` : `/`, response => {
                    refreshHeaderElements(parseHtml(response.responseText)).then(() => {
                        refreshHeader(getHrCache());
                    });
                });
            }
        }

        function refreshAllPages() {
            var i, page, response;
            refreshAllButton.removeEventListener(`click`, refreshAllPages);
            refreshAllButton.innerHTML = `
                <i class="fa fa-circle-o-notch fa-spin"></i>
            `;
            check = new CompletionCheck(paginations.length, () => {
                return loadEndlessFeatures(mainContext, true);
            }).then(() => {
                setESRemoveEntry(mainContext);
                refreshAllButton.addEventListener(`click`, refreshAllPages);
                refreshAllButton.innerHTML = `
                    <i class="fa fa-refresh"></i>
                `;
                if (esgst.gf && esgst.gf.filteredCount) {
                    updateGfCount(esgst.gf);
                }
                if (esgst.df && esgst.df.filteredCount) {
                    updateDfCount(esgst.df);
                }
                if (esgst.ts && !esgst.us) {
                    sortTsTables();
                }
                if (esgst.giveawaysPath && esgst.es_rd) {
                    if (esgst.oadd) {
                        loadOadd(true);
                    } else {
                        checkMissingDiscussions(true);
                    }
                }
                if (esgst.pinnedGiveaways) {
                    esgst.pinnedGiveaways.innerHTML = parseHtml(response.responseText).getElementsByClassName(`pinned-giveaways__outer-wrap`)[0].innerHTML;
                    loadEndlessFeatures(esgst.pinnedGiveaways, true).then(loadPgb);
                }
            });
            page = reverseScrolling ? pageBase - 1 : pageBase + 1;
            request(null, null, `GET`, false, `${esgst.searchUrl}${page}`, rsp => {
                response = rsp;
                getNextPage(true, page, null, rsp);
                for (i = 1; i < check.total; ++i) {
                    page = reverseScrolling ? pageBase - (i + 1) : pageBase + (i + 1);
                    request(null, null, `GET`, false, `${esgst.searchUrl}${page}`, getNextPage.bind(null, true, page, null));
                }
            });
            if (!esgst.hr) {
                request(null, null, `GET`, false, esgst.sg ? `/giveaways/search?type=wishlist` : `/`, rsp => {
                    refreshHeaderElements(parseHtml(rsp.responseText)).then(() => {
                        refreshHeader(getHrCache());
                    });
                });
            }
        }
    }

    function reverseComments(context) {
        var i, n;
        var frag = document.createDocumentFragment();
        for (i = 0, n = context.children.length; i < n; ++i) {
            frag.appendChild(context.lastElementChild);
        }
        context.appendChild(frag);
    }

    function setEsPaginationNavigation() {
        var matches, i, n;
        matches = esgst.paginationNavigation.children;
        for (i = 0, n = matches.length; i < n; ++i) {
            matches[i].addEventListener(`click`, setEsPaginationNavigationItem);
        }
    }

    function setEsPaginationNavigationItem(event) {
        var page;
        event.preventDefault();
        page = event.currentTarget.getAttribute(`data-page-number`);
        element = document.querySelector(`.esgst-es-page-${page}:not(.esgst-hidden)`);
        if (element) {
            animateScroll(element.offsetTop);
        } else {
            location.href = event.currentTarget.getAttribute(`href`);
        }
    }

    function setESRemoveEntry(Context) {
        var Matches, I, N;
        Matches = Context.getElementsByClassName(`table__row-inner-wrap`);
        for (I = 0, N = Matches.length; I < N; ++I) {
            removeESEntry(Matches[I]);
        }
    }

    function removeESEntry(Context) {
        var Default, Loading, Complete, Data;
        Default = Context.getElementsByClassName(`table__remove-default`)[0];
        if (Default) {
            Loading = Default.nextElementSibling;
            Complete = Loading.nextElementSibling;
            Default.addEventListener(`click`, function () {
                var Values, I, N;
                Default.classList.toggle(`is-hidden`);
                Loading.classList.toggle(`is-hidden`);
                Values = Context.getElementsByTagName(`input`);
                Data = ``;
                for (I = 0, N = Values.length; I < N; ++I) {
                    Data += `${Values[I].getAttribute(`name`)}=${Values[I].value}${I < (N - 1) ? `&` : ``}`;
                }
                request(Data, null, `POST`, false, `/ajax.php`, function (Response) {
                    Loading.classList.toggle(`is-hidden`);
                    let responseJson = JSON.parse(Response.responseText);
                    if (responseJson.type === `success`) {
                        Context.classList.add(`is-faded`);
                        Complete.classList.toggle(`is-hidden`);
                        esgst.pointsContainer.textContent = responseJson.points;
                        esgst.points = parseInt(esgst.pointsContainer.textContent.match(/\d+/)[0]);
                    } else {
                        Default.classList.toggle(`is-hidden`);
                    }
                });
            });
        }
    }

    function loadEndlessFeatures(context, main, source, endless) {
        return new Promise((resolve, reject) => {
            loadEndlessFeature(context, main, source, endless, 0, esgst.endlessFeatures.length, resolve);
        });
    }

    function loadEndlessFeature(context, main, source, endless, i, n, resolve) {
        if (i < n) {
            Promise.resolve(esgst.endlessFeatures[i](context, main, source, endless)).then(setTimeout.bind(null, loadEndlessFeature, 0, context, main, source, endless, i + 1, n, resolve));
        } else {
            resolve();
        }
    }

    /* [STO] Same Tab Opener */

    function setStoLinks(context) {
        var elements, i, n;
        elements = context.querySelectorAll(`[target="_blank"]`);
        for (i = 0, n = elements.length; i < n; ++i) {
            elements[i].removeAttribute(`target`);
        }
    }

    /*
        * Helper Functions
        */

    function createAlert(message) {
        var popup;
        popup = new Popup(`fa-exclamation`, message, true);
        popup.open();
    }

    function createConfirmation(message, onYes, onNo) {
        var callback, popup;
        callback = onNo;
        popup = new Popup(`fa-question`, message, true);
        popup.description.appendChild(new ButtonSet(`green`, ``, `fa-check`, ``, `Yes`, ``, function () {
            callback = onYes;
            popup.close();
        }).set);
        popup.description.appendChild(new ButtonSet(`red`, ``, `fa-times`, ``, `No`, ``, function () {
            callback = onNo;
            popup.close();
        }).set);
        popup.onClose = function () {
            if (callback) {
                callback();
            }
        };
        popup.open();
    }

    function multiChoice(choice1Color, choice1Icon, choice1Title, choice2Color, choice2Icon, choice2Title, title, onChoice1, onChoice2) {
        if (esgst.settings.cfh_img_remember) {
            if (esgst.cfh_img_choice === 1) {
                onChoice1();
            } else {
                onChoice2();
            }
        } else {
            let popup = new Popup(`fa-list`, title, true);
            new ToggleSwitch(popup.description, `cfh_img_remember`, false, `Never ask again.`, false, false, `Remembers which option you choose forever.`, esgst.settings.cfh_img_remember);
            popup.description.appendChild(new ButtonSet(choice1Color, ``, choice1Icon, ``, choice1Title, ``, callback => {
                if (esgst.settings.cfh_img_remember) {
                    setValue(`cfh_img_choice`, 1);
                    esgst.cfh_img_choice = 1;
                }
                callback();
                popup.close();
                onChoice1();
            }).set);
            popup.description.appendChild(new ButtonSet(choice2Color, ``, choice2Icon, ``, choice2Title, ``, callback => {
                if (esgst.settings.cfh_img_remember) {
                    setValue(`cfh_img_choice`, 2);
                    esgst.cfh_img_choice = 2;
                }
                callback();
                popup.close();
                onChoice2();
            }).set);
            popup.open();
        }
    }

    function createFadeMessage(context, message) {
        context.textContent = message;
        setTimeout(function () {
            context.textContent = ``;
        }, 2000);
    }

    /* Data Management */

    function checkBackup() {
        if (!getLocalValue(`isBackingUp`) && Date.now() - esgst.lastBackup > esgst.autoBackup_days * 86400000) {
            setLocalValue(`isBackingUp`, 1);
            loadDataManagement(false, `export`, true);
        }
    }

    function loadDataManagement(openInTab, type, autoBackup) {
        var container, context, group1, group2, i, icon, input, n, onClick, option, options, prep, popup, section, title1, title2;
        dm = {
            autoBackup: autoBackup,
            type: type
        };
        dm[type] = true;
        switch (type) {
            case `import`:
                icon = `fa-arrow-circle-up`;
                onClick = loadImportFile;
                prep = `from`;
                title1 = `Import`;
                title2 = `Importing`;
                break;
            case `export`:
                icon = `fa-arrow-circle-down`;
                onClick = manageData;
                prep = `to`;
                title1 = `Export`;
                title2 = `Exporting`;
                break;
            case `delete`:
                icon = `fa-trash`;
                onClick = confirmDataDeletion;
                prep = `from`;
                title1 = `Delete`;
                title2 = `Deleting`;
                break;
        }
        if (openInTab) {
            document.body.className = `esgst-tab-menu`;
            context = container = document.body;
            context.innerHTML = ``;
        } else {
            if (dm.autoBackup) {
                popup = new Popup(`fa-circle-o-notch fa-spin`, `ESGST is backing up your data... Please do not close this window until it is done.`, true, true);
            } else {
                popup = new Popup(icon, title1, true, true);
            }
            popup.description.classList.add(`esgst-text-left`);
            context = popup.scrollable;
            container = popup.description;
        }
        if (!dm.autoBackup) {
            dm.computerSpace = insertHtml(container, `afterBegin`, `
                <div>Total: <span class="esgst-bold"></span></div>
            `);
            section = createMenuSection(context, null, 1, title1);
        }
        dm.switches = {};
        dm.options = [
            {
                check: true,
                key: `decryptedGiveaways`,
                name: `Decrypted Giveaways`
            },
            {
                check: esgst.sg,
                key: `dfPresets`,
                name: `Discussion Filters Presets`
            },
            {
                check: esgst.sg,
                key: `discussions`,
                name: `Discussions`,
                options: [
                    {
                        key: `discussions_main`,
                        name: `Main`
                    },
                    {
                        key: `discussions_ct`,
                        name: `Comment Tracker`
                    },
                    {
                        key: `discussions_df`,
                        name: `Discussion Filters`
                    },
                    {
                        key: `discussions_dh`,
                        name: `Discussion Highlighter`
                    },
                    {
                        key: `discussions_gdttt`,
                        name: `Giveaways/Discussions/Tickets/Trades Tracker`
                    },
                    {
                        key: `discussions_pm`,
                        name: `Puzzle Marker`
                    }
                ]
            },
            {
                check: true,
                key: `emojis`,
                name: `Emojis`
            },
            {
                check: esgst.sg,
                key: `entries`,
                name: `Entries`
            },
            {
                check: true,
                key: `games`,
                name: `Games`,
                options: [
                    {
                        key: `games_main`,
                        name: `Main`
                    },
                    {
                        key: `games_egh`,
                        name: `Entered Games Highlighter`
                    },
                    {
                        key: `games_gt`,
                        name: `Game Tags`
                    },
                    {
                        key: `games_itadi`,
                        name: `Is There Any Data? Info`
                    }
                ]
            },
            {
                check: esgst.sg,
                key: `filterPresets`,
                name: `Giveaway Filters Presets`
            },
            {
                check: esgst.sg,
                key: `giveaways`,
                name: `Giveaways`,
                options: [
                    {
                        key: `giveaways_main`,
                        name: `Main`
                    },
                    {
                        key: `giveaways_ct`,
                        name: `Comment Tracker`
                    },
                    {
                        key: `giveaways_gb`,
                        name: `Giveaway Bookmarks`
                    },
                    {
                        key: `giveaways_gdttt`,
                        name: `Giveaways/Discussions/Tickets/Trades Tracker`
                    },
                    {
                        key: `giveaways_gf`,
                        name: `Giveaway Filters`
                    },
                    {
                        key: `giveaways_ggl`,
                        name: `Giveaway Groups Loader`
                    }
                ]
            },
            {
                check: esgst.sg,
                key: `groups`,
                name: `Groups`,
                options: [
                    {
                        key: `groups_main`,
                        name: `Main`
                    },
                    {
                        key: `groups_sgg`,
                        name: `Stickied Giveaway Groups`
                    }
                ]
            },
            {
                check: esgst.sg,
                key: `rerolls`,
                name: `Rerolls`
            },
            {
                check: true,
                key: `savedReplies`,
                name: `Saved Replies`
            },
            {
                check: true,
                key: `settings`,
                name: `Settings`
            },
            {
                check: true,
                key: `sgCommentHistory`,
                name: `SG Comment History`
            },
            {
                check: true,
                key: `stCommentHistory`,
                name: `ST Comment History`
            },
            {
                check: esgst.sg,
                key: `stickiedCountries`,
                name: `Stickied Giveaway Countries`
            },
            {
                check: esgst.sg,
                key: `templates`,
                name: `Templates`
            },
            {
                check: esgst.sg,
                key: `tickets`,
                name: `Tickets`,
                options: [
                    {
                        key: `tickets_main`,
                        name: `Main`
                    },
                    {
                        key: `tickets_ct`,
                        name: `Comment Tracker`
                    },
                    {
                        key: `tickets_gdttt`,
                        name: `Giveaways/Discussions/Tickets/Trades Tracker`
                    },
                    {
                        key: `tickets_ust`,
                        name: `User Suspension Tracker`
                    }
                ]
            },
            {
                check: esgst.st,
                key: `trades`,
                name: `Trades`,
                options: [
                    {
                        key: `trades_main`,
                        name: `Main`
                    },
                    {
                        key: `trades_ct`,
                        name: `Comment Tracker`
                    },
                    {
                        key: `trades_gdttt`,
                        name: `Giveaways/Discussions/Tickets/Trades Tracker`
                    }
                ]
            },
            {
                check: true,
                key: `users`,
                name: `Users`,
                options: [
                    {
                        key: `users_main`,
                        name: `Main`
                    },
                    {
                        key: `users_namwc`,
                        name: `Not Activated/Multiple Wins Checker`
                    },
                    {
                        key: `users_nrf`,
                        name: `Not Received Finder`
                    },
                    {
                        key: `users_uf`,
                        name: `User Filters`
                    },
                    {
                        key: `users_giveaways`,
                        name: `Giveaways Data`
                    },
                    {
                        key: `users_notes`,
                        name: `User Notes`
                    },
                    {
                        key: `users_tags`,
                        name: `User Tags`
                    },
                    {
                        key: `users_wbc`,
                        name: `Whitelist/Blacklist Checker`
                    }
                ]
            },
            {
                check: esgst.sg,
                key: `winners`,
                name: `Winners`
            }
        ];
        if (dm.autoBackup) {
            let dropbox, googleDrive, oneDrive;
            switch (esgst.autoBackup_index) {
                case 0:
                    break;
                case 1:
                    dropbox = true;
                    break;
                case 2:
                    googleDrive = true;
                    break;
                case 3:
                    oneDrive = true;
                    break;
            }
            popup.open();
            manageData(dm, dropbox, googleDrive, oneDrive, false, () => {
                delLocalValue(`isBackingUp`);
                setSetting(`lastBackup`, Date.now()).then(() => popup.close());
            });
        } else {
            for (i = 0, n = dm.options.length; i < n; ++i) {
                option = dm.options[i];
                if (option.check) {
                    section.lastElementChild.appendChild(getDataMenu(option, dm.switches, type));
                }
            }
            if (type === `import` || type === `delete`) {
                if (type === `import`) {
                    dm.input = insertHtml(container, `beforeEnd`, `<input type="file"/>`);
                    new ToggleSwitch(container, `importAndMerge`, false, `Merge`, false, false, `Merges the current data with the imported data instead of replacing`, esgst.settings.importAndMerge);
                }
                let select = new ToggleSwitch(container, `exportBackup`, false, `Export backup to <select><option>Computer</option><option>Dropbox</option><option>Google Drive</option><option>OneDrive</option></select>`, false, false, `Exports the current data as a backup`, esgst.settings.exportBackup).name.firstElementChild;
                select.selectedIndex = esgst.settings.exportBackupIndex;
                select.addEventListener(`change`, () => {
                    setSetting(`exportBackupIndex`, select.selectedIndex);
                });
            }
            dm.message = insertHtml(container, `beforeEnd`, `<div class="esgst-description"></div>`);
            dm.warning = insertHtml(container, `beforeEnd`, `<div class="esgst-description esgst-warning"></div>`);
            group1 = insertHtml(container, `beforeEnd`, `<div class="esgst-button-group"><span>Select:</span></div>`);
            group1.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle`, `fa-circle-o-notch fa-spin`, `All`, ``, selectSwitches.bind(null, dm.switches, `enable`)).set);
            group1.appendChild(new ButtonSet(`grey`, `grey`, `fa-circle-o`, `fa-circle-o-notch fa-spin`, `None`, ``, selectSwitches.bind(null, dm.switches, `disable`)).set);
            group1.appendChild(new ButtonSet(`grey`, `grey`, `fa-dot-circle-o`, `fa-circle-o-notch fa-spin`, `Inverse`, ``, selectSwitches.bind(null, dm.switches, `toggle`)).set);
            group2 = insertHtml(container, `beforeEnd`, `<div class="esgst-button-group"><span>${title1} ${prep}:</span></div>`);
            group2.appendChild(new ButtonSet(`green`, `grey`, icon, `fa-circle-o-notch fa-spin`, `Computer`, title2, callback => {
                onClick(dm, false, false, false, false, () => {
                    manageData(dm, false, false, false, true);
                    callback();
                });
            }).set);
            if (type !== `delete`) {
                group2.appendChild(new ButtonSet(`green`, `grey`, `fa-dropbox`, `fa-circle-o-notch fa-spin`, `Dropbox`, title2, callback => {
                    onClick(dm, true, false, false, false, () => {
                        manageData(dm, false, false, false, true);
                        callback();
                    });
                }).set);
                group2.appendChild(new ButtonSet(`green`, `grey`, `fa-google`, `fa-circle-o-notch fa-spin`, `Google Drive`, title2, callback => {
                    onClick(dm, false, true, false, false, () => {
                        manageData(dm, false, false, false, true);
                        callback();
                    });
                }).set);
                group2.appendChild(new ButtonSet(`green`, `grey`, `fa-windows`, `fa-circle-o-notch fa-spin`, `OneDrive`, title2, callback => {
                    onClick(dm, false, false, true, false, () => {
                        manageData(dm, false, false, false, true);
                        callback();
                    });
                }).set);
            }
            if (!openInTab) {
                popup.open();
            }
            manageData(dm, false, false, false, true);
        }
    }

    function loadDataCleaner() {
        let popup = new Popup(`fa-paint-brush`, `Clean old data:`);
        popup.description.insertAdjacentHTML(`afterBegin`, `<div class="esgst-bold esgst-description esgst-red">Make sure to backup your data before using the cleaner.</div>`);
        new ToggleSwitch(popup.description, `cleanDiscussions`, false, `Discussions data older than <input class="esgst-switch-input" type="text" value="${esgst.cleanDiscussions_days}"> days.`, false, false, `Discussions data only started being date-tracked since v7.11.0, so not all old data may be cleaned.`, esgst.cleanDiscussions).name.firstElementChild.addEventListener(`change`, event => {
            let value = parseInt(event.currentTarget.value);
            setSetting(`cleanDiscussions_days`, value);
            esgst.cleanDiscussions_days = parseInt(value);
        });
        new ToggleSwitch(popup.description, `cleanEntries`, false, `Entries data older than <input class="esgst-switch-input" type="text" value="${esgst.cleanEntries_days}"> days.`, false, false, ``, esgst.cleanEntries).name.firstElementChild.addEventListener(`change`, event => {
            let value = parseInt(event.currentTarget.value);
            setSetting(`cleanEntries_days`, value);
            esgst.cleanEntries_days = parseInt(value);
        });
        new ToggleSwitch(popup.description, `cleanGiveaways`, false, `Giveaways data older than <input class="esgst-switch-input" type="text" value="${esgst.cleanGiveaways_days}"> days.`, false, false, `Some giveaways data only started being date-tracked since v7.11.0, so not all old data may be cleaned.`, esgst.cleanGiveaways).name.firstElementChild.addEventListener(`change`, event => {
            let value = parseInt(event.currentTarget.value);
            setSetting(`cleanGiveaways_days`, value);
            esgst.cleanGiveaways_days = parseInt(value);
        });
        new ToggleSwitch(popup.description, `cleanSgCommentHistory`, false, `SteamGifts comment history data older than <input class="esgst-switch-input" type="text" value="${esgst.cleanSgCommentHistory_days}"> days.`, false, false, ``, esgst.cleanSgCommentHistory).name.firstElementChild.addEventListener(`change`, event => {
            let value = parseInt(event.currentTarget.value);
            setSetting(`cleanSgCommentHistory_days`, value);
            esgst.cleanSgCommentHistory_days = parseInt(value);
        });
        new ToggleSwitch(popup.description, `cleanStCommentHistory`, false, `SteamTrades comment history data older than <input class="esgst-switch-input" type="text" value="${esgst.cleanStCommentHistory_days}"> days.`, false, false, ``, esgst.cleanStCommentHistory).name.firstElementChild.addEventListener(`change`, event => {
            let value = parseInt(event.currentTarget.value);
            setSetting(`cleanStCommentHistory_days`, value);
            esgst.cleanStCommentHistory_days = parseInt(value);
        });
        new ToggleSwitch(popup.description, `cleanTickets`, false, `Tickets data older than <input class="esgst-switch-input" type="text" value="${esgst.cleanTickets_days}"> days.`, false, false, `Tickets data only started being date-tracked since v7.11.0, so not all old data may be cleaned.`, esgst.cleanTickets).name.firstElementChild.addEventListener(`change`, event => {
            let value = parseInt(event.currentTarget.value);
            setSetting(`cleanTickets_days`, value);
            esgst.cleanTickets_days = parseInt(value);
        });
        new ToggleSwitch(popup.description, `cleanTrades`, false, `Trades data older than <input class="esgst-switch-input" type="text" value="${esgst.cleanTrades_days}"> days.`, false, false, `Trades data only started being date-tracked since v7.11.0, so not all old data may be cleaned.`, esgst.cleanTrades).name.firstElementChild.addEventListener(`change`, event => {
            let value = parseInt(event.currentTarget.value);
            setSetting(`cleanTrades_days`, value);
            esgst.cleanTrades_days = parseInt(value);
        });
        popup.description.appendChild(new ButtonSet(`green`, `grey`, `fa-check`, `fa-circle-o-notch fa-spin`, `Clean`, `Cleaning...`, callback => {
            let code, currentTime, days, item, items, newItems;
            currentTime = Date.now();
            getValue(`discussions`).then(value => {
                if (esgst.cleanDiscussions) {
                    days = esgst.cleanDiscussions_days * 86400000;
                    items = JSON.parse(value);
                    for (code in items) {
                        item = items[code];
                        if (item.author !== esgst.username && item.lastUsed && currentTime - item.lastUsed > days) {
                            delete items[code];
                        }
                    }
                    return setValue(`discussions`, JSON.stringify(items));
                } else {
                    return new Promise((resolve, reject) => resolve());
                }
            }).then(getValue.bind(null, `entries`)).then(value => {
                if (esgst.cleanEntries) {
                    days = esgst.cleanEntries_days * 86400000;
                    items = JSON.parse(value);
                    newItems = [];
                    items.forEach(item => {
                        if (currentTime - item.timestamp <= days) {
                            newItems.push(item);
                        }
                    });
                    return setValue(`entries`, JSON.stringify(newItems));
                } else {
                    return new Promise((resolve, reject) => resolve());
                }
            }).then(getValue.bind(null, `giveaways`)).then(value => {
                if (esgst.cleanGiveaways) {
                    days = esgst.cleanGiveaways_days * 86400000;
                    items = JSON.parse(value);
                    for (code in items) {
                        item = items[code];
                        if (item.creator !== esgst.username && ((item.endTime && currentTime - item.endTime > days) || (item.lastUsed && currentTime - item.lastUsed > days))) {
                            delete items[code];
                        }
                    }
                    return setValue(`giveaways`, JSON.stringify(items));
                } else {
                    return new Promise((resolve, reject) => resolve());
                }
            }).then(getValue.bind(null, `sgCommentHistory`)).then(value => {
                if (esgst.cleanSgCommentHistory) {
                    days = esgst.cleanSgCommentHistory_days * 86400000;
                    items = JSON.parse(value);
                    newItems = [];
                    items.forEach(item => {
                        if (currentTime - item.timestamp <= days) {
                            newItems.push(item);
                        }
                    });
                    return setValue(`sgCommentHistory`, JSON.stringify(newItems));
                } else {
                    return new Promise((resolve, reject) => resolve());
                }
            }).then(getValue.bind(null, `stCommentHistory`)).then(value => {
                if (esgst.cleanStCommentHistory) {
                    days = esgst.cleanStCommentHistory_days * 86400000;
                    items = JSON.parse(value);
                    newItems = [];
                    items.forEach(item => {
                        if (currentTime - item.timestamp <= days) {
                            newItems.push(item);
                        }
                    });
                    return setValue(`stCommentHistory`, JSON.stringify(newItems));
                } else {
                    return new Promise((resolve, reject) => resolve());
                }
            }).then(getValue.bind(null, `tickets`)).then(value => {
                if (esgst.cleanTickets) {
                    days = esgst.cleanTickets_days * 86400000;
                    items = JSON.parse(value);
                    for (code in items) {
                        item = items[code];
                        if (item.author !== esgst.username && item.lastUsed && currentTime - item.lastUsed > days) {
                            delete items[code];
                        }
                    }
                    return setValue(`tickets`, JSON.stringify(items));
                } else {
                    return new Promise((resolve, reject) => resolve());
                }
            }).then(getValue.bind(null, `trades`)).then(value => {
                if (esgst.cleanTrades) {
                    days = esgst.cleanTrades_days * 86400000;
                    items = JSON.parse(value);
                    for (code in items) {
                        item = items[code];
                        if (item.author !== esgst.username && item.lastUsed && currentTime - item.lastUsed > days) {
                            delete items[code];
                        }
                    }
                    return setValue(`trades`, JSON.stringify(items));
                } else {
                    return new Promise((resolve, reject) => resolve());
                }
            }).then(() => {
                callback();
                popup.close();
            });
        }).set);
        popup.open();
    }

    function getDataMenu(option, switches, type) {
        var i, m, menu, n, options, toggleSwitch;
        menu = document.createElement(`div`);
        switches[option.key] = toggleSwitch = new ToggleSwitch(menu, `${type}_${option.key}`, false, option.name, false, false, null, esgst.settings[`${type}_${option.key}`]);
        switches[option.key].size = insertHtml(switches[option.key].name, `beforeEnd`, ` <span class="esgst-bold"></span>`);
        if (option.name === `Main`) {
            switches[option.key].name.insertAdjacentHTML(`beforeEnd`, ` <i class="fa fa-question-circle" title="Main data is the data that is needed by other sub-options. Because of that dependency, when deleting main data not all data may be deleted, but if you delete another sub-option first and then delete main data, all data that was required exclusively by that sub-option will be deleted."></i>`);
        }
        if (option.options) {
            options = insertHtml(menu, `beforeEnd`, `
                <div class="esgst-form-row-indent SMFeatures esgst-hidden"></div>
            `);
            for (i = 0, n = option.options.length; i < n; ++i) {
                m = getDataMenu(option.options[i], switches, type);
                options.appendChild(m);
                toggleSwitch.dependencies.push(m);
            }
            if (esgst.settings[`${type}_${option.key}`]) {
                options.classList.remove(`esgst-hidden`);
            }
        }
        toggleSwitch.onEnabled = function () {
            if (options) {
                options.classList.remove(`esgst-hidden`);
            }
        };
        toggleSwitch.onDisabled = function () {
            if (options) {
                options.classList.add(`esgst-hidden`);
            }
        }
        return menu;
    }

    function openSmallWindow(url) {
        open(url, `esgst`, `height=600,left=${(screen.width - 600) / 2},top=${(screen.height - 600) / 2},width=600`);
    }

    function loadImportFile(dm, dropbox, googleDrive, oneDrive, space, callback) {
        var file;
        if (dropbox) {
            delValue(`dropboxToken`).then(() => {
                openSmallWindow(`https://www.dropbox.com/oauth2/authorize?redirect_uri=https://${location.hostname}/esgst/dropbox&response_type=token&client_id=nix7kvchwa8wdvj`);
                checkDropboxComplete(null, dm, callback);
            });
        } else if (googleDrive) {
            delValue(`googleDriveToken`).then(() => {
                openSmallWindow(`https://accounts.google.com/o/oauth2/v2/auth?redirect_uri=https://${location.hostname}/esgst/google-drive&response_type=token&client_id=102804278399-95kit5e09mdskdta7eq97ra7tuj20qps.apps.googleusercontent.com&scope=https://www.googleapis.com/auth/drive.appdata`);
                checkGoogleDriveComplete(null, dm, callback);
            });
        } else if (oneDrive) {
            delValue(`oneDriveToken`).then(() => {
                openSmallWindow(`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?redirect_uri=https://www.steamgifts.com/esgst/onedrive&response_type=token&client_id=1781429b-289b-4e6e-877a-e50015c0af21&scope=files.readwrite`);
                checkOneDriveComplete(null, dm, callback);
            });
        } else {
            file = dm.input.files[0];
            if (file) {
                dm.reader = new FileReader();
                dm.reader.readAsText(file);
                dm.reader.onload = readImportFile.bind(null, dm, dropbox, googleDrive, oneDrive, space, callback);
            } else {
                createFadeMessage(dm.warning, `No file was loaded!`);
                callback();
            }
        }
    }

    function readImportFile(dm, dropbox, googleDrive, oneDrive, space, callback) {
        try {
            if (dm.reader) {
                dm.data = JSON.parse(dm.reader.result);
            }
            createConfirmation(`Are you sure you want to import the selected data?`, manageData.bind(null, dm, dropbox, googleDrive, oneDrive, space, callback), callback);
        } catch (error) {
            createFadeMessage(dm.warning, `Cannot parse file!`);
            callback();
        }
    }

    function confirmDataDeletion(dm, dropbox, googleDrive, oneDrive, space, callback) {
        createConfirmation(`Are you sure you want to delete the selected data?`, manageData.bind(null, dm, dropbox, googleDrive, oneDrive, space, callback), callback);
    }

    function convertBytes(bytes) {
        if (bytes < 1024) {
            return `${bytes} B`;
        } else {
            bytes /= 1024;
            if (bytes < 1024) {
                return `${Math.round(bytes * 100) / 100} KB`;
            } else {
                return `${Math.round(bytes / 1024 * 100) / 100} MB`;
            }
        }
    }

    function manageData(dm, dropbox, googleDrive, oneDrive, space, callback) {
        let check, data, numOptions, totalSize;
        data = {};
        totalSize = 0;
        numOptions = dm.options.length;
        check = new CompletionCheck(numOptions, () => {
            if (!dm.autoBackup) {
                dm.computerSpace.lastElementChild.textContent = convertBytes(totalSize);
            }
            if (!space) {
                if (dm.type === `export` || esgst.settings.exportBackup) {
                    if (dropbox || (dm.type !== `export` && esgst.settings.exportBackupIndex === 1)) {
                        delValue(`dropboxToken`).then(() => {
                            openSmallWindow(`https://www.dropbox.com/oauth2/authorize?redirect_uri=https://${location.hostname}/esgst/dropbox&response_type=token&client_id=nix7kvchwa8wdvj`);
                            checkDropboxComplete(data, dm, callback);
                        });
                    } else if (googleDrive || (dm.type !== `export` && esgst.settings.exportBackupIndex === 2)) {
                        delValue(`googleDriveToken`).then(() => {
                            openSmallWindow(`https://accounts.google.com/o/oauth2/v2/auth?redirect_uri=https://${location.hostname}/esgst/google-drive&response_type=token&client_id=102804278399-95kit5e09mdskdta7eq97ra7tuj20qps.apps.googleusercontent.com&scope=https://www.googleapis.com/auth/drive.appdata`);
                            checkGoogleDriveComplete(data, dm, callback);
                        });
                    } else if (oneDrive || (dm.type !== `export` && esgst.settings.exportBackupIndex === 3)) {
                        delValue(`oneDriveToken`).then(() => {
                            openSmallWindow(`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?redirect_uri=https://www.steamgifts.com/esgst/onedrive&response_type=token&client_id=1781429b-289b-4e6e-877a-e50015c0af21&scope=files.readwrite`);
                            checkOneDriveComplete(data, dm, callback);
                        });
                    } else {
                        data = new Blob([JSON.stringify(data)]);
                        url = URL.createObjectURL(data);
                        file = document.createElement(`a`);
                        file.download = `${prompt(`Enter the name of the file:`, `esgst_data_${new Date().toISOString().replace(/:/g, `_`)}`)}.json`;
                        file.href = url;
                        document.body.appendChild(file);
                        file.click();
                        file.remove();
                        URL.revokeObjectURL(url);
                        if (!dm.autoBackup) {
                            createFadeMessage(dm.message, `Data ${dm.type}ed with success!`);
                        }
                        callback();
                    }
                } else {
                    createFadeMessage(dm.message, `Data ${dm.type}ed with success!`);
                    callback();
                }
            }
        });
        for (let i = 0; i < numOptions; ++i) {
            let dataKey, deletedSub, found, foundSub, id, j, k, key, l, mainFound, mainUsernameFound, mergedData, mergedDataKey, mergedDataValue, newData, newDataKey, newDataValue, numMerged, numNew, numOld, numTags, oldData, oldDataKey, oldDataValue, option, optionKey, size, sizes, tag, tags, temp, toDelete, toExport, username, value, valueKey, values;
            option = dm.options[i];
            if (option.check) {
                optionKey = option.key;
                if (dm.autoBackup || space || esgst.settings[`${dm.type}_${optionKey}`]) {
                    values = null;
                    switch (optionKey) {
                        case `decryptedGiveaways`:
                        case `settings`:
                            getValue(optionKey, `{}`).then(val => {
                                data[optionKey] = JSON.parse(val);
                                new Promise((resolve, reject) => {
                                    if (space) {
                                        resolve();
                                    } else {
                                        if (dm.import) {
                                            newData = dm.data[optionKey];
                                            if (newData) {
                                                if (esgst.settings.importAndMerge) {
                                                    mergedData = data[optionKey];
                                                    for (newDataKey in newData) {
                                                        mergedData[newDataKey] = newData[newDataKey];
                                                    }
                                                    setValue(optionKey, JSON.stringify(mergedData)).then(resolve);
                                                } else {
                                                    setValue(optionKey, JSON.stringify(newData)).then(resolve);
                                                }
                                            } else {
                                                resolve();
                                            }
                                        } else if (dm.delete) {
                                            delValue(optionKey).then(resolve);
                                        } else {
                                            resolve();
                                        }
                                    }
                                }).then(() => {
                                    if (!dm.autoBackup) {
                                        getValue(optionKey, `{}`).then(val => {
                                            size = (new TextEncoder(`utf-8`).encode(`{"${optionKey}":${val}}`)).length;
                                            totalSize += size;
                                            dm.switches[optionKey].size.textContent = convertBytes(size);
                                        });
                                    }
                                    check.count += 1;
                                });
                            });
                            break;
                        case `discussions`:
                            if (!values) {
                                values = {
                                    main: [`lastUsed`],
                                    ct: [`count`, `readComments`],
                                    df: [`hidden`],
                                    dh: [`highlighted`],
                                    gdttt: [`visited`],
                                    pm: [`status`]
                                };
                            }
                        case `giveaways`:
                            if (!values) {
                                values = {
                                    main: [`code`, `comments`, `copies`, `creator`, `endTime`, `entries`, `gameId`, `gameName`, `gameSteamId`, `gameType`, `group`, `inviteOnly`, `lastUsed`, `level`, `points`, `regionRestricted`, `started`, `startTime`, `whitelist`, `winners`],
                                    ct: [`count`, `readComments`],
                                    gb: [`bookmarked`],
                                    gdttt: [`visited`],
                                    gf: [`hidden`],
                                    ggl: [`groups`]
                                };
                            }
                        case `tickets`:
                            if (!values) {
                                values = {
                                    main: [`lastUsed`],
                                    ct: [`count`, `readComments`],
                                    gdttt: [`visited`],
                                    ust: [`sent`]
                                };
                            }
                        case `trades`:
                            if (!values) {
                                values = {
                                    main: [`lastUsed`],
                                    ct: [`count`, `readComments`],
                                    gdttt: [`visited`]
                                };
                            }
                            new Promise((resolve, reject) => {
                                getValue(optionKey, `{}`).then(val => {
                                    mergedData = JSON.parse(val);
                                    data[optionKey] = {};
                                    sizes = {
                                        ct: 0,
                                        df: 0,
                                        dh: 0,
                                        gb: 0,
                                        gdttt: 0,
                                        gf: 0,
                                        ggl: 0,
                                        main: 0,
                                        pm: 0,
                                        total: 0,
                                        ust: 0
                                    };
                                    mainFound = false;
                                    for (mergedDataKey in mergedData) {
                                        newData = {};
                                        toDelete = 0;
                                        foundSub = 0;
                                        deletedSub = 0;
                                        found = null;
                                        toExport = false;
                                        for (value in values) {
                                            if (esgst.settings[`${dm.type}_${optionKey}_${value}`]) {
                                                toDelete += 1;
                                            }
                                            for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                valueKey = values[value][j];
                                                mergedDataValue = mergedData[mergedDataKey][valueKey];
                                                if (typeof mergedDataValue !== `undefined`) {
                                                    if (value !== `main`) {
                                                        foundSub += 1;
                                                    }
                                                    if (esgst.settings[`${dm.type}_${optionKey}_${value}`] || value === `main`) {
                                                        newData[valueKey] = mergedDataValue;
                                                        if (value !== `main`) {
                                                            toExport = true;
                                                        }
                                                    }
                                                    size = (new TextEncoder(`utf-8`).encode(`"${valueKey}":${JSON.stringify(mergedDataValue)},`)).length;
                                                    sizes[value] += size;
                                                    sizes.total += size;
                                                    found = value;
                                                    if (!space && dm.delete && esgst.settings[`${dm.type}_${optionKey}_${value}`] && value !== `main`) {
                                                        deletedSub += 1;
                                                        delete mergedData[mergedDataKey][valueKey];
                                                    }
                                                }
                                            }
                                        }
                                        if (found) {
                                            sizes[found] -= 1;
                                            sizes.total -= 1;
                                        }
                                        if (toExport || esgst.settings[`${dm.type}_${optionKey}_main`]) {
                                            data[optionKey][mergedDataKey] = newData;
                                            mainFound = true;
                                        }
                                        size = (new TextEncoder(`utf-8`).encode(`"${mergedDataKey}":{},`)).length;
                                        sizes.main += size;
                                        sizes.total += size;
                                        if (!space && dm.delete && ((esgst.settings[`${dm.type}_${optionKey}_main`] && foundSub === deletedSub) || toDelete === Object.keys(values).length)) {
                                            delete mergedData[mergedDataKey];
                                        }
                                    }
                                    if (space) {
                                        resolve();
                                    } else {
                                        if (dm.import) {
                                            newData = dm.data[optionKey];
                                            if (newData) {
                                                for (newDataKey in newData) {
                                                    if (!mergedData[newDataKey]) {
                                                        mergedData[newDataKey] = {};
                                                    }
                                                    for (value in values) {
                                                        if (esgst.settings[`${dm.type}_${optionKey}_${value}`]) {
                                                            if (esgst.settings.importAndMerge) {
                                                                for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                                    valueKey = values[value][j];
                                                                    if (valueKey === `readComments`) {
                                                                        if (mergedData[newDataKey].readComments) {
                                                                            for (id in mergedData[newDataKey].readComments) {
                                                                                if (newData[newDataKey].readComments[id] > mergedData[newDataKey].readComments[id]) {
                                                                                    mergedData[newDataKey].readComments[id] = newData[newDataKey].readComments[id];
                                                                                }
                                                                            }
                                                                        } else {
                                                                            mergedData[newDataKey].readComments = newData[newDataKey].readComments;
                                                                        }
                                                                    } else {
                                                                        mergedData[newDataKey][valueKey] = newData[newDataKey][valueKey];
                                                                    }
                                                                }
                                                            } else {
                                                                for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                                    valueKey = values[value][j];
                                                                    mergedData[newDataKey][valueKey] = newData[newDataKey][valueKey];
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                setValue(optionKey, JSON.stringify(mergedData)).then(resolve);
                                            } else {
                                                resolve();
                                            }
                                        } else if (dm.delete) {
                                            setValue(optionKey, JSON.stringify(mergedData)).then(resolve);
                                        } else {
                                            resolve();
                                        }
                                    }
                                });
                            }).then(() => {
                                if (mainFound) {
                                    sizes.main -= 1;
                                    sizes.total -= 1;
                                }
                                if (!dm.autoBackup) {
                                    size = (new TextEncoder(`utf-8`).encode(`{"${optionKey}":{}}`)).length;
                                    sizes.main += size;
                                    sizes.total += size;
                                    for (value in values) {
                                        if (dm.switches[`${optionKey}_${value}`]) {
                                            dm.switches[`${optionKey}_${value}`].size.textContent = convertBytes(sizes[value]);
                                        }
                                    }
                                    dm.switches[optionKey].size.textContent = convertBytes(sizes.total);
                                    totalSize += sizes.total;
                                }
                                check.count += 1;
                            });
                            break;
                        case `emojis`:
                            new Promise((resolve, reject) => {
                                getValue(`emojis`, ``).then(val => {
                                    data.emojis = val;
                                    if (space) {
                                        resolve();
                                    } else {
                                        if (dm.import) {
                                            newData = dm.data.emojis;
                                            if (newData) {
                                                if (esgst.settings.importAndMerge) {
                                                    mergedData = data.emojis;
                                                    newData = parseHtml(newData).getElementsByTagName(`span`);
                                                    for (j = 0, numNew = newData.length; j < numNew; ++j) {
                                                        newDataValue = newData[j].outerHTML;
                                                        if (!mergedData.match(newDataValue)) {
                                                            mergedData = `${mergedData}${newDataValue}`;
                                                        }
                                                    }
                                                    setValue(`emojis`, mergedData).then(resolve);
                                                } else {
                                                    setValue(`emojis`, newData).then(resolve);
                                                }
                                            } else {
                                                resolve();
                                            }
                                        } else if (dm.delete) {
                                            delValue(`emojis`).then(resolve);
                                        } else {
                                            resolve();
                                        }
                                    }
                                });
                            }).then(() => {
                                if (!dm.autoBackup) {
                                    getValue(optionKey, `""`).then(val => {
                                        size = (new TextEncoder(`utf-8`).encode(`{"${optionKey}":${val}}`)).length;
                                        totalSize += size;
                                        dm.switches[optionKey].size.textContent = convertBytes(size);
                                    });
                                }
                                check.count += 1;
                            });
                            break;
                        case `dfPresets`:
                        case `entries`:
                        case `filterPresets`:
                        case `templates`:
                        case `savedReplies`:
                            new Promise((resolve, reject) => {
                                getValue(optionKey, `[]`).then(val => {
                                    data[optionKey] = JSON.parse(val);
                                    if (space) {
                                        resolve();
                                    } else {
                                        if (dm.import) {
                                            newData = dm.data[optionKey];
                                            if (newData) {
                                                if (esgst.settings.importAndMerge) {
                                                    dataKey = optionKey === `entries` ? `timestamp` : `name`;
                                                    mergedData = data[optionKey];
                                                    for (j = 0, numNew = newData.length; j < numNew; ++j) {
                                                        newDataValue = newData[j];
                                                        for (k = 0, numMerged = mergedData.length; k < numMerged && mergedData[k][dataKey] !== newDataValue[dataKey]; ++k);
                                                        if (k < numMerged) {
                                                            mergedData[k] = newDataValue;
                                                        } else {
                                                            mergedData.push(newDataValue);
                                                        }
                                                    }
                                                    if (optionKey === `entries`) {
                                                        mergedData = sortArrayByNumberKey(mergedData, `timestamp`);
                                                    }
                                                    setValue(optionKey, JSON.stringify(mergedData)).then(resolve);
                                                } else {
                                                    setValue(optionKey, JSON.stringify(newData)).then(resolve);
                                                }
                                            } else {
                                                resolve();
                                            }
                                        } else if (dm.delete) {
                                            delValue(optionKey).then(resolve);
                                        } else {
                                            resolve();
                                        }
                                    }
                                });
                            }).then(() => {
                                if (!dm.autoBackup) {
                                    getValue(optionKey, `[]`).then(val => {
                                        size = (new TextEncoder(`utf-8`).encode(`{"${optionKey}":${val}}`)).length;
                                        totalSize += size;
                                        dm.switches[optionKey].size.textContent = convertBytes(size);
                                    });
                                }
                                check.count += 1;
                            });
                            break;
                        case `games`:
                            values = {
                                main: [`reducedCV`, `noCV`, `hidden`, `ignored`, `owned`, `wishlisted`],
                                gt: [`tags`],
                                egh: [`entered`],
                                itadi: [`itadi`]
                            };
                            data.games = {
                                apps: {},
                                subs: {}
                            };
                            new Promise((resolve, reject) => {
                                getValue(`games`, `{"apps":{},"subs":{}}`).then(val => {
                                    mergedData = JSON.parse(val);
                                    sizes = {
                                        egh: 0,
                                        gt: 0,
                                        itadi: 0,
                                        main: 0,
                                        total: 0
                                    };
                                    mainFound = false;
                                    for (mergedDataKey in mergedData.apps) {
                                        mergedDataValue = mergedData.apps[mergedDataKey];
                                        newData = {};
                                        toDelete = 0;
                                        foundSub = 0;
                                        deletedSub = 0;
                                        found = null;
                                        toExport = false;
                                        for (value in values) {
                                            if (esgst.settings[`${dm.type}_games_${value}`]) {
                                                toDelete += 1;
                                            }
                                            for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                valueKey = values[value][j];
                                                newDataValue = mergedDataValue[valueKey];
                                                if (typeof newDataValue !== `undefined`) {
                                                    if (value !== `main`) {
                                                        foundSub += 1;
                                                    }
                                                    if (esgst.settings[`${dm.type}_games_${value}`] || value === `main`) {
                                                        newData[valueKey] = newDataValue;
                                                        if (value !== `main`) {
                                                            toExport = true;
                                                        }
                                                    }
                                                    size = (new TextEncoder(`utf-8`).encode(`"${valueKey}":${JSON.stringify(newDataValue)},`)).length;
                                                    sizes[value] += size;
                                                    sizes.total += size;
                                                    found = value;
                                                    if (!space && dm.delete && esgst.settings[`${dm.type}_games_${value}`] && value !== `main`) {
                                                        deletedSub += 1;
                                                        delete mergedDataValue[valueKey];
                                                    }
                                                }
                                            }
                                        }
                                        if (found) {
                                            sizes[found] -= 1;
                                            sizes.total -= 1;
                                        }
                                        if (toExport || esgst.settings[`${dm.type}_${optionKey}_main`]) {
                                            data.games.apps[mergedDataKey] = newData;
                                            mainFound = true;
                                        }
                                        size = (new TextEncoder(`utf-8`).encode(`"${mergedDataKey}":{},`)).length;
                                        sizes.main += size;
                                        sizes.total += size;
                                        if (!space && dm.delete && ((esgst.settings[`${dm.type}_${optionKey}_main`] && foundSub === deletedSub) || toDelete === Object.keys(values).length)) {
                                            delete mergedData.apps[mergedDataKey];
                                        }
                                    }
                                    if (mainFound) {
                                        sizes.main -= 1;
                                        sizes.total -= 1;
                                    }
                                    mainFound = false;
                                    for (mergedDataKey in mergedData.subs) {
                                        mergedDataValue = mergedData.subs[mergedDataKey];
                                        newData = {};
                                        toDelete = 0;
                                        foundSub = 0;
                                        deletedSub = 0;
                                        found = null;
                                        toExport = false;
                                        for (value in values) {
                                            if (esgst.settings[`${dm.type}_games_${value}`]) {
                                                toDelete += 1;
                                            }
                                            for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                valueKey = values[value][j];
                                                newDataValue = mergedDataValue[valueKey];
                                                if (typeof newDataValue !== `undefined`) {
                                                    if (value !== `main`) {
                                                        foundSub += 1;
                                                    }
                                                    if (esgst.settings[`${dm.type}_games_${value}`] || value === `main`) {
                                                        newData[valueKey] = newDataValue;
                                                        if (value !== `main`) {
                                                            toExport = true;
                                                        }
                                                    }
                                                    size = (new TextEncoder(`utf-8`).encode(`"${valueKey}":${JSON.stringify(newDataValue)},`)).length;
                                                    sizes[value] += size;
                                                    sizes.total += size;
                                                    found = value;
                                                    if (!space && dm.delete && esgst.settings[`${dm.type}_games_${value}`] && value !== `main`) {
                                                        deletedSub += 1;
                                                        delete mergedDataValue[valueKey];
                                                    }
                                                }
                                            }
                                        }
                                        if (found) {
                                            sizes[found] -= 1;
                                            sizes.total -= 1;
                                        }
                                        if (toExport || esgst.settings[`${dm.type}_${optionKey}_main`]) {
                                            data.games.subs[mergedDataKey] = newData;
                                            mainFound = true;
                                        }
                                        size = (new TextEncoder(`utf-8`).encode(`"${mergedDataKey}":{},`)).length;
                                        sizes.main += size;
                                        sizes.total += size;
                                        if (!space && dm.delete && ((esgst.settings[`${dm.type}_${optionKey}_main`] && foundSub === deletedSub) || toDelete === Object.keys(values).length)) {
                                            delete mergedData.subs[mergedDataKey];
                                        }
                                    }
                                    if (mainFound) {
                                        sizes.main -= 1;
                                        sizes.total -= 1;
                                    }
                                    if (space) {
                                        resolve();
                                    } else {
                                        if (dm.import) {
                                            newData = dm.data.games;
                                            if (newData) {
                                                for (newDataKey in newData.apps) {
                                                    newDataValue = newData.apps[newDataKey];
                                                    if (!mergedData.apps[newDataKey]) {
                                                        mergedData.apps[newDataKey] = {};
                                                    }
                                                    mergedDataValue = mergedData.apps[newDataKey];
                                                    for (value in values) {
                                                        if (esgst.settings[`${dm.type}_games_${value}`]) {
                                                            for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                                valueKey = values[value][j];
                                                                if (typeof newDataValue[valueKey] !== `undefined`) {
                                                                    if (esgst.settings.importAndMerge) {
                                                                        switch (valueKey) {
                                                                            case `entered`:
                                                                                mergedDataValue.entered = true;
                                                                                break;
                                                                            case `itadi`:
                                                                                if (mergedDataValue.itadi) {
                                                                                    if (newDataValue.itadi.lastCheck > mergedDataValue.itadi.lastCheck) {
                                                                                        mergedDataValue.itadi = newDataValue.itadi;
                                                                                    }
                                                                                } else {
                                                                                    mergedDataValue.itadi = newDataValue.itadi;
                                                                                }
                                                                                break;
                                                                            case `tags`:
                                                                                if (mergedDataValue.tags) {
                                                                                    tags = newDataValue.tags;
                                                                                    for (k = 0, numTags = tags.length; k < numTags; ++k) {
                                                                                        tag = tags[k];
                                                                                        if (mergedDataValue.tags.indexOf(tag) < 0) {
                                                                                            mergedDataValue.tags.push(tag);
                                                                                        }
                                                                                    }
                                                                                } else {
                                                                                    mergedDataValue.tags = newDataValue.tags;
                                                                                }
                                                                                break;
                                                                            default:
                                                                                mergedDataValue[valueKey] = newDataValue[valueKey];
                                                                                break;
                                                                        }
                                                                    } else {
                                                                        mergedDataValue[valueKey] = newDataValue[valueKey];
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                for (newDataKey in newData.subs) {
                                                    newDataValue = newData.subs[newDataKey];
                                                    if (!mergedData.subs[newDataKey]) {
                                                        mergedData.subs[newDataKey] = {};
                                                    }
                                                    mergedDataValue = mergedData.subs[newDataKey];
                                                    for (value in values) {
                                                        if (esgst.settings[`${dm.type}_games_${value}`]) {
                                                            for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                                valueKey = values[value][j];
                                                                if (typeof newDataValue[valueKey] !== `undefined`) {
                                                                    if (esgst.settings.importAndMerge) {
                                                                        switch (valueKey) {
                                                                            case `entered`:
                                                                                mergedDataValue.entered = true;
                                                                                break;
                                                                            case `itadi`:
                                                                                if (mergedDataValue.itadi) {
                                                                                    if (newDataValue.itadi.lastCheck > mergedDataValue.itadi.lastCheck) {
                                                                                        mergedDataValue.itadi = newDataValue.itadi;
                                                                                    }
                                                                                } else {
                                                                                    mergedDataValue.itadi = newDataValue.itadi;
                                                                                }
                                                                                break;
                                                                            case `tags`:
                                                                                if (mergedDataValue.tags) {
                                                                                    tags = newDataValue.tags;
                                                                                    for (k = 0, numTags = tags.length; k < numTags; ++k) {
                                                                                        tag = tags[k];
                                                                                        if (mergedDataValue.tags.indexOf(tag) < 0) {
                                                                                            mergedDataValue.tags.push(tag);
                                                                                        }
                                                                                    }
                                                                                } else {
                                                                                    mergedDataValue.tags = newDataValue.tags;
                                                                                }
                                                                                break;
                                                                            default:
                                                                                mergedDataValue[valueKey] = newDataValue[valueKey];
                                                                                break;
                                                                        }
                                                                    } else {
                                                                        mergedDataValue[valueKey] = newDataValue[valueKey];
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                setValue(`games`, JSON.stringify(mergedData)).then(resolve);
                                            } else {
                                                resolve();
                                            }
                                        } else if (dm.delete) {
                                            setValue(`games`, JSON.stringify(mergedData)).then(resolve);
                                        } else {
                                            resolve();
                                        }
                                    }
                                });
                            }).then(() => {
                                if (!dm.autoBackup) {
                                    size = (new TextEncoder(`utf-8`).encode(`{"${optionKey}":{"apps":{},"subs":{}}}`)).length;
                                    sizes.main += size;
                                    sizes.total += size;
                                    for (value in values) {
                                        if (dm.switches[`${optionKey}_${value}`]) {
                                            dm.switches[`${optionKey}_${value}`].size.textContent = convertBytes(sizes[value]);
                                        }
                                    }
                                    dm.switches[optionKey].size.textContent = convertBytes(sizes.total);
                                    totalSize += sizes.total;
                                }
                                check.count += 1;
                            });
                            break;
                        case `groups`:
                            values = {
                                main: [`avatar`, `code`, `member`, `name`],
                                sgg: [`stickied`]
                            };
                            new Promise((resolve, reject) => {
                                getValue(optionKey, `[]`).then(val => {
                                    mergedData = JSON.parse(val);
                                    if (!Array.isArray(mergedData)) {
                                        temp = [];
                                        for (key in mergedData) {
                                            temp.push(mergedData[key]);
                                        }
                                        mergedData = temp;
                                    }
                                    data[optionKey] = [];
                                    sizes = {
                                        main: 0,
                                        sgg: 0,
                                        total: 0
                                    };
                                    mainFound = false;
                                    for (j = mergedData.length - 1; j > -1; --j) {
                                        newData = {};
                                        toDelete = 0;
                                        foundSub = 0;
                                        deletedSub = 0;
                                        found = null;
                                        toExport = false;
                                        for (value in values) {
                                            if (esgst.settings[`${dm.type}_${optionKey}_${value}`]) {
                                                toDelete += 1;
                                            }
                                            for (k = 0, numValues = values[value].length; k < numValues; ++k) {
                                                valueKey = values[value][k];
                                                if (mergedData[j]) {
                                                    mergedDataValue = mergedData[j][valueKey];
                                                    if (typeof mergedDataValue !== `undefined`) {
                                                        if (value !== `main`) {
                                                            foundSub += 1;
                                                        }
                                                        if (esgst.settings[`${dm.type}_${optionKey}_${value}`] || value === `main`) {
                                                            newData[valueKey] = mergedDataValue;
                                                            if (value !== `main`) {
                                                                toExport = true;
                                                            }
                                                        }
                                                        size = (new TextEncoder(`utf-8`).encode(`"${valueKey}":${JSON.stringify(mergedDataValue)},`)).length;
                                                        sizes[value] += size;
                                                        sizes.total += size;
                                                        found = value;
                                                        if (!space && dm.delete && esgst.settings[`${dm.type}_${optionKey}_${value}`] && value !== `main`) {
                                                            deletedSub += 1;
                                                            delete mergedData[j][valueKey];
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        if (found) {
                                            sizes[found] -= 1;
                                            sizes.total -= 1;
                                        }
                                        if (toExport || esgst.settings[`${dm.type}_${optionKey}_main`]) {
                                            data[optionKey].push(newData);
                                            mainFound = true;
                                        }
                                        size = (new TextEncoder(`utf-8`).encode(`{},`)).length;
                                        sizes.main += size;
                                        sizes.total += size;
                                        if (!space && dm.delete && ((esgst.settings[`${dm.type}_${optionKey}_main`] && foundSub === deletedSub) || toDelete === Object.keys(values).length)) {
                                            mergedData.pop();
                                        }
                                    }
                                    if (mainFound) {
                                        sizes.main -= 1;
                                        sizes.total -= 1;
                                    }
                                    if (space) {
                                        resolve();
                                    } else {
                                        if (dm.import) {
                                            newData = dm.data[optionKey];
                                            if (!Array.isArray(newData)) {
                                                let key, temp = [];
                                                for (key in newData) {
                                                    temp.push(newData[key]);
                                                }
                                                newData = temp;
                                            }
                                            if (newData) {
                                                for (j = newData.length - 1; j > -1; --j) {
                                                    let code = newData[j].code;
                                                    for (k = mergedData.length - 1; k > -1 && mergedData[k].code !== code; --k);
                                                    if (k > -1) {
                                                        mergedDataValue = mergedData[k];
                                                    } else {
                                                        mergedDataValue = {};
                                                        mergedData.push(mergedDataValue);
                                                    }
                                                    for (value in values) {
                                                        if (esgst.settings[`${dm.type}_${optionKey}_${value}`]) {
                                                            for (k = 0, numValues = values[value].length; k < numValues; ++k) {
                                                                valueKey = values[value][k];
                                                                mergedDataValue[valueKey] = newData[j][valueKey];
                                                            }
                                                        }
                                                    }
                                                }
                                                setValue(optionKey, JSON.stringify(mergedData)).then(resolve);
                                            } else {
                                                resolve();
                                            }
                                        } else if (dm.delete) {
                                            setValue(optionKey, JSON.stringify(mergedData)).then(resolve);
                                        } else {
                                            resolve();
                                        }
                                    }
                                });
                            }).then(() => {
                                if (!dm.autoBackup) {
                                    size = (new TextEncoder(`utf-8`).encode(`{"${optionKey}":[]}`)).length;
                                    sizes.main += size;
                                    sizes.total += size;
                                    for (value in values) {
                                        if (dm.switches[`${optionKey}_${value}`]) {
                                            dm.switches[`${optionKey}_${value}`].size.textContent = convertBytes(sizes[value]);
                                        }
                                    }
                                    dm.switches[optionKey].size.textContent = convertBytes(sizes.total);
                                    totalSize += sizes.total;
                                }
                                check.count += 1;
                            });
                            break;
                        case `rerolls`:
                        case `stickiedCountries`:
                            new Promise((resolve, reject) => {
                                getValue(optionKey, `[]`).then(val => {
                                    data[optionKey] = JSON.parse(val);
                                    if (space) {
                                        resolve();
                                    } else {
                                        if (dm.import) {
                                            newData = dm.data[optionKey];
                                            if (newData) {
                                                if (esgst.settings.importAndMerge) {
                                                    mergedData = data[optionKey];
                                                    for (j = 0, numNew = newData.length; j < numNew; ++j) {
                                                        newDataValue = newData[j];
                                                        if (mergedData.indexOf(newDataValue) < 0) {
                                                            mergedData.push(newDataValue);
                                                        }
                                                    }
                                                    setValue(optionKey, JSON.stringify(mergedData)).then(resolve);
                                                } else {
                                                    setValue(optionKey, JSON.stringify(newData)).then(resolve);
                                                }
                                            } else {
                                                resolve();
                                            }
                                        } else if (dm.delete) {
                                            delValue(optionKey).then(resolve);
                                        } else {
                                            resolve();
                                        }
                                    }
                                });
                            }).then(() => {
                                if (!dm.autoBackup) {
                                    getValue(optionKey, `[]`).then(val => {
                                        size = (new TextEncoder(`utf-8`).encode(`{"${optionKey}":${val}}`)).length;
                                        totalSize += size;
                                        dm.switches[optionKey].size.textContent = convertBytes(size);
                                    });
                                }
                                check.count += 1;
                            });
                            break;
                        case `sgCommentHistory`:
                        case `stCommentHistory`:
                            new Promise((resolve, reject) => {
                                getValue(optionKey, `[]`).then(val => {
                                    data[optionKey] = JSON.parse(val);
                                    if (space) {
                                        resolve();
                                    } else {
                                        if (dm.import) {
                                            newData = dm.data[optionKey];
                                            if (newData) {
                                                if (esgst.settings.importAndMerge) {
                                                    mergedData = [];
                                                    oldData = data[optionKey];
                                                    j = 0;
                                                    k = 0;
                                                    numNew = newData.length;
                                                    numOld = oldData.length;
                                                    while (j < numOld && k < numNew) {
                                                        oldDataValue = oldData[j];
                                                        newDataValue = newData[k];
                                                        if (oldDataValue.timestamp > newDataValue.timestamp) {
                                                            mergedData.push(oldDataValue);
                                                            ++j;
                                                        } else {
                                                            for (l = 0; l < numOld && oldData[l].id !== newDataValue.id; ++l);
                                                            if (l >= numOld) {
                                                                mergedData.push(newDataValue);
                                                            }
                                                            ++k;
                                                        }
                                                    }
                                                    while (j < numOld) {
                                                        mergedData.push(oldData[j]);
                                                        ++j;
                                                    }
                                                    while (k < numNew) {
                                                        newDataValue = newData[k];
                                                        for (l = 0; l < numOld && oldData[l].id !== newDataValue.id; ++l);
                                                        if (l >= numOld) {
                                                            mergedData.push(newDataValue);
                                                        }
                                                        ++k;
                                                    }
                                                    setValue(optionKey, JSON.stringify(mergedData)).then(resolve);
                                                } else {
                                                    setValue(optionKey, JSON.stringify(newData)).then(resolve);
                                                }
                                            } else {
                                                resolve();
                                            }
                                        } else if (dm.delete) {
                                            delValue(optionKey).then(resolve);
                                        } else {
                                            resolve();
                                        }
                                    }
                                });
                            }).then(() => {
                                if (!dm.autoBackup) {
                                    getValue(optionKey, `[]`).then(val => {
                                        size = (new TextEncoder(`utf-8`).encode(`{"${optionKey}":${val}}`)).length;
                                        totalSize += size;
                                        dm.switches[optionKey].size.textContent = convertBytes(size);
                                    });
                                }
                                check.count += 1;
                            });
                            break;
                        case `users`:
                            values = {
                                main: [`whitelisted`, `whitelistedDate`, `blacklisted`, `blacklistedDate`],
                                giveaways: [`giveaways`],
                                namwc: [`namwc`],
                                notes: [`notes`],
                                nrf: [`nrf`],
                                tags: [`tags`],
                                uf: [`uf`],
                                wbc: [`wbc`]
                            };
                            data.users = {
                                steamIds: {},
                                users: {}
                            };
                            new Promise((resolve, reject) => {
                                getValue(`users`, `{"steamIds":{},"users":{}}`).then(val => {
                                    mergedData = JSON.parse(val);
                                    sizes = {
                                        giveaways: 0,
                                        namwc: 0,
                                        notes: 0,
                                        nrf: 0,
                                        main: 0,
                                        tags: 0,
                                        total: 0,
                                        uf: 0,
                                        wbc: 0
                                    };
                                    mainFound = false;
                                    mainUsernameFound = false;
                                    for (mergedDataKey in mergedData.users) {
                                        mergedDataValue = mergedData.users[mergedDataKey];
                                        newData = {};
                                        toDelete = 0;
                                        foundSub = 0;
                                        deletedSub = 0;
                                        found = null;
                                        toExport = false;
                                        for (value in values) {
                                            if (esgst.settings[`${dm.type}_users_${value}`]) {
                                                toDelete += 1;
                                            }
                                            for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                valueKey = values[value][j];
                                                if (typeof mergedDataValue[valueKey] !== `undefined`) {
                                                    if (value !== `main`) {
                                                        foundSub += 1;
                                                    }
                                                    if (esgst.settings[`${dm.type}_users_${value}`] || value === `main`) {
                                                        newData[valueKey] = mergedDataValue[valueKey];
                                                        if (value !== `main`) {
                                                            toExport = true;
                                                        }
                                                    }
                                                    size = (new TextEncoder(`utf-8`).encode(`"${valueKey}":${JSON.stringify(mergedDataValue[valueKey])},`)).length;
                                                    sizes[value] += size;
                                                    sizes.total += size;
                                                    found = value;
                                                    if (!space && dm.delete && esgst.settings[`${dm.type}_users_${value}`] && value !== `main`) {
                                                        deletedSub += 1;
                                                        delete mergedDataValue[valueKey];
                                                    }
                                                }
                                            }
                                        }
                                        if (found) {
                                            sizes[found] -= 1;
                                            sizes.total -= 1;
                                        }
                                        id = mergedDataValue.id;
                                        username = mergedDataValue.username;
                                        size = 0;
                                        if (id) {
                                            size += (new TextEncoder(`utf-8`).encode(`"id":"${id}",`)).length;
                                        }
                                        if (username) {
                                            size += (new TextEncoder(`utf-8`).encode(`"username":"${username}","${username}":"${mergedDataKey}",`)).length;
                                        }
                                        if (toExport || esgst.settings[`${dm.type}_${optionKey}_main`]) {
                                            if (id) {
                                                newData.id = id;
                                            }
                                            if (username) {
                                                newData.username = username;
                                                data.users.steamIds[username] = mergedDataKey;
                                                mainUsernameFound = true;
                                            }
                                            data.users.users[mergedDataKey] = newData;
                                            mainFound = true;
                                        }
                                        size += (new TextEncoder(`utf-8`).encode(`"${mergedDataKey}":{},`)).length;
                                        sizes.main += size;
                                        sizes.total += size;
                                        if (!space && dm.delete && ((esgst.settings[`${dm.type}_${optionKey}_main`] && foundSub === deletedSub) || toDelete === Object.keys(values).length)) {
                                            delete mergedData.steamIds[mergedDataValue.username];
                                            delete mergedData.users[mergedDataKey];
                                        }
                                    }
                                    if (mainFound) {
                                        sizes.main -= 1;
                                        sizes.total -= 1;
                                    }
                                    if (mainUsernameFound) {
                                        sizes.main -= 1;
                                        sizes.total -= 1;
                                    }
                                    if (space) {
                                        resolve();
                                    } else {
                                        if (dm.import) {
                                            newData = dm.data.users;
                                            if (newData) {
                                                for (newDataKey in newData.users) {
                                                    newDataValue = newData.users[newDataKey];
                                                    if (!mergedData.users[newDataKey]) {
                                                        mergedData.users[newDataKey] = {
                                                            id: newDataValue.id,
                                                            username: newDataValue.username
                                                        };
                                                        mergedData.steamIds[newDataValue.username] = newDataKey;
                                                    }
                                                    mergedDataValue = mergedData.users[newDataKey];
                                                    for (value in values) {
                                                        if (esgst.settings[`${dm.type}_users_${value}`]) {
                                                            for (j = 0, numValues = values[value].length; j < numValues; ++j) {
                                                                valueKey = values[value][j];
                                                                if (newDataValue[valueKey]) {
                                                                    if (esgst.settings.importAndMerge) {
                                                                        switch (valueKey) {
                                                                            case `whitelisted`:
                                                                            case `whitelistedDate`:
                                                                            case `blacklisted`:
                                                                            case `blacklistedDate`:
                                                                                mergedDataValue[valueKey] = newDataValue[valueKey];
                                                                                break;
                                                                            case `notes`:
                                                                                mergedDataValue.notes = mergedDataValue.notes ? `${mergedDataValue.notes}\n\n${newDataValue.notes}` : newDataValue.notes;
                                                                                break;
                                                                            case `tags`:
                                                                                if (mergedDataValue.tags) {
                                                                                    tags = newDataValue.tags;
                                                                                    for (k = 0, numTags = tags.length; k < numTags; ++k) {
                                                                                        tag = tags[k];
                                                                                        if (mergedDataValue.tags.indexOf(tag) < 0) {
                                                                                            mergedDataValue.tags.push(tag);
                                                                                        }
                                                                                    }
                                                                                } else {
                                                                                    mergedDataValue.tags = newDataValue.tags;
                                                                                }
                                                                                break;
                                                                            case `giveaways`:
                                                                                if (mergedDataValue.giveaways) {
                                                                                    if (newDataValue.giveaways.wonTimestamp > mergedDataValue.giveaways.wonTimestamp) {
                                                                                        mergedDataValue.giveaways.won = newDataValue.giveaways.won;
                                                                                        mergedDataValue.giveaways.wonTimestamp = newDataValue.giveaways.wonTimestamp;
                                                                                    }
                                                                                    if (newDataValue.giveaways.sentTimestamp > mergedDataValue.giveaways.sentTimestamp) {
                                                                                        mergedDataValue.giveaways.sent = newDataValue.giveaways.sent;
                                                                                        mergedDataValue.giveaways.sentTimestamp = newDataValue.giveaways.sentTimestamp;
                                                                                    }
                                                                                } else {
                                                                                    mergedDataValue.giveaways = newDataValue.giveaways;
                                                                                }
                                                                                break;
                                                                            default:
                                                                                if (mergedDataValue[valueKey]) {
                                                                                    if (newDataValue[valueKey].lastCheck > mergedDataValue[valueKey].lastCheck) {
                                                                                        mergedDataValue[valueKey] = newDataValue[valueKey];
                                                                                    }
                                                                                } else {
                                                                                    mergedDataValue[valueKey] = newDataValue[valueKey];
                                                                                }
                                                                                break;
                                                                        }
                                                                    } else {
                                                                        mergedDataValue[valueKey] = newDataValue[valueKey];
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                setValue(`users`, JSON.stringify(mergedData)).then(resolve);
                                            } else {
                                                resolve();
                                            }
                                        } else if (dm.delete) {
                                            setValue(`users`, JSON.stringify(mergedData)).then(resolve);
                                        } else {
                                            resolve();
                                        }
                                    }
                                });
                            }).then(() => {
                                if (!dm.autoBackup) {
                                    size = (new TextEncoder(`utf-8`).encode(`{"${optionKey}":{"steamIds":{},"users":{}}}`)).length;
                                    sizes.main += size;
                                    sizes.total += size;
                                    for (value in values) {
                                        if (dm.switches[`${optionKey}_${value}`]) {
                                            dm.switches[`${optionKey}_${value}`].size.textContent = convertBytes(sizes[value]);
                                        }
                                    }
                                    dm.switches[optionKey].size.textContent = convertBytes(sizes.total);
                                    totalSize += sizes.total;
                                }
                                check.count += 1;
                            });
                            break;
                        case `winners`:
                            new Promise((resolve, reject) => {
                                getValue(`winners`, `{}`).then(val => {
                                    data.winners = JSON.parse(val);
                                    if (space) {
                                        resolve();
                                    } else {
                                        if (dm.import) {
                                            newData = dm.data.winners;
                                            if (newData) {
                                                if (esgst.settings.importAndMerge) {
                                                    mergedData = data.winners;
                                                    for (newDataKey in newData) {
                                                        if (!mergedData[newDataKey]) {
                                                            mergedData[newDataKey] = [];
                                                        }
                                                        for (j = 0, numNew = newData[newDataKey].length; j < numNew; ++j) {
                                                            newDataValue = newData[newDataKey][j];
                                                            if (mergedData[newDataKey].indexOf(newDataValue) < 0) {
                                                                mergedData[newDataKey].push(newDataValue);
                                                            }
                                                        }
                                                    }
                                                    setValue(`winners`, JSON.stringify(mergedData)).then(resolve);
                                                } else {
                                                    setValue(`winners`, JSON.stringify(newData)).then(resolve);
                                                }
                                            } else {
                                                resolve();
                                            }
                                        } else if (dm.delete) {
                                            delValue(`winners`).then(resolve);
                                        } else {
                                            resolve();
                                        }
                                    }
                                });
                            }).then(() => {
                                if (!dm.autoBackup) {
                                    getValue(optionKey, `{}`).then(val => {
                                        size = (new TextEncoder(`utf-8`).encode(`{"${optionKey}":${val}}`)).length;
                                        totalSize += size;
                                        dm.switches[optionKey].size.textContent = convertBytes(size);
                                    });
                                }
                                check.count += 1;
                            });
                            break;
                        default:
                            break;
                    }
                } else {
                    check.count += 1;
                }
            } else {
                check.count += 1;
            }
        }
    }

    function exportSettings() {
        let data, url;
        getValue(`settings`, `{}`).then(value => {
            data = {
                settings: JSON.parse(value)
            };
            delete data.settings.avatar;
            delete data.settings.lastSync;
            delete data.settings.steamApiKey;
            delete data.settings.steamId;
            delete data.settings.syncFrequency;
            delete data.settings.username;
            data = new Blob([JSON.stringify(data)]);
            url = URL.createObjectURL(data);
            file = document.createElement(`a`);
            file.download = `${prompt(`Enter the name of the file:`, `esgst_settings_${new Date().toISOString().replace(/:/g, `_`)}`)}.json`;
            file.href = url;
            document.body.appendChild(file);
            file.click();
            file.remove();
            URL.revokeObjectURL(url);
        });
    }

    function checkDropboxComplete(data, dm, callback) {
        getValue(`dropboxToken`).then(value => {
            if (value) {
                if (dm.type === `export` || (data && esgst.settings.exportBackup)) {
                    let name = prompt(`Enter the name of the file:`, `esgst_data_${new Date().toISOString().replace(/:/g, `_`)}`);
                    request(JSON.stringify(data), {authorization: `Bearer ${value}`, [`Dropbox-API-Arg`]: `{"path": "/${name}.json"}`, [`Content-Type`]: `application/octet-stream`}, `POST`, false, `https://content.dropboxapi.com/2/files/upload`, response => {
                        if (!dm.autoBackup) {
                            createFadeMessage(dm.message, `Data ${dm.type}ed with success!`);
                        }
                        callback();
                    });
                } else {
                    request(`{"path": ""}`, {authorization: `Bearer ${value}`, [`Content-Type`]: `application/json`}, `POST`, false, `https://api.dropboxapi.com/2/files/list_folder`, response => {
                        let canceled = true;
                        let popup = new Popup(`fa-dropbox`, `Select a file to import:`, true);
                        let entries = insertHtml(popup.scrollable, `beforeEnd`, `<div class="popup__keys__list"></div>`);
                        JSON.parse(response.responseText).entries.forEach(entry => {
                            let item = insertHtml(entries, `beforeEnd`, `
                                <div class="esgst-clickable">${entry.name} - ${convertBytes(entry.size)}</div>
                            `);
                            item.addEventListener(`click`, () => {
                                createConfirmation(`Are you sure you want to import the selected data?`, () => {
                                    canceled = false;
                                    popup.close();
                                    request(null, {authorization: `Bearer ${value}`, [`Dropbox-API-Arg`]: `{"path": "/${entry.name}"}`, [`Content-Type`]: `text/plain`}, `GET`, false, `https://content.dropboxapi.com/2/files/download`, response => {
                                        dm.data = JSON.parse(response.responseText);
                                        manageData(dm, false, false, false, false, callback);
                                    });
                                });
                            });
                        });
                        popup.onClose = () => {
                            if (canceled) {
                                callback();
                            }
                        };
                        popup.open();
                    });
                }
            } else {
                setTimeout(checkDropboxComplete, 250, data, dm, callback);
            }
        });
    }

    function checkGoogleDriveComplete(data, dm, callback) {
        getValue(`googleDriveToken`).then(value => {
            if (value) {
                if (dm.type === `export` || (data && esgst.settings.exportBackup)) {
                    let name = prompt(`Enter the name of the file:`, `esgst_data_${new Date().toISOString().replace(/:/g, `_`)}`);
                    request(`--esgst\nContent-Type: application/json; charset=UTF-8\n\n{"mimeType": "mime/type", "name": "${name}.json", "parents": ["appDataFolder"]}\n\n--esgst\nContent-Type: mime/type\n\n${JSON.stringify(data)}\n--esgst--`, {authorization: `Bearer ${value}`, [`Content-Type`]: `multipart/related; boundary=esgst`}, `POST`, false, `https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart`, response => {
                        if (!dm.autoBackup) {
                            createFadeMessage(dm.message, `Data ${dm.type}ed with success!`);
                        }
                        callback();
                    });
                } else {
                    request(null, {authorization: `Bearer ${value}`}, `GET`, false, `https://www.googleapis.com/drive/v3/files?spaces=appDataFolder`, response => {
                        let canceled = true;
                        let popup = new Popup(`fa-google`, `Select a file to import:`, true);
                        let entries = insertHtml(popup.scrollable, `beforeEnd`, `<div class="popup__keys__list"></div>`);
                        JSON.parse(response.responseText).files.forEach(file => {
                            let item = insertHtml(entries, `beforeEnd`, `
                                <div class="esgst-clickable">${file.name}</div>
                            `);
                            item.addEventListener(`click`, () => {
                                createConfirmation(`Are you sure you want to import the selected data?`, () => {
                                    canceled = false;
                                    popup.close();
                                    request(null, {authorization: `Bearer ${value}`}, `GET`, false, `https://www.googleapis.com/drive/v3/files/${file.id}?alt=media`, response => {
                                        dm.data = JSON.parse(response.responseText);
                                        manageData(dm, false, false, false, false, callback);
                                    });
                                });
                            });
                        });
                        popup.onClose = () => {
                            if (canceled) {
                                callback();
                            }
                        };
                        popup.open();
                    });
                }
            } else {
                setTimeout(checkGoogleDriveComplete, 250, data, dm, callback);
            }
        });
    }

    function checkOneDriveComplete(data, dm, callback) {
        getValue(`oneDriveToken`).then(value => {
            if (value) {
                if (dm.type === `export` || (data && esgst.settings.exportBackup)) {
                    let name = prompt(`Enter the name of the file:`, `esgst_data_${new Date().toISOString().replace(/:/g, `_`)}`);
                    request(JSON.stringify(data), {Authorization: `bearer ${value}`, [`Content-Type`]: `application/json`}, `PUT`, false, `https://graph.microsoft.com/v1.0/me/drive/special/approot:/${name}.json:/content`, response => {
                        if (!dm.autoBackup) {
                            createFadeMessage(dm.message, `Data ${dm.type}ed with success!`);
                        }
                        callback();
                    }, true);
                } else {
                    request(null, {Authorization: `bearer ${value}`}, `GET`, false, `https://graph.microsoft.com/v1.0/me/drive/special/approot/children`, response => {
                        let canceled = true;
                        let popup = new Popup(`fa-windows`, `Select a file to import:`, true);
                        let entries = insertHtml(popup.scrollable, `beforeEnd`, `<div class="popup__keys__list"></div>`);
                        JSON.parse(response.responseText).value.forEach(file => {
                            let item = insertHtml(entries, `beforeEnd`, `
                                <div class="esgst-clickable">${file.name} - ${convertBytes(file.size)}</div>
                            `);
                            item.addEventListener(`click`, () => {
                                createConfirmation(`Are you sure you want to import the selected data?`, () => {
                                    canceled = false;
                                    popup.close();
                                    request(null, {authorization: `Bearer ${value}`}, `GET`, false, `https://graph.microsoft.com/v1.0/me/drive/items/${file.id}/content`, response => {
                                        dm.data = JSON.parse(response.responseText);
                                        manageData(dm, false, false, false, false, callback);
                                    }, true);
                                });
                            });
                        });
                        popup.onClose = () => {
                            if (canceled) {
                                callback();
                            }
                        };
                        popup.open();
                    }, true);
                }
            } else {
                setTimeout(checkOneDriveComplete, 250, data, dm, callback);
            }
        });
    }

    /* */

    function selectSwitches(switches, type, callback) {
        var key;
        for (key in switches) {
            switches[key][type]();
        }
        if (callback) {
            callback();
        }
    }

    /* Style */

    function addStyle() {
        var backgroundColor, color, colors, i, n, style;
        style = ``;
        colors = [
            {
                id: `gc_h`,
                key: `hidden`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_gi`,
                key: `giveawayInfo`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_fcv`,
                key: `fullCV`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_rcv`,
                key: `reducedCV`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_ncv`,
                key: `noCV`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_w`,
                key: `wishlisted`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_o`,
                key: `owned`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_i`,
                key: `ignored`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_rm`,
                key: `removed`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_ea`,
                key: `earlyAccess`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_tc`,
                key: `tradingCards`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_a`,
                key: `achievements`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_mp`,
                key: `multiplayer`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_sc`,
                key: `steamCloud`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_l`,
                key: `linux`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_m`,
                key: `mac`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_dlc`,
                key: `dlc`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_p`,
                key: `package`,
                mainKey: `esgst-gc`
            },
            {
                id: `gc_g`,
                key: `genres`,
                mainKey: `esgst-gc`
            },
            {
                id: `wbh_w`,
                key: `whitelisted`,
                mainKey: `esgst-wbh-highlight`
            },
            {
                id: `wbh_b`,
                key: `blacklisted`,
                mainKey: `esgst-wbh-highlight`
            },
            {
                id: `ge_p`,
                key: `public`,
                mainKey: `esgst-ge`
            },
            {
                id: `ge_g`,
                key: `group`,
                mainKey: `esgst-ge`
            },
            {
                id: `ge_b`,
                key: `blacklist`,
                mainKey: `esgst-ge`
            }
        ];
        for (i = 0, n = colors.length; i < n; ++i) {
            color = esgst[`${colors[i].id}_color`];
            backgroundColor = esgst[`${colors[i].id}_bgColor`];
            style += `
                .${colors[i].mainKey}-${colors[i].key} {
                    ${color ? `color: ${color} !important;` : ``}
                    background-color: ${backgroundColor} !important;
                }
            `;
        }
        style += `
            .esgst-disabled {
                cursor: default !important;
                opacity: 0.5;
            }

            .esgst-changelog img {
                max-width: 98%;
            }

            .esgst-debug {
                height: 300px;
                width: 600px;
            }

            .esgst-radb-button {
                cursor: pointer;
                display: inline-block;
            }

            .esgst-radb-button.homepage_heading {
                margin-right: 5px;
            }

            :not(.page__heading) > .esgst-radb-button:not(.homepage_heading) {
                margin-left: 5px;
            }

            .esgst-radb-button + .homepage_heading {
                display: inline-block;
                width: calc(100% - 80px);
            }

            .esgst-cfh-preview {
                margin: 5px 0;
                text-align: left;
            }

            .esgst-qgs-container i {
                color: #AAB5C6;
            }

            .esgst-qgs-container {
                align-items: center;
                background-color: #fff;
                border-color: #c5cad7 #dee0e8 #dee0e8 #d2d4e0;
                border-radius: 4px;
                border-style: solid;
                border-width: 1px;
                display: flex;
                margin-right: 5px;
                padding: 5px 10px;
            }

            .esgst-qgs-container-expanded {
                position: absolute;
            }

            .esgst-qgs-container-expanded .esgst-qgs-input {
                width: 300px;
            }

            .esgst-qgs-container-expanded + .nav__button-container {
                margin-left: 40px;
            }

            .esgst-qgs-input {
                border: 0 !important;
                height: 100%;
                line-height: normal !important;
                padding: 0 !important;
                width: 0;
            }

            .esgst-sgc-results .table__row-outer-wrap {
                padding: 10px 5px;
            }

            .esgst-glwc-results {
                display: flex;
            }

            .esgst-glwc-results >* {
                flex: 1;
                margin: 10px;
            }

            .esgst-glwc-heading {
                font-family: "Open Sans";
                font-size: 25px;
                margin: 5px;
                text-align: center;
            }

            .esgst-stbb-button, .esgst-sttb-button {
                cursor: pointer;
            }

            .esgst-stbb-button-fixed, .esgst-sttb-button-fixed {
                bottom: ${esgst.ff ? 49 : 5}px;
                background-color: #fff;
                border: 1px solid #d2d6e0;
                border-radius: 4px;
                color: #4B72D4;
                padding: 5px 15px;
                position: fixed;
                right: 5px;
            }

            .esgst-stbb-button:not(.esgst-hidden) + .esgst-sttb-button {
                bottom: 79px;
            }

            .esgst-bold {
                font-weight: bold;
            }

            .esgst-italic {
                font-style: italic;
            }

            .esgst-mt-checkbox {
                display: inline-block;
                margin-right: 5px;
            }

            .esgst-codb-button {
                cursor: pointer;
                display: inline-block;
                margin: 0 5px 0 0;
            }

            .esgst-gm-popout {
                min-width: 725px;
            }

            .esgst-gm-popout textarea {
                height: 150px !important;
                overflow-y: auto !important;
            }

            .esgst-es-page-divisor {
                margin: 5px 0;
            }

            .esgst-es-top-button {
                bottom: 59px;
                position: fixed;
            }

            .esgst-es-top-button >* {
                line-height: normal;
                padding: 2px 25px;
            }

            .esgst-gm-popout .esgst-button-set >* {
                line-height: 25px;
                width: calc(100% - 30px);
            }

            .comment__parent .esgst-cerb-reply-button {
                margin-top: 54px;
                position: absolute;
                text-align: center;
                width: 44px;
            }

            .comment_inner .esgst-cerb-reply-button {
                margin-left: 21px;
                margin-top: 34px;
                position: absolute;
                text-align: center;
                width: 24px;
            }

            .esgst-page-heading {
                display: flex;
                align-items: flex-start;
                word-wrap: break-word;
            }

            .esgst-page-heading >* {
                background-image: linear-gradient(#fff 0%, rgba(255,255,255,0.4) 100%);
                display: flex;
                padding: 5px 10px;
                border: 1px solid #d2d6e0;
                border-radius: 4px;
                color: #4B72D4;
                font: 700 14px/22px "Open Sans", sans-serif;
            }

            .esgst-page-heading i {
                line-height: 22px;
            }

            .esgst-page-heading >*:not(.page__heading__breadcrumbs) {
                align-items: center;
            }

            .esgst-page-heading >*:not(:last-child) {
                margin-right: 5px;
            }

            .esgst-tab-menu {
                background-color: #f0f2f5;
                background-image: none;
                display: block;
                padding: 25px;
                font: 12px Arial, sans-serif;
                text-shadow: 1px 1px rgba(255,255,255,0.94);
                color: #465670;
            }

            .esgst-tab-menu-header {
                padding: 0;
            }

            .esgst-form-row {
                margin-bottom: 20px;
            }

            .esgst-form-row:first-of-type {
                margin-top: 14px;
            }

            .esgst-form-heading {
                align-items: center;
                display: flex;
                margin-bottom: 5px;
            }

            .esgst-form-heading > div:not(:last-child) {
                margin-right: 10px;
            }

            .esgst-form-heading-number {
                font: 300 14px "Open Sans", sans-serif;
                color:#6b7a8c;
            }

            .esgst-form-heading-text {
                font: 700 14px "Open Sans", sans-serif;
                color: #4B72D4;
            }

            .esgst-form-row-indent {
                padding: 3px 0 3px 20px;
                margin-left: 5px;
                border-left: 1px solid #d2d6e0;
                box-shadow: 1px 0 0 rgba(255,255,255,0.3) inset;
            }

            .esgst-form-sync {
                display: flex;
            }

            .esgst-form-sync-data {
                flex: 1;
            }

            .esgst-notification {
                border: 1px solid;
                border-radius: 4px;
                padding: 0 15px;
                font-size: 11px;
                line-height: 32px;
                overflow: hidden;
            }

            .esgst-notification a {
                text-decoration: underline;
            }

            .esgst-notification-success {
                background-image: linear-gradient(#f7fcf2 0%, #e7f6da 100%);
                border-color: #C5E9A5;
                color:#8fa47b;
            }

            .esgst-notification-warning {
                background-image: linear-gradient(#F6F6E6 0px, #F5F5DF 20px);
                border-color: #EDE5B2;
                color: #a59d7c;
            }

            .esgst-user-icon {
                display: inline-block;
                line-height: normal;
                margin: 0 5px 0 0;
            }

            .esgst-user-icon i {
                border: 0;
                line-height: normal;
                margin: 0;
                text-shadow: none !important;
            }

            .esgst-whitelist {
                color: #556da9 !important;
            }

            .esgst-blacklist {
                color: #a95570 !important;
            }

            .esgst-positive {
                color: #96c468 !important;
            }

            .esgst-negative {
                color: #ec8583 !important;
            }

            .esgst-unknown {
                color: #77899a !important;
            }

            .esgst-ugd-table .table__rows .table__row-outer-wrap:hover {
                background-color: rgba(119, 137, 154, 0.1);
            }

            .esgst-ugd-table .table__column--width-small {
                min-width: 0;
                width: 12%;
            }

            .markdown {
                word-break: break-word;
            }

            .esgst-busy >* {
                opacity: 0.2;
            }

            .comment__actions .esgst-rml-link {
                margin: 0 0 0 10px;
            }

            .esgst-ap-avatar {
                cursor: pointer;
            }

            .esgst-settings-menu .form__sync-default {
                margin: 0 5px;
            }

            .esgst-uh-popup a {
                border-bottom: 1px dotted;
            }

            .esgst-auto-sync {
                display: inline-block;
                margin: -5px 5px 0;
                padding: 2px;
                width: 50px;
            }

            .esgst-ap-popout .featured__table__row__left:not(.esgst-uh-title), .esgst-mr-reply, .esgst-mr-edit, .esgst-mr-delete, .esgst-mr-undelete {
                margin: 0 10px 0 0;
            }

            .esgst-ugd-button {
                cursor: pointer;
                display: inline-block;
            }

            .esgst-cfh-popout {
                font: 700 12px "Open Sans", sans-serif;
            }

            .esgst-cfh-panel span >:first-child >* {
                margin: 0 !important;
            }

            .esgst-cfh-popout input {
                width: auto;
            }

            .esgst-namwc-highlight {
                font-weight: bold;
            }

            .esgst-iwh-icon {
                margin: 0 0 0 5px;
            }

            .esgst-ap-suspended >* {
                color: #e9202a;
            }

            .esgst-ap-popout {
                border: none !important;
                border-radius: 5px;
                box-shadow: 0 0 10px 2px hsla(0, 0%, 0%, 0.8);
                min-width: 400px;
                padding: 0 !important;
                text-shadow: none;
            }

            .ui-tooltip {
                z-index: 99999;
            }

            .esgst-ap-popout .featured__outer-wrap:not(.esgst-uh-box) {
                border-radius: 5px;
                padding: 5px;
                width: auto;
                white-space: normal;
            }

            .esgst-ap-popout .featured__inner-wrap {
                align-items: flex-start;
                padding: 0 5px 0 0;
            }

            .esgst-ap-popout .featured__heading {
                margin: 0;
            }

            .esgst-ap-popout .featured__heading__medium {
                font-size: 18px;
            }

            .esgst-ap-link {
                width: 100px;
            }

            .esgst-ap-link .global__image-outer-wrap--avatar-large {
                box-sizing: content-box !important;
                height: 64px !important;
                margin: 5px;
                width: 64px !important;
            }

            .esgst-ap-popout .global__image-outer-wrap--avatar-large:hover {
                background-color: hsla(0, 0%, 25%, 0.2) !important;
            }

            .esgst-ap-link .global__image-inner-wrap {
                background-size: cover !important;
            }

            .esgst-ap-popout .sidebar__shortcut-outer-wrap {
                margin: 10px 0;
            }

            .esgst-ap-popout .sidebar__shortcut-inner-wrap i {
                height: 18px;
                font-size: 12px;
            }

            .esgst-ap-popout .sidebar__shortcut-inner-wrap * {
                line-height: 18px;
                vertical-align: middle;
            }

            .esgst-ap-popout .sidebar__shortcut-inner-wrap img {
                height: 16px;
                vertical-align: baseline !important;
                width: 16px;
            }

            .esgst-ap-popout .featured__table {
                display: inline-block;
                width: 100%;
            }

            .esgst-ap-popout .featured__table__row {
                padding: 2px;
            }

            .esgst-ap-popout .featured__table__row:nth-child(n + 3) {
                margin-left: -95px;
            }

            .esgst-ap-popout .featured__table__row:last-of-type .featured__table__row__right * {
                font-size: 11px;
            }

            .esgst-ct-comment-button {
                cursor: pointer;
            }

            .popup__keys__list .esgst-ggl-member, .esgst-dh-highlighted, .esgst-dh-highlighted.table__row-outer-wrap {
                background-color: rgba(150, 196, 104, 0.2) !important;
                padding: 5px !important;
            }

            .esgst-gb-highlighted.ending {
                background-color: rgba(236, 133, 131, 0.8) !important;
                background-image: none !important;
            }

            .esgst-gb-highlighted.started {
                background-color: rgba(150, 196, 104, 0.8) !important;
                background-image: none !important;
            }

            .esgst-gb-highlighted.ending.started {
                background-color: rgba(193, 165, 118, 0.8) !important;
                background-image: none !important;
            }

            .esgst-ct-comment-read:hover, .esgst-ct-visited:hover {
                background-color: rgba(119, 137, 154, 0.1) !important;
            }

            .esgst-gf-hide-button, .esgst-gf-unhide-button, .esgst-gb-button, .esgst-gdttt-button, .esgst-df-button, .esgst-dh-button {
                cursor: pointer; display: inline-block;
                margin: 0 5px 0 0;
            }

            .esgst-pm-button, .esgst-ust-checkbox {
                cursor: pointer;
                margin-left: -65px;
                margin-top: 8.5px;
                position: absolute;
            }

            .page__heading .esgst-pm-button {
                display: inline-block;
                margin: 0 5px 0 0;
                position: static;
            }

            .esgst-adots .esgst-pm-button {
                margin-left: -58px;
            }

            .comment__actions .esgst-ct-comment-button {
                margin: 0 0 0 10px;
            }

            .comment__actions >:first-child + .esgst-ct-comment-button {
                margin: 0;
            }

            .esgst-ct-comment-button >:not(:last-child) {
                margin: 0 10px 0 0;
            }

            .esgst-cfh-panel {
                margin: 0 0 2px;
                text-align: left;
            }

            .esgst-cfh-panel >* {
                background-color: #fff;
                border: 1px solid #ccc;
                border-radius: 5px;
                cursor: pointer;
                display: inline-block;
                margin: 1px;
                opacity: 0.5;
                padding: 5px;
            }

            .esgst-cfh-panel >*:hover {
                opacity: 1;
            }

            .esgst-cfh-panel span >:not(:first-child), .esgst-ded-status {
                display: block;
            }

            .esgst-cfh-panel span i {
                line-height: 22px;
            }

            .esgst-cfh-panel .form__saving-button {
                display: inline-block;
                margin: 5px;
                min-width:0;
            }

            .esgst-cfh-panel table {
                display: block;
                max-height: 200px;
                max-width: 375px;
                overflow: auto;
            }

            .esgst-cfh-panel table td:first-child {
                min-width: 25px;
                text-align: center;
            }

            .esgst-cfh-panel table td:not(:first-child) {
                min-width: 75px;
                text-align: center;
            }

            .esgst-cfh-emojis {
                display: block !important;
                font-size: 18px;
                max-height: 200px;
                min-height: 30px;
                overflow: auto;
                text-align: center;
            }

            .esgst-cfh-emojis >* {
                cursor: pointer;
                display: inline-block;
                margin: 2px;
            }

            .esgst-cfh-panel ~ textarea {
                max-height: 475px;
            }

            .esgst-cfh-popout {
                white-space: normal;
                width: 300px;
            }

            .esgst-mpp-popup {
                position: fixed !important;
            }

            .esgst-mpp-visible {
                padding: 0;
            }

            .esgst-mpp-hidden {
                display: none;
                max-height: 75%;
                overflow: auto;
                padding: 15px;
                position: absolute;
                width: 75%;
            }

            .esgst-ueg {
                opacity: 1 !important;
            }

            .esgst-fh {
                height: auto !important;
                position: fixed;
                top: 0;
                width: 100%;
                z-index: 999 !important;
            }

            .esgst-ff {
                background-color: #95a4c0;
                bottom: 0;
                padding: 0;
                position: fixed;
                text-shadow: none;
                width: 100%;
                z-index: 999;
            }

            .esgst-ff >* {
                max-width: none;
                padding: 15px 25px;
            }

            .esgst-ff-sibling {
                margin-bottom: 39px;
            }

            .esgst-sgg-sticky-button {
                cursor: pointer;
                margin: 0 5px 0 0;
                opacity: 0.5;
            }

            .esgst-sgg-unsticky-button {
                cursor: pointer;
                margin: 0 5px 0 0;
            }

            .esgst-ct-count {
                color: #e9202a;
                font-weight: bold;
            }

            .esgst-uh-box {
                background: linear-gradient(to bottom, #555, #222);
                border: 1px solid #888;
                margin: 5px 0 0;
                padding: 15px;
                position: absolute;
                text-align: center;
            }

            .esgst-uh-title {
                color: rgba(255, 255, 255, 0.6);
                font-weight: bold;
                margin: 0 0 15px;
            }

            .esgst-uh-list {
                color: rgba(255, 255, 255, 0.4);
            }

            .esgst-wbc-button, .esgst-namwc-button, .esgst-nrf-button {
                cursor: pointer;
                margin: 0 0 0 5px;
            }

            .esgst-luc-value {
                margin: 0 0 0 5px;
            }

            .esgst-sgpb-container {
                display: flex;
            }

            .esgst-sgpb-container >* {
                flex: 1;
            }

            .esgst-sgpb-button {
                background-image: linear-gradient(rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 100%);
                border-color: #dde2ea #cdd4df #cbd1dc #d6dbe7;
                color: #6e7585;
                text-shadow: 1px 1px 1px #fff;
                transition: opacity 0.5s;
                border-radius: 3px;
                font: 700 13px 'Open Sans', sans-serif;
                margin: 0 0 0 5px;
                padding: 7px 15px;
                display: flex;
                align-items: center;
                border-width: 1px;
                border-style: solid;
                text-decoration: none;
            }

            .esgst-sgpb-button:active {
                background-image: linear-gradient(#e1e7eb 0%, #e6ebf0 50%, #ebeff2 100%) !important;
                box-shadow: 2px 2px 5px #ccd4db inset;
                text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.6);
                margin: 2px 0 0 7px !important;
                border: 0;
            }

            .esgst-sgpb-button:hover {
                background-image: linear-gradient(rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.3) 100%);
            }

            .esgst-sgpb-button i {
                height: 14px;
                margin: 0 10px 0;
                width: 14px;
            }

            .esgst-sgpb-button img {
                height: 14px;
                vertical-align: baseline;
                width: 14px;
            }

            .esgst-stpb-button img {
                vertical-align: top;
            }

            .esgst-gh-highlight, .esgst-green-highlight {
                background-color: rgba(150, 196, 104, 0.2);
            }

            .esgst-pgb-button, .esgst-gf-button {
                border: 1px solid #d2d6e0;
                border-top: none;
                background-color: #e1e6ef;
                background-image: linear-gradient(rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0) 100%);color: #6b7a8c;
                cursor: pointer;
                margin-bottom: 15px;
                padding: 3px;
                text-align: center;
                border-radius: 0 0 4px 4px;
            }

            .esgst-gf-button {
                margin-bottom: 0 !important;
            }

            .esgst-pgb-button:hover, .esgst-gf-button:hover {
                background-image:linear-gradient(rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0) 100%);
            }

            .esgst-gm-giveaway {
                background-color: #fff;
                border: 1px solid;
                border-radius: 4px;
                cursor: pointer;
                display: inline-block;
                margin: 5px 2px;
                padding: 2px 5px;
            }

            .esgst-feature-description {
                background-color: #fff;
                color: #465670;
                padding: 10px;
                width: 420px;
                border-radius: 4px;
            }

            .esgst-feature-description img {
                max-width: 400px;
            }

            .esgst-gm-giveaway.error {
                background-color: rgba(236, 133, 131, 0.5);
            }

            .esgst-gm-giveaway.success {
                background-color: rgba(150, 196, 104, 0.5);
            }

            .esgst-gm-giveaway.connected {
                text-decoration: line-through;
            }

            .esgst-gts-section >*, .esgst-gm-section >* {
                margin: 5px 0;
            }

            .esgst-gm-section .esgst-button-set {
                display: inline-block;
                margin: 5px;
            }

            .sidebar .esgst-button-set >* {
                margin-bottom: 5px;
                width: 304px;
            }

            .esgst-button-set .sidebar__entry-delete, .esgst-button-set .sidebar__error {
                display: inline-block;
            }

            .esgst-button-group {
                display: block;
            }

            .esgst-button-group >* {
                display: inline-block;
            }

            .esgst-button-group >*:not(:first-child) {
                margin-left: 5px;
            }

            .esgst-gm-popout .esgst-button-group {
                align-items: center;
                display: flex;
                margin-bottom: 5px;
            }

            .esgst-gm-popout .esgst-button-group >*:not(:first-child) {
                flex: 1;
            }

            .esgst-ggl-panel {
                color: #6b7a8c;
                font-size: 12px;
                padding: 5px;
            }

            .esgst-ggl-panel >* {
                display: inline-block;
            }

            .esgst-ggl-panel >*:not(:last-child) {
                margin-right: 10px;
            }

            .esgst-ggl-panel a:last-child {
                border-bottom: 1px dotted;
            }

            .esgst-ggl-panel .table_image_avatar {
                cursor: pointer;
                display: inline-block;
                height: 12px;
                width: 12px;
                vertical-align: middle;
            }

            .esgst-ggl-member {
                font-weight: bold;
            }

            .esgst-ggl-heading {
                font-weight: bold;
                line-weight: 22px;
                margin: 10px;
            }

            .esgst-gcl-popout, .esgst-ggl-popout {
                padding: 0 !important;
            }

            .esgst-gcl-popout .table__row-outer-wrap, .esgst-ggl-popout .table__row-outer-wrap {
                padding: 10px 5px;
            }

            .esgst-hidden-buttons {
                padding: 2px !important;
            }

            .esgst-popout {
                background-color: #fff;
                border: 1px solid #d2d6e0;
                border-radius: 4px;
                color: #465670;
                left: 0;
                overflow: auto;
                padding: 10px;
                position: absolute;
                top: 0;
                z-index: 99999;
            }

            .esgst-aic-carousel {
                align-items: center;
                cursor: default !important;
                display: flex;
                justify-content: center;
            }

            .esgst-aic-carousel >:last-child {
                border: 5px solid #fff;
                border-radius: 5px;
                max-width: 90%;
            }

            .esgst-aic-carousel img {
                display: block;
            }

            .esgst-aic-panel {
                color: #fff;
                position: absolute;
                text-align: center;
                top: 25px;
            }

            .esgst-aic-left-button, .esgst-aic-right-button {
                cursor: pointer;
                display: inline-block;
                margin: 10px;
                text-align: center;
                width: 25px;
            }

            .esgst-aic-left-button i, .esgst-aic-right-button i {
                font-size: 25px;
            }

            .esgst-aic-source {
                font-weight: bold;
                margin-top: 10px;
                text-decoration: underline;
            }

            .esgst-popup-modal {
                background-color: rgba(60, 66, 77, 0.7);
                bottom: 0;
                cursor: pointer;
                left: 0;
                position: fixed;
                right: 0;
                top: 0;
            }

            .esgst-popup-large {
                width: 75%;
            }

            .esgst-popup {
                background-color: #f0f2f5;
                border-radius: 4px;
                color: #465670;
                max-width: calc(90% - 50px);
                padding: 25px;
                position: fixed;
                text-align: center;
                text-shadow: 1px 1px rgba(255,255,255,0.94);
                transition: 500ms ease;
                ${esgst.staticPopups ? `
                    left: 5%;
                    top: 5%;
                ` : ``}
            }

            .esgst-popup li:before {
                margin-left: 0;
                padding-right: 10px;
                position: static;
                width: auto;
                text-align: left;
            }

            .esgst-popup-description >*, .esgst-popup-scrollable >* {
                margin: 10px 0 0 !important;
            }

            .esgst-popup-actions {
                color: #4b72d4;
                margin-top: 15px;
            }

            .esgst-popup-actions >* {
                border-bottom: 1px dotted;
                box-shadow: 0 1px 0 #fff;
                cursor: pointer;
                display: inline-block;
            }

            .esgst-popup-actions >*:not(:last-child) {
                margin-right: 15px;
            }

            .esgst-popup-scrollable {
                overflow: auto;
            }

            .esgst-popup .popup__keys__list {
                max-height: none;
            }

            .esgst-heading-button {
                display: inline-block;
                cursor: pointer;
            }

            .esgst-popup-heading {
                display: flex;
                align-items: center;
                margin-bottom: 5px;
            }

            .esgst-popup-icon {
                font-size: 25px;
                margin-right: 10px;
            }

            .esgst-popup-title {
                font: 300 18px 'Open Sans', sans-serif;
            }

            .esgst-popup-title span {
                font-weight: bold;
            }

            .esgst-text-left {
                text-align: left;
            }

            .esgst-text-center {
                text-align: center;
            }

            .esgst-hidden {
                display: none !important;
            }

            .esgst-clickable {
                cursor: pointer;
            }

            .fa img {
                height: 14px;
                width: 14px;
                vertical-align: middle;
            }

            .nav__left-container .fa img {
                vertical-align: baseline;
            }

            .esgst-checkbox, .esgst-hb-update, .esgst-hb-changelog, .esgst-dh-view-button {
                cursor: pointer;
            }

            .esgst-sm-small-number {
                font-size: 12px;
                display: inline-block;
            }

            .esgst-toggle-switch-container {
                margin: 2px;
            }

            .esgst-toggle-switch-container.inline {
                display: inline-block;
            }

            .page__heading .esgst-toggle-switch-container.inline, .page_heading .esgst-toggle-switch-container.inline, .esgst-page-heading .esgst-toggle-switch-container.inline {
                height: 16px;
                margin: 0 2px;
                line-height: normal;
                vertical-align: middle;
            }

            .esgst-toggle-switch {
                position: relative;
                display: inline-block;
                width: 26px;
                height: 14px;
                vertical-align: top;
            }

            .esgst-toggle-switch input {
                display: none !important;
            }

            .esgst-toggle-switch-slider {
                border-radius: 20px;
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                -webkit-transition: .4s;
                transition: .4s;
            }

            .esgst-toggle-switch-slider:before {
                border-radius: 50%;
                position: absolute;
                content: "";
                height: 12px;
                width: 12px;
                left: 1px;
                bottom: 1px;
                background-color: white;
                -webkit-transition: .4s;
                transition: .4s;
            }

            input:checked + .esgst-toggle-switch-slider {
                background-color: #4B72D4;
            }

            input:focus + .esgst-toggle-switch-slider {
                box-shadow: 0 0 1px #4B72D4;
            }

            input:checked + .esgst-toggle-switch-slider:before {
                -webkit-transform: translateX(12px);
                -ms-transform: translateX(12px);
                transform: translateX(12px);
            }

            .esgst-adots, .esgst-rbot {
                margin-bottom: 25px;
            }

            .esgst-float-left {
                float: left;
            }

            .esgst-float-right {
                float: right;
            }

            .esgst-clear {
                clear: both;
            }

            .esgst-rbot .reply_form .btn_cancel {
                display: none;
            }

            .esgst-aas-button, .esgst-es-pause-button, .esgst-es-refresh-button {
                cursor: pointer;
                display: inline-block;
            }

            .esgst-es-page-heading {
                margin-top: 25px;
            }

            .esgst-gc-border {
                display: flex;
                height: 5px;
                margin-left: 5px;
                width: ${esgst.ib ? `186px` : `174px`};
            }

            .esgst-gc-border >* {
                flex: 1;
            }

            .esgst-gc-panel {
                text-align: left;
            }

            .esgst-gc-panel a {
                text-decoration: none;
            }

            .esgst-gc-panel-inline {
                display: inline-block;
                margin: 0 0 0 5px;
            }

            .esgst-gc {
                border-radius: 4px;
                display: inline-block;
                font-size: 10px;
                line-height: 10px;
                margin: 5px 0;
                padding: 2px 3px;
                text-shadow: none;
            }

            .esgst-gc-rating i {
                color: #fff !important;
            }

            .esgst-gc-rating-positive {
                color: #fff !important;
                background-color: #66c0f4;
            }

            .esgst-gc-rating-negative {
                color: #fff !important;
                background-color: #a34c25;
            }

            .esgst-gc-rating-mixed {
                color: #fff !important;
                background-color: #b9a074;
            }

            a.esgst-gc-genres {
                max-width: 150px;
                overflow: hidden;
                text-overflow: ellipsis;
                vertical-align: middle;
                white-space: nowrap;
            }

            span.esgst-gc-genres {
                background: none !important;
            }

            .esgst-gf-right-panel {
                float: right;
            }

            .esgst-gf-legend-panel, .esgst-gf-preset-panel {
                margin: 5px;
                text-align: right;
            }

            .esgst-gf-override {
                cursor: pointer;
                margin-right: 5px;
            }

            .esgst-gf-container {
                text-align: left;
            }

            .esgst-gf-container:not(.esgst-popup-scrollable) {
                background-color: #E8EAEF;
                border-radius: 4px;
            }

            .esgst-gf-container.esgst-popup-scrollable {
                min-width: 650px;
            }

            .esgst-gf-container input {
                display: inline-block;
                height: 20px;
                padding: 0 5px;
                width: 100px !important;
            }

            .esgst-gf-filters {
                overflow: auto;
                position: relative;
            }

            .esgst-gf-filters >* {
                display: inline-block;
                margin: 5px;
                vertical-align: top;
            }

            .esgst-gf-basic-filter {
                margin: 10px;
                width: 375px;
            }

            .esgst-gf-basic-filter >* {
                margin: 8px;
            }

            .esgst-gf-type-filter, .esgst-gf-category-filter, .esgst-gf-exception-filter, .esgst-gf-legend, .esgst-gf-preset-panel >* {
                margin: 5px;
            }

            .esgst-gf-filter-count {
                background-color: #ddd;
                border-radius: 5px;
                font-size: 10px;
                padding: 2px;
            }
            
            .esgst-gf-button {
                border-top: 1px;
            }

            .esgst-wbh-highlight {
                border: none !important;
                border-radius: 4px;
                padding: 2px 5px;
                text-shadow: none;
            }

            .page__heading__breadcrumbs .esgst-wbh-highlight {
                padding: 0 2px;
            }

            .esgst-sm-colors input {
                display: inline-block;
                padding: 0;
                width: 100px;
            }

            .esgst-sm-colors input[type=color] {
                width: 25px;
            }

            .esgst-sm-colors select {
                display: inline-block;
                padding: 0;
                width: 100px;
            }

            .esgst-sm-colors-default {
                line-height: normal;
                padding: 5px 15px;
            }

            .esgst-ged-icon {
                margin: 0 0 0 10px;
            }

            .esgst-pgb-container {
                border-radius: 0 !important;
                margin: 0! important;
            }

            .esgst-gf-box {
                background-color: #E8EAEF;
                border: 1px solid #d2d6e0;
                border-radius: 0 !important;
                margin: 0! important;
                padding: 0 15px;
            }

            .esgst-gr-button {
                cursor: pointer;
                display: inline-block;
            }

            .esgst-egh-icon {
                cursor: pointer;
            }

            .giveaway__row-outer-wrap .esgst-egh-button, .giveaway__row-outer-wrap .esgst-gr-button, .table__row-outer-wrap .esgst-egh-button, .table__row-outer-wrap .esgst-egh-button, .table__row-outer-wrap .esgst-gr-button {
                margin-right: 5px;
            }

            p.table__column__heading {
                display: inline-block;
            }

            .esgst-giveaway-links {
                float: left;
                margin: 2px;
            }

            .esgst-giveaway-panel.giveaway__columns {
                float: right;
                margin: 2px;
            }

            .esgst-giveaway-panel .esgst-button-set {
                border: 0;
                padding: 0;
            }

            .esgst-giveaway-panel .esgst-button-set >* {
                line-height: inherit;
                margin:0;
            }

            .esgst-giveaway-panel >:first-child {
                margin: 0;
            }

            .esgst-giveaway-panel >*:not(:first-child) {
                margin: 0 0 0 5px;
            }

            .esgst-gv-popout .esgst-gwc, .esgst-gv-popout .esgst-gwr, .esgst-gv-popout .esgst-ttec {
                display: inline-block;
                margin: 0 !important;
                padding: 0 5px !important;
                width: 67px !important;
                vertical-align: top;
            }

            .esgst-gv-popout .esgst-gp-button {
                display: inline-block;
                margin: 0 !important;
                width: auto !important;
                vertical-align: top;
            }

            .esgst-gv-popout .esgst-gp-button >* {
                padding: 0 5px !important;
                width: 67px !important;
            }

            .esgst-giveaway-panel .form__submit-button, .esgst-giveaway-panel .form__saving-button {
                margin-bottom: 0;
                min-width: 0;
            }

            .esgst-ged-source {
                font-weight: bold;
                margin: 5px 0;
            }

            .table__column--width-small {
                width: 8%;
            }

            .sidebar .table__row-outer-wrap {
                padding: 5px 0;
            }

            .esgst-adots-tab-heading {
                background-color: #2f3540;
                border-top-left-radius: 5px;
                border-top-right-radius: 5px;
                color: #fff;
                cursor: pointer;
                display: inline-block;
                opacity: 0.5;
                padding: 5px 10px;
                text-shadow: none;
            }

            .esgst-adots-tab-heading.esgst-selected {
                opacity: 1;
            }

            .sidebar .esgst-adots {
                margin: 0;
                max-height: 300px;
                max-width: 336px;
                overflow: auto;
            }

            .sidebar .esgst-adots .esgst-dh-highlighted {
                padding: 0 !important;
                padding-bottom: 5px !important;
            }

            .sidebar .esgst-adots .table__column__heading, .esgst-adots .homepage_table_column_heading {
                display: inline-block;
                max-width: 225px;
                overflow: hidden;
                text-overflow: ellipsis;
                vertical-align: middle;
                white-space: nowrap;
            }

            .sidebar .esgst-adots .table__row-outer-wrap {
                padding: 0 !important;
                padding-bottom: 5px !important;
                border: 0;
                box-shadow: none;
            }

            .sidebar .esgst-adots .table__row-inner-wrap {
                display: block;
            }

            .sidebar .esgst-adots .table__row-inner-wrap >*:not(:last-child) {
                display: inline-block;
            }

            .esgst-faded {
                opacity: 0.5;
            }

            .esgst-green {
                color: #96c468 !important;
            }

            .esgst-grey {
                color: #77899a !important;
            }

            .esgst-orange {
                color: #c1a576 !important;
            }

            .esgst-red {
                color: #ec8583 !important;
            }

            .esgst-yellow {
                color: #fecc66 !important;
            }

            .esgst-warning {
                color: #e9202a !important;
                font-weight: bold;
            }

            .esgst-description {
                color: #6b7a8c;
                font-size: 11px;
                font-style: italic;
                margin-top: 10px;
            }

            .esgst-progress-bar {
                height: 10px;
                overflow: hidden;
                text-align: left;
            }

            .esgst-progress-bar .ui-progressbar-value {
                background-color: #96c468;
                height: 100%;
                margin: -1px;
            }

            .esgst-ib-user {
                background-color: #fff;
                background-position: 5px 5px;
                background-size: 32px;
                border: 1px solid #d2d6e0;
                border-radius: 4px;
                height: 44px;
                padding: 5px;
                width: 44px;
            }

            .featured__outer-wrap .esgst-ib-user {
                background-color: transparent;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            .esgst-ib-game {
                background-color: #fff;
                background-position: 5px 5px;
                border: 1px solid #d2d6e0;
                border-radius: 4px;
                padding: 5px;
            }

            .giveaway__row-outer-wrap .esgst-ib-game {
                background-size: 184px 69px;
                height: 81px;
                width: 196px;
            }

            .table__row-outer-wrap .esgst-ib-game {
                background-size: 85px 32px;
                height: 44px;
                width: 97px;
            }

            .esgst-oadd >* {
                padding-left: 0 !important;
                margin-left: 0 !important;
                border-left: none !important;
                box-shadow: none !important;
            }

            .esgst-gv-spacing {
                font-weight: bold;
                padding: 10px;
                text-align: center;
                width: 100px;
            }

            .esgst-gv-view {
                font-size: 0;
                padding: 5px 0;
                text-align: center;
            }

            .esgst-gv-view.pinned-giveaways__inner-wrap--minimized .giveaway__row-outer-wrap:nth-child(-n + 10) {
                display: inline-block;
            }

            .esgst-gv-container {
                border: 0 !important;
                box-shadow: none !important;
                display: inline-block;
                font-size: 12px;
                padding: 0;
                text-align: center;
                vertical-align: top;
                width: ${esgst.ib ? `196px` : `184px`};
            }

            .esgst-gv-box {
                display: block;
            }

            .esgst-gv-box >*:not(.giveaway__summary):not(.esgst-gv-icons) {
                margin: 0 !important;
            }

            .esgst-gv-box.is-faded:hover, .esgst-gv-box.esgst-faded:hover {
                opacity: 1;
            }

            .esgst-gv-icons {
                float: right;
                height: 18px;
                margin: -18px 0 0 !important;
            }

            .esgst-gv-time, .esgst-gv-icons .esgst-ged-source {
                background-color: #fff;
                padding: 2px !important;
            }

            .esgst-ged-source {
                font-weight: bold;
            }

            .esgst-gv-time i {
                font-size: 12px;
                vertical-align: baseline;
            }

            .esgst-gv-icons >* {
                line-height: normal;
                margin: 0 !important;
                padding: 1px 3px;
            }

            .esgst-gv-icons .giveaway__column--contributor-level {
                padding: 2px 5px !important;
            }

            .esgst-gv-popout {
                font-size: 11px;
                max-width: ${esgst.ib ? `174px` : `162px`};
                position: absolute;
                width: ${esgst.ib ? `174px` : `162px`};
                z-index: 1;
            }

            .esgst-gv-popout .giveaway__heading {
                display: block;
                height: auto;
            }

            .esgst-gv-popout .giveaway__heading__name {
                display: inline-block;
                font-size: 12px;
                max-width: 150px;
                overflow: hidden;
                text-overflow: ellipsis;
                vertical-align: middle;
            }

            .esgst-gv-popout .giveaway__heading__thin {
                font-size: 11px;
            }

            .esgst-gv-popout .esgst-gc-panel {
                font-size: 11px;
                text-align: center;
            }

            .esgst-gv-popout .esgst-gc-panel i, .esgst-gv-popout .giveaway__links i, .esgst-gv-popout .esgst-gwc i, .esgst-gv-popout .esgst-gwr i, .esgst-gv-popout .esgst-ggl-panel, .esgst-gv-popout .esgst-ggl-panel i {
                font-size: 11px;
            }

            .esgst-gv-popout .giveaway__columns:not(.esgst-giveaway-panel):not(.esgst-gv-icons) {
                display: block;
                float: left;
                width: calc(100% - 37px);
            }

            .esgst-gv-popout .giveaway__columns:not(.esgst-giveaway-panel):not(.esgst-gv-icons) >* {
                margin: 0;
                text-align: left;
            }

            .esgst-gv-popout .esgst-giveaway-panel {
                display: block;
                font-size: 11px;
            }

            .esgst-gv-popout .esgst-giveaway-panel >* {
                margin: 0;
            }

            .esgst-gv-popout .esgst-button-set {
                width: 100%;
            }

            .esgst-gv-popout .esgst-button-set >* {
                padding: 0;
                width: 100%;
            }
            .esgst-gv-popout .giveaway__links a:last-child {
                margin: 0 !important;
            }

            .esgst-gv-popout .giveaway_image_avatar, .esgst-gv-popout .featured_giveaway_image_avatar {
                margin: 5px;
                position: absolute;
                right: 5px;
            }

            .esgst-gv-popout .esgst-giveaway-links, .esgst-gv-popout .esgst-giveaway-panel {
                float: none;
            }

            .esgst-ags-panel {
                margin: 0 0 15px 0;
                max-width: 316px;
                text-align: center;
            }

            .esgst-ags-panel >* {
                display: inline-block;
            }

            .esgst-ags-filter {
                display: block;
                margin: 5px;
            }

            .esgst-ags-filter >* {
                padding: 0 5px !important;
                width: 125px;
            }

            .esgst-ags-checkbox-filter {
                margin: 5px;
            }

            .esgst-ugs-difference, .esgst-switch-input {
                display: inline-block;
                padding: 0 !important;
                width: 50px;
            }

            .esgst-switch-input-large {
                width: 150px;
            }

            .esgst-gas-popout {
                background-color: #fff;
                border: 1px solid #d2d6e0;
                border-radius: 4px;
                color: #465670;
                padding: 10px;
            }

            .esgst-ds-popout {
                background-color: #fff;
                border: 1px solid #d2d6e0;
                border-radius: 4px;
                color: #465670;
                padding: 10px;
            }

            .esgst-cfh-sr-container {
                max-height: 234px;
                overflow-y: auto;
            }

            .esgst-cfh-sr-box {
                position: relative;
            }

            .esgst-cfh-sr-summary {
                border-radius: 5px;
                cursor: pointer;
                padding: 5px;
                width: 200px;
            }

            .esgst-cfh-sr-box:not(:first-child) {
                border-top: 1px solid #ccc;
            }

            .esgst-cfh-sr-box:last-child) {
                border-bottom: 1px solid #ccc;
            }

            .esgst-cfh-sr-summary:hover {
                background-color: #465670;
                color: #fff;
            }

            .esgst-cfh-sr-name {
                font-size: 14px;
                overflow: hidden;
                text-overflow: ellipsis;
                width: 200px;
                white-space: nowrap;
            }

            .esgst-cfh-sr-description {
                opacity: 0.75;
                overflow: hidden;
                text-overflow: ellipsis;
                width: 200px;
                white-space: nowrap;
            }

            .esgst-cfh-sr-controls {
                position: absolute;
                right: 5px;
                top: 10px;
            }

            .esgst-cfh-sr-controls >* {
                margin: 2px;
            }

            .esgst-gt-preview .esgst-gt-tags {
                display: inline-block;
            }

            .esgst-gt-preview input[type=text] {
                display: inline-block;
                width: 100px;
                height: 15px;
            }

            .esgst-gt-preview input[type=color] {
                box-sizing: unset;
                height: 13px;
                line-height: normal;
                margin: 0;
                padding: 0;
                vertical-align: top;
                width: 15px;
            }

            .esgst-gt-button {
                border: 0! important;
                cursor: pointer;
                display: inline-block;
                line-height: normal;
                text-decoration: none !important;
                transition: opacity 0.2s;
            }

            .esgst-gt-button:hover {
                opacity: 1;
            }

            .esgst-gt-button i {
                margin: 0 !important;
            }

            .giveaway__row-outer-wrap .esgst-gt-button, .table__row-outer-wrap .esgst-gt-button {
                margin-left: 5px;
            }

            .esgst-gt-tags {
                font-size: 10px;
                font-weight: bold;
            }

            .esgst-gt-tags >* {
                display: inline-block !important;
                height: auto;
                margin: 0;
                padding: 2px;
                text-shadow: none;
                width: auto;
            }

            .esgst-gt-tags >:not(:first-child) {
                margin: 0 0 0 5px;
            }

            .esgst-gv-popout .esgst-gt-tags {
                display: none;
            }

            .esgst-ut-existing-button {
                padding: 8px;
                right: 25px;
                position: absolute;
            }

            .esgst-ut-existing-tags {
                font-weight: bold;
                text-align: left;
                text-shadow: none;
            }

            .esgst-ut-preview .esgst-ut-tags {
                display: inline-block;
            }

            .esgst-ut-preview input[type=text] {
                display: inline-block;
                width: 100px;
                height: 15px;
            }

            .esgst-ut-preview input[type=color] {
                box-sizing: unset;
                height: 13px;
                line-height: normal;
                margin: 0;
                padding: 0;
                vertical-align: top;
                width: 15px;
            }

            .esgst-ut-button {
                border: 0! important;
                cursor: pointer;
                display: inline-block;
                line-height: normal;
                margin: 0 0 0 5px;
                text-decoration: none !important;
                transition: opacity 0.2s;
            }

            .esgst-ut-button:hover {
                opacity: 1;
            }

            .author_name + .esgst-ut-button {
                margin: 0 5px 0 0;
            }

            .esgst-ut-button i {
                margin: 0 !important;
            }

            .esgst-ut-tags {
                font-size: 10px;
                font-weight: bold;
            }

            .esgst-ut-tags >* {
                display: inline-block !important;
                height: auto;
                margin: 0;
                padding: 1px 2px;
                text-shadow: none;
                width: auto;
            }

            .esgst-ut-tags >:not(:first-child) {
                margin: 0 0 0 5px;
            }

            .esgst-gv-popout .esgst-ut-tags, .esgst-adots .esgst-ut-tags {
                display: none;
            }
        `;
        if (esgst.sg) {
            style += `
                .esgst-header-menu {
                    box-shadow: 1px 1px 1px rgba(255, 255, 255, 0.07) inset, 1px 1px 0 rgba(255, 255, 255, 0.02) inset;
                    background-image: linear-gradient(#8a92a1 0px, #757e8f 8px, #4e5666 100%);
                    border-radius: 4px;
                    display: flex;
                    margin-right: 5px;
                }

                .esgst-header-menu-relative-dropdown {
                    position: relative;
                }

                .esgst-header-menu-absolute-dropdown {
                    top: 34px;
                    position: absolute;
                    width: 275px;
                    border-radius: 4px;
                    box-shadow: 0 0 15px rgba(0, 0, 0, 0.02), 2px 2px 5px rgba(0, 0, 0, 0.05), 1px 1px 2px rgba(0, 0, 0, 0.1);
                    overflow: hidden;
                    z-index: 1;
                }

                .esgst-header-menu-row {
                    cursor: pointer;
                    background-image: linear-gradient(#fff 0%, #f6f7f9 100%);
                    display: flex;
                    padding: 12px 15px;
                    text-shadow: 1px 1px #fff;
                    align-items: center;
                }

                .esgst-header-menu-row:last-child {
                    cursor: default;
                }

                .esgst-header-menu-row:not(:first-child) {
                    border-top: 1px dotted #d2d6e0;
                }

                .esgst-header-menu-row:not(:last-child):hover, .esgst.header-menu-button:hover + .esgst-header-menu-button {
                    border-top-color: transparent;
                }

                .esgst-header-menu-row i{
                    font-size: 28px;
                    margin-right: 15px;
                }

                .esgst-header-menu-row:hover i {
                    color: #fff !important;
                }

                .esgst-header-menu-row:not(:last-child):hover{
                    background-image: linear-gradient(#63a0f4 0%, #63a0f4 100%);
                    text-shadow: none;
                }

                .esgst-header-menu-row i.blue {
                    color: #9dd9e1;
                }

                .esgst-header-menu-row i.green {
                    color: #96c468;
                }

                .esgst-header-menu-row i.red {
                    color: #ec8583;
                }

                .esgst-header-menu-row i.grey{
                    color: #77899A;
                }

                .esgst-header-menu-row i.yellow{
                    color: #FECC66;
                }

                .esgst-header-menu-name {
                    color: #4B72D4;
                    font: bold 11px/15px Arial, sans-serif;
                }

                .esgst-header-menu-description {
                    color: #6b7a8c;
                    font: 11px/13px Arial, sans-serif
                }

                .esgst-header-menu-row:not(:last-child):hover .esgst-header-menu-name {
                    color: #fff;
                }

                .esgst-header-menu-row:not(:last-child):hover .esgst-header-menu-description {
                    color: rgba(255, 255, 255, 0.7);
                }

                .esgst-header-menu-button {
                    white-space: nowrap;
                    color: #21262f;
                    font: bold 11px/29px Arial, sans-serif;
                    padding: 0 15px;
                    cursor: pointer;
                    text-shadow: 1px 1px rgba(255, 255, 255, 0.08);
                    border-radius: 4px 0 0 4px;
                }

                .esgst-header-menu-button.arrow {
                    border-radius: 0 4px 4px 0;
                    padding: 0 10px;
                }

                .esgst-header-menu-button:hover {
                    background-image: linear-gradient(#9ba2b0 0px, #8c94a3 8px, #596070 100%);
                }

                .esgst-header-menu-button.selected {
                    background-image: linear-gradient(#4e525f 0px, #434857 5px, #2b2e3a 100%);
                    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3) inset;
                    color: #aec5f3;
                    text-shadow: 1px 1px rgba(0, 0, 0, 0.2);
                }

                .esgst-header-menu.selected .esgst-header-menu-button {
                    background-image: linear-gradient(#d0d5de 0px, #c9cdd7 5px, #9097a6 100%);
                    color: #3c465c;
                    text-shadow: 1px 1px rgba(255, 255, 255, 0.2);
                }

                .esgst-header-menu.selected .esgst-header-menu-button:hover:not(.selected) {
                    background-image: linear-gradient(#f0f1f5 0px, #d1d4de 100%);
                }
            `;
        } else {
            style += `
                .esgst-header-menu {
                    display: flex;
                    margin: 0 5px 0 0;
                    box-shadow: 0 0 15px rgba(6, 52, 84, 0.07), 2px 2px 5px rgba(6, 52, 84, 0.07), 1px 1px 2px rgba(6, 52, 84, 0.07);
                }

                .esgst-header-menu-relative-dropdown > div {
                    overflow: hidden;
                    border-radius: 3px;
                    background-color: #fff;
                    position: absolute;
                    margin-top: 39px;
                    box-shadow: 0 0 15px rgba(59, 74, 84, 0.07), 2px 2px 5px rgba(59, 74, 84, 0.07), 1px 1px 2px rgba(59, 74, 84, 0.07);
                    z-index: 10;
                    width: 190px;
                }

                .esgst-header-menu-row {
                    padding: 15px 20px;
                    color: #557a93;
                    display: flex;
                    align-items: center;
                    font: 700 12px 'Open Sans', sans-serif;
                    transition: background-color 0.15s;
                    cursor: pointer;
                }
                
                .esgst-header-menu-row:last-child {
                    cursor: default;
                }

                .esgst-header-menu-row:not(:last-child) {
                    border-bottom: 1px solid #e1ebf2;
                }

                .esgst-header-menu-row.disabled {
                    cursor: default
                }

                .esgst-header-menu-row > * {
                    transition: opacity 0.15s;
                }

                .esgst-header-menu-row i {
                    margin-right: 20px;
                    font-size: 24px;
                    transition: color 0.15s;
                }

                .esgst-header-menu-row:hover {
                    background-color: #f0f3f5;
                }

                .esgst-header-menu-relative-dropdown:hover .esgst-header-menu-row:not(:hover) > * {
                    opacity: 0.5;
                }

                .esgst-header-menu-relative-dropdown:hover .esgst-header-menu-row:not(:hover) i {
                    color: #bdcbd5;
                }

                .esgst-header-menu-row i.blue {
                    color: #9dd9e1;
                }

                .esgst-header-menu-row i.green {
                    color: #96c468;
                }

                .esgst-header-menu-row i.red {
                    color: #ec8583;
                }

                .esgst-header-menu-row i.grey{
                    color: #77899a;
                }

                .esgst-header-menu-row i.yellow{
                    color: #FECC66;
                }

                .esgst-header-menu-row:not(:last-child) .esgst-header-menu-description {
                    display: none;
                }

                .esgst-header-menu-button {
                    cursor: pointer;
                    border-radius: 3px;
                    display: flex;
                    align-items: center;
                    border: 1px solid;
                    font: 700 11px 'Open Sans', sans-serif;
                    padding: 8px 10px;
                    white-space: nowrap;
                    background-image: linear-gradient(#fff 0%, #dfe5f0 50%, #a5b2cc 100%);
                    border-color: #fff #adb6c7 #909bb0 #cdd3df;
                    color: #354a73;
                    text-shadow: 1px 1px rgba(255, 255, 255, 0.3);
                    transition: opacity 0.1s;
                    opacity: 0.8;
                    border-radius: 3px 0 0 3px;
                    border-right: 0;
                }

                .esgst-header-menu-button:hover:not(.selected) {
                    opacity: 1;
                }

                .esgst-header-menu-button.selected {
                    opacity: 0.6;
                }

                .esgst-header-menu-button.arrow {
                    border-radius: 0 3px 3px 0;
                    border-left: 0;
                }

                .esgst-header-menu-button:not(.arrow) > i {
                    margin-right: 10px;
                }

                .esgst-un-button, .page_heading .esgst-heading-button {
                    background-image: linear-gradient(#fff 0%, rgba(255, 255, 255, 0.4) 100%);
                    border: 1px solid #d2d6e0;
                    border-radius: 3px;
                    color: #4b72d4;
                    cursor: pointer;
                    display: inline-block;
                    font: 700 14px/22px "Open Sans", sans-serif;
                    padding: 5px 15px;
                }
            `;
        }
        esgst.style = insertHtml(document.head, `beforeEnd`, `<style id="esgst-style">${style}</style>`);
    }

    /* Changelog */

    function loadChangelog(version) {
        var changelog, current, html, i, index, n, popup;
        changelog = [
            {
                date: `December 30, 2017`,
                version: `7.12.0`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/326">#326</a> Implement a completion check class for AJAX calls</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/327">#327</a> Add option to only clear users with specific tags in Whitelist/Blacklist Manager</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/324">#324</a> Fix a bug that counts pinned giveaways in Giveaway Filters when Hidden Pinned Giveaways is enabled</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/328">#328</a> Add a feature: User Suspension Tracker</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/329">#329</a> Add a "From: ESGST" header to requests made by ESGST</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/334">#334</a> Remove transparency of the box in Username History</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/335">#335</a> Remove bold font from giveaway winning chances/ratios</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/333">#333</a> Fix a bug in the post preview</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/341">#341</a> Add compatibility with Greasemonkey v4</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/342">#342</a> Add a feature: Quick Discussion Browsing</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/344">#344</a> Fix a style issue that does not show the "Current Version" row in the header menu on SteamTrades</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/345">#345</a> Fix a bug that happens when trying to bump trades</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/346">#346</a> Fix a style issue with headings on SteamTrades</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/347">#347</a> Fix a typo in the settings menu in "Add undefined Color Setting"</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/337">#337</a> Add a feature: Community Wishlist Search Links</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/339">#339</a> Fix inconsistency in tooltips regarding periods</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/336">#336</a> Fix a bug that does not save exceptions when saving a preset with a different name</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/284">#284</a> Add more customization options for the genres category</li>
                    </ul>
                `
            },
            {
                date: `December 18, 2017`,
                version: `7.11.2`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/325">#325</a> Add links to the just created Steam group and Pledgie pages to the header menu</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/323">#323</a> Rename the default filename when exporting settings to "esgst_settings"</li>
                    </ul>
                `
            },
            {
                date: `December 17, 2017`,
                version: `7.11.1`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/308">#308</a> Show winners in the created page in Created/Entered/Won Giveaway Details</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/309">#309</a> Prevent apparently empty descriptions with invisible characters from popping up in Enter/Leave Giveaway Button</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/314">#314</a> Update some feature documentation</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/315">#315</a> Prevent user from being able to enable a feature that conflicts with another</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/313">#313</a> Fix a bug in Attached Images Carousel that opens the attached image in the main page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/310">#310</a> Show how many points a game costs when searching for games in the new giveaway page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/311">#311</a> Fix a bug that does not save the ratio settings in Giveaway Filters</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/316">#316</a> Show how many giveaways/discussions each filter is filtering in Giveaway/Discussion Filters</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/312">#312</a> Remove bullet points from results in checks</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/317">#317</a> Add chance per point option to Giveaways Sorter</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/318">#318</a> When loading the next page through the button in Endless Scrolling, return to the previous state instead of pausing</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/319">#319</a> Add borders to some images that are missing it in Image Borders</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/320">#320</a> Fix a bug that happens when loading hidden discussions</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/321">#321</a> Add shortcut to save notes with Ctrl + Enter</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/322">#322</a> Fix a bug that happens when unhiding a game that was faded with One-Click Hide Giveaway Button</li>
                    </ul>
                `
            },
            {
                date: `December 10, 2017`,
                version: `7.11.0`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/294">#294</a> Fix a bug in Header Refresher that counts visited & hidden wishlisted giveaways</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/295">#295</a> Show hidden giveaways/discussions by added date (from most recently added)</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/297">#297</a> Fix a bug that calculates height and width of first load of images as 0 in Attached Images Carousel</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/298">#298</a> Fix a bug that happens when refreshing pages in Endless Scrolling</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/280">#280</a> Also load Giveaways Extractor when there are only SGTools giveaways</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/300">#300</a> Extract details from SGTools giveaways in Giveaways Extractor</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/301">#301</a> Add a feature: Puzzle Marker</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/305">#305</a> Add tool to clean old data</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/306">#306</a> Fix a bug that happens when refreshing active discussions/deals</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/307">#307</a> Add button to load only the next page in Endless Scrolling</li>
                    </ul>
                `
            },
            {
                date: `December 3, 2017`,
                version: `7.10.0`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/270">#270</a> Fix a style issue in Attached Images Carousel that does not scale images correctly</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/271">#271</a> Fix a bug that duplicates the button when bookmarking/unbookmarking/bookmarking a giveaway and entering it</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/272">#272</a> Add missing buttons to the option to hide buttons in the main page heading</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/273">#273</a> Fix a bug that does not detect the status of bookmarked giveaways correctly</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/274">#274</a> Add option to Endless Scrolling to continuously load pages</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/275">#275</a> Add points/total info to Giveaway Bookmarks</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/276">#276</a> Split option to mark pages as visited when visiting them in Giveaways/Discussions/Tickets/Trades Tracker</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/277">#277</a> Fix a bug that does not remember settings correctly when they are renamed</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/278">#278</a> Show sizes of sub-options in the import/export/delete menus</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/279">#279</a> Fix a bug that happens when adding game tags</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/282">#282</a> Fix an Endless Scrolling bug</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/286">#286</a> Fix a bug in SteamTrades that prevents some features from loading</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/283">#283</a> Add a feature: Time To Point Cap Calculator</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/288">#288</a> Fix a bug that does not show scroll to bottom/top buttons when bottom right corner option is selected</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/289">#289</a> Fix a bug that does not unhighlight entered games</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/290">#290</a> Fix a bug that happens when exporting to custom format in Giveaways Manager</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/291">#291</a> Allow importing/exporting/deleting main data</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/293">#293</a> Fix a bug that happens when checking playtime stats in User Giveaways Data</li>
                    </ul>
                `
            },
            {
                date: `November 26, 2017`,
                version: `7.9.1`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/261">#261</a> Fix a bug that does not load the entire changelog</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/260">#260</a> Fix a bug in Avatar Popout that does not load for some users</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/262">#262</a> Fix a style issue in Giveaway/Discussion Filters</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/263">#263</a> Fix a bug that does not load Entered Games Highlighter and Game Tags in popups</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/264">#264</a> Reduce useless space in popups</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/265">#265</a> Fix a bug in Scroll To Bottom Button that does not scroll all the way down with Endless Scrolling</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/266">#266</a> Fix a bug that happens when filtering features in the settings menu</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/267">#267</a> Automatically expand sections when filtering features in the settings menu</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/268">#268</a> Add option to show Scroll To Top/Bottom Button in the main page heading</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/269">#269</a> More changes to Attached Images Carousel</li>
                    </ul>
                `
            },
            {
                date: `November 24, 2017`,
                version: `7.9.0`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/224">#224</a> Also trigger reverse scrolling from the main and inbox pages in Endless Scrolling</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/225">#225</a> Fix a bug that does not allow adding a second reply to a comment without refreshing the page in Multi-Reply/Reply From Inbox</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/226">#226</a> Open the authentication window for Dropbox, Google Drive and OneDrive in a small window instead of in a new tab</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/227">#227</a> Only show button to add description to filters if the option to filter useless descriptions is enabled in Enter/Leave Giveaway Button</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/228">#228</a> Add ratio filter to Giveaway Filters</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/229">#229</a> Make some changes to the structure of the code</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/230">#230</a> Fix a bug that happens when syncing from the account page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/232">#232</a> Make some optimizations</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/236">#236</a> Remove sync button after the sync is complete when syncing through the account page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/237">#237</a> Prevent sync results from duplicating when clicking on the sync button again</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/238">#238</a> Fix a bug that sometimes does not detect if the user is logged in to Steam in when syncing</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/239">#239</a> Add a feature: Scroll To Bottom Button</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/240">#240</a> Fix a bug that moves the start time column of a giveaway if it has both received and not received copies</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/234">#234</a> Highlight game ids for games that are not in the Steam API when syncing and therefore cannot be converted to a name</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/241">#241</a> Fix a bug in Whitelist/Blacklist Checker that happens when checking group giveaways</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/243">#243</a> Add option to automatically backup data every X days</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/244">#244</a> Remove the plus sign after the level in Created/Entered/Won Giveaway Details</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/245">#245</a> Extend #226 to Imgur uploads</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/246">#246</a> Add option to refresh active discussions when refreshing giveaways in the main page through Endless Scrolling</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/248">#248</a> Add a feature: Refresh Active Discussions Button</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/247">#247</a> Replace colon with underline in exported file names</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/249">#249</a> Allow custom names for exported files</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/250">#250</a> Add an easy way to debug directly from ESGST</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/254">#254</a> Fix a bug in Giveaway Bookmarks that does not unbookmark a giveaway when entering it through SG's native button</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/255">#255</a> Add options to Giveaway Bookmarks to automatically unbookmark entered giveaways and show the button for entered giveaways</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/256">#256</a> Fix a bug that does not detect entered giveaways in the Giveaway Bookmarks list</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/252">#252</a> Fix a style issue in Giveaways Manager</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/253">#253</a> Add search filters to the settings menu</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/257">#257</a> Make some visual changes to Attached Images Carousel</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/258">#258</a> Allow users to order the heading buttons however they want</li>
                    </ul>
                `
            },
            {
                date: `November 18, 2017`,
                version: `7.8.1`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/214">#214</a> Fix a bug in Scroll To Top Button that happens in ESGST-generated pages</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/215">#215</a> Fix a bug that happens when typing \` in Comment Formatting Helper with preview enabled</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/212">#212</a> Fix a bug in Search Magnifying Glass Button that does not work outside of the main page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/210">#210</a> Show script version in the header menu</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/209">#209</a> Improve the left/right buttons in Attached Images Carousel</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/208">#208</a> Add button to start Attached Images Carousel from the header</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/218">#218</a> Revert how new features/options are highlighted to the [NEW] text instead of the star icon</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/219">#219</a> Fix a bug that happens when trying to load a group/whitelist giveaway in Blacklist Giveaway Loader</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/220">#220</a> Fix a bug in Comments Reverser that reverses giveaways in the main page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/222">#222</a> Fix a bug that happens when syncing won games</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/221">#221</a> Fix a style issue where popups keep shaking when already repositioned</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/223">#223</a> Add option to open the automatic sync in a new tab</li>
                    </ul>
                `
            },
            {
                date: `November 16, 2017`,
                version: `7.8.0`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/9">#9</a> Add option to preview comments to Comment Formatting Helper</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/184">#184</a> Add "unlimitedStorage" permission to extension</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/191">#191</a> Fully add the script code to the extension code</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/190">#190</a> Fix a bug that does not load Giveaway Bookmarks in the entered page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/186">#186</a> Remove text from SG sync</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/189">#189</a> Fix a bug in Giveaways Extractor that happens when opening in a new tab</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/76">#76</a> Fix a bug that does not filter discussions on page load if Comment Tracker is disabled</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/185">#185</a> Add option to collapse sections in the settings menu</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/192">#192</a> Make new features/options more visible in the settings menu</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/137">#137</a> Prevent Header Refresher from notifying about wishlist giveaways that are above the user's level</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/142">#142</a> Improve how Whitelist/Blacklist Checker results are stored</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/193">#193</a> Fix a side effect from #185 that collapses the import/export/delete menus</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/194">#194</a> Separate option to reverse comments from Endless Scrolling into a new feature: Comments Reverser</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/195">#195</a> Add option to Whitelist/Blacklist Checker to skip a user if X pages have been checked without any result</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/196">#196</a> Add button to Whitelist/Blacklist Checker to manually skip users</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/197">#197</a> Add option to Whitelist/Blacklist Checker to check only selected users in the page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/199">#199</a> Fix a bug that does not sync alt accounts</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/198">#198</a> Add a feature: Comments/Entries Checker</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/202">#202</a> Fix a bug in Real CV Calculator that happens when reviewing a giveaway</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/204">#204</a> Fix a bug in Giveaway Filters that does not filter giveaways correctly when using Endless Scrolling</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/205">#205</a> Move the scroll to top button more to the bottom/right</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/206">#206</a> Add option to show scroll to top button inside of footer</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/200">#200</a> Add option to make popups static</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/203">#203</a> Show game names instead of IDs when syncing</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/207">#207</a> Add a feature: Hidden Pinned Giveaways</li>
                    </ul>
                `
            },
            {
                date: `November 12, 2017`,
                version: `7.7.4`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/167">#167</a> Fix a Comment History conflict with other scripts</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/168">#168</a> Move entries tracker from settings menu to the user menu in the header</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/166">#166</a> Fix a bug that happens when trying to create multiple giveaways</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/169">#169</a> Fix a bug that happens when there are less than 5 unhidden discussions</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/171">#171</a> Fix a bug that shows the wrong message for cases where the user has unblacklisted another user in Blacklist Giveaway Loader</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/172">#172</a> Fix a bug in Group Library/Wishlist Checker that does not check only wishlist if there is no Steam API key set</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/173">#173</a> Fix a bug that prevents some giveaway features from loading</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/175">#175</a> Refresh active discussions and pinned giveaways when refreshing main giveaway pages in Endless Scrolling</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/174">#174</a> Fix a bug in Giveaway Winning Ratio that does not round up the ratio correctly</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/176">#176</a> Fix a bug in Attached Images Carousel that does not close the popup when clicking on the source link</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/177">#177</a> Fix a bug that happens when uploading images through Imgur</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/178">#178</a> Fix a bug in Tables Sorter that does not sort some columns correctly</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/179">#179</a> Remove text from giveaway icons in popups in normal view</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/164">#164</a> Fix a bug that does not automatically collapse replies in Collapse/Expand Replies Button when using Endless Scrolling</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/163">#163</a> Fix a bug that does not set the gift/key field correctly when editing a giveaway in Multiple Giveaways Creator</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/181">#181</a> Fix a bug that happens when trying to import/export through Google Drive/OneDrive using the script or the extension on Firefox</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/180">#180</a> Fix a bug in Multiple Giveaways Creator that alters the date when editing a giveaway</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/182">#182</a> Fix a bug that shows wrong chance/ratio in the entered page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/183">#183</a> Add the script code to the extension code</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/145">#145</a> Add option to Giveaways Extractor to only extract from the current giveaway onwards</li>
                    </ul>
                `
            },
            {
                date: `November 11, 2017`,
                version: `7.7.3`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/136">#136</a> Move recent username changes and comment history from the header menu</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/139">#139</a> Extend Time To Enter Calculator to Giveaways Manager</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/138">#138</a> Remove text from giveaway icons in popups</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/146">#146</a> Fix a bug in Whitelist/Blacklist Sorter that opens the whitelist in the blacklist page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/135">#135</a> Add download link to the update notification popup in the extension</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/148">#148</a> Extend Blacklist Giveaway Loader to situations where the user has unblacklisted the other user</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/140">#140</a> Fix a bug in Reply From Inbox that shows the wrong time ago for replies</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/150">#150</a> Fix a bug that opens the automatic sync multiple times</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/151">#151</a> Prevent sync from clearing game data when store method is unavailable</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/149">#149</a> Fix a bug in Game Categories that happens when the Steam store does not have information about the base game of a DLC</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/154">#154</a> Fix a bug that does not update the storage in the current session when deleting data</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/155">#155</a> Fix a bug that happens when importing/exporting data through Dropbox</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/156">#156</a> Add option to import/export through Google Drive</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/157">#157</a> Add option to import/export through OneDrive</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/158">#158</a> Fix a bug that calculates the size of files incorrectly when importing through Dropbox/OneDrive</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/159">#159</a> Make the buttons in the import/export/delete menus inline so there is more room for the options</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/160">#160</a> Color the buttons in the import/export/delete menus white</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/161">#161</a> Extend #159 to other places where there are multiple buttons</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/153">#153</a> Add option to shuffle giveaways to Multiple Giveaways Creator</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/162">#162</a> Fix a bug that does not update the cache when reordering/deleting giveaways in Multiple Giveaways Creator</li>
                    </ul>
                `
            },
            {
                date: `November 4, 2017`,
                version: `7.7.2`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/133">#133</a> Fix a typo in the URL for groups in Group Library/Wishlist Checker</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/134">#134</a> Fix a bug that does not update the last sync date when performing an automatic sync</li>
                    </ul>
                `
            },
            {
                date: `November 4, 2017`,
                version: `7.7.1`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/128">#128</a> Fix a bug that does not show Time To Enter Calculator in the settings menu</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/130">#130</a> Fix a bug in Endless Scrolling that does not load the next page when the ended filter is set to hide all and there is a deleted giveaway in the page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/131">#131</a> Extend deleted filter to the entered page in Giveaway Filters</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/132">#132</a> Fix a bug that does not detect won games correctly</li>
                    </ul>
                `
            },
            {
                date: `November 4, 2017`,
                version: `7.7.0`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/106">#106</a> Fix a bug in Discussions Sorter that does not sort by created time correctly</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/107">#107</a> Stop Endless Scrolling in the entered page when reaching ended giveaways with the ended filter enabled as "hide all"</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/108">#108</a> Allow setting different automatic sync frequencies for each data</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/109">#109</a> Separate single giveaway filters from multiple filters</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/110">#110</a> Add a fallback method to Next/Previous Train Hotkeys</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/111">#111</a> Add an option not to exclude deals from the discussions section in Old Active Discussions Design</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/112">#112</a> Add a feature: Time To Enter Calculator</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/113">#113</a> Fix a bug that happens when syncing games</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/115">#115</a> Fix a bug in Entries Tracker that does not sort the dates correctly</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/116">#116</a> Add more stats to Entries Tracker</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/117">#117</a> Fix a bug in Giveaway Filters that does not apply overrides correctly</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/118">#118</a> Add 2 new links to the header menu</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/120">#120</a> Allow exporting settings without personal data</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/121">#121</a> Fix a bug that happens when completing the active discussions/deals</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/122">#122</a> Refresh header when refreshing page through Endless Scrolling if Header Refresher is disabled</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/123">#123</a> Add a button to reset the Imgur setting in Comment Formatting Helper</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/124">#124</a> Separate the Grid View elements below the enter/leave button in two columns</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/125">#125</a> Fix a bug that does not set the default value for new settings correctly</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/126">#126</a> Go to the next unread comment after going to the first in Comment Tracker</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/127">#127</a> Save data for whitelisted/blacklisted users in Whitelist/Blacklist Checker</li>
                    </ul>
                `
            },
            {
                date: `November 3, 2017`,
                version: `7.6.4`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/86">#86</a> Add an option to highlight public/group giveaways in Giveaways Extractor</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/87">#87</a> Ignore inactive users in Group Library/Wishlist Checker</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/88">#88</a> Make the header dropdown menus work in ESGST generated pages</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/89">#89</a> Fix a bug in Comment Formatting Helper that does not correctly undo automatic link formatting</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/90">#90</a> Split Shared Groups Checker results in two columns: public and private</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/91">#91</a> Fix a bug in Giveaway Popup that adds a button to the review giveaway page when creating invite only giveaways</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/92">#92</a> Complete the active discussions/deals if some of them have been hidden through Discussion Filters</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/93">#93</a> Fix a bug in Old Active Discussions Design that shows deals in the discussions section</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/94">#94</a> Fix a bug in Giveaway Filters that does not automatically filter giveaways in popups</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/95">#95</a> Undo formatting when pressing backspace in Comment Formatting Helper</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/96">#96</a> Focus on text area after undoing/redoing formatting in Comment Formatting Helper</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/97">#97</a> Fix a bug in Group Library/Wishlist Checker that uses the incorrect URL for groups</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/98">#98</a> Fix a bug in Shared Groups Checker that does not return the groups</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/99">#99</a> Reposition open popups every second</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/100">#100</a> Allow navigating through Attached Images Carousel using the arrow keys</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/101">#101</a> Improvements to #99</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/102">#102</a> Close a div tag in addDhHighlightButton</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/103">#103</a> Fix a bug in Giveaway Filters that does not filter giveaways when the genre filter is enabled</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/104">#104</a> Fix a bug that does not load the features correctly when a discussion with 0 comments is in the page</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/105">#105</a> Fix a bug that shows the SG icon instead of the ESGST one in some ESGST generated pages</li>
                    </ul>
                `
            },
            {
                date: `November 2, 2017`,
                version: `7.6.3`,
                changelog: `
                    <ul>
                        <li><a href="https://github.com/revilheart/ESGST/issues/7">#7</a> Add an option to prevent Game Categories from being links in Grid View</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/54">#54</a> Fix a bug in Header Refresher that shows duplicate notifications</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/78">#78</a> Fix a bug in Giveaways Recreator that uses assigned keys instead of unassigned</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/79">#79</a> Fix a bug in Giveaway Filters that duplicates the DefaultUser preset every time a profile page is loaded</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/80">#80</a> Allow separate Giveaway Filters presets/settings for Giveaway Bookmarks, Giveaways Extractor and Giveaways Encrypter/Decrypter</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/81">#81</a> Fix a bug in User Tags that does not delete tags</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/82">#82</a> Add 3 new encryption methods to Giveaways Encrypter/Decrypter</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/83">#83</a> Fix a bug in Main Post Popup that scrolls down the page when the main post is hidden</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/84">#84</a> Fix a bug in Header Refresher that sometimes does not notify about wishlist giveaways in the tab title</li>
                        <li><a href="https://github.com/revilheart/ESGST/issues/85">#85</a> Fix a bug in Giveaway Filters that does not rename presets globally</li>
                    </ul>
                `
            },
            {
                date: `October 31, 2017`,
                version: `7.6.2`,
                changelog: `
                    <ul>
                        <li>Made some style alterations to Quick Giveaway Search and added an option (Giveaways.2.1) to hide the native search when on the main giveaway pages (<a href="https://github.com/revilheart/ESGST/issues/77">#77</a>).</li>
                        <li>Extended Giveaway Filters to the profile pages.</li>
                        <li>Fixed a bug in Giveaway Bookmarks that was unbookmarking giveaways for which there were not enough points to enter.</li>
                        <li>Fixed a bug in Discussion Filters that was not filtering discussions automatically (<a href="https://github.com/revilheart/ESGST/issues/76">#76</a>).</li>
                    </ul>
                `
            },
            {
                date: `October 29, 2017`,
                version: `7.6.1`,
                changelog: `
                    <ul>
                        <li>Fixed a bug in Quick Giveaway Search that was messing the header (<a href="https://github.com/revilheart/ESGST/issues/72">#72</a>).</li>
                        <li>Extended Giveaway Filters and Giveaways Manager to Giveaway Bookmarks.</li>
                        <li>When using Giveaways Extractor, you no longer have to click on "Extract" to start extracting - it now starts automatically.</li>
                        <li>Discussion Filters now has a different preset for the created discussions page (<a href="https://github.com/revilheart/ESGST/issues/71">#71</a>).</li>
                        <li>Fixed a bug in Group Library/Wishlist Checker that was showing the wrong percentages.</li>
                    </ul>
                `
            },
            {
                date: `October 24, 2017`,
                version: `7.6.0`,
                changelog: `
                    <ul>
                        <li>Added something that should prevent ESGST from loading more than once in the same page for some users (<a href="https://github.com/revilheart/ESGST/issues/59">#59</a>).</li>
                        <li>Added an option to Header Refresher to only notify about unentered wishlist giveaways that are ending in X hours (<a href="https://github.com/revilheart/ESGST/issues/64">#64</a>).</li>
                        <li>Added Giveaways.2 Quick Giveaway Search.</li>
                        <li>The genre filter in Giveaway Filters now works as a three-state filter like the others ("hide all" hides the genres listed, "show only" shows only the genres listed and "show all" shows everything).</li>
                        <li>Fixed a bug in Unhide Giveaway Button that was not correctly detecting hidden games for Giveaway Bookmarks (<a href="https://github.com/revilheart/ESGST/issues/68">#68</a>).</li>
                        <li>Blacklist Giveaway Loader now shows "You Are Blacklisted" if you have been blacklisted by the creator and "On Your Blacklist" if you have blacklisted the creator.</li>
                        <li>Fixed a bug that was happening for users with Avatar Popout on click enabled.</li>
                        <li>Group Library/Wishlist Checker now verifies if the user is still a member of the group.</li>
                    </ul>
                `
            },
            {
                date: `October 23, 2017`,
                version: `7.5.1`,
                changelog: `
                    <ul>
                        <li>The popup that notifies about a new version is now dismissed when closed and only appears again for the next version (<a href="https://github.com/revilheart/ESGST/issues/65">#65</a>).</li>
                        <li>Added a "Update" link to the popup above in the script.</li>
                        <li>Added buttons to select all/none/inverse when syncing.</li>
                        <li>Prevented Giveaways Manager from loading in some pages (<a href="https://github.com/revilheart/ESGST/issues/69">#69</a>).</li>
                        <li>Possibly fixed a bug in Unsent Gifts Sender that was not sending all gifts (<a href="https://github.com/revilheart/ESGST/issues/3">#3</a>).</li>
                        <li>Fixed a bug in CFH (Comment Formatting Helper) that was placing the cursor in the wrong place after pasting a link/image without a title.</li>
                        <li>When toggling the Automatic Links/Images Paste Formatting in CFH, the focus now returns to the text area (<a href="https://github.com/revilheart/ESGST/issues/60">#60</a>).</li>
                        <li>Fixed a bug that was preventing Group Library/Wishlist Checker from working properly in the script.</li>
                    </ul>
                `
            },
            {
                date: `October 22, 2017`,
                version: `7.5.0`,
                changelog: `
                    <ul>
                        <li>Fixed a bug that was happening when importing groups.</li>
                        <li>Giveaway descriptions are no longer mandatory in Enter/Leave Giveaway Button. Yes, for the millionth time this has changed again. Here's why: making giveaway descriptions mandatory results in many complaints and users rolling back to old versions, which is a bad thing, especially since ESGST is in constant development and bugs are constantly being fixed. In the end, I still think this falls to the user. Forcing something on someone who doesn't care about it amounts to nothing, they will still find ways to ignore it.</li>
                        <li>Giveaways Extractor now detects giveaways that you cannot enter correctly (<a href="https://github.com/revilheart/ESGST/issues/58">#58</a>).</li>
                        <li>Added Giveaways.39 Blacklist Giveaway Loader</li>
                        <li>Fixed a bug in Comment Formatting Helper that was happening for script users when pasting links/images.</li>
                        <li>Added Users.15/Users.16 Whitelist/Blacklist Manager</li>
                        <li>Added Groups.3 Group Library/Wishlist Checker</li>
                    </ul>
                `
            },
            {
                date: `October 21, 2017`,
                version: `7.4.0`,
                changelog: `
                    <ul>
                        <li>Made ESGST a bit more welcoming to new users (users that are installing it for the first time will now get some basic information to help them get started).</li>
                        <li>In the settings menu you will now see some red icons for features that require syncing, and upon hovering over the icons, tooltips will appear telling you which data needs to be synced to make the feature work correctly.</li>
                        <li>Moved the sync section to the top of the settings menu.</li>
                        <li>Fixed a bug that was happening for some users when syncing groups.</li>
                        <li>Added an option to the settings menu that allows you to sync previously won games.</li>
                        <li>Fixed a bug that was not allowing users to drag and drop on Firefox.</li>
                        <li>Added General.13 Attached Images Loader.</li>
                        <li>Fixed a bug that was adding the Giveaways Manager button to the right side of the main page heading instead of the left (<a href="https://github.com/revilheart/ESGST/issues/63">#63</a>).</li>
                        <li>Giveaways Extractor now extracts giveaways that cannot be accessed because of blacklist issues and colors them with a red background.</li>
                        <li>Added an option to use precise start/end dates to Giveaway Templates.</li>
                        <li>Fixed a bug in CEWGD (Created/Entered/Won Giveaway Details) that was ordering the columns in the entered page wrong.</li>
                        <li>Fixed a bug in CEWGD that was showing the wrong creator for giveaways in the won page.</li>
                        <li>Fixed a bug in Comment Formatting Helper that was not formatting some links correctly (<a href="https://github.com/revilheart/ESGST/issues/62">#62</a>).</li>
                        <li>Fixed a bug in Comment Searcher that was preventing the script from loading correctly (<a href="https://github.com/revilheart/ESGST/issues/61">#61</a>).</li>
                        <li>Fixed a bug in Not Activated/Multiple Wins Checker that was not coloring users.</li>
                    </ul>
                `
            },
            {
                date: `October 18, 2017`,
                version: `7.3.0`,
                changelog: `
                    <ul>
                        <li>Made some changes to the structure of the code.</li>
                        <li>Fixed a bug that was deleting tags when saving data.</li>
                        <li>Fixed a bug that was happening for some users when syncing groups.</li>
                        <li>Fixed a bug that was preventing some features from working correctly in pages generated by the script, such as "/esgst/bookmarked-giveaways".</li>
                        <li>Added the scroll to top button from Endless Scrolling as a separate feature: 1.21 Scroll To Top Button</li>
                        <li>Fixed a bug that was preventing Enter/Leave Giveaway Button and Giveaway Popup from working correctly with Comment Formatting Helper disabled.</li>
                        <li>Fixed a bug in Main Post Popup that was opening the popup at the wrong position.</li>
                        <li>Added the button to the comment formatting page from Comment Formatting Helper as an option (<a href="https://github.com/revilheart/ESGST/issues/57">#57</a>).</li>
                        <li>Fixed a bug in Whitelist/Blacklist Checker that was not updating the status of users who had whitelisted/blacklisted you and then removed you from those lists.</li>
                    </ul>
                `
            },
            {
                date: `October 14, 2017`,
                version: `7.2.2`,
                changelog: `
                    <ul>
                        <li>Giveaway Bookmarks can now be accessed through "/esgst/bookmarked-giveaways".</li>
                        <li>Giveaways Encrypter/Decrypter can now be accessed through "/esgst/decrypted-giveaways".</li>
                        <li>Giveaways Extractor can now be accessed through "/esgst/extracted-giveaways?url=/giveaway/XXXXX/" or "/esgst/extracted-giveaways?url=/discussion/XXXXX/".</li>
                        <li>Added an option to each feature above to open it in a new tab using the new URL.</li>
                        <li>Fixed some style issues in Grid View with Image Borders disabled.</li>
                        <li>Fixed a bug in Giveaway/Discussion Filters that was not applying overrides correctly.</li>
                        <li>Fixed a style issue in Giveaway/Discussion Filters that was making the legend and preset panels overlap for users with few filters enabled.</li>
                        <li>Extended Giveaways Manager to every page and added the option to bookmark/unbookmark/hide multiple giveaways at once.</li>
                        <li>Fixed a bug in Enter/Leave Giveaway Button that was hiding the enter button for won giveaways marked as not received.</li>
                        <li>Next/Previous Train Hotkeys now detects previous/next links based on how many giveaway links there are in the page instead of their text (experimental).</li>
                        <li>Giveaways Extractor now extracts all giveaways in the page instead of just the ones in the giveaway description (<a href="https://github.com/revilheart/ESGST/issues/55">#55</a>).</li>
                        <li>Fixed a bug in Created/Entered/Won Giveaway Details that was opening Steam links in the same page instead of in a new tab.</li>
                        <li>Fixed a bug in Comment Formatting Helper that was not showing the Giveaway Encrypter button (<a href="https://github.com/revilheart/ESGST/issues/56">#56</a>).</li>
                        <li>Fixed a bug that was happening when adding comments to giveaways without a description (<a href="https://github.com/revilheart/ESGST/issues/53">#53</a>).</li>
                        <li>Added an option to Game Categories (Games.3.21.2) that indicates if the base game of a DLC is free or not.</li>
                        <li>Because of the new option above, added new filters to Giveaway Filters: "DLC (Free Base)" and "DLC (Non-Free Base)"</li>
                    </ul>
                `
            },
            {
                date: `October 13, 2017`,
                version: `7.2.1`,
                changelog: `
                    <ul>
                        <li>Fixed a bug in Comment Formatting Helper that was happening in discussion pages.</li>
                    </ul>
                `
            },
            {
                date: `October 13, 2017`,
                version: `7.2.0`,
                changelog: `
                    <ul>
                        <li>Removed the update button from the header menu in the extension, since you have to update it through the browser.</li>
                        <li>Added an option that was missing from the settings menu to import/export/delete Giveaway Bookmarks data.</li>
                        <li>Fixed a bug in Header Refresher that was not notifying unread messages in the icon of the tab.</li>
                        <li>Fixed a bug in One-Click Hide Giveaway Button that was happening when hiding giveaways in popups.</li>
                        <li>Fixed a bug that was showing the button to unhide giveaways everywhere instead of just in the main/giveaway pages (<a href="https://github.com/revilheart/ESGST/issues/50">#50</a>).</li>
                        <li>Added the functionality above as a feature so you can choose whether you want it or not (2.12 Unhide Giveaway Button).</li>
                        <li>You can now choose whether to load the groups in Giveaway Groups Loader on a panel upon page load (default), on a popout upon hover, on a popout upon click or on a popup upon click.</li>
                        <li>Renamed Giveaway Countries Popout to Giveaway Countries Loader.</li>
                        <li>You can now choose whether to load the countries in the feature above on a popout upon hover (default), on a popout upon click or on a popup upon click.</li>
                        <li>Revamped Comment Formatting Helper (CFH).</li>
                        <li>Fixed some bugs in CFH.</li>
                        <li>There is now only one CFH panel per page, instead of one panel per text box. When you focus on a text box, the panel will move to that box.</li>
                        <li>The buttons in the CFH panel are now faded by default and unfaded on hover.</li>
                        <li>Added a button at the end of the CFH panel that links to the comment formatting page on SG/ST.</li>
                        <li>You can now choose whether to open Avatar Popout upon hover (default) or click.</li>
                    </ul>
                `
            },
            {
                date: `October 11, 2017`,
                version: `7.1.1`,
                changelog: `
                    <ul>
                        <li>Fixed a bug that was happening when trying to save data for users that were not yet on the database.</li>
                        <li>Fixed a bug in Endless Scrolling that was not updating the points after removing entries from page 2 onwards (closes <a href="https://github.com/revilheart/ESGST/issues/20">#20</a>).</li>
                        <li>You can now unhide games from the main/giveaway page (closes <a href="https://github.com/revilheart/ESGST/issues/37">#37</a>).</li>
                        <li>Fixed a bug in Real CV Calculator that was showing the wrong CV because of the recent changes to the point system on SG (closes <a href="https://github.com/revilheart/ESGST/issues/46">#46</a>).</li>
                        <li>Added a button to User/Game Tags that allows you to reset a tag to its default color.</li>
                        <li>You can now easily add tags from a list of all tags you have saved in User/Game Tags (closes <a href="https://github.com/revilheart/ESGST/issues/34">#34</a>).</li>
                    </ul>
                `
            },
            {
                date: `October 10, 2017`,
                version: `7.1.0`,
                changelog: `
                    <ul>
                        <li>Fixed various bugs that were happening when importing/exporting/deleting data, such as some data not being imported/exported and some data remaining in the storage despite having all options selected while deleting them.</li>
                        <li>Added an option to import/export/delete discussion/giveaway filters presets (closes <a href="https://github.com/revilheart/ESGST/issues/45">#45</a>) and stickied giveaway countries data.</li>
                        <li>Added an option not to filter games with no rating to Giveaway Filters.</li>
                        <li>The basic and advanced chances/ratios are now colored separately.</li>
                        <li>The option to load the groups as a popup in Giveaway Groups Loader has changed to a popout (now you simply have to hover instead of clicking).</li>
                        <li>The Giveaways Extractor button now correctly appears only when there are giveaways on the page.</li>
                        <li>Fixed a bug in Discussion Edits Detector that was not detecting edits and therefore not saving the comments.</li>
                        <li>When adding a link/image without a title to Comment Formatting Helper, the pointer will now move to between the "[" and "]" (closes <a href="https://github.com/revilheart/ESGST/issues/42">#42</a>).</li>
                        <li>You can now undo/redo formatting in Comment Formatting Helper.</li>
                        <li>Fixed a bug in User Tags that was not detecting username changes correctly.</li>
                    </ul>
                    <p>Added the following features:</p>
                    <ul>
                        <li>2.19 Giveaway Countries Popout</li>
                    </ul>
                `
            },
            {
                date: `October 8, 2017`,
                version: `7.0.2`,
                changelog: `
                    <ul>
                        <li>The extension should now update automatically on Firefox.</li>
                    </ul>
                `
            },
            {
                date: `October 8, 2017`,
                version: `7.0.1`,
                changelog: `
                    <ul>
                        <li>Fixed a bug in requests for the same domain on the extension.</li>
                    </ul>
                `
            },
            {
                date: `October 8, 2017`,
                version: `7.0.0`,
                changelog: `
                    <ul>
                        <li>Replaced the Dropbox SDK with the HTTP endpoints, which should fix some bugs.</li>
                        <li>Fixed a bug in Header Refresher that was not updating the enter buttons in the page.</li>
                        <li>When inside a giveaway that you have no points to enter, the "Not Enough Points" button will now be replaced by Enter/Leave Giveaway Button and update accordingly when you get more points without the need to refresh the page.</li>
                    </ul>
                    <p>
                        <b>ESGST has been ported to an extension (currently only tested with Firefox and Chrome). Head over to the ESGST discussion or GitHub page to learn how to upgrade. The script version of ESGST will continue to be updated normally for now, whenever the extension is updated (I will decide whether or not to discontinue it based on the extension reception). The "Beta" drop in the version name does not mean the script has become stable.</b>
                    </p>
                `
            }
        ];
        if (version) {
            for (i = 0, n = changelog.length; i < n && changelog[i].version !== version; ++i);
            index = i < n ? i - 1 : n - 1;
        } else {
            index = 0;
        }
        html = [];
        while (index >= 0) {
            html.unshift(`
                <p class="esgst-bold">v${changelog[index].version} (${changelog[index].date})</p>
                ${changelog[index].changelog}
            `);
            --index;
        }
        popup = new Popup(`fa-file-text-o`, `Changelog`, true);
        popup.scrollable.insertAdjacentHTML(`afterBegin`, `<div class="esgst-text-left markdown">${html.join(``)}</div>`);
        popup.open();
    }

    function request(data, headers, method, queue, url, callback, anon) {
        if (!headers) {
            headers = {};
        }
        if (!headers[`Content-Type`]) {
            headers[`Content-Type`] = `application/x-www-form-urlencoded`;
        }
        headers[`From`] = `ESGST (https://github.com/revilheart/ESGST)`;
        if (queue) {
            createLock(`requestLock`, 1000, function (closeLock) {
                continueRequest(data, headers, method, url, callback, anon, closeLock);
            });
        } else {
            continueRequest(data, headers, method, url, callback, anon);
        }
    }

    function checkUpdate() {
        request(null, null, `GET`, false, `https://raw.githubusercontent.com/revilheart/ESGST/master/ESGST.meta.js`, function (response) {
            var version = response.responseText.match(/@version (.+)/);
            if (version) {
                if (version[1] != esgst.version) {
                    location.href = `https://raw.githubusercontent.com/revilheart/ESGST/master/ESGST.user.js`;
                } else {
                    alert(`No ESGST updates found!`);
                }
            } else {
                alert(`No ESGST updates found!`);
            }
        });
    }

})();